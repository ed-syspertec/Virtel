

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>** &mdash; Virtel 1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Virtel 1 documentation" href="../../../index.html"/>
        <link rel="up" title="Virtel Manuals" href="../../../virtel.html"/>
        <link rel="next" title="Virtel connectivity Guide" href="../Connectivity/index.html"/>
        <link rel="prev" title="Virtel Installation Guide" href="../Install/index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Virtel
          

          
            
            <img src="../../../_static/logo_virtel_web.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../virtel.html">Virtel Manuals</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../virtel.html#v4-53">V4.53</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../virtel.html#v4-56">V4.56</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../Install/index.html">Virtel Installation Guide</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">**</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#list-of-figures">List of figures</a></li>
<li class="toctree-l4"><a class="reference internal" href="#incoming-calls">Incoming Calls</a></li>
<li class="toctree-l4"><a class="reference internal" href="#outgoing-calls">Outgoing Calls</a></li>
<li class="toctree-l4"><a class="reference internal" href="#programming-interfaces">Programming Interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id207">Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="#howto-information">HOWTO information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#index">Index</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../Connectivity/index.html">Virtel connectivity Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../OperMsg/index.html">Operations and Message Guide</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../newsletters.html">Technical Newsletters</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Virtel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../virtel.html">Virtel Manuals</a> &raquo;</li>
      
    <li>**</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/manuals/V456/UserGuide/UserGuide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p><a class="reference internal" href="../../../_images/image110.png"><img alt="image0" src="../../../_images/image110.png" style="width: 4.30000in; height: 1.00000in;" /></a></p>
<p><a href="#id211"><span class="problematic" id="id212">|VIRTEL\_Logo|</span></a></p>
<blockquote>
<div><p><strong>*VIRTEL Version 4
Web Access Guide*</strong></p>
<p>29 Nov 2013</p>
<p>VIRTEL Version 4.52</p>
</div></blockquote>
<div class="section" id="id3">
<h1><a href="#id1"><span class="problematic" id="id2">**</span></a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h1>
<p><strong>*NOTICE*</strong></p>
<p>Reproduction, transfer, distribution, or storage, in any form, of all or
any part of the contents of this document, except by prior authorization
of <strong>*SysperTec Communication*</strong>, is prohibited.</p>
<p>Every possible effort has been made by <strong>*SysperTec Communication*</strong> to
ensure that this document is complete and relevant. In no case can
<strong>*SysperTec Communication*</strong> be held responsible for any damages,
direct or indirect, caused by errors or omissions in this document.</p>
<p>As <strong>*SysperTec Communication*</strong> uses a continuous development
methodology; the information contained in this document may be subject
to change without notice. Nothing in this document should be construed
in any manner as conferring a right to use, in whole or in part, the
products or trademarks quoted herein.</p>
<p><strong>*SysperTec Communication*</strong> and <strong>*VIRTEL*</strong> are registered
trademarks. Names of other products and companies mentioned in this
document may be trademarks or registered trademarks of their respective
owners.</p>
<div class="section" id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="#table-of-contents">Table of Contents iii</a></p>
<p><a class="reference external" href="#list-of-figures">List of figures v</a></p>
<p><a class="reference external" href="#incoming-calls">1 Incoming Calls 9</a></p>
<p><a class="reference external" href="#virtel-web-access">1.1 VIRTEL Web Access 9</a></p>
<p><a class="reference external" href="#introduction">1.1.1 Introduction 9</a></p>
<p><a class="reference external" href="#virtel-url-formats">1.1.2 VIRTEL URL formats 12</a></p>
<p><a class="reference external" href="#directory-management">1.1.3 Directory management 22</a></p>
<p><a class="reference external" href="#creating-html-and-xml-template-pages">1.1.4 Creating HTML and XML template pages
27</a></p>
<p><a class="reference external" href="#correspondent-management">1.1.5 Correspondent management 81</a></p>
<p><a class="reference external" href="#uploading-html-pages">1.1.6 Uploading HTML pages 85</a></p>
<p><a class="reference external" href="#web-access-customization">1.1.7 Web Access customization 105</a></p>
<p><a class="reference external" href="#application-selection-menu">1.1.8 Application selection menu 116</a></p>
<p><a class="reference external" href="#printing-with-web-access">1.1.9 Printing with Web Access 120</a></p>
<p><a class="reference external" href="#tso-file-transfer">1.1.10 TSO file transfer 125</a></p>
<p><a class="reference external" href="#accessing-vtam-applications">1.1.11 Accessing VTAM applications
134</a></p>
<p><a class="reference external" href="#site-customization-of-colors-and-logo">1.1.12 Site customization of colors and logo
136</a></p>
<p><a class="reference external" href="#site-customization-of-javascript-functions">1.1.13 Site customization of Javascript functions
140</a></p>
<p><a class="reference external" href="#customizing-the-help-page">1.1.14 Customizing the help page 146</a></p>
<p><a class="reference external" href="#macros">1.1.15 Macros 147</a></p>
<p><a class="reference external" href="#virtel-web-modernisation">1.2 VIRTEL Web Modernisation 150</a></p>
<p><a class="reference external" href="#virtel-scenarios">1.2.1 VIRTEL Scenarios 150</a></p>
<p><a class="reference external" href="#virtel-web-integration">1.3 VIRTEL Web Integration 234</a></p>
<p><a class="reference external" href="#virtel-web-integration-scenarios">1.3.1 VIRTEL Web Integration scenarios
234</a></p>
<p><a class="reference external" href="#incoming-e-mails">1.4 Incoming E-mails 253</a></p>
<p><a class="reference external" href="#rules-of-the-smtp-line">1.4.1 Rules of the SMTP line 253</a></p>
<p><a class="reference external" href="#file-transfer-by-e-mail">1.4.2 File transfer by e-mail 254</a></p>
<p><a class="reference external" href="#starting-an-application-by-e-mail">1.4.3 Starting an application by e-mail
255</a></p>
<p><a class="reference external" href="#virtel-batch">1.5 VIRTEL Batch 257</a></p>
<p><a class="reference external" href="#assembling-the-virtct-for-virtel-batch">1.5.1 Assembling the VIRTCT for VIRTEL Batch
258</a></p>
<p><a class="reference external" href="#building-the-configuration-file-for-virtel-batch">1.5.2 Building the configuration file for VIRTEL Batch
259</a></p>
<p><a class="reference external" href="#allocating-the-page-template-file-for-virtel-batch">1.5.3 Allocating the page template file for VIRTEL Batch
260</a></p>
<p><a class="reference external" href="#allocating-work-files-for-virtel-batch">1.5.4 Allocating work files for VIRTEL Batch
261</a></p>
<p><a class="reference external" href="#running-the-virtel-batch-job">1.5.5 Running the VIRTEL Batch job
262</a></p>
<p><a class="reference external" href="#virtel-batch-commands">1.5.6 VIRTEL Batch commands 263</a></p>
<p><a class="reference external" href="#virtel-batch-return-codes">1.5.7 VIRTEL Batch return codes 265</a></p>
<p><a class="reference external" href="#outgoing-calls">2 Outgoing Calls 266</a></p>
<p><a class="reference external" href="#outgoing-e-mails">2.1 Outgoing E-mails 266</a></p>
<p><a class="reference external" href="#programming-interfaces">3 Programming Interfaces 267</a></p>
<p><a class="reference external" href="#introduction-2">3.1 Introduction 267</a></p>
<p><a class="reference external" href="#structured-fields">3.1.1 Structured fields 267</a></p>
<p><a class="reference external" href="#how-to-determine-if-running-under-virtel">3.1.2 How to determine if running under VIRTEL
269</a></p>
<p><a class="reference external" href="#virtel-web-integration-1">3.2 VIRTEL Web Integration 272</a></p>
<p><a class="reference external" href="#fa88-transmit-large-data-message-to-application">3.2.1 FA88: Transmit large data message to application
272</a></p>
<p><a class="reference external" href="#fac8-selection-of-page-template">3.2.2 FAC8: Selection of page template
273</a></p>
<p><a class="reference external" href="#fae5-fae6-sending-a-table-variable">3.2.3 FAE5, FAE6: Sending a table variable
275</a></p>
<p><a class="reference external" href="#call-interfaces">3.2.4 Call interfaces 277</a></p>
<p><a class="reference external" href="#host4web-commands">3.2.5 HOST4WEB commands 287</a></p>
<p><a class="reference external" href="#e-mail">3.3 E-mail 290</a></p>
<p><a class="reference external" href="#fac8-retrieve-data-from-an-e-mail">3.3.1 FAC8: Retrieve data from an e-mail
290</a></p>
<p><a class="reference external" href="#fad4-sending-an-e-mail-from-a-host-application">3.3.2 FAD4: Sending an e-mail from a host application
294</a></p>
<p><a class="reference external" href="#security-2">4 Security 297</a></p>
<p><a class="reference external" href="#virtel-web-access-security">4.1 VIRTEL Web Access Security 297</a></p>
<p><a class="reference external" href="#introduction-3">4.1.1 Introduction 297</a></p>
<p><a class="reference external" href="#technical-characteristics">4.1.2 Technical characteristics 297</a></p>
<p><a class="reference external" href="#howto-information">5 HOWTO information 304</a></p>
<p><a class="reference external" href="#web-access-howto">5.1 Web Access HOWTO 304</a></p>
<p><a class="reference external" href="#how-to-use-different-screen-sizes">5.1.1 How to use different screen sizes
304</a></p>
<p><a class="reference external" href="#how-to-override-the-codepage-by-url-parameter">5.1.2 How to override the codepage by URL parameter
307</a></p>
<p><a class="reference external" href="#how-to-handle-host-session-termination">5.1.3 How to handle host session termination
308</a></p>
<p><a class="reference external" href="#how-to-access-a-host-application-directly">5.1.4 How to access a host application directly
310</a></p>
<p><a class="reference external" href="#how-to-change-the-font-for-web-access">5.1.5 How to change the font for Web Access
311</a></p>
<p><a class="reference external" href="#how-to-customize-the-enter-key-settings">5.1.6 How to customize the Enter key settings
311</a></p>
<p><a class="reference external" href="#how-to-change-the-default-user-settings">5.1.7 How to change the default user settings
311</a></p>
<p><a class="reference external" href="#how-to-define-a-reverse-proxy">5.1.8 How to define a reverse proxy
312</a></p>
<p><a class="reference external" href="#how-to-support-virtual-hosting">5.1.9 How to support virtual hosting
312</a></p>
<p><a class="reference external" href="#index">Index 313</a></p>
</div>
<div class="section" id="list-of-figures">
<h2>List of figures<a class="headerlink" href="#list-of-figures" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="#_Toc373484969">Figure 1‑1 Transactions under entry point WEB2HOST
13</a></p>
<p><a class="reference external" href="#_Toc373484970">Figure 1‑2 Example of a directory transaction 14</a></p>
<p><a class="reference external" href="#_Toc373484971">Figure 1‑3 Example of a default transaction with default URL
15</a></p>
<p><a class="reference external" href="#_Toc373484972">Figure 1‑4 Custom Javascript function to generate a VirtelSession
cookie 19</a></p>
<p><a class="reference external" href="#_Toc373484973">Figure 1‑5 Directory management summary screen 23</a></p>
<p><a class="reference external" href="#_Toc373484974">Figure 1‑6 Directory management detail screen 24</a></p>
<p><a class="reference external" href="#_Toc373484975">Figure 1‑7 Directory contents management screen 25</a></p>
<p><a class="reference external" href="#_Toc373484976">Figure 1‑8 Example set of ON-ATTRIBUTE and ON-END-OF-ATTRIBUTE tags
41</a></p>
<p><a class="reference external" href="#_Toc373484977">Figure 1‑9 Example set of ADD-TO-FIELDS tags 42</a></p>
<p><a class="reference external" href="#_Toc373484978">Figure 1‑10 Example styles for ADD-TO-FIELDS tags
43</a></p>
<p><a class="reference external" href="#_Toc373484979">Figure 1‑11 Function key values for pfkField 48</a></p>
<p><a class="reference external" href="#_Toc373484980">Figure 1‑12 Exampleof a JSON structure generated by TRACING-SCENARIO
63</a></p>
<p><a class="reference external" href="#_Toc373484981">Figure 1‑13 Country Codes for EBCDIC to ASCII translation
69</a></p>
<p><a class="reference external" href="#_Toc373484982">Figure 1‑14 Summary of correspondents 82</a></p>
<p><a class="reference external" href="#_Toc373484983">Figure 1‑15 Correspondent detail screen (e-mail correspondent)
82</a></p>
<p><a class="reference external" href="#_Toc373484984">Figure 1‑16 Correspondent detail screen (local correspondent)
83</a></p>
<p><a class="reference external" href="#_Toc373484985">Figure 1‑17 Page upload by SMTP: Creating an e-mail correspondent
85</a></p>
<p><a class="reference external" href="#_Toc373484986">Figure 1‑18 Page upload by SMTP&nbsp;: activation e-mail
86</a></p>
<p><a class="reference external" href="#_Toc373484987">Figure 1‑19 Page upload by SMTP&nbsp;: upload response e-mail
86</a></p>
<p><a class="reference external" href="#_Toc373484988">Figure 1‑20 Page upload by HTTP with cookie&nbsp;: Creating the ‘upload’
transaction 87</a></p>
<p><a class="reference external" href="#_Toc373484989">Figure 1‑21 Page upload by HTTP with cookie&nbsp;: Creating the e-mail
correspondent 88</a></p>
<p><a class="reference external" href="#_Toc373484990">Figure 1‑22 Page upload by HTTP with cookie&nbsp;: Creating rule UPLOAD1B
88</a></p>
<p><a class="reference external" href="#_Toc373484991">Figure 1‑23 Page upload by HTTP with cookie&nbsp;: Rules of the HTTP line
89</a></p>
<p><a class="reference external" href="#_Toc373484992">Figure 1‑24 Page upload by HTTP with cookie&nbsp;: activation e-mail
90</a></p>
<p><a class="reference external" href="#_Toc373484993">Figure 1‑25 Page upload by HTTP with cookie&nbsp;: Displaying the upload.htm
page 90</a></p>
<p><a class="reference external" href="#_Toc373484994">Figure 1‑26 Page upload by HTTP with cookie&nbsp;: File selection dialog
91</a></p>
<p><a class="reference external" href="#_Toc373484995">Figure 1‑27 Page upload by HTTP with cookie&nbsp;: Sending the file
91</a></p>
<p><a class="reference external" href="#_Toc373484996">Figure 1‑28 Page upload by HTTP with cookie&nbsp;: Confirmation of file
uploadr 92</a></p>
<p><a class="reference external" href="#_Toc373484997">Figure 1‑29 Page upload by HTTP with signon&nbsp;: Transaction ‘dirlist’
93</a></p>
<p><a class="reference external" href="#_Toc373484998">Figure 1‑30 Page upload by HTTP with signon&nbsp;: Transactions ‘uplxxx’
94</a></p>
<p><a class="reference external" href="#_Toc373484999">Figure 1‑31 Page upload by HTTP with signon&nbsp;: Entering the userid and
password 95</a></p>
<p><a class="reference external" href="#_Toc373485000">Figure 1‑32 Page upload by HTTP with signon&nbsp;: Displaying the
upload4.htm page 96</a></p>
<p><a class="reference external" href="#_Toc373485001">Figure 1‑33 Page upload by HTTP with signon&nbsp;: File selection dialog
96</a></p>
<p><a class="reference external" href="#_Toc373485002">Figure 1‑34 Page upload by HTTP with signon&nbsp;: Sending the file
97</a></p>
<p><a class="reference external" href="#_Toc373485003">Figure 1‑35 Page upload by HTTP with signon&nbsp;: Confirmation of file
upload 98</a></p>
<p><a class="reference external" href="#_Toc373485004">Figure 1‑36 Drag and drop upload interface 99</a></p>
<p><a class="reference external" href="#_Toc373485005">Figure 1‑37 Displaying upload results 100</a></p>
<p><a class="reference external" href="#_Toc373485006">Figure 1‑38 Upload summary report 101</a></p>
<p><a class="reference external" href="#_Toc373485007">Figure 1‑39 VIRTEL Web Access Settings menu (part 1 of 3)
106</a></p>
<p><a class="reference external" href="#_Toc373485008">Figure 1‑40 VIRTEL Web Access Settings menu (part 2 of 3)
107</a></p>
<p><a class="reference external" href="#_Toc373485009">Figure 1‑41 VIRTEL Web Access Settings menu (part 3 of 3)
108</a></p>
<p><a class="reference external" href="#_Toc373485010">Figure 1‑42 w2hparm.js: Default settings for VIRTEL Web Access
113</a></p>
<p><a class="reference external" href="#_Toc373485011">Figure 1‑43 w2hparm.js: List of keywords and possible values
115</a></p>
<p><a class="reference external" href="#_Toc373485012">Figure 1‑44 w2hparm.js: Hiding VIRTEL Web Access settings
115</a></p>
<p><a class="reference external" href="#_Toc373485013">Figure 1‑45 Application selection menu 116</a></p>
<p><a class="reference external" href="#_Toc373485014">Figure 1‑46 Definition of applist transaction 118</a></p>
<p><a class="reference external" href="#_Toc373485015">Figure 1‑47 Specifying the application selection menu in the default
transaction 119</a></p>
<p><a class="reference external" href="#_Toc373485016">Figure 1‑48 VIRTEL definition of LUTYPE1 virtual printers
120</a></p>
<p><a class="reference external" href="#_Toc373485017">Figure 1‑49 VIRTEL definition of LUTYPE1 virtual printers
121</a></p>
<p><a class="reference external" href="#_Toc373485018">Figure 1‑50 VIRTEL terminal definitions for virtual printers
121</a></p>
<p><a class="reference external" href="#_Toc373485019">Figure 1‑51 Entry point definition for virtual printer autoconnect
122</a></p>
<p><a class="reference external" href="#_Toc373485020">Figure 1‑52 Transaction definition for virtual printer autoconnect
122</a></p>
<p><a class="reference external" href="#_Toc373485021">Figure 1‑53 VTAM definitions for virtual printers
123</a></p>
<p><a class="reference external" href="#_Toc373485022">Figure 1‑54 CICS TYPETERM definitions for virtual printers
123</a></p>
<p><a class="reference external" href="#_Toc373485023">Figure 1‑55 VIRTEL line definition for PCL2PDF server
124</a></p>
<p><a class="reference external" href="#_Toc373485024">Figure 1‑56 TSO transaction definition for file transfer
125</a></p>
<p><a class="reference external" href="#_Toc373485025">Figure 1‑57 VIRTEL Web Access toolbar for TSO file transfer
125</a></p>
<p><a class="reference external" href="#_Toc373485026">Figure 1‑58 VIRTEL IND$FILE receive dialog (part 1)
126</a></p>
<p><a class="reference external" href="#_Toc373485027">Figure 1‑59 VIRTEL IND$FILE receive dialog (part 2)
127</a></p>
<p><a class="reference external" href="#_Toc373485028">Figure 1‑60 VIRTEL IND$FILE receive dialog (part 3)
127</a></p>
<p><a class="reference external" href="#_Toc373485029">Figure 1‑61 VIRTEL IND$FILE receive dialog (part 4)
128</a></p>
<p><a class="reference external" href="#_Toc373485030">Figure 1‑62 VIRTEL IND$FILE send dialog (part 1)
129</a></p>
<p><a class="reference external" href="#_Toc373485031">Figure 1‑63 VIRTEL IND$FILE send dialog (part 2)
130</a></p>
<p><a class="reference external" href="#_Toc373485032">Figure 1‑64 VIRTEL IND$FILE send dialog (part 3)
131</a></p>
<p><a class="reference external" href="#_Toc373485033">Figure 1‑65 VIRTEL IND$FILE send dialog (part 4)
132</a></p>
<p><a class="reference external" href="#_Toc373485034">*Figure 1‑66 VIRTEL IND$FILE receive dialog (saved transfers)*
133</a></p>
<p><a class="reference external" href="#_Toc373485035">*Figure 1‑67 Saving the file transfer parameters*
133</a></p>
<p><a class="reference external" href="#_Toc373485036">Figure 1‑68 VTAM logon screen in VIRTEL Web Access mode
134</a></p>
<p><a class="reference external" href="#_Toc373485037">Figure 1‑69 Example VIRTEL transaction for VTAM logon via Web Access
135</a></p>
<p><a class="reference external" href="#_Toc373485038">Figure 1‑70 Example custom.css for coloring the toolbar according to
CICS region 136</a></p>
<p><a class="reference external" href="#_Toc373485039">Figure 1‑71 Web Access screen with yellow toolbar for SPCICSP
137</a></p>
<p><a class="reference external" href="#_Toc373485040">Figure 1‑72 Web Access screen with pink toolbar for SPCICSQ
137</a></p>
<p><a class="reference external" href="#_Toc373485041">Figure 1‑73 Example custom.css for adding custom text to the toolbar
137</a></p>
<p><a class="reference external" href="#_Toc373485042">Figure 1‑74 Web Access screen with custom text in the toolbar
138</a></p>
<p><a class="reference external" href="#_Toc373485043">Figure 1‑75 Example custom.css for hiding the toolbar
138</a></p>
<p><a class="reference external" href="#_Toc373485044">Figure 1‑76 Example custom.css for modifying the 3270 colors
138</a></p>
<p><a class="reference external" href="#_Toc373485045">Figure 1‑77 Example custom.css for displaying company logo in the
toolbar 139</a></p>
<p><a class="reference external" href="#_Toc373485046">Figure 1‑78 Example custom.css for replacing the Virtel logo by a
company logo 139</a></p>
<p><a class="reference external" href="#_Toc373485047">Figure 1‑79 Example custom.js to customize the toolbar icons
142</a></p>
<p><a class="reference external" href="#_Toc373485048">Figure 1‑80 Example custom.js to remove selected toolbar icons
142</a></p>
<p><a class="reference external" href="#_Toc373485049">Figure 1‑81 Example custom.js to modify the text of the status bar
143</a></p>
<p><a class="reference external" href="#_Toc373485050">Figure 1‑82 Example custom.js to modify PF key hotspot recognition
143</a></p>
<p><a class="reference external" href="#_Toc373485051">Figure 1‑83 Example custom.js to add a watermark to the Web Access 3270
screen 143</a></p>
<p><a class="reference external" href="#_Toc373485052">Figure 1‑84 Example custom.css to define the style of the watermark
144</a></p>
<p><a class="reference external" href="#_Toc373485053">Figure 1‑85 Web Access screen with application name as watermark
144</a></p>
<p><a class="reference external" href="#_Toc373485054">Figure 1‑86 Example custom.js to modify Settings values
145</a></p>
<p><a class="reference external" href="#_Toc373485055">Figure 1‑87 Standard help page for Web Access 146</a></p>
<p><a class="reference external" href="#_Toc373485056">Figure 1‑88 custom.js to activate the VirtelMacros function
148</a></p>
<p><a class="reference external" href="#_Toc373485057">Figure 1‑89 Display macros for VirtelMacros function
148</a></p>
<p><a class="reference external" href="#_Toc373485058">Figure 1‑90 Example of a macros.json file 149</a></p>
<p><a class="reference external" href="#_Toc373485059">Figure 1‑91 Example of an empty macros.json file
149</a></p>
<p><a class="reference external" href="#_Toc373485060">Figure 1‑92 HTTP presentation module: List of values for input field
223</a></p>
<p><a class="reference external" href="#_Toc373485061">Figure 1‑93 HTTP presentation module: Clickable fields using DECLARE$
224</a></p>
<p><a class="reference external" href="#_Toc373485062">Figure 1‑94 HTTP presentation module: Defining calendar fields
225</a></p>
<p><a class="reference external" href="#_Toc373485063">Figure 1‑95 HTML page template for calendar fields
226</a></p>
<p><a class="reference external" href="#_Toc373485064">Figure 1‑96 HTTP presentation module: Defining VIRTEL Suggest fields
227</a></p>
<p><a class="reference external" href="#_Toc373485065">Figure 1‑97 HTML page template for VIRTEL Suggest fields
229</a></p>
<p><a class="reference external" href="#_Toc373485066">Figure 1‑98 HTTP presentation module: 3270 auto-refresh
230</a></p>
<p><a class="reference external" href="#_Toc373485067">Figure 1‑99 Settings for 3270 auto-refresh 231</a></p>
<p><a class="reference external" href="#_Toc373485068">Figure 1‑100 HTML page template for 3270 auto-refresh
231</a></p>
<p><a class="reference external" href="#_Toc373485069">Figure 1‑101 HTTP presentation module: PDF output generation
232</a></p>
<p><a class="reference external" href="#_Toc373485070">Figure 1‑102 MakePDF INPUT.TXT file for PDF generation
232</a></p>
<p><a class="reference external" href="#_Toc373485071">Figure 1‑103 MakePDF DOCOPT.TXT file for PDF generation
233</a></p>
<p><a class="reference external" href="#_Toc373485072">Figure 1‑104 MakePDF LAYOUT.TXT file for PDF generation
233</a></p>
<p><a class="reference external" href="#_Toc373485073">Figure 1‑105 HTML form for generating Query input data (GET method)
234</a></p>
<p><a class="reference external" href="#_Toc373485074">Figure 1‑106 Example HTTP request with Query data (GET method)
234</a></p>
<p><a class="reference external" href="#_Toc373485075">Figure 1‑107 Example HTTP request with Query data (POST method)
235</a></p>
<p><a class="reference external" href="#_Toc373485076">Figure 1‑108 HTTP presentation module for Query input data
235</a></p>
<p><a class="reference external" href="#_Toc373485077">Figure 1‑109 Commarea generated from Query data 235</a></p>
<p><a class="reference external" href="#_Toc373485078">Figure 1‑110 VIRTEL transaction definition for Query input data
236</a></p>
<p><a class="reference external" href="#_Toc373485079">Figure 1‑111 Example HTTP request with XML input data
237</a></p>
<p><a class="reference external" href="#_Toc373485080">Figure 1‑112 HTTP presentation module for XML input data
237</a></p>
<p><a class="reference external" href="#_Toc373485081">Figure 1‑113 Commarea generated from XML input data
238</a></p>
<p><a class="reference external" href="#_Toc373485082">Figure 1‑114 HTML form with XML input data embedded in a text field
238</a></p>
<p><a class="reference external" href="#_Toc373485083">Figure 1‑115 XML input data in URL-encoded format (HTTP GET method)
238</a></p>
<p><a class="reference external" href="#_Toc373485084">Figure 1‑116 XML input data in URL-encoded format (HTTP POST method)
239</a></p>
<p><a class="reference external" href="#_Toc373485085">Figure 1‑117 VIRTEL transaction definition for XML input data
239</a></p>
<p><a class="reference external" href="#_Toc373485086">Figure 1‑118 Example XML input data with attributes and repeating
groups 240</a></p>
<p><a class="reference external" href="#_Toc373485087">Figure 1‑119 Presentation module for XML input with attributes and
repeating groups 240</a></p>
<p><a class="reference external" href="#_Toc373485088">Figure 1‑120 Commarea generated from XML input with attributes and
repeating groups 240</a></p>
<p><a class="reference external" href="#_Toc373485089">Figure 1‑121 Example XML input data with redefinition of fields
241</a></p>
<p><a class="reference external" href="#_Toc373485090">Figure 1‑122 Presentation module for XML input with redefinition of
fields 242</a></p>
<p><a class="reference external" href="#_Toc373485091">Figure 1‑123 Commarea generated from XML input with redefinition of
fields 242</a></p>
<p><a class="reference external" href="#_Toc373485092">Figure 1‑124 HTTP presentation module for XML output
243</a></p>
<p><a class="reference external" href="#_Toc373485093">Figure 1‑125 Example page template for XML output data
244</a></p>
<p><a class="reference external" href="#_Toc373485094">Figure 1‑126 MAP$ statements for VIRTEL XML parser/generator
245</a></p>
<p><a class="reference external" href="#_Toc373485095">Figure 1‑127 VIRTEL transaction definition for XML-to-commarea
conversion 246</a></p>
<p><a class="reference external" href="#_Toc373485096">Figure 1‑128 Initial scenario for XML-to-commarea conversion
246</a></p>
<p><a class="reference external" href="#_Toc373485097">Figure 1‑129 Input request for XML-to-commarea conversion
247</a></p>
<p><a class="reference external" href="#_Toc373485098">Figure 1‑130 Page template for XML-to-commarea conversion
247</a></p>
<p><a class="reference external" href="#_Toc373485099">Figure 1‑131 Output response from XML-to-commarea conversion
247</a></p>
<p><a class="reference external" href="#_Toc373485100">Figure 1‑132 VIRTEL transaction definition for commarea-to-XML
conversion 248</a></p>
<p><a class="reference external" href="#_Toc373485101">Figure 1‑133 Initial scenario for commarea-to-XML conversion
248</a></p>
<p><a class="reference external" href="#_Toc373485102">Figure 1‑134 Input request for commarea-to-XML conversion
248</a></p>
<p><a class="reference external" href="#_Toc373485103">Figure 1‑135 Page template for commarea-to-XML conversion
249</a></p>
<p><a class="reference external" href="#_Toc373485104">Figure 1‑136 Output response from commarea-to-XML conversion
249</a></p>
<p><a class="reference external" href="#_Toc373485105">Figure 1‑137 Automatic scenario generation: MAPGJCL job
250</a></p>
<p><a class="reference external" href="#_Toc373485106">Figure 1‑138 Rule for routing an incoming e-mail on an SMTP line
253</a></p>
<p><a class="reference external" href="#_Toc373485107">Figure 1‑139 Entry point for file transfer by SMTP
254</a></p>
<p><a class="reference external" href="#_Toc373485108">Figure 1‑140 Transaction for file transfer by SMTP
254</a></p>
<p><a class="reference external" href="#_Toc373485109">Figure 1‑141 Entry point for application started by SMTP
255</a></p>
<p><a class="reference external" href="#_Toc373485110">Figure 1‑142 Transaction for application started by SMTP
255</a></p>
<p><a class="reference external" href="#_Toc373485111">Figure 1‑143 CICS definitions for application started by e-mail
256</a></p>
<p><a class="reference external" href="#_Toc373485112">Figure 1‑144 Example VIRTCT for VIRTEL Batch 258</a></p>
<p><a class="reference external" href="#_Toc373485113">Figure 1‑145 Job to build configuration file for VIRTEL Batch
259</a></p>
<p><a class="reference external" href="#_Toc373485114">Figure 1‑146 Job to allocate page template file for VIRTEL Batch
260</a></p>
<p><a class="reference external" href="#_Toc373485115">Figure 1‑147 Job to allocate work files for VIRTEL Batch
261</a></p>
<p><a class="reference external" href="#_Toc373485116">Figure 1‑148 Example JCL for VIRTEL Batch 262</a></p>
<p><a class="reference external" href="#_Toc373485117">Figure 1‑149 Example VIRTEL Batch GET commands 263</a></p>
<p><a class="reference external" href="#_Toc373485118">Figure 1‑150 Example VIRTEL Batch GET requests 263</a></p>
<p><a class="reference external" href="#_Toc373485119">Figure 1‑151 Example VIRTEL Batch POST command 264</a></p>
<p><a class="reference external" href="#_Toc373485120">Figure 1‑152 Example VIRTEL Batch POST request 264</a></p>
<p><a class="reference external" href="#_Toc373485121">Figure 1‑153 Example VIRTEL Batch RAW command 265</a></p>
<p><a class="reference external" href="#_Toc373485122">Figure 2‑1 Transaction definition for outgoing e-mails
266</a></p>
<p><a class="reference external" href="#_Toc373485123">Figure 3‑1 Defining an alternate CICS transaction code for an
application 269</a></p>
<p><a class="reference external" href="#_Toc373485124">Figure 3‑2 Invoking the alternate transaction code from VIRTEL
269</a></p>
<p><a class="reference external" href="#_Toc373485125">Figure 3‑3 Detecting VIRTEL by testing the transaction code
269</a></p>
<p><a class="reference external" href="#_Toc373485126">Figure 3‑4 Invoking a CICS transaction with additional parameters
270</a></p>
<p><a class="reference external" href="#_Toc373485127">Figure 3‑5 Detecting VIRTEL by inspecting the contents of the TIOA
270</a></p>
<p><a class="reference external" href="#_Toc373485128">Figure 3‑6 Defining the VIRTEL terminal pool 271</a></p>
<p><a class="reference external" href="#_Toc373485129">Figure 3‑7 VTAM definition for the VIRTEL terminal pool
271</a></p>
<p><a class="reference external" href="#_Toc373485130">Figure 3‑8 Detecting VIRTEL by testing the CICS terminal id
271</a></p>
<p><a class="reference external" href="#_Toc373485131">Figure 3‑9 Detecting VIRTEL by testing the VTAM LU name
271</a></p>
<p><a class="reference external" href="#_Toc373485132">Figure 3‑10 Format of structured field FA88 272</a></p>
<p><a class="reference external" href="#_Toc373485133">Figure 3‑11 Format of structured field response FA88
272</a></p>
<p><a class="reference external" href="#_Toc373485134">Figure 3‑12 Format of structured field FAC8 code 06
273</a></p>
<p><a class="reference external" href="#_Toc373485135">Figure 3‑13 Format of structured field FAC8 code 07
273</a></p>
<p><a class="reference external" href="#_Toc373485136">Figure 3‑14 Example of sending structured field FAC8
274</a></p>
<p><a class="reference external" href="#_Toc373485137">Figure 3‑15 Format of structured field FAE5 – format 1
275</a></p>
<p><a class="reference external" href="#_Toc373485138">Figure 3‑16 Format of structured field FAE5 – format 2
275</a></p>
<p><a class="reference external" href="#_Toc373485139">Figure 3‑17 Example of sending structured field FAE5
276</a></p>
<p><a class="reference external" href="#_Toc373485140">Figure 3‑18 Example of VIRTEL Web Integration application using CALL
VIRSETA 278</a></p>
<p><a class="reference external" href="#_Toc373485141">Figure 3‑19 Example of VIRTEL Web Integration application using CALL
VIRSETV 280</a></p>
<p><a class="reference external" href="#_Toc373485142">Figure 3‑20 Example of VIRTEL Web Integration application using CALL
VIRSETAI 282</a></p>
<p><a class="reference external" href="#_Toc373485143">Figure 3‑21 Example of VIRTEL Web Integration application using CALL
VIRSETVI 283</a></p>
<p><a class="reference external" href="#_Toc373485144">Figure 3‑22 Example of VIRTEL Web Integration application using CALL
VIRTEL 285</a></p>
<p><a class="reference external" href="#_Toc373485145">Figure 3‑23 Format of structured field FAC8 code 12
290</a></p>
<p><a class="reference external" href="#_Toc373485146">Figure 3‑24 Format of the response to structured field FAC8 code 12
290</a></p>
<p><a class="reference external" href="#_Toc373485147">Figure 3‑25 Format of structured field FAC8 code 13
291</a></p>
<p><a class="reference external" href="#_Toc373485148">Figure 3‑26 Format of the response to structured field FAC8 code 13
291</a></p>
<p><a class="reference external" href="#_Toc373485149">Figure 3‑27 Example of sending structured field FAC8 code 12 and 13
293</a></p>
<p><a class="reference external" href="#_Toc373485150">Figure 3‑28 Format of structured field FAD4 294</a></p>
<p><a class="reference external" href="#_Toc373485151">Figure 3‑29 Example of sending structured field FAD4
295</a></p>
<p><a class="reference external" href="#_Toc373485152">Figure 3‑30 Example of e-mail generated by structured field FAD4
296</a></p>
<p><a class="reference external" href="#_Toc373485153">Figure 4‑1 Example of signon dialog box displayed by browser
298</a></p>
<p><a class="reference external" href="#_Toc373485154">Figure 4‑2 CRYPTn parameter for password encryption using WEB2AJAX.htm
300</a></p>
<p><a class="reference external" href="#_Toc373485155">Figure 4‑3 HTML security: Example transaction with security type 4
300</a></p>
<p><a class="reference external" href="#_Toc373485156">Figure 4‑4 HTML security: Example page template 301</a></p>
<p><a class="reference external" href="#_Toc373485157">Figure 4‑5 HTTP security by rule: List of rules 302</a></p>
<p><a class="reference external" href="#_Toc373485158">Figure 4‑6 HTTP security by rule: Users authorized by cookie
302</a></p>
<p><a class="reference external" href="#_Toc373485159">Figure 4‑7 HTTP security by rule: Internal network, working hours
303</a></p>
<p><a class="reference external" href="#_Toc373485160">Figure 4‑8 HTTP security by rule: Other users 303</a></p>
<p><a class="reference external" href="#_Toc373485161">Figure 5‑1 Example of TSO transaction TSO specifying logmode SNX32705
305</a></p>
<p><a class="reference external" href="#_Toc373485162">Figure 5‑2 VTAM definition of terminal groups 305</a></p>
<p><a class="reference external" href="#_Toc373485163">Figure 5‑3 Example rule for selection of logmode by URL
306</a></p>
<p><a class="reference external" href="#_Toc373485164">Figure 5‑4 Definition of model 5 terminals in the W2HPOOL pool
306</a></p>
<p><a class="reference external" href="#_Toc373485165">Figure 5‑5 Example of entry point with last page
309</a></p>
<p><a class="reference external" href="#_Toc373485166">Figure 5‑6 Example of default URL 310</a></p>
</div>
<div class="section" id="incoming-calls">
<h2>Incoming Calls<a class="headerlink" href="#incoming-calls" title="Permalink to this headline">¶</a></h2>
<div class="section" id="virtel-web-access">
<h3>VIRTEL Web Access<a class="headerlink" href="#virtel-web-access" title="Permalink to this headline">¶</a></h3>
<div class="section" id="introduction">
<h4>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h4>
<div class="section" id="virtel-web-access-vwa">
<h5>VIRTEL Web Access (VWA)<a class="headerlink" href="#virtel-web-access-vwa" title="Permalink to this headline">¶</a></h5>
<p>VIRTEL Web Access, formerly known as “Web-to-Host” (W2H), is a set of
functions which enable information produced by host applications to be
presented in an Internet browser.</p>
<p>The principle of operation of this program relies on the production of
HTML pages stored in a directory at the host site containing standard
tags and also tags specific to VIRTEL. Invoked by a browser or a
program, these pages form the basis of translation “on the fly” of the
specific tags, thus enabling the dynamic generation of pages sent to the
browser. The VWA model also includes functions which allow dynamic
modification of the presentation of the 3270 screens in an HTML page,
with the aim of making the interface as “clickable” as possible. This
chapter describes the set of functions required to support this function
and presupposes a certain knowledge of the development of HTML pages.</p>
<p>Some fundamental principles must be taken into consideration:</p>
<ol class="arabic simple">
<li>Sessions between a browser and an HTTP server are in disconnected
mode, while they are in connected mode between VIRTEL and the host
application.</li>
<li>The flow of information between an HTTP server and a client’s browser
always occurs on the initiative of the client.</li>
<li>A single request from the browser will only invoke a single response
from the HTTP server, while the transmission of a message to an
application on the host may generate several response messages at
once (for example, a message to clear the screen followed by a new
screen image).</li>
</ol>
<p>These differences give rise to a need to ensure maintenance of session
context between a client and a host application. This is done by the
SESSION-CODE tag embedded in each template page.</p>
<p>Although the HTML pages used to display 3270 data contain specific
VIRTEL tags, these pages can be developed using standard web development
tools. The pages containing VIRTEL specific tags are stored in a VIRTEL
directory along with any images and other elements required.</p>
</div>
<div class="section" id="virtel-web-modernisation-vwm">
<h5>VIRTEL Web Modernisation (VWM)<a class="headerlink" href="#virtel-web-modernisation-vwm" title="Permalink to this headline">¶</a></h5>
<p>VIRTEL Web Modernisation, formerly known as “Host-Web-Services” (HWS),
allows the presentation of host applications to be modified, without
modifying the application itself. The presentation can be adapted to a
format (HTML, XML, Excel, etc) suited to the requester, while hiding the
details of navigation within the 3270 transactions.</p>
<p>This function is implemented through a combination of the VIRTEL Web
Access functions described in “Creating HTML and XML template pages” sur
la page 27 and the “scenario language” described in “Web-to-Host
Scenarios” sur la page 115.</p>
<p>VIRTEL Web Modernisation allows “frozen” or “untouchable” 3270
transactions to be accessed by intermediate servers (n-tier
architecture) or from a browser, while hiding the details of navigation
within the transactions. Variable input data for the transaction can
either be included in the URL (GET method), or sent as data with the
HTTP request (POST method).</p>
</div>
<div class="section" id="virtel-web-integration-vwi">
<h5>VIRTEL Web Integration (VWI)<a class="headerlink" href="#virtel-web-integration-vwi" title="Permalink to this headline">¶</a></h5>
<p>The objective of VIRTEL Web Integration, formerly known as
“Host-for-Web” (H4W), is to allow a host application to take maximum
control of its web interface. This is in complete contrast to VWA/VWM,
whose objective is to avoid modification of host applications.</p>
<p>To control its web interface, an application has at its disposal
primarily the 3270 screen, the VIRTEL table variable facility, the HTML
page template, and a set of VIRTEL commands contained in structured
fields. Additionally, for browser requests which enter VIRTEL using an
entry point which specifies emulation type “HOST4WEB”, the application
can also use a set of VIRTEL control commands which can be embedded in
the 3270 screen via a BMS map, ISPF panel, or 3270 datastream. These
HOST4WEB commands, available from VIRTEL version 4.28 onwards, provide
the same general functions as the structured field commands in earlier
versions.</p>
<p>Table variables, structured field commands, and HOST4WEB commands, are
sent by the application to the 3270 session using standard methods (EXEC
CICS SEND, ISPEXEC DISPLAY PANEL, TSO TPUT, etc). VIRTEL intercepts and
acts upon these commands, for example by selecting the page template or
loading data which can be referenced by VIRTEL orders embedded in the
page templates and used to build lists of values or data tables.</p>
<p>For more information, refer to the VIRTEL Programming Interface
documentation sur la page 267.</p>
</div>
<div class="section" id="service-transactions">
<h5>Service Transactions<a class="headerlink" href="#service-transactions" title="Permalink to this headline">¶</a></h5>
<p>A <em>Service Transaction</em> is a long-running VIRTEL transaction which
maintains a session with a host application and uses this session to
serve a series of HTTP request / responses. Unlike a regular HTTP
transaction, which serves requests only from its originating user,
identified by a specific VIRTEL SESSION-CODE, a service transaction can
serve a different user each time it processes an HTTP request. Service
transactions are typically used to provide fast access to public
information such as the lists of field values displayed by the “VIRTEL
Suggest” feature.</p>
<p>A service transaction is started by an HTTP URL in exactly the same way
as a regular transaction, but when it has finished processing its first
HTTP request, it indicates its readiness to serve another user, either
by means of the script command &amp;) described under the heading
“Transactions — Connection / Disconnection Scripts” in the VIRTEL
Connectivity Reference documentation, or by means of the ACTION$
SERVE-ANOTHER-USER command in a scenario (see “Dynamic modification of
3270 screen presentation” sur la page 154).</p>
<p>A service transaction remains connected to the host application between
input messages. It is then eligible to process any HTTP request which
specifies the same entry point and transaction name. Since service
transactions can potentially be used by many different users, a typical
service transaction will provide information which is not sensitive to
being signed-on as a particular user.</p>
</div>
</div>
<div class="section" id="virtel-url-formats">
<h4>VIRTEL URL formats<a class="headerlink" href="#virtel-url-formats" title="Permalink to this headline">¶</a></h4>
<div class="section" id="static-pages">
<h5>Static pages<a class="headerlink" href="#static-pages" title="Permalink to this headline">¶</a></h5>
<p>The general form of the URL for an HTML page stored in a VIRTEL
directory is:</p>
<p><a class="reference external" href="http://ipaddr:port/pathname/pagename">http://ipaddr:port/pathname/pagename</a></p>
<ul class="simple">
<li><em>ipaddr</em>:<em>port</em> corresponds to the “Local ident” field of an HTTP
line defined to VIRTEL. The rules of the line are used to select the
entry point. This entry point, which must specify emulation type
HTML, contains the list of transactions which the user is authorized
to invoke.</li>
<li><em>pathname</em> represents a VIRTEL directory containing HTML pages or
other elements. Refer to the section “How the path name corresponds
to a VIRTEL directory” below for details of how the pathname is used
to select the VIRTEL directory.</li>
<li><em>pagename</em> is the name of an element (HTML page, etc.) in the
specified directory. VIRTEL converts the element name to upper case
(unless “case sensitive” is specified in the directory definition),
and truncates the name if necessary to the maximum length specified
in the directory definition (see “Directory management” sur la page
20).</li>
</ul>
<p>VIRTEL also accepts certain abbreviated forms of the URL:</p>
<p><a class="reference external" href="http://ipaddr:port/pathname/">http://ipaddr:port/pathname/</a></p>
<ul class="simple">
<li><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</li>
<li><em>pathname</em> represents a VIRTEL directory, as described above. In this
case, VIRTEL loads a default page from this directory. The default
page name is the same as the entry point name. <em>Note: the trailing
slash is compulsory.</em></li>
</ul>
<p><a class="reference external" href="http://ipaddr:port/pagename">http://ipaddr:port/pagename</a></p>
<ul class="simple">
<li><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</li>
<li><em>pagename</em> is the name of a page to be loaded from the default
directory. The default directory corresponds to a default <em>pathname</em>
equal to the entry point name.</li>
</ul>
<p><a class="reference external" href="http://ipaddr:port">http://ipaddr:port</a></p>
<ul class="simple">
<li><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</li>
<li>In this case, VIRTEL loads the default URL. VIRTEL obtains the
default URL from the “TIOA at logon” field of the default
transaction. The default transaction is a type 4 transaction which
has the same name as the entry point. See example 7 below for an
example of a default URL. If the “TIOA at logon” field of the default
transaction is blank, then VIRTEL loads the default page from the
default directory. The default page has the same name as the entry
point, and the default directory corresponds to a default <em>pathname</em>
equal to the entry point name.</li>
</ul>
</div>
<div class="section" id="how-the-path-name-corresponds-to-a-virtel-directory">
<h5>How the path name corresponds to a VIRTEL directory<a class="headerlink" href="#how-the-path-name-corresponds-to-a-virtel-directory" title="Permalink to this headline">¶</a></h5>
<p>The <em>pathname</em> specified in a VIRTEL URL is used to select a VIRTEL
directory which contains HTML page templates and other elements such as
CSS stylesheets, JavaScript procedures, and GIF or JPEG images. VIRTEL
directories have a simple 8-character case-insensitive name, whereas the
<em>pathname</em> is expressed in Unix-style syntax (one or more case-sensitive
components separated by slashes)<em>,</em> as is conventional for web
applications. VIRTEL must therefore translate the Unix-style <em>pathname</em>
into a VIRTEL directory name.</p>
<p>The process of mapping a <em>pathname</em> to a VIRTEL directory name is
carried out by means of VIRTEL transactions which are defined under the
entry point selected for each request by the rules of the HTTP line. The
entry point contains both processing transactions (application types 1,
2, and 3) and directory transactions (application type 4).</p>
<p>To find the directory which corresponds to the <em>pathname,</em> VIRTEL looks
for a type 4 transaction whose external name matches the first component
of the <em>pathname</em>, and whose “Check URL prefix” field is either blank or
matches the start of the <em>pathname</em>. The name of the VIRTEL directory is
contained in the “Application name” field of the first such matching
transaction found under the entry point.</p>
<p><em>Notes:</em></p>
<ul class="simple">
<li>The comparison of the first component of the <em>pathname</em> with the
transaction external name is case insensitive, and if the first
component of the <em>pathname</em> is longer than 8 characters, only the
first 8 characters are compared.</li>
<li>The comparison of the beginning of the <em>pathname</em> against the
transaction’s “Check URL prefix” field is case sensitive.</li>
<li>The “Check URL prefix” field may contain “%20” to represent a blank
and “?” to ignore a character position.</li>
<li>If the “Check URL prefix” field is completely blank it is considered
to match any <em>pathname</em> whose first component matches the transaction
external name.</li>
</ul>
<div class="section" id="examples">
<h6>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h6>
<p>Assume that entry point WEB2HOST contains the following transactions:</p>
<p>LIST of TRANSACTIONS prefixed by: W2H &#8212;&#8212;&#8212;&#8211; Applid: SPVIRH2
17:53:47</p>
<p>Internal External Description Application</p>
<p>Name Name</p>
<p>W2H-00 WEB2HOST Default HTML directory (URL prefix blank) W2H-DIR</p>
<p>W2H-04 home User directory (URL prefix /home/user1) USER1DIR</p>
<p>W2H-05 home User directory (URL prefix /home/user2) USER2DIR</p>
<p>W2H-06 IMAGES All /images directories (URL prefix blank) W2H-DIR</p>
<p>W2H-10 cics CICS application DBDCCICS</p>
<p>W2H-20 tso TSO application TSO</p>
<p>Figure 1‑1 Transactions under entry point WEB2HOST</p>
<p>In this example, transactions W2H-00, W2H-04, W2H-05, and W2H-06 are
“application type 4” (directory transactions). Transactions W2H-10 and
W2H-20 are “application type 1” (processing transactions) and play no
part in the directory selection process.</p>
<p>The figure below shows an example of the detail of a directory
transaction:</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRH2
15:18:38</p>
<p>Internal name ===&gt; W2H-04 To associate with an entry point name</p>
<p>External name ===&gt; home Name displayed on user menu</p>
<p>Description ===&gt; User directory (URL prefix /home/user1)</p>
<p>Application ===&gt; USER1DIR Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 4 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; DELOC Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 2 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 0 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Check URL Prefix ===&gt; /home/user1</p>
<p>TIOA at logon ===&gt;</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑2 Example of a directory transaction</p>
<p>Example 1: Neither pathname nor pagename specified</p>
<p><a class="reference external" href="http://ipaddr:port">http://ipaddr:port</a></p>
<p>The <em>pathname</em> defaults to the entry point name, WEB2HOST, which matches
transaction W2H-00. The <em>pagename</em> also defaults to WEB2HOST. VIRTEL
therefore fetches page WEB2HOST from the directory W2H-DIR.</p>
<p>Example 2: Pagename specified</p>
<p><a class="reference external" href="http://ipaddr:port/menu.htm">http://ipaddr:port/menu.htm</a></p>
<p>The <em>pathname</em> defaults to the entry point name, WEB2HOST, which matches
transaction W2H-00. VIRTEL therefore fetches page menu.htm from the
directory W2H-DIR.</p>
<p>Example 3: Pathname specified</p>
<p><a class="reference external" href="http://ipaddr:port/home/user1/">http://ipaddr:port/home/user1/</a></p>
<p>The <em>pathname</em> /home/user1 matches transaction W2H-04. The <em>pagename</em>
defaults to the entry point name, WEB2HOST. VIRTEL therefore fetches
page WEB2HOST from the directory USER1DIR.</p>
<p>Example 4: Pathname and pagename specified</p>
<p><a class="reference external" href="http://ipaddr:port/home/user2/index.html">http://ipaddr:port/home/user2/index.html</a></p>
<p>The <em>pathname</em> /home/user2 matches transaction W2H-05. VIRTEL therefore
fetches page index.html from the directory USER2DIR.</p>
<p>Example 5: Undefined pathname specified</p>
<p><a class="reference external" href="http://ipaddr:port/home/user3/index.html">http://ipaddr:port/home/user3/index.html</a></p>
<p>In this case the <em>pathname</em> /home/user3 does not match any transaction.
VIRTEL therefore rejects the request.</p>
<p>Example 6: Partly-defined pathname specified</p>
<p><a class="reference external" href="http://ipaddr:port/images/misc/square.gif">http://ipaddr:port/images/misc/square.gif</a></p>
<p>The <em>pathname</em> /images/misc is not specifically defined to VIRTEL.
However there is a transaction W2H-06 whose external name is IMAGES and
whose “Check URL prefix” field is blank, which matches all pathnames
whose first component is /images. VIRTEL therefore fetches the page
square.gif from the directory W2H-DIR.</p>
<p>Example 7: Entry point with default URL</p>
<p>When a user connects to a VIRTEL line without specifying either
<em>pathname</em> or <em>pagename</em>, as in the example below, the entry point may
be configured to redirect the request to a default URL:</p>
<p><a class="reference external" href="http://ipaddr:port">http://ipaddr:port</a></p>
<p>A default URL may be specified in the transaction whose external name is
the same as the entry point name. In the example type 4 transaction
W2H-00 shown below, the default URL for the entry point WEB2HOST is
/w2h/WEB2VIRT.htm+Cics and thus the URL <em>http://ipaddr:port</em> is
processed by VIRTEL as if <em>http://ipaddr:port/w2h/WEB2VIRT.htm+Cics</em> had
been specified.</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRH2
15:19:57</p>
<p>Internal name ===&gt; W2H-00 To associate with an entry point name</p>
<p>External name ===&gt; WEB2HOST Name displayed on user menu</p>
<p>Description ===&gt; Répertoire des pages HTML - (Accés par défaut)</p>
<p>Application ===&gt; W2H-DIR Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 4 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; DELOC Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 2 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 0 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Check URL Prefix ===&gt;</p>
<p>TIOA at logon ===&gt; /w2h/WEB2VIRT.htm+Cics</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑3 Example of a default transaction with default URL</p>
</div>
</div>
<div class="section" id="dynamic-pages">
<h5>Dynamic pages<a class="headerlink" href="#dynamic-pages" title="Permalink to this headline">¶</a></h5>
<p>The general form of the URL for a VIRTEL Web Access, VIRTEL Web
Integration, or VIRTEL Web Modernisation transaction is:</p>
<p><a class="reference external" href="http://ipaddr:port/pathname/pagename+tranname">http://ipaddr:port/pathname/pagename+tranname</a></p>
<ul class="simple">
<li><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</li>
<li><em>pathname</em> represents a VIRTEL directory, as described earlier.</li>
<li><em>pagename</em> is the name of an element (HTML or XML) in the specified
directory. This name may be converted to upper case and truncated to
the maximum length defined in the directory definition, as previously
described. This element is used as the “template page” into which
VIRTEL inserts dynamic data.</li>
<li><em>tranname</em> is the external name of a transaction defined under the
entry point. The application program (which may be a CICS transaction
or other VTAM application, a VIRTEL sub-application, or an external
server) invoked by this transaction provides the dynamic data which
VIRTEL inserts into the template page.</li>
</ul>
<div class="section" id="dynamic-url-with-userdata">
<h6>Dynamic URL with userdata<a class="headerlink" href="#dynamic-url-with-userdata" title="Permalink to this headline">¶</a></h6>
<p>A second form of URL allows user data to be passed to VIRTEL:</p>
<p><a class="reference external" href="http://ipaddr:port/pathname/pagename+tranname+userdata">http://ipaddr:port/pathname/pagename+tranname+userdata</a></p>
<ul class="simple">
<li><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</li>
<li><em>pathname</em> represents a VIRTEL directory, as described earlier.</li>
<li><em>pagename</em> is the name of a template page, as before.</li>
<li><em>tranname</em> is the name of the transaction which provides the dynamic
data for the template page.</li>
<li><em>userdata</em> is a character string which can be tested by the “User
Data” field in the rules of the HTTP line (see “Rules” in the VIRTEL
Connectivity Reference documentation). This allows the administrator
to assign an entry point to the request based upon the contents of
the <em>userdata</em> in the URL. The <em>userdata</em> also becomes the value of
the “routing parameter” associated with the <em>tranname</em> transaction.
The routing parameter can be referenced by the variable &amp;1 in the
“<em>TIOA at logon”</em> field of the <em>tranname</em> transaction (see
“Defining transaction parameters” in the VIRTEL Connectivity
Reference documentation). Additionally, if the rule which is selected
specifies “$URL$” in its “Parameter” field, and if the HTTP terminal
relays are defined in a logical pool (see “HTTP Terminals” under the
heading “Definition of an HTTP line” in the VIRTEL Connectivity
Reference documentation), then the routing parameter is used by
VIRTEL to select a relay LU for the <em>tranname</em> transaction.</li>
</ul>
</div>
<div class="section" id="dynamic-url-with-parameters">
<h6>Dynamic URL with parameters<a class="headerlink" href="#dynamic-url-with-parameters" title="Permalink to this headline">¶</a></h6>
<p>A third form of URL allows one or more parameters to be passed to a
transaction by means of an “Input Scenario” or by a “Connection /
Disconnection Script”:</p>
<p><a class="reference external" href="http://ipaddr:port/pathname/pagename+tranname?param1=value&amp;param2=value">http://ipaddr:port/pathname/pagename+tranname?param1=value&amp;param2=value</a></p>
<ul class="simple">
<li><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</li>
<li><em>pathname</em> represents a VIRTEL directory, as described earlier.</li>
<li><em>pagename</em> is the name of a template page, as before.</li>
<li><em>tranname</em> is the name of the transaction which provides the dynamic
data for the template page. This transaction must be defined with the
name of a presentation module in its “<em>Output Scenario</em>” field.</li>
<li><em>param1, param2, ...</em> are the names of the parameters which the
scenario can pick up using the COPY$ INPUT-TO-VARIABLE or COPY$
INPUT-TO-SCREEN instructions (described sur la page 161) or which can
be substituted in a script by means of the &amp;=<em>paramn</em>= system
variable (see “Transactions – Connection / Disconnection Scripts” in
the VIRTEL Connectivity Reference documentation. The cumulative
length of the URL parameters is limited by the BUFSIZE parameter of
the VIRTCT. If blanks or other special characters are required in the
parameter value, then the special characters must be coded in the
standard URL escape format %xx where xx is the hexadecimal value of
the character in ASCII. For example, a blank is represented as %20.</li>
</ul>
</div>
<div class="section" id="dynamic-url-with-userdata-and-parameters">
<h6>Dynamic URL with userdata and parameters<a class="headerlink" href="#dynamic-url-with-userdata-and-parameters" title="Permalink to this headline">¶</a></h6>
<p>A URL may contain both userdata and query parameters, as shown in the
following example. The various components of the URL have the same
meaning as described in the preceding two sections.</p>
<p><a class="reference external" href="http://ipaddr:port/pathname/pagename+tranname+userdata?param1=value&amp;param2=value">http://ipaddr:port/pathname/pagename+tranname+userdata?param1=value&amp;param2=value</a></p>
</div>
</div>
<div class="section" id="session-management">
<h5>3270 session management<a class="headerlink" href="#session-management" title="Permalink to this headline">¶</a></h5>
<div class="section" id="virtelsession-parameter">
<h6>VirtelSession parameter<a class="headerlink" href="#virtelsession-parameter" title="Permalink to this headline">¶</a></h6>
<p>Once a session has been established with the host 3270 application, the
template page allows the user to link to the next screen in the 3270
application dialog by means of a URL in the following format:</p>
<p><a class="reference external" href="http://ipaddr:port/pathname/pagename++VirtelSession=sessionid">http://ipaddr:port/pathname/pagename++VirtelSession=sessionid</a></p>
<ul class="simple">
<li><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</li>
<li><em>pathname</em> represents a VIRTEL directory, as described earlier.</li>
<li><em>pagename</em> is the name of the template page to be used for displaying
the next 3270 screen (usually the same as the current template page).</li>
<li><em>sessionid</em> is a VIRTEL-generated code which allows VIRTEL to
identify the user as being already connected to an existing host
session. The parameter VirtelSession=sessionid is inserted by the
{{{SESSION-CODE}}} tag embedded in the template page (see “Session
and context management” sur la page 28).</li>
</ul>
</div>
<div class="section" id="printvirtelsession-parameter">
<h6>PrintVirtelSession parameter<a class="headerlink" href="#printvirtelsession-parameter" title="Permalink to this headline">¶</a></h6>
<p>A second form of the URL with SESSION-CODE allows display of print data
sent by the application to the virtual printer associated with the
specified session. Normally this URL will be embedded in a template page
and will be triggered by the {{{IF-PRINT-IS-READY}}} tag.</p>
<p><a class="reference external" href="http://ipaddr:port/pathname/pagename++PrintVirtelSession=sessionid">http://ipaddr:port/pathname/pagename++PrintVirtelSession=sessionid</a></p>
<ul>
<li><p class="first"><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</p>
</li>
<li><p class="first"><em>pathname</em> represents a VIRTEL directory, as described earlier.</p>
</li>
<li><p class="first"><em>pagename</em> is the name of the template page to be used for displaying
the print data. This page must contain the special {{{PRINT}}} tag
(see “3287 printing” sur la page 78) at the point at which the print
data are to be inserted in the page.</p>
</li>
<li><div class="first line-block">
<div class="line"><em>sessionid</em> is a code which allows VIRTEL to identify the printer
associated with the user’s 3270 session. The parameter
PrintVirtelSession=sessionid (where sessionid is the associated
3270 session identifier), is generated by the {{{SESSION-CODE}}}
tag as in the following example:</div>
<div class="line">imprim.htm++Print{{{SESSION-CODE}}}</div>
</div>
</li>
</ul>
</div>
<div class="section" id="validatevirtelsession-parameter">
<h6>ValidateVirtelSession parameter<a class="headerlink" href="#validatevirtelsession-parameter" title="Permalink to this headline">¶</a></h6>
<p>A third form of URL with SESSION-CODE allows a JavaScript procedure
embedded in a template page to determine whether there are pending
updates to the 3270 screen image. For this type of URL, VIRTEL returns
no data, only an HTTP response code. The possible response codes are:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><strong>205 (Reset Content)</strong> the host application has updated the 3270</dt>
<dd>screen image since the last time it was sent to the user</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>304 (Not Modified)</strong> the host application has not updated the 3270</dt>
<dd>screen image</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>404 (Not Found)</strong> the <em>sessionid</em> code does not represent a valid</dt>
<dd>host session</dd>
</dl>
</li>
</ul>
<p>When response code 205 is indicated, the JavaScript procedure sends a
further request to VIRTEL to retrieve the updated 3270 screen image.
This technique can be useful in handling host applications which use
multiple 3270 write commands to paint a single 3270 screen, where the
user might otherwise be presented with a partially updated screen. An
example of this technique is contained in the <em>WEB2VIRT.htm</em> page
delivered in the VIRTEL sample directory <em>W2H-DIR</em>.</p>
<p><a class="reference external" href="http://ipaddr:port/pathname/pagename++ValidateVirtelSession=sessionid">http://ipaddr:port/pathname/pagename++ValidateVirtelSession=sessionid</a></p>
<ul>
<li><p class="first"><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</p>
</li>
<li><p class="first"><em>pathname</em> represents a VIRTEL directory, as described earlier.</p>
</li>
<li><p class="first"><em>pagename</em> may be specified but is not used.</p>
</li>
<li><div class="first line-block">
<div class="line"><em>sessionid</em> is a code which allows VIRTEL to identify the 3270
session whose status is being queried. The parameter
ValidateVirtelSession=sessionid (where sessionid is the associated
3270 session identifier), is generated by the {{{SESSION-CODE}}}
tag as in the following example:</div>
<div class="line">check.htm++Validate{{{SESSION-CODE}}}</div>
</div>
</li>
</ul>
<p>For compatability with previous versions, the keyword
VerifyVirtelSession is also accepted. VerifyVirtelSession is similar to
ValidateVirtelSession except that it produces only two possible return
codes: 205 (screen updated) and 304 (screen not updated or session
invalid).</p>
</div>
<div class="section" id="usecookiesession-parameter">
<h6>$UseCookieSession$ parameter<a class="headerlink" href="#usecookiesession-parameter" title="Permalink to this headline">¶</a></h6>
<p>As an alternative to specifying the VirtelSession parameter in the URL,
the SESSION-CODE may be sent to VIRTEL in a cookie. An example URL is
shown below:</p>
<p><a class="reference external" href="http://ipaddr:port/pathname">http://ipaddr:port/pathname</a>/pagename++$UseCookieSession$</p>
<ul class="simple">
<li><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</li>
<li><em>pathname</em> represents a VIRTEL directory, as described earlier.</li>
<li><em>pagename</em> is the name of the template page to be used for displaying
the next 3270 screen (usually the same as the current template page).</li>
<li>$UseCookieSession$ indicates that the SESSION-CODE is contained in
the VirtelSession cookie.</li>
</ul>
<p>The VirtelSession cookie should be generated by Javascript as shown in
the example below. This function may be added to the <em>custom.js</em> script
(see “Site customization of Javascript functions sur la page 140):</p>
<p>/* Save VirtelSession cookie after each subpage is loaded */</p>
<p>function after_responseHandle(o, url, xtim) {</p>
<p>var node = document.getElementById(&#8220;sesscode&#8221;);</p>
<p>if (node) {</p>
<p>var text = node.textContent || node.innerText;</p>
<p>var sess = text.replace(/^VirtelSession=/i,&#8221;&#8221;);</p>
<p>createCookie(&#8220;VirtelSession&#8221;, sess, 1);</p>
<p>}</p>
<p>}</p>
<p>Figure 1‑4 Custom Javascript function to generate a VirtelSession cookie</p>
</div>
</div>
<div class="section" id="capability-urls">
<h5>Capability URLs<a class="headerlink" href="#capability-urls" title="Permalink to this headline">¶</a></h5>
<p>A URL may contain a “capability token” generated by another terminal. In
this case the URL inherits certain rights or capabilities conferred by
the other terminal. The capabilities inherited depend on the parameters
specified in the SET-HEADER tag which generated the capability token.
For further details, see “Capability tokens” on page 75<em>.</em></p>
<p><a class="reference external" href="http://ipaddr:port/pathname/pagename+tranname+capabilitytoken">http://ipaddr:port/pathname/pagename+tranname+capabilitytoken</a></p>
<ul class="simple">
<li><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</li>
<li><em>pathname</em> represents a VIRTEL directory, as described earlier.</li>
<li><em>pagename</em> is the name of a template page, as before.</li>
<li><em>tranname</em> <em>(optional)</em> is the name of the transaction which supplies
the dynamic data for the page. If the transaction name is omitted
then two “+” signs must separate the <em>pagename</em> from the
<em>capabilitytoken</em></li>
<li><em>capabilitytoken</em> is a token which grants rights to another
terminal’s resources. This code, whose format is
x-Virtel-<em>name</em>:<em>token</em>, is generated by the {{{SET-HEADER}}} tag
(see page 75). The code is case-sensitive and so the capitalization
must be exactly the same as the generated token.</li>
</ul>
</div>
<div class="section" id="transmission-of-upload-cookie-by-url">
<h5>Transmission of upload cookie by URL<a class="headerlink" href="#transmission-of-upload-cookie-by-url" title="Permalink to this headline">¶</a></h5>
<p>The security code, which identifies a user during page upload by HTTP,
is normally transmitted between the browser and VIRTEL as a <em>cookie</em>
(see “Uploading HTML pages” sur la page 85)<em>.</em> If, for security or
other reasons, your browser does not allow the use of cookies, then the
security code can, as an alternative, be embedded in a URL of the form
shown below:</p>
<p><a class="reference external" href="http://ipaddr:port/pathname/pagename+tranname+securitycode">http://ipaddr:port/pathname/pagename+tranname+securitycode</a></p>
<ul>
<li><p class="first"><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</p>
</li>
<li><p class="first"><em>pathname</em> represents a VIRTEL directory, as described earlier.</p>
</li>
<li><p class="first"><em>pagename</em> is the name of a template page, as before.</p>
</li>
<li><p class="first"><em>tranname</em> is the name of the transaction which supplies the dynamic
data for the page.</p>
</li>
<li><div class="first line-block">
<div class="line"><em>securitycode</em> is the code which allows VIRTEL to identify the
user. This code, whose format is VirtelCookie=xxxxxxxxxxxxxxxx, is
generated by the {{{SECURITY-TOKEN}}} tag, as shown in the example
below:</div>
<div class="line">upload2.htm+upload+VirtelCookie={{{SECURITY-TOKEN}}}</div>
</div>
</li>
</ul>
<p>The following format allows a static page to be displayed:</p>
<p><a class="reference external" href="http://ipaddr:port/pathname/pagename++securitycode">http://ipaddr:port/pathname/pagename++securitycode</a></p>
<ul class="simple">
<li><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</li>
<li><em>pathname</em> represents a VIRTEL directory, as described earlier.</li>
<li><em>pagename</em> is the name of the page.</li>
<li><em>securitycode</em> is a code of format VirtelCookie=xxxxxxxxxxxxxxxx
which allows VIRTEL to identify the user, as before.</li>
</ul>
<p>On receipt of this URL, VIRTEL treats the VirtelCookie= parameter as if
it were a cookie transmitted by the browser.</p>
</div>
<div class="section" id="propagation-of-signon-by-url">
<h5>Propagation of signon by URL<a class="headerlink" href="#propagation-of-signon-by-url" title="Permalink to this headline">¶</a></h5>
<p>A URL embedded in a page sent by VIRTEL may contain a VirtelUserSignon
parameter in order to propagate the user’s signon credentials to another
page. The value of the parameter is generated by the
{{{USER-SIGNON-CODE}}} tag, described sur la page 65. This can be useful
in cases where the browser does not propagate the user name and password
from one page to another, for example when using VIRTEL transaction
security type 4. The format of a URL containing a signon code is shown
below:</p>
<p><a class="reference external" href="http://ipaddr:port/pathname/pagename+tranname+VirtelUserSignon=signoncode">http://ipaddr:port/pathname/pagename+tranname+VirtelUserSignon=signoncode</a></p>
<ul>
<li><p class="first"><em>ipaddr</em>:<em>port</em> is the address of the HTTP line, as before.</p>
</li>
<li><p class="first"><em>pathname</em> represents a VIRTEL directory, as described earlier.</p>
</li>
<li><p class="first"><em>pagename</em> is the name of a template page, as before.</p>
</li>
<li><p class="first"><em>tranname</em> is the name of the transaction which supplies the dynamic
data for the page.</p>
</li>
<li><div class="first line-block">
<div class="line"><em>signoncode</em> is a code which allows VIRTEL to identify the
signed-on user. This code is generated by the
{{{USER-SIGNON-CODE}}} tag, as shown in the example below:</div>
<div class="line"><a class="reference external" href="http://web2virt">http://web2virt</a>.htm+cics+VirtelUserSignon={{{USER-SIGNON-CODE}}}</div>
</div>
</li>
</ul>
</div>
<div class="section" id="the-universal-transaction">
<h5>The Universal Transaction<a class="headerlink" href="#the-universal-transaction" title="Permalink to this headline">¶</a></h5>
<p>A transaction may be defined with an external name consisting of an
asterisk, and this is considered to be a “universal” transaction. A
universal transaction matches any URL not already matched by a preceding
transaction in the entry point. This allows VIRTEL to process URLs whose
format does not conform to the classic VIRTEL formats previously
described.</p>
</div>
</div>
<div class="section" id="directory-management">
<h4>Directory management<a class="headerlink" href="#directory-management" title="Permalink to this headline">¶</a></h4>
<p>HTML and XML template pages and other entities such as CSS stylesheets,
JavaScript procedures, and GIF or JPEG images used by VIRTEL Web Access
are stored in <em>directories</em> within a VSAM KSDS managed by VIRTEL. Each
KSDS defined to VIRTEL can contain one or more directories. The system
administrator can upload pages and other elements into a VIRTEL
directory by using a web browser or by e-mail, as described in detail in
the section “Uploading HTML pages” sur la page 85.</p>
<div class="section" id="accessing-the-application">
<h5>Accessing the application<a class="headerlink" href="#accessing-the-application" title="Permalink to this headline">¶</a></h5>
<p>The directory management sub-application allows the administrator to
define directories. The sub-application is accessible by [PF6] from the
configuration menu, or by [PF12] from the system services menu followed
by option 3, or from the VIRTEL Multi-Session menu via a transaction
which invokes VIRTEL module VIR0042.</p>
</div>
<div class="section" id="security">
<h5>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h5>
<p>If security is active, access to the directory management
sub-application from the configuration menu or the system services menu
is controlled by resource $$PCPC$$.</p>
<p>When invoked via a transaction, normal transaction security rules apply.</p>
<p>In addition, each directory is protected by a resource whose name is the
same as the directory name. The administrator must have access to this
resource in order to view or manage the contents of the directory, or to
upload pages to the directory. When an external security product is
used, the resource is defined in the class named by the RNODE parameter
in the VIRTCT (see “Parameters of the VIRTCT” in the VIRTEL Installation
Guide).</p>
<p>Security management is described in the Virtel Security documentation.</p>
</div>
<div class="section" id="creating-modifying-and-deleting-directories">
<h5>Creating, modifying, and deleting directories<a class="headerlink" href="#creating-modifying-and-deleting-directories" title="Permalink to this headline">¶</a></h5>
<p>When the directory management sub-application is invoked, it displays a
list of the directories already defined in the system:</p>
<p>LIST of DIRECTORIES &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211; Applid: SPVIRH2
15:33:07</p>
<p>Name Description T DD name Keyword Names Case Down Up Del</p>
<p>length load load</p>
<p>HTMLBAS Pages for DEMOHTTP V HTMLTRSF SAMPLE 0008 X X X</p>
<p>PLUGSRCE Installation PLUGIN V PLUGTRSF PLUGSRCE 0008 X X X</p>
<p>USER1DIR Pages for /home/user1 V HTMLTRSF USER1KEY 0044 X X X X</p>
<p>USER2DIR Pages for /home/user2 V HTMLTRSF USER2KEY 0064 X X X X</p>
<p>W2H-DIR Pages for WEB2HOST V HTMLTRSF W2H-KEY 0008 X X X</p>
<p>P1=Update P2=Delete P3=Return P4=List</p>
<p>P6=First page P7=Previous P8=Next P12=Add</p>
<p>Figure 1‑5 Directory management summary screen</p>
</div>
<div class="section" id="associated-functions">
<h5>Associated functions<a class="headerlink" href="#associated-functions" title="Permalink to this headline">¶</a></h5>
<div class="section" id="deleting-a-directory-definition">
<h6>Deleting a directory definition<a class="headerlink" href="#deleting-a-directory-definition" title="Permalink to this headline">¶</a></h6>
<p>To delete a directory definition, place the cursor on the name of the
directory to be deleted and press [PF2]. The message CONFIRM DELETE
appears at the bottom of the screen. Press [PF2] again. The message
DELETE OK indicates that the deletion of the directory definition was
successful. While the message CONFIRM DELETE is displayed, you can press
any function key other than [PF2] to cancel the operation.</p>
</div>
<div class="section" id="displaying-directory-contents">
<h6>Displaying directory contents<a class="headerlink" href="#displaying-directory-contents" title="Permalink to this headline">¶</a></h6>
<p>To display the contents of a directory, place the cursor on the
directory name and press [PF4]. VIRTEL displays the directory contents
management screen described below.</p>
</div>
<div class="section" id="adding-a-directory-definition">
<h6>Adding a directory definition<a class="headerlink" href="#adding-a-directory-definition" title="Permalink to this headline">¶</a></h6>
<p>To create a new directory definition, place the cursor on the blank line
after the last directory, and press [PF12] to display an empty directory
detail screen. Fill in all of the fields and press [ENTER]. The message
CREATION OK indicates that the directory definition was successfully
created.</p>
</div>
<div class="section" id="scrolling-the-list-of-directories">
<h6>Scrolling the list of directories<a class="headerlink" href="#scrolling-the-list-of-directories" title="Permalink to this headline">¶</a></h6>
<p>To scroll to the top of the list, press [PF6]. To scroll up or down the
list, press [PF7] or [PF8].</p>
</div>
<div class="section" id="exiting-from-directory-management">
<h6>Exiting from directory management<a class="headerlink" href="#exiting-from-directory-management" title="Permalink to this headline">¶</a></h6>
<p>To return to the configuration menu, press [PF3].</p>
</div>
</div>
<div class="section" id="defining-directory-parameters">
<h5>Defining directory parameters<a class="headerlink" href="#defining-directory-parameters" title="Permalink to this headline">¶</a></h5>
<p>To access the detail screen for any directory, place the cursor on the
directory name and press [PF12]:</p>
<p>DIRECTORY DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212; Applid: SPVIRH2
15:35:31</p>
<p>Name ===&gt; W2H-DIR Name of this directory</p>
<p>Description ===&gt; Pages for WEB2HOST Describes directory</p>
<p>Type ===&gt; V V=VSAM</p>
<p>DD name ===&gt; HTMLTRSF DD name in Virtel JCL</p>
<p>Keyword ===&gt; W2H-KEY Directory internal name</p>
<p>Size of names ===&gt; 0008 Significant length of filenames</p>
<p>Case ===&gt; Filenames are case sensitive</p>
<hr class="docutils" />
<p>If a user has access to this directory, he may:</p>
<p>(mark with &#8216;X&#8217;)</p>
<p>Copy up ===&gt; X upload a file</p>
<p>Copy down ===&gt; X download a file</p>
<p>Delete ===&gt; X delete a file</p>
<hr class="docutils" />
<p>P1=Update P3=Return P4=List</p>
<p>Figure 1‑6 Directory management detail screen</p>
</div>
<div class="section" id="contents-of-the-fields">
<h5>Contents of the fields<a class="headerlink" href="#contents-of-the-fields" title="Permalink to this headline">¶</a></h5>
<p><strong>Name</strong> The name of the directory as known by VIRTEL. If security is
active, this name must also be defined as a resource to which the user
must be authorized.</p>
<p><strong>Description</strong> Comment associated with the directory.</p>
<p><strong>Type</strong> <strong>V</strong> (or blank) indicates that the directory is held in a VSAM
KSDS.</p>
<p><strong>DD name</strong> The file name of the VSAM KSDS which contains the directory.
This name must be defined in one of the UFILEn parameters in the VIRTCT,
and a DD statement with the same name must appear in the VIRTEL started
task JCL.</p>
<p><strong>Keyword</strong> This is an 8-byte key which allows multiple directories to
be stored within a single VSAM KSDS. Each directory in a KSDS must have
a unique key.</p>
<p><strong>Size of names</strong> The maximum length of the names of HTML pages and
other elements stored in this directory. The minimum (and default) value
is 8. The maximum value is 64.</p>
<p><strong>Case</strong> Any non-blank character in this field indicates that the
element names stored in this directory are case sensitive. Blank
indicates that the names are not case sensitive.</p>
<p><strong>Copy up</strong> This field is used by VIRTEL/PC. For VIRTEL Web Access
directories, the value <strong>X</strong> must be coded.</p>
<p><strong>Copy down</strong> This field is used by VIRTEL/PC. For VIRTEL Web Access
directories, the value <strong>X</strong> must be coded.</p>
<p><strong>Delete</strong> This field is used by VIRTEL/PC. For VIRTEL Web Access
directories, the value <strong>X</strong> must be coded.</p>
</div>
<div class="section" id="directory-contents-management">
<h5>Directory contents management<a class="headerlink" href="#directory-contents-management" title="Permalink to this headline">¶</a></h5>
<p>After pressing [PF4] at the directory management summary screen or
detail screen, VIRTEL displays a list of the files in the directory:</p>
<p>DIRECTORY : W2H-DIR [1] 55 FILE(S)&#8212;&#8212;&#8212;&#8212; Applid: SPVIRH2 10:50:31</p>
<p>Pages for WEB2HOST [2]</p>
<p>Name Size Date Time</p>
<p>WEBSERV0 5572 20050208 15:52:23</p>
<p>ES.GIF 517 20050208 15:51:35</p>
<p>CALENDAR K 53 20050208 15:51:25</p>
<p>FAVICON. 2998 20050208 15:51:36</p>
<p>NOIR.GIF 161 20050208 15:51:48</p>
<p>TXTSERV2 K 15 20050208 15:52:05</p>
<p>STYLNOIR 2709 20050208 15:51:56</p>
<p>CAL-EN.J 3830 20050208 15:51:24</p>
<p>BLUE.GIF 161 20050208 15:51:23</p>
<p>WEB2PLUG 6370 20050208 15:52:21</p>
<p>VERT.GIF 161 20050208 15:52:12</p>
<p>RED.GIF 161 20050208 15:51:50</p>
<p>IMPRIM.H 826 20050208 15:51:40</p>
<p>VIRLOAD. 1346 20050208 15:52:13</p>
<p>VIRTNOIR 3737 20050208 15:52:16</p>
<p>[3] [4] [5] [6]</p>
<p>F2=Delete F3=Return F7=First page F8=Next page</p>
<p>F6=Copy to ... HTMLBAS</p>
<p>[7]</p>
<p>Figure 1‑7 Directory contents management screen</p>
</div>
<div class="section" id="id4">
<h5>Contents of the fields<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<p>[1] Name of directory.</p>
<p>[2] Directory description.</p>
<p>[3] Name of elements contained in the directory.</p>
<p>[4] Approximate size of element (K indicates that the size is displayed
in kilo-bytes).</p>
<p>[5] Date when element was loaded into the directory.</p>
<p>[6] Time when element was loaded into the directory.</p>
<p>[7] Name of target directory for file copy.</p>
</div>
<div class="section" id="id5">
<h5>Associated functions<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<div class="section" id="deleting-an-element">
<h6>Deleting an element<a class="headerlink" href="#deleting-an-element" title="Permalink to this headline">¶</a></h6>
<p>To delete an element from a directory, place the cursor on the name of
the element to be deleted and press [PF2]. The message CONFIRM DELETE
appears at the bottom of the screen. Press [PF2] again. The message
DELETE OK indicates that the deletion of the element was successful.
While the message CONFIRM DELETE is displayed, you can press any
function key other than [PF2] to cancel the operation.</p>
</div>
<div class="section" id="copying-an-element-to-another-directory">
<h6>Copying an element to another directory<a class="headerlink" href="#copying-an-element-to-another-directory" title="Permalink to this headline">¶</a></h6>
<p>To copy an element from directory <em>A</em> to directory <em>B</em>, first display
the contents of directory <em>A</em>. In field [7] type the name of the target
directory <em>B</em>, then press [ENTER]. Next, place the cursor on the name of
the element to be copied, then press [PF6]. The message COPY COMPLETED
indicates that the operation was successful. If the element exists in
the target directory, the copy fails and the message THIS FILE IS
ALREADY IN THE TARGET DIRECTORY is displayed at the bottom of the
screen.</p>
</div>
<div class="section" id="scrolling-the-list">
<h6>Scrolling the list<a class="headerlink" href="#scrolling-the-list" title="Permalink to this headline">¶</a></h6>
<p>The list of elements can be scrolled up and down using [PF7] and [PF8].</p>
</div>
<div class="section" id="exiting-from-directory-contents-management">
<h6>Exiting from directory contents management<a class="headerlink" href="#exiting-from-directory-contents-management" title="Permalink to this headline">¶</a></h6>
<p>To return to the list of directories, press [PF3].</p>
</div>
</div>
</div>
<div class="section" id="creating-html-and-xml-template-pages">
<h4>Creating HTML and XML template pages<a class="headerlink" href="#creating-html-and-xml-template-pages" title="Permalink to this headline">¶</a></h4>
<p>Template pages are the means by which VIRTEL presents host application
data to the user via a web browser. In addition to standard HTML or XML
tags, template pages contain VIRTEL-specific tags enabling integration
of information delivered by the mainframe application programs. HTML
template pages may contain GIF or JPEG images, sounds, scripts such as
JavaScript or any other function or program elements that are compatible
with the browser. Template pages may be produced either by hand or by
using standard HTML or XML design tools available on the market,</p>
<div class="section" id="defining-the-tag-delimiters">
<h5>Defining the tag delimiters<a class="headerlink" href="#defining-the-tag-delimiters" title="Permalink to this headline">¶</a></h5>
<p>VIRTEL-specific tags are used to insert data originating at the host
into an HTML or XML page, and to manage colours and function keys in an
HTML page. VIRTEL-specific tags are identified by special begin and end
delimiters.</p>
<p>The delimiters themselves are defined by means of a comment placed
between the tags &lt;HEAD&gt; and &lt;/HEAD&gt; of the HTML page. The actual
delimiters may vary from one page to another.</p>
<p>&lt;!&#8211;VIRTEL start=&#8221;{{{&#8221; end=&#8221;}}}&#8221; &#8211;&gt;</p>
<p>In this example, VIRTEL-specific tags are defined as being represented
by a succession of 3 opening braces and terminated by a succession of 3
closing braces. This convention is maintained throughout the remainder
of this chapter.</p>
</div>
<div class="section" id="session-and-context-management">
<h5>Session and context management<a class="headerlink" href="#session-and-context-management" title="Permalink to this headline">¶</a></h5>
<p>VIRTEL uses the concept of a <em>sessioncode</em> to maintain the context
between a client using a browser and the host application to which the
client is connected. This code allows VIRTEL to identify the client and
to associate the client with a session already established with a host
application.</p>
<div class="section" id="session-code-tag">
<h6>SESSION-CODE tag<a class="headerlink" href="#session-code-tag" title="Permalink to this headline">¶</a></h6>
<p>The SESSION-CODE tag is used to create the URL associated with form
submission.</p>
<p>{{{ SESSION-CODE }}}</p>
<p>The SESSION-CODE tag allows a sessioncode to be inserted in the template
page in the format <em>VirtelSession=xxxxxxxxxxxxxxxx</em>. The value of the
sessioncode changes after each message. For examples of its use, see
“Transmitting data to the host” au-dessous, and “3287 printing” sur la
page 78.</p>
</div>
<div class="section" id="ajax-session-code-tag">
<h6>AJAX-SESSION-CODE tag<a class="headerlink" href="#ajax-session-code-tag" title="Permalink to this headline">¶</a></h6>
<p>The AJAX-SESSION-CODE tag is similar to the SESSION-CODE tag, but it
generates the code in a different format which does not change with each
request. This is useful when implementing an AJAX dialog between the
application and the browser. For this type of application, it is not
always possible to transmit the VIRTEL session code to the browser,
especially if a Javascript library is used.</p>
<p>{{{ AJAX-SESSION-CODE }}}</p>
<p>The AJAX-SESSION-CODE tag allows a <em>sessioncode</em> to be inserted in the
template page in the format <em>AjaxSession=xxxxxxxxxxxxxxxx.</em> For example:</p>
<p>result.txt+cics+{{{ AJAX-SESSION-CODE }}}</p>
</div>
<div class="section" id="set-initial-timeout-tag">
<h6>SET-INITIAL-TIMEOUT tag<a class="headerlink" href="#set-initial-timeout-tag" title="Permalink to this headline">¶</a></h6>
<p>The SET-INITIAL-TIMEOUT tag allows a timeout to be started when VIRTEL
builds the page.</p>
<p>{{{ SET-INITIAL-TIMEOUT &#8220;n&#8221; }}}</p>
<p>For example, if the instruction</p>
<p>{{{ SET-INITIAL-TIMEOUT &#8220;10&#8221; }}}</p>
<p>is coded in a page or a sub-page, then VIRTEL will cancel the session if
the workstation has not sent another request after 10 seconds.</p>
</div>
</div>
<div class="section" id="transmitting-data-to-the-host">
<h5>Transmitting data to the host<a class="headerlink" href="#transmitting-data-to-the-host" title="Permalink to this headline">¶</a></h5>
<p>Transmission of data to the host uses the principle of sending an HTML
form. In conjunction with the SESSION-CODE tag, the form allows the
transmission of input fields to the host application, and the display of
the subsequent application screen.</p>
<p>The form is defined as follows:</p>
<p>&lt;FORM name=&#8221;FormName&#8221; action=&#8221;VirtelURL&#8221; method=&#8221;POST&#8221;&gt;</p>
<p>&lt;/FORM&gt;</p>
<p><strong>*name*</strong> Form name. The name of the form is used in JavaScript
procedures to refer to various elements of the form. For an example, see
the section “Cursor management” sur la page 44.</p>
<p><strong>*action*</strong> URL transmitted to the server, in the following format:</p>
<p>action=&#8221;pagename++{{{SESSION-CODE}}}&#8221;</p>
<p><em>pagename</em> is the name of the template page to be used to display the
subsequent screen sent by the host application (usually the same as the
current template page)</p>
<p><em>{{{SESSION-CODE}}}</em> identifies the session established with the host
application</p>
<p><strong>*method*</strong> Transmission mode.</p>
<p>Always POST.</p>
<p>Example&nbsp;:</p>
<p>&lt;form name=&#8221;Virtel&#8221; action=&#8221;WEB2VIRT.htm++{{{SESSION-CODE}}}&#8221;
method=&#8221;post&#8221;&gt;</p>
</div>
<div class="section" id="where-to-position-the-elements-of-an-html-page">
<h5>Where to position the elements of an HTML page<a class="headerlink" href="#where-to-position-the-elements-of-an-html-page" title="Permalink to this headline">¶</a></h5>
<p>By design, an HTML page starts with the &lt;HTML&gt; tag and is terminated by
the &lt;/HTML&gt; tag. In order to be able to be correctly interpreted by the
browser, other tags are necessary, for example &lt;HEAD&gt; and &lt;/HEAD&gt; as
well as &lt;BODY&gt; and &lt;/BODY&gt;. All other tags are optional.</p>
<p>As shown previously, data transmitted to the HTTP server by the client
is itself placed in the tag fields &lt;FORM&gt; and &lt;/FORM&gt;. In order to
minimise traffic, it is also advisable to place only useful data in the
tag fields for example, generated fields or copies resulting from
GENERATE-HTML and COPY-FROM tags, as well as indispensable fields such
as <em>focusField</em> and <em>pfkField</em>. Other data may be placed anywhere in the
area of the HTML page, provided that their position conforms to the
standards. The following presents an example of the possible structure.</p>
<p>&lt;HTML&gt;</p>
<p>&lt;HEAD&gt;&lt;!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212; <strong>*start of HTML page header*</strong>
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;&gt;</p>
<p>&lt;style&gt;&lt;!&#8211; définition des classes de style</p>
<p>.GREEN {font-family: monospace; background: #000000; color: #00FF00; }</p>
<p>//&#8211;&gt;&lt;/style&gt;</p>
<p>&lt;!&#8211;VIRTEL start=&#8221;{{{&#8221; end=&#8221;}}}&#8221; &#8211;&gt;</p>
<p>{{{ON-ATTRIBUTE (PROTECTED,WHITE)&lt;font color=white&gt;}}}</p>
<p>{{{ON-END-OF-ATTRIBUTE (PROTECTED,WHITE)&lt;/font&gt;}}}</p>
<p>{{{ADD-TO-FIELDS (NORMAL,NOCOLOR) class=&#8221;GREEN&#8221; }}}</p>
<p>{{{DEFINE-HTML-PFKEY &#8220;<strong>PFKFIELD</strong>&#8220;}}}</p>
<p>{{{DEFINE-HTML-FOCUS-FIELD &#8220;<strong>FOCUSFIELD</strong>&#8220;}}}</p>
<p>&lt;title&gt;Sample HTML page&lt;/title&gt;</p>
<p>&lt;/HEAD&gt;&lt;!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212; <strong>*end of HTML page header*</strong>
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;&gt;</p>
<p>&lt;script language=&#8221;JavaScript&#8221;&gt;&lt;!&#8211;</p>
<p>function SetFocus()</p>
<p>{ document.<strong>virtelForm</strong>.{{{FIELD-WITH-CURSOR}}}.focus(); }</p>
<p>function SaveFocus(CurrentFieldName)</p>
<p>{ document.<strong>virtelForm</strong>.<strong>FOCUSFIELD</strong>.value = CurrentFieldName; }</p>
<p>function SubmitForm(valeur)</p>
<p>{ document.<strong>virtelForm</strong>.<strong>PFKFIELD</strong>.value = valeur;</p>
<p>document.<strong>virtelForm</strong>.submit(); }</p>
<p>function ShowPopup()</p>
<p>{ var popup = window.open(&#8220;&#8221;,&#8221;PopupImpression&#8221;,&#8217;width=614,height=129&#8217;);</p>
<p>popup.location = &#8220;imprim.htm++Print{{{SESSION-CODE}}}&#8221;; }</p>
<p>&#8211;&gt;&lt;/script&gt;</p>
<p>&lt;!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- <strong>*start of HTML*</strong> <strong>*page body*</strong>
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;&gt;</p>
<p>&lt;BODY onLoad=&#8221;SetFocus()&#8221;&gt;</p>
<p>&lt;!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- <strong>*start of HTML form*</strong>
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;&gt;</p>
<p>&lt;FORM name=&#8221;<strong>virtelForm</strong>&#8220;</p>
<p>action=&#8221;example.html++<strong>{{{SESSION-CODE}}}&#8221;</strong></p>
<p>method==&#8221;POST&#8221;&gt;</p>
<p>{{{ GENERATE-HTML (1,1,1920) }}}</p>
<p>&lt;input name=&#8221;<strong>PFKFIELD</strong>&#8221; type=&#8221;HIDDEN&#8221; value=&#8221;&#8220;&gt;</p>
<p>&lt;input name=&#8221;<strong>FOCUSFIELD</strong>&#8221; type=&#8221;HIDDEN&#8221;
value=&#8221;{{{FIELD-WITH-CURSOR}}}&#8221;&gt;</p>
<p>&lt;/FORM&gt;&lt;!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212; <strong>*end of HTML form*</strong>
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-&gt;</p>
<p>&lt;!—-<em>Place submit buttons and hypertext links here. For example:</em>&#8211;&gt;</p>
<p>&lt;a href=&#8221;<a class="reference external" href="javascript:submitform('PF1">javascript:submitform(&#8216;PF1</a>&#8216;)&#8221; &gt;soumettre avec PF01&lt;/a&gt;</p>
<p>&lt;INPUT TYPE=&#8221;BUTTON&#8221; size=&#8221;5&#8221; onclick=&#8221;SubmitForm(this.value)&#8221;
value=&#8221;PF01&#8221;&gt;</p>
<p>&lt;script language=&#8221;JavaScript&#8221;&gt;&lt;!&#8211;</p>
<p>{{{IF-PRINT-IS-READY</p>
<p>ShowPopUp();</p>
<p>}}}</p>
<p>&#8211;&gt;&lt;/script&gt;</p>
<p>&lt;/BODY&gt;&lt;!&#8212;&#8212;&#8212;&#8212;&#8212;&#8212; <strong>*end of HTML page body*</strong>
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;&gt;</p>
<p>&lt;/HTML&gt;</p>
<p>For a full example, see the <em>WEB2VIRT.htm</em> page delivered with VIRTEL.</p>
</div>
<div class="section" id="inserting-host-application-data-in-a-page">
<h5>Inserting host application data in a page<a class="headerlink" href="#inserting-host-application-data-in-a-page" title="Permalink to this headline">¶</a></h5>
<p>Insertion of host application data in an HTML or XML page is achieved
with the GENERATE-HTML and COPY-FROM tags.</p>
<div class="section" id="generate-html-tag">
<h6>GENERATE-HTML tag<a class="headerlink" href="#generate-html-tag" title="Permalink to this headline">¶</a></h6>
<p>The GENERATE-HTML tag instructs VIRTEL to convert all or part of the
3270 screen into HTML form data. Output fields are converted into text,
while input fields are converted into HTML input statements. The
generated text and input fields are aligned so as to correspond as far
as possible with the layout of the original 3270 screen. The resulting
generation takes account of the nature of the data as well as the
information specified in the ON-ATTRIBUTE, ON-END-OF-ATTRIBUTE and
ADD-TO-FIELDS tags.</p>
<p>{{{ GENERATE-HTML (row, col, len) }}}</p>
<p><strong>*row,col*</strong> Starting position (row and column number on the 3270
screen) of the data to be copied. This starting position will usually
contain a 3270 attribute character.</p>
<p><strong>*len*</strong> Length of the data to be copied (including attribute
characters).</p>
<p>For example, the command {{{ GENERATE-HTML (01,01,1920) }}} will
generate the total contents of the 3270 screen.</p>
<p>An alternative form of the GENERATE-HTML tag allows the position and
length to be specified by means of a symbolic name defined in a previous
DEFINE-DFHMDF-NAME or DEFINE-DFHMDF-COLUMN tag (described sur la page
36).</p>
<p>{{{ GENERATE-HTML &#8220;name&#8221; }}}</p>
<p><strong>*name*</strong> symbolic name defined in a previous DEFINE-DFHMDF-NAME or
DEFINE-DFHMDF-COLUMN tag.</p>
</div>
<div class="section" id="copy-from-tag">
<h6>COPY-FROM tag<a class="headerlink" href="#copy-from-tag" title="Permalink to this headline">¶</a></h6>
<p>The COPY-FROM tag copies data into the HTML page from a specific
location on the 3270 screen. Unlike the GENERATE-HTML tag, the COPY-FROM
tag copies only the data and does not process any associated 3270 field
attributes.</p>
<p>{{{ COPY-FROM (row, col, len) }}}</p>
<p><strong>*row,col*</strong> Starting position (row and column number on the 3270
screen) of the data to be copied. This will typically be the first
character after the attribute character which defines the start of the
field.</p>
<p><strong>*len*</strong> Length of the data to be copied.</p>
<p>An alternative form of the COPY-FROM tag allows the position and length
to be specified by means of a symbolic name defined in a previous
DEFINE-DFHMDF-NAME or DEFINE-DFHMDF-COLUMN tag (described sur la page
36).</p>
<p>{{{ COPY-FROM &#8220;name&#8221; }}}</p>
<p><strong>*name*</strong> symbolic name defined in a previous DEFINE-DFHMDF-NAME or
DEFINE-DFHMDF-COLUMN tag.</p>
<p>Normally, any binary zeroes in the copied data will be removed. However,
if the BLANK-BINARY-ZEROES option is set (see “Setting and unsetting
local options” sur la page 49) then binary zeroes will be converted to
blanks.</p>
</div>
<div class="section" id="create-variable-from-tag">
<h6>CREATE-VARIABLE-FROM tag<a class="headerlink" href="#create-variable-from-tag" title="Permalink to this headline">¶</a></h6>
<p>The CREATE-VARIABLE-FROM tag copies data from the 3270 screen into a
VIRTEL variable. There are several formats of the COPY-VARIABLE-FROM
tag, as described below.</p>
<p>In the first form of CREATE-VARIABLE-FROM, the name of a variable is
specified within the tag. Data is extracted from the indicated location
on the screen, continuing until an attribute character is found or until
the specified length is reached. Any non-alphanumeric characters are
removed, all alphabetic characters are converted to upper case, and the
resulting data is copied into the variable. If the variable does not
exist, it will be created. If the variable already exists, the new value
will be appended to any existing values.</p>
<p>{{{ CREATE-VARIABLE-FROM (row, col, len) &#8220;varname&#8221; }}}</p>
<p><strong>*row,col*</strong> Starting position (row and column number on the 3270
screen) of the data to be copied. This will typically be the first
character after an attribute character which defines the start of a
field.</p>
<p><strong>*len*</strong> Length of the data to be copied.</p>
<p><strong>*varname*</strong> The name of the variable to be created</p>
<p>The second form of CREATE-VARIABLE-FROM is distinguished by the absence
of a variable name within the tag. In this case, the variable name is
obtained from the 3270 screen. Data is extracted from the indicated
location on the screen, continuing until an attribute character is found
or until the specified length is reached. Any non-alphanumeric
characters are removed, all alphabetic characters are converted to upper
case, and the resulting string is used as a variable name. If the
variable does not exist, it will be created. If the variable already
exists, a new value will be appended to any existing values. If the
variable name was terminated by an attribute character, then the data in
the following field is used as the value of the variable. Otherwise the
string “EMPTY” will be used as the value of the variable.</p>
<p>{{{ CREATE-VARIABLE-FROM (row, col, len) }}}</p>
<p><strong>*row,col*</strong> Line and column number on the 3270 screen containing the
variable name.</p>
<p><strong>*len*</strong> Total length of the variable name and value to be copied.</p>
<p>The third form of CREATE-VARIABLE-FROM allows a rectangle to be copied
from the screen. With a fourth sub-parameter specified, the instruction
will not stop collecting data after encountering an attribute, but will
continue adding values to the variable for the specified height on the
screen. Any attributes found in the rectangle will be copied as blanks.
If the variable does not exist, it will be created. If the variable
already exists, the new values will be appended to any existing values.</p>
<p>{{{ CREATE-VARIABLE-FROM (row, col, width, height) &#8220;varname&#8221; }}}</p>
<p><strong>*row,col*</strong> Starting position (row and column number on the 3270
screen) of the data to be copied.</p>
<p><strong>*width,height*</strong> Size (in columns and rows) of the rectangle to be
copied.</p>
<p><strong>*varname*</strong> The name of the variable to be created</p>
</div>
<div class="section" id="define-html-field-name-tag">
<h6>DEFINE-HTML-FIELD-NAME tag<a class="headerlink" href="#define-html-field-name-tag" title="Permalink to this headline">¶</a></h6>
<p>The DEFINE-HTML-FIELD-NAME tag requests that VIRTEL should use a
specific HTML input field name for the specified 3270 field, instead of
an automatically generated name. The DEFINE-HTML-FIELD-NAME tag may be
followed by a GENERATE-HTML tag, in which case VIRTEL will generate an
HTML input field with the specified name, or the input field may be
explicitly coded in the page template, in which case VIRTEL will use the
name to associate the HTML input field with the 3270 field at the
specified position. Normally this tag is not needed because the
automatically generated field names are adequate for all except certain
specialised applications.</p>
<p>{{{ DEFINE-HTML-FIELD-NAME (row, col, len) &#8220;name&#8221;}}}</p>
<p><strong>*row,col*</strong> Line and column number of the start of the field on the
3270 screen. This must be the first character after the attribute
character.</p>
<p><strong>*len*</strong> Length of the input field (excluding attribute character).</p>
<p><strong>*name*</strong> Name to be associated with the HTML input field.</p>
</div>
<div class="section" id="define-html-field-tag">
<h6>DEFINE-HTML-FIELD tag<a class="headerlink" href="#define-html-field-tag" title="Permalink to this headline">¶</a></h6>
<p>The DEFINE-HTML-FIELD tag is equivalent to a DEFINE-HTML-FIELD-NAME tag
followed by a GENERATE-HTML tag.</p>
<p>{{{ DEFINE-HTML-FIELD (row, col, len) &#8220;name&#8221;}}}</p>
<p><strong>*row,col*</strong> Line and column number of the start of the field on the
3270 screen. This must be the first character after the attribute
character.</p>
<p><strong>*len*</strong> Length of the input field (excluding attribute character).</p>
<p><strong>*name*</strong> Name to be associated with the HTML input field.</p>
</div>
<div class="section" id="define-dfhmdf-name-tag">
<h6>DEFINE-DFHMDF-NAME tag<a class="headerlink" href="#define-dfhmdf-name-tag" title="Permalink to this headline">¶</a></h6>
<p>The DEFINE-DFHMDF-NAME tag allows a field on the 3270 screen to be given
a symbolic name which can be used in a subsequent GENERATE-HTML tag or
COPY-FROM tag.</p>
<p>{{{ DEFINE-DFHMDF-NAME (row, col, len) &#8220;name&#8221;}}}</p>
<p><strong>*row,col*</strong> Position (row and column number on the 3270 screen) of the
attribute character which precedes the field on the 3270 screen.</p>
<p><strong>*len*</strong> Length of the 3270 field (excluding attribute character).</p>
<p><strong>*name*</strong> Name to be associated with the field.</p>
<p>The name specified by the DEFINE-DFHMDF-NAME tag can then be used in
subsequent GENERATE-HTML tags or COPY-FROM tags, instead of specifying
an explicit row, column, and length. In addition, the DEFINE-DFHMDF-NAME
tag generates an implicit DEFINE-HTML-FIELD-NAME tag.</p>
<p>For example:</p>
<p><em>The following tag defines a 10-character input field having attribute
byte at row 1 column 59. The field itself occupies row 1 columns 60 to
69:</em></p>
<p>{{{ DEFINE-DFHMDF-NAME (1,59,10) &#8220;XDAT10&#8221; }}}</p>
<p><em>Subsequently:</em></p>
<p>{{{ GENERATE-HTML &#8220;XDAT10&#8221; }}} <em>is interpreted as</em> {{{ GENERATE-HTML
(1,59,11) }}}</p>
<p>{{{ COPY-FROM &#8220;XDAT10&#8221; }}} <em>is interpreted as</em> {{{ COPY-FROM (1,60,10)
}}}</p>
<p><em>and the following tag will be automatically generated:</em></p>
<p>{{{ DEFINE-HTML-FIELD-NAME (1,60,10) &#8220;XDAT10&#8221; }}}</p>
<p><em>Notice that VIRTEL automatically adjusts the starting position and
length as necessary to account for the attribute byte.</em></p>
</div>
<div class="section" id="define-dfhmdf-column-tag">
<h6>DEFINE-DFHMDF-COLUMN tag<a class="headerlink" href="#define-dfhmdf-column-tag" title="Permalink to this headline">¶</a></h6>
<p>The DEFINE-DFHMDF-COLUMN tag is similar to the DEFINE-DFHMDF-NAME tag
except that it allows the definition of a field which is repeated in the
same column position on several consecutive lines of the screen.</p>
<p>{{{ DEFINE-DFHMDF-COLUMN (row, col, len, ht) &#8220;name&#8221;}}}</p>
<p><strong>*row,col*</strong> Position (row and column number on the 3270 screen) of the
attribute character which precedes the first occurrence of the field on
the 3270 screen.</p>
<p><strong>*len*</strong> Length of each 3270 field (excluding attribute character).</p>
<p><strong>*ht*</strong> Height of column (number of lines).</p>
<p><strong>*name*</strong> Name to be associated with the field.</p>
<p>The name specified by the DEFINE-DFHMDF-COLUMN tag can be used in
subsequent GENERATE-HTML tags or COPY-FROM tags instead of specifying an
explicit row, column, and length. The first time the field name is
referenced in a GENERATE-HTML or COPY-FROM tag, the first occurrence of
the field will be used. Each time the field name is referenced
subsequently, the row number is incremented automatically. After the end
of the series is reached, any subsequent reference wraps back to the
first row number. In addition, the DEFINE-DFHMDF-COLUMN tag implicitly
generates a series of DEFINE-HTML-FIELD-NAME tags, each of which
contains the field name suffixed by _1, _2, etc.</p>
<p>For example:</p>
<p><em>The following tag defines a column of 5-character input fields having
attribute bytes in column 1. The fields themselves occupy columns 2 to
6. The first field is in row 9 and there are 12 occurrences:</em></p>
<p>{{{DEFINE-DFHMDF-COLUMN (9,1,5,12) &#8220;NBLIGN&#8221; }}}</p>
<p><em>Subsequently:</em></p>
<p>{{{ GENERATE-HTML &#8220;NBLIGN&#8221; }}} <em>is interpreted as</em> {{{ GENERATE-HTML
(n,1,6) }}}</p>
<p>{{{ COPY-FROM &#8220;NBLIGN&#8221; }}} <em>is interpreted as</em> {{{ COPY-FROM (n,2,5) }}}</p>
<p><em>where n takes the next value in the range 9 to 20</em></p>
<p><em>The following tags will be automatically generated:</em></p>
<p>{{{DEFINE-HTML-FIELD-NAME (9,2,5) &#8220;NBLIGN_1&#8221; }}}</p>
<p>{{{DEFINE-HTML-FIELD-NAME (10,2,5) &#8220;NBLIGN_2&#8221; }}}</p>
<p><em>and so on until</em></p>
<p>{{{DEFINE-HTML-FIELD-NAME (20,2,5) &#8220;NBLIGN_12&#8221; }}}</p>
<p><em>Notice that VIRTEL automatically adjusts the starting positions and
lengths as necessary to account for the attribute byte.</em></p>
</div>
<div class="section" id="generate-variables-tag">
<h6>GENERATE-VARIABLES tag<a class="headerlink" href="#generate-variables-tag" title="Permalink to this headline">¶</a></h6>
<p>The GENERATE-VARIABLES tag functions like GENERATE-HTML except that,
instead of generating HTML, it generates a set of table variables for
each attribute found in the designated portion of the screen.</p>
<p>{{{ GENERATE-VARIABLES (row, col, len) &#8220;prefix&#8221; }}}</p>
<p><strong>*row,col*</strong> Starting position (row and column number on the 3270
screen) of the data to be copied. This starting position will usually
contain a 3270 attribute character.</p>
<p><strong>*len*</strong> Length of the data to be copied (including attribute
characters).</p>
<p><strong>*prefix*</strong> The prefix of the generated variable names.</p>
<p>A set of these variables is generated for each field found on the
screen:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="14%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Variable name</td>
<td>Meaning</td>
<td>Notes</td>
</tr>
<tr class="row-even"><td><em>prefix</em>NAME</td>
<td>Field name</td>
<td>Example&nbsp;: V00002E9 for an input field, blank for an output field</td>
</tr>
<tr class="row-odd"><td><em>prefix</em>LINE</td>
<td>Line</td>
<td>Line position of the field attribute (first line = 1)</td>
</tr>
<tr class="row-even"><td><em>prefix</em>COLUMN</td>
<td>Column</td>
<td>Column position of the field attribute (first column = 1)</td>
</tr>
<tr class="row-odd"><td><em>prefix</em>LENGTH</td>
<td>Length</td>
<td>Field length (excluding attribute)</td>
</tr>
<tr class="row-even"><td><em>prefix</em>ATTRB</td>
<td>Attribute</td>
<td>ASKIP, PROT, UNPROT, NUM, BRT, NORM, DET, MDT</td>
</tr>
<tr class="row-odd"><td><em>prefix</em>COLOR</td>
<td>Color</td>
<td>NEUTRAL, BLUE, RED, PINK, GREEN, TURQUOISE, YELLOW, WHITE</td>
</tr>
<tr class="row-even"><td><em>prefix</em>HILIGHT</td>
<td>Highlight</td>
<td>BLINK, REVERSE, UNDERLINE, OFF</td>
</tr>
<tr class="row-odd"><td><em>prefix</em>VALUE</td>
<td>Contents</td>
<td>The text contained in the field (excluding attribute)</td>
</tr>
</tbody>
</table>
<p>For example, the tag {{{&nbsp;GENERATE-VARIABLES (01,01,1920) &#8220;MYPREFIX&#8221;&nbsp;}}}
generates a set of table variables describing the entire contents of the
3270 screen.</p>
<p>Normally, any binary zeroes in the field will be removed from the VALUE.
However, if the BLANK-BINARY-ZEROES option is set (see “Setting and
unsetting local options” sur la page 49) then binary zeroes will be
converted to blanks.</p>
</div>
<div class="section" id="generate-vir3270-tag">
<h6>GENERATE-VIR3270 tag<a class="headerlink" href="#generate-vir3270-tag" title="Permalink to this headline">¶</a></h6>
<p>GENERATE-VIR3270, in conjunction with supporting JavaScript functions,
is used by VIRTEL Web Access to generate an HTML page which reproduces
as closely as possible the look and feel of a classic 3270 screen.</p>
<p>The GENERATE-VIR3270 tag functions like GENERATE-HTML except that,
instead of generating HTML form fields corresponding to 3270 input
fields, it generates all 3270 fields as HTML spans. Special attribute
keywords are added to each span to indicate the type of field, the
screen position, and the 3270 field attributes. A subspan is generated
for characters whose character attributes differ from the field
attributes. In addition, GENERATE-VIR3270 generates a hidden HTML form
field for each 3270 input field, and these fields are written as HTML
fragments into a VIRTEL table variable so that they can be inserted
later in the page.</p>
<p>{{{ GENERATE-VIR3270 (row, col, len) &#8220;fragvar&#8221; }}}</p>
<p><strong>*row,col*</strong> Starting position (row and column number on the 3270
screen) of the data to be copied.</p>
<p><strong>*len*</strong> Length of the data to be copied.</p>
<p><strong>*fragvar*</strong> The name of the table variable for the hidden HTML form
fields.</p>
<p>The table below shows the HTML attributes generated for each field and
3270 attribute position on the screen:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="14%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Attribute name</td>
<td>Meaning</td>
<td>Values</td>
</tr>
<tr class="row-even"><td>vt=</td>
<td>Field type</td>
<td>O&nbsp;=&nbsp;Output, I&nbsp;=&nbsp;Input, A&nbsp;=&nbsp;3270&nbsp;attribute, C&nbsp;=&nbsp;Character&nbsp;subspan</td>
</tr>
<tr class="row-odd"><td>vr=</td>
<td>Row</td>
<td>Row number (first row = 1)</td>
</tr>
<tr class="row-even"><td>vc=</td>
<td>Column</td>
<td>Column number (first column = 1)</td>
</tr>
<tr class="row-odd"><td>vp=</td>
<td>Position</td>
<td>Offset from start of screen (R1C1 = 0)</td>
</tr>
<tr class="row-even"><td>vl=</td>
<td>Length</td>
<td>Length of span or subspan</td>
</tr>
</tbody>
</table>
<p>An example of the GENERATE-VIR3270 tag is shown below:</p>
<p>&lt;pre&gt;&lt;div id=&#8221;printReady&#8221;&gt;{{{GENERATE-VIR3270 (1,1,1920) &#8220;INFIELDS&#8221;}}}</p>
<p>&lt;/div&gt;&lt;/pre&gt;</p>
<p>{{{DEFINE-HTML-PFKEY &#8220;pf&#8221;}}}&lt;input name=&#8221;pf&#8221; type=&#8221;HIDDEN&#8221;&gt;</p>
<p>&lt;div id=&#8221;infields&#8221;&gt;</p>
<p>{{{FOR-EACH-VALUE-IN &#8220;INFIELDS&#8221;}}}{{{CURRENT-VALUE-OF &#8220;INFIELDS&#8221;}}}</p>
<p>{{{END-FOR &#8220;INFIELDS&#8221;}}}</p>
<p>&lt;/div&gt;</p>
</div>
</div>
<div class="section" id="colour-and-font-management">
<h5>Colour and font management<a class="headerlink" href="#colour-and-font-management" title="Permalink to this headline">¶</a></h5>
<p>The management of the size and the colours of the text is effected for
all fields by means of the ON-ATTRIBUTE and ON-END-OF-ATTRIBUTE tags.
For applications which use 3270 character attributes (order code x’28’),
the colour and highlighting of individual characters within a field can
be managed by means of the ON-CHARACTER-ATTRIBUTE and
ON-END-OF-CHARACTER-ATTRIBUTE tags. Input fields may be supplied with
additional information by way of the ADD-TO-FIELDS tag.</p>
<div class="section" id="on-attribute-tag">
<h6>ON-ATTRIBUTE tag<a class="headerlink" href="#on-attribute-tag" title="Permalink to this headline">¶</a></h6>
<p>The ON-ATTRIBUTE and ON-END-OF-ATTRIBUTE tags allow HTML tags to be
inserted before and after each field depending on the 3270 attributes
specified by the host application.</p>
<p>{{{ ON-ATTRIBUTE (p1,p2,..,pn) &lt;standard HTML tag&gt; }}}</p>
<p>Inserts the value specified by “standard html tag” before the field when
the conditions p1 to pn are fulfilled. The parameters p1 to pn may
appear in any order, each parameter representing one of the following
values:</p>
<p><strong>*p1*</strong> Type of field</p>
<p>PROTECTED, UNPROTECTED, NON-DISPLAY, NUMERIC, MDTON,</p>
<p>DETECTABLE. ALPHANUMERIC, INTENSIFIED, BRIGHT, NORMAL</p>
<p><strong>*p2*</strong> Highlighting</p>
<p>NOHILIGHT, BLINK, REVERSE, UNDERSCORE</p>
<p><strong>*p3*</strong> Colour</p>
<p>NOCOLOR, BLUE, RED, PINK, GREEN, YELLOW, TURQUOISE, WHITE</p>
<p>When more than one ON-ATTRIBUTE tag matches the same field, the tags are
processed in reverse order and the generated HTML is accumulated from
each matching ON-ATTRIBUTE tag. The <em>WITH-NO-MATCH-BELOW</em> keyword allows
an ON-ATTRIBUTE tag to match the field only if no match has been found
with the ON-ATTRIBUTE tags already processed.</p>
</div>
<div class="section" id="on-end-of-attribute-tag">
<h6>ON-END-OF-ATTRIBUTE tag<a class="headerlink" href="#on-end-of-attribute-tag" title="Permalink to this headline">¶</a></h6>
<p>The presence of the ON-ATTRIBUTE tag requires the presence of an
ON-END-OF-ATTRIBUTE tag having the same values for the p1 to pn
parameters.</p>
<p>{{{ ON-END-OF-ATTRIBUTE (p1,p2,..,pn) &lt;standard HTML tag&gt;}}}</p>
<p>Inserts the value specified by “standard html tag” after the field when
the conditions p1 to pn are fulfilled.</p>
<p>As previously described for the ON-ATTRIBUTE tag, multiple matching
ON-END-OF-ATTRIBUTE tags are processed in reverse order, and the
optional <em>WITH-NO-MATCH-BELOW</em> keyword causes the ON-END-OF-ATTRIBUTE
tag to match only if no match has been found with the
ON-END-OF-ATTRIBUTE tags already processed.</p>
<p>Example:</p>
<p>{{{ ON-ATTRIBUTE (PROTECTED,WITH-NO-MATCH-BELOW)&lt;font color=green&gt;}}}</p>
<p>{{{ ON-END-OF-ATTRIBUTE (PROTECTED, WITH-NO-MATCH-BELOW)&lt;/font&gt;}}}</p>
<p>{{{ ON-ATTRIBUTE (PROTECTED,NORMAL,NOCOLOR)&lt;font color=#00CCFF&gt;}}}</p>
<p>{{{ ON-END-OF-ATTRIBUTE (PROTECTED,NORMAL,NOCOLOR)&lt;/font&gt;}}}</p>
<p>{{{ ON-ATTRIBUTE (PROTECTED,INTENSIFIED,NOCOLOR)&lt;font color=white&gt;}}}</p>
<p>{{{ ON-END-OF-ATTRIBUTE (PROTECTED,INTENSIFIED,NOCOLOR)&lt;/font&gt;}}}</p>
<p>{{{ ON-ATTRIBUTE (PROTECTED,BLUE)&lt;font color=#00CCFF&gt;}}}</p>
<p>{{{ ON-END-OF-ATTRIBUTE (PROTECTED,BLUE)&lt;/font&gt;}}}</p>
<p>{{{ ON-ATTRIBUTE (PROTECTED,RED)&lt;font color=#c41200&gt;}}}</p>
<p>{{{ ON-END-OF-ATTRIBUTE (PROTECTED,RED)&lt;/font&gt;}}}</p>
<p>{{{ ON-ATTRIBUTE (PROTECTED,PINK)&lt;font color=pink&gt;}}}</p>
<p>{{{ ON-END-OF-ATTRIBUTE (PROTECTED,PINK)&lt;/font&gt;}}}</p>
<p>{{{ ON-ATTRIBUTE (PROTECTED,GREEN)&lt;font color=#00FF00&gt;}}}</p>
<p>{{{ ON-END-OF-ATTRIBUTE (PROTECTED,GREEN)&lt;/font&gt;}}}</p>
<p>{{{ ON-ATTRIBUTE (PROTECTED,TURQUOISE)&lt;font color=#40E0D0&gt;}}}</p>
<p>{{{ ON-END-OF-ATTRIBUTE (PROTECTED,TURQUOISE)&lt;/font&gt;}}}</p>
<p>{{{ ON-ATTRIBUTE (PROTECTED,YELLOW)&lt;font color=#FFFF33&gt;}}}</p>
<p>{{{ ON-END-OF-ATTRIBUTE (PROTECTED,YELLOW)&lt;/font&gt;}}}</p>
<p>{{{ ON-ATTRIBUTE (PROTECTED,WHITE)&lt;font color=white&gt;}}}</p>
<p>{{{ ON-END-OF-ATTRIBUTE (PROTECTED,WHITE)&lt;/font&gt;}}}</p>
<p>Figure 1‑8 Example set of ON-ATTRIBUTE and ON-END-OF-ATTRIBUTE tags</p>
</div>
<div class="section" id="on-character-attribute-tag">
<h6>ON-CHARACTER-ATTRIBUTE tag<a class="headerlink" href="#on-character-attribute-tag" title="Permalink to this headline">¶</a></h6>
<p>If the page template contains ON-CHARACTER-ATTRIBUTE and
ON-END-OF-CHARACTER-ATTRIBUTE tags, changes in colour or highlighting of
individual characters within a field are surrounded by the specified
HTML code during processing by GENERATE-HTML. Since HTML code cannot be
included in the “value” clause of an input field, GENERATE-HTML does not
generate HTML code for character attributes within input fields.</p>
<p>{{{ ON-CHARACTER-ATTRIBUTE (p1,p2) &lt;standard HTML tag&gt; }}}</p>
<p><strong>*p1,p2*</strong> Highlighting and colour parameters as specified for the
ON-ATTRIBUTE tag.</p>
</div>
<div class="section" id="on-end-of-character-attribute-tag">
<h6>ON-END-OF-CHARACTER-ATTRIBUTE tag<a class="headerlink" href="#on-end-of-character-attribute-tag" title="Permalink to this headline">¶</a></h6>
<p>The ON-END-OF-CHARACTER-ATTRIBUTE tag specifies the HTML code to be
inserted at the termination of a character string opened by an
ON-CHARACTER-ATTRIBUTE tag.</p>
<p>{{{ ON-END-OF-CHARACTER-ATTRIBUTE (p1,p2) &lt;standard HTML tag&gt;}}}</p>
</div>
<div class="section" id="add-to-fields-tag">
<h6>ADD-TO-FIELDS tag<a class="headerlink" href="#add-to-fields-tag" title="Permalink to this headline">¶</a></h6>
<p>The presence of an ADD-TO-FIELDS tag allows the definition of each HTML
input field to be modified according to the 3270 attributes specified by
the host application.</p>
<p>{{{ ADD-TO-FIELDS (p1,p2,..,pn) part of standard HTML tag }}}</p>
<p>Inserts the value specified by “part of standard html tag” into the HTML
&lt;INPUT&gt; tag when the conditions p1 to pn (described in the previous
paragraph) are fulfilled.</p>
<p>When more than one ADD-TO-FIELDS tag matches the same field, the tags
are processed in order of appearance and the generated HTML is
accumulated from each matching ADD-TO-FIELDS tag. The
<em>WITH-NO-MATCH-ABOVE</em> keyword allows an ADD-TO-FIELDS tag to match the
field only if no match has been found with the ADD-TO-FIELDS tags
already processed.</p>
<p>Example:</p>
<p>{{{ ADD-TO-FIELDS (NORMAL,NOCOLOR) class=&#8221;GREEN&#8221; }}}</p>
<p>{{{ ADD-TO-FIELDS (INTENSIFIED,NOCOLOR) class=&#8221;RED&#8221; }}}</p>
<p>{{{ ADD-TO-FIELDS (BLUE) class=&#8221;BLUE&#8221; }}}</p>
<p>{{{ ADD-TO-FIELDS (RED) class=&#8221;RED&#8221; }}}</p>
<p>{{{ ADD-TO-FIELDS (PINK) class=&#8221;PINK&#8221; }}}</p>
<p>{{{ ADD-TO-FIELDS (GREEN) class=&#8221;GREEN&#8221; }}}</p>
<p>{{{ ADD-TO-FIELDS (TURQUOISE) class=&#8221;TURQUOISE&#8221; }}}</p>
<p>{{{ ADD-TO-FIELDS (YELLOW) class=&#8221;YELLOW&#8221; }}}</p>
<p>{{{ ADD-TO-FIELDS (WHITE) class=&#8221;WHITE&#8221; }}}</p>
<p>{{{ ADD-TO-FIELDS (DISPLAY,WITH-NO-MATCH-ABOVE) class=&#8221;GREEN&#8221; }}}</p>
<p>Figure 1‑9 Example set of ADD-TO-FIELDS tags</p>
<p>In the above example, the parameter class makes reference to a style
class defined in the HTML page header:</p>
<p>&lt;head&gt;</p>
<p>&lt;meta http-equiv=&#8221;Content-Type&#8221; content=&#8221;text/html; charset=iso-8859-1&#8221;&gt;</p>
<p>&lt;style&gt;&lt;!&#8211;</p>
<p>.BLUE {font-family: monospace; background: #00CCFF; }</p>
<p>.RED {font-family: monospace; background: red; }</p>
<p>.PINK {font-family: monospace; background: pink; }</p>
<p>.GREEN {font-family: monospace; background: #00FF00;}</p>
<p>.TURQUOISE {font-family: monospace; background: #40E0D0; }</p>
<p>.YELLOW {font-family: monospace; background: #FFFF33;}</p>
<p>.WHITE {font-family: monospace; background: #FFFFFF; }</p>
<p>//&#8211;&gt;&lt;/style&gt;</p>
<p>&lt;!&#8211;VIRTEL start=&#8221;{{{&#8221; end=&#8221;}}}&#8221; &#8211;&gt;</p>
<p>&lt;title&gt;Syspertec - example of generation of HTML pages}}} &lt;/title&gt;</p>
<p>&lt;/head&gt;</p>
<p>Figure 1‑10 Example styles for ADD-TO-FIELDS tags</p>
<p>For certain fields, the action of the ADD-TO-FIELDS tag may be nullified
by the NO-ADD-TO-CHECKBOX and NO-ADD-TO-LISTBOX local options (see
“Setting and unsetting local options” sur la page 49).</p>
<p>The ADD-TO-FIELDS tag affects input fields only</p>
</div>
</div>
<div class="section" id="cursor-management">
<h5>Cursor management<a class="headerlink" href="#cursor-management" title="Permalink to this headline">¶</a></h5>
<p>In each message sent from the host application to the browser, VIRTEL
automatically manages the positioning of the cursor insofar as is
possible. Conversely, when a message is sent to VIRTEL from the browser,
it is necessary to know the position of the cursor in order to inform
the application on the host side. The cursor position cannot be handled
relatively therefore, the cursor’s exact position is communicated via a
hidden field specifying the name of the field having the focus at the
time of transmission.</p>
<p>Cursor management is determined by the tags DEFINE-HTML-FOCUS-FIELD,
FIELD-WITH-CURSOR, DEFAULT-FIELD-WITH-CURSOR and by two JavaScript
procedures. More precise positioning of the cursor can be controlled by
the optional tags DEFINE-CURSOR-POSITION-FIELD and
POSITION-OF-THE-CURSOR.</p>
<div class="section" id="define-html-focus-field-tag">
<h6>DEFINE-HTML-FOCUS-FIELD tag<a class="headerlink" href="#define-html-focus-field-tag" title="Permalink to this headline">¶</a></h6>
<p>The DEFINE-HTML-FOCUS-FIELD tag informs VIRTEL of the existence of the
<em>focusField</em>.</p>
<p>{{{ DEFINE-HTML-FOCUS-FIELD &#8220;focusField&#8221; }}}</p>
<p>The <em>focusField</em> is a hidden field which will receive the name of the
field having the focus, that is to say the input field on which the
cursor is positioned, at the moment of transmission of a message from
the browser to VIRTEL.</p>
<p>This field must be defined in the following way:</p>
<p>&lt;INPUT NAME=&#8221;focusField&#8221; TYPE=&#8221;HIDDEN&#8221; VALUE=&#8221;{{{FIELD-WITH-CURSOR}}}&#8221;&gt;</p>
</div>
<div class="section" id="define-cursor-position-field-tag">
<h6>DEFINE-CURSOR-POSITION-FIELD tag<a class="headerlink" href="#define-cursor-position-field-tag" title="Permalink to this headline">¶</a></h6>
<p>The DEFINE-CURSOR-POSITION-FIELD tag informs VIRTEL of the existence of
the <em>cursorField</em>.</p>
<p>{{{ DEFINE-CURSOR-POSITION-FIELD &#8220;cursorField&#8221; }}}</p>
<p>The <em>cursorField</em> is an optional hidden field in which the JavaScript
routines may place the exact position of the cursor when a message is
transmitted from the browser to VIRTEL. The cursor position is indicated
by a string of the format V<em>nnnnnnn</em> or P<em>nnnnnnn</em>, where V
indicates that the cursor is in a non-protected (input) field, P
indicates a protected (output) field, and <em>nnnnnnn</em> is the hexadecimal
offset of the cursor from the start of the screen (where 0000000
represents row 1 column 1).</p>
<p>The <em>cursorField</em> must be defined in the following way:</p>
<p>&lt;INPUT NAME=&#8221;cursorField&#8221; TYPE=&#8221;HIDDEN&#8221; VALUE=&#8221;&#8220;&gt;</p>
<p>If both <em>focusField</em> and <em>cursorField</em> are sent to VIRTEL, then VIRTEL
will use <em>cursorField</em> to determine the position of the cursor.</p>
</div>
<div class="section" id="field-with-cursor-tag">
<h6>FIELD-WITH-CURSOR tag<a class="headerlink" href="#field-with-cursor-tag" title="Permalink to this headline">¶</a></h6>
<p>The FIELD-WITH-CURSOR tag enables VIRTEL to insert the name of the field
having the focus at the time of transmission of the message to the
browser.</p>
<p>{{{ FIELD-WITH-CURSOR }}}</p>
</div>
<div class="section" id="default-field-with-cursor-tag">
<h6>DEFAULT-FIELD-WITH-CURSOR tag<a class="headerlink" href="#default-field-with-cursor-tag" title="Permalink to this headline">¶</a></h6>
<p>The DEFAULT-FIELD-WITH-CURSOR tag specifies the name generated by the
FIELD-WITH-CURSOR tag when the 3270 screen contains no input fields.</p>
<p>{{{ DEFAULT-FIELD-WITH-CURSOR &#8220;fieldname&#8221; }}}</p>
<p>In the DEFAULT-FIELD-WITH-CURSOR tag, <em>fieldname</em> must be the name of an
HTML input field defined in the template page. If no
DEFAULT-FIELD-WITH-CURSOR tag is present, and the screen contains no
input fields, VIRTEL will convert the first field on the screen into an
input field, so that the FIELD-WITH-CURSOR tag can generate the name of
a valid input field.</p>
</div>
<div class="section" id="positioning-the-focus-when-a-message-is-sent-to-the-browser">
<h6>Positioning the focus when a message is sent to the browser<a class="headerlink" href="#positioning-the-focus-when-a-message-is-sent-to-the-browser" title="Permalink to this headline">¶</a></h6>
<p>The positioning of the focus is done with the help of a JavaScript
procedure referenced by the &lt;BODY&gt; tag of the HTML page:</p>
<p><strong>*Script for focus position management*</strong></p>
<p>&lt;script language=&#8221;Javascript&#8221;&gt;</p>
<p>&lt;!&#8211; comment to mask script for some browsers</p>
<p>function setfocus()</p>
<p>{</p>
<p>document.virtelForm.{{{ FIELD-WITH-CURSOR }}}.focus();</p>
<p>}</p>
<p>//&#8211;&gt;</p>
<p>&lt;/script&gt;</p>
<p><strong>*Cursor position initialisation*</strong></p>
<p>&lt;body onload=&#8221;setfocus()&#8221;&gt;</p>
</div>
<div class="section" id="positioning-the-focus-in-the-browser">
<h6>Positioning the focus in the browser<a class="headerlink" href="#positioning-the-focus-in-the-browser" title="Permalink to this headline">¶</a></h6>
<p>Once present in the client&#8217;s browser, the user may need to move the
focus to a different field, either by using the TAB key on the keyboard
or by using the mouse. The <em>focusField</em> field is automatically updated
if the ADD-TO-FIELDS tag calls a script which updates the focus field.</p>
<p><strong>*Script for saving the name of the field having the focus*</strong></p>
<p>&lt;script language=&#8221;Javascript&#8221;&gt;</p>
<p>&lt;!&#8211; comment to mask script for some browsers</p>
<p>function savefocus(CurrentFieldName)</p>
<p>{</p>
<p>document.virtelForm.focusField.value = CurrentFieldName;</p>
<p>}</p>
<p>//&#8211;&gt;</p>
<p>&lt;/script&gt;</p>
<p><strong>*Automatic call of the update script*</strong></p>
<p>{{{ ADD-TO-FIELDS onfocus = &#8220;savefocus(this.name)&#8221; }}}</p>
</div>
<div class="section" id="position-of-the-cursor-tag">
<h6>POSITION-OF-THE-CURSOR tag<a class="headerlink" href="#position-of-the-cursor-tag" title="Permalink to this headline">¶</a></h6>
<p>The POSITION-OF-THE-CURSOR tag allows VIRTEL to send the exact position
of the cursor to the browser by including a string of the format
V<em>nnnnnnn</em> or P<em>nnnnnnn</em> in the HTML page. V<em>nnnnnnn</em> means that
the cursor is in a non-protected (input) field. P<em>nnnnnnn</em> means that
the cursor is in a protected (output) field. In both cases, <em>nnnnnnn</em> is
the hexadecimal offset of the cursor from the start of the screen (where
0000000 represents row 1 column 1).</p>
<p>{{{ POSITION-OF-THE-CURSOR }}}</p>
</div>
</div>
<div class="section" id="function-key-management">
<h5>Function key management<a class="headerlink" href="#function-key-management" title="Permalink to this headline">¶</a></h5>
<p>By design, the transmission of information delivered by a 3270
application is effected by using only the function keys, usually the PF
and PA keys. Also by design, the navigation from an HTML page is
radically different, generally using the mouse to submit requests to the
HTTP server. This difference in philosophy makes it difficult, even
impossible in certain instances, to detect the use of a function key via
the browser. Conserving the ergonomic aspects of the web in an
application that allows full use of the function keys is naturally not
an easy thing to do, it is, however, made possible by the following
functions.</p>
<div class="section" id="definition-of-the-pfkfield-field">
<h6>Definition of the <em>pfkField</em> field<a class="headerlink" href="#definition-of-the-pfkfield-field" title="Permalink to this headline">¶</a></h6>
<p>As with the management of the cursor, the <em>pfkField</em> is a hidden field
designed to accept the name of the function key that VIRTEL must use to
transmit data to the application on the host.</p>
<p>&lt;INPUT NAME=&#8221;pfkField&#8221; TYPE=&#8221;HIDDEN&#8221; VALUE=&#8221;ENTER&#8221;&gt;</p>
<p>VIRTEL is notified of the existence of the field by the following tag:</p>
<p>{{{ DEFINE-HTML-PFKEY = &#8220;pfkField&#8221; }}}</p>
</div>
<div class="section" id="updating-the-pfkfield">
<h6>Updating the <em>pfkField</em><a class="headerlink" href="#updating-the-pfkfield" title="Permalink to this headline">¶</a></h6>
<p>The field <em>pfkField</em> is updated by using a JavaScript procedure called
at the time of the submission of the request. The script used is
referenced in the BUTTON field definition or in the HTML link used for
the submission.</p>
<p><strong>*Save the name of the field having the focus*</strong></p>
<p>&lt;script language=&#8221;Javascript&#8221;&gt;</p>
<p>&lt;!&#8211; comment to mask script for some browsers</p>
<p>function submitform(pfkey)</p>
<p>{</p>
<p>document.virtelForm.pfkField.value = pfkey;</p>
<p>document.virtelForm.submit();</p>
<p>}</p>
<p>//&#8211;&gt;</p>
<p>&lt;/script&gt;</p>
<p><strong>*Automatic call of the update script from a field of type BUTTON*</strong></p>
<p>&lt;INPUT TYPE=&#8221;BUTTON&#8221; size=&#8221;5&#8221; VALUE=&#8221;PF01&#8221;</p>
<p>onclick=&#8221;submitform(this.value)&#8221;&gt;</p>
<p><strong>*Automatic call of the SCRIPT from a hypertext link*</strong></p>
<p>&lt;a href=&#8221;<a class="reference external" href="javascript:submitform('PF1">javascript:submitform(&#8216;PF1</a>&#8216;)&#8221; &gt;submit with PF01&lt;/a&gt;</p>
<p>The function keys may be defined in the following manner in the “value”
keyword of the INPUT TYPE=BUTTON field.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>3270 function key</strong></td>
<td><strong>PfkField value</strong></td>
</tr>
<tr class="row-even"><td>ENTER</td>
<td>ENTER</td>
</tr>
<tr class="row-odd"><td>CLEAR SCREEN</td>
<td>CLEAR</td>
</tr>
<tr class="row-even"><td>PA1, PA2, PA3</td>
<td>PA1, PA2, PA3</td>
</tr>
<tr class="row-odd"><td>PF1 to PF24</td>
<td>PF01 to PF24 (variations PF1, F1, F01, P1, P01 are also accepted)</td>
</tr>
<tr class="row-even"><td>Attention</td>
<td>ATTN</td>
</tr>
</tbody>
</table>
<p>Figure 1‑11 Function key values for pfkField</p>
</div>
<div class="section" id="disallowed-function-keys">
<h6>Disallowed function keys<a class="headerlink" href="#disallowed-function-keys" title="Permalink to this headline">¶</a></h6>
<p>Certain function keys may be explicitly restricted by means of the
INVALID-PFKEYS tag containing the list of prohibited PF keys.</p>
<p>{{{ INVALID-PFKEYS (pfk1, pfk2, .. , pfkn) }}}</p>
<p>On the other hand, an exhaustive list of authorised function keys may be
specified with the VALID-PFKEYS tag.</p>
<p>{{{ VALID-PFKEYS (pfk1, pfk2, .. , pfkn) }}}</p>
<p>For example,</p>
<p><strong>*Disallow ATTN, PF08 and PF24*</strong></p>
<p>{{{ INVALID-PFKEYS (ATTN,PF08,PF24) }}}</p>
<p><strong>*Disallow all function keys except ENTER and PF03*</strong></p>
<p>{{{ VALID-PFKEYS (ENTER,PF03) }}}</p>
</div>
<div class="section" id="pf-key-processing-by-scenario">
<h6>PF key processing by scenario<a class="headerlink" href="#pf-key-processing-by-scenario" title="Permalink to this headline">¶</a></h6>
<p>A page template can generate a “pseudo-PFkey” intended to be interpreted
by an INPUT scenario. This is done by setting the <em>pfkField</em> to a value
beginning with SCENARIO. The pseudo-PFKey will be accepted by VIRTEL and
treated as ENTER, but it will not be transmitted to the application. The
scenario can retrieve the value of the <em>pfkField</em> by means of the
COPY$&nbsp;INPUT-TO-VARIABLE instruction. For example:</p>
<p><strong>*Definition of the BUTTON field in the page template:*</strong></p>
<p>{{{ DEFINE-HTML-PFKEY &#8220;pf&#8221; }}}</p>
<p>&lt;INPUT TYPE=&#8221;BUTTON&#8221; size=&#8221;5&#8221; VALUE=&#8221;SCENARIO-DFHMDF&#8221;</p>
<p>onclick=&#8221;submitform(this.value)&#8221;&gt;</p>
<p><strong>*Retrieving and testing the PF key value in the INPUT scenario:*</strong></p>
<p>COPY$ INPUT-TO-VARIABLE,FIELD=&#8217;pf&#8217;,VAR=&#8217;PF&#8217;</p>
<p>IF$ NOT-FOUND,THEN=NOPARAMS</p>
<p>CASE$ &#8216;PF&#8217;,(NE,&#8217;SCENARIO-DFHMDF&#8217;,NOPARAMS)</p>
<p>* generate the screen capture:</p>
<p>COPY$ OUTPUT-FILE-TO-VARIABLE, *</p>
<p>FILE=&#8217;DFHMDF.TXT&#8217;,VAR=&#8217;CAPTURE&#8217;</p>
<p>* send result to browser</p>
<p>SEND$ AS-FILE,VAR=&#8217;CAPTURE&#8217;, *</p>
<p>TYPE=&#8217;text/plain&#8217;,NAME=&#8217;dfhmdf.asm&#8217;</p>
<p>NOPARAMS EQU *</p>
</div>
<div class="section" id="the-null-pf-key">
<h6>The Null PF key<a class="headerlink" href="#the-null-pf-key" title="Permalink to this headline">¶</a></h6>
<p>A page template or JavaScript program can request VIRTEL to resend the
contents of the current 3270 screen, without sending any input to the
host application, by setting the <em>pfkField</em> to the value <strong>NULL-PF</strong></p>
</div>
</div>
<div class="section" id="setting-and-unsetting-local-options">
<h5>Setting and unsetting local options<a class="headerlink" href="#setting-and-unsetting-local-options" title="Permalink to this headline">¶</a></h5>
<p>The SET-LOCAL-OPTIONS and UNSET-LOCAL-OPTIONS tags allow the activation
or deactivation of miscellaneous processing options associated with HTML
generation. These options are normally deactivated, but any or all of
them can be activated by default using the HTSETn parameters in the
VIRTCT. Refer to the VIRTEL Installation Guide for details of the HTSETn
parameters. The SET-LOCAL-OPTIONS and UNSET-LOCAL-OPTIONS tags apply
only to the current page, and take effect from the point in the page at
which they appear.</p>
<p>The options which can be specified are:</p>
<p>MAXLENGTH Indicates that VIRTEL will generate HTML input fields with the
parameter “maxlength” in addition to “size”. The “maxlength” parameter
ensures that the number of characters that can be entered into an HTML
field does not exceed the 3270 field length. By default, VIRTEL does not
generate “maxlength”, which allows an unlimited number of characters to
be entered in each HTML field, and VIRTEL truncates the value as
necessary before sending the data to the host application.</p>
<p>ID Indicates that VIRTEL will generate HTML input fields with the
parameter “id” in addition to the “name” parameter. The “id” has the
same value as the “name”. This is intended for use with JavaScript code
which refers to VIRTEL-generated fields using the getElementById method.</p>
<div class="line-block">
<div class="line">DO-NOT-IGNORE-BINARY-ZEROES</div>
<div class="line">When this option is activated, then all 3270 NUL characters in input
fields generated by VIRTEL will be sent to the browser as SUB
characters (x&#8216;1A&#8217;). When this option is not activated, then VIRTEL
will remove 3270 NUL characters from input fields.</div>
</div>
<div class="line-block">
<div class="line">BLANK-BINARY-ZEROES</div>
<div class="line">Affects the processing of the COPY-FROM and GENERATE-VARIABLES tags
(see “Inserting host application data in a page” sur la page 32).</div>
</div>
<p>HTML-ESCAPES, JAVASCRIPT-ESCAPES, JSON-ESCAPES,</p>
<div class="line-block">
<div class="line">NO-ESCAPES, XML-ESCAPES</div>
<div class="line">Affects the processing of the CURRENT-VALUE-OF, TRIMMED-VALUE-OF and
NO-BLANKS-VALUE-OF tags (see “Handling table variables” sur la page
53). Similarly affects the processing of the values generated by
GENERATE-VARIABLES.</div>
</div>
<div class="line-block">
<div class="line">AUTO-INCREMENT-VARIABLES</div>
<div class="line">When this option is activated, table variables referenced outside a
FOR-EACH-VALUE-IN loop will be automatically advanced to their next
value each time they are reused. If this option is not active, the
CURRENT-VALUE-OF tag always produces the first value of a table
variable when it is referenced outside a loop.</div>
</div>
<div class="line-block">
<div class="line">NO-ADD-TO-CHECKBOX</div>
<div class="line">When this option is activated, HTML attributes defined within an
ADD-TO-FIELDS tag (sur la page 41) are not added to
<em>&lt;input&nbsp;type=checkbox&gt;</em> clauses generated by the GENERATE-HTML tag
(sur la page 32) in conjunction with the FIELD$&nbsp;IS-BINARY-CHOICE
instruction (sur la page 182).</div>
</div>
<div class="line-block">
<div class="line">NO-ADD-TO-LISTBOX</div>
<div class="line">When this option is activated, HTML attributes defined within an
ADD-TO-FIELDS tag (sur la page 41) are not added to <em>&lt;select&gt;</em> clauses
generated by the GENERATE-HTML tag (sur la page 32) in conjunction
with the FIELD$&nbsp;DEFINE-CHOICE or FIELD$&nbsp;DEFINE-VARIABLE-CHOICE
instructions (sur la page 181).</div>
</div>
<div class="line-block">
<div class="line">MDT-IF-RECEIVED</div>
<div class="line">When this option is activated, VIRTEL will consider all input fields
received from the browser to be “modified” fields to be sent to the
host application. Fields in the page not received from the browser are
considered to be unmodified and are not sent to the host application.
When this option is not activated, VIRTEL inspects the contents of all
fields received from the browser to determine whether the field has
been modified. VIRTEL sends modified fields to the host application,
and any fields not received from the browser are sent as empty fields.
<em>Notes: (1) This option must be coded in the page template before the
fields to which it applies. (2) This option cannot be specified in the
VIRTCT</em></div>
</div>
<p>TRACE-LINE Setting this option within a page starts a VIRTEL line trace
on the HTTP line. Unsetting this option stops the line trace. Refer to
the <em>VIRTEL Messages and Operations Guide</em> for more information about
line traces.</p>
<p>TRACE-RELAY Setting this option within a page starts a VIRTEL terminal
trace on the VTAM session. Unsetting this option stops the terminal
trace. Refer to the <em>VIRTEL Messages and Operations Guide</em> for more
information about terminal traces.</p>
<div class="section" id="set-local-options-tag">
<h6>SET-LOCAL-OPTIONS tag<a class="headerlink" href="#set-local-options-tag" title="Permalink to this headline">¶</a></h6>
<p>The SET-LOCAL-OPTIONS tag activates one or more HTML processing options
for the remainder of the current page, or until deactivated by
UNSET-LOCAL-OPTIONS:</p>
<p>{{{ SET-LOCAL-OPTIONS (option, option, ...) }}}</p>
<p><strong>*option*</strong> one or more HTML processing options as described above.</p>
</div>
<div class="section" id="unset-local-options-tag">
<h6>UNSET-LOCAL-OPTIONS tag<a class="headerlink" href="#unset-local-options-tag" title="Permalink to this headline">¶</a></h6>
<p>The UNSET-LOCAL-OPTIONS tag deactivates one or more HTML processing
options previously activated by SET-LOCAL-OPTIONS or by HTSETn. The
specified options are deactivated for the remainder of the current page,
or until reactivated by SET-LOCAL-OPTIONS:</p>
<p>{{{ UNSET-LOCAL-OPTIONS (option, option, ...) }}}</p>
<p><strong>*option*</strong> one or more HTML processing options as described above.</p>
</div>
</div>
<div class="section" id="handling-table-variables">
<h5>Handling table variables<a class="headerlink" href="#handling-table-variables" title="Permalink to this headline">¶</a></h5>
<p>A table variable is a list of values sent to VIRTEL by a host
application in a structured field of type FAE5 or FAE6 (described sur la
page 275). Table variables may also be created by means of a VIRTEL tag
embedded in the page template (see “CREATE-VARIABLE-FROM tag” sur la
page 34), via a scenario (see “COPY$ instruction” sur la page 157), or
by means of a S&nbsp;VARIABLE command contained in the host 3270 datastream
(see “HOST4WEB commands” sur la page 287).</p>
<div class="section" id="for-each-value-in-tag">
<h6>FOR-EACH-VALUE-IN tag<a class="headerlink" href="#for-each-value-in-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{FOR-EACH-VALUE-IN &#8220;varname&#8221;}}}</p>
<p>The FOR-EACH-VALUE-IN tag marks the start of a loop. <em>varname</em> is the
name of a table variable. VIRTEL generates everything between the
FOR-EACH-VALUE-IN tag and the END-FOR tag once for each value in
<em>varname</em>. If <em>varname</em> has no values then nothing is generated. The
current value of <em>varname,</em> and of any other table variables referenced
in the loop, changes when the END-FOR tag is encountered.</p>
</div>
<div class="section" id="current-value-of-tag">
<h6>CURRENT-VALUE-OF tag<a class="headerlink" href="#current-value-of-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{CURRENT-VALUE-OF &#8220;varname&#8221;}}}</p>
<p>The CURRENT-VALUE-OF tag is used in a loop bracketed by the
FOR-EACH-VALUE-IN and END-FOR tags. <em>varname</em> is the name of a table
variable. If it is the variable named in the FOR-EACH-VALUE-IN tag, it
determines the number of iterations of the loops. Otherwise, its value
is simply changed when the END-FOR tag is encountered.</p>
<p>The CURRENT-VALUE-OF tag also allows variables to be inserted in a
template page outside of a FOR-EACH-VALUE-IN loop. In this case, the
variable <em>varname</em> must have been created from the HTTP request by an
INPUT scenario by means of the COPY$ INPUT-TO-VARIABLE instruction.</p>
<p>The local options HTML-ESCAPES, JAVASCRIPT-ESCAPES, JSON-ESCAPES,
NO-ESCAPES, and XML-ESCAPES (see “Setting and unsetting local options”
sur la page 49) may affect the processing of this tag.</p>
<p>If the HTML-ESCAPES local option is set, special characters in the value
of the variable will be replaced by the corresponding HTML escape
sequence as shown in the table below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="32%" />
<col width="18%" />
<col width="32%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Character</td>
<td>HTML escape sequence</td>
<td>Character</td>
<td>HTML escape sequence</td>
</tr>
<tr class="row-even"><td>&lt;</td>
<td>&amp;gt;</td>
<td>&gt;</td>
<td>&amp;lt;</td>
</tr>
<tr class="row-odd"><td>&#8220;</td>
<td>&amp;quote;</td>
<td>&amp;</td>
<td>&amp;amp;</td>
</tr>
</tbody>
</table>
<p>If the JAVASCRIPT-ESCAPES local option is set, special characters in the
value of the variable will be replaced by the corresponding JavaScript
escape sequence as shown in the table below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="35%" />
<col width="15%" />
<col width="35%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Character</td>
<td>JavaScript escape sequence</td>
<td>Character</td>
<td>JavaScript escape sequence</td>
</tr>
<tr class="row-even"><td>&#8220;</td>
<td>\&#8221;</td>
<td>\</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>&#8216;</td>
<td>\&#8217;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>If the JSON-ESCAPES local option is set, special characters in the value
of the variable will be replaced by the corresponding JSON escape
sequence as shown in the table below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="31%" />
<col width="17%" />
<col width="31%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Character</td>
<td>JSON escape sequence</td>
<td>Character</td>
<td>JSON escape sequence</td>
</tr>
<tr class="row-even"><td>&#8220;</td>
<td>\&#8221;</td>
<td>\</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Hex 00 to 1f</td>
<td>\u<em>xxxx</em></td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>If the XML-ESCAPES local option is set, special characters in the value
of the variable will be replaced by the corresponding XML escape
sequence as shown in the table below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="32%" />
<col width="18%" />
<col width="32%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Character</td>
<td>XML escape sequence</td>
<td>Character</td>
<td>XML escape sequence</td>
</tr>
<tr class="row-even"><td>&lt;</td>
<td>&amp;#60;</td>
<td>&gt;</td>
<td>&amp;#62;</td>
</tr>
<tr class="row-odd"><td>&#8220;</td>
<td>&amp;#34;</td>
<td>&amp;</td>
<td>&amp;#38;</td>
</tr>
<tr class="row-even"><td>&#8216;</td>
<td>&amp;#39;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>Setting any of the HTML-ESCAPES, JAVASCRIPT-ESCAPES, JSON-ESCAPES, or
XML-ESCAPES local options causes the other options to be automatically
unset.</p>
<p>Setting the NO-ESCAPES local option disables all escape processing.</p>
</div>
<div class="section" id="no-blanks-value-of-tag">
<h6>NO-BLANKS-VALUE-OF tag<a class="headerlink" href="#no-blanks-value-of-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{NO-BLANKS-VALUE-OF &#8220;varname&#8221;}}}</p>
<p>The NO-BLANKS-VALUE-OF tag is similar to the CURRENT-VALUE-OF tag, but
the value is truncated at the first blank.</p>
</div>
<div class="section" id="trimmed-value-of-tag">
<h6>TRIMMED-VALUE-OF tag<a class="headerlink" href="#trimmed-value-of-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{TRIMMED-VALUE-OF &#8220;varname&#8221;}}}</p>
<p>The TRIMMED-VALUE-OF tag is similar to the CURRENT-VALUE-OF tag, except
that leading and trailing blanks (if any) are removed from the value
before it is substituted in the page.</p>
</div>
<div class="section" id="end-for-tag">
<h6>END-FOR tag<a class="headerlink" href="#end-for-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{END-FOR &#8220;varname&#8221;}}}</p>
<p>The END-FOR tag marks the end of a loop started by the FOR-EACH-VALUE-IN
tag.</p>
</div>
<div class="section" id="advance-to-next-value-of-tag">
<h6>ADVANCE-TO-NEXT-VALUE-OF tag<a class="headerlink" href="#advance-to-next-value-of-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ADVANCE-TO-NEXT-VALUE-OF &#8220;varname&#8221;}}}</p>
<p>The ADVANCE-TO-NEXT-VALUE-OF tag causes subsequent references to the
table variable <em>varname</em> (via the CURRENT-VALUE-OF tag, the
TRIMMED-VALUE-OF tag, or the NO-BLANKS-VALUE-OF tag) to refer to the
next value in the table.</p>
</div>
<div class="section" id="do-count-up-with-tag">
<h6>DO-COUNT-UP-WITH tag<a class="headerlink" href="#do-count-up-with-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{DO-COUNT-UP-WITH &#8220;varname&#8221;}}}</p>
<p>The DO-COUNT-UP-WITH tag marks the start of a loop. <em>varname</em> is the
name of a variable. VIRTEL generates everything between the
DO-COUNT-UP-WITH tag and the END-DO-COUNT tag <em>n</em> times, where <em>n</em> is
the current value of <em>varname</em>. During the execution of the loop, the
value of <em>varname</em> varies from 1 to <em>n</em>, and other table variables
referenced in the loop change when the END-DO-COUNT tag is encountered.</p>
</div>
<div class="section" id="end-do-count-tag">
<h6>END-DO-COUNT tag<a class="headerlink" href="#end-do-count-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{END-DO-COUNT &#8220;varname&#8221;}}}</p>
<p>The END-DO-COUNT tag marks the end of a loop started by the
DO-COUNT-UP-WITH tag.</p>
</div>
<div class="section" id="define-automatic-counter-tag">
<h6>DEFINE-AUTOMATIC-COUNTER tag<a class="headerlink" href="#define-automatic-counter-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{DEFINE-AUTOMATIC-COUNTER (init, incr, max) &#8220;varname&#8221;}}}</p>
<p>The DEFINE-AUTOMATIC-COUNTER tag allows automatic generation of a
counter variable in a loop started by the FOR-EACH-VALUE-IN tag. The
parameters are:</p>
<p><strong>*init*</strong> the initial value of the counter variable</p>
<p><strong>*incr*</strong> the increment added at each END-FOR</p>
<p><strong>*max*</strong> the maximum value of the counter variable</p>
<p><strong>*varname*</strong> the name of the counter variable</p>
<p>The variable generated can be the loop master variable (the variable
named in the FOR-EACH-VALUE-IN) or a slave variable. When the counter
reaches its maximum value, the loop terminates if it is the master, or
continues if it is the slave. In the latter case the counter variable
starts again from its initial value.</p>
</div>
<div class="section" id="define-sub-variable-tag">
<h6>DEFINE-SUB-VARIABLE tag<a class="headerlink" href="#define-sub-variable-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{DEFINE-SUB-VARIABLE (offset, length, count) &#8220;subname&#8221;}}}</p>
<p>The DEFINE-SUB-VARIABLE tag allows a sub-variable to be defined. A
sub-variable remaps part of the current value of the loop master
variable in a FOR-EACH-VALUE-IN loop. The parameters are:</p>
<p><strong>*offset*</strong> the offset of the sub-variable in the loop master variable</p>
<p><strong>*length*</strong> the length (in characters) of the sub-variable</p>
<p><strong>*count*</strong> the number of occurrences of the sub-variable</p>
<p><strong>*subname*</strong> the name of the sub-variable</p>
<p>A sub-variable consists of <em>count</em> values, each of <em>length</em> bytes,
starting at <em>offset</em> in the loop master variable. The first byte of the
loop master variable is considered to be offset 0. Sub-variables are
<em>defined outside</em> but <em>referenced within</em> a FOR-EACH-VALUE-IN loop. A
sub-variable can be referenced wherever a normal table variable would be
valid, including the loop master variable of an inner FOR-EACH-VALUE-IN
loop, which could in itself be redefined by other sub-variables. When
the sub-variable is referenced, it acts as an implicit redefinition of
the current value of the master variable of the innermost
FOR-EACH-VALUE-IN loop in which the reference appears. Thus, the same
sub-variable could possibly redefine different loop master variables if
it is referenced in more than one place.</p>
</div>
<div class="section" id="delete-all-variables-tag">
<h6>DELETE-ALL-VARIABLES tag<a class="headerlink" href="#delete-all-variables-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{DELETE-ALL-VARIABLES}}}</p>
<p>{{{DELETE-ALL-VARIABLES &#8220;prefix&#8221;}}}</p>
<p>The DELETE-ALL-VARIABLES tag deletes all variables in the VIRTEL
variable pool. An optional <strong>*prefix*</strong> parameter allows deletion of
only those variables whose names begin with the specified prefix.</p>
</div>
<div class="section" id="id6">
<h6>Examples<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h6>
<p>A host application uses an FAE5 structured field to create a table
variable called HOSTDATA. The HOSTDATA variable consists of an array of
20-byte records. Each record consists of an 8-byte key, followed by six
2-byte codes. The following code generates an HTML table from this data.
Each row of the table contains the row number, the key, and the codes. A
hyperlink is generated for each code, by removing any trailing blanks
from the code and appending “.html”:</p>
<p>{{{DEFINE-AUTOMATIC-COUNTER (1,1,9999) &#8220;ROWNUM&#8221; }}}</p>
<p>{{{DEFINE-SUB-VARIABLE (0, 8, 1) &#8220;KEY&#8221;}}}</p>
<p>{{{DEFINE-SUB-VARIABLE (8, 2, 6) &#8220;CODES&#8221;}}}</p>
<p>&lt;table&gt;&lt;tr&gt;&lt;td&gt;Row&lt;/td&gt;&lt;td&gt;Key&lt;/td&gt;&lt;td colspan=6&gt;Codes&lt;/td&gt;&lt;/tr&gt;</p>
<p>{{{FOR-EACH-VALUE-IN &#8220;HOSTDATA&#8221;}}}</p>
<p>&lt;tr&gt;</p>
<p>&lt;td&gt;{{{CURRENT-VALUE-OF &#8220;ROWNUM&#8221;}}}&lt;/td&gt;</p>
<p>&lt;td&gt;{{{CURRENT-VALUE-OF &#8220;KEY&#8221;}}}&lt;/td&gt;</p>
<p>{{{FOR-EACH-VALUE-IN &#8220;CODES&#8221;}}}</p>
<p>&lt;td&gt;&lt;a href=&#8217;{{{NO-BLANKS-VALUE-OF &#8220;CODES&#8221;}}}.html&#8217;&gt;</p>
<p>{{{CURRENT-VALUE-OF &#8220;CODES&#8221;}}}&lt;/a&gt;</p>
<p>&lt;/td&gt;</p>
<p>{{{END-FOR &#8220;CODES&#8221;}}}</p>
<p>&lt;/tr&gt;</p>
<p>{{{END-FOR &#8220;HOSTDATA&#8221;}}}</p>
<p>&lt;/table&gt;</p>
</div>
</div>
<div class="section" id="inserting-virtel-configuration-values-in-a-page">
<h5>Inserting VIRTEL configuration values in a page<a class="headerlink" href="#inserting-virtel-configuration-values-in-a-page" title="Permalink to this headline">¶</a></h5>
<div class="section" id="ip-address-of-line-tag">
<h6>IP-ADDRESS-OF-LINE tag<a class="headerlink" href="#ip-address-of-line-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{IP-ADDRESS-OF-LINE &#8220;n-xxxxxx&#8221;}}}</p>
<p>The IP-ADDRESS-OF-LINE tag will be replaced by the IP address of the
specified VIRTEL line. For example, {{{IP-ADDRESS-OF-LINE &#8220;H-HTTP&#8221;}}}
might generate 192.168.229.147</p>
</div>
<div class="section" id="ip-port-of-line-tag">
<h6>IP-PORT-OF-LINE tag<a class="headerlink" href="#ip-port-of-line-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{IP-PORT-OF-LINE &#8220;n-xxxxxx&#8221;}}}</p>
<p>The IP-PORT-OF-LINE tag will be replaced by the port number of the
specified VIRTEL line. For example, {{{IP-PORT-OF-LINE &#8220;H-HTTP&#8221;}}} might
generate 41000</p>
</div>
<div class="section" id="name-of-tag">
<h6>NAME-OF tag<a class="headerlink" href="#name-of-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{NAME-OF (xxxxxx)}}}</p>
<p>{{{NAME-OF (xxxxxx, len)}}}</p>
<p>The NAME-OF tag allows the insertion in a page of various data items
related to the VIRTEL transaction in progress.</p>
<p><strong>*xxxxxx*</strong> the name of the data item to be inserted. Valid values are:</p>
<blockquote>
<div><p><strong>VIRTEL</strong> The VIRTEL APPLID specified in the VIRTCT</p>
<p><strong>RELAY</strong> The relay LU name used to connect to the host application</p>
<p><strong>PRINT-RELAY</strong> The relay LU name of the associated printer</p>
<p><strong>PSEUDO-TERMINAL</strong> The VIRTEL terminal name</p>
<p><strong>ENTRY-POINT</strong> The VIRTEL entry point name</p>
<p><strong>LINE-INTERNAL</strong> The internal name of the VIRTEL line</p>
<p><strong>LINE-EXTERNAL</strong> The external name of the VIRTEL line</p>
<p><strong>USER</strong> The user name, if signon has occurred</p>
<p><strong>PASSWORD</strong> The user’s password, if signon has occurred</p>
<p><strong>USER-IP-ADDRESS</strong> The IP address of the client terminal</p>
<div class="line-block">
<div class="line"><strong>SNA-STATUS</strong> The status of the host LU2 session:</div>
<div class="line"><strong>X</strong> input is inhibited</div>
<div class="line">blank input is allowed</div>
</div>
<p><strong>TRANSACTION-INTERNAL</strong> The internal name of the VIRTEL transaction</p>
<p><strong>TRANSACTION-EXTERNAL</strong> The external name of the VIRTEL transaction</p>
<p><strong>URL</strong> The URL excluding the query string</p>
<p><strong>QUERY</strong> The query string from the URL</p>
<p><strong>PAGE</strong> The name of the current HTML page template</p>
<p><strong>PAGE-INTERNAL</strong> The name of the original HTML page template
specified in the URL</p>
<p><strong>DIRECTORY</strong> The current VIRTEL directory name</p>
<p><strong>CHARACTER-SET</strong> The name of the current UTF-8 character set, or
the country code if the page is not in UTF-8 mode (see “EBCDIC
translation management” sur la page 69)</p>
<p><strong>DATE-TIME</strong> The current date and time (14 characters in the format
YYYYMMDDHHMMSS)</p>
<p><strong>VIRTEL-VERSION</strong> The VIRTEL version number</p>
<p><strong>*xxx*-SYMBOL</strong> The value of the system symbol <em>xxx</em> (only if
SYSPLUS=YES is specified in the VIRTCT). Example: <strong>SYSNAME-SYMBOL</strong></p>
</div></blockquote>
<p><strong>*len*</strong> an optional length. If specified, the value of the data item
will be padded with blanks or truncated on the right to the specified
length.</p>
</div>
<div class="section" id="number-of-tag">
<h6>NUMBER-OF tag<a class="headerlink" href="#number-of-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{NUMBER-OF (xxxxxx)}}}</p>
<p>The NUMBER-OF tag allows the insertion in a page of various data items
related to the VIRTEL transaction in progress.</p>
<p><strong>*xxxxxx*</strong> the name of the data item to be inserted. Valid values are:</p>
<blockquote>
<div><p><strong>SCREEN-COLUMNS</strong> The width of the current host 3270 screen</p>
<p><strong>SCREEN-LINES</strong> The depth of the current host 3270 screen</p>
</div></blockquote>
</div>
</div>
<div class="section" id="conditional-generation">
<h5>Conditional generation<a class="headerlink" href="#conditional-generation" title="Permalink to this headline">¶</a></h5>
<div class="section" id="after-not-last-value-of-tag">
<h6>AFTER-NOT-LAST-VALUE-OF tag<a class="headerlink" href="#after-not-last-value-of-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{AFTER-NOT-LAST-VALUE-OF &#8220;varname&#8221; ...}}}</p>
<p>The AFTER-NOT-LAST-VALUE-OF tag brackets a section of the page which is
to be generated for all except the last iteration of a FOR-EACH-VALUE-IN
loop. The HTML content represented by “...” is generated unless the
current value of the variable <em>varname</em> is the last in the table.</p>
<p>The AFTER-NOT-LAST-VALUE-OF tag is useful, for example, when generating
a comma-separated list of values, as shown in the example below:</p>
<p>[ {{{FOR-EACH-VALUE-IN &#8220;MYVAR&#8221;}}} &#8220;{{{CURRENT-VALUE-OF &#8220;MYVAR&#8221;}}} &#8220;</p>
<p>{{{AFTER-NOT-LAST-VALUE-OF &#8220;MYVAR&#8221; ,}}}{{{END-FOR &#8220;MYVAR&#8221;}}} ]</p>
<p>If the variable <em>myvar</em> contains the values 1, 2, and 3, then this
example would generate [&nbsp;&#8221;1&#8221;,&nbsp;&#8221;2&#8221;,&nbsp;&#8221;3&#8221;&nbsp;]</p>
</div>
<div class="section" id="if-user-is-allowed-to-tag">
<h6>IF-USER-IS-ALLOWED-TO tag<a class="headerlink" href="#if-user-is-allowed-to-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{IF-USER-IS-ALLOWED-TO &#8220;resourcename&#8221; ...}}}</p>
<p>The IF-USER-IS-ALLOWED-TO tag brackets a section of the page whose
appearance is conditional on the user’s authorization to access the
resource <em>resourcename</em>. The HTML content represented by “...” is
generated only if the signed-on user is authorized to access the
specified resource.</p>
</div>
<div class="section" id="when-exists-and-end-when-exists-tags">
<h6>WHEN-EXISTS and END-WHEN-EXISTS tags<a class="headerlink" href="#when-exists-and-end-when-exists-tags" title="Permalink to this headline">¶</a></h6>
<p>{{{WHEN-EXISTS &#8220;varname&#8221;}}}</p>
<p>...</p>
<p>{{{END-WHEN-EXISTS &#8220;varname&#8221;}}}</p>
<p>The WHEN-EXISTS and END-WHEN-EXISTS tags bracket a section of the page
whose appearance is conditional on the existence of a named table
variable. The variable can be created by a VIRTEL Web Integration
application using the FAE5 or FAE6 structured fields, or it can be
created by a scenario. The HTML content represented by “...” is
generated only if the named variable exists in the context of the
current page and has at least one value.</p>
</div>
<div class="section" id="when-not-exists-and-end-when-not-exists-tags">
<h6>WHEN-NOT-EXISTS and END-WHEN-NOT-EXISTS tags<a class="headerlink" href="#when-not-exists-and-end-when-not-exists-tags" title="Permalink to this headline">¶</a></h6>
<p>{{{WHEN-NOT-EXISTS &#8220;varname&#8221;}}}</p>
<p>...</p>
<p>{{{END-WHEN-NOT-EXISTS &#8220;varname&#8221;}}}</p>
<p>The WHEN-NOT-EXISTS and END-WHEN-NOT-EXISTS tags are similar to the
WHEN-EXISTS and END-WHEN-EXISTS tags, except that the section of the
page enclosed by the tags is generated only if the named table variable
does not exist.</p>
</div>
<div class="section" id="when-not-blank-and-end-when-not-blank-tags">
<h6>WHEN-NOT-BLANK and END-WHEN-NOT-BLANK tags<a class="headerlink" href="#when-not-blank-and-end-when-not-blank-tags" title="Permalink to this headline">¶</a></h6>
<p>{{{WHEN-NOT-BLANK &#8220;varname&#8221;}}}</p>
<p>...</p>
<p>{{{END-WHEN-NOT-BLANK &#8220;varname&#8221;}}}</p>
<p>The WHEN-NOT-BLANK and END-WHEN-NOT-BLANK tags bracket a section of the
page which is generated only if the current value of a named table
variable is non-blank. The HTML content represented by “...” is omitted
if the named variable does not exist, or if its current value is null or
all blanks.</p>
</div>
<div class="section" id="when-next-event-and-end-when-next-event-tags">
<h6>WHEN-NEXT-EVENT and END-WHEN-NEXT-EVENT tags<a class="headerlink" href="#when-next-event-and-end-when-next-event-tags" title="Permalink to this headline">¶</a></h6>
<p>{{{WHEN-NEXT-EVENT &#8220;eventname&#8221;}}}</p>
<p>...</p>
<p>{{{END-WHEN-NEXT-EVENT &#8220;eventname&#8221;}}}</p>
<p>The WHEN-NEXT-EVENT and END-WHEN-NEXT-EVENT tags allow an XML template
to be written which uses variables generated by a commarea-to-output
conversion scenario. These tags work in conjunction with the $EVENT$
variable generated by the MAP$&nbsp;EVENTUAL-AREA and MAP$&nbsp;ELSETHEN-AREA
instructions described sur la page 195. The section of the page enclosed
by the WHEN-NEXT-EVENT and END-WHEN-NEXT-EVENT tags is generated only if
the current value of the $EVENT$ variable matches the specified
<em>eventname</em>.</p>
</div>
<div class="section" id="while-event-and-end-while-event-tags">
<h6>WHILE-EVENT and END-WHILE-EVENT tags<a class="headerlink" href="#while-event-and-end-while-event-tags" title="Permalink to this headline">¶</a></h6>
<p>{{{WHILE-EVENT &#8220;eventname&#8221;}}}</p>
<p>...</p>
<p>{{{END-WHILE-EVENT &#8220;eventname&#8221;}}}</p>
<p>The WHILE-EVENT and END-WHILE-EVENT tags work in conjunction with the
$EVENT$ variable generated by the MAP$&nbsp;EVENTUAL-AREA and
MAP$&nbsp;ELSETHEN-AREA instructions described sur la page 195. The
WHILE-EVENT tag marks the start of a loop. Everything between the
WHILE-EVENT and END-WHILE-EVENT tags is generated once for each value of
the $EVENT$ variable, as long as the current value of the $EVENT$
variable matches the specified <em>eventname</em>.</p>
</div>
</div>
<div class="section" id="debugging-facilities">
<h5>Debugging facilities<a class="headerlink" href="#debugging-facilities" title="Permalink to this headline">¶</a></h5>
<div class="section" id="create-variable-if-tag">
<h6>CREATE-VARIABLE-IF tag<a class="headerlink" href="#create-variable-if-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{CREATE-VARIABLE-IF (TRACING-SCENARIO) &#8220;varname&#8221;}}}</p>
<p>The CREATE-VARIABLE-IF tag with the TRACING-SCENARIO parameter retrieves
the contents of the scenario trace created by the DEBUG$ TRACE-SCENARIO
instruction (see page 176). If the trace is active, the variable
<em>varname</em> will be created. The value of this variable is a JSON
structure (see example below) which can be used by Virtel Studio.</p>
<p>The trace data for a specific terminal may be obtained by specifying an
x-Virtel-Debug=<em>capability-token</em> parameter in the URL. The
<em>capability-token</em> is generated by a SET-HEADER tag issued by the
terminal which owns the trace data. Capability tokens are described on
page 75.</p>
<p>{ &#8220;scenario&#8221;:&#8221;EXECUTE3&#8221;, &#8220;externalName&#8221;:&#8221;EXECUTE3&#8221;,</p>
<p>&#8220;compiled&#8221;:&#8221;02/04/13 18.49 &#8221;, &#8220;terminal&#8221;:&#8221;HTVTA012&#8221;, &#8220;relay&#8221;:&#8221;R5HVT511&#8221;,</p>
<p>&#8220;trace&#8221;:[</p>
<p>{&#8220;t&#8221;:&#8221;20:38:41.14&#8221;,&#8221;o&#8221;:&#8221;00014A&#8221;,&#8221;i&#8221;:&#8221;COPY$&#8221;},</p>
<p>{&#8220;t&#8221;:&#8221;20:38:41.14&#8221;,&#8221;o&#8221;:&#8221;00015E&#8221;,&#8221;i&#8221;:&#8221;TOVAR$&#8221;},</p>
<p>{&#8220;t&#8221;:&#8221;20:38:41.14&#8221;,&#8221;o&#8221;:&#8221;000046&#8221;,&#8221;i&#8221;:&#8221;MAP$&#8221;},</p>
<p>{&#8220;t&#8221;:&#8221;20:38:41.14&#8221;,&#8221;o&#8221;:&#8221;000058&#8221;,&#8221;i&#8221;:&#8221;MAP$&#8221;,&#8221;p&#8221;:[{&#8220;Customer&#8221;:&#8221;A0111115&#8221;}]},</p>
<p>{&#8220;t&#8221;:&#8221;20:38:41.14&#8221;,&#8221;o&#8221;:&#8221;000066&#8221;,&#8221;i&#8221;:&#8221;MAP$&#8221;},</p>
<p>{&#8220;t&#8221;:&#8221;20:38:41.14&#8221;,&#8221;o&#8221;:&#8221;000078&#8221;,&#8221;i&#8221;:&#8221;MAP$&#8221;,&#8221;p&#8221;:[{&#8220;Datemin&#8221;:&#8221;20110505&#8221;}]},</p>
<p>{&#8220;t&#8221;:&#8221;20:38:41.14&#8221;,&#8221;o&#8221;:&#8221;000086&#8221;,&#8221;i&#8221;:&#8221;MAP$&#8221;,&#8221;p&#8221;:[{&#8220;Datemax&#8221;:&#8221;20110525&#8221;}]},</p>
<p>{&#8220;t&#8221;:&#8221;20:38:41.14&#8221;,&#8221;o&#8221;:&#8221;000110&#8221;,&#8221;i&#8221;:&#8221;MAP$&#8221;},</p>
<p>{&#8220;t&#8221;:&#8221;20:38:41.14&#8221;,&#8221;o&#8221;:&#8221;000170&#8221;,&#8221;i&#8221;:&#8221;CASE$&#8221;,&#8221;p&#8221;:[{&#8220;CURLINE&#8221;:&#8221;0&#8221;}]},</p>
<p>{&#8220;t&#8221;:&#8221;20:38:41.14&#8221;,&#8221;o&#8221;:&#8221;0001FC&#8221;,&#8221;i&#8221;:&#8221;COPY$&#8221;},</p>
<p>{&#8220;t&#8221;:&#8221;20:38:41.14&#8221;,&#8221;o&#8221;:&#8221;000214&#8221;,&#8221;i&#8221;:&#8221;COPY$&#8221;}]}</p>
<p>Figure 1‑12 Exampleof a JSON structure generated by TRACING-SCENARIO</p>
<p>For other uses of the CREATE-VARIABLE-IF tag, see “Signon and password
management” on page 64.</p>
</div>
</div>
<div class="section" id="signon-and-password-management">
<h5>Signon and password management<a class="headerlink" href="#signon-and-password-management" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id7">
<h6>CREATE-VARIABLE-IF tag<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h6>
<p>{{{CREATE-VARIABLE-IF (condition) &#8220;varname&#8221;}}}</p>
<p>The CREATE-VARIABLE-IF tag allows the conditional creation of a VIRTEL
variable. If the specified condition is true, the variable <em>varname</em>
will be created and initialized with a value as shown in the list of
condition names below. This variable can be used subsequently to
conditionally generate a section of the page bracketed by WHEN-EXISTS
and END-WHEN-EXISTS tags.</p>
<p>The possible values of the <em>condition</em> parameter for the
CREATE-VARIABLE-IF tag are listed below:</p>
<p><a href="#id8"><span class="problematic" id="id9">**</span></a>SIGNON-IS-NEEDED
<a href="#id10"><span class="problematic" id="id11">**</span></a>The variable <em>varname</em> is created if a signon is needed, i.e. if the
transaction security type is non-zero and the user has not yet
successfully signed on at the terminal.</p>
<p><strong>SIGNON-IS-OK</strong> **
<a href="#id12"><span class="problematic" id="id13">**</span></a>The variable <em>varname</em> is created if the user has successfully
signed on at the terminal. The initial value of the variable is the user
name.</p>
<p><strong>APPLICATION-IS-CONNECTED</strong> **
<a href="#id14"><span class="problematic" id="id15">**</span></a>The variable <em>varname</em> is created if the terminal is connected to a
host application. The initial value of the variable is either the VTAM
application name, or the external name of the VIRTEL transaction,
depending on the value of the AIC parameter in the VIRTCT (see
“Parameters of the VIRTCT” in the <em>VIRTEL Installation Guide</em>).</p>
<p>For other uses of the CREATE-VARIABLE-IF tag, see “Debugging facilities”
on page 63.</p>
</div>
<div class="section" id="declare-field-as-tag">
<h6>DECLARE-FIELD-AS tag<a class="headerlink" href="#declare-field-as-tag" title="Permalink to this headline">¶</a></h6>
<p>When used in conjunction with a security type 4 transaction, the
DECLARE-FIELD-AS tag allows VIRTEL to obtain the userid and password
from fields embedded in the HTML page. For an example, see “Signon using
HTML fields” sur la page 300.</p>
<p>{{{DECLARE-FIELD-AS (attribute,...) &#8220;fieldname&#8221;}}}</p>
<p>The DECLARE-FIELD-AS tag indicates to VIRTEL that the HTML field whose
name is <em>fieldname</em> is to be treated as a userid or password field when
used with a transaction defined as having security type 4. One of more
<em>attribute</em> values must be specified. The possible attributes are listed
below:</p>
<p><strong>USERNAME</strong> indicates that the field contains the name of the user
(userid) to be signed on.</p>
<p><strong>PASSWORD</strong> indicates that the field contains the user’s password.</p>
<p><strong>NEW-PASSWORD</strong> indicates that the field contains a new password.
VIRTEL will request the security product to change the user’s current
password to the new value if the signon is successful.</p>
<p><strong>HEX</strong> indicates that VIRTEL expects the browser to encode the field in
hexadecimal.</p>
<p><strong>BASE64</strong> indicates that VIRTEL expects the browser to encode the field
in base64 format.</p>
<p><strong>ENCRYPTED</strong> indicates that VIRTEL expects the browser to encrypt the
field using the session key specified elsewhere in the page (see
“DECLARE-FIELD-AS CRYPTO-SESSION-KEY tag” sur la page 67)</p>
<p>Examples:</p>
<p>{{{DECLARE-FIELD-AS (USERNAME) &#8220;USERNAME&#8221; }}}</p>
<p>{{{DECLARE-FIELD-AS (PASSWORD,BASE64) &#8220;PASSWORD&#8221; }}}</p>
<p>{{{DECLARE-FIELD-AS (NEW-PASSWORD,ENCRYPTED) &#8220;NEWPASS&#8221; }}}</p>
<p>The same field can be both declared and defined:</p>
<p>{{{DEFINE-HTML-FIELD-NAME (04,06,08) &#8220;NOM&#8221; }}}</p>
<p>{{{DECLARE-FIELD-AS (BASE64) &#8220;NOM&#8221; }}}</p>
<p>The above example indicates that the field NOM is transmitted to VIRTEL
in base64 format. In this case, the DEFINE must precede the DECLARE.</p>
</div>
<div class="section" id="user-signon-code-tag">
<h6>USER-SIGNON-CODE tag<a class="headerlink" href="#user-signon-code-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{USER-SIGNON-CODE}}}</p>
<p>The USER-SIGNON-CODE tag generates a unique value called a <em>signoncode</em>
which may be used with the VirtelUserSignon parameter of the URL to
propagate the signed-on user’s credentials to another page (see
“Propagation of signon by URL” sur la page 20).</p>
</div>
</div>
<div class="section" id="encryption-management">
<h5>Encryption management<a class="headerlink" href="#encryption-management" title="Permalink to this headline">¶</a></h5>
<p>The presence of certain tags in a page template causes VIRTEL to
generate encryption keys and to encrypt and decrypt selected data in the
page. The use of these tags is dependent upon the specification of a
CRYPT<em>n</em> parameter in the VIRTCT (see “Parameters of the VIRTCT”) in
the <em>VIRTEL Installation Guide</em> manual.</p>
<div class="section" id="encryption-parameters-tag">
<h6>ENCRYPTION-PARAMETERS tag<a class="headerlink" href="#encryption-parameters-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ENCRYPTION-PARAMETERS &#8220;cryptname&#8221;}}}</p>
<p>{{{ENCRYPTION-PARAMETERS (field) &#8220;cryptname&#8221;}}}</p>
<p>The ENCRYPTION-PARAMETERS tag inserts into the page the contents of one
or all fields of the CRYPT<em>n</em> parameter whose name field is
<em>cryptname.</em> If the VIRTCT does not contain a CRYPT<em>n</em> parameter with
name <em>cryptname</em> then the ENCRYPTION-PARAMETERS tag returns a null
value.</p>
<p>If the optional <em>field</em> parameter is specified, the
ENCRYPTION-PARAMETERS tag returns the specified or defaulted value of
one field of the CRYPT<em>n</em> parameter, without quotes. The names of the
fields are:</p>
<p><strong>NAME</strong> The name of this set of encryption parameters.</p>
<p><strong>ALGORITHM</strong> The symmetric encryption algorithm.</p>
<p><strong>INITIAL-ALGORITHM</strong> The asymmetric encryption algorithm.</p>
<p><strong>DRIVER</strong> The name of the encryption engine.</p>
<p><strong>FORMAT</strong> The encoding used for encrypted text.</p>
<p><strong>CHAINING</strong> The chaining method for symmetric encryption.</p>
<p><strong>PADDING</strong> The padding method for symmetric encryption.</p>
<p>If the <em>field</em> parameter is not specified, then the
ENCRYPTION-PARAMETERS tag returns the specified or defaulted values of
all fields of the CRYPT<em>n</em> parameter. Each value is surrounded by
single quotes and the values are separated by commas.</p>
<p>Examples</p>
<p>If the VIRTCT contains the following parameters:</p>
<p>CRYPT1=(CRYPTNULL,NONE,NONE,NO-ENCRYPTION,HEX), *</p>
<p>CRYPT2=(CRYPT3270,3TDEA,RSA-1024,ICSF,HEX), *</p>
<p>then the tag {{{ENCRYPTION-PARAMETERS (ALGORITHM) &#8220;CRYPT3270&#8221;}}} returns
the value 3TDEA, and the tag {{{ENCRYPTION-PARAMETERS &#8220;CRYPT3270&#8221;}}}
returns the value
&#8216;CRYPT3270&#8217;,&#8216;3TDEA&#8217;,&#8217;RSA-1024&#8217;,&#8217;ICSF&#8217;,&#8217;HEX&#8217;,&#8217;CBC&#8217;,&#8217;PKCS7&#8217;</p>
</div>
<div class="section" id="public-key-tag">
<h6>PUBLIC-KEY tag<a class="headerlink" href="#public-key-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{PUBLIC-KEY (component) &#8220;cryptname&#8221;}}}</p>
<p>The presence of one or more PUBLIC-KEY tags in a page template causes
VIRTEL to generate a public/private key pair for the session, and to
insert the value of the specified component of the public key into the
page<em>.</em> The public/private key pair is generated according to the
INITIAL-ALGORITHM specified in the CRYPT<em>n</em> parameter whose name field
is <em>cryptname.</em> If the VIRTCT does not contain a CRYPT<em>n</em> parameter
with name <em>cryptname</em> then no key is generated and the PUBLIC-KEY tag
returns a null value.</p>
<p><strong>component</strong> is the name of the public key component to be inserted
into the page. Possible values are:</p>
<p><strong>EXPONENT</strong> The hexadecimal value of the public exponent.</p>
<p><strong>MODULUS</strong> The hexadecimal value of the modulus.</p>
</div>
<div class="section" id="id16">
<h6>DECLARE-FIELD-AS tag<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h6>
<p>{{{DECLARE-FIELD-AS (attribute) &#8220;fieldname&#8221;}}}</p>
<p>When used in conjunction with the PUBLIC-KEY tag, the DECLARE-FIELD-AS
tag indicates to VIRTEL that the HTML field whose name is <em>fieldname</em> is
to be treated as an encrypted session key. VIRTEL decrypts the contents
of the field using the corresponding private key (which is known only to
VIRTEL) and uses it as the session key when symmetric encryption is
requested by the SET-LOCAL-OPTIONS (ENCRYPT-PASSWORD-FIELDS) tag. The
possible attributes are listed below:</p>
<p><strong>CRYPTO-SESSION-KEY</strong> indicates that the field contains the session key
encrypted under the public key specified by the PUBLIC-KEY tag.</p>
</div>
<div class="section" id="id17">
<h6>SET-LOCAL-OPTIONS tag<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h6>
<p>When used in conjunction with the PUBLIC-KEY and DECLARE-FIELD-AS
(CRYPTO-SESSION-KEY) tags, the SET-LOCAL-OPTIONS tag activates
encryption for selected fields that are sent and received in HTML pages.</p>
<p>{{{ SET-LOCAL-OPTIONS (option, option, ...) }}}</p>
<p><strong>*option*</strong> the following values indicate the use of encryption:</p>
<p><strong>ENCRYPT-PASSWORD-FIELDS</strong> indicates that 3270 non-display unprotected
(data entry) fields are encrypted in both inbound and outbound messages,
and that 3270 non-display protected (output only) fields are replaced by
blanks in outbound messages.</p>
<p>Encryption is performed according to the symmetric encryption method
indicated by the CRYPT<em>n</em> parameter specified by the PUBLIC-KEY tag,
using the session key specified by the DECLARE-FIELD-AS
(CRYPTO-SESSION-KEY) tag. The GENERATE-HTML tag automatically adds an
additional VCRYPT attribute to each encrypted field.</p>
</div>
</div>
<div class="section" id="ebcdic-translation-management">
<h5>EBCDIC translation management<a class="headerlink" href="#ebcdic-translation-management" title="Permalink to this headline">¶</a></h5>
<p>By default, VIRTEL translates host application EBCDIC data into
ISO-8859-1 before sending it to the browser. This default behaviour is
suitable for Western European and English speaking countries. The
COUNTRY parameter in the VIRTCT indicates which EBCDIC country codepage
is used by host applications, and serves to select the appropriate
default EBCDIC-to-ISO-8859-1 translation table within VIRTEL.
Translation tables other than the default may be selected by means of
the SET-COUNTRY-CODE tag.</p>
<div class="section" id="set-country-code-tag">
<h6>SET-COUNTRY-CODE tag<a class="headerlink" href="#set-country-code-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{SET-COUNTRY-CODE &#8220;countryname&#8221;}}}</p>
<p>The SET-COUNTRY-CODE tag allows the 3270 host application data to be
translated to ISO-8859-1 according to an EBCDIC codepage other than the
default codepage implied by the COUNTRY parameter in the VIRTCT. It may
also be used to translate from the French EBCDIC codepage to ASCII
Western European codepage 850, or to translate from Latin-2 EBCDIC
Multilingual (CP870) to either ISO-8859-2 Latin-2 (CP912) or PC Latin-2
(CP852).</p>
<p>This tag takes effect starting from the point where it appears in the
template page, and it may appear multiple times in a single page. The
possible values for the <em>countryname</em> parameter are shown in the table
below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="17%" />
<col width="16%" />
<col width="4%" />
<col width="15%" />
<col width="17%" />
<col width="16%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Country name</td>
<td>EBCDIC codepage</td>
<td>ASCII codepage</td>
<td>&#160;</td>
<td>Country name</td>
<td>EBCDIC codepage</td>
<td>ASCII codepage</td>
</tr>
<tr class="row-even"><td>US</td>
<td>CP 037</td>
<td>ISO-8859-1</td>
<td>&#160;</td>
<td>DE</td>
<td>CP 273</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-odd"><td>FR</td>
<td>CP 297</td>
<td>ISO-8859-1</td>
<td>&#160;</td>
<td>BE</td>
<td>CP 500</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-even"><td>NO</td>
<td>CP 277</td>
<td>ISO-8859-1</td>
<td>&#160;</td>
<td>FI</td>
<td>CP 278</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-odd"><td>IT</td>
<td>CP 280</td>
<td>ISO-8859-1</td>
<td>&#160;</td>
<td>ES (SP)</td>
<td>CP 284</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-even"><td>GB (UK)</td>
<td>CP 285</td>
<td>ISO-8859-1</td>
<td>&#160;</td>
<td>IS (IC)</td>
<td>CP 871</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-odd"><td>FR-850</td>
<td>CP 297</td>
<td>CP 850</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>L2</td>
<td>CP 870</td>
<td>ISO-8859-2</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>P2</td>
<td>CP 870</td>
<td>CP 852</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>Figure 1‑13 Country Codes for EBCDIC to ASCII translation</p>
<p>Note: Values in parentheses are accepted for compatibility with previous
versions of VIRTEL</p>
</div>
<div class="section" id="country-code-tag">
<h6>COUNTRY-CODE tag<a class="headerlink" href="#country-code-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{COUNTRY-CODE}}}</p>
<p>The COUNTRY-CODE tag inserts the country code into the page, where it
can be tested by JavaScript.</p>
</div>
<div class="section" id="set-output-encoding-utf-8-tag">
<h6>SET-OUTPUT-ENCODING-UTF-8 tag<a class="headerlink" href="#set-output-encoding-utf-8-tag" title="Permalink to this headline">¶</a></h6>
<p>For countries which use a non-Western European language, VIRTEL can
generate data in UTF-8 encoding instead of ISO-8859-1. This is done by
embedding the SET-OUTPUT-ENCODING-UTF-8 tag in the page template:</p>
<p>{{{ SET-OUTPUT-ENCODING-UTF-8 &#8220;charset&#8221; }}}</p>
<p>The SET-OUTPUT-ENCODING-UTF-8 tag indicates that host data inserted in
the template page by VIRTEL is to be in UTF-8 format, translated
according to the EBCDIC country codepage whose name is specified within
quotes. The possible values for <em>charset</em> are given under the
description of the DEFUTF8 parameter of the VIRTCT. If no <em>charset</em>
value is specified, as for example {{{SET-OUTPUT-ENCODING-UTF-8&nbsp;&#8221;&#8220;}}},
then the default value of <em>charset</em> is the codepage specified by the
DEFUTF8 parameter of the VIRTCT described in the VIRTEL Installation
Guide.</p>
<p>When SET-OUTPUT-ENCODING-UTF-8 is specified, the rest of the template
page must also be coded in UTF-8, and, in the case of an HTML page, must
contain the HTML tag:</p>
<p>&lt;meta http-equiv=&#8221;Content-Type&#8221; content=&#8221;text/html; charset=UTF-8&#8221;&gt;</p>
<p>In the case of an XML page, no such instruction is needed because XML is
considered to be encoded in UTF8 by default.</p>
<p>Examples</p>
<p>A 3270 application generates US EBCDIC (CECP 037). The following
statements, coded between the &lt;HEAD&gt; and &lt;/HEAD&gt; tags in the template
page, ensure the correct translation of this application’s data:</p>
<p>{{{SET-COUNTRY-CODE &#8220;US&#8221;}}}</p>
<p>&lt;meta http-equiv=&#8221;Content-Type&#8221; content=&#8221;text/html; charset=iso-8859-1&#8221;&gt;</p>
<p>Another 3270 application generates output using the Chinese Simplified
EBCDIC character set (IBM1388). The output is to be translated to UTF-8
and inserted into a template page which must also be encoded in UTF-8:</p>
<p>{{{SET-OUTPUT-ENCODING-UTF-8 &#8220;IBM1388&#8221;}}}</p>
<p>&lt;meta http-equiv=&#8221;Content-Type&#8221; content=&#8221;text/html; charset=UTF-8&#8221;&gt;</p>
<p>A third 3270 application generates output using the Spanish EBCDIC
character set, which is to be translated to UTF-8 and inserted into the
template page. In this example, we assume that the parameter
DEFUTF8=IBM1145 has been specified in the VIRTCT, so we can use this as
the default value for the SET-OUTPUT-ENCODING-UTF-8 tag:</p>
<p>{{{SET-OUTPUT-ENCODING-UTF-8 &#8220;&#8221;}}}</p>
<p>&lt;meta http-equiv=&#8221;Content-Type&#8221; content=&#8221;text/html; charset=UTF-8&#8221;&gt;</p>
<p>In each case, the {{{SET}}} statement tells VIRTEL what character set to
generate, while the &lt;META&gt; statement tells the browser what character
set to expect.</p>
<p>If you specify neither SET-OUTPUT-ENCODING-UTF-8 nor SET-COUNTRY-CODE,
then VIRTEL will generate ISO-8859-1 according to the default COUNTRY
parameter specified in the VIRTCT.</p>
</div>
</div>
<div class="section" id="http-protocol-management">
<h5>HTTP protocol management<a class="headerlink" href="#http-protocol-management" title="Permalink to this headline">¶</a></h5>
<p>Normally when VIRTEL delivers a page via HTTP it includes an HTTP
response status code of “200 OK”. The SET-HTTP-RETURN-CODE allows the
page to specify an alternative HTTP response status code. This may be
useful, for example, in a page which contains an error message from an
application.</p>
<div class="section" id="set-http-return-code-tag">
<h6>SET-HTTP-RETURN-CODE tag<a class="headerlink" href="#set-http-return-code-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ SET-HTTP-RETURN-CODE &#8220;rc text&#8221; }}}</p>
<p>The SET-HTTP-RETURN-CODE tag indicates to VIRTEL the HTTP status code
and supplementary text which will be sent in the HTTP response message
when this page is delivered. <em>rc</em> is a 3-digit numeric status code, as
defined by RFC 2616, and <em>text</em> is the text which accompanies the
numeric code.</p>
<p>Example:</p>
<p>&lt;!&#8211;VIRTEL start=&#8221;{{{&#8221; end=&#8221;}}}&#8221; &#8211;&gt;</p>
<p>&lt;html&gt;&lt;body&gt;&lt;h1&gt;Database record not found&lt;/h1&gt;</p>
<p>{{{SET-HTTP-RETURN-CODE &#8220;404 Not in DB2&#8221;}}}</p>
<p>&lt;p&gt;The requested record was not found in the database.</p>
<p>&lt;/body&gt;&lt;/html&gt;</p>
</div>
</div>
<div class="section" id="cache-management">
<h5>Cache management<a class="headerlink" href="#cache-management" title="Permalink to this headline">¶</a></h5>
<p>When delivering static elements such as menu pages, images, and
JavaScript programs, VIRTEL indicates to the browser that the element is
eligible to be stored in the browser’s cache. This improves performance
because the browser does not have to request the element from VIRTEL
each time it is required. By contrast, dynamic elements (i.e. elements
which contain VIRTEL tags) are generally marked as non-cacheable because
their content is likely to change each time the page is requested.</p>
<p>The VIRTEL tags described in this section are used to override the
default cacheable/non-cacheable behavior.</p>
<div class="section" id="set-page-cacheable-tag">
<h6>SET-PAGE-CACHEABLE tag<a class="headerlink" href="#set-page-cacheable-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ SET-PAGE-CACHEABLE }}}</p>
<p>When an element contains a SET-PAGE-CACHEABLE tag, VIRTEL will generate
two HTTP headers: an Expires: header which indicates that the browser
may cache the element until midnight, and a Last-Modified:.header which
contains the date that the element was uploaded to VIRTEL. This is the
default for static elements.</p>
</div>
<div class="section" id="set-page-not-cacheable-tag">
<h6>SET-PAGE-NOT-CACHEABLE tag<a class="headerlink" href="#set-page-not-cacheable-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ SET-PAGE-NOT-CACHEABLE }}}</p>
<p>When an element contains a SET-PAGE-NOT-CACHEABLE tag, VIRTEL will
generate an Expires: 0 HTTP header indicating that the browser should
not store the element in its cache. This is the default for dynamic
elements.</p>
</div>
<div class="section" id="set-max-age-tag">
<h6>SET-MAX-AGE tag<a class="headerlink" href="#set-max-age-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ SET-MAX-AGE &#8220;secs&#8221; }}}</p>
<p>When an element contains a SET-MAX-AGE tag, VIRTEL will not generate the
normal Expires: and Last-Modified:.HTTP headers, but instead it will
generate a Cache-Control: max-age=<em>secs</em> header, where <em>secs</em>
represents the validity time (in seconds) during which the browser may
keep the element in its cache.</p>
</div>
</div>
<div class="section" id="mime-type-management">
<h5>MIME type management<a class="headerlink" href="#mime-type-management" title="Permalink to this headline">¶</a></h5>
<p>VIRTEL associates a MIME-type with each page template or other element
stored in a directory. VIRTEL always sends the MIME-type to the browser
when the browser requests any element. Some browsers use the MIME-type
to determine how to display the element. For example, HTML pages must
have MIME-type “text/html”, XML pages must have MIME-type “text/xml”,
JPG files must have MIME-type “image/jpeg”, etc.</p>
<p>VIRTEL normally sets the MIME-type to the value indicated by the browser
or mailer at the time the page is uploaded. However, in certain cases
VIRTEL may force the MIME-type to a different value:</p>
<ul class="simple">
<li>If the filename extension is .HTM or .HTML, or is absent, VIRTEL will
force the MIME-type to be “text/html”. This is because some versions
of Internet Explorer upload HTML files using MIME-type “text/plain”</li>
<li>If the file contains a SET-CONTENT-TYPE tag, then VIRTEL will force
the MIME-type to the value specified in the tag</li>
</ul>
<div class="section" id="set-content-type-tag">
<h6>SET-CONTENT-TYPE tag<a class="headerlink" href="#set-content-type-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{SET-CONTENT-TYPE &#8220;mimetype&#8221;}}}</p>
<p>The SET-CONTENT-TYPE tag allows the administrator to override the
MIME-type supplied by the browser or mailer when the element is
uploaded. VIRTEL stores the value of the parameter <em>mimetype</em> in the
directory with the element.</p>
<p>In the following example, the page template is to be stored with a
MIME-type which will cause the browser to process it as speadsheet data:</p>
<p>{{{SET-CONTENT-TYPE &#8220;application/vnd.ms-excel&#8221;}}}</p>
</div>
</div>
<div class="section" id="capability-tokens">
<h5>Capability tokens<a class="headerlink" href="#capability-tokens" title="Permalink to this headline">¶</a></h5>
<p>VIRTEL capability tokens permit an HTTP transaction to access data
associated with an transaction running on another terminal. The token is
delivered by VIRTEL by means of an <em>x-Virtel</em> HTTP response header from
the terminal which owns the capability, and the same token is returned
to VIRTEL in a subsequent URL sent by the terminal which wishes to use
the capability (see “Capability URLs” on page 19). The <em>x-Virtel</em> HTTP
header is generated by a SET-HEADER tag embedded in a page template sent
by the terminal which owns the capablity.</p>
<div class="section" id="set-header-tag">
<h6>SET-HEADER tag<a class="headerlink" href="#set-header-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ SET-HEADER (type) &#8220;header-string&#8221; }}}</p>
<p>When the SET-HEADER tag is present in a page template, VIRTEL generates
an HTTP response header.</p>
<p>When <em>type</em> is one of the VIRTEL capability types listed below, the
quoted string <em>header-string</em> is the name of the header; this name
should start with x-Virtel- should end with a colon (:) and should not
contain blanks. The capability value is an opaque string added by
VIRTEL.</p>
<p>When <em>type</em> is <strong>AS-IS</strong> the quoted string <em>header-string</em> is a complete
header (including value) to be added as-is. No capability processing is
performed in this case.</p>
<p>The VIRTEL capability types are:</p>
<div class="line-block">
<div class="line"><strong>TO-ALLOW-READ-OF-SCENARIO-TRACE</strong></div>
<div class="line">Generates a capability token which permits a subsequent requester to
obtain this terminal’s trace data by means of the CREATE-VARIABLE-IF
TRACING-SCENARIO tag described on page 63.</div>
</div>
<div class="line-block">
<div class="line"><strong>GIVING-ACCESS-TO-%USER%-DIRECTORY-WITH-MY-USERID</strong></div>
<div class="line">The capability token generated by this tag may be used by a subsequent
request to access a directory which has %USER% in the <em>keyword</em> field
of its definition. The userid of the capability owning transaction
will be used as the directory key when the directory is accessed.</div>
</div>
<div class="line-block">
<div class="line"><strong>GIVING-ACCESS-TO-%GROUP%-DIRECTORY-WITH-MY-USERID</strong></div>
<div class="line">The capability token generated by this tag may be used by a subsequent
request to access a directory which has %GROUP% in the <em>keyword</em> field
of its definition. The RACF group name of the capability owning
transaction will be used as the directory key when the directory is
accessed.</div>
</div>
<div class="line-block">
<div class="line"><strong>GIVING-ACCESS-TO-%USER%-DIRECTORY-IN-VARIABLE-%USER%</strong></div>
<div class="line">The capability token generated by this tag may be used by a subsequent
request to access a directory which has %USER% in the <em>keyword</em> field
of its definition. The value of the %USER% variable of the capability
owning transaction will be used as the directory key when the
directory is accessed.</div>
</div>
<div class="line-block">
<div class="line"><strong>GIVING-ACCESS-TO-%GROUP%-DIRECTORY-IN-VARIABLE-%GROUP%</strong></div>
<div class="line">The capability token generated by this tag may be used by a subsequent
request to access a directory which has %GROUP% in the <em>keyword</em> field
of its definition. The value of the %GROUP% variable of the capability
owning transaction will be used as the directory key when the
directory is accessed.</div>
</div>
<p>Examples:</p>
<p>{{{ SET-HEADER (AS-IS) &#8220;Cache-control: no-cache&#8221; }}}</p>
<p>{{{ SET-HEADER (TO-ALLOW-READ-OF-SCENARIO-TRACE) &#8220;x-Virtel-Debug:&#8221; }}}</p>
<p>{{{ SET-HEADER (GIVING-ACCESS-TO-%USER%-DIRECTORY-IN-VARIABLE-%USER%)</p>
<p>&#8220;x-Virtel-User-Directory:&#8221; }}}</p>
<p>{{{ SET-HEADER (GIVING-ACCESS-TO-%USER%-DIRECTORY-WITH-MY-USERID)</p>
<p>&#8220;x-Virtel-User-Directory:&#8221; }}}</p>
<p>{{{ SET-HEADER (GIVING-ACCESS-TO-%GROUP%-DIRECTORY-IN-VARIABLE-%GROUP%)</p>
<p>&#8220;x-Virtel-Group-Directory:&#8221; }}}</p>
<p>{{{ SET-HEADER (GIVING-ACCESS-TO-%GROUP%-DIRECTORY-WITH-MY-USERID)</p>
<p>&#8220;x-Virtel-Group-Directory:&#8221; }}}</p>
</div>
</div>
<div class="section" id="page-upload">
<h5>Page upload<a class="headerlink" href="#page-upload" title="Permalink to this headline">¶</a></h5>
<p>The SECURITY-TOKEN and IF-SECURITY-TOKEN-IS-READY tags are used during
uploading of HTML pages from a browser (see “Page upload by HTTP secured
by cookie”).</p>
<div class="section" id="security-token-tag">
<h6>SECURITY-TOKEN tag<a class="headerlink" href="#security-token-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ SECURITY-TOKEN }}}</p>
<p>If the SECURITY-TOKEN tag is present in a template page, VIRTEL
substitutes a newly generated user security code to be used for the next
transfer. For example,</p>
<p>&lt;script language=&#8221;JavaScript&#8221;&gt;&lt;!&#8211;</p>
<p>var VirtelRef = &#8220;{{{SECURITY-TOKEN}}}&#8221;;</p>
<p>&#8211;&gt;&lt;/script&gt;</p>
<p>If a security code exists, the above code might generate:</p>
<p>var VirtelRef =
&#8220;20040427130843.07F5D1DC.56A85680Bgpamk4WZRKKBiZWjS4OTlqSES4OWlA==&#8221;;</p>
<p>otherwise it will generate:</p>
<p>var VirtelRef = &#8220;&#8221;;</p>
<p>Two examples of the use of the SECURITY-TOKEN tag are supplied in the
HTMLBAS directory used by VIRTEL entry point DEMOHTTP. The <em>upload.htm</em>
page stores and retransmits the user security code in the form of a
cookie (<em>VirtelRef=xxxxxxxxxxxxxxxx</em>). The <em>upload2.htm</em> page
retransmits the user security code using the VirtelCookie= parameter of
the URL (see “Transmission of cookie by URL” sur la page 18), but it
does not store the code.</p>
</div>
<div class="section" id="if-security-token-is-ready-tag">
<h6>IF-SECURITY-TOKEN-IS-READY tag<a class="headerlink" href="#if-security-token-is-ready-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{IF-SECURITY-TOKEN-IS-READY</p>
<p>SetHostWarning();</p>
<p>}}}</p>
<p>The IF-SECURITY-TOKEN-IS-READY tag encloses HTML or JavaScript code to
be generated only if a non-empty SECURITY-TOKEN is present.</p>
<p>Note that the total size of this tag, including the enclosed code, must
not exceed the size of an inter-block buffer (120 characters) otherwise
it will not be correctly processed if it spans blocks.</p>
</div>
</div>
<div class="section" id="printing">
<h5>3287 printing<a class="headerlink" href="#printing" title="Permalink to this headline">¶</a></h5>
<p>Each relay LU, through which a user connects to a host application, can
be associated with a second LU which represents a virtual printer (see
the description of HTTP terminals in the VIRTEL Connectivity Reference
documentation). Data sent to this virtual printer by a host application
(such as CICS) are stored by VIRTEL and can be retrieved by means of the
tags IF-PRINT-IS-READY, SESSION-CODE, and PRINT embedded in a template
page.</p>
<div class="section" id="if-print-is-ready-tag">
<h6>IF-PRINT-IS-READY tag<a class="headerlink" href="#if-print-is-ready-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ IF-PRINT-IS-READY ... }}}</p>
<p>The IF-PRINT-IS-READY tag encloses a section of the page which is
generated only if print data exists on the virtual printer associated
with the user’s session. The HTML content represented by “...” is
generated only if VIRTEL has data ready to be printed.</p>
</div>
<div class="section" id="id18">
<h6>SESSION-CODE tag<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h6>
<p>The SESSION-CODE tag, prefixed by the word “Print”, generates a
<em>sessioncode</em> which allows a subsidiary window to be opened for the
print data associated with the specified session. The template page
displayed in this window can retrieve the stored print data by means of
the PRINT tag. The user can then view the print data, and can, if
desired, send the data to a physical workstation printer using the
normal procedure for printing from a browser.</p>
<p>For example:</p>
<p>&lt;script language=&#8221;javascript&#8221; type=&#8221;text/javascript&#8221;&gt;</p>
<p>&lt;!&#8211;</p>
<p>function ShowPopup()</p>
<p>{</p>
<p>var popupURL = &#8220;imprim.htm++Print{{{ SESSION-CODE }}}&#8221;</p>
<p>var popupName = &#8220;PopupImpression&#8221;;</p>
<p>var popup = window.open(&#8220;&#8221;, popupName,</p>
<p>&#8216;status=yes,resizable=yes,scrollbars=yes,toolbar=yes,&#8217; +</p>
<p>&#8216;menubar=yes,width=614,height=129&#8217;);</p>
<p>popup.location = popupURL;</p>
<p>}</p>
<p>{{{IF-PRINT-IS-READY</p>
<p>ShowPopup();</p>
<p>}}}</p>
<p>// &#8211;&gt;</p>
<p>&lt;/script&gt;</p>
</div>
<div class="section" id="print-tag">
<h6>PRINT tag<a class="headerlink" href="#print-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ PRINT (0) }}}</p>
<p>The PRINT tag allows a template page, such as the <em>imprim.htm</em> page
supplied with VIRTEL, to retrieve 3287 print data. The structured field
FAD3 also allows print data to be fed to VIRTEL for retrieval with the
PRINT tag.</p>
</div>
</div>
<div class="section" id="generating-pdf-output">
<h5>Generating PDF output<a class="headerlink" href="#generating-pdf-output" title="Permalink to this headline">¶</a></h5>
<p>When a page template is processed in a scenario by a
COPY$&nbsp;OUTPUT-FILE-TO-VARIABLE instruction with the TYPE=LINEBUFFER
parameter, the page template may contain additional tags. These tags are
used to assist in the construction of INPUT, DOCOPT, and LAYOUT files in
the “LINEBUF” format required by the MakePDF program product. These
files may then be passed to the VIRSVPDF service program which invokes
MakePDF to generate output files in PDF format. Refer to “PDF output
generation” sur la page 232 for an example scenario.</p>
<div class="section" id="pdf-lines-per-page-tag">
<h6>PDF-LINES-PER-PAGE tag<a class="headerlink" href="#pdf-lines-per-page-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ PDF-LINES-PER-PAGE &#8220;nn&#8221;}}}</p>
<p>The PDF-LINES-PER-PAGE tag inserts “1” in the ASA carriage control
character position after every <em>nn</em> lines.</p>
</div>
<div class="section" id="pdf-new-docopt-tag">
<h6>PDF-NEW-DOCOPT tag<a class="headerlink" href="#pdf-new-docopt-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ PDF-NEW-DOCOPT &#8220;n&#8221;}}}</p>
<p>The PDF-NEW-DOCOPT tag is used only in a MakePDF DOCOPT file. It
identifies the DOCOPT file by the character “<em>n</em>”. This allows the
DOCOPT file to be referenced by the PDF-USE-DOCOPT tag in the
corresponding INPUT file.</p>
</div>
<div class="section" id="pdf-new-input-tag">
<h6>PDF-NEW-INPUT tag<a class="headerlink" href="#pdf-new-input-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ PDF-NEW-INPUT }}}</p>
<p>The PDF-NEW-INPUT tag is used only in a MakePDF INPUT file. It
identifies the start of a new segment in the INPUT file.</p>
</div>
<div class="section" id="pdf-new-layout-tag">
<h6>PDF-NEW-LAYOUT tag<a class="headerlink" href="#pdf-new-layout-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ PDF-NEW-LAYOUT &#8220;n&#8221;}}}</p>
<p>The PDF-NEW-LAYOUT tag is used only in a MakePDF LAYOUT file. It
identifies the LAYOUT file by the character “<em>n</em>”. This allows the
LAYOUT file to be referenced by the PDF-USE-LAYOUT tag in the
corresponding INPUT file.</p>
</div>
<div class="section" id="pdf-outline-tag">
<h6>PDF-OUTLINE tag<a class="headerlink" href="#pdf-outline-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ PDF-OUTLINE }}}</p>
<p>The PDF-OUTLINE tag inserts “&#64;” in the ASA carriage control character
position.</p>
</div>
<div class="section" id="pdf-page-break-tag">
<h6>PDF-PAGE-BREAK tag<a class="headerlink" href="#pdf-page-break-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ PDF-PAGE-BREAK }}}</p>
<p>The PDF-PAGE-BREAK tag inserts “1” in the ASA carriage control character
position.</p>
</div>
<div class="section" id="pdf-use-docopt-tag">
<h6>PDF-USE-DOCOPT tag<a class="headerlink" href="#pdf-use-docopt-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ PDF-USE-DOCOPT &#8220;n&#8221;}}}</p>
<p>The PDF-USE-DOCOPT tag is used only in a MakePDF INPUT file. It
specifies that the INPUT file is associated with the DOCOPT file
identified by the character “<em>n</em>”</p>
</div>
<div class="section" id="pdf-use-layout-tag">
<h6>PDF-USE-LAYOUT tag<a class="headerlink" href="#pdf-use-layout-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ PDF-USE-LAYOUT &#8220;n&#8221;}}}</p>
<p>The PDF-USE-LAYOUT tag is used only in a MakePDF INPUT file. It
specifies that the INPUT file is associated with the LAYOUT file
identified by the character “<em>n</em>”</p>
</div>
<div class="section" id="pdf-variable-tag">
<h6>PDF-VARIABLE tag<a class="headerlink" href="#pdf-variable-tag" title="Permalink to this headline">¶</a></h6>
<p>{{{ PDF-VARIABLE }}}</p>
<p>The PDF-VARIABLE tag inserts “=” in the ASA carriage control character
position.</p>
</div>
</div>
</div>
<div class="section" id="correspondent-management">
<h4>Correspondent management<a class="headerlink" href="#correspondent-management" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id19">
<h5>Introduction<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h5>
<p>One of the methods which VIRTEL may use to identify users is by means of
a security code which the user presents to VIRTEL, either in an incoming
e-mail, or by means of a “cookie” included in an HTTP request by the
browser. A user which VIRTEL recognizes in this way is known as a
“Correspondent”. VIRTEL stores the list of correspondents in a VSAM file
known as the “Correspondent file”, also known as the “VIRHTML” file.</p>
<p>VIRTEL uses the correspondent file for the following purposes:</p>
<ul class="simple">
<li>the rules of an HTTP line permit VIRTEL to distinguish between
correspondents and non-correspondents when processing incoming HTTP
requests. When the requesting user is identified as a correspondent,
a special entry point may be assigned, or a set of rules specific to
the user may be executed. Refer to “Rules” in the <em>VIRTEL
Connectivity Reference</em> manual for further details.</li>
<li>the rules of an HTTP line may assign a specific LU name to a
correspondent connecting to a host application via web access. This
is known as “LU nailing” and is described in more detail in the
<em>VIRTEL LU Nailing HOWTO</em> manual.</li>
<li>a correspondent may be authorized to upload HTML pages and other
elements into an HTMLTRSF file. For further details, refer to
“Uploading pages by SMTP” sur la page 85 and “Uploading pages by HTTP
(secured by cookie) sur la page 87.</li>
</ul>
<p>There are two types of correspondent: an e-mail correspondent and a
local correspondent:</p>
<ul class="simple">
<li>An <strong>e-mail correspondent</strong> is always defined by the VIRTEL
administrator. When the administrator activates an e-mail
correspondent, VIRTEL sends an e-mail message to the correspondent
containing the security code. The correspondent then either replies
to the e-mail message or clicks on a link in the message to connect
to VIRTEL.</li>
<li>A <strong>local correspondent</strong> is activated by the correspondent using a
procedure known as “self-registration”. The self-registration
procedure creates a clickable link which delivers the security code
to the correspondent’s browser via a cookie. The VIRTEL administrator
may optionally pre-define or change the characteristics of a
correspondent by using the correspondent management sub-application.
Self-registration is described in the <em>VIRTEL LU Nailing HOWTO</em>
manual.</li>
</ul>
</div>
<div class="section" id="access-to-the-application">
<h5>Access to the application<a class="headerlink" href="#access-to-the-application" title="Permalink to this headline">¶</a></h5>
<p>The correspondent management sub-application, which allows the VIRTEL
administrator to define the parameters associated with a correspondent,
is accessible by pressing [PF5] in the VIRTEL configuration menu, or
[PF12] in the system services sub-application menu, or from the VIRTEL
Multi-Session screen via an application referencing the module VIR0041A.</p>
</div>
<div class="section" id="id20">
<h5>Security<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h5>
<p>When security is active, access to the correspondent management
sub-application from the configuration menu or from the system services
sub-application menu is controlled by the resource $$PCPC$$.</p>
<p>When it is accessed by a transaction, the rules of security management
of transactions will apply.</p>
<p>Security management is described under the heading “Security” sur la
page 297.</p>
</div>
<div class="section" id="objectives">
<h5>Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h5>
<p>This sub-application initially displays a summary screen of existing
definitions presented in alphanumeric order. Access to the detail of a
correspondent is achieved by positioning the cursor and pressing [PF12].</p>
<p>LIST of CORRESPONDENTS &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211; Applid: SPVIRE2
16:30:30</p>
<p>Id Rules VTAM name Last connection Contacts</p>
<p><a class="reference external" href="mailto:upload1&#37;&#52;&#48;saint&#46;cloud&#46;com">upload1<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a> ADMRSET1 20 Feb 2009 09:35:37 00000011</p>
<p><a class="reference external" href="mailto:upload2&#37;&#52;&#48;saint&#46;cloud&#46;com">upload2<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a> ADMRSET1 QUEUE ACTIVATION 00000000</p>
<p><a class="reference external" href="mailto:user1&#37;&#52;&#48;saint&#46;cloud&#46;com">user1<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a> RHTVT003 QUEUE ACTIVATION 00000011</p>
<p>WKSTN-A2FE/SYSPERTEC RRVTC006 30 Jun 2009 11:24:49 00000010</p>
<p>P1=Update P2=Delete P3=Return P6=Rules</p>
<p>P7=Previous P8=Next P12=Edit</p>
<p>Figure 1‑14 Summary of correspondents</p>
<p>CORRESPONDENT DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211; Applid: SPVIRE2
16:37:59</p>
<p>Id ===&gt; <a class="reference external" href="mailto:user1&#37;&#52;&#48;saint&#46;cloud&#46;com">user1<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a></p>
<p>email address with &#8216;&#64;&#8217; sign</p>
<p>Type of Id ===&gt; 1 1:Email 2:Local+fixed 3:Local+changing</p>
<p>Activation message ===&gt; To activate your VIRTEL connection,
click:&amp;Rhttp://192.</p>
<p>168.5.30:41001/web2host.htm++&amp;C</p>
<p>Text of &#8216;OK&#8217; message to user.</p>
<p>VTAM name ===&gt; RHTVT003 &amp;1 parameter to specify VTAM LU name</p>
<p>Rule Set ===&gt; Rules to choose an entry point</p>
<p>Directory ===&gt; Where data is to be uploaded</p>
<p>Last contact ===&gt; QUEUE ACTIVATION</p>
<p>Contacts ===&gt; 00000000 Number of times cookie was updated</p>
<p>Date created ===&gt; 08 Jan 2009 17:02:12</p>
<p>Created by ===&gt; VIRDBA</p>
<p>Date activated ===&gt; 20 Oct 2009 11:07:34</p>
<p>Activated by ===&gt; VIRDBA</p>
<p>Date disabled ===&gt; 16 Jan 2009 16:55:22</p>
<p>Disabled by ===&gt; SPTBOWL</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P4=Activate P5=Disable P6=Rules</p>
<p>Figure 1‑15 Correspondent detail screen (e-mail correspondent)</p>
<p>CORRESPONDENT DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211; Applid: SPVIRE2
16:40:04</p>
<p>Id ===&gt; WKSTN-A2FE/SYSPERTEC</p>
<p>workstation/lan</p>
<p>Type of Id ===&gt; 2 1:Email 2:Local+fixed 3:Local+changing</p>
<p>Activation message ===&gt;</p>
<p>Text of &#8216;OK&#8217; message to user.</p>
<p>VTAM name ===&gt; RRVTC006 &amp;1 parameter to specify VTAM LU name</p>
<p>Rule Set ===&gt; Rules to choose an entry point</p>
<p>Directory ===&gt; Where data is to be uploaded</p>
<p>Last contact ===&gt; 30 Jun 2009 11:24:49 192.168.002.082</p>
<p>Contacts ===&gt; 00000010 Number of times cookie was updated</p>
<p>Date created ===&gt; 30 Jun 2009 10:35:30</p>
<p>Created by ===&gt; VIRDBA</p>
<p>Date activated ===&gt; 30 Jun 2009 10:35:30</p>
<p>Activated by ===&gt; VIRDBA</p>
<p>Date disabled ===&gt;</p>
<p>Disabled by ===&gt;</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P4=Activate P5=Disable P6=Rules</p>
<p>Figure 1‑16 Correspondent detail screen (local correspondent)</p>
</div>
<div class="section" id="id21">
<h5>Contents of the fields<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h5>
<div class="line-block">
<div class="line"><strong>Id</strong> <em>For an e-mail correspondent:</em> the e-mail address of the
correspondent</div>
<div class="line"><em>For a local correspondent:</em> a unique identifier generated by the
self-registration procedure, or assigned by the VIRTEL administrator</div>
</div>
<div class="line-block">
<div class="line"><strong>Type of Id</strong> <strong>1</strong> this is an <em>e-mail correspondent</em></div>
<div class="line"><strong>2</strong> this is a <em>local correspondent</em> whose security code is generated
at activation time and subsequently remains constant</div>
<div class="line"><strong>3</strong> this is a <em>local correspondent</em> whose security code changes each
time it is accessed</div>
</div>
<div class="line-block">
<div class="line"><strong>Activation message</strong> Message received by the user at time of
activation of his account. This message can contain a link allowing
the user to connect to a host application or to open the <em>upload.htm</em>
page with automatic installation of an authorization cookie. The
activation message may include the following variables:</div>
<div class="line"><strong>&amp;R</strong> meaning “insert a blank line”</div>
<div class="line"><strong>&amp;C</strong> meaning “insert security code”. The activation security code is
inserted into the message in the form VirtelCookie=xxx</div>
</div>
<p><strong>Rule Set</strong> <em>(optional)</em> The name of the rule set associated with this
user.</p>
<p><strong>Credit</strong> Loading of HTML pages in a directory on the host is secured
and cannot be initiated except by a response to a previous message sent
by VIRTEL. The message may either be generated by a request for
activation, or it may be a response to a previous transfer. The credit
field defines the maximum number of times a message may be re-utilized
by submitting multiple replies.</p>
<p><strong>Directory</strong> <em>(optional)</em> Name of the directory into which this
correspondent may upload files.</p>
<p><strong>Last contact</strong> Date and time of the last transfer, and the IP address
of the correspondent.</p>
<p><strong>Contacts</strong> The number of contacts since the last activation.</p>
</div>
<div class="section" id="account-activation">
<h5>Account activation<a class="headerlink" href="#account-activation" title="Permalink to this headline">¶</a></h5>
<p>In order to be operational, a correspondent account must be activated.
This is achieved by pressing [PF4] at the CORRESPONDENT DETAIL
DEFINITION screen. In the case of an e-mail correspondent, VIRTEL will
transmit an initial e-mail to the correspondent containing the security
code to be used for the transfers. The message <em>ACTIVATION WAS
REQUESTED</em> indicates that the correspondent’s security code has been
activated, and, in the case of an e-mail correspondent, that the e-mail
was sent successfully. The number of contacts is reset to zero.</p>
<p>To activate an e-mail correspondent, the administrator must be logged on
to VIRTEL via an entry point containing a transaction with external name
$MAIL$ (application type=3) which contains, in the application field,
the name of the SMTP line used by VIRTEL. The message YOU ARE NOT
AUTHORISED TO USE THIS APPLICATION indicates that the $MAIL$ transaction
is not defined.</p>
</div>
<div class="section" id="account-deactivation">
<h5>Account deactivation<a class="headerlink" href="#account-deactivation" title="Permalink to this headline">¶</a></h5>
<p>A correspondent’s security code may be cancelled by deactivating with
the [PF5] key. The message <em>DISABLE WAS DONE</em> indicates that the
deactivation was successful.</p>
</div>
<div class="section" id="access-to-associated-rule-set">
<h5>Access to associated rule set<a class="headerlink" href="#access-to-associated-rule-set" title="Permalink to this headline">¶</a></h5>
<p>To display the list of rules associated with this correspondent, press
the [PF6] key.</p>
</div>
</div>
<div class="section" id="uploading-html-pages">
<h4>Uploading HTML pages<a class="headerlink" href="#uploading-html-pages" title="Permalink to this headline">¶</a></h4>
<p>HTML pages and other elements such as graphics can be uploaded to VIRTEL
by any of the following methods:</p>
<ol class="arabic simple">
<li>by e-mail (SMTP)</li>
<li>by web browser (HTTP), with cookie security</li>
<li>by web browser (HTTP), with signon security</li>
</ol>
<div class="section" id="uploading-pages-by-smtp">
<h5>Uploading pages by SMTP<a class="headerlink" href="#uploading-pages-by-smtp" title="Permalink to this headline">¶</a></h5>
<p>Upload by SMTP allows the administrator to load HTML pages into VIRTEL
by e-mail. VIRTEL sends the administrator an e-mail, and the
administrator replies to this e-mail with the pages to be uploaded
included as attachments. VIRTEL sends another e-mail to inform the
administrator that the upload was successful. The administrator saves
this e-mail and replies to it the next time he has a set of pages to
upload.</p>
<div class="section" id="definitions-for-page-upload-by-smtp">
<h6>Definitions for page upload by SMTP<a class="headerlink" href="#definitions-for-page-upload-by-smtp" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Check the definition of your SMTP line (F1 then F12 from the
Configuration Menu, see the VIRTEL Connectivity Reference
documentation).</li>
<li>Press F5 from the Configuration Menu and define an e-mail
correspondent specifying W2H-DIR as the directory name:</li>
</ul>
<p>CORRESPONDENT DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211; Applid: SPVIRE2
14:19:33</p>
<p>Id ===&gt; <a class="reference external" href="mailto:upload2&#37;&#52;&#48;saint&#46;cloud&#46;com">upload2<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a></p>
<p>email address with &#8216;&#64;&#8217; sign</p>
<p>Type of Id ===&gt; 1 1:Email 2:Local+fixed 3:Local+changing</p>
<p>Activation message ===&gt; To upload file(s) to VIRTEL, reply to this
message.</p>
<p>Text of &#8216;OK&#8217; message to user.</p>
<p>VTAM name ===&gt; &amp;1 parameter to specify VTAM LU name</p>
<p>Rule Set ===&gt; ADMRSET1 Rules to choose an entry point</p>
<p>Directory ===&gt; W2H-DIR Where data is to be uploaded</p>
<p>Last contact ===&gt; QUEUE ACTIVATION</p>
<p>Contacts ===&gt; 00000000 Number of times cookie was updated</p>
<p>Date created ===&gt; 11 May 2004 14:19:29</p>
<p>Created by ===&gt; VIRDBA</p>
<p>Date activated ===&gt; 11 May 2004 14:19:33</p>
<p>Activated by ===&gt; VIRDBA</p>
<p>Date disabled ===&gt;</p>
<p>Disabled by ===&gt;</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P4=Activate P5=Disable P6=Rules</p>
<p>ACTIVATION WAS REQUESTED</p>
<p>Figure 1‑17 Page upload by SMTP: Creating an e-mail correspondent</p>
</div>
<div class="section" id="procedure-for-page-upload-by-smtp">
<h6>Procedure for page upload by SMTP<a class="headerlink" href="#procedure-for-page-upload-by-smtp" title="Permalink to this headline">¶</a></h6>
<p>1. Activate the e-mail correspondent: see “Account activation” under the
heading “Correspondent management” sur la page 84. This triggers the
sending of an e-mail containing the security code, as in the following
example:</p>
<p>Date: Tue, 27 Apr 2004 12:04:40 +0100</p>
<p>From: <a class="reference external" href="mailto:virtel&#37;&#52;&#48;client&#46;com">virtel<span>&#64;</span>client<span>&#46;</span>com</a></p>
<p>Organization: SYSPERTEC COMMUNICATION</p>
<p>To: <a class="reference external" href="mailto:upload2&#37;&#52;&#48;saint&#46;cloud&#46;com">upload2<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a></p>
<p>Message-id:
&lt;20040427120439.07F5DA7C.5E416500Bgpamk4WZRKKBiZWjS4OTlqSES4OWlA==&gt;</p>
<p>Subject: OK : &lt; W2H-DIR &gt;</p>
<p>SECURITY TOKEN:
20040427120439.07F5DA7C.5E416500Bgpamk4WZRKKBiZWjS4OTlqSES4OWlA==</p>
<p>To upload file(s) to VIRTEL, reply to this message.</p>
<p>Figure 1‑18 Page upload by SMTP&nbsp;: activation e-mail</p>
<p>2. Reply to this e-mail, with the files to be uploaded (HTML pages,
graphics, etc) included as attachments. VIRTEL recognizes the security
code returned automatically by the e-mail client in the “Message-id”
field, and loads the attached files into the directory defined in the
definition of the correspondent.</p>
<p>3. VIRTEL replies by sending an e-mail containing the result of the
upload. The following example shows the reply sent by VIRTEL to a
request to upload two files: LOGOVERT.GIF and WEB2VIRT.HTM. The
“Message-id” field in this e-mail contains the new security code. You
can reply to this e-mail the next time you have files to upload.</p>
<p>Date: Tue, 27 Apr 2004 12:39:14 +0100</p>
<p>From: <a class="reference external" href="mailto:virtel&#37;&#52;&#48;client&#46;com">virtel<span>&#64;</span>client<span>&#46;</span>com</a></p>
<p>Organization: SYSPERTEC COMMUNICATION</p>
<p>To: <a class="reference external" href="mailto:upload2&#37;&#52;&#48;saint&#46;cloud&#46;com">upload2<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a></p>
<p>Message-id:
&lt;20040427123911.07F5CDC4.F669FC80Bgpamk4WZRKKBiZWjS4OTlqSES4OWlA==&gt;</p>
<p>Subject: OK : &lt;W2H-DIR &gt;</p>
<p>VirtelCookie=20040427123911.07F5CDC4.F669FC80Bgpamk4WZRKKBiZWjS4OTlqSES4OWlA==</p>
<p>RETURN CODE IS: 00</p>
<p>123911 MESSAGE RECEIVED</p>
<p>123912 LOADING FILE: LOGOVERT</p>
<p>123912 SIZE : 14357 BYTES (BINARY)</p>
<p>123912 MIME : image/jpeg</p>
<p>123914 LOADING FILE: WEB2VIRT</p>
<p>123914 SIZE : 11477 BYTES (TEXT)</p>
<p>123914 MIME : text/html</p>
<p>123914 FIELD : SET-OUTPUT-ENCODING-UTF-8 &#8220;&#8221;</p>
<p>123914 FIELD : COPY-FROM (1,1,43)</p>
<p>123914 FIELD : FIELD-WITH-CURSOR</p>
<p>123914 FIELD : FIELD-WITH-CURSOR</p>
<p>Figure 1‑19 Page upload by SMTP&nbsp;: upload response e-mail</p>
<p>Depending on the values specified in the directory definition, VIRTEL
may convert the filename to upper case, and truncate the filename to a
maximum length, before storing it in the directory. The filename after
conversion and truncation must not duplicate any other filename in the
directory. For example, when uploading to a directory defined using the
default parameters (not case sensitive, with maximum filename length 8),
the file <em>links.gif</em> would be stored under the name LINKS.GI</p>
</div>
</div>
<div class="section" id="uploading-pages-by-http-secured-by-cookie">
<h5>Uploading pages by HTTP (secured by cookie)<a class="headerlink" href="#uploading-pages-by-http-secured-by-cookie" title="Permalink to this headline">¶</a></h5>
<p>The <em>upload.htm</em> page allows HTML pages or graphics to be uploaded to
VIRTEL. The user’s identity is guaranteed by a cookie named VirtelRef=
whose value changes after each upload. The value of the cookie is the
same as the security code used for uploading by SMTP.</p>
<p>To upload a page, a user must:</p>
<ul class="simple">
<li>have a valid cookie (obtained by activation of the VIRTEL e-mail
correspondent)</li>
<li>click on the link contained in the e-mail, which displays the
<em>upload.htm</em> page and loads the cookie into the browser (first time
only)</li>
<li>click the “Browse” button and select a file</li>
<li>click the “Send” button</li>
</ul>
<p>The VIRTEL response is displayed in the page and is similar to the
response received by e-mail when uploading via SMTP.</p>
<div class="section" id="definitions-for-page-upload-secured-by-cookie">
<h6>Definitions for page upload secured by cookie<a class="headerlink" href="#definitions-for-page-upload-secured-by-cookie" title="Permalink to this headline">¶</a></h6>
<p>All the elements needed for page upload by HTTP secured by cookie are
contained in the base configuration delivered with VIRTEL 4.27. Users
who upgrade to VIRTEL 4.27 while keeping their existing configuration
need to add certain elements to their existing configuration to benefit
from the new “page upload secured by cookie” function.</p>
<p>The following steps show how to upgrade your configuration based on
entry point WEB2HOST. You can also carry out these steps in batch by
running the DEFUPLOD job in the SAMPLIB delivered with VIRTEL version
4.27. Having updated the configuration, you then need to upload three
new elements (<em>upload.htm</em>, <em>default.js</em>, and <em>logo_3.gif</em>) to the
W2H-DIR directory using the existing SMTP upload method.</p>
<ul class="simple">
<li>In entry point WEB2HOST, define a new transaction W2H–70, with
external name <em>upload</em>. This transaction specifies VIR0041C as the
application name and application type 2. The “Logon message” field is
blank to indicate to VIRTEL that the name of the target directory is
to be found in the definition of the e-mail correspondent:</li>
</ul>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
14:34:08</p>
<p>Internal name ===&gt; W2H-70 To associate with an entry point name</p>
<p>External name ===&gt; upload Name displayed on user menu</p>
<p>Description ===&gt; Upload HTML pages (secured by cookie)</p>
<p>Application ===&gt; VIR0041C Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 2 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; DELOC Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 2 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 0 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt;</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑20 Page upload by HTTP with cookie&nbsp;: Creating the ‘upload’
transaction</p>
<ul class="simple">
<li>Check the definition of your SMTP line (F1 then F12 from the
Configuration Menu, see the VIRTEL Connectivity Reference
documentation).</li>
<li>Press F5 from the Configuration Menu and define an e-mail
correspondent specifying directory name W2H-DIR and ruleset name
ADMRSET1&nbsp;:</li>
</ul>
<p>CORRESPONDENT DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211; Applid: SPVIRE2
14:39:04</p>
<p>e-mail address ===&gt; <a class="reference external" href="mailto:upload2&#37;&#52;&#48;saint&#46;cloud&#46;com">upload2<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a></p>
<p>email address with &#8216;&#64;&#8217; sign</p>
<p>Type of Id ===&gt; 1 1:Email 2:Local+fixed 3:Local+changing</p>
<p>Activation message ===&gt; To upload to VIRTEL,
click:&amp;Rhttp://192.168.229.20:4100</p>
<p>1/web2host/upload.htm+upload+&amp;C</p>
<p>Text of &#8216;OK&#8217; message to user.</p>
<p>VTAM name ===&gt; &amp;1 parameter to specify VTAM LU name</p>
<p>Rule Set ===&gt; ADMRSET1 Rules to choose an entry point</p>
<p>Directory ===&gt; W2H-DIR Where data is to be uploaded</p>
<p>Last contact ===&gt;</p>
<p>Contacts ===&gt; 00000000 Number of times cookie was updated</p>
<p>Date created ===&gt; 11 May 2004 14:19:29</p>
<p>Created by ===&gt; VIRDBA</p>
<p>Date activated ===&gt; 11 May 2004 14:39:04</p>
<p>Activated by ===&gt; VIRDBA</p>
<p>Date disabled ===&gt;</p>
<p>Disabled by ===&gt;</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P4=Activate P5=Disable P6=Rules</p>
<p>ACTIVATION WAS REQUESTED</p>
<p>Figure 1‑21 Page upload by HTTP with cookie&nbsp;: Creating the e-mail
correspondent</p>
<ul class="simple">
<li>Press F6 then F12 to create rule UPLOAD1B in ruleset ADMRSET1&nbsp;:</li>
</ul>
<p>DETAIL of RULE from RULE SET: ADMRSET1 &#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
14:40:59</p>
<p>Name ===&gt; UPLOAD1B Rule priority is per name</p>
<p>Status ===&gt; ACTIVE Mon, 24 Sep 2001 14:19:14</p>
<p>Description ===&gt; Rule for WEB2HOST administrator</p>
<p>Entry point ===&gt; WEB2HOST Target Entry Point</p>
<p>Parameter ===&gt; optional &amp;1 value</p>
<p>Trace ===&gt; 1=commands 2=data 3=partner</p>
<p>C : 0=IGNORE 1=IS 2=IS NOT 3=STARTS WITH 4=DOES NOT 5=ENDS WITH 6=DOES
NOT</p>
<p>0 IP Subnet ===&gt; Mask ===&gt;</p>
<p>5 HTTP Host ===&gt; :41001</p>
<p>0 eMail ===&gt;</p>
<p>0 Calling DTE ===&gt; Calling DTE address</p>
<p>0 Called ===&gt; Called DTE address</p>
<p>0 CUD0 (Hex) ===&gt; First 4 bytes of CUD (X25 protocol)</p>
<p>0 User Data ===&gt;</p>
<p>0 Days ===&gt; M: T: W: T: F: S: S:</p>
<p>0 Start time ===&gt; H: M: S: End time ===&gt; H: M: S:</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P4=Activate P5=Inactivate P12=Entry P.</p>
<p>Figure 1‑22 Page upload by HTTP with cookie&nbsp;: Creating rule UPLOAD1B</p>
<ul class="simple">
<li>Define two new rules attached to the HTTP line. The first rule, which
specifies $COOKIE$ as the entry point name, will be used for
administrators; the second rule, which specifies entry point
WEB2HOST, is for all other users:</li>
</ul>
<p>LIST of RULES in RULE SET: W-HTTP &#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
14:44:14</p>
<p>Name Status Description Entry</p>
<p>Point</p>
<p>WHT00100 ACTIVE HTTP access (users authorised by cookie) $COOKIE$</p>
<p>WHT00200 ACTIVE HTTP access (other users) WEB2HOST</p>
<p>P1=Update P2=Suppress P3=Return</p>
<p>P6=1st page P7=Page-1 P8=Page+1 P12=Edit</p>
<p>DETAIL of RULE from RULE SET: W-HTTP &#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
14:45:34</p>
<p>Name ===&gt; WHT00100 Rule priority is per name</p>
<p>Status ===&gt; ACTIVE Mon, 24 Sep 2001 14:19:14</p>
<p>Description ===&gt; HTTP access (users authorised by cookie)</p>
<p>Entry point ===&gt; $COOKIE$ Target Entry Point</p>
<p>Parameter ===&gt; optional &amp;1 value</p>
<p>Trace ===&gt; 1=commands 2=data 3=partner</p>
<p>C : 0=IGNORE 1=IS 2=IS NOT 3=STARTS WITH 4=DOES NOT 5=ENDS WITH 6=DOES
NOT</p>
<p>0 IP Subnet ===&gt; Mask ===&gt;</p>
<p>0 HTTP Host ===&gt;</p>
<p>0 eMail ===&gt;</p>
<p>0 Calling DTE ===&gt; Calling DTE address</p>
<p>0 Called ===&gt; Called DTE address</p>
<p>0 CUD0 (Hex) ===&gt; First 4 bytes of CUD (X25 protocol)</p>
<p>0 User Data ===&gt;</p>
<p>0 Days ===&gt; M: T: W: T: F: S: S:</p>
<p>0 Start time ===&gt; H: M: S: End time ===&gt; H: M: S:</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P4=Activate P5=Inactivate P12=Entry P.</p>
<p>DETAIL of RULE from RULE SET: W-HTTP &#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
14:45:56</p>
<p>Name ===&gt; WHT00200 Rule priority is per name</p>
<p>Status ===&gt; ACTIVE Mon, 24 Sep 2001 14:19:14</p>
<p>Description ===&gt; HTTP access (other users)</p>
<p>Entry point ===&gt; WEB2HOST Target Entry Point</p>
<p>Parameter ===&gt; optional &amp;1 value</p>
<p>Trace ===&gt; 1=commands 2=data 3=partner</p>
<p>C : 0=IGNORE 1=IS 2=IS NOT 3=STARTS WITH 4=DOES NOT 5=ENDS WITH 6=DOES
NOT</p>
<p>0 IP Subnet ===&gt; Mask ===&gt;</p>
<p>0 HTTP Host ===&gt;</p>
<p>0 eMail ===&gt;</p>
<p>0 Calling DTE ===&gt; Calling DTE address</p>
<p>0 Called ===&gt; Called DTE address</p>
<p>0 CUD0 (Hex) ===&gt; First 4 bytes of CUD (X25 protocol)</p>
<p>0 User Data ===&gt;</p>
<p>0 Days ===&gt; M: T: W: T: F: S: S:</p>
<p>0 Start time ===&gt; H: M: S: End time ===&gt; H: M: S:</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P4=Activate P5=Inactivate P12=Entry P.</p>
<p>Figure 1‑23 Page upload by HTTP with cookie&nbsp;: Rules of the HTTP line</p>
</div>
<div class="section" id="procedure-for-page-upload-secured-by-cookie">
<h6>Procedure for page upload secured by cookie<a class="headerlink" href="#procedure-for-page-upload-secured-by-cookie" title="Permalink to this headline">¶</a></h6>
<p>1. (First time only) Activate the e-mail correspondent: see “Account
activation” under the heading “Correspondent management” sur la page 84.
This triggers the sending of an e-mail containing the security code, as
in the following example:</p>
<p>Date: Tue, 27 Apr 2004 13:08:44 +0100</p>
<p>From: <a class="reference external" href="mailto:virtel&#37;&#52;&#48;client&#46;com">virtel<span>&#64;</span>client<span>&#46;</span>com</a></p>
<p>Organization: SYSPERTEC COMMUNICATION</p>
<p>To: <a class="reference external" href="mailto:upload2&#37;&#52;&#48;saint&#46;cloud&#46;com">upload2<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a></p>
<p>Message-id:
&lt;20040427130843.07F5D1DC.56A85680Bgpamk4WZRKKBiZWjS4OTlqSES4OWlA==&gt;</p>
<p>Subject: OK : &lt; W2H-DIR &gt;</p>
<p>SECURITY TOKEN:
20040427130843.07F5D1DC.56A85680Bgpamk4WZRKKBiZWjS4OTlqSES4OWlA==</p>
<p>To upload to VIRTEL, click:</p>
<p><a class="reference external" href="http://192.168.229.20:41001/web2host/upload.htm+upload+VirtelCookie=20040427130843.07F5D1DC.56A85680Bgpamk4WZRKKBiZWjS4OTlqSES4OWlA==">http://192.168.229.20:41001/web2host/upload.htm+upload+VirtelCookie=20040427130843.07F5D1DC.56A85680Bgpamk4WZRKKBiZWjS4OTlqSES4OWlA==</a></p>
<p>Figure 1‑24 Page upload by HTTP with cookie&nbsp;: activation e-mail</p>
<ol class="arabic simple" start="2">
<li>Click the link in the e-mail to open the <em>upload.htm</em> page:</li>
</ol>
<p><a class="reference internal" href="../../../_images/image521.png"><img alt="SmartCaptureSend" src="../../../_images/image521.png" style="width: 5.80208in; height: 3.93750in;" /></a></p>
<p>Figure 1‑25 Page upload by HTTP with cookie&nbsp;: Displaying the upload.htm
page</p>
<p>3. Click the “Browse” button and the file selection dialog will be
displayed:</p>
<p><a class="reference internal" href="../../../_images/image521.png"><img alt="SmartCaptureSend" src="../../../_images/image521.png" style="width: 5.80208in; height: 3.93750in;" /></a></p>
<p>Figure 1‑26 Page upload by HTTP with cookie&nbsp;: File selection dialog</p>
<p>4. Select the file you want to upload, then press the “Open” button. The
name of the selected file will be displayed in the input field:</p>
<p><a class="reference internal" href="../../../_images/image521.png"><img alt="SmartCaptureSend" src="../../../_images/image521.png" style="width: 5.80208in; height: 3.93750in;" /></a></p>
<p>Figure 1‑27 Page upload by HTTP with cookie&nbsp;: Sending the file</p>
<p>5. Press the “Send File” button to upload the file to VIRTEL. VIRTEL
stores the file in the directory (W2H-DIR in this example) specified in
the definition of the correspondent associated with the cookie. VIRTEL
then displays the result of the upload:</p>
<p><a class="reference internal" href="../../../_images/image521.png"><img alt="SmartCaptureSend" src="../../../_images/image521.png" style="width: 5.80208in; height: 3.93750in;" /></a></p>
<p>Figure 1‑28 Page upload by HTTP with cookie&nbsp;: Confirmation of file
uploadr</p>
<p>From now on, the cookies are managed automatically. After each upload,
VIRTEL sends a new cookie to the browser, as indicated by the message
“Upload code was set by the remote host”.</p>
<p>Depending on the values specified in the directory definition, VIRTEL
may convert the file name to upper case, and truncate the filename to a
maximum length, before storing it in the directory. The filename after
conversion and truncation must not duplicate any other filename in the
directory. For example, when uploading to a directory defined using the
default parameters (not case sensitive, with maximum filename length 8),
the file <em>links.gif</em> would be stored under the name LINKS.GI</p>
</div>
</div>
<div class="section" id="uploading-pages-by-http-secured-by-signon">
<h5>Uploading pages by HTTP (secured by signon)<a class="headerlink" href="#uploading-pages-by-http-secured-by-signon" title="Permalink to this headline">¶</a></h5>
<p>The <em>upload4.htm</em> page allows the administrator to upload HTML pages and
graphics to VIRTEL. When this page is first loaded, the web browser
displays a signon dialog box requesting a userid and password. The
userid allows the security product (RACF, ACF2, TSS, or VIRTEL) to
determine which, if any, of the page upload transactions the user is
authorized to use. Each VIRTEL directory has its own upload transaction,
so that upload security can be applied individually to each directory,
by authorizing users to the corresponding directory’s upload
transaction.</p>
<div class="section" id="definitions-for-page-upload-secured-by-signon">
<h6>Definitions for page upload secured by signon<a class="headerlink" href="#definitions-for-page-upload-secured-by-signon" title="Permalink to this headline">¶</a></h6>
<p>All the elements needed for page upload by HTTP secured by signon are
contained in the base configuration delivered with VIRTEL. Users who
upgrade from a version prior to VIRTEL 4.27 while keeping their existing
configuration need to add certain elements to their existing
configuration to benefit from the new “page upload secured by signon”
function.</p>
<p>The following steps show how to upgrade your configuration based on
entry point WEB2HOST. You can also carry out these steps in batch by
running the DEFUPLOD job in the SAMPLIB delivered with VIRTEL. Having
updated the configuration, you then need to upload one new page
(<em>upload4.htm</em>) to the W2H-DIR directory using the existing SMTP upload
method.</p>
<ul class="simple">
<li>In entry point WEB2HOST, define a new transaction W2H-68 with
external name <em>dirlist,</em> application name VIR0041S and application
type 2:</li>
</ul>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRBW
15:01:19</p>
<p>Internal name ===&gt; W2H-68 To associate with an entry point name</p>
<p>External name ===&gt; dirlist Name displayed on user menu</p>
<p>Description ===&gt; List of directories for page upload</p>
<p>Application ===&gt; VIR0041S Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 2 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; DELOC Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 2 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 0 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt;</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑29 Page upload by HTTP with signon&nbsp;: Transaction ‘dirlist’</p>
<ul class="simple">
<li>Still in entry point WEB2HOST, define three new transactions W2H–71,
W2H-72, W2H-73 with external names <em>uplbas, uplw2h,</em> and <em>uplcli</em>.
Each of these transactions specifies VIR0041C as the application name
and application type 2. The “Logon message” field contains the name
of the target directory: HTMLBAS for transaction <em>uplbas</em>, W2H-DIR
for transaction <em>uplw2h,</em> and CLI-DIR for <em>uplcli&nbsp;</em>:</li>
</ul>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
15:02:23</p>
<p>Internal name ===&gt; W2H-71 To associate with an entry point name</p>
<p>External name ===&gt; uplbas Name displayed on user menu</p>
<p>Description ===&gt; Chargement des pages HTML (répertoire HTMLBAS)</p>
<p>Application ===&gt; VIR0041C Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 2 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; DELOC Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 2 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 1 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt; HTMLBAS</p>
<p>TIOA at logon ===&gt;</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
15:03:01</p>
<p>Internal name ===&gt; W2H-72 To associate with an entry point name</p>
<p>External name ===&gt; uplw2h Name displayed on user menu</p>
<p>Description ===&gt; Chargement des pages HTML (répertoire W2H-DIR)</p>
<p>Application ===&gt; VIR0041C Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 2 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; DELOC Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 2 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 1 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt; W2H-DIR</p>
<p>TIOA at logon ===&gt;</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
15:03:21</p>
<p>Internal name ===&gt; W2H-73 To associate with an entry point name</p>
<p>External name ===&gt; uplcli Name displayed on user menu</p>
<p>Description ===&gt; Chargement des pages HTML (répertoire CLI-DIR)</p>
<p>Application ===&gt; VIR0041C Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 2 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; DELOC Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 2 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 1 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt; CLI-DIR</p>
<p>TIOA at logon ===&gt;</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑30 Page upload by HTTP with signon&nbsp;: Transactions ‘uplxxx’</p>
<ul class="simple">
<li>Use your security package (VIRTEL/SECURITE, RACF, TOP&nbsp;SECRET, ACF2)
to grant access to resources W2H-71 and HTMLBAS (for users authorized
to upload pages to the HTMLBAS directory) and/or to resources W2H-72
and W2H-DIR (for users authorized to upload pages to the W2H-DIR
directory) and/or to resources W2H-73 and CLI-DIR (for users
authorized to upload pages to the CLI-DIR directory). For more
details, refer to the “Virtel Security Guide” manual.</li>
</ul>
</div>
<div class="section" id="procedure-for-page-upload-secured-by-signon">
<h6>Procedure for page upload secured by signon<a class="headerlink" href="#procedure-for-page-upload-secured-by-signon" title="Permalink to this headline">¶</a></h6>
<p>1. Display the <em>upload4.htm</em> page by entering the URL
<em>http://ipaddr:port/SECURE/upload4.htm+dirlist</em> in your browser, or by
clicking the “Upload” link on the VIRTEL Web2Host welcome page. Because
the directory named SECURE is defined as a secure transaction, VIRTEL
first requests the browser to display the password dialog box shown
below:</p>
<p><a class="reference internal" href="../../../_images/image521.png"><img alt="SmartCaptureSend" src="../../../_images/image521.png" style="width: 5.80208in; height: 3.93750in;" /></a></p>
<p>Figure 1‑31 Page upload by HTTP with signon&nbsp;: Entering the userid and
password</p>
<p>The user must have authority to access the resource represented by the
internal name of the page upload transaction for the desired directory.</p>
<p>2. After entering the user name and password, the <em>upload4.htm</em> page
will be displayed:</p>
<p><a class="reference internal" href="../../../_images/image521.png"><img alt="SmartCaptureSend" src="../../../_images/image521.png" style="width: 5.80208in; height: 3.93750in;" /></a></p>
<p>Figure 1‑32 Page upload by HTTP with signon&nbsp;: Displaying the upload4.htm
page</p>
<ol class="arabic simple" start="3">
<li>Press the “Browse” button to display the file selection dialog:</li>
</ol>
<p><a class="reference internal" href="../../../_images/image521.png"><img alt="SmartCaptureSend" src="../../../_images/image521.png" style="width: 5.80208in; height: 3.93750in;" /></a></p>
<p>Figure 1‑33 Page upload by HTTP with signon&nbsp;: File selection dialog</p>
<p>4. Select the file you want to upload, then press the “Open” button. The
name of the selected file will be displayed in the input field:</p>
<p><a class="reference internal" href="../../../_images/image521.png"><img alt="SmartCaptureSend" src="../../../_images/image521.png" style="width: 5.80208in; height: 3.93750in;" /></a></p>
<p>Figure 1‑34 Page upload by HTTP with signon&nbsp;: Sending the file</p>
<p>5. Press the button corresponding to the target directory (W2H-DIR in
this example) to upload the file to VIRTEL. VIRTEL stores the file in
the chosen directory, and displays the result:</p>
<p><a class="reference internal" href="../../../_images/image521.png"><img alt="SmartCaptureSend" src="../../../_images/image521.png" style="width: 5.80208in; height: 3.93750in;" /></a></p>
<p>Figure 1‑35 Page upload by HTTP with signon&nbsp;: Confirmation of file
upload</p>
<p>Depending on the values specified in the directory definition, VIRTEL
may convert the filename to upper case, and truncate the filename to a
maximum length, before storing it in the directory. The filename after
conversion and truncation must not duplicate any other filename in the
directory. For example, when uploading to a directory defined using the
default parameters (not case sensitive, with maximum filename length 8),
the file <em>links.gif</em> would be stored under the name LINKS.GI</p>
</div>
</div>
<div class="section" id="uploading-pages-by-drag-and-drop">
<h5>Uploading pages by drag and drop<a class="headerlink" href="#uploading-pages-by-drag-and-drop" title="Permalink to this headline">¶</a></h5>
<p>The VIRTEL administrator can upload pages to a VIRTEL directory using
the drag and drop upload interface with the <strong>Firefox</strong> or <strong>Chrome</strong>
browser. This method has the advantage that multiple pages can be
uploaded to a VIRTEL directory (for example, W2H-DIR) in a single
operation.</p>
<div class="section" id="upload-interface-in-the-virtel-menu">
<h6>Upload interface in the VIRTEL menu<a class="headerlink" href="#upload-interface-in-the-virtel-menu" title="Permalink to this headline">¶</a></h6>
<p>After clicking on the <strong>Drag &amp; Drop Upload</strong> link on the VIRTEL Web
Access menu (URL <em>http://n.n.n.n:41001</em>), the VIRTEL administrator will
be presented with a signon screen, followed by the drag and drop upload
interface screen shown below:</p>
<p><a class="reference internal" href="../../../_images/image171.png"><img alt="image11" src="../../../_images/image171.png" style="width: 5.78125in; height: 2.52083in;" /></a></p>
<p>Figure 1‑36 Drag and drop upload interface</p>
<p>The administrator can then select one or more files using the
workstation graphical user interface, drag them to the upload interface
screen, and drop them on the button representing the VIRTEL directory
(for example, CLI-DIR). Files in zipped archive may need to be extracted
to a temporary directory first.</p>
</div>
<div class="section" id="displaying-upload-results">
<h6>Displaying upload results<a class="headerlink" href="#displaying-upload-results" title="Permalink to this headline">¶</a></h6>
<p><a class="reference internal" href="../../../_images/image181.png"><img alt="image12" src="../../../_images/image181.png" style="width: 5.73958in; height: 4.30208in;" /></a></p>
<p>Figure 1‑37 Displaying upload results</p>
<p>The results of the upload are displayed on the screen with a return code
for each file uploaded. Each file should produce the message <strong>RETURN
CODE IS: 00</strong> In addition, by clicking on <strong>+</strong> or <strong>-</strong>, the
administrator can open and close the detail display for each file
uploaded.</p>
</div>
<div class="section" id="upload-summary-report">
<h6>Upload summary report<a class="headerlink" href="#upload-summary-report" title="Permalink to this headline">¶</a></h6>
<p>After multiple files have been uploaded, the drag and drop upload
interface will display a summary showing the number of files processed
with return code 00, and, in case of error, the number of files which
failed to upload non-zero return codes.</p>
<p>The summary is not displayed when files are dragged and dropped one at a
time.</p>
<p>In this example, one file has failed to upload because of an invalid
VIRTEL tag, and the user has clicked on the + sign to the left of the
file to expand the error messages:</p>
<p><a class="reference internal" href="../../../_images/image191.png"><img alt="image13" src="../../../_images/image191.png" style="width: 5.64583in; height: 2.62500in;" /></a></p>
<p>Figure 1‑38 Upload summary report</p>
</div>
<div class="section" id="extracting-upload-results-as-an-excel-spreadsheet">
<h6>Extracting upload results as an Excel spreadsheet<a class="headerlink" href="#extracting-upload-results-as-an-excel-spreadsheet" title="Permalink to this headline">¶</a></h6>
<p>The Excel button <a class="reference internal" href="../../../_images/image201.png"><img alt="excel" src="../../../_images/image201.png" style="width: 0.16667in; height: 0.16667in;" /></a> allows the administrator to export the results
log as a .SLK file which can be opened as an Excel spreadsheet.</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="17%" />
<col width="27%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">directory</th>
<th class="head">file name</th>
<th class="head">report</th>
<th class="head">time</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>CLI-DIR</td>
<td>custom.css</td>
<td>RETURN CODE IS: 00</td>
<td>Thu, 13 Sep 2012 08:13:16 GMT</td>
</tr>
<tr class="row-odd"><td>CLI-DIR</td>
<td>custom.js</td>
<td>RETURN CODE IS: 00</td>
<td>Thu, 13 Sep 2012 08:13:16 GMT</td>
</tr>
</tbody>
</table>
<p>The Delete button <a class="reference internal" href="../../../_images/image211.png"><img alt="trash" src="../../../_images/image211.png" style="width: 0.16667in; height: 0.16667in;" /></a> allows the administrator to clear the results
log.</p>
</div>
</div>
<div class="section" id="uploading-pages-in-batch">
<h5>Uploading pages in batch<a class="headerlink" href="#uploading-pages-in-batch" title="Permalink to this headline">¶</a></h5>
<div class="section" id="uploading-with-curl">
<h6>Uploading with cURL<a class="headerlink" href="#uploading-with-curl" title="Permalink to this headline">¶</a></h6>
<p>You can upload multiple pages (or other elements) at a time from a
Windows workstation by using a command-line HTTP-client program, such as
<strong>*cURL*</strong> from <a class="reference external" href="http://www.haxx.se">www.haxx.se</a>.</p>
<p>The following example shows a Windows command to upload all files of
type <strong>*.htm*</strong> from the current directory to VIRTEL:</p>
<p>for %F in (*.htm) do curl -v -F &#8220;<a class="reference external" href="mailto:file=&#37;&#52;&#48;%F">file=<span>&#64;</span>%F</a>;type=text/html&#8221; -u
virdba:virdbapw http://192.168.235.30:41001/SECURE/virmsg.txt+uplbas</p>
<p>In this example:</p>
<p><strong>**.htm*</strong> = the files to be uploaded</p>
<p><strong>*virdba:virdbapw*</strong> = userid and password for VIRTEL</p>
<p><strong>*192.168.235.30:41001*</strong> = identifies the VIRTEL HTTP line</p>
<p><strong>*virmsg.txt*</strong> = page template for displaying upload result messages</p>
<p><strong>*uplbas*</strong> = external name of the upload transaction in VIRTEL which
specifies the target directory (HTMLBAS). See “Definitions for page
upload secured by signon” sur la page 93 for a list of upload
transactions.</p>
<p>Note: %F appears twice in the command shown above. In conformance with
the syntax requirements of the Windows command interpreter, you must use
%F if you execute the command from the command prompt, but %%F if you
execute the command from within a command (.cmd) file.</p>
</div>
<div class="section" id="the-upl2virt-command-procedure">
<h6>The upl2virt command procedure<a class="headerlink" href="#the-upl2virt-command-procedure" title="Permalink to this headline">¶</a></h6>
<p>For users of Windows XP and above, the command procedure <em>upl2virt.cmd</em>
may be used to upload elements to VIRTEL from the Windows command
prompt, or from Windows Explorer. <em>upl2virt</em> automatically generates the
required cURL commands as described in the previous section.</p>
<p>Pre-requisites</p>
<p><em>upl2virt</em> requires as a pre-requisite the <strong>*cURL*</strong> package described
in the previous section.</p>
<p>Optionally, Bill Stewart’s <em>editvar</em> freeware package from
<a class="reference external" href="http://www.westmesatech.com">www.westmesatech.com</a> may also be
installed. This package allows <em>upl2virt</em> to securely prompt the
administrator for a password. If the <em>editvar</em> package is not installed,
then <em>upl2virt</em> can still prompt for a password but it will be unable to
mask the password as the administrator types it into the command window.</p>
<p>Installation</p>
<p><em>upl2virt</em> may be downloaded from VIRTEL to the workstation by entering
the following URL in your browser: <em>http://n.n.n.n:41001/upl2virt.cmd</em>
(where <em>n.n.n.n</em> is the IP address of VIRTEL). When prompted, save the
<em>upl2virt.cmd</em> file in a directory in your path (for example,
C:\WINDOWS).</p>
<p>Using upl2virt at the command prompt</p>
<p>To execute <em>upl2virt</em> as a command, open a Windows command prompt,
navigate to the directory which contains the file(s) to be uploaded, and
execute the command:</p>
<p>upl2virt [-u userid:password] -d directory -a n.n.n.n</p>
<p>[-p port] [-r] [-f ctlfile] [-k] [file1 file2 ...]</p>
<p>In the above command:</p>
<p><strong>*userid*:*password*</strong> is your VIRTEL userid and password. If not
specified, <em>upl2virt</em> will prompt for userid and password. If userid is
specified without the password, then <em>upl2virt</em> will prompt for
password.</p>
<p><strong>*directory*</strong> is the name of the target VIRTEL directory (for example,
CLI-DIR)</p>
<p><strong>*n.n.n.n*</strong> is the IP address of VIRTEL</p>
<p><strong>*port*</strong> is the VIRTEL administration port number (default 41001).</p>
<p>Note: this is the port number for the WEB2HOST entry point, not the port
number associated with the directory you are uploading to.</p>
<p><strong>*ctlfile*</strong> specifies the name of a control file containing a list of
file names to be uploaded</p>
<p><strong>*file1 file2* ...</strong> are the names of files to be uploaded</p>
<p><strong>-r</strong> specifies recursion into subdirectories</p>
<p><strong>-k</strong> keeps the command window open after the last upload</p>
<p>If no file names are specified, and no control file is specified, the
default is to upload all web elements from the current directory (and
also from all subdirectories if the –r option is specified).</p>
<p>Using upl2virt from Windows Explorer</p>
<p>The <em>upl2virt</em> command may also be used to upload elements to VIRTEL
from the Windows Explorer interface. Having selected one or more files
in Windows Explorer, the administrator right-clicks on the selected
files and chooses the “Send To” option, then chooses “Upload to VIRTEL”
from the “Send To” menu.</p>
<p>To activate the “Upload to VIRTEL” option in the “Send To” menu, use
Windows Explorer to navigate to the “c:\Documents and
Settings\<em>username</em>\SendTo” folder, where <em>username</em> is your Windows
username. If you cannot see the SendTo folder, then click on “Tools” –
“Folder options” – “View”, tick the option “Display hidden files and
folders”, and click “OK”.</p>
<p>In the “SendTo” folder, right click and select “New” – “Shortcut”. Then
click “Browse”, navigate to the place where you stored the
<em>upl2virt.cmd</em> file, and click on it. Click “Next” and enter a
descriptive title for the menu item, such as “Upload to VIRTEL”. Then
click “Finish”.</p>
<p>You now have an item in the “SendTo” folder named <em>“Upload to VIRTEL”</em>.
Right-click on this item and choose “Properties”. In the “Target” field
you will see the path to the <em>upl2virt.cmd</em> file which you specified.
Update this field with parameters as shown in the example below:</p>
<p>C:\WINDOWS\upl2virt.cmd -u MYUSERID -d CLI-DIR -a 10.1.12.101 –k</p>
<p>where MYUSERID is your VIRTEL userid, CLI-DIR is the name of the VIRTEL
directory that this shortcut will upload to, and 10.1.12.101 is the IP
address of VIRTEL. You may omit the –u MYUSERID parameter and <em>upl2virt</em>
will prompt you for your userid.</p>
</div>
</div>
</div>
<div class="section" id="web-access-customization">
<h4>Web Access customization<a class="headerlink" href="#web-access-customization" title="Permalink to this headline">¶</a></h4>
<p>The VIRTEL Web Access user can use the Settings menu to modify certain
options such as font size, 3270 key mappings, and color schemes. The
user’s settings are stored in a browser local storage which remains
valid so long as cookies are not deleted from the workstation. The
settings stored in the user’s local storage override the default
settings for VIRTEL Web Access which are stored in the <em>w2hparm.js</em>
file. See “Global modification of Web Access settings” sur la page 113.</p>
<div class="section" id="web-access-settings-menu">
<h5>Web Access Settings menu<a class="headerlink" href="#web-access-settings-menu" title="Permalink to this headline">¶</a></h5>
<p>When the user clicks the <a class="reference internal" href="../../../_images/image221.jpeg"><img alt="settings" src="../../../_images/image221.jpeg" style="width: 0.22917in; height: 0.22917in;" /></a> button on the VIRTEL Web Access
toolbar, the window shown below opens:</p>
<p><a class="reference internal" href="../../../_images/image231.png"><img alt="image17" src="../../../_images/image231.png" style="width: 5.89583in; height: 7.23958in;" /></a></p>
<p>Figure 1‑39 VIRTEL Web Access Settings menu (part 1 of 3)</p>
<p><a class="reference internal" href="../../../_images/image241.png"><img alt="image18" src="../../../_images/image241.png" style="width: 5.91667in; height: 7.23958in;" /></a></p>
<p>Figure 1‑40 VIRTEL Web Access Settings menu (part 2 of 3)</p>
<p><a class="reference internal" href="../../../_images/image251.png"><img alt="image19" src="../../../_images/image251.png" style="width: 5.98958in; height: 7.29167in;" /></a></p>
<p>Figure 1‑41 VIRTEL Web Access Settings menu (part 3 of 3)</p>
</div>
<div class="section" id="id22">
<h5>Contents of the fields<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h5>
<p><strong>Font Size</strong> Size of font. Possible values are:</p>
<blockquote>
<div><p><a href="#id23"><span class="problematic" id="id24">**</span></a>Window
<a href="#id25"><span class="problematic" id="id26">**</span></a>VIRTEL calculates the font size to fit the browser’s window
size.</p>
<p><a href="#id27"><span class="problematic" id="id28">**</span></a>Screen
<a href="#id29"><span class="problematic" id="id30">**</span></a>VIRTEL calculates the font size to fit the display screen size.</p>
<p><a href="#id31"><span class="problematic" id="id32">**</span></a>nn
<a href="#id33"><span class="problematic" id="id34">**</span></a>VIRTEL uses a fixed font size. nn is the size in “points”: 8pt,
10pt, 12pt, 14pt, or 16pt.</p>
</div></blockquote>
<p><strong>Font family</strong> Name of font. The panel displays a list of fonts known
to VIRTEL and installed on the workstation, in addition to the fonts
supplied by VIRTEL. If the required font is not in the list, click the
ellipsis to the right of the selection box and type the name of the font
in the box. Any fixed-width font installed on the workstation may be
specified.</p>
<p><strong>Auto-capture</strong> When activated, causes a snapshot of each screen
displayed by the host application to be automatically appended to the
screen capture window.</p>
<p><strong>Auto-print</strong> When activated, causes the Windows print function to be
launched automatically in the print window as a result of a screen
snapshot or print request.</p>
<p><strong>Cursor</strong> The shape of the 3270 cursor. The possible settings are:</p>
<blockquote>
<div><p><strong>Bar</strong> The character at the cursor position is underlined</p>
<p><strong>Block</strong> The character at the cursor position is in reverse video</p>
<p><strong>Blink</strong> The character at the cursor position is in blinking
reverse video</p>
</div></blockquote>
<p>Note: For Internet Explorer versions 6 and 7, Blink is the same as Block</p>
<p><a href="#id35"><span class="problematic" id="id36">**</span></a>Vertical line, Horiz line
<a href="#id37"><span class="problematic" id="id38">**</span></a>When activated, causes the position of the cursor to be marked with
a vertical line and/or a horizontal line extending to the edges of the
3270 window (also known as a “crosshair cursor”).</p>
<p><strong>Esc key</strong> to <a href="#id39"><span class="problematic" id="id40">**</span></a>Alt+F3
<a href="#id41"><span class="problematic" id="id42">**</span></a>Defines the mapping of workstation keyboard to 3270 keys. The value
“no” indicates that the keystroke is ignored.</p>
<p>For example the 3270 PA1 key may be assigned to the PageUp key, to the
Alt+PageUp key, and/or to the Alt+F1 key on the user’s keyboard.</p>
<p>Note: For Internet Explorer, the “Ctrl key” setting refers to the right
Ctrl key. For Firefox, Chrome, and Safari the “Ctrl key” setting applies
to both the left and right Ctrl keys identically. For Firefox, the
“Keypad Enter” setting is ignored. For Internet Explorer versions 6, 7,
and 8, a browser helper object (virtkey.dll) must be installed to allow
recognition of the keypad Enter key. This BHO is not needed for Internet
Explorer 9.</p>
<p>The ChgCur setting allows the user to toggle the cursor between the
“bar”, “block”, “bar+crosshairs”, and “block+crosshairs” style.</p>
<p><strong>Keypad</strong> /*-<strong>+.</strong> Allows keys on the numeric keypad to be assigned
to certain 3270 functions including PA1, PA2, Tab, Backtab, and Newline.
Also allows the decimal point on the numeric keypad to be remapped to
comma for European countries.</p>
<p>Note: Remapping of the numeric keypad is only supported for Internet
Explorer, Chrome, and Safari. Keypad settings are ignored for Firefox
and Opera.</p>
<p><strong>Double click</strong> Specifies the action taken for a mouse double-click.
Possible settings are:</p>
<blockquote>
<div><p><strong>Word</strong> draws a box around the word that the mouse is pointing in
preparation for a copy or cut operation.</p>
<p><strong>ENTER</strong> Activates the “point-and-shoot” function. When set to
ENTER, double clicking the mouse moves the cursor to the mouse
position and sends a 3270 ENTER to the host application.</p>
<p><strong>no</strong> indicates that the double-click function is deactivated.</p>
</div></blockquote>
<p><strong>URL hotspots</strong> When activated, any text starting with http, https,
mailto, file, or ftp (except in 3270 input fields) is transformed into a
hyperlink.</p>
<p><a href="#id43"><span class="problematic" id="id44">**</span></a>PF key hotspots
<a href="#id45"><span class="problematic" id="id46">**</span></a>When activated, any text starting with Fnn= or PFnn= (except in 3270
input fields) is transformed into a clickable area. Clicking on the area
is equivalent to pressing PF nn.</p>
<p><a href="#id47"><span class="problematic" id="id48">**</span></a>Paste erase EOF
<a href="#id49"><span class="problematic" id="id50">**</span></a>When activated, a paste operation will erase the rest of an input
field to the right of the pasted text</p>
<p><a href="#id51"><span class="problematic" id="id52">**</span></a>Move cursor on activate
<a href="#id53"><span class="problematic" id="id54">**</span></a>This setting takes effect only when the user clicks on a background
3270 window in order to bring the window to the foreground. When the
option is activated, the window is brought to the foreground and the
3270 cursor moves to the location in the window where the user clicked;
the copy/paste box and context menu are removed if present. When the
option is not activated, the window is brought to the foreground and the
cursor remains in its previous position; the copy/paste box and context
menu remain displayed if present.</p>
<p><strong>Style</strong> Allows a choice of color schemes by selection of CSS style
sheet. Possible values are:</p>
<blockquote>
<div><p><strong>3270</strong> extended colors on black background</p>
<p><strong>Gray</strong> extended colors on gray background</p>
<p><strong>White</strong> gray characters on white background</p>
</div></blockquote>
<p><strong>Print style</strong> Allows a choice of color schemes for the screen capture
window. Possible values are:</p>
<blockquote>
<div><p><strong>3270</strong> extended colors on black background</p>
<p><strong>Color</strong> extended colors on white background</p>
<p><strong>White</strong> black characters on white background</p>
</div></blockquote>
<p><strong>Response time monitor
**When activated, two counters are displayed on the status line below
the 3270 screen, for example: **H:110ms J:31ms</strong>. The first number
(H=Host) represents the response time of the VIRTEL server, from the
last Enter or PF key until the receipt of the most recent message from
the server. The second number (J=JavaScript) is the time taken by the
browser scripts to prepare the screen for display. The sum of the two
numbers is the response time perceived by the user.</p>
<p><strong>Note: The response time monitor is active in Ajax mode only</strong></p>
<p><a href="#id55"><span class="problematic" id="id56">**</span></a>Omit nulls from input
<a href="#id57"><span class="problematic" id="id58">**</span></a>When activated, VIRTEL Web Access will remove all nulls from
modified input fields before sending to the server, in strict
conformance with 3270 protocol. When not activated, leading and embedded
nulls are converted to blanks, and only trailing nulls are suppressed,
which many users find more convenient.</p>
<p><a href="#id59"><span class="problematic" id="id60">**</span></a>Keep macro pad open
<a href="#id61"><span class="problematic" id="id62">**</span></a>If checked, the macro window remains open all the time. If not, it
disappears as soon as you have clicked a macro.</p>
<p><a href="#id63"><span class="problematic" id="id64">**</span></a>Keep keypad open
<a href="#id65"><span class="problematic" id="id66">**</span></a>If checked, the keypad window remains open all the time. If not, it
disappears as soon as you have clicked a function key in it.</p>
<p><a href="#id67"><span class="problematic" id="id68">**</span></a>Highlight input fields
<a href="#id69"><span class="problematic" id="id70">**</span></a>Permits the user to display a different background color for 3270
input fields. When this option is selected, all input fields will have a
class designator HIGHLIGHTED_INPUTFIELD in addition to their regular
class. The style definition may be overridden by the administrator in
the custom.css file.</p>
<p><a href="#id71"><span class="problematic" id="id72">**</span></a>Remap caret to logical not
<a href="#id73"><span class="problematic" id="id74">**</span></a>If checked, translates the “caret” sign (Shift+6 on a US keyboard)
to EBCDIC X&#8216;5F&#8217;, which is the “logical not” sign (¬) in codepage
037/1140.</p>
<p><a href="#id75"><span class="problematic" id="id76">**</span></a>Adapt font size ratio
<a href="#id77"><span class="problematic" id="id78">**</span></a>If checked, characters will be stretched to fill the window. This
option functions in Internet Explorer versions 9 and later, in Firefox,
and Chrome. For Internet Explorer versions 6, 7, and 8 this option has
no effect.</p>
<p><a href="#id79"><span class="problematic" id="id80">**</span></a>Character spacing
<a href="#id81"><span class="problematic" id="id82">**</span></a>If checked, blank space will be added between characters if
necessary to make the 3270 screen fill the browser window horizontally.</p>
<p><a href="#id83"><span class="problematic" id="id84">**</span></a>Line spacing
<a href="#id85"><span class="problematic" id="id86">**</span></a>If checked, blank space will be added between lines if necessary to
make the 3270 screen fill the browser window vertically. This option is
incompatible with IE6 and will be ignored if used with IE6.
Additionally, if “Adapt font size ratio” is specified and the browser
supports it, then the “Line spacing” option is ignored.</p>
</div>
<div class="section" id="id87">
<h5>Associated functions<a class="headerlink" href="#id87" title="Permalink to this headline">¶</a></h5>
<p>After modifying the Settings menu, the user presses one of the buttons:</p>
<p><em>Save</em> save the options in browser local storage.</p>
<p><em>Cancel</em> exit without saving the modifications made to this menu.</p>
<p><em>Defaults</em> returns all of the settings to their default values. The
default values are specified by the installation in w2hparm.js.</p>
<p>Deletion of browser cookies may delete the values saved in local
storage. For Internet Explorer, ensure that the option “Delete browsing
history on exit” in Tools – Internet Options” is not checked.</p>
</div>
<div class="section" id="where-user-settings-are-stored">
<h5>Where user settings are stored<a class="headerlink" href="#where-user-settings-are-stored" title="Permalink to this headline">¶</a></h5>
<p>The user’s Web Access settings and macros are stored in browser local
storage.</p>
<p>For Internet Explorer 6, local storage is stored in the folder:</p>
<p>%userprofile%/UserData</p>
<p>For Internet Explorer 8 and 9, local storage is stored in the folder:</p>
<p>%userprofile%/Local Settings/Application Data/Microsoft/Internet
Explorer/DOMStore</p>
<p>Note: to see DOMStore you must untick “hide protected operating system
files” in Windows folder options.</p>
<p>For other browsers, see</p>
<p><a class="reference external" href="http://www.sitepoint.com/building-web-pages-with-local-storage/">http://www.sitepoint.com/building-web-pages-with-local-storage/</a></p>
</div>
<div class="section" id="global-modification-of-web-access-settings">
<h5>Global modification of Web Access settings<a class="headerlink" href="#global-modification-of-web-access-settings" title="Permalink to this headline">¶</a></h5>
<p>Those installations who wish to modify the default Web Access settings
for all users can do so by uploading the <em>w2hparm.js</em> file. This file is
included in the <em>sources.zip</em> file which can be obtained from the VIRTEL
Web Access menu accessible by URL <em>http://n.n.n.n:41001</em></p>
<p>The <em>w2hparm.js</em> file as delivered contains the following source code:</p>
<p>// w2hparm default values</p>
<p>// see w2hparmdefns in js01.js for parameters and allowable values</p>
<p>var w2hparm = {</p>
<p>&#8220;fontsize&#8221;:&#8221;window&#8221;,</p>
<p>&#8220;ctrl&#8221;:&#8221;ENTER&#8221;,</p>
<p>&#8220;enter&#8221;:&#8221;Newline&#8221;,</p>
<p>&#8220;home&#8221;:&#8221;Home&#8221;,</p>
<p>&#8220;end&#8221;:&#8221;ErEof&#8221;,</p>
<p>&#8220;pgup&#8221;:&#8221;PF7&#8221;,</p>
<p>&#8220;pgdn&#8221;:&#8221;PF8&#8221;,</p>
<p>&#8220;pause&#8221;:&#8221;CLEAR&#8221;,</p>
<p>&#8220;style&#8221;:&#8221;3270&#8221;};</p>
<p>Figure 1‑42 w2hparm.js: Default settings for VIRTEL Web Access</p>
<p>Default values may be changed or added.</p>
<p>For example, installations who wish to map the 3270 ATTN key to the Esc
(Escape) key for use with Multisession applications such as NVAS (IBM®
NetView™ Access Services) can add the following instruction to the
<em>w2hparm.js</em> file:</p>
<p>&#8220;escape&#8221;:&#8221;ATTN&#8221;,</p>
<p>Modifications to the global settings are only effective after the expiry
of the w2hparm.js file in the browser’s cache which occurs at midnight
each day. A user can force the use of the updated global settings file
by clearing the browser cache, deleting any cookies associated with the
VIRTEL server, and refreshing the 3270 page using the Ctrl-R key.</p>
<p>After modifying the <em>w2hparm.js</em> file, it must be uploaded to VIRTEL’s
CLI-DIR directory by means of the “Upload” link on the VIRTEL Web Access
menu (URL <a class="reference external" href="http://n.n.n.n:41001">*http://n.n.n.n:41001*</a>). Then you
must check the Entry Point (usually CLIWHOST) and check that the
transaction whose “External name” is w2h and whose “Check URL Prefix”
field is set to <em>/w2h/w2hparm-js</em> specifies CLI-DIR in the “Application”
field. For the CLIWHOST entry point this is transaction CLI-03P.</p>
<p>The list of keywords and possible values which can be coded in the
<em>w2hparm.js</em> file is shown below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="30%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Keyword</strong></td>
<td><strong>Caption</strong></td>
<td><strong>Possible values</strong></td>
</tr>
<tr class="row-even"><td>&#8220;fontsize&#8221;</td>
<td>Font size</td>
<td>&#8220;window&#8221;, &#8220;screen&#8221;, &#8220;8&#8221;, &#8220;10&#8221;, &#8220;12&#8221;, &#8220;14&#8221;, &#8220;16&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;font&#8221;</td>
<td>Font family</td>
<td>&#8220;<em>font name</em>&#8220;</td>
</tr>
<tr class="row-even"><td>&#8220;autocapture&#8221;</td>
<td>Auto-capture</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>&#8220;autoprint&#8221;</td>
<td>Auto-print</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>&#8220;cursor&#8221;</td>
<td>Cursor</td>
<td>&#8220;Bar&#8221;, &#8220;Blink&#8221;, &#8220;Block&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;vline&#8221;</td>
<td>Vertical line</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>&#8220;hline&#8221;</td>
<td>Horiz line</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>&#8220;esc&#8221;</td>
<td>Esc key</td>
<td>&#8220;no&#8221;, &#8220;ATTN&#8221;, &#8220;CLEAR&#8221;, &#8220;Reset&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;ctrl&#8221;</td>
<td>Ctrl key</td>
<td>&#8220;no&#8221;, &#8220;ENTER&#8221;, &#8220;Newline&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;cmdleft&#8221;</td>
<td>Left Cmd key</td>
<td>&#8220;no&#8221;, &#8220;Reset&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;cmdright&#8221;</td>
<td>Right Cmd key</td>
<td>&#8220;no&#8221;, “ENTER&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;enter&#8221;</td>
<td>Enter key</td>
<td>&#8220;ENTER&#8221;, &#8220;Newline&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;home&#8221;</td>
<td>Home key</td>
<td>&#8220;no&#8221;, &#8220;Home&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;end&#8221;</td>
<td>End key</td>
<td>&#8220;no&#8221;, &#8220;ErEof&#8221;, &#8220;End&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;pgup&#8221;</td>
<td>PageUp key</td>
<td>&#8220;PF7&#8221;, &#8220;PF19&#8221;, &#8220;PA1&#8221;, &#8220;no&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;pgdn&#8221;</td>
<td>PageDown key</td>
<td>&#8220;PF8&#8221;, &#8220;PF20&#8221;, &#8220;PA2&#8221;, &#8220;no&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;pause&#8221;</td>
<td>Pause key</td>
<td>&#8220;CLEAR&#8221;, &#8220;ATTN&#8221;, &#8220;PA3&#8221;, &#8220;no&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;kpenter&#8221;</td>
<td>Keypad Enter</td>
<td>&#8220;ENTER&#8221;, &#8220;Newline&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;shiftenter&#8221;</td>
<td>Shift+Enter</td>
<td>&#8220;no&#8221;,&#8221;ENTER&#8221;, &#8220;Newline&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;shiftesc&#8221;</td>
<td>Shift+Esc</td>
<td>&#8220;no&#8221;, &#8220;ATTN&#8221;, &#8220;CLEAR&#8221;, &#8220;Reset&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;shiftins&#8221;</td>
<td>Shift+Insert</td>
<td>&#8220;no&#8221;, &#8220;Dup&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;shiftdel&#8221;</td>
<td>Shift+Delete</td>
<td>&#8220;no&#8221;, &#8220;ErEof&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;shifthome&#8221;</td>
<td>Shift+Home</td>
<td>&#8220;no&#8221;, &#8220;FieldMark&#8221;, &#8220;Home&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;shiftend&#8221;</td>
<td>Shift+End</td>
<td>&#8220;no&#8221;, &#8220;ErEof&#8221;, &#8220;End&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;shiftpgdn&#8221;</td>
<td>Shift+PageDown</td>
<td>&#8220;no&#8221;, &#8220;PA3&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;ctrlenter&#8221;</td>
<td>Ctrl+Enter</td>
<td>&#8220;no&#8221;,&#8221;ENTER&#8221;, &#8220;Newline&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;ctrlins&#8221;</td>
<td>Ctrl+Insert</td>
<td>&#8220;no&#8221;, &#8220;PA1&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;ctrldel&#8221;</td>
<td>Ctrl+Delete</td>
<td>&#8220;no&#8221;, &#8220;PA2&#8221;, &#8220;ErEof&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;ctrlhome&#8221;</td>
<td>Ctrl+Home</td>
<td>&#8220;no&#8221;, &#8220;PA3&#8221;, &#8220;Home&#8221;, &#8220;ChgCur&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;ctrlend&#8221;</td>
<td>Ctrl+End</td>
<td>&#8220;no&#8221;, &#8220;ErEof&#8221;, &#8220;End&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;altins&#8221;</td>
<td>Alt+Ins</td>
<td>&#8220;no&#8221;, &#8220;PA1&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;althome&#8221;</td>
<td>Alt+Home</td>
<td>&#8220;no&#8221;, &#8220;PA2&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;altpgup&#8221;</td>
<td>Alt+PageUp</td>
<td>&#8220;no&#8221;, &#8220;PA1&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;altpgdn&#8221;</td>
<td>Alt+PageDown</td>
<td>&#8220;no&#8221;, &#8220;PA2&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;altpause&#8221;</td>
<td>Alt+Pause</td>
<td>&#8220;no&#8221;, &#8220;ATTN&#8221;, &#8220;CLEAR&#8221;, &#8220;PA3&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;altf1&#8221;</td>
<td>Alt+F1</td>
<td>&#8220;no&#8221;, &#8220;PA1&#8221;, &#8220;ENTER&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;altf2&#8221;</td>
<td>Alt+F2</td>
<td>&#8220;no&#8221;, &#8220;PA2&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;altf3&#8221;</td>
<td>Alt+F3</td>
<td>&#8220;no&#8221;, &#8220;PA3&#8221;, &#8220;ChgCur&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;kpslash&#8221;</td>
<td>Keypad /</td>
<td>&#8220;/&#8221;, &#8220;PA1&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;kpaster&#8221;</td>
<td>Keypad *</td>
<td>&#8220;*&#8221;, &#8220;PA2&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;kpminus&#8221;</td>
<td>Keypad -</td>
<td>&#8220;-&#8221;, &#8220;Backtab&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;kpplus&#8221;</td>
<td>Keypad +</td>
<td>&#8220;+&#8221;, &#8220;Tab&#8221;, &#8220;Newline&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;kpdot&#8221;</td>
<td>Keypad .</td>
<td>&#8221;.&#8221;, &#8221;,&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;dblclick&#8221;</td>
<td>Double Click</td>
<td>&#8220;Word&#8221;, &#8220;ENTER&#8221;, &#8220;no&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;urlhotspot&#8221;</td>
<td>URL hotspots</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>&#8220;pfkhotspot&#8221;</td>
<td>PF key hotspots</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>&#8220;pasteereof&#8221;</td>
<td>Paste erase EOF</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>&#8220;movecursor&#8221;</td>
<td>Move cursor on activate</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>&#8220;style&#8221;</td>
<td>Style</td>
<td>&#8220;3270&#8221;, &#8220;gray&#8221;, &#8220;white&#8221;</td>
</tr>
<tr class="row-odd"><td>&#8220;printstyle”</td>
<td>Print style</td>
<td>&#8220;3270&#8221;, &#8220;color&#8221;, &#8220;white&#8221;</td>
</tr>
<tr class="row-even"><td>&#8220;rtm&#8221;</td>
<td>Response time monitor</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>&#8220;omitnulls&#8221;</td>
<td>Omit nulls from input</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>&#8220;keepmacpad&#8221;</td>
<td>Keep macro pad open</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>&#8220;keepkeypad&#8221;</td>
<td>Keep keypad open</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>&#8220;hiliteinput&#8221;</td>
<td>Highlight input fields</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>&#8220;caretnot&#8221;</td>
<td>Remap caret to logical not</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>&#8220;adaptfontratio&#8221;</td>
<td>Adapt font size ratio</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>&#8220;charspace&#8221;</td>
<td>Character spacing</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>&#8220;linespace&#8221;</td>
<td>Line spacing</td>
<td>true, false</td>
</tr>
</tbody>
</table>
<p>Figure 1‑43 w2hparm.js: List of keywords and possible values</p>
</div>
<div class="section" id="hiding-web-access-settings">
<h5>Hiding Web Access settings<a class="headerlink" href="#hiding-web-access-settings" title="Permalink to this headline">¶</a></h5>
<p>To prevent the user from overriding the site defaults, the administrator
can remove individual settings from the user’s Web Access Settings menu.
The names of settings to be hidden are specified in the w2hparmHide
variable in the <em>w2hparm.js</em> file.</p>
<p>The example below shows how to hide the default font, font size, and
style settings from the menu:</p>
<p>// w2hparm default values</p>
<p>var w2hparm = {</p>
<p>&#8220;fontsize&#8221;:&#8221;window&#8221;,</p>
<p>&#8220;font&#8221;:&#8221;Lucida Console&#8221;,</p>
<p>&#8220;ctrl&#8221;:&#8221;ENTER&#8221;,</p>
<p>&#8220;enter&#8221;:&#8221;Newline&#8221;,</p>
<p>&#8220;home&#8221;:&#8221;Home&#8221;,</p>
<p>&#8220;style&#8221;:&#8221;3270&#8221;};</p>
<p>var w2hparmHide = [&#8220;font&#8221;, &#8220;fontsize&#8221;, &#8220;style&#8221;];</p>
<p>Figure 1‑44 w2hparm.js: Hiding VIRTEL Web Access settings</p>
</div>
</div>
<div class="section" id="application-selection-menu">
<h4>Application selection menu<a class="headerlink" href="#application-selection-menu" title="Permalink to this headline">¶</a></h4>
<p>The VIRTEL application selection menu is dynamically generated by the
<em>appmenu.htm</em> page in conjunction with the <em>applist</em> transaction. For
example, the following URL displays the application selection menu for
the CLIWHOST entry point (line C-HTTP port 41002):</p>
<p><em>http://n.n.n.n:41002/w2h/appmenu.htm+applist</em></p>
<p>The application selection menu for the WEB2HOST entry point (line W-HTTP
port 41001) is accessible from the “Other applications” link on the
VIRTEL Web Access main menu.</p>
<div class="section" id="contents-of-menu">
<h5>Contents of menu<a class="headerlink" href="#contents-of-menu" title="Permalink to this headline">¶</a></h5>
<p>An example of the application selection menu is shown in the figure
below:</p>
<p><a class="reference internal" href="../../../_images/image261.jpeg"><img alt="4297en" src="../../../_images/image261.jpeg" style="width: 5.51042in; height: 2.47917in;" /></a></p>
<p>Figure 1‑45 Application selection menu</p>
<p>The application selection menu contains clickable links to the
transactions defined under the entry point. A transaction will appear in
the menu if all of the following conditions are met:</p>
<ul class="simple">
<li>The “Application type” is 1 (VTAM) or 2 (VIRTEL)</li>
<li>The “How started” field is 1 (menu)</li>
<li>The user is logged on and authorized via the security subsystem to
the security resource whose name is the internal name of the
transaction (except when the transaction “Security” field is 0)</li>
</ul>
<p>If the user is not logged on, then only public transactions (security
type 0) are displayed.</p>
<p>If the APPSTAT=YES parameter is specified in the VIRTCT (see “Parameters
of the VIRTCT” in the <em>VIRTEL Installation Guide</em>) then the status of
VTAM applications is indicated by a green bar for active applications,
and by a red bar for inactive applications.</p>
<p>To add an application to the menu, use the VIRTEL administration panels
to define a transaction under the entry point, press F1 to update the
entry point, then refresh the appmenu.htm page in the browser.</p>
</div>
<div class="section" id="presentation-modes">
<h5>Presentation modes<a class="headerlink" href="#presentation-modes" title="Permalink to this headline">¶</a></h5>
<p>The application selection menu offers a choice of several different
presentation modes, selectable by clicking one of the buttons at the top
right of the screen. The selected presentation mode determines which
page template will be used to access the selected host applications.</p>
<div class="line-block">
<div class="line"><strong>3270 presentation</strong></div>
<div class="line">This presentation mode, which uses the WEB3270.htm page template, is
designed for experienced 3270 users who do not require the
presentation enhancements offered by VIRTEL Web Modernisation. It
offers a user interface which matches as closely as possible that of a
real 3270 screen.</div>
</div>
<div class="line-block">
<div class="line"><strong>Ajax 3270</strong></div>
<div class="line">This presentation mode is similar to the 3270 presentation mode, but
it uses a static main page (WEB2AJAX.htm) together with an Ajax-loaded
sub-page (WEB2SUB.html). This can reduce network load and provide
faster response time with a better 3270 user experience. Ajax mode
also offers password encryption as an option (see “Password
encryption” sur la page 300).</div>
</div>
<div class="line-block">
<div class="line"><strong>HTML presentation</strong></div>
<div class="line">This presentation mode, which uses the WEB2VIRT.htm page template, is
intended as a first step towards VIRTEL Web Modernisation. In this
mode the 3270 screen image is displayed as an HTML form, to which
presentation enhancements such as drop-down lists, checkboxes, and
calendars can be added by means of VIRTEL Web Modernisation scenarios
(see “VIRTEL Scenarios” sur la page 150).</div>
</div>
<div class="line-block">
<div class="line"><strong>Ajax HTML</strong></div>
<div class="line">This presentation mode is similar to the HTML presentation mode, but
it uses a static main page (WEB2VIRTAJAX.htm) together with an
Ajax-loaded sub-page (WEB2VIRTSUB.html).</div>
</div>
<div class="line-block">
<div class="line"><strong>Tablet</strong></div>
<div class="line">This presentation mode it uses the SMARTWEB2VIRT.htm page template for
an HTML presentation adapted for tablets and smartphones.</div>
</div>
</div>
<div class="section" id="the-appmenu-htm-page">
<h5>The appmenu.htm page<a class="headerlink" href="#the-appmenu-htm-page" title="Permalink to this headline">¶</a></h5>
<p>The <em>appmenu.htm</em> page for the VIRTEL application selection menu is
delivered in the W2H-DIR directory. The page may be customized if
required to meet installation standards. The <em>appmenutable</em> and
<em>appmenuitem</em> styles in the <em>STYLBLUE.css</em> stylesheet allow the
appearance of the menu to be customized. The source code for the page
and the stylesheet may be obtained from the <em>sources.zip</em> file
accessible from the VIRTEL Web Access menu. After modifying the page or
the stylesheet, follow the “Upload” link on the VIRTEL Web Access menu
to upload the updated files to the W2H-DIR directory.</p>
</div>
<div class="section" id="definition-of-the-applist-transaction">
<h5>Definition of the applist transaction<a class="headerlink" href="#definition-of-the-applist-transaction" title="Permalink to this headline">¶</a></h5>
<p>A transaction with external name <em>applist</em> must be present in the list
of transactions at the entry point associated with the line. VIRTEL
supplies as standard transactions W2H-90 (for entry point WEB2HOST, line
W-HTTP port 41001) and CLI-90 (for entry point CLIWHOST, line C-HTTP
port 41002). The <em>applist</em> transaction must specify application name
VIR0021S and application type 2. Security type 1 requires the user to
sign on so that the transaction can determine which applications the
user is authorized to. The user must also be authorized to the <em>applist</em>
transaction itself by its internal name (W2H-90 or CLI-90).</p>
<p>The figure below shows the definition of the <em>applist</em> transaction
CLI-90:</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTEL
10:28:44</p>
<p>Internal name ===&gt; CLI-90 To associate with an entry point name</p>
<p>External name ===&gt; applist Name displayed on user menu</p>
<p>Description ===&gt; List of applications for appmenu.htm</p>
<p>Application ===&gt; VIR0021S Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 2 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; CLLOC Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 2 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 1 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt;</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑46 Definition of applist transaction</p>
</div>
<div class="section" id="application-menu-as-the-default-transaction-for-the-entry-point">
<h5>Application menu as the default transaction for the entry point<a class="headerlink" href="#application-menu-as-the-default-transaction-for-the-entry-point" title="Permalink to this headline">¶</a></h5>
<p>When the <em>appmenu.htm+applist</em> URL is coded in the “TIOA at logon” field
of the default transaction for the entry point, the application
selection menu will be displayed whenever the user accesses the HTTP
line using its root URL (for example, <em>http://n.n.n.n:41002</em> for line
C-HTTP)<em>.</em></p>
<p>The default transaction is the transaction whose external name is the
same as the entry point name, and the example below shows the default
transaction for the CLIWHOST entry point:</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTEL
10:57:59</p>
<p>Internal name ===&gt; CLI-00 To associate with an entry point name</p>
<p>External name ===&gt; CLIWHOST Name displayed on user menu</p>
<p>Description ===&gt; Default directory = entry point name</p>
<p>Application ===&gt; CLI-DIR Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 4 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; CLLOC Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 2 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 0 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Check URL Prefix ===&gt;</p>
<p>TIOA at logon ===&gt; /w2h/appmenu.htm+applist</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑47 Specifying the application selection menu in the default
transaction</p>
</div>
</div>
<div class="section" id="printing-with-web-access">
<h4>Printing with Web Access<a class="headerlink" href="#printing-with-web-access" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL provides printing support by means of virtual 3287 type printers.
Each user connected to VIRTEL Web Access has a virtual 3287 printer
associated with the user’s 3270 display terminal. The name of the
virtual printer is displayed in the status bar at the bottom of the Web
Access window. Data sent to the virtual printer from a host application
(for example, CICS, QMF, or VPS) is captured by VIRTEL and is saved in
virtual storage.</p>
<p>A printer icon <a class="reference internal" href="../../../_images/image271.png"><img alt="http://192.168.170.14:41001/w2h/printer.png" src="../../../_images/image271.png" style="width: 0.22917in; height: 0.22917in;" /></a> appears in
the Web Access toolbar to notify the user that print data is available.
When the user clicks on this icon, VIRTEL sends the print data to the
user’s browser, either as an attached file or in a pop-up window.</p>
<p>Two types of virtual printer are supported: LUTYPE1 (SCS) and LUTYPE3
(3270 data stream). For LUTYPE1 printers VIRTEL sends the print data to
the browser as an attached file. For LUTYPE3 printers VIRTEL converts
the print data to HTML and the browser displays it in a pop-up window.</p>
<div class="section" id="virtel-definitions-for-virtual-printers">
<h5>VIRTEL definitions for virtual printers<a class="headerlink" href="#virtel-definitions-for-virtual-printers" title="Permalink to this headline">¶</a></h5>
<p>In the VIRTEL configuration file, LUTYPE1 virtual printers are defined
with the “Terminal type” field set to <strong>1</strong> or <strong>S</strong>. The “Relay” field
contains the VTAM LU name known to the host application. The figure
below shows an example definition of 80 LUTYPE1 virtual printers with LU
names RHTIM000 to RHTIM079:</p>
<p>TERMINAL DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTEL
16:37:16</p>
<p>Terminal ===&gt; W2HIM000 ?wxyZZZZ for dynamic allocation</p>
<p>w : Sna or Non-sna or * (category)</p>
<p>x : 1, 2, 3, 4, 5 or * (model)</p>
<p>y : Colour, Monochrome or *</p>
<p>Z : any characters</p>
<p>Relay ===&gt; RHTIM000 Name seen by VTAM applications</p>
<p>= : copied from the terminal name</p>
<p>*Pool name ===&gt; Pool where to put this terminal</p>
<p>Description ===&gt; SCS printers (LUTYPE1) for HTTP</p>
<p>Entry Point ===&gt; Enforced Entry Point</p>
<p>2nd relay ===&gt; Possible 2nd relay (Printer)</p>
<p>Terminal type ===&gt; S 1=LU1 2=3270 3=FC P=Printer S=Scs</p>
<p>Compression ===&gt; 2 0, 1, 2 or 3 : compression type</p>
<p>Possible Calls ===&gt; 1 0=None 1=Inbound 2=Outbound 3=Both</p>
<p>Write Stats to ===&gt; 12 1,4=VIRSTAT 2=VIRLOG</p>
<p>Repeat ===&gt; 0080 Number of generated terminals</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P12=Server</p>
<p>Figure 1‑48 VIRTEL definition of LUTYPE1 virtual printers</p>
<p>Similarly, LUTYPE3 virtual printers are defined with the “Terminal type”
field set to <strong>2</strong> or <strong>P</strong>. The figure below shows an example
definition of 80 LUTYPE3 virtual printers with LU names RHTIP000 to
RHTIP079:</p>
<p>TERMINAL DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTEL
10:26:51</p>
<p>Terminal ===&gt; W2HIP000 ?wxyZZZZ for dynamic allocation</p>
<p>w : Sna or Non-sna or * (category)</p>
<p>x : 1, 2, 3, 4, 5 or * (model)</p>
<p>y : Colour, Monochrome or *</p>
<p>Z : any characters</p>
<p>Relay ===&gt; RHTIP000 Name seen by VTAM applications</p>
<p>= : copied from the terminal name</p>
<p>*Pool name ===&gt; Pool where to put this terminal</p>
<p>Description ===&gt; 3270 printers (LUTYPE3) for HTTP</p>
<p>Entry Point ===&gt; Enforced Entry Point</p>
<p>2nd relay ===&gt; Possible 2nd relay (Printer)</p>
<p>Terminal type ===&gt; P 1=LU1 2=3270 3=FC P=Printer S=Scs</p>
<p>Compression ===&gt; 2 0, 1, 2 or 3 : compression type</p>
<p>Possible Calls ===&gt; 1 0=None 1=Inbound 2=Outbound 3=Both</p>
<p>Write Stats to ===&gt; 26 1,4,5,6=VIRSTAT 2=VIRLOG</p>
<p>Repeat ===&gt; 0080 Number of generated terminals</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P12=Server</p>
<p>Figure 1‑49 VIRTEL definition of LUTYPE1 virtual printers</p>
</div>
<div class="section" id="associating-virtual-printers-with-terminals">
<h5>Associating virtual printers with terminals<a class="headerlink" href="#associating-virtual-printers-with-terminals" title="Permalink to this headline">¶</a></h5>
<p>To associate virtual printers with the corresponding terminal LU names,
define the printer LU name in the “2nd relay” field of the terminal pool
definition. In the example below, Web Access terminals with LU names
RHTVT000-079 are associated with virtual printer LU names RHTIP000-079
(LUTYPE3). Similarly, terminal LU names RHTVT100-179 are associated with
virtual printer LU names RHTIM000-079 (LUTYPE1). There is a one-for-one
correspondence between the display terminal’s LU name and the printer LU
name.</p>
<p>LIST of TERMINALS &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTEL
10:07:08</p>
<p>Terminal Repeated Relay Entry Type I/O Pool 2nd Relay</p>
<p>CLLOC000 0050 3 3</p>
<p>CLVTA000 0080 *W2HPOOL 3 3</p>
<p>DELOC000 0010 3 3</p>
<p>DEVTA000 0016 *W2HPOOL 3 3</p>
<p>W2HIM000 0080 RHTIM000 S 1</p>
<p>W2HIP000 0080 RHTIP000 P 1</p>
<p>W2HTP000 0080 RHTVT000 3 3 *W2HPOOL RHTIP000</p>
<p>W2HTP100 0080 RHTVT100 3 3 *W2HPOOL RHTIM000</p>
<p>P1=Update P2=Delete P3=Return P6=1st Page</p>
<p>P7=Page-1 P8=Page+1 P12=Details</p>
<p>Figure 1‑50 VIRTEL terminal definitions for virtual printers</p>
</div>
<div class="section" id="autoconnect-for-virtual-printers">
<h5>Autoconnect for virtual printers<a class="headerlink" href="#autoconnect-for-virtual-printers" title="Permalink to this headline">¶</a></h5>
<p>When a virtual printer is defined with terminal type <strong>1</strong> or <strong>2</strong>, the
associated LU is activated by VIRTEL at startup time, and will remain in
ACTIV state until acquired by the application. The application must
initiate the acquire (for example, by CEMT SET TERM(xxxx) ACQ in CICS).</p>
<p>By contrast, the LU associated with a virtual printer of type <strong>P</strong> or
<strong>S</strong> is opened when the user starts a Web Access session and closed
when the Web Access session is terminated. This type of virtual printer
may be automatically connected to a controlling host application when a
user starts a Web Access session. The “Entry Point” field of the virtual
printer definition should contain the name of an entry point which
specifies VIR0021B as its menu program. The entry point must have one
transaction whose “Application” field contains the name of the host
application to which the printer is to be connected.</p>
<p>The example below shows an entry point definition for connecting
printers to CICS:</p>
<p>ENTRY POINT DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTEL
14:58:34</p>
<p>Name ===&gt; PRTAPPL Name this ENTRY POINT (LOGON DATA)</p>
<p>Description ===&gt; Connect printers to host application</p>
<p>Transactions ===&gt; PRTA Prefix for associated transactions</p>
<p>Last page ===&gt; Displayed at end of session</p>
<p>Transparency ===&gt; Server types NOT to emulate</p>
<p>Time out ===&gt; 0000 minutes Maximum inactive time</p>
<p>Do if timeout ===&gt; 0=logoff 1=bip+logoff 2=anti pad</p>
<p>Emulation ===&gt; HTML Type of terminal:</p>
<p>HOST4WEB : program driven HTML : Web Browser</p>
<p>SCENARIO : script driven EMAIL : SMTP client</p>
<p>Directory for scenarios ===&gt; If scenarios in VSAM, not LOADLIB</p>
<p>Signon program ===&gt; Controls user name and password</p>
<p>Menu program ===&gt; VIR0021B List of transactions</p>
<p>Identification scenario ===&gt; eg XML identification</p>
<p>Type 3 compression ===&gt; Discover typical screens (Virtel/PC)</p>
<p>Mandatory identification ===&gt; (PC or minitel)</p>
<p>3270 swap key ===&gt; eg P24</p>
<p>Extended colors ===&gt; E: extended X: extended + DBCS</p>
<p>P1=Update P3=Return P4=Transactions</p>
<p>Enter=Add</p>
<p>Figure 1‑51 Entry point definition for virtual printer autoconnect</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTEL
14:59:52</p>
<p>Internal name ===&gt; PRTA-01 To associate with an entry point name</p>
<p>External name ===&gt; PRTAPPL Name displayed on user menu</p>
<p>Description ===&gt; Connect printers to host application</p>
<p>Application ===&gt; DBDCCICS Application to be called</p>
<p>PassTicket ===&gt; Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 1 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 1 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 0 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt;</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑52 Transaction definition for virtual printer autoconnect</p>
</div>
<div class="section" id="vtam-definitions-for-virtual-printers">
<h5>VTAM definitions for virtual printers<a class="headerlink" href="#vtam-definitions-for-virtual-printers" title="Permalink to this headline">¶</a></h5>
<p>Virtual printer LUs must be defined to VTAM with an appropriate LOGMODE
(normally SCS for LUTYPE1, or DSILGMOD for LUTYPE3). The necessary APPL
statements may be coded in the VIRTAPPL member of the VTAMLST library,
as shown in the example below:</p>
<p>RHTIM??? APPL AUTH=(ACQ,PASS),MODETAB=ISTINCLM,DLOGMOD=SCS,EAS=1</p>
<p>RHTIP??? APPL AUTH=(ACQ,PASS),MODETAB=ISTINCLM,DLOGMOD=DSILGMOD,EAS=1</p>
<p>Figure 1‑53 VTAM definitions for virtual printers</p>
</div>
<div class="section" id="cics-definitions-for-virtual-printers">
<h5>CICS definitions for virtual printers<a class="headerlink" href="#cics-definitions-for-virtual-printers" title="Permalink to this headline">¶</a></h5>
<p>If the virtual printer is defined to CICS via RDO, use an appropriate
TYPETERM as shown in the table below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="30%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>VIRTEL Terminal Type</strong></th>
<th class="head"><strong>CICS TYPETERM</strong></th>
<th class="head"><strong>CICS DEVICE type</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>1</strong> or <strong>S</strong></td>
<td>DFHSCSP</td>
<td>SCSPRINT</td>
</tr>
<tr class="row-odd"><td><strong>2</strong> or <strong>P</strong></td>
<td>DFHLU3 or DFH3270P</td>
<td>LUTYPE3 or 3270P</td>
</tr>
</tbody>
</table>
<p>Figure 1‑54 CICS TYPETERM definitions for virtual printers</p>
<p>Note: from version 4.50 onwards, VIRTEL supports the QUERY parameter for
SCS printers as well as for LUTYPE3 printers.</p>
</div>
<div class="section" id="scenarios-for-scs-printing">
<h5>Scenarios for SCS printing<a class="headerlink" href="#scenarios-for-scs-printing" title="Permalink to this headline">¶</a></h5>
<p>When virtual printers are defined with terminal type <strong>1</strong> or <strong>S</strong>, all
VIRTEL transactions defined under an entry point which offers printing
must indicate the name of an “Input Scenario”. The scenario processes
the HTTP request containing a PF=SCENARIO-PRINT parameter which is
issued when the user presses the “Get print data” icon <a class="reference internal" href="../../../_images/image271.png"><img alt="Get print data" src="../../../_images/image271.png" style="width: 0.22917in; height: 0.22917in;" /></a>
on the VIRTEL Web Access toolbar. The scenario accesses the SCS print
data which is accumulated in a VIRTEL variable called $PRINT$, and
instructs VIRTEL to send the print data to the browser as an attached
file.</p>
<p>Several suitable scenarios are delivered as standard in the VIRTEL
SAMPLIB and LOADLIB:</p>
<p><strong>SCENFPDF</strong> converts an SCS datastream into a PDF document</p>
<p><strong>SCENFPCL</strong> downloads PCL data into a raw printer file</p>
<p><strong>SCENPPDF</strong> converts PCL data into a PDF document (requires additional
VIRTEL PCL2PDF feature running on a Windows server)</p>
</div>
<div class="section" id="scs-to-pdf-conversion">
<h5>SCS to PDF conversion<a class="headerlink" href="#scs-to-pdf-conversion" title="Permalink to this headline">¶</a></h5>
<p>When the SCENFPDF input scenario is specified in the VIRTEL transaction
definition, the SCS data produced by the application is passed to
VIRTEL’s MAKEPDF component, and the resulting PDF file is sent to the
browser. The browser normally displays a dialog giving the user the
choice of opening or saving the PDF file.</p>
</div>
<div class="section" id="pcl-printing">
<h5>PCL printing<a class="headerlink" href="#pcl-printing" title="Permalink to this headline">¶</a></h5>
<p>Certain applications such as VPS are capable of sending print data in
PCL (HP Printer Command Language) format to SNA printers. The PCL
commands and data are sent as SCS transparent data on sessions with
LUTYPE1 logical units.</p>
<p>The transparent data (contained in blocks of up to 253 ASCII characters
preceded by a X’35’ SCS command) is extracted from the SCS datastream
and is copied into the VIRTEL variable $PRINT$.</p>
<p>PCL data may also be delivered in EBCDIC as part of the normal SCS
datastream, and this data will be converted to ASCII using the codepage
defined by the COUNTRY parameter in the VIRTCT (see “Parameters of the
VIRTCT” in the <em>VIRTEL Installation Guide</em>).</p>
<p>The SCENFPCL scenario delivered as standard in the VIRTEL SAMPLIB and
LOADLIB allows PCL data to be downloaded to the user’s workstation as an
attached file. The user may either save the file, or open it using an
appropriate program (such as PCL Reader from Page Technology Marketing,
Inc.) to display and optionally print the PCL data.</p>
</div>
<div class="section" id="pcl-to-pdf-conversion">
<h5>PCL-to-PDF conversion<a class="headerlink" href="#pcl-to-pdf-conversion" title="Permalink to this headline">¶</a></h5>
<p>For customers who have licensed the optional PCL2PDF feature of VIRTEL,
PCL output from host applications can be delivered to the workstation as
PDF documents.</p>
<p>The SCENPPDF scenario captures PCL data and sends it to an external
server for conversion. The external server is a Windows Server 2008R2
platform running the Syspertec PCL2PDF application. The VIRTEL
configuration must include a line with external name PCL2PDF which
defines the IP address of the Windows server, as shown in the example
below:</p>
<p>LINE DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211; Applid: VIRTEL
15:49:23</p>
<p>Internal name ===&gt; P-PCLPDF 1st character is line code</p>
<p>External name ===&gt; PCL2PDF External entity name</p>
<p>Remote ident ===&gt; 192.168.92.29:80 Remote VTAM LU or TCP/IP address</p>
<p>Local ident ===&gt; $NONE$ Local VTAM LU or TCP/IP address</p>
<p>Description ===&gt; HTTP connexions to PCL2PDF server</p>
<p>Prefix ===&gt; Prefix for terminals</p>
<p>Pool ===&gt; Pool for terminals</p>
<p>Entry Point ===&gt; Default Entry Point on this line</p>
<p>Rule Set ===&gt; P-PCLPDF Rules to choose an entry point</p>
<p>Line type ===&gt; TCP1 eg: TCP1 MQ1 XM1 BATCH1 APPC2 ...</p>
<p>Possible calls ===&gt; 2 0=None 1=Inbound 2=Outbound 3=I &amp; O</p>
<p>Startup prerequisite ===&gt;</p>
<p>Protocol program ===&gt; VIRHTTP Dialog manager</p>
<p>Security program ===&gt; Non standard security</p>
<p>Time out ===&gt; 0000 Action ===&gt; 0 Action if t/o: 0=none 1=keepalive</p>
<p>Window ===&gt; 0000 Packet ===&gt; 0000 eventual protocol parameters</p>
<p>Pad ===&gt; Tran ===&gt; PAD=INTEG/TRANSP/NO, TRAN=EVEN/ODD/NO</p>
<p>Retries ===&gt; 0010 Delay ===&gt; Retries for linked to terminals</p>
<p>P1=Update P3=Return P4=Terminals</p>
<p>Enter=Add P5=Rules</p>
<p>Figure 1‑55 VIRTEL line definition for PCL2PDF server</p>
<p>A batch job, supplied as member PCL2PDF of the VIRTEL SAMPLIB, allows
the definition of the PCL2PDF line to be added to the VIRTEL
configuration.</p>
</div>
</div>
<div class="section" id="tso-file-transfer">
<h4>TSO file transfer<a class="headerlink" href="#tso-file-transfer" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL Web Access supports transfer of files between the browser and a
TSO session using the IND$FILE protocol.</p>
<div class="section" id="definitions-required-for-file-transfer">
<h5>Definitions required for file transfer<a class="headerlink" href="#definitions-required-for-file-transfer" title="Permalink to this headline">¶</a></h5>
<p>To activate the file transfer function you must access TSO via a VIRTEL
transaction which specifies SCENINDT in both the “Input scenario” and
the “Output scenario” fields of the transaction definition. The figure
below shows the sample TSO transaction W2H-13 supplied with VIRTEL:</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTEL
13:49:35</p>
<p>Internal name ===&gt; W2H-13 To associate with an entry point name</p>
<p>External name ===&gt; Tso Name displayed on user menu</p>
<p>Description ===&gt; Logon to Tso</p>
<p>Application ===&gt; TSO Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 1 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; DEVT Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 1 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 0 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt;</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; SCENINDT Output Scenario ===&gt; SCENINDT</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑56 TSO transaction definition for file transfer</p>
<p>The source code of the SCENINDT scenario is supplied in the VIRTEL
SAMPLIB.</p>
<p>To activate the file transfer function when a user-written scenario is
specified in the transaction definition, the INDSCEN$ macro instruction
must be added to both the input and output sections of the scenario.</p>
</div>
<div class="section" id="toolbar-icons-for-file-transfer">
<h5>Toolbar icons for file transfer<a class="headerlink" href="#toolbar-icons-for-file-transfer" title="Permalink to this headline">¶</a></h5>
<p>When file transfer is activated, two new icons <a class="reference internal" href="../../../_images/image281.png"><img alt="file-recv" src="../../../_images/image281.png" style="width: 0.22917in; height: 0.22917in;" /></a> (receive
file) and <a class="reference internal" href="../../../_images/image291.png"><img alt="file-send" src="../../../_images/image291.png" style="width: 0.22917in; height: 0.22917in;" /></a>(send file) appear on the VIRTEL Web Access
toolbar:</p>
<p><a class="reference internal" href="../../../_images/image301.jpeg"><img alt="4202t" src="../../../_images/image301.jpeg" style="width: 5.45833in; height: 1.69792in;" /></a></p>
<p>Figure 1‑57 VIRTEL Web Access toolbar for TSO file transfer</p>
</div>
<div class="section" id="receiving-a-file">
<h5>Receiving a file<a class="headerlink" href="#receiving-a-file" title="Permalink to this headline">¶</a></h5>
<p>To transfer a file from TSO to your workstation, go to ISPF option 6 (or
TSO READY) and click the “Receive” icon on the toolbar. The “Receive
File” dialog will open:</p>
<p><a class="reference internal" href="../../../_images/image311.jpeg"><img alt="4202r1en" src="../../../_images/image311.jpeg" style="width: 5.32292in; height: 3.72917in;" /></a></p>
<p>Figure 1‑58 VIRTEL IND$FILE receive dialog (part 1)</p>
<p>Specify the TSO dataset name, surrounded by quotes if necessary. Dataset
names without quotes will be prefixed by your TSO prefix (usually your
userid). Click either “Text” or “Binary”. “Text” translates the file
from EBCDIC to ASCII and inserts carriage return line feed sequences
(x’0D0A’) at the end of each record. “Binary” performs no translation.
Finally click “Receive” to start the transfer.</p>
<p>When the file transfer is complete, the browser’s “Download” dialog
appears:</p>
<p><a class="reference internal" href="../../../_images/image321.jpeg"><img alt="4202r2en" src="../../../_images/image321.jpeg" style="width: 5.27083in; height: 4.02083in;" /></a></p>
<p>Figure 1‑59 VIRTEL IND$FILE receive dialog (part 2)</p>
<p>Click “Save”. The “Save As” dialog will open to allow you to specify the
name and location of the destination file on your workstation:</p>
<p><a class="reference internal" href="../../../_images/image331.jpeg"><img alt="4202r3en" src="../../../_images/image331.jpeg" style="width: 6.09375in; height: 3.55208in;" /></a></p>
<p>Figure 1‑60 VIRTEL IND$FILE receive dialog (part 3)</p>
<p>Now select the destination file and click “Save”. If the file already
exists you will be prompted for permission to overwrite it. The
“Download Complete” dialog appears when the file has been saved:</p>
<p><a class="reference internal" href="../../../_images/image341.jpeg"><img alt="4202r4en" src="../../../_images/image341.jpeg" style="width: 5.48958in; height: 3.85417in;" /></a></p>
<p>Figure 1‑61 VIRTEL IND$FILE receive dialog (part 4)</p>
</div>
<div class="section" id="sending-a-file">
<h5>Sending a file<a class="headerlink" href="#sending-a-file" title="Permalink to this headline">¶</a></h5>
<p>To transfer a file from your workstation to TSO, go to ISPF option 6 (or
TSO READY) and click the “Send” icon on the toolbar. The “Send File”
dialog will open:</p>
<p><a class="reference internal" href="../../../_images/image351.jpeg"><img alt="4202s1en" src="../../../_images/image351.jpeg" style="width: 5.27083in; height: 3.71875in;" /></a></p>
<p>Figure 1‑62 VIRTEL IND$FILE send dialog (part 1)</p>
<p>Click the “Browse...” button and the “Choose File to Upload” dialog will
appear:</p>
<p><a class="reference internal" href="../../../_images/image361.jpeg"><img alt="4202s2en" src="../../../_images/image361.jpeg" style="width: 5.43750in; height: 4.15625in;" /></a></p>
<p>Figure 1‑63 VIRTEL IND$FILE send dialog (part 2)</p>
<p>Choose the file you want to upload, and click “Open” to return to the
“Send File” dialog:</p>
<p><a class="reference internal" href="../../../_images/image371.jpeg"><img alt="4202s3en" src="../../../_images/image371.jpeg" style="width: 5.39583in; height: 3.98958in;" /></a></p>
<p>Figure 1‑64 VIRTEL IND$FILE send dialog (part 3)</p>
<p>Specify the TSO dataset name, surrounded by quotes if necessary. Dataset
names without quotes will be prefixed by your TSO prefix (usually your
userid).</p>
<p>If the TSO dataset does not yet exist, you may optionally specify space
(units, primary quantity, and secondary quantity), and DCB attributes
(record format, logical record length, and block size). If you do not
specify these attributes, the TSO IND$FILE will use its default values.</p>
<p>Check the “Append” checkbox to append the file to the end of an existing
TSO file. The “New” checkbox indicates that the TSO file must not
already exist.</p>
<p>Click either “Text” or “Binary”. “Text” translates the file from ASCII
to EBCDIC and treats carriage return line feed sequences (x’0D0A’) as
end of each record markers. “Binary” performs no translation. Finally
click “Send” to start the transfer.</p>
<p><a class="reference internal" href="../../../_images/image381.jpeg"><img alt="4202s4en" src="../../../_images/image381.jpeg" style="width: 5.18750in; height: 3.75000in;" /></a></p>
<p>Figure 1‑65 VIRTEL IND$FILE send dialog (part 4)</p>
<p>The message “File transfer complete” is displayed upon successful
completion of the upload.</p>
</div>
<div class="section" id="saving-and-reusing-file-transfer-parameters">
<h5>Saving and reusing file transfer parameters<a class="headerlink" href="#saving-and-reusing-file-transfer-parameters" title="Permalink to this headline">¶</a></h5>
<p>Users who frequently carry out the same or similar file transfers can
save the file transfer parameters for later reuse. To save a file
transfer, enter the dataset name and the type of transfer, then click
the “Save” button:</p>
<p><a class="reference internal" href="../../../_images/image391.png"><img alt="image34" src="../../../_images/image391.png" style="width: 5.18750in; height: 4.20833in;" /></a></p>
<p><em>Figure 1‑66 VIRTEL IND$FILE receive dialog (saved transfers)</em></p>
<p>The user can then choose a name for the saved transfer, and click “OK”
to save the parameters. At the next transfer, the user clicks the name
of the saved transfer to retrieve the parameters, then clicks “Receive”
to start the transfer.</p>
<p><a class="reference internal" href="../../../_images/image401.png"><img alt="image35" src="../../../_images/image401.png" style="width: 5.18750in; height: 1.46875in;" /></a></p>
<p><em>Figure 1‑67 Saving the file transfer parameters</em></p>
<p>Users can save transfer parameters for both “Send” and “Receive”. The
paramters are saved in browser local storage. The number of sets of
parameters which can be saved is limited only by the amount of local
storage available.</p>
</div>
</div>
<div class="section" id="accessing-vtam-applications">
<h4>Accessing VTAM applications<a class="headerlink" href="#accessing-vtam-applications" title="Permalink to this headline">¶</a></h4>
<p>Normally the VIRTEL administrator provides access to VTAM applications
by configuring a specific VIRTEL transaction for each application.
However some users require the ability to access <em>any</em> VTAM application,
including those not configured by the administrator, similar to the
function provided by VTAM’s USSTAB USS10 screen. For these users, VIRTEL
provides transactions named W2H-16 and CLI-16 whose external name is
VTAM.</p>
<p>This transaction displays a screen on which the user can enter the
ACBNAME of the VTAM application, together with optional LOGON DATA and
LOGMODE.</p>
<div class="section" id="vtam-logon-screen">
<h5>VTAM logon screen<a class="headerlink" href="#vtam-logon-screen" title="Permalink to this headline">¶</a></h5>
<div class="line-block">
<div class="line">To access VIRTEL’s VTAM logon screen, click on “Other applications” on
the VIRTEL Web Access menu (port 41001) or enter its URL directly:</div>
<div class="line"><em>http://n.n.n.n:41001/w2h/WEB2AJAX.htm+VTAM</em></div>
</div>
<p><a class="reference internal" href="../../../_images/image411.png"><img alt="image36" src="../../../_images/image411.png" style="width: 5.66667in; height: 3.50000in;" /></a></p>
<p>Figure 1‑68 VTAM logon screen in VIRTEL Web Access mode</p>
<p>To access, for example, TSO with logmode SNX32705, type TSO in the
“LOGON APPLID” field and SNX32705 in the “LOGMODE” field, then press
enter.</p>
<p>You can exit this screen by pressing F3.</p>
<p>Lines 3 and 4 of the screen indicate the name of your installation and
are taken from the TITRE1 and TITRE2 parameters of the VIRTCT (see
<em>VIRTEL Installation Guide</em>).</p>
<p>The layout of the VTAM logon screen can be customized by assembling the
map in member EIRM00U in the VIRTEL SAMPLIB.</p>
</div>
<div class="section" id="installing-the-vtam-logon-transaction">
<h5>Installing the VTAM logon transaction<a class="headerlink" href="#installing-the-vtam-logon-transaction" title="Permalink to this headline">¶</a></h5>
<p>To permit access to the VTAM logon screen, the administrator defines a
VIRTEL transaction which calls VIRTEL program VIR0021U, as shown in the
example below. The transaction should have “Securuty” set to 1 to force
the user to sign on before the screen is displayed.</p>
<p>The VTAM logon screen is protected by a security resource named
<em>prefix</em>.W2H-16 or <em>prefix</em>.CLI-16 (where <em>prefix</em> is the value of the
PRFSECU parameter in the VIRTCT) in the RACF FACILITY class. Provided
the “Security” field is set to 1, and security is activated in the
VIRTCT, only those users having READ access to the resource can obtain
the VTAM logon screen.</p>
<p><a class="reference internal" href="../../../_images/image421.png"><img alt="image37" src="../../../_images/image421.png" style="width: 5.70833in; height: 3.55208in;" /></a></p>
<p>Figure 1‑69 Example VIRTEL transaction for VTAM logon via Web Access</p>
</div>
</div>
<div class="section" id="site-customization-of-colors-and-logo">
<h4>Site customization of colors and logo<a class="headerlink" href="#site-customization-of-colors-and-logo" title="Permalink to this headline">¶</a></h4>
<p>The VIRTEL administrator can customize the color settings for all
applications or for specific applications. The custom settings are
defined in a style sheet called <em>custom.css</em> which the administrator
uploads to a VIRTEL directory designated for storage of customer files
(usually CLI-DIR).</p>
<div class="section" id="virtel-definitions-required">
<h5>VIRTEL definitions required<a class="headerlink" href="#virtel-definitions-required" title="Permalink to this headline">¶</a></h5>
<p>The <em>custom.css</em> file is loaded from the directory designated by the
transaction W2H-03CC (for entry point WEB2HOST on port 41001) or
CLI-03CC (for entry point CLIWHOST on port 41002). These transactions
have external name <em>w2h</em> and specify the path name <em>/w2h/custom-css</em> in
the URL Prefix field. When VIRTEL is first installed, these transactions
point to directory W2H-DIR which contains a dummy version of the file
<em>custom.css</em>.</p>
<p>The procedure for activating customized settings is:</p>
<ul class="simple">
<li>Download the dummy <em>custom.css</em> from W2H-DIR by opening this URL in
your browser: <em>http://n.n.n.n:41001/w2h/custom.css</em> (where <em>n.n.n.n</em>
is the IP address of your VIRTEL)</li>
<li>Save the <em>custom.css</em> file in a directory on your workstation.</li>
<li>Open the <em>custom.css</em> file using a text editor such as notepad.</li>
<li>Edit the <em>custom.css</em> file with the color and/or logo settings you
require (see examples below), then save the updated file.</li>
<li>Open the VIRTEL Web Access menu (URL <em>http://n.n.n.n:41001</em>) and
click the “Upload” link</li>
<li>Click “Browse” and navigate to the directory where you saved the
updated <em>custom.css</em>. Click on the <em>custom.css</em> file, then click the
“CLI-DIR” button to upload the file to VIRTEL.</li>
<li>From the VIRTEL Web Access menu (URL <em>http://n.n.n.n:41001</em>) click
the “Admin” link.</li>
<li>Press “F3 - Entry Points” then click “CLIWHOST”</li>
<li>Press “F4 - Transactions” then click “CLI-03CC”</li>
<li>Press “F12 - View/Add” and type CLI-DIR in the “Application” field,
overwriting the original value W2H-DIR</li>
<li>Press “F1 - Update” at the Transaction Detail Definition screen, then
“F3 – Return” twice to return to the List of Entry Points screen,
then “F1 – Update” again to update the entry point.</li>
</ul>
</div>
<div class="section" id="example-customizing-the-toolbar-color-by-application">
<h5>Example: Customizing the toolbar color by application<a class="headerlink" href="#example-customizing-the-toolbar-color-by-application" title="Permalink to this headline">¶</a></h5>
<p>It is sometimes useful for the user to have a clear visual indication of
which system he or she is logged on to. This example shows how to set
the color of the toolbar to yellow for SPCICSP and pink for SPCICSQ.</p>
<p>/* VIRTEL Web Access style sheet for site customization</p>
<p>* (c)Copyright SysperTec Communication 2007,2010 All Rights Reserved</p>
<p>*/</p>
<p>.SPCICSP #toolbar {background-color:yellow;}</p>
<p>.SPCICSQ #toolbar {background-color:pink;}</p>
<p>/*</p>
<p>Figure 1‑70 Example custom.css for coloring the toolbar according to
CICS region</p>
<p><a class="reference internal" href="../../../_images/image431.png"><img alt="image38" src="../../../_images/image431.png" style="width: 5.59375in; height: 1.35417in;" /></a></p>
<p>Figure 1‑71 Web Access screen with yellow toolbar for SPCICSP</p>
<p><a class="reference internal" href="../../../_images/image441.png"><img alt="image39" src="../../../_images/image441.png" style="width: 5.59375in; height: 1.37500in;" /></a></p>
<p>Figure 1‑72 Web Access screen with pink toolbar for SPCICSQ</p>
</div>
<div class="section" id="example-adding-custom-text-to-the-toolbar">
<h5>Example: Adding custom text to the toolbar<a class="headerlink" href="#example-adding-custom-text-to-the-toolbar" title="Permalink to this headline">¶</a></h5>
<p>Another way of providing a clear visual indication of which application
the user is logged on to is to add a text label to the toolbar. In this
example the text “MVS1” is displayed when logged on to application
TSO1A, and “MVS2” is displayed for application TSO2A.</p>
<p>/*</p>
<p>* VIRTEL Web Access style sheet for site customisation</p>
<p>* (c)Copyright SysperTec Communication 2007,2010 All Rights Reserved</p>
<p>*/</p>
<p>.TSO1A .toolbarLast:before {</p>
<p>content: &#8220;MVS1&#8221;;</p>
<p>color: gray;</p>
<p>opacity: 0.25;</p>
<p>font-size: 30px;</p>
<p>width: 100%;</p>
<p>text-align: center;</p>
<p>z-index: 1000;</p>
<p>-webkit-text-stroke: 1px #000;</p>
<p>-webkit-text-fill-color: transparent;</p>
<p>}</p>
<p>.TSO2A .toolbarLast:before {</p>
<p>content: &#8220;MVS2&#8221;;</p>
<p>color: red;</p>
<p>opacity: 0.25;</p>
<p>font-size: 30px;</p>
<p>width: 100%;</p>
<p>text-align: center;</p>
<p>z-index: 1000;</p>
<p>-webkit-text-stroke: 1px red;</p>
<p>-webkit-text-fill-color: transparent;</p>
<p>}</p>
<p>Figure 1‑73 Example custom.css for adding custom text to the toolbar</p>
<p><a class="reference internal" href="../../../_images/image451.png"><img alt="image40" src="../../../_images/image451.png" style="width: 5.54167in; height: 1.37500in;" /></a></p>
<p>Figure 1‑74 Web Access screen with custom text in the toolbar</p>
</div>
<div class="section" id="example-hiding-the-toolbar">
<h5>Example: Hiding the toolbar<a class="headerlink" href="#example-hiding-the-toolbar" title="Permalink to this headline">¶</a></h5>
<p>The administrator may wish to prevent users from accessing features like
copy/paste, print, and settings. This example shows how to hide the
toolbar using a <em>custom.css</em> file:</p>
<p>/* VIRTEL Web Access style sheet for site customization</p>
<p>* (c)Copyright SysperTec Communication 2007,2010 All Rights Reserved</p>
<p>*/</p>
<p>#toolbar {display:none;}/*</p>
<p>Figure 1‑75 Example custom.css for hiding the toolbar</p>
<p>You can also use <em>custom.js</em> to remove icons individually from the
toolbar, see “Removing unwanted toolbar icons” sur la page 142.</p>
</div>
<div class="section" id="example-modifying-the-3270-colors">
<h5>Example: Modifying the 3270 colors<a class="headerlink" href="#example-modifying-the-3270-colors" title="Permalink to this headline">¶</a></h5>
<p>Some installations prefer to modify the colors displayed on the 3270
screen to make the characters more readable. This example shows how to
modify the colors used by VIRTEL Web Access:</p>
<p>/*</p>
<p>* VIRTEL Web Access style sheet customisation for 3270 colors</p>
<p>* (c)Copyright SysperTec Communication 2012 All Rights Reserved</p>
<p>*/</p>
<p>.NBLUE, .UBLUE, .BBLUE {color:#7890F0;}</p>
<p>.RBLUE {background-color:#7890F0;}</p>
<p>.NRED, .URED, .BRED {color:#F21816;}</p>
<p>.RRED {background-color:#F21816;}</p>
<p>.NPINK, .UPINK, .BPINK {color:#FF00FE;}</p>
<p>.RPINK {background-color:#FF00FE;}</p>
<p>.NGREEN, .UGREEN, .BGREEN {color:#24D82F;}</p>
<p>.RGREEN {background-color:#24D82F;}</p>
<p>.NTURQUOISE, .UTURQUOISE, .BTURQUOISE {color:#58F0F1;}</p>
<p>.RTURQUOISE {background-color:#58F0F1;}</p>
<p>.NYELLOW, .UYELLOW, .BYELLOW {color:#FFFF00;}</p>
<p>.RYELLOW {background-color:#FFFF00;}</p>
<p>.NWHITE, .UWHITE, .BWHITE {color:#FFFFFF;}</p>
<p>.RWHITE {background-color:#FFFFFF;}</p>
<p>Figure 1‑76 Example custom.css for modifying the 3270 colors</p>
<p>In this stylesheet, BLUE, RED, PINK, GREEN, TURQUOISE, YELLOW, and WHITE
represent the 7 colors of the 3270 pallette, with a prefix indicating
the highlighting mode: N=normal, U=underscore, B=blink, R=reverse video.</p>
<div class="line-block">
<div class="line">The color values (for example, #7890F0) are expressed in hexadecimal
RGB encoding or as color names. For more explanation, see :</div>
<div class="line"><a class="reference external" href="http://en.wikipedia.org/wiki/Web_colors">http://en.wikipedia.org/wiki/Web_colors</a> or</div>
<div class="line"><a class="reference external" href="http://www.w3schools.com/html/html_colornames.asp">http://www.w3schools.com/html/html_colornames.asp</a></div>
</div>
</div>
<div class="section" id="example-adding-a-company-logo">
<h5>Example: Adding a company logo<a class="headerlink" href="#example-adding-a-company-logo" title="Permalink to this headline">¶</a></h5>
<p>This example shows how to display an icon (for example, a company logo)
at the left of the toolbar:</p>
<p>/*</p>
<p>* VIRTEL Web Access style sheet customisation for company logo</p>
<p>* (c)Copyright SysperTec Communication 2012 All Rights Reserved</p>
<p>*/</p>
<p>#toolbar td#companyIcon {</p>
<p>height:30px;</p>
<p>display:table-cell;</p>
<p>}</p>
<p>#companyIcon div {</p>
<p>background-image:url(&#8220;/w2h/virtblue.jpg&#8221;);</p>
<p>background-position:0px -4px;</p>
<p>background-repeat:no-repeat;</p>
<p>height:26px;</p>
<p>width:145px;</p>
<p>}</p>
<p>Figure 1‑77 Example custom.css for displaying company logo in the
toolbar</p>
<p>This example shows how to replace the <em>Virtel</em> logo in the VIRTEL Web
Access menu and the Application menu by your company logo:</p>
<p>/*</p>
<p>* VIRTEL Web Access style sheet for site customisation</p>
<p>* (c)Copyright SysperTec Communication 2013 All Rights Reserved</p>
<p>* $Id$</p>
<p>*/</p>
<p>#appmenulogo {</p>
<p>background-image: url(&#8220;mycompany.gif&#8221;);</p>
<p>height: 65px;</p>
<p>width: 266px;</p>
<p>}</p>
<p>Figure 1‑78 Example custom.css for replacing the Virtel logo by a
company logo</p>
<p>Note: If no explicit path is given, the company logo will be loaded from
the same directory as the custom.css file.</p>
</div>
</div>
<div class="section" id="site-customization-of-javascript-functions">
<h4>Site customization of Javascript functions<a class="headerlink" href="#site-customization-of-javascript-functions" title="Permalink to this headline">¶</a></h4>
<p>To take into account site-specific Javascript extensions for Web Access,
the WEB2AJAX.htm page template loads the <em>/w2h/custom-js/custom.js</em> file
when a session is started. An empty <em>custom.js</em> file is delivered as
standard in the W2H-DIR directory. The CLI-03CJ (<em>/w2h/custom-js</em>)
transaction delivered as standard under the CLIWHOST entry point
references the W2H-DIR directory, but the administrator can modify this
transaction to reference a different directory containing a
site-specific version of <em>custom.js.</em> The CLI-DIR directory, which is
intended for client-specific files, may be used for this purpose.</p>
<p>To facilitate site-specific modifications to <em>custom.js</em>, VIRTEL Web
Access calls various custom exits at strategic points in its processing.
These exits are optional Javascript functions which can be codes
<em>custom.js</em> if required. The exits are described below.</p>
<div class="section" id="exits-which-can-be-coded-in-custom-js">
<h5>Exits which can be coded in custom.js<a class="headerlink" href="#exits-which-can-be-coded-in-custom-js" title="Permalink to this headline">¶</a></h5>
<p>after_standardInit()</p>
<p>This function is called after the session with the host application has
started.</p>
<p>before_submitForm(pfKey,oForm)</p>
<p>This function is called before submitting a request to the VIRTEL
server.</p>
<p>The arguments passed to <strong>before_submitForm</strong> are:</p>
<p><strong>pfKey</strong> the name of the key pressed: &#8220;ENTER&#8221;, &#8220;PF1&#8221;, etc.</p>
<p><strong>oForm</strong> a DOM object representing the form to be submitted (usually
document.virtelForm)</p>
<p>after_responseHandle(o,url,xtim)</p>
<p>This function is called after receiving a response from the VIRTEL
server.</p>
<p>The arguments passed to <strong>after_responseHandle</strong> are:</p>
<p><strong>o</strong> the XMLHttpRequest object (contains the status and responseText)</p>
<p><strong>url</strong> the URL which was used in the request</p>
<p><strong>xtim</strong> a Javascript Date object representing the time the request was
sent to the server</p>
<p>modify_settingsValues(name,values)</p>
<p>This function is called before the list of possible values for a
parameter is displayed in the VIRTEL Web Access Settings menu. It allows
the list of values to be modified.</p>
<p>The arguments passed to <strong>modify_settingsValues</strong> are:</p>
<p><strong>name</strong> the parameter name</p>
<p><strong>values</strong> the list of possible values</p>
<p>The return value is treated as the new list of possible values. If the
function returns null or undefined, the list remains unchanged.</p>
<p>when_init()</p>
<p>This function is called for each subpage after vir3270 initialisation.</p>
<p>when_focusGained()</p>
<p>This function is called whenever the 3270 window gains the focus.</p>
<p>when_focusLost()</p>
<p>This function is called whenever the 3270 window loses the focus.</p>
</div>
<div class="section" id="example-customizing-the-toolbar-icons">
<h5>Example: Customizing the toolbar icons<a class="headerlink" href="#example-customizing-the-toolbar-icons" title="Permalink to this headline">¶</a></h5>
<p>This example uses the <strong>after_standardInit</strong> function to insert
additional icons into the toolbar when the session is started. Icons may
subsequently be added or removed from the toolbar after each screen by
means of the after_responseHandle function.</p>
<p>/*</p>
<p>* (c)Copyright SysperTec Communication 2012 All Rights Reserved</p>
<p>* VIRTEL Web Access customer-specific javascript functions</p>
<p>*/</p>
<p>/*</p>
<p>* Adds a button to the toolbar which performs a Google search for</p>
<p>* the text selected in the red box in the 3270 screen, or for the</p>
<p>* word at the cursor if no box is drawn</p>
<p>*/</p>
<p>function after_standardInit() {</p>
<p>addtoolbarbutton(999, &#8220;<a class="reference external" href="http://www.google.com/favicon.ico">http://www.google.com/favicon.ico</a>&#8221;,</p>
<p>&#8220;Search engine query&#8221;, do_search);</p>
<p>}</p>
<p>function do_search() {</p>
<p>var searcharg = VIR3270.getBoxedText() || VIR3270.getWordAtCursor();</p>
<p>var windowname = &#8220;search&#8221;;</p>
<p>var searchURL = &#8220;<a class="reference external" href="http://www.google.com">http://www.google.com</a>&#8221;;</p>
<p>if (searcharg) searchURL += &#8220;/search?q=&#8221; +</p>
<p>encodeURIComponent(searcharg.replace(/\s+/g,&#8221; &#8221;));</p>
<p>var windowopts = &#8220;location=yes,status=yes,resizable=yes,&#8221;+</p>
<p>&#8220;scrollbars=yes,toolbar=yes,menubar=yes,width=640,height=480&#8221;;</p>
<p>var searchwin = window.open(searchURL, windowname, windowopts);</p>
<p>if (searchwin) searchwin.focus();</p>
<p>}</p>
<p>Figure 1‑79 Example custom.js to customize the toolbar icons</p>
</div>
<div class="section" id="example-removing-unwanted-toolbar-icons">
<h5>Example: Removing unwanted toolbar icons<a class="headerlink" href="#example-removing-unwanted-toolbar-icons" title="Permalink to this headline">¶</a></h5>
<p>This example uses the <strong>after_standardInit</strong> function to disable macro
functions by removing the corresponding icons from the toolbar.</p>
<p>/*</p>
<p>* (c)Copyright SysperTec Communication 2012 All Rights Reserved</p>
<p>* VIRTEL Web Access customer-specific javascript functions</p>
<p>*/</p>
<p>function after_standardInit() {</p>
<p>/* Remove macro buttons from the toolbar */</p>
<p>removetoolbarbutton(&#8220;startrecording&#8221;);</p>
<p>removetoolbarbutton(&#8220;playback&#8221;);</p>
<p>}</p>
<p>Figure 1‑80 Example custom.js to remove selected toolbar icons</p>
<p>The names of the other toolbar icons which can be removed in this way
are:</p>
<p>keypad, edit-copy, edit-cut, edit-paste, capture, emptybuf, settings,
help, disconnect</p>
<p>To hide the toolbar completely, see “Hiding the toolbar” sur la page
138.</p>
</div>
<div class="section" id="example-modifying-the-text-of-the-status-bar">
<h5>Example: Modifying the text of the status bar<a class="headerlink" href="#example-modifying-the-text-of-the-status-bar" title="Permalink to this headline">¶</a></h5>
<p>This example uses the <strong>after_responseHandle</strong> function to modify the
text in the status bar at the bottom of the Web Access screen. The
status bar text is enclosed in <em>&lt;span id=relayStatus&gt;&lt;/span&gt;</em> tags to
allow custom.js to modify it. This example displays the text “Your
printer name is xxxx” in the status bar:</p>
<p>/*</p>
<p>* (c)Copyright SysperTec Communication 2012 All Rights Reserved</p>
<p>* VIRTEL Web Access customer-specific javascript functions</p>
<p>*/</p>
<p>function after_responseHandle(httpXmlObj, url, xmitTimestamp) {</p>
<p>var o = document.getElementById(&#8220;relayStatus&#8221;);</p>
<p>var p = document.getElementById(&#8220;nameofprintrelay&#8221;);</p>
<p>if (o &amp;&amp; p) {</p>
<p>o.innerHTML = &#8220;Your printer name is &#8221; + p.innerHTML;</p>
<p>}</p>
<p>}</p>
<p>Figure 1‑81 Example custom.js to modify the text of the status bar</p>
</div>
<div class="section" id="example-custom-hotspot-recognition">
<h5>Example: Custom hotspot recognition<a class="headerlink" href="#example-custom-hotspot-recognition" title="Permalink to this headline">¶</a></h5>
<p>This example uses the <strong>after_responseHandle</strong> function to modify the
regular expression which is used to identify PF key hotspots.</p>
<p>/*</p>
<p>* (c)Copyright SysperTec Communication 2012 All Rights Reserved</p>
<p>* VIRTEL Web Access customer-specific javascript functions</p>
<p>*/</p>
<p>function after_responseHandle(httpXmlObj, url, xmitTimestamp) {</p>
<p>VIR3270.customPfKeysHotspotRegex =</p>
<p>/(P?F\d{1,2}|PA[1-3]|ENTER|CLEAR)((?:\/P?F\d{1,2})?\s*[=:-])/;</p>
<p>}</p>
<p>Figure 1‑82 Example custom.js to modify PF key hotspot recognition</p>
</div>
<div class="section" id="example-adding-a-watermark-to-the-3270-screen">
<h5>Example: Adding a watermark to the 3270 screen<a class="headerlink" href="#example-adding-a-watermark-to-the-3270-screen" title="Permalink to this headline">¶</a></h5>
<p>This example uses the <strong>after_standardInit</strong> function in conjunction
with a custom stylesheet to add a watermark to the Web Access screen.
The watermark displays the application name in light text behind the
3270 screen content. The application name is obtained from the class
attribute of the body tag.</p>
<p>/*</p>
<p>* (c)Copyright SysperTec Communication 2012 All Rights Reserved</p>
<p>* VIRTEL Web Access customer-specific javascript functions</p>
<p>*/</p>
<p>function after_standardInit() {</p>
<p>var o = document.createElement(&#8220;div&#8221;);</p>
<p>o.className = &#8220;watermark&#8221;;</p>
<p>o.innerHTML = document.body.className;</p>
<p>document.body.appendChild(o);</p>
<p>}</p>
<p>Figure 1‑83 Example custom.js to add a watermark to the Web Access 3270
screen</p>
<p>/*</p>
<p>* (c)Copyright SysperTec Communication 2012 All Rights Reserved</p>
<p>* VIRTEL Web Access style sheet for site customisation</p>
<p>*/</p>
<p>.watermark {</p>
<p>position: absolute;</p>
<p>pointer-events: none;</p>
<p>left: 150px;</p>
<p>top: 100px;</p>
<p>color: gray;</p>
<p>opacity: 0.25;</p>
<p>font-size: 10em;</p>
<p>width: 60%;</p>
<p>text-align: center;</p>
<p>z-index: 1000;</p>
<p>-webkit-text-stroke: 1px #FFF;</p>
<p>-webkit-text-fill-color: transparent;</p>
<p>-webkit-transform: rotate(-40deg);</p>
<p>-moz-transform: rotate(-40deg);</p>
<p>filter: alpha(opacity=25)
progid:DXImageTransform.Microsoft.Matrix(M11=0.819, M12=0.574,
M21=-0.574, M22=0.819, sizingMethod=&#8221;auto expand&#8221;);</p>
<p>}</p>
<p>Figure 1‑84 Example custom.css to define the style of the watermark</p>
<p><a class="reference internal" href="../../../_images/image461.png"><img alt="image41" src="../../../_images/image461.png" style="width: 5.81250in; height: 4.07292in;" /></a></p>
<p>Figure 1‑85 Web Access screen with application name as watermark</p>
</div>
<div class="section" id="example-modifying-web-access-settings">
<h5>Example: Modifying Web Access Settings<a class="headerlink" href="#example-modifying-web-access-settings" title="Permalink to this headline">¶</a></h5>
<p>The callback function <strong>modify_settingsValues</strong> allows the
administrator to modify or replace the list of values allowed for
specific parameters in the VIRTEL Web Access Settings menu.</p>
<p>The example shown below replaces the list of fonts, and adds two extra
values &#8220;20&#8221; and &#8220;24&#8221; to the list of fontsizes:</p>
<p>/*</p>
<p>* (c)Copyright SysperTec Communication 2012 All Rights Reserved</p>
<p>* VIRTEL Web Access customer-specific javascript functions</p>
<p>*/</p>
<p>function modify_settingsValues(name, values) {</p>
<p>if (name == &#8220;font&#8221;)</p>
<p>return [&#8220;Courier New&#8221;, &#8220;Lucida Console&#8221;, &#8220;Consolas&#8221;];</p>
<p>if (name == &#8220;fontsize&#8221;)</p>
<p>return values.concat(&#8220;20&#8221;, &#8220;24&#8221;);</p>
<p>}</p>
<p>Figure 1‑86 Example custom.js to modify Settings values</p>
</div>
</div>
<div class="section" id="customizing-the-help-page">
<h4>Customizing the help page<a class="headerlink" href="#customizing-the-help-page" title="Permalink to this headline">¶</a></h4>
<p>Users can obtain help on VIRTEL Web Access functions by clicking the
help icon <a class="reference internal" href="../../../_images/image471.png"><img alt="Help" src="../../../_images/image471.png" style="width: 0.22917in; height: 0.22917in;" /></a> in the Web Access toolbar, which causes the browser to
display the page <em>/w2h/custom-help/help.html</em> delivered as standard with
VIRTEL Web Access.</p>
<p>The administrator can create a custom version of the <em>help.html</em> page
and upload it to a VIRTEL directory destined for site-specific pages,
such as CLI-DIR.</p>
<div class="section" id="standard-help-page">
<h5>Standard help page<a class="headerlink" href="#standard-help-page" title="Permalink to this headline">¶</a></h5>
<p>The standard <em>help.html</em> page is shown below:</p>
<p><a class="reference internal" href="../../../_images/image481.png"><img alt="image43" src="../../../_images/image481.png" style="width: 3.65625in; height: 4.14583in;" /></a></p>
<p>Figure 1‑87 Standard help page for Web Access</p>
</div>
<div class="section" id="installing-a-custom-help-page">
<h5>Installing a custom help page<a class="headerlink" href="#installing-a-custom-help-page" title="Permalink to this headline">¶</a></h5>
<p>To install a customized <em>help.html</em> page, the administrator must perform
the following operations:</p>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>Upload the customized <em>help.html</em> file into a VIRTEL directory such</dt>
<dd>as CLI-DIR</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Modify the VIRTEL transactions CLI-03CH so that it points to the</dt>
<dd>CLI-DIR directory (instead of W2H-DIR as initially installed),
then press F1-F3-F3-F1 to update the transaction and the CLIWHOST
entry point. Perform the same operation on transaction W2H-03CH
and entry point WEB2HOST.</dd>
</dl>
</li>
</ol>
</div>
</div>
<div class="section" id="macros">
<h4>Macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h4>
<p>By pressing the <a class="reference internal" href="../../../_images/image491.png"><img alt="image44" src="../../../_images/image491.png" style="width: 0.19792in; height: 0.22917in;" /></a> button on the VIRTEL Web Access toolbar, the
user can start recording a sequence of keystrokes. A second click on the
<a class="reference internal" href="../../../_images/image491.png"><img alt="image45" src="../../../_images/image491.png" style="width: 0.19792in; height: 0.22917in;" /></a> button terminates the recording and allows the user to assign
a name to the macro which has been recorded.</p>
<p>The <a class="reference internal" href="../../../_images/image501.png"><img alt="image46" src="../../../_images/image501.png" style="width: 0.23958in; height: 0.22917in;" /></a> button on the toolbar allows the user to display a list of
macros already recorded, and to replay or delete a macro.</p>
<div class="section" id="macros-in-local-storage">
<h5>Macros in Local Storage<a class="headerlink" href="#macros-in-local-storage" title="Permalink to this headline">¶</a></h5>
<p>By default macros created by the user are saved on the workstation in
“Browser Local Storage”.</p>
</div>
<div class="section" id="macros-in-virtel-storage">
<h5>Macros in Virtel Storage<a class="headerlink" href="#macros-in-virtel-storage" title="Permalink to this headline">¶</a></h5>
<p>The VirtelMacros function allows global, group, and user macros to be
stored under the name <em>macros.json</em> in a VSAM file on the VIRTEL host
system.</p>
<p>The SET VMACROS=YES parameter in the ARBOLOAD job allows the definitions
needed for the VirtelMacros function to be loaded during VIRTEL
installation.</p>
<p>Multiple <em>macros.json</em> files can be defined: a global file containing
shared macros for all users, and group and user files where macros
specific to a group or to a user are stored.</p>
<p>User macros created by each user are stored in <em>macros.json</em> files
loaded into the USR-DIR directory with keyword %USER%. When the macros
are loaded into or read from this directory, VIRTEL substitutes the
keyword %USER% by the userid.</p>
<p>Global macros accessible to all users are stored in the <em>macros.json</em>
file loaded into the GLB-DIR directory.</p>
<p>Group macros are defined for a specific group name recognized by the
security subsystem (RACF, TOPS, ACF2). They are stored in a
<em>macros.json</em> file loaded into the GRP-DIR directory with keyword
%GROUP%.</p>
<p>At execution time, VIRTEL substitutes the keyword %GROUP% by the name of
the group supplied by the security subsystem.</p>
<p>A prerequisite for using group and user macros is that the user must
sign on to VIRTEL with a userid and password, either by accessing VIRTEL
via a secure transaction (one whose “Security” field is non-zero), or by
executing a SIGNON$ instruction contained in a scenario.</p>
<div class="section" id="activation-of-the-virtelmacros-function">
<h6>Activation of the VirtelMacros function<a class="headerlink" href="#activation-of-the-virtelmacros-function" title="Permalink to this headline">¶</a></h6>
<p>When VIRTEL is first installed, no <em>macros.json</em> files exist.</p>
<p>To allow macros to be stored and loaded from the host site, the
administrator activates the VirtelMacros function by adding the code
shown below to the <em>custom.js</em> file loaded into the CLI-DIR directory
(or another site-defined directory):</p>
<p>w2hparm.useVirtelMacros = true;</p>
<p>Figure 1‑88 custom.js to activate the VirtelMacros function</p>
<p>The <em>custom.js</em> file must be activated as described in “Site
customization of Javascript functions” on page 140.</p>
<p>Once this has been done, each VIRTEL Web Access user has access to one
or more <em>macros.json</em> files.</p>
<p>If no file exists, a 404 error is produced, and no macros are listed in
the macro window.</p>
</div>
<div class="section" id="creation-of-user-macros">
<h6>Creation of user macros<a class="headerlink" href="#creation-of-user-macros" title="Permalink to this headline">¶</a></h6>
<p>Each user can create his or her own <em>macros.json</em> file once the user has
signed on to VIRTEL.</p>
<p>To create the file, the user only has to sign on to VIRTEL Web Access
and record a new macro. When the macro is saved with a user-specified
name, the <em>macros.json</em> file is automatically uploaded into VIRTEL’s
USR-DIR directory.</p>
<p>For subsequent Web Access sessions, the <em>macros.json</em> file is
automatically loaded and the user’s macros are displayed in the macro
window (with an X allowing the macro to be deleted):</p>
<p><a class="reference internal" href="../../../_images/image511.png"><img alt="image47" src="../../../_images/image511.png" style="width: 2.12500in; height: 3.77083in;" /></a></p>
<p>Figure 1‑89 Display macros for VirtelMacros function</p>
</div>
<div class="section" id="creation-of-global-and-group-macros">
<h6>Creation of global and group macros<a class="headerlink" href="#creation-of-global-and-group-macros" title="Permalink to this headline">¶</a></h6>
<p>Only the administrator can upload <em>macros.json</em> files into the global
(GLB-DIR) and group (GRP-DIR) directories.</p>
<p>Uploads to the user and group directories are performed by means of a
command-line script from the Windows prompt.</p>
<p>To define a new global or group <em>macros.json</em> file, the administrator
can:</p>
<ol class="arabic simple">
<li>Edit a new text file and manually code the macro definitions in this
file using the appropriate syntax, or</li>
<li>Convert a set of existing macros (for example, macros created using
the 3270 HOB emulator) into a single <em>macros.json</em> file. The
administrator script <em>hob2webaccess.js</em> performs this task.
Additional scripts may be provided to allow conversion of macros from
other emulators.</li>
</ol>
<p>Then the <em>macros.json</em> file is uploaded to VIRTEL using the
administrator script <em>adminupload.js</em>.</p>
<p>These administrator scripts are executed using the <em>node.exe</em>
interpreter<em>.</em> The interpreter executable is supplied with the script,
but it is also possible to download and install it from
<a class="reference external" href="http://nodejs.org">http://nodejs.org</a>.</p>
<p>To use the scripts, open a Windows command prompt in the directory
containing the macros to be converted, then:</p>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">Convert a set of macros into a <em>macros.json</em> file using the la
command:</div>
<div class="line">node.exe hob2webaccess.js –o macros.json file1.mac file2.mac
file3.mac</div>
</div>
</li>
<li><div class="first line-block">
<div class="line">Upload a <em>macros.json</em> file into the user, group, or global
directory:</div>
<div class="line">node.exe adminupload.js -u <em>admin</em> -h <em>n.n.n.n</em> -p 41001 -t user -n
<em>userid</em> macros.json</div>
<div class="line">node.exe adminupload.js -u <em>admin</em> -h <em>n.n.n.n</em> -p 41001 -t group
-n <em>groupid</em> macros.json</div>
<div class="line">node.exe adminupload.js -u <em>admin</em> -h <em>n.n.n.n</em> -p 41001 -t global
macros.json</div>
<div class="line">where <em>admin</em> is the name of a user with VIRTEL administration
privileges, <em>n.n.n.n</em> is the IP address of VIRTEL, 41001 is the
VIRTEL administration port, <em>userid</em> and <em>groupid</em> are the name of
the user and group which owns the macros.</div>
</div>
</li>
</ol>
<p>The two scripts supplied may be called from a batch file which can scan
all users’ macros and then convert and upload them to VIRTEL.</p>
</div>
<div class="section" id="format-of-the-macros-json-file">
<h6>Format of the macros.json file<a class="headerlink" href="#format-of-the-macros-json-file" title="Permalink to this headline">¶</a></h6>
<p>Each <em>macros.json</em> file contains a set of macros as shown in the example
below:</p>
<p>{&#8220;macros&#8221;: [</p>
<p>{&#8220;def&#8221;:[&#8220;PF3&#8221;,61,120,&#8221;ENTER&#8221;,105,115,112,102,&#8221;ENTER&#8221;,46,53,&#8221;ENTER&#8221;],</p>
<p>&#8220;name&#8221;:&#8221;macro1&#8221;},</p>
<p>{&#8220;def&#8221;:[105,115,112,102,&#8221;ENTER&#8221;],</p>
<p>&#8220;name&#8221;:&#8221;macro2&#8221;}</p>
<p>],</p>
<p>}</p>
<p>Figure 1‑90 Example of a macros.json file</p>
<p>An empty file (containing no macros) contains only:</p>
<p>{&#8220;macros&#8221;: []}</p>
<p>Figure 1‑91 Example of an empty macros.json file</p>
</div>
</div>
</div>
</div>
<div class="section" id="virtel-web-modernisation">
<h3>VIRTEL Web Modernisation<a class="headerlink" href="#virtel-web-modernisation" title="Permalink to this headline">¶</a></h3>
<div class="section" id="virtel-scenarios">
<h4>VIRTEL Scenarios<a class="headerlink" href="#virtel-scenarios" title="Permalink to this headline">¶</a></h4>
<p>Without modifying existing applications, VIRTEL offers several
possibilities for dynamic modification of 3270 data extracted by the
{{{GENERATE-HTML}}} tag before it is presented in an HTML page. For
instance, it is possible to define, for each field selected, a list of
permitted values, or to generate a URL as a function of the value of a
fixed field.</p>
<p>As opposed to the specific tags presented in the previous paragraphs,
this set of presentation rules is not defined in an HTML page, but in a
program assembled and link edited in the VIRTEL LOADLIB.</p>
<div class="section" id="presentation-modules">
<h5>Presentation modules<a class="headerlink" href="#presentation-modules" title="Permalink to this headline">¶</a></h5>
<p>An HTML presentation module is made up of several scenarios composed of
the following instructions: SCREENS, SCRNEND, SCENARIO, ACTION$,
CONVERT$, COPY$, DECLARE$, ERROR$, FIELD$, GOTO$, IF$, MAP$, SET$,
TOVAR$, VIRSV$ and END. These instructions are assembler macros
contained in the VIRT452.SCRNAPI.MACLIB library (for MVS) or the
VIRT452.VIRSAPI sublibrary (for VSE). The other instructions included in
this library are for internal use and must not be used directly. Each
module begins with a SCREENS instruction, is terminated by a SCRNEND
instruction, and must contain at least one SCENARIO.</p>
<p>VIRTEL scenarios were originally assembled and link-edited into a load
library concatenated to the DFHRPL DD statement in the VIRTEL started
task. From VIRTEL version 4.48 onwards, there is also the possibility of
generating, syntax checking, and compiling scenarios using Virtel Studio
on an Eclipse platform, and uploading the resulting executable code into
a VIRTEL directory stored in a VSAM file.</p>
<div class="section" id="scenarios-stored-in-a-load-library">
<h6>Scenarios stored in a load library<a class="headerlink" href="#scenarios-stored-in-a-load-library" title="Permalink to this headline">¶</a></h6>
<p>After compilation, the resulting module must be placed in one of the
libraries defined in the DFHRPL concatenation in the VIRTEL started task
(for MVS), or in one of the libraries in the LIBDEF SEARCH statement
(for VSE). Refer to member ASMSCEN in the VIRTEL SAMPLIB for an example
job to assemble and link a presentation module in z/OS.</p>
<p>The F VIRTEL,NEW=<em>scenario-name</em> command (see <em>VIRTEL Messages and
Operations Guide</em>) allows VIRTEL to take into account the new version of
a scenario assembled and link-edited into a load library.</p>
</div>
<div class="section" id="scenarios-stored-in-a-vsam-directory">
<h6>Scenarios stored in a VSAM directory<a class="headerlink" href="#scenarios-stored-in-a-vsam-directory" title="Permalink to this headline">¶</a></h6>
<p>If the “Directory for scenarios” field in the Entry Point is non-blank,
VIRTEL will load scenarios from the specified directory instead of from
the DFHRPL load library.</p>
<p>Scenarios in VSAM are ordinary VIRTEL files and their extension must be
.390; they are normally assembled on a workstation and uploaded to the
“Directory for scenarios” by means of Virtel Studio.</p>
<p>If a new version of a scenario is uploaded in a VSAM directory, the new
version will be used immediately whenever a new connection needs it; no
VIRTEL command is necessary. If a terminal is already executing the old
version of the scenario, it is not affected, and continues with a copy
of the old version. If another scenario with the same name exists in
another directory, it is not modified by the upload.</p>
</div>
<div class="section" id="using-a-presentation-module">
<h6>Using a presentation module<a class="headerlink" href="#using-a-presentation-module" title="Permalink to this headline">¶</a></h6>
<p>In order to be used, the name of the HTML presentation module must be
specified in the “Initial Scenario”, “Final Scenario”, “Input Scenario”
or “Output Scenario” field of the transaction supporting access to the
application (see “Parameters of the transaction” in the <em>VIRTEL
Connectivity Reference</em> manual), or in the “Identification scenario”
field of the entry point (see “Parameters of the entry point” in the
<em>VIRTEL Connectivity Reference</em> manual).</p>
</div>
<div class="section" id="types-of-scenario">
<h6>Types of scenario<a class="headerlink" href="#types-of-scenario" title="Permalink to this headline">¶</a></h6>
<p>A presentation module can contain one of each of the following types of
scenario:</p>
<p>IDENTIFICATION SCENARIO</p>
<p>An identification scenario is invoked when an inbound call is assigned
to an entry point. Because an identification scenario is executed before
a transaction is selected and before connecting to a host application,
the scenario may use the SET$&nbsp;TRANSACTION instruction to select the
transaction which specifies the host application (if any) to be used.
The identification scenario is required when the entry point specifies
the name of this presentation module in its “Identification scenario”
field.</p>
<p>INITIAL SCENARIO</p>
<p>An initial scenario is invoked when an &amp;/S order is processed in a
connection script (see “Connection / Disconnection Scripts” in the
<em>VIRTEL Connectivity Reference</em> manual). The initial scenario is
required when the “TIOA at logon” field of the transaction contains &amp;/S
and the name of the presentation module is coded in the “Initial
Scenario” field of the transaction.</p>
<p>FINAL SCENARIO</p>
<p>A final scenario is invoked when an &amp;/S order is processed in a
disconnection script (see “Connection / Disconnection Scripts” in the
<em>VIRTEL Connectivity Reference</em> manual). The final scenario is required
when the “TIOA at logoff” field of the transaction contains &amp;/S and the
name of the presentation module is coded in the “Final Scenario” field
of the transaction.</p>
<p>INPUT SCENARIO</p>
<p>An input scenario is invoked once at the start of the session (on
receipt of the first message from the application to the terminal after
the connection has been established with the host application), and
again on receipt of each inbound message (from the terminal to the
application). The input scenario is required when the name of the
presentation module is coded in the “Input Scenario” field of the
transaction.</p>
<p>When the input scenario is invoked on receipt of the first outbound
message (from the application to the terminal), the scenario may
terminate with a CASE$&nbsp;FAIL or an IF$&nbsp;FAIL instruction. In this case,
the outbound message is discarded and the input scenario is invoked
again on receipt on the <em>next outbound</em> message from the application.
This process continues until the input scenario terminates with a
CASE$&nbsp;SUCCESS or IF$&nbsp;SUCCESS instruction, or reaches SCENARIO&nbsp;END, after
which the input scenario stops processing outbound messages and is
subsequently invoked for each inbound message.</p>
<p>OUTPUT SCENARIO</p>
<p>An output scenario is invoked on receipt of each outbound message (sent
from the application to the terminal). The output scenario is required
when the name of the presentation module is coded in the “Output
Scenario” field of the transaction.</p>
</div>
<div class="section" id="virtel-multi-session-scenarios">
<h6>VIRTEL Multi-Session scenarios<a class="headerlink" href="#virtel-multi-session-scenarios" title="Permalink to this headline">¶</a></h6>
<p>A scenario may also be specified in the “Output Scenario” field of a
transaction invoked by VIRTEL Multi-Session. By executing an OUTPUT
scenario on a 3270 terminal, VIRTEL allows automated 3270 navigation
(for example, logon to VTAM application) from the Multi-Session screen.</p>
<p>When the same VTAM application is re-invoked from a VIRTEL Multi-Session
screen using a different transaction from the one which was previously
active, VIRTEL will call the OUTPUT scenario of the new transaction so
that the scenario can terminate the previous transaction and start the
new one. In this case the IF$&nbsp;SESSION-SWITCH instruction is useful
(refer to “IF$ instruction” sur la page 185 for further details).</p>
</div>
<div class="section" id="screens-instruction">
<h6>SCREENS instruction<a class="headerlink" href="#screens-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction specifies the name of the presentation module and its
execution mode. Each SCREENS instructions is terminated by a SCRNEND
instruction and may contain only SCENARIO or ERROR$ instructions.</p>
<p>modname SCREENS APPL=value1,EXEC=value2</p>
<p><strong>modname</strong> Name of the presentation module (8 characters maximum).
Under certain conditions, this value will allow calls to a script from a
subsystem by way of a CALL command.</p>
<p><strong>APPL</strong> Specifies the name of the target transaction when the
presentation module is called by a program.</p>
<p><strong>EXEC</strong> Determines the mode in which the script is used. The possible
values are:</p>
<p><strong>YES</strong> : The script may be called by a CALL from a subsystem with the
possible passing of parameters</p>
<p><strong>NO</strong> : The script may not be externally called.</p>
</div>
<div class="section" id="scrnend-instruction">
<h6>SCRNEND instruction<a class="headerlink" href="#scrnend-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction marks the end of a presentation module.</p>
<p>SCRNEND</p>
</div>
<div class="section" id="scenario-instruction">
<h6>SCENARIO instruction<a class="headerlink" href="#scenario-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction encloses ACTION$, CONVERT$, COPY$, DECLARE$, ERROR$,
FIELD$, GOTO$, IF$, MAP$, SET$, TOVAR$, and VIRSV$ instructions.</p>
<p>SCENARIO value</p>
<p><strong>value</strong> Determines the type of processing. The permitted values are:</p>
<p><strong>IDENTIFICATION</strong> Marks the start of the identification scenario.</p>
<p><strong>INITIAL</strong> Marks the start of the initial scenario.</p>
<p><strong>FINAL</strong> Marks the start of the final scenario.</p>
<p><strong>INPUT</strong> Marks the start of the input scenario.</p>
<p><strong>OUTPUT</strong> Marks the start of the output scenario.</p>
<p><strong>END</strong> Marks the end of a scenario. In the case of an input or output
scenario, the scenario is stopped, but will resume on receipt of the
next input or output message.</p>
<p><strong>DISCARD</strong> Marks the end of a scenario. In the case of an input or
output scenario, the scenario stops, and does not resume for the
remainder of the life of the VIRTEL transaction.</p>
</div>
<div class="section" id="action-instruction">
<h6>ACTION$ instruction<a class="headerlink" href="#action-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction specifies actions to be taken.</p>
<p>ACTION$ DISCONNECT</p>
<p>Terminate the application.</p>
<p>ACTION$ DISCONNECT</p>
<p>ACTION$ SERVE-ANOTHER-USER</p>
<p>Indicates that the transaction is now a <em>service transaction</em> (see
“Service Transactions” sur la page 11).</p>
<p>ACTION$ SERVE-ANOTHER-USER</p>
<p>ACTION$ TERMSESS</p>
<p>Requests disconnection from the host application after the next message
has been sent to the client’s browser.</p>
<p>ACTION$ TERMSESS</p>
<p>ACTION$ TO-APPLICATION</p>
<p>Send a message to the application, consisting of the input fields in the
screen image buffer and the function key specified by <em>pfkey</em>.</p>
<p>ACTION$ TO-APPLICATION,KEY=pfkey,</p>
<p>AND=(WAIT|SCRIPT,&#8217;string&#8217;),</p>
<p>AND=(PROCESS-RESPONSE,&#8217;string&#8217;),</p>
<p>AND=(DO-NOT-PROCESS-RESPONSE),</p>
<p>MAXTIME=nnn,</p>
<p>LASTMSG=YES,ASYNCH=YES</p>
<p><strong>*pfkey*</strong> a 3270 AID key. The allowable values are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="28%" />
<col width="22%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Value</strong></th>
<th class="head"><strong>Meaning</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>F1-F9</td>
<td>PF1 to PF9</td>
<td>7A-7C</td>
<td>PF10 to PF12</td>
</tr>
<tr class="row-odd"><td>C1-C9</td>
<td>PF13 to PF21</td>
<td>4A-4C</td>
<td>PF22 to PF24</td>
</tr>
<tr class="row-even"><td>6C</td>
<td>PA1</td>
<td>6E</td>
<td>PA2</td>
</tr>
<tr class="row-odd"><td>6B</td>
<td>PA3</td>
<td>6D</td>
<td>Clear</td>
</tr>
<tr class="row-even"><td>7D</td>
<td>Enter</td>
<td>FD</td>
<td>Attn</td>
</tr>
</tbody>
</table>
<p><a href="#id88"><span class="problematic" id="id89">**</span></a>AND=(WAIT,&#8217;<em>string</em>&#8216;)
<a href="#id90"><span class="problematic" id="id91">**</span></a><em>(optional)</em> after sending the message to the application, the
scenario waits until the application sends a message containing the
specified character string. Intervening messages are processed by VIRTEL
but are not passed to the scenario or sent to the terminal.</p>
<div class="line-block">
<div class="line"><strong>AND=(SCRIPT,&#8217;*string*&#8217;)</strong></div>
<div class="line"><em>(optional)</em> after sending the message to the application, VIRTEL
executes the string as a Connection/Disconnection script (see
“Connection/Disconnection Scripts” in the <em>VIRTEL Connectivity
Reference</em> manual).</div>
</div>
<div class="line-block">
<div class="line"><strong>AND=(PROCESS-RESPONSE,&#8217;*string*&#8217;)</strong></div>
<div class="line"><em>(optional)</em> allows an input scenario to explicitly request that
control is to be returned when the next message is received from the
application. The <em>string</em> is optional. If specified, after sending the
message to the application, VIRTEL executes the string as a
Connection/Disconnection script (see “Connection/Disconnection
Scripts” in the <em>VIRTEL Connectivity Reference</em> manual).</div>
</div>
<p>For an input scenario, AND=(PROCESS-RESPONSE) is the default value
immediately after the connection.</p>
<div class="line-block">
<div class="line"><strong>AND=(DO-NOT-PROCESS-RESPONSE)</strong></div>
<div class="line"><em>(optional)</em> allows an input scenario to explicitly state that is does
not want to process the response from the application. After this
instruction, the input scenario will not see any messages from the
application, only input messages from the terminal.</div>
</div>
<p>For an input scenario, AND=(DO-NOT-PROCESS-RESPONSE) is the default
value once the connection stage is passed.</p>
<p><strong>MAXTIME=*nnn*</strong> <em>(optional)</em> specifies the maximum time, in
hundredths of a second, that the scenario will wait for a message from
the application. When this time expires, the APPLICATION-TIMEOUT flag
will be set (see “IF$ instruction” sur la page 185) and the scenario
will resume execution. If the MAXTIME parameter is not specified, then
the scenario will wait indefinitely, or until VIRTEL disconnects the
session when the timeout value of the entry point is exceeded.</p>
<p><strong>LASTMSG=YES</strong> <em>(optional)</em> requests disconnection after the
application responds to the <em>pfkey</em> sent.</p>
<p><strong>ASYNCH=YES</strong> <em>(optional)</em> indicate that the sending of the message to
the application is not to prevent the normal screen display.</p>
<p>When the ACTION$&nbsp;TO-APPLICATION instruction is executed in an output
scenario, or in an input scenario before the first message has been
delivered to the terminal, the specified function key is sent to the
application and the scenario is suspended awaiting the next <em>outbound</em>
message from the host application. When the next outbound message
arrives, the scenario is resumed starting with the next instruction
after the ACTION$&nbsp;TO-APPLICATION instruction. Subsequent outbound
messages will cause the scenario to resume execution again at the
instruction after the latest ACTION$&nbsp;TO-APPLICATION instruction until a
SCENARIO&nbsp;END instruction is executed. After a SCENARIO&nbsp;END instruction
is executed, subsequent outbound messages will once again cause the
output scenario to resume at the beginning.</p>
<p>When the ACTION$&nbsp;TO-APPLICATION instruction is executed in an input
scenario driven by an inbound message, the data in the inbound message
is sent to the application together with the 3270 AID key specified in
the KEY parameter. Subsequent inbound messages will cause the input
scenario to resume execution again at the instruction after the
ACTION$&nbsp;TO-APPLICATION instruction until a SCENARIO&nbsp;END instruction is
executed. After a SCENARIO&nbsp;END instruction is executed, subsequent
inbound messages will once again cause the input scenario to resume at
the beginning.</p>
<p>To allow an input scenario to see the responses from the host
application in addition to the input messages from the terminal, the
ACTION$&nbsp;TO-APPLICATION instruction contains an AND= parameter which
allows the scenario to explicitly request whether or not it expects to
process the application response message following the ACTION$
instruction.</p>
<p><strong>*Examples:*</strong></p>
<p>ACTION$ TO-APPLICATION,KEY=F3</p>
<p>Send F3 (PF3) to the application and wait for the next outbound message.
When the application responds, continue with the next instruction in the
scenario.</p>
<p>ACTION$ TO-APPLICATION,KEY=7D, *</p>
<p>AND=(WAIT,&#8217;Password ===&gt;&#8217;),MAXTIME=100</p>
<p>Send ENTER to the application and wait for the application to send a
message containing the string “Password ===&gt;”. If the requested message
does not arrive within 1 second, then set the APPLICATION-TIMEOUT flags
and continue the scenario.</p>
<p>ACTION$ TO-APPLICATION,KEY=7D, *</p>
<p>AND=(SCRIPT, *</p>
<p>&#8216;Signon to CICS&amp;&amp;/W&amp;&amp;*F34BE9&amp;&amp;/A&amp;&amp;/T&#8217;)</p>
<p>Send ENTER to the application, wait for the application to send a
message containing the string “Signon to CICS”, then send F3 to the
application, and send the screen image to the terminal. Note: the
ampersands are doubled to conform with assembler syntax requirements.</p>
<p>ACTION$ TO-APPLICATION,KEY=6D,LASTMSG=YES,ASYNCH=YES</p>
<p>Exit from the scenario (equivalent to IF$ ... SUCCESS), display the
screen as normal, send 6D (CLEAR) to the application, and when the
application responds, disconnect.</p>
<p>ACTION$ TO-APPLICATION,KEY=7D, *</p>
<p>AND=(PROCESS-RESPONSE)</p>
<p>The input scenario will resume at the next instruction when the next
message is received from the host application.</p>
<p>ACTION$ TO-APPLICATION,KEY=7D, *</p>
<p>AND=(DO-NOT-PROCESS-RESPONSE)</p>
<p>The input scenario will not be called again for messages received from
the host application. It will only be called for input messages.</p>
<p>ACTION$ TO-APPLICATION,KEY=7D, *</p>
<p>AND=(PROCESS-RESPONSE,&#8217;&amp;&amp;*F34BE9&amp;&amp;/A&#8217;)</p>
<p>This is the same as for PROCESS-RESPONSE but with execution of a script
in addition. Note: the ampersands are doubled to conform with assembler
syntax requirements.</p>
<p>ACTION$ TO-TERMINAL</p>
<p>Send the current contents of the screen image buffer to the terminal.</p>
<p>ACTION$ TO-TERMINAL</p>
<p>When the ACTION$&nbsp;TO-TERMINAL instruction is executed in an input
scenario, the contents of the screen image buffer are sent to the
terminal. The scenario may use instructions such as
COPY$&nbsp;VARIABLE-TO-SCREEN to place data in the screen image buffer before
issuing the ACTION$&nbsp;TO-TERMINAL instruction.</p>
</div>
<div class="section" id="case-instruction">
<h6>CASE$ instruction<a class="headerlink" href="#case-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction tests a value in a 3270 screen position, or a value in
a VIRTEL variable, and directs the subsequent processing flow according
to the value.</p>
<p>CASE$ (row,col,len),</p>
<p>(condition,&#8217;value&#8217;,process1),</p>
<p>(condition,&#8217;*varname&#8217;,process2),</p>
<p>(condition,STRING,&#8217;value&#8217;,process3),</p>
<p>(condition,VARIABLE,&#8217;varname&#8217;,process4),</p>
<p>...</p>
<p>ELSE=processx</p>
<p>CASE$ &#8216;varname&#8217;,</p>
<p>(condition,&#8217;value&#8217;,process1),</p>
<p>(condition,&#8217;*varname&#8217;,process2),</p>
<p>(condition,STRING,&#8217;value&#8217;,process3),</p>
<p>(condition,VARIABLE,&#8217;varname&#8217;,process4),</p>
<p>...</p>
<p>ELSE=processx</p>
<p><strong>*(row,col,len)*</strong> Specifies the row, column, and length of the 3270
screen data</p>
<p><strong>*varname*</strong> Specifies the name of a VIRTEL variable (must be placed in
quotes)</p>
<p><strong>*condition*</strong> Specifies whether the data tested must be equal (EQ),
not equal (NE), prefixed by (BEGIN), less than (LT), or greater than
(GT), or must contain (CONTAINS) the specified value</p>
<p><strong>*value*</strong> Specifies the value against which the data is tested (must
be placed in quotes)</p>
<p><strong>*process1,2,...*</strong> Specifies the address of the branch exit of the
script if the condition is satisfied. Permitted values are:</p>
<p>instruction label at which execution of the scenario is to continue.</p>
<p><strong>FAIL&nbsp;</strong>: reserved word indicating that the scenario is to be
terminated and the current message is to be discarded. The scenario will
be called again on receipt of the next outbound message from the
application.</p>
<p><strong>SUCCESS&nbsp;</strong>: reserved word indicating that the scenario is to be
terminated and the current message is to be presented to the user. This
is equivalent to branching to a SCENARIO&nbsp;END instruction.</p>
<p><strong>*processx*</strong> Specifies the address of the branch exit of the script if
none of the conditions is satisfied. Permitted values are identical to
<em>process1</em>.</p>
<p>Notes: Any number of (condition,&#8217;value&#8217;,process) parameters may be
specified, within the limits set by the assembler. Use assembler
conventions (non-blank in column 72 and continuation starting in column
16) to continue the statement over more than one line.</p>
</div>
<div class="section" id="convert-instruction">
<h6>CONVERT$ instruction<a class="headerlink" href="#convert-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction allows a scenario to translate a VIRTEL variable to or
from EBCDIC, or to convert a variable to upper or lower case.</p>
<p>CONVERT$ direction,VAR=&#8217;varname&#8217;,TABLE=&#8217;tabname&#8217;</p>
<div class="line-block">
<div class="line"><strong>*direction*</strong> specifies the translation requested. Possible values
are:</div>
<div class="line"><strong>ASCII-TO-EBCDIC</strong></div>
<div class="line"><strong>EBCDIC-TO-ASCII</strong></div>
<div class="line"><strong>UTF8-TO-EBCDIC</strong></div>
<div class="line"><strong>EBCDIC-TO-UTF8</strong></div>
<div class="line"><strong>EBCDIC-TO-UPPERCASE
EBCDIC-TO-LOWERCASE</strong></div>
</div>
<p><strong>*varname*</strong> is the name of a VIRTEL variable. The variable name must
be placed in quotes.</p>
<p><strong>*tabname*</strong> is the name of the translate table to be used for UTF-8
conversion. The possible values are given under the description of the
DEFUTF8 parameter of the VIRTCT. The table name must be placed in
quotes. If the TABLE parameter is not specified, then the table
specified by the DEFUTF8 parameter is used as a default. VIRTCT
parameters are described in the VIRTEL Installation Guide.</p>
</div>
<div class="section" id="copy-instruction">
<h6>COPY$ instruction<a class="headerlink" href="#copy-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction allows various copy operations within the context of a
scenario.</p>
<p>COPY$ FIELD-NAME-TO-VARIABLE</p>
<p>Copies the name of an HTTP input field into a VIRTEL variable.</p>
<p>COPY$ FIELD-NAME-TO-VARIABLE,SCREEN=(row,col),VAR=&#8217;name2&#8217;,</p>
<p>TYPE=type</p>
<p><strong>*row,col*</strong> starting row and column of the field on the screen.</p>
<p><strong>*name2*</strong> the name of a VIRTEL table variable. If the variable does
not exist, it will be created.</p>
<p><strong>*type*</strong> <em>(optional)</em> may indicate one of the following values:</p>
<p><strong>TYPE=REPLACE</strong> **
<a href="#id92"><span class="problematic" id="id93">**</span></a>indicates that the new value will replace the existing value of the
variable. If TYPE=REPLACE is not specified, and the variable already
exists, the new value will be appended to any existing values.</p>
<p>COPY$ INPUT-FILE-TO-VARIABLE</p>
<p>Copies the contents of a file into a VIRTEL variable. This instruction
can be used in an input scenario which processes an HTTP request or SMTP
input message having one or more attached files.</p>
<p>COPY$ INPUT-FILE-TO-VARIABLE,VAR=&#8217;varname&#8217;,FILE=&#8217;filename&#8217;</p>
<p><strong>*varname*</strong> the name of a VIRTEL table variable. If the variable does
not exist, it will be created. If the variable already exists, the new
value will be appended to any existing values. If this parameter is
omitted, the variable name $INFILE$ is used.</p>
<p><strong>*filename*</strong> the name of a file attached to the HTTP request or SMTP
message. If this parameter is omitted, the first attached file will be
read.</p>
<p>If the input request does not contain the requested file, the NOT-FOUND
condition will be raised. This condition can be tested by means of the
IF$ instruction.</p>
<p>COPY$ INPUT-TO-SCREEN</p>
<p>Copies the value of an HTTP query parameter to a given position on the
3270 screen.</p>
<p>COPY$ INPUT-TO-SCREEN,FIELD=&#8217;name1&#8217;,SCREEN=(row,col,len),</p>
<p>TYPE=type</p>
<p><strong>*name1*</strong> the name of an HTTP query parameter (see “VIRTEL URL
formats” sur la page 12)</p>
<p><strong>*row,col,len*</strong> row, column, and length of the destination field on
the screen.</p>
<p><strong>*type*</strong> <em>(optional)</em> may indicate one of the following values:</p>
<p><strong>TYPE=ERASE-FIELD</strong> **
<a href="#id94"><span class="problematic" id="id95">**</span></a>indicates that the destination field is cleared to nulls before
copying the data.</p>
<p>If the parameter <em>name1</em> is not present in the input request, the
NOT-FOUND condition will be raised. This condition can be tested by
means of the IF$ instruction.</p>
<p>If the destination row and column specify a protected field of the 3270
screen, the scenario terminates abnormally and message VIRS129E is
issued to the system console. If the destination field is unprotected
but the input value is too long for the field, the data will be silently
truncated.</p>
<p>COPY$ INPUT-TO-VARIABLE</p>
<p>Copies the value of an HTTP query parameter into a VIRTEL variable.</p>
<p>COPY$ INPUT-TO-VARIABLE,FIELD=&#8217;name1&#8217;,VAR=&#8217;name2&#8217;,</p>
<p>TYPE=type</p>
<p><strong>*name1*</strong> the name of an HTTP query parameter (see “VIRTEL URL
formats” sur la page 12)</p>
<p><strong>*name2*</strong> the name of a VIRTEL table variable. If the variable does
not exist, it will be created.</p>
<p><strong>*type*</strong> <em>(optional)</em> may indicate one of the following values:</p>
<p><strong>TYPE=OFFSET-LENGTH</strong> **
<a href="#id96"><span class="problematic" id="id97">**</span></a>indicates that the input parameter consists of two numeric values
separated by a comma. The first numeric value is converted to binary and
stored in the first 8 bytes of the result variable, and the second
numeric value is converted to binary and stored in the next 4 bytes of
the result variable. The 12-byte value thus produced is in the format
required by the OFFAREA parameter for the read-partial and write-append
functions of the VIRSVFIO service program.</p>
<p><strong>TYPE=REPLACE</strong> **
<a href="#id98"><span class="problematic" id="id99">**</span></a>indicates that the new value will replace the existing value of the
variable. If TYPE=REPLACE is not specified, and the variable already
exists, the new value will be appended to any existing values.</p>
<p>If the parameter <em>name1</em> is not present in the input request, the
NOT-FOUND condition will be raised. This condition can be tested by
means of the IF$ instruction.</p>
<p>COPY$ LIST-TO-VARIABLE</p>
<p>Copies a constant value to a variable.</p>
<p>COPY$ LIST-TO-VARIABLE,VAR=&#8217;varname&#8217;,</p>
<p>LIST=(STRING,&#8217;string&#8217;,VARIABLE,&#8217;fromvar&#8217;,</p>
<p>&#8216;string&#8217;,&#8217;*fromvar&#8217;),</p>
<p>TYPE=type</p>
<p><strong>*varname*</strong> the name of a VIRTEL table variable. If the variable does
not exist, it will be created.</p>
<p><strong>*string*</strong> characters to be copied into the variable <em>varname</em>.</p>
<p><strong>*fromvar*</strong> the name of a variable whose value is to be copied into
the variable <em>varname</em>.</p>
<p><strong>*type*</strong> <em>(optional)</em> may indicate one of the following values:</p>
<p><strong>TYPE=REPLACE</strong> **
<a href="#id100"><span class="problematic" id="id101">**</span></a>indicates that the new value will replace the existing value of the
variable. If TYPE=REPLACE is not specified, and the variable already
exists, the new value will be appended to any existing values.</p>
<p>COPY$ OUTPUT-FILE-TO-VARIABLE</p>
<p>Generates an output page from a page template, and copies the result
into a VIRTEL variable. Any VIRTEL tags within the page template are
processed as if the page were being generated as the response to an HTTP
request, but the generated page is placed in a variable instead of being
sent to the terminal.</p>
<p>COPY$ OUTPUT-FILE-TO-VARIABLE,FILE=&#8217;filename&#8217;,VAR=&#8217;varname&#8217;,</p>
<p>TYPE=type</p>
<p><strong>*filename*</strong> the name of the page template.</p>
<p><strong>*varname*</strong> the name of a VIRTEL table variable which will receive the
contents of the generated output page. If the variable does not exist,
it will be created. If the variable already exists, the new value will
be appended to any existing values.</p>
<p><strong>*type*</strong> <em>(optional)</em> indicates that the result variable has a special
format. The following values are possible:</p>
<p><a href="#id102"><span class="problematic" id="id103">**</span></a>TYPE=ASCII
<a href="#id104"><span class="problematic" id="id105">**</span></a>indicates that the result should be converted to ASCII (or UTF-8 if
the SET-OUTPUT-ENCODING-UTF-8 tag is present in the page template). This
is the default value if the HTTP request is in ASCII.</p>
<p><a href="#id106"><span class="problematic" id="id107">**</span></a>TYPE=EBCDIC
<a href="#id108"><span class="problematic" id="id109">**</span></a>indicates that the result should be converted to EBCDIC. This is the
default value if the HTTP request is in EBCDIC.</p>
<p><a href="#id110"><span class="problematic" id="id111">**</span></a>TYPE=LINEBUFFER
<a href="#id112"><span class="problematic" id="id113">**</span></a>indicates that the result should be converted to MakePDF “LINEBUF”
format for input to the VIRSVPDF service program. The page template
contains special tags (see “Generating PDF output” sur la page 79) which
are converted to the format required by MakePDF.</p>
<p>If the specified file does not exist in the current VIRTEL directory,
the NOT-FOUND condition will be raised. This condition can be tested by
means of the IF$ instruction.</p>
<p>COPY$ SCREEN-TO-VARIABLE</p>
<p>Copies a portion of the screen into a table variable.</p>
<p>COPY$ SCREEN-TO-VARIABLE,SCREEN=(row,col,len,ht),VAR=&#8217;name2&#8217;,</p>
<p>TYPE=type</p>
<p><strong>*row*</strong> starting row of the portion of the screen to copy.</p>
<p><strong>*col*</strong> starting column of the portion of the screen to copy.</p>
<p><strong>*len*</strong> width (in columns) of the portion of the screen to copy.</p>
<p><strong>*ht*</strong> height (in rows) of the portion of the screen to copy.</p>
<p><strong>*name2*</strong> the name of a VIRTEL table variable containing <em>ht</em> values,
each of length <em>len</em>. If the variable does not exist, it will be
created.</p>
<p><strong>*type*</strong> <em>(optional)</em> may indicate one of the following values:</p>
<p><strong>TYPE=REPLACE</strong> **
<a href="#id114"><span class="problematic" id="id115">**</span></a>indicates that the new value will replace the existing value of the
variable. If TYPE=REPLACE is not specified, and the variable already
exists, the new value will be appended to any existing values.</p>
<p>Note: the fourth sub-parameter (ht) of the SCREEN parameter is optional.
If the fourth sub-parameter is specified, then attributes and binary
zeroes will be replaced by blanks. To keep compatibility with existing
scenarios, the instruction will ignore attributes and binary zeroes if
the fourth SCREEN sub-parameter is NOT specified.</p>
<p>COPY$ SYSTEM-TO-VARIABLE</p>
<p>Copies a system information field into a table variable.</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(class,item),</p>
<p>VAR=&#8217;varname&#8217;,LENGTH=len,OFFSET=offset,</p>
<p>TYPE=type</p>
<p><strong>*varname*</strong> the name of a VIRTEL table variable into which the system
information will be copied.</p>
<p><strong>*class*</strong> the type of system information to be copied. The following
values may be specified for <em>class</em>:</p>
<ul>
<li><dl class="first docutils">
<dt><strong>HTTP-HEADER</strong> Information extracted from an HTTP header in the</dt>
<dd><p class="first last">incoming HTTP request is copied into the specified variable. When
HTTP-HEADER is specified, <em>item</em> represents one of the HTTP
headers listed below.</p>
</dd>
</dl>
</li>
<li><div class="first line-block">
<div class="line"><strong>TCT-HTTP-HEADER</strong>
| Information extracted from an HTTP header in the incoming HTTP
  request is copied into the specified variable. When
  TCT-HTTP-HEADER is specified, <em>item</em> represents one of the HTTP
  headers specified in the HTHEADR parameter in the VIRTCT (refer
  to “Parameters of the VIRTCT” in the <em>VIRTEL Installation
  Guide</em> for more information).</div>
</div>
</li>
<li><dl class="first docutils">
<dt><strong>NAME-OF</strong> Information about the VIRTEL environment is copied to the</dt>
<dd><p class="first last">table variable. When NAME-OF is specified, <em>item</em> represents the
name of a VIRTEL data item.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>NUMBER-OF</strong> A numeric value is copied to the table variable. When</dt>
<dd><p class="first last">NUMBER-OF is specified, <em>item</em> represents the name of a VIRTEL
numeric data item.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>VALUE-OF</strong> Information about the VIRTEL environment is copied to</dt>
<dd><p class="first last">the table variable. When VALUE-OF is specified, <em>item</em> represents
the name of a VIRTEL data item. VALUE-OF is synonymous with
NAME-OF.</p>
</dd>
</dl>
</li>
<li><div class="first line-block">
<div class="line"><strong>USER-SECURITY-PROFILE</strong>
| Information from the user’s RACF profile is copied to the table
  variable. When USER-SECURITY-PROFILE is specified, <em>item</em>
  represents the name of a field in the RACF user profile. The
  supported fields are listed below.</div>
</div>
</li>
</ul>
<p><strong>*item*</strong> When <em>class</em> is HTTP-HEADER, the following standard HTTP
headers, described in RFC2616, may be specified:</p>
<p><strong>ACCEPT</strong></p>
<p><strong>ACCEPT-LANGUAGE</strong></p>
<p><strong>CONNECTION</strong></p>
<p><strong>CONTENT-TYPE</strong></p>
<p><strong>IF-MODIFIED-SINCE</strong></p>
<p><strong>HOST</strong></p>
<p><strong>USER-AGENT</strong></p>
<p>In addition, the following non-standard HTTP headers, described in the
<em>IBM Tivoli Access Manager WebSEAL Administration Guide</em> manual, may be
specified:</p>
<p><strong>IV-USER</strong></p>
<p><strong>IV-USERL</strong></p>
<p><strong>IV-GROUPS</strong></p>
<p><strong>IV-CREDS</strong></p>
<p>Note that IV headers provide reliable user identification only when the
request comes from a trusted proxy. The proxy IP address can be
specified in the “Calling DTE” field of a rule attached to the HTTP
line. See the “Rules” chapter of the VIRTEL Configuration Reference
manual for further information.</p>
<p><strong>*item*</strong> When <em>class</em> is NAME-OF or VALUE-OF, the following VIRTEL
data items may be specified:</p>
<blockquote>
<div><p><strong>VIRTEL</strong> The VIRTEL APPLID specified in the VIRTCT</p>
<p><strong>RELAY</strong> The relay LU name used to connect to the host application</p>
<p><strong>PRINT-RELAY</strong> The relay LU name of the associated printer</p>
<p><strong>PSEUDO-TERMINAL</strong> The VIRTEL terminal name</p>
<p><strong>ENTRY-POINT</strong> The VIRTEL entry point name</p>
<p><strong>LINE-INTERNAL</strong> The internal name of the VIRTEL line</p>
<p><strong>LINE-EXTERNAL</strong> The external name of the VIRTEL line</p>
<p><strong>USER</strong> The user name, if signon has occurred</p>
<p><strong>PASSWORD</strong> The password entered during signon</p>
<p><strong>USER-IP-ADDRESS</strong> The IP address of the client terminal</p>
<div class="line-block">
<div class="line"><strong>SNA-STATUS</strong> The status of the host LU2 session:</div>
<div class="line"><strong>X</strong> input is inhibited</div>
<div class="line">blank input is allowed</div>
</div>
<p><strong>TRANSACTION-INTERNAL</strong> The internal name of the VIRTEL transaction</p>
<p><strong>TRANSACTION-EXTERNAL</strong> The external name of the VIRTEL transaction</p>
<p><strong>ROUTING-PARAMETER</strong> The value specified in the userdata field of
the URL or call packet</p>
<p><strong>URL</strong> The URL excluding the query string</p>
<p><strong>QUERY</strong> The query string from the URL</p>
<p><strong>PAGE</strong> The name of the original HTML page template specified in
the URL</p>
<p><strong>DIRECTORY</strong> The current VIRTEL directory name</p>
<p><strong>CHARACTER-SET</strong> The name of the current UTF-8 character set, or
the country code if the page is not in UTF-8 mode (see “EBCDIC
translation management” sur la page 69)</p>
<p><strong>DATE-TIME</strong> The current date and time (14 characters in the format
YYYYMMDDHHMMSS)</p>
<p><strong>VIRTEL-VERSION</strong> The VIRTEL version number</p>
<p><strong>*xxx*-SYMBOL</strong> The value of the system symbol <em>xxx</em> (only if
SYSPLUS=YES is specified in the VIRTCT). Example: <strong>SYSNAME-SYMBOL</strong></p>
</div></blockquote>
<p>When <em>class</em> is NUMBER-OF, the following VIRTEL numeric data items may
be specified:</p>
<blockquote>
<div><p><strong>SCREEN-COLUMNS</strong> The width of the current host 3270 screen</p>
<p><strong>SCREEN-LINES</strong> The depth of the current host 3270 screen</p>
</div></blockquote>
<p><strong>*item*</strong> When <em>class</em> is USER-SECURITY-PROFILE, the following RACF
field names may be specified:</p>
<blockquote>
<div><p><strong>USERID</strong> The signed-on user id</p>
<p><strong>GROUP</strong> The group to which the user belongs</p>
<p><strong>WANAME</strong> User name for SYSOUT</p>
<p><strong>WABLDG</strong> Building name for delivery</p>
<p><strong>WADEPT</strong> Department name for delivery</p>
<p><strong>WAROOM</strong> Room for delivery</p>
<p><strong>WAADDR1</strong> Address line 1</p>
<p><strong>WAADDR2</strong> Address line 2</p>
<p><strong>WAADDR3</strong> Address line 3</p>
<p><strong>WAADDR4</strong> Address line 4</p>
<p><strong>WAACCNT</strong> Account number</p>
</div></blockquote>
<p>Note: USER-SECURITY-PROFILE information is available only if the user
has signed on and SECUR=(RACROUTE,RACF) has been specified in the
VIRTCT. Otherwise null values are returned for all fields.</p>
<p><strong>*len*</strong> <em>(optional)</em> the variable will be padded or truncated to the
specified length. Alphanumeric data items are right-padded with blanks
or truncated on the right. Numeric items are left-padded with zeroes on
the left. The maximum length for a numeric item is 8. If the LENGTH
parameter is omitted, the length of the variable will be equal to the
length of the requested value.</p>
<p><strong>*offset*</strong> <em>(optional)</em> the starting offset within the data item from
which to extract the information to be placed in the variable. If
omitted, extraction starts from offset 0. This parameter is valid only
when <em>class</em> is USER-SECURITY-PROFILE.</p>
<p><strong>*type*</strong> <em>(optional)</em> may indicate one of the following values:</p>
<p><strong>TYPE=REPLACE</strong> **
<a href="#id116"><span class="problematic" id="id117">**</span></a>indicates that the new value will replace the existing value of the
variable. If TYPE=REPLACE is not specified, and the variable already
exists, the new value will be appended to any existing values.</p>
<p>Example of COPY$&nbsp;SYSTEM-TO-VARIABLE:</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(HTTP-HEADER,HOST), X</p>
<p>VAR=&#8217;HOST&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(HTTP-HEADER,USER-AGENT), X</p>
<p>VAR=&#8217;BROWSER&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,VIRTEL), X</p>
<p>VAR=&#8217;APPLID&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,LINE-INTERNAL), X</p>
<p>VAR=&#8217;LINEINT&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,PSEUDO-TERMINAL), X</p>
<p>VAR=&#8217;TERMID&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,RELAY), X</p>
<p>VAR=&#8217;LUNAME&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,ENTRY-POINT), X</p>
<p>VAR=&#8217;EPNAME&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,TRANSACTION-INTERNAL),X</p>
<p>VAR=&#8217;TRANINT&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,TRANSACTION-EXTERNAL),X</p>
<p>VAR=&#8217;TRANEXT&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,ROUTING-PARAMETER), X</p>
<p>VAR=&#8217;ROUTPARM&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,URL), X</p>
<p>VAR=&#8217;URL&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,QUERY), X</p>
<p>VAR=&#8217;QSTRING&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,PAGE), X</p>
<p>VAR=&#8217;PAGENAME&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,DIRECTORY), X</p>
<p>VAR=&#8217;DIRNAME&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,SNA-STATUS), X</p>
<p>VAR=&#8217;SNASTAT&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,USER-IP-ADDRESS), X</p>
<p>VAR=&#8217;CLIENT&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,CHARACTER-SET), X</p>
<p>VAR=&#8217;CHARSET&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,DATE-TIME), X</p>
<p>VAR=&#8217;DATETIME&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,VIRTEL-VERSION), X</p>
<p>VAR=&#8217;VERSION&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,SYSNAME-SYMBOL), X</p>
<p>VAR=&#8217;SYSNAME&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,SYSPLEX-SYMBOL), X</p>
<p>VAR=&#8217;SYSPLEX&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NUMBER-OF,SCREEN-COLUMNS), X</p>
<p>VAR=&#8217;COLS&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE,FIELD=(NUMBER-OF,SCREEN-LINES), X</p>
<p>VAR=&#8217;ROWS&#8217;</p>
<p>COPY$ SYSTEM-TO-VARIABLE, X</p>
<p>FIELD=(USER-SECURITY-PROFILE,WADEPT), X</p>
<p>VAR=&#8217;DEPT’</p>
<div class="line-block">
<div class="line">The following table shows a possible result of this example scenario
when used in conjunction with the URL</div>
<div class="line"><em>http://192.168.235.30:41001/w2h/WEB2AJAX.htm+Tso+model2?u=rxb&amp;g=sys1</em></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Variable</td>
<td>Value</td>
</tr>
<tr class="row-even"><td>HOST</td>
<td>&#8220;192.168.235.30:41001&#8221;</td>
</tr>
<tr class="row-odd"><td>BROWSER</td>
<td>&#8220;Mozilla/5.0 (Windows) Gecko/20070219 Firefox/2.0.0.2&#8221;</td>
</tr>
<tr class="row-even"><td>APPLID</td>
<td>&#8220;VIRTEL&#8221;</td>
</tr>
<tr class="row-odd"><td>LINEINT</td>
<td>&#8220;W-HTTP&#8221;</td>
</tr>
<tr class="row-even"><td>TERMID</td>
<td>&#8220;DEVTA003&#8221;</td>
</tr>
<tr class="row-odd"><td>LUNAME</td>
<td>&#8220;RHTVT000&#8221;</td>
</tr>
<tr class="row-even"><td>EPNAME</td>
<td>&#8220;WEB2HOST&#8221;</td>
</tr>
<tr class="row-odd"><td>TRANINT</td>
<td>&#8220;W2H-13&#8221;</td>
</tr>
<tr class="row-even"><td>TRANEXT</td>
<td>&#8220;Tso&#8221;</td>
</tr>
<tr class="row-odd"><td>ROUTPARM</td>
<td>&#8220;model2&#8221;</td>
</tr>
<tr class="row-even"><td>URL</td>
<td>&#8220;/w2h/WEB2AJAX.htm+Tso+model2&#8221;</td>
</tr>
<tr class="row-odd"><td>QSTRING</td>
<td>&#8220;u=rxb&amp;g=sys1&#8221;</td>
</tr>
<tr class="row-even"><td>PAGENAME</td>
<td>&#8220;WEB2AJAX.htm&#8221;</td>
</tr>
<tr class="row-odd"><td>DIRNAME</td>
<td>&#8220;W2H-DIR&#8221;</td>
</tr>
<tr class="row-even"><td>SNASTAT</td>
<td>&#8221; &#8220;</td>
</tr>
<tr class="row-odd"><td>CLIENT</td>
<td>&#8220;192.168.000.049&#8221;</td>
</tr>
<tr class="row-even"><td>CHARSET</td>
<td>&#8220;IBM1140&#8221;</td>
</tr>
<tr class="row-odd"><td>DATETIME</td>
<td>&#8220;20110731093522&#8221;</td>
</tr>
<tr class="row-even"><td>VERSION</td>
<td>&#8220;4.52 &#8220;</td>
</tr>
<tr class="row-odd"><td>SYSNAME</td>
<td>&#8220;MVSPROD1&#8221;</td>
</tr>
<tr class="row-even"><td>SYSPLEX</td>
<td>&#8220;PRODPLEX&#8221;</td>
</tr>
<tr class="row-odd"><td>COLS</td>
<td>&#8220;80&#8221;</td>
</tr>
<tr class="row-even"><td>ROWS</td>
<td>&#8220;24&#8221;</td>
</tr>
<tr class="row-odd"><td>DEPT</td>
<td>&#8220;SYSPROG&#8221;</td>
</tr>
</tbody>
</table>
<p>COPY$ VALUE-TO-VARIABLE</p>
<p>Copies a constant value to a variable.</p>
<p>COPY$ VALUE-TO-VARIABLE,VALUE=&#8217;string&#8217;,VAR=&#8217;name2&#8217;,</p>
<p>TYPE=type</p>
<p><strong>*string*</strong> characters to be copied into the variable <em>name2</em>.</p>
<p><strong>*name2*</strong> the name of a VIRTEL table variable. If the variable does
not exist, it will be created.</p>
<p><strong>*type*</strong> <em>(optional)</em> may indicate one of the following values:</p>
<p><strong>TYPE=REPLACE</strong> **
<a href="#id118"><span class="problematic" id="id119">**</span></a>indicates that the new value will replace the existing value of the
variable. If TYPE=REPLACE is not specified, and the variable already
exists, the new value will be appended to any existing values.</p>
<p>The COPY$&nbsp;VALUE-TO-VARIABLE instruction allows the DUP (X&#8216;1C&#8217;) and FM
(X&#8216;1E&#8217;) characters to be included in the value of a variable which can
subsequently be referenced by the COPY$&nbsp;VARIABLE-TO-SCREEN instruction.</p>
<p>The following example shows the instructions required to place FIELD
MARK (X&#8216;1E&#8217;) followed by W (X&#8217;E6&#8217;) at the cursor position and press
ENTER:</p>
<p>COPY$ VALUE-TO-VARIABLE,VAR=&#8217;FIELDMARK-W&#8217;,TYPE=REPLACE, *</p>
<p>VALUE=X&#8216;1EE6&#8217;</p>
<p>COPY$ VARIABLE-TO-SCREEN,VAR=&#8217;FIELDMARK-W’</p>
<p>ACTION$ TO-APPLICATION,KEY=7D</p>
<p>COPY$ VALUE-TO-SCREEN</p>
<p>Copies a constant value to a given position on the 3270 screen.</p>
<p>COPY$ VALUE-TO-SCREEN,VALUE=&#8217;string&#8217;,SCREEN=(row,col,len),</p>
<p>TYPE=type</p>
<p><strong>*string*</strong> characters to be copied to the screen.</p>
<p><strong>*row,col,len*</strong> row, column, and length of the destination field on
the screen.</p>
<p><strong>*type*</strong> <em>(optional)</em> may indicate one of the following values:</p>
<p><strong>TYPE=ERASE-FIELD</strong> **
<a href="#id120"><span class="problematic" id="id121">**</span></a>indicates that the destination field is cleared to nulls before
copying the data.</p>
<p>If the destination row and column specify a protected field of the 3270
screen, the scenario terminates abnormally and message VIRS129E is
issued to the system console. If the destination field is unprotected
but the string is too long for the field, the string will be silently
truncated.</p>
<p>COPY$ VARIABLE-TO-SCREEN</p>
<p>Copies the value of a variable to a given position on the 3270 screen.
In the case of a table variable, only the first value is copied.</p>
<p>COPY$ VARIABLE-TO-SCREEN,VAR=&#8217;name2&#8217;,SCREEN=(row,col,len),</p>
<p>TYPE=type</p>
<p><strong>*name2*</strong> the name of a VIRTEL variable.</p>
<p><strong>*row,col,len*</strong> row, column, and length of the destination field on
the screen. If the SCREEN parameter is not specified, the variable will
be copied to the current cursor position.</p>
<p><strong>*type*</strong> <em>(optional)</em> may indicate one of the following values:</p>
<p><strong>TYPE=ERASE-FIELD</strong> **
<a href="#id122"><span class="problematic" id="id123">**</span></a>indicates that the destination field is cleared to nulls before
copying the data.</p>
<p>If the variable <em>name2</em> does not exist, the NOT-FOUND condition will be
raised. This condition can be tested by means of the IF$ instruction.</p>
<p>If the destination row and column specify a protected field of the 3270
screen, the scenario terminates abnormally and message VIRS129E is
issued to the system console. If the destination field is unprotected
but the variable value is too long for the field, the data will be
silently truncated.</p>
<p>COPY$ VARIABLE-TO-SYSTEM</p>
<p>Copies the value of a variable to a VIRTEL system field. In the case of
a table variable, only the first value is copied.</p>
<p>COPY$ VARIABLE-TO-SYSTEM,VAR=&#8217;varname&#8217;,FIELD=(class,item)</p>
<p><strong>*varname*</strong> the name of a VIRTEL variable.</p>
<p><strong>*class*</strong> identifies the type of VIRTEL system field to be updated.
The following values may be specified:</p>
<div class="line-block">
<div class="line"><strong>NAME-OF</strong></div>
<div class="line">A VIRTEL data item is to be updated. When NAME-OF is specified, <em>item</em>
represents the name of a VIRTEL data item.</div>
</div>
<div class="line-block">
<div class="line"><strong>NUMBER-OF</strong></div>
<div class="line">A VIRTEL data item is to be updated. When NUMBER-OF is specified,
<em>item</em> represents the name of a VIRTEL numeric data item.</div>
</div>
<div class="line-block">
<div class="line"><strong>VALUE-OF</strong></div>
<div class="line">A VIRTEL data item is to be updated. When VALUE-OF is specified,
<em>item</em> represents the name of a VIRTEL data item. VALUE-OF is
synonymous with NAME-OF.</div>
</div>
<p><strong>*item*</strong> When <em>class</em> is NAME-OF or VALUE-OF, the following VIRTEL
data items may be specified:</p>
<div class="line-block">
<div class="line"><strong>DIRECTORY</strong></div>
<div class="line">Allows a scenario to specify the name of the VIRTEL directory The user
name which will appear in the VIRLOG entry for this transaction.</div>
</div>
<div class="line-block">
<div class="line"><strong>USER</strong></div>
<div class="line">Allows a scenario to specify the user name which will appear in the
VIRLOG entry for this transaction and which will become the value of
the system variable &amp;U (see “Connection/disconnection scripts” in the
<em>VIRTEL Connectivity Guide</em>).</div>
</div>
<div class="line-block">
<div class="line"><strong>PASSWORD</strong></div>
<div class="line">Allows a scenario to specify the password which will become the value
of the system variable &amp;P (see “Connection/disconnection scripts” in
the <em>VIRTEL Connectivity Guide</em>).</div>
</div>
<div class="line-block">
<div class="line"><strong>LOGMODE</strong></div>
<div class="line">The name of the logmode to be used for the VTAM session with the host
application. The logmode can be set in an Identification Scenario. It
overrides the logmode specified in the transaction or terminal
definition.</div>
</div>
<div class="line-block">
<div class="line"><strong>ROUTING-PARAMETER</strong></div>
<div class="line">Allows an Identification Scenario to override the value of the routing
parameter specified in the userdata field of the URL (see “VIRTEL URL
formats” sur la page 16).</div>
</div>
<p>When <em>class</em> is NUMBER-OF, the following VIRTEL data items may be
specified:</p>
<div class="line-block">
<div class="line"><strong>SCREEN-COLUMNS</strong></div>
<div class="line">The alternate width (number of columns) of the 3270 screen</div>
</div>
<div class="line-block">
<div class="line"><strong>SCREEN-LINES</strong></div>
<div class="line">The alternate depth (number of rows) of the 3270 screen</div>
</div>
<p>SCREEN-COLUMNS and SCREEN-LINES can be set in an Identification
Scenario. These parameters allow the scenario to specify the desired
screen size when a dynamic logmode such as D4A32XX3 is used and the host
application places the 3270 session in alternate mode using the Erase
Write Alternate command. This command has no effect on the primary
screen size which is always 24 rows by 80 columns.</p>
</div>
<div class="section" id="debug-instruction">
<h6>DEBUG$ instruction<a class="headerlink" href="#debug-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction allows a scenario to activate various debugging
functions.</p>
<p>DEBUG$ [NO]TRACE,LINE|TERMINAL|SCENARIO,</p>
<p>WHEN=(TRANSACTION-NAME-STARTS-WITH,&#8217;prefix&#8217;)|ALWAYS</p>
<p>DEBUG$ SNAP[,TERMINAL],</p>
<p>WHEN=(TRANSACTION-NAME-STARTS-WITH,&#8217;prefix&#8217;)|ALWAYS</p>
<p><strong>*TRACE,LINE*</strong> or <strong>*NOTRACE,LINE</strong>
<a href="#id124"><span class="problematic" id="id125">*</span></a>Starts or stops a trace on the current line. The trace is written to
the VIRTRACE file.</p>
<div class="line-block">
<div class="line"><strong>*TRACE,TERMINAL*</strong> or <strong>*NOTRACE,TERMINAL*</strong></div>
<div class="line">Starts or stops a trace on the current terminal. The trace is written
to the VIRTRACE file.</div>
</div>
<div class="line-block">
<div class="line"><strong>*TRACE,SCENARIO*</strong> or <strong>*NOTRACE,SCENARIO*</strong></div>
<div class="line">Starts or stops a trace on the scenario. The trace is downloadable by
means of the CREATE-VARIABLE-IF TRACING-SCENARIO tag (see page 63)
intended for use by Virtel Studio.</div>
</div>
<p><strong>*SNAP*</strong> Generates a snapshot of the VIRTEL internal trace table in
the SYSPRINT file (same as the command F VIRTEL,SNAP). SNAP is described
in the “Audit and Performance” chapter of the <em>VIRTEL Messages and
Operations Guide</em>.</p>
<div class="line-block">
<div class="line"><strong>*SNAP,TERMINAL*</strong></div>
<div class="line">Generates a snapshot including terminal information (same as the
command F VIRTEL,SNAP,T=<em>termid</em> where <em>termid</em> is the current
terminal name).</div>
</div>
<div class="line-block">
<div class="line"><strong>*WHEN=ALWAYS*</strong></div>
<div class="line">The DEBUG$ instruction is executed unconditionally. This is the
default.</div>
</div>
<div class="line-block">
<div class="line"><strong>*WHEN=(TRANSACTION-NAME-STARTS-WITH,&#8217;prefix&#8217;)*</strong></div>
<div class="line">The DEBUG$ instruction is executed only if the external name of the
transaction being used begins with the characters specified by the
string <em>prefix</em>.</div>
</div>
</div>
<div class="section" id="declare-instruction">
<h6>DECLARE$ instruction<a class="headerlink" href="#declare-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction defines a portion of the screen as a clickable
hyperlink. The hyperlink can invoke either a 3270 key (ENTER or PFnn), a
JavaScript procedure, or an external URL. The generation of the
hyperlink can optionally be conditional on the presence or absence of a
particular value at the 3270 screen position. In any case, the hyperlink
is generated only if the specified screen position is non-blank.</p>
<p>DECLARE$ (row,col,len,&#8217;value&#8217;,Condition),P1,P2,P3,TO=P4</p>
<p><strong>*row*</strong> Specifies the row position of the hyperlink</p>
<p><strong>*col*</strong> Specifies the column position of the hyperlink</p>
<p><strong>*len*</strong> Specifies the length of the hyperlink</p>
<p><strong>*value*</strong> Optional, this parameter specifies the value of the data
tested at the specified screen position. Must be put in quotes</p>
<p><strong>*Condition*</strong> Optional, this parameter determines the type of
condition applicable to value</p>
<p><strong>EQ</strong> : Equality (value by default).</p>
<p><strong>NE</strong> : Inequality.</p>
<p><strong>*P1*</strong> Specifies the type of processing applicable. The permissible
values are:</p>
<p><a href="#id126"><span class="problematic" id="id127">**</span></a>AS-PFKEY
<a href="#id128"><span class="problematic" id="id129">**</span></a>Indicates that the indicated portion of the screen is to be
interpreted as a function key hyperlink. The value of the function key
(ENTER, PF1, etc) can be specified by parameter P2. If P2 is not
specified, then the data at the indicated screen position is interpreted
as the name of the function key. The values allowable as function key
names are the same as those for pfkField (see Figure 1‑11 sur la page
48)</p>
<p><a href="#id130"><span class="problematic" id="id131">**</span></a>AS-PARAMETER
<a href="#id132"><span class="problematic" id="id133">**</span></a>Indicates that the indicated portion of the screen is to be treated
as a hyperlink which calls a JavaScript function. The data at the
indicated screen position is passed as a parameter to the JavaScript
function. The name of the JavaScript function is specified in the TO
parameter of the $DECLARE instruction. See “JavaScript functions” sur la
page 178 for further details.</p>
<p><a href="#id134"><span class="problematic" id="id135">**</span></a>AS-HREF
<a href="#id136"><span class="problematic" id="id137">**</span></a>Indicates that the indicated portion of the screen is to be treated
as a hyperlink which invokes the URL specified in the TO parameter of
the $DECLARE instruction. The data at the indicated screen position is
appended to the URL, followed by the contents of the P2 parameter of the
$DECLARE instruction, if specified.</p>
<p><strong>*P2*</strong> <em>(optional)</em> Function parameter referenced by P1.</p>
<p><strong>*P3*</strong> <em>(optional)</em> Text to be displayed in the status bar of the
browser when the mouse pointer is over the indicated screen position.</p>
<p><strong>*P4*</strong> Name of JavaScript function (for AS-PARAMETER) or URL (for
AS-HREF).</p>
<p>Note that, in conformance with assembler syntax, quotes and ampersands
in the URL must be specified as double quotes and double ampersands.</p>
<p>JavaScript functions</p>
<p>For the AS-PARAMETER form of the $DECLARE instruction, the TO parameter
specifies the name of a JavaScript function which will be called when
the user clicks on the field. The function name is case-sensitive. The
following parameters are passed to the JavaScript function:</p>
<p><strong>*Parameter 1*</strong> an internally generated field name</p>
<p><strong>*Parameter 2*</strong> the data at the indicated screen position</p>
<p><strong>*Parameter 3*</strong> the contents of the P2 parameter of the $DECLARE
instruction</p>
<p>The JavaScript function itself must be defined in the HTML template
page, or in an included page. The following standard functions are
provided in the page <em>js01.js</em> delivered with VIRTEL in the W2H-DIR
directory:</p>
<p><strong>VClick</strong> Moves the cursor to the start of the clickable area and sends
the indicated function key (P2 parameter) to the host application</p>
<p><strong>VClick2</strong> Copies the contents of the clickable area to the field
containing the cursor and sends the indicated function key (P2
parameter) to the host application</p>
<p><strong>VClick3</strong> Copies the contents of the clickable area to the following
input field and sends the indicated function key (P2 parameter) to the
host application</p>
<p>Examples</p>
<p>DECLARE$ (23,19,04),AS-PFKEY</p>
<p>Row 23 column 19 length 4 becomes a clickable field. The contents of the
field are treated as the name of a PF key. For example, if the field
contains “PF12” then clicking on this field is equivalent to pressing
the 3270 key PF12.</p>
<p>DECLARE$ (14,17,03),AS-PFKEY,&#8217;PA2&#8217;</p>
<p>Row 14 column 17 length 3 becomes a clickable field. When clicked it is
the equivalent of pressing the 3270 key PA2.</p>
<p>DECLARE$ (24,02,04,&#8217;****&#8217;,NE),AS-PFKEY</p>
<p>Row 24 column 2 length 4 becomes a clickable field, unless it contains
asterisks. The contents of the field are treated as the name of a PF
key.</p>
<p>DECLARE$ (20,02,06),AS-PARAMETER,&#8217;PF12&#8217;,TO=VClick</p>
<p>Row 20 column 2 length 6 becomes a clickable field. It calls the
JavaScript function <em>VClick(&#8216;Vxxxxxxx&#8217;,&#8217;cccccc&#8217;,&#8217;PF12&#8217;)</em> where
<em>Vxxxxxxx</em> is an internally generated field name, <em>cccccc</em> is the
contents of the field, and <em>PF12</em> is a constant specified in the
DECLARE$ instruction.</p>
<p>DECLARE$ (04,09,17),AS-HREF,&#8217;&amp;&amp;hl=fr&#8217;, X</p>
<p>TO=&#8217;<a class="reference external" href="http://www.google.com/search?q=">http://www.google.com/search?q=</a>&#8216;</p>
<div class="line-block">
<div class="line">Row 4 column 9 length 17 becomes a clickable field, hyperlinked to the
URL: http//www.google.com/search?=ccc...ccc&amp;hl=fr</div>
<div class="line">(where ccc...ccc is replaced by the contents of the clickable field)</div>
</div>
</div>
<div class="section" id="error-instruction">
<h6>ERROR$ instruction<a class="headerlink" href="#error-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction returns an error code to the calling program. When this
instruction is used, the return code in the HTTP response will be <strong>*400
Bad Request*</strong> instead of <strong>*200 Ok.*</strong></p>
<p>ERROR$ value [,&#8217;string1&#8217;,&#8217;string2&#8217;,...]</p>
<p><strong>*value*</strong> Specifies the error code (decimal 0 to 255). If the error
code is non-zero, a message is issued to the console and the scenario
returns the error code to the calling program. If the error code is
zero, a message is issued to the console and the scenario continues.</p>
<p><strong>*&#8217;string1&#8217; [,&#8217;string2&#8217;, …]</strong>
(optional)* one or more strings of text to be concatenated together and
displayed as a message on the console. If a string begins with an
asterisk it represents the name of a VIRTEL variable whose contents is
to be included in the message. The number of quoted strings is not
limited, but the message itself cannot be larger than 252 characters.</p>
</div>
<div class="section" id="field-instruction">
<h6>FIELD$ instruction<a class="headerlink" href="#field-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction defines the position and the length of the 3270
selection involved, as well as the set of presentation rules.</p>
<p>FIELD$ (row,col,len),operation,param-1,param-2,...,param-N</p>
<p><strong>*row*</strong> Specifies the row position of the field</p>
<p><strong>*col*</strong> Specifies the column position of the field</p>
<p><strong>*len*</strong> Specifies the length of the field</p>
<p><strong>*operation*</strong> Defines the presentation rule. The permissible values
are:</p>
<p><a href="#id138"><span class="problematic" id="id139">**</span></a>DEFINE-CHOICE
<a href="#id140"><span class="problematic" id="id141">**</span></a>Adds a value of type SELECT</p>
<p><a href="#id142"><span class="problematic" id="id143">**</span></a>DEFINE-VARIABLE-CHOICE
<a href="#id144"><span class="problematic" id="id145">**</span></a>Adds multiple values of type SELECT</p>
<p><a href="#id146"><span class="problematic" id="id147">**</span></a>IS-BINARY-CHOICE
<a href="#id148"><span class="problematic" id="id149">**</span></a>Defines a field as a checkbox</p>
<p><a href="#id150"><span class="problematic" id="id151">**</span></a>HIDE
<a href="#id152"><span class="problematic" id="id153">**</span></a>Defines a field as non-display</p>
<p><strong>*param-N*</strong> Depends on the contents of the operation.</p>
<p>The FIELD$ instruction only operates on input fields</p>
<p>FIELD$ DEFINE-CHOICE</p>
<p>Generates a SELECT type entry field for the 3270 field concerned. This
instruction requires a VAL parameter and optionally a SHOW parameter.</p>
<p>FIELD$ (row,col,len),DEFINE-CHOICE,VAL=&#8217;value&#8217;,SHOW=&#8217;label&#8217;</p>
<p>The VAL parameter generates an OPTION value for the SELECT field.</p>
<p>The optional SHOW parameter allows the specification of the text
displayed in the SELECT field for the given value. If the SHOW parameter
is omitted, the text displayed is identical to the value.</p>
<p>FIELD$ DEFINE-VARIABLE-CHOICE</p>
<p>Generates a list of SELECT entries for the 3270 field concerned. This
instruction requires a VAL parameter.</p>
<p>FIELD$ (row,col,len),DEFINE-VARIABLE-CHOICE,VAL=varname</p>
<p>The VAL parameter of a DEFINE-VARIABLE-CHOICE operation specifies the
name of a table variable which contains the OPTION values for the SELECT
statement generated for the 3270 field concerned. These values must be
supplied by the 3270 application by means of a structured field type
FAE5 or FAE6, or by means of the HOST4WEB command S VARIABLE. Structured
fields are described in the VIRTEL Programming Interface documentation
sur la page 275. HOST4WEB commands are described in the VIRTEL
Programming Interface documentation sur la page 287</p>
<p>FIELD$ IS-BINARY-CHOICE</p>
<p>Generates an INPUT TYPE=CHECKBOX field for the 3270 field concerned.
This is useful for 3270 fields which can take two values: one value
representing a “checked” box and the other value representing an
“unchecked” box. This instruction requires a VAL parameter and
optionally a NOTVAL parameter.</p>
<p>FIELD$ (row,col,len),IS-BINARY-CHOICE,VAL=&#8217;value&#8217;,NOTVAL=&#8217;value&#8217;</p>
<p>For output messages, the box will be displayed as checked if the value
of the 3270 field matches the VAL parameter, otherwise it will be
displayed as unchecked. For input messages, the VAL parameter specifies
the value which will be transmitted to the application in the 3270 field
when the box is checked, and the NOTVAL parameter specifies the value to
be transmitted to the application if the box is unchecked. If the NOTVAL
parameter is omitted then an empty field will be transmitted to the
application if the box is unchecked.</p>
<p>FIELD$ HIDE</p>
<p>Generates an INPUT TYPE=HIDDEN field for the 3270 field concerned. This
instruction takes no additional parameters.</p>
<p>FIELD$ (row,col,len),HIDE</p>
</div>
<div class="section" id="filter-instruction">
<h6>FILTER$ instruction<a class="headerlink" href="#filter-instruction" title="Permalink to this headline">¶</a></h6>
<p>FILTER$ VARIABLE-TO-VARIABLE</p>
<p>The FILTER$&nbsp;VARIABLE-TO-VARIABLE instruction creates or adds values to a
variable from another variable according to a list of conditions,
similar to the conditions in a CASE$ instruction.</p>
<p>FILTER$ VARIABLE-TO-VARIABLE,</p>
<p>FROM=&#8217;varname1&#8217;,TO=&#8217;varname2&#8217;,</p>
<p>(WHEN,&#8217;YYYY&#8217;,THEN,&#8217;aaa&#8217;),</p>
<p>(BEGIN,&#8217;XXXX&#8217;,THEN,&#8217;bbb&#8217;,),</p>
<p>(CONTAINS,&#8217;ZZZZ&#8217;,THEN,IGNORE),</p>
<p>(OTHERWISE,KEEP)</p>
<p><strong>*FROM,TO*</strong> <em>varname1</em> is the name of the VIRTEL variable whose values
are to be inspected, and <em>varname2</em> is the name of the VIRTEL variable
to which values are to be added. The variable <em>varname2</em> will be created
if it does not exist.</p>
<p><strong>*WHEN,THEN*</strong> when a value ‘YYYY’ is found in variable <em>varname1</em>,
then the value ‘aaa’ will be added to <em>varname2</em>.</p>
<p><strong>*BEGIN,THEN*</strong> when a value beginning with ‘XXXX’ is found in
<em>varname1,</em> then the value ‘bbb’ will be added to <em>varname2</em>.</p>
<p><strong>*CONTAINS,THEN,IGNORE*</strong> when a value containing ‘ZZZZ’ is found in
<em>varname1,</em> then no value will be added to <em>varname2</em>.</p>
<p><strong>*OTHERWISE,KEEP*</strong> the default action, if none of the preceding
conditions is met, is to copy the value from <em>varname1</em> to a new value
in <em>varname2</em>.</p>
</div>
<div class="section" id="goto-instruction">
<h6>GOTO$ instruction<a class="headerlink" href="#goto-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction directs the subsequent processing flow to a specified
label.</p>
<p>GOTO$ label</p>
<p><strong>*label*</strong> Specifies the instruction label at which execution of the
scenario is to continue.</p>
</div>
<div class="section" id="if-instruction">
<h6>IF$ instruction<a class="headerlink" href="#if-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction enables the testing of the presence of a value in a
3270 screen, or a value in a VIRTEL variable, or a condition set by a
previous instruction, and directs the subsequent processing flow.</p>
<p>IF$ (row,col,len),EQ=&#8217;value&#8217;,THEN=process1,ELSE=process2</p>
<p>IF$ VARIABLE,&#8217;varname&#8217;,EQ=&#8217;value&#8217;,THEN=process1,ELSE=process2</p>
<p>IF$ EXISTS-VARIABLE,&#8217;varname&#8217;,THEN=process1,ELSE=process2</p>
<p>IF$ NOT-EXISTS-VARIABLE,&#8217;varname&#8217;,THEN=process1,ELSE=process2</p>
<p>IF$ APPLICATION-TIMEOUT,THEN=process1,ELSE=process2</p>
<p>IF$ CURSOR,THEN=process1,ELSE=process2</p>
<p>IF$ FIRST-PASS,THEN=process1,ELSE=process2</p>
<p>IF$ IND$FILE-TIMEOUT,THEN=process1,ELSE=process2</p>
<p>IF$ NOT-FOUND,THEN=process1,ELSE=process2</p>
<p>IF$ SCREEN-IS-BLANK,THEN=process1,ELSE=process2</p>
<p>IF$ SCREEN-IS-UNFORMATTED,THEN=process1,ELSE=process2</p>
<p>IF$ SESSION-SWITCH,THEN=process1,ELSE=process2</p>
<p><strong>*row,col,len*</strong> Specifies the position (row, column) and length of the
data tested</p>
<p><strong>*value*</strong> Specifies the value of the data tested (must be placed in
quotes)</p>
<p><strong>VARIABLE</strong> Specifies that the value of a VIRTEL variable is to be
tested.</p>
<div class="line-block">
<div class="line"><strong>EXISTS-VARIABLE</strong></div>
<div class="line">Tests if the specified variable exists.</div>
</div>
<div class="line-block">
<div class="line"><strong>NOT-EXISTS-VARIABLE</strong></div>
<div class="line">Tests if the specified variable does not exist.</div>
</div>
<p><strong>*varname*</strong> Specifies the name of the VIRTEL variable to be tested
(must be placed in quotes)</p>
<p><a href="#id154"><span class="problematic" id="id155">**</span></a>APPLICATION-TIMEOUT
<a href="#id156"><span class="problematic" id="id157">**</span></a>Tests whether a previous ACTION$ TO-APPLICATION instruction with a
MAXTIME parameter ended in timeout.</p>
<p><strong>CURSOR</strong> Tests whether the application has turned on the cursor. This
option is valid for both 3270 applications and videotex servers.</p>
<p><strong>FIRST-PASS</strong> Tests whether the scenario is entered for the first time
after connecting to the VTAM application. This condition is no longer
true after the scenario has exited for the first time, for example when
waiting for the next message. If both an INPUT and an OUTPUT scenario
are present, the FIRST-PASS condition is true the first time the INPUT
scenario is run, and the first time the OUTPUT scenario is run as well.
This condition is always true for other types of scenario.</p>
<p><a href="#id158"><span class="problematic" id="id159">**</span></a>IND$FILE-TIMEOUT
<a href="#id160"><span class="problematic" id="id161">**</span></a>Tests whether, having received the 3270 messages which precede an
IND$FILE transfer, the transfer itself has still not started after a
delay of one second. This condition indicates an IND$FILE error and is
usually accompanied by an error message on the TSO screen.</p>
<p><strong>NOT-FOUND</strong> Tests the condition code set by the previous COPY$
instruction.</p>
<div class="line-block">
<div class="line"><strong>SCREEN-IS-BLANK</strong></div>
<div class="line">Tests whether the 3270 screen is completely blank. This condition is
true if the screen contains only blanks, nulls, and attribute
characters.</div>
</div>
<div class="line-block">
<div class="line"><strong>SCREEN-IS-UNFORMATTED</strong></div>
<div class="line">Tests whether the 3270 screen is unformatted. This condition is true
if the screen contains no attribute characters.</div>
</div>
<div class="line-block">
<div class="line"><strong>SESSION-SWITCH</strong></div>
<div class="line">Tests whether the scenario is entered for a VTAM application which was
already connected to this terminal. This condition is useful in VIRTEL
multisession scenarios which must reestablish the environment before
starting the transaction requested by the user. This condition remains
true until the end of this activation of the scenario (for example
until the scenario is reused for another session).</div>
</div>
<p><strong>*process1*</strong> Specifies the address of the branch exit of the script if
the condition is satisfied. Permitted values are:</p>
<p>instruction label at which execution of the scenario is to continue.</p>
<p><strong>FAIL&nbsp;</strong>: reserved word indicating that the scenario is to be
terminated and the current message is to be discarded. The scenario will
be called again on receipt of the next outbound message from the
application.</p>
<p><strong>SUCCESS&nbsp;</strong>: reserved word indicating that the scenario is to be
terminated and the current message is to be presented to the user. This
is equivalent to branching to a SCENARIO&nbsp;END instruction.</p>
<p><strong>*process2*</strong> Specifies the address of the branch exit of the script if
the condition is not satisfied. Permitted values are identical to
<em>process1</em>.</p>
</div>
<div class="section" id="indscen-instruction">
<h6>INDSCEN$ instruction<a class="headerlink" href="#indscen-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction allows a scenario to enable the IND$FILE file transfer
function. The INDSCEN$ macro instruction must be included in both the
input scenario and the output scenario.</p>
<p>INDSCEN$ HOST=type</p>
<p><strong>*type*</strong> Specifies the type of host system running the IND$FILE
program. <strong>TSO</strong> is the only allowed value. The default is <strong>TSO</strong>.</p>
</div>
<div class="section" id="map-instruction">
<h6>MAP$ instruction<a class="headerlink" href="#map-instruction" title="Permalink to this headline">¶</a></h6>
<p>The MAP$ instruction defines the format of a flat-format data area known
as a “commarea”, and describes how VIRTEL converts XML or Query input
data to commarea format. The MAP$ instruction may also be used in
conjunction with the TOVAR$ instruction to convert an output commarea to
VIRTEL variables, which can be used with an appropriate template to
generate XML or other formats.</p>
<p>When the MAP$ instruction is used to convert input data to commarea
format, the input data may be supplied either as XML, or as named
parameters in a format known as “Query” data. In both cases, the input
data may be attached to an inbound HTTP request (GET or POST request),
or it may be supplied in a VIRTEL variable. The result of the parsing
process is a commarea which is suitable for processing by an application
program (typically a COBOL program running under CICS). The commarea is
written into a VIRTEL variable so that it can be passed to the
application program by means of the VIRTEL transaction script language.</p>
<p>Conversion of input data to commarea format (“input-to-commarea”
conversion) is performed by means of an INITIAL scenario. The scenario
begins with a group of MAP$ instructions (MAP$&nbsp;BEGIN, MAP$&nbsp;END,
MAP$&nbsp;AREA, and MAP$&nbsp;AREA-ATTRIBUTE) which define the format of the
commarea and its relationship to the XML tags or the Query parameters.
The scenario continues with a MAP$&nbsp;FROM-FIELD, MAP$&nbsp;FROM-INPUT,
MAP$&nbsp;FROM-VARIABLE instruction which defines the source of the XML or
Query data. Finally, the scenario ends with a MAP$&nbsp;TO-VARIABLE
instruction which names the VIRTEL variable into which the commarea is
to be stored. An example scenario is presented in the section “Examples
of presentation scripts” sur la page 227.</p>
<p>Conversion from commarea format to VIRTEL variables
(“commarea-to-output” conversion) may be performed by means of an
INITIAL scenario or an OUTPUT scenario. The scenario begins with a
description of the commarea format (MAP$&nbsp;BEGIN, MAP$&nbsp;END, MAP$&nbsp;AREA, and
MAP$&nbsp;AREA-ATTRIBUTE), and continues with a TOVAR$ instruction which
defines the source of the commarea. See the description of the TOVAR$
instruction sur la page 216 for further details of commarea-to-output
conversion.</p>
<p>MAP$ ABEND</p>
<p>The MAP$&nbsp;ABEND instruction is intended for diagnostic purposes only.
When VIRTEL encounters a MAP$&nbsp;ABEND instruction while processing a
commarea with the MAP$&nbsp;TO-VARIABLE or TOVAR$ instructions, the scenario
ends and a SNAP dump is produced. The VIRTEL SNAP is described in the
“Audit and Performance” chapter of the <em>VIRTEL Messages and Operations
Guide.</em></p>
<p>MAP$ ABEND,WITH=&#8217;text&#8217;</p>
<p><strong>*text*</strong> A free-format description which will be printed in the SNAP
at the time of the abend.</p>
<p>MAP$ ABEND-AT</p>
<p>The MAP$&nbsp;ABEND-AT instruction is similar to MAP$&nbsp;ABEND except that it
produces a SNAP only after it has been executed the number of times
indicated by the OCCURS parameter.</p>
<p>MAP$ ABEND-AT,OCCURS=n,WITH=&#8217;text&#8217;</p>
<p><strong>*text*</strong> A free-format description which will be printed in the SNAP
at the time of the abend.</p>
<p><strong>*n*</strong> The SNAP will be produced after the MAP$&nbsp;ABEND-AT instruction
has been executed <em>n</em> times.</p>
<p>MAP$ AREA</p>
<p>The MAP$&nbsp;AREA instruction defines a field within a commarea. The
MAP$&nbsp;AREA instruction must be enclosed by a pair of MAP$&nbsp;BEGIN and
MAP$&nbsp;END instructions which define the start and end of the commarea.</p>
<p>MAP$ AREA,WITH=&#8217;name&#8217;,</p>
<p>LENGTH=nnn,TYPE=type,FORMAT=(&#8216;pattern&#8217;,char)</p>
<p><strong>*name*</strong> For input-to-commarea conversion, this is the name of the XML
tag or Query parameter which identifies the input data item. For XML
input, the WITH parameter may be omitted, and the tag at the current
location in the input data is used.</p>
<p>For commarea-to-output conversion, this is the name of the VIRTEL
variable which will be generated.</p>
<p><strong>*nnn*</strong> Specifies the fixed length of the field in the commarea.</p>
<div class="line-block">
<div class="line"><strong>*type X*</strong> indicates an alphanumeric field</div>
<div class="line"><strong>*9*</strong> indicates a numeric field</div>
<div class="line"><strong>*S9*</strong> indicates a numeric field with sign overpunch</div>
<div class="line"><strong>*ONLY9*</strong> indicates a numeric field; any non-numeric characters in
the input data item are ignored when copied to the commarea</div>
<div class="line"><strong>*(ONLY9,LEFT-ALIGNED)*</strong> indicates that the numeric value is to be
left-aligned in the field in the commarea</div>
</div>
<p><strong>*BASE64*</strong> indicates that the data is encoded in Base64 format in the
XML datastream</p>
<div class="line-block">
<div class="line"><strong>*OFFSET-LENGTH*</strong> **
<em>OFFSET-LENGTH-TEXT**</em></div>
<div class="line"><strong>*OFFSET-LENGTH-BINARY*</strong></div>
<div class="line">for input-to-commarea conversion, calculates the offset and length of
the XML data element identified by the WITH parameter. The offset is
calculated relative to the start of the XML datastream.</div>
<div class="line">For OFFSET-LENGTH-TEXT the offset and length values are stored in the
result commarea as two decimal numbers separated by a comma.
OFFSET-LENGTH is a synonym for OFFSET-LENGTH-TEXT.</div>
<div class="line">For OFFSET-LENGTH-BINARY the offset and length are stored as binary
values (8 bytes and 4 bytes respectively) in the result commarea. When
used in conjunction with the TO-VARIABLE or TO-VARIABLE-ONLY
parameters described below, the 12-byte value thus produced can
subsequently be passed to the VIRSVFIO service program as the OFFAREA
parameter for the read-partial and write-append functions.</div>
</div>
<p><strong>*pattern,char*</strong> Specifies an editing pattern to be applied when the
field is processed during commarea-to-output conversion. Character
positions in <em>pattern</em> which contain <em>char</em> represent variable
characters to be obtained from the field in the commarea, other
characters in <em>pattern</em> represent constants. For example, if
FORMAT=(&#8216;9999-99-99&#8217;,9) is specified and the commarea field contains
20060621 then a result value of 2006-06-21 will be generated.</p>
<p>Note: XML tag names are case sensitive. WITH=&#8217;Title&#8217; is not the same as
WITH=&#8217;TITLE&#8217;</p>
<p>A variation of the MAP$&nbsp;AREA instruction allows the value of the field
to be copied into a VIRTEL variable, in addition to being placed in the
commarea. The variable will be created, if necessary, and its value will
be set when the commarea is created by a subsequent MAP$&nbsp;FROM-FIELD,
MAP$&nbsp;FROM-INPUT, or MAP$&nbsp;FROM-VARIABLE instruction. The value can then
be tested by means of an IF$&nbsp;VARIABLE instruction (see “Examples of
presentation scripts” sur la page 241):</p>
<p>MAP$ AREA,TO-VARIABLE,VAR=&#8217;varname&#8217;,</p>
<p>WITH=&#8217;name&#8217;,LENGTH=nnn,TYPE=type</p>
<p><strong>*varname*</strong> The name of the VIRTEL variable to which the field value
is to be copied. The variable name must be placed in quotes. If the
variable already exists, then its current value will be replaced.</p>
<p>The parameters WITH, LENGTH, and TYPE are as previously described.</p>
<p>Another form of the MAP$&nbsp;AREA instruction defines a field in the
commarea and fills the field with either a constant value, or the value
of a VIRTEL variable:</p>
<p>MAP$ AREA,FROM-CONSTANT,&#8217;value&#8217;,LENGTH=nnn,TYPE=type</p>
<p>MAP$ AREA,FROM-VARIABLE,VAR=&#8217;varname&#8217;,LENGTH=nnn,</p>
<p>TYPE=type,FORMAT=(&#8216;pattern&#8217;,char)</p>
<p><strong>*value*</strong> The value to be copied to the field. The value must be
placed in quotes.</p>
<p><strong>*varname*</strong> The name of the VIRTEL variable from which the field value
is to be copied. The variable name must be placed in quotes.</p>
<p>The parameters LENGTH, TYPE, and FORMAT are as previously described.</p>
<p>A further variation of the MAP$&nbsp;AREA instruction places the value of a
field into a VIRTEL variable, without copying it into the commarea. The
variable will be created or replaced during the processing of a
subsequent MAP$&nbsp;FROM-FIELD, MAP$&nbsp;FROM-INPUT, or MAP$&nbsp;FROM-VARIABLE
instruction.</p>
<p>MAP$ AREA,TO-VARIABLE-ONLY,VAR=&#8217;varname&#8217;,</p>
<p>WITH=&#8217;name&#8217;,LENGTH=nnn,TYPE=type</p>
<p><strong>*varname*</strong> The name of the VIRTEL variable to which the field value
is to be copied. The variable name must be placed in quotes. If the
variable already exists, then its current value will be replaced.</p>
<p>The WITH parameter specifies the name of the XML tag or Query parameter,
as previously described. If the LENGTH and TYPE parameters are
specified, then the value of the field is edited, as previously
described, to conform to the length and type specified. If the LENGTH
and TYPE parameters are omitted, then the length and value of the
variable are copied exactly from the input data.</p>
<p>Another variation of the MAP$&nbsp;AREA instruction, TO-TABLE-VARIABLE-ONLY,
is similar to TO-VARIABLE-ONLY except that if the variable already
exists, the new value will be appended to any existing values instead of
erasing the previous value.</p>
<p>MAP$ AREA,TO-TABLE-VARIABLE-ONLY,VAR=&#8217;varname&#8217;,</p>
<p>WITH=&#8217;name&#8217;,LENGTH=nnn,TYPE=type</p>
<p><strong>*varname*</strong> The name of the VIRTEL variable to which the field value
is to be copied. The variable name must be placed in quotes. If the
variable already exists, the new value will be appended to any existing
values.</p>
<p>The WITH, LENGTH and TYPE parameters are as previously described.</p>
<p>For convenience, if the variable name is the same as the value of the
WITH parameter, the variable name may be specified as VAR=&#8217;=WITH&#8217; or
VAR==WITH.</p>
<p>The FROM-LAST-ELEMENT-FOUND-NAME keyword of the MAP$&nbsp;AREA instruction
copies into the output commarea the name of the last XML element found
in the input stream. This may be used in conjunction with the
NEXT-ELEMENT keyword of the MAP$&nbsp;BEGIN instruction.</p>
<p>MAP$ AREA,FROM-LAST-FOUND-ELEMENT-NAME,</p>
<p>LENGTH=nnn,TYPE=X</p>
<p><strong>*nnn*</strong> The length of the field in the output commarea where the name
is to be placed.</p>
<p>MAP$ AREA-ATTRIBUTE</p>
<p>The MAP$&nbsp;AREA-ATTRIBUTE instruction defines a field within a commarea.
It is similar to MAP$&nbsp;AREA except that the contents of the field are
obtained from the value of an attribute parameter included within the
specified XML start tag, instead of from the data enclosed by the XML
start and end tags.</p>
<p>MAP$ AREA-ATTRIBUTE,WITH=&#8217;xmlname&#8217;,VALUEOF=&#8217;attrname&#8217;,</p>
<p>LENGTH=nnn,TYPE=type</p>
<p><strong>*xmlname*</strong> The name of the XML tag in the input data whose attribute
is to be copied. If the WITH parameter is omitted, the tag at the
current location in the input data is used.</p>
<p><strong>*attrname*</strong> The name of the XML attribute whose value is to be copied
to the commarea.</p>
<p><strong>*nnn*</strong> Specifies the fixed length of the field in the commarea.</p>
<p><strong>*type*</strong> Same as <em>type</em> parameter of the MAP$&nbsp;AREA instruction.</p>
<p>Note: XML tag and attribute names are case sensitive.</p>
<p>A variation of the MAP$&nbsp;AREA-ATTRIBUTE instruction allows the value of
the attribute to be copied into a VIRTEL variable, in addition to being
placed in the commarea:</p>
<p>MAP$ AREA-ATTRIBUTE,TO-VARIABLE,VAR=&#8217;varname&#8217;,</p>
<p>WITH=&#8217;xmlname&#8217;,VALUEOF=&#8217;attrname&#8217;,LENGTH=nnn,TYPE=type</p>
<p><strong>*varname*</strong> The name of the VIRTEL variable to which the attribute
value is to be copied. The variable name must be placed in quotes. If
the variable already exists, then its current value will be replaced.</p>
<p>The parameters WITH, VALUEOF, LENGTH, and TYPE are as previously
described.</p>
<p>Another variation of the MAP$&nbsp;AREA-ATTRIBUTE instruction places the
value of an attribute into a VIRTEL variable, without copying it into
the commarea:</p>
<p>MAP$ AREA-ATTRIBUTE,TO-VARIABLE-ONLY,VAR=&#8217;varname&#8217;,</p>
<p>WITH=&#8217;xmlname&#8217;,VALUEOF=&#8217;attrname&#8217;,LENGTH=nnn,TYPE=type</p>
<p><strong>*varname*</strong> The name of the VIRTEL variable to which the attribute
value is to be copied. The variable name must be placed in quotes. If
the variable already exists, then its current value will be replaced.</p>
<p>The parameters WITH and VALUEOF are as previously described. If the
LENGTH and TYPE parameters are specified, then the attribute value is
edited, as previously described, to conform to the length and type
specified. If the LENGTH and TYPE parameters are omitted, then the
length and value of the attribute are copied exactly.</p>
<p>MAP$ BEGIN</p>
<p>The MAP$&nbsp;BEGIN instruction marks the start of a commarea, or the start
of a group of fields within a commarea. The optional WITH parameter
indicates a group of fields enclosed by a specific XML tag in the input
data. The optional OCCURS parameter indicates a repeating group of
fields. Nested pairs of MAP$&nbsp;BEGIN and MAP$&nbsp;END instructions are
permitted.</p>
<p>groupname MAP$ BEGIN,WITH=&#8217;xmlname&#8217;,OCCURS=nnn,COUNT=&#8217;countvar&#8217;</p>
<p><strong>*groupname*</strong> The label is required. It specifies the name of the
commarea or field group. The MAP$&nbsp;BEGIN instruction must be matched by a
subsequent MAP$&nbsp;END instruction having the same label.</p>
<p><strong>*xmlname*</strong> The name of the XML tag which identifies the start of the
group of fields in the input data. If the WITH parameter is omitted,
processing for this group of fields starts at the current location in
the input data. The special value NEXT-ELEMENT matches with the next XML
tag in the input stream, regardless of its name.</p>
<p><strong>*nnn*</strong> Specifies the number of occurrences for a repeating group of
fields. If the OCCURS parameter is omitted, one occurrence will be
generated. The special value OCCURS=UNLIMITED indicates that the field
repeats indefinitely until the end of the input data is reached.</p>
<p><strong>*countvar*</strong> Specifies the name of a VIRTEL variable which will be
created when the MAP$ is processed for commarea-to-output conversion for
a repeating group of fields. The value of the variable is the number of
occurrences actually processed (which may be less than the value of the
OCCURS parameter if the length of the input commarea is insufficient to
contain <em>nnn</em> occurrences of the field group). If the COUNT parameter is
omitted, the <em>groupname</em> specified in the statement label is used as the
variable name.</p>
<p>A variation of the MAP$&nbsp;BEGIN instruction can be used to force the scan
of the XML input stream to be restarted:</p>
<p>groupname MAP$ BEGIN,TOP,WITH=&#8217;xmlname&#8217;</p>
<p>The TOP parameter specifies that the scan for the tag named <em>xmlname</em>
starts from the beginning of the XML stream.</p>
<p>Another variation of the MAP$&nbsp;BEGIN instruction introduces a group of
fields which are conditional on the current value of the $EVENT$
variable:</p>
<p>groupname MAP$ BEGIN,EVENT=&#8217;eventname&#8217;</p>
<p>The group of fields enclosed by the MAP$&nbsp;BEGIN and MAP$&nbsp;END instructions
are processed only if the “current event” set by a previous
MAP$&nbsp;EVENTUAL-AREA or MAP$&nbsp;ELSETHEN-AREA instruction matches the
<em>eventname</em> specified. For commarea-to-output conversion, the names of
the variables generated for this group are prefixed by <em>eventname/</em></p>
<p>MAP$ END</p>
<p>The MAP$&nbsp;END instruction marks the end of a commarea or field group.</p>
<p>groupname MAP$ END</p>
<p><strong>*groupname*</strong> The label is required. It must match the label on the
corresponding MAP$&nbsp;BEGIN instruction.</p>
<p>MAP$ EVENTUAL-AREA, MAP$ ELSETHEN-AREA</p>
<p>The MAP$&nbsp;EVENTUAL-AREA and MAP$&nbsp;ELSETHEN-AREA instructions generate a
field in a commarea whose value depends on the presence of a named tag
in the XML stream, or whose value depends on the value of a specific XML
tag.</p>
<p>The first form of these instructions tests for the presence of one of a
set of named tags, and generates a value which corresponds to the tag
which was found:</p>
<p>MAP$ EVENTUAL-AREA, <strong>or</strong> ELSETHEN-AREA,</p>
<p>FROM-CONSTANT,&#8217;value&#8217;,</p>
<p>WHEN=(ELEMENT,&#8217;xmlname&#8217;),</p>
<p>EVENT=&#8217;varname&#8217;</p>
<p>MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#8217;value&#8217;</p>
<p>These instructions are coded as a group consisting of one
MAP$&nbsp;EVENTUAL-AREA instruction followed by one or more
MAP$&nbsp;ELSETHEN-AREA instructions. A final MAP$&nbsp;ELSETHEN-AREA instruction
with no WHEN parameter provides a default value for the output field.
The group is enclosed by a pair of MAP$&nbsp;BEGIN and MAP$&nbsp;END instructions
which specify the name of the enclosing XML tag.</p>
<p>The optional EVENT parameter specifies the name of the VIRTEL variable
to be created when the MAP$ is processed for commarea-to-output
conversion. If the EVENT parameter is omitted, then the variable has the
same name as the XML tag <em>xmlname</em>. The value of the EVENT parameter is
also added to the $EVENT$ variable, and becomes the “current event” for
any subsequent MAP$&nbsp;BEGIN,EVENT instructions.</p>
<p>The following example illustrates the process. The XML stream in this
example consists of an &lt;identity&gt; tag which may enclose one of three
different tags &lt;bic&gt; &lt;iban&gt; or &lt;rib&gt;:</p>
<p>&lt;identity&gt;&lt;bic&gt;12345678&lt;/bic&gt;&lt;/identity&gt;</p>
<p><strong>*or*</strong></p>
<p>&lt;identity&gt;&lt;iban&gt;12345678&lt;/iban&gt;&lt;/identity&gt;</p>
<p><strong>*or*</strong></p>
<p>&lt;identity&gt;&lt;rib&gt;12345678&lt;/rib&gt;&lt;/identity&gt;</p>
<p>The objective is to generate an output area which consists of a one-byte
code (1=bic, 2=iban, 3=rib) followed by an 8-byte area containing the
value of the indicated tag. If none of the indicated tags is found, the
code is generated with a space as the default value. This is achieved by
means of the following instructions in the scenario:</p>
<p>IDENT MAP$ BEGIN,WITH=&#8217;identity&#8217;</p>
<p>MAP$ EVENTUAL-AREA,FROM-CONSTANT,&#8216;1&#8217;,WHEN=(ELEMENT,&#8217;bic&#8217;)</p>
<p>MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#8216;2&#8217;,WHEN=(ELEMENT,&#8217;iban&#8217;)</p>
<p>MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#8216;3&#8217;,WHEN=(ELEMENT,&#8217;rib&#8217;)</p>
<p>MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#8217; &#8216;</p>
<p>MAP$ AREA,LENGTH=8</p>
<p>IDENT MAP$ END</p>
<p>Note: XML tag names are case sensitive.</p>
<p>The second form of the MAP$&nbsp;EVENTUAL-AREA and MAP$&nbsp;ELSETHEN-AREA
instructions tests the data enclosed by a named tag in the XML stream,
and generates an output field with a corresponding value:</p>
<p>MAP$ EVENTUAL-AREA, <strong>or</strong> ELSETHEN-AREA,</p>
<p>FROM-CONSTANT,&#8217;value&#8217;,</p>
<p>WHEN=(VALUE,&#8217;string&#8217;)</p>
<p>MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#8217;value&#8217;</p>
<p>These instructions are coded as a group consisting of one
MAP$&nbsp;EVENTUAL-AREA instruction followed by one or more
MAP$&nbsp;ELSETHEN-AREA instructions. A final MAP$&nbsp;ELSETHEN-AREA instruction
with no WHEN parameter provides a default value for the output field.
The group is enclosed by a pair of MAP$&nbsp;BEGIN and MAP$&nbsp;END instructions
which specify the name of the XML tag whose value is being tested</p>
<p>The following example illustrates the process. The XML stream in this
example consists of an &lt;indicator&gt; tag which can take the value “true”
or “false”:</p>
<p>&lt;indicator&gt;true&lt;/indicator&gt;</p>
<p><strong>*or*</strong></p>
<p>&lt;indicator&gt;false&lt;/indicator&gt;</p>
<p>The objective is to generate an output area which consists of a one-byte
code (1=true, 0=false). A default value 0 is generated if the tag data
has any other value. This is achieved by means of the following
instructions in the scenario:</p>
<p>INDIC MAP$ BEGIN,WITH=&#8217;indicator&#8217;</p>
<p>MAP$ EVENTUAL-AREA,FROM-CONSTANT,&#8216;0&#8217;,WHEN=(VALUE,&#8217;false&#8217;)</p>
<p>MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#8216;1&#8217;,WHEN=(VALUE,&#8217;true&#8217;)</p>
<p>MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#8216;0&#8217;</p>
<p>INDIC MAP$ END</p>
<p>Note: XML tag names are case sensitive.</p>
<p>MAP$ EXECUTE</p>
<p>The MAP$&nbsp;EXECUTE instruction allows a sequence of MAP$ instructions to
be interrupted in order to enter data on the 3270 screen before
continuing the analysis. The MAP$&nbsp;EXECUTE instruction branches to a
subroutine defined elsewhere in the scenario. The subroutine ends with a
RETURN$ instruction.</p>
<p>subname MAP$ EXECUTE</p>
<p><strong>*subname*</strong> The label is required. It specifies the name of the
subroutine to be called. The label <em>subname</em> must be defined elsewhere
in the scenario.</p>
<p>In the following example the two MAP$&nbsp;EVENT paragraphs each call a
subroutine later in the scenario. After the subroutine executes a
RETURN$ instruction, the analysis continues:</p>
<p>LIGNE0 MAP$ BEGIN,EVENT=&#8217;LIGNE0&#8217;</p>
<p>MAP$ AREA,TO-VARIABLE,VAR=&#8217;QTE&#8217;,LENGTH=5,TYPE=X,WITH=&#8217;QTE&#8217;</p>
<p>MAP$ AREA,TO-VARIABLE,VAR=&#8217;CAI&#8217;,LENGTH=36,TYPE=X,WITH=&#8217;CAI&#8217;</p>
<p>MAP$ AREA,TO-VARIABLE,VAR=&#8217;CCD&#8217;,LENGTH=3,TYPE=X,WITH=&#8217;CCD&#8217;</p>
<p>MAP$ AREA,FROM-CONSTANT,&#8217; &#8216;,LENGTH=1,TYPE=X</p>
<p>LI0 MAP$ EXECUTE</p>
<p>LIGNE0 MAP$ END</p>
<p>CMDVALID MAP$ BEGIN,EVENT=&#8217;CMDVALID&#8217;</p>
<p>MAP$ AREA,FROM-CONSTANT,&#8217; &#8216;,LENGTH=1,TYPE=X</p>
<p>CMDV MAP$ EXECUTE</p>
<p>CMDVALID MAP$ END</p>
<hr class="docutils" />
<p>LI0 DS 0H</p>
<p>COPY$ VARIABLE-TO-SCREEN,VAR=&#8217;LIGNE0/QTE&#8217;,SCREEN=(11,6,5), *</p>
<p>TYPE=ERASE-FIELD</p>
<p>COPY$ VARIABLE-TO-SCREEN,VAR=&#8217;LIGNE0/CAI&#8217;,SCREEN=(11,12,36), *</p>
<p>TYPE=ERASE-FIELD</p>
<p>COPY$ VARIABLE-TO-SCREEN,VAR=&#8217;LIGNE0/QTE&#8217;,SCREEN=(11,49,3), *</p>
<p>TYPE=ERASE-FIELD</p>
<p>RETURN$</p>
<p>CMDV DS 0H</p>
<p>* Send pf=ENTER</p>
<p>ACTION$ TO-APPLICATION,KEY=7D</p>
<p>* Add an occurrence of the table variable VIRTEL</p>
<p>* = return code after validation request</p>
<p>COPY$ SCREEN-TO-VARIABLE,SCREEN=(22,31,8),VAR=&#8217;RETOUR&#8217;</p>
<p>RETURN$</p>
<p>MAP$ FROM-FIELD</p>
<p>The MAP$&nbsp;FROM-FIELD instruction requests VIRTEL to generate a commarea
from XML input data (“XML input-to-commarea” conversion). The XML input
data is obtained from an HTML form field in the incoming HTTP request.</p>
<p>groupname MAP$ FROM-FIELD,FIELD=&#8217;fieldname&#8217;</p>
<p><strong>*groupname*</strong> The label is required. It specifies the name of the
output area to be generated. It must match the label on a preceding
MAP$&nbsp;BEGIN instruction.</p>
<p><strong>*fieldname*</strong> The name of the HTML form field which contains the XML
input data.</p>
<p>The MAP$&nbsp;FROM-FIELD instruction expects XML input data to be presented
as a character string fieldname=xmldata where xmldata is XML data in
URL-encoded format. In URL-encoded format, a “+” sign represents a
space, and “%xx” represents the hexadecimal encoding of an ASCII
character. The string fieldname=xmldata may either be appended to the
URL (HTTP “GET” method) or it may be contained in the body of the HTTP
request (HTTP “POST” method). See “Sending XML input as URL-encoded
data” sur la page 238 for examples. To process requests containing XML
data in plain (unencoded) format, use instead the MAP$&nbsp;FROM-INPUT
instruction described sur la page 199.</p>
<p>MAP$ FROM-INPUT</p>
<p>The MAP$&nbsp;FROM-INPUT instruction requests VIRTEL to generate a commarea
from XML or Query format input data (“input-to-commarea” conversion).
The input data is obtained from the incoming HTTP request.</p>
<p>groupname MAP$ FROM-INPUT,format</p>
<p><strong>*groupname*</strong> The label is required. It specifies the name of the
output area to be generated. It must match the label on a preceding
MAP$&nbsp;BEGIN instruction.</p>
<div class="line-block">
<div class="line"><strong>*format* XML</strong> specifies that the input data is in XML format</div>
<div class="line"><strong>QUERY</strong> specifies that the input data is in Query format</div>
<div class="line">If neither XML nor QUERY is specified, the default is XML.</div>
</div>
<p>Note: MAP$&nbsp;FROM-INPUT with a FIELD parameter is accepted and treated as
MAP$&nbsp;FROM-FIELD</p>
<p>The MAP$&nbsp;FROM-INPUT instruction obtains its input data from an incoming
HTTP request. The HTTP request may use either via the GET method (where
the input data is appended to the URL) or the POST method (where the
input data is contained in the request body).</p>
<p>When the input format is XML, MAP$&nbsp;FROM-INPUT treats the entire data
area as XML data without any translation. See “HTTP request with XML
input data” sur la page 237 for an example. MAP$&nbsp;FROM-FIELD is preferred
when using the GET method with XML input, because certain characters
cannot be included in a URL without using URL-encoding.</p>
<p>When the input format is QUERY, MAP$&nbsp;FROM-INPUT expects the input data
to contain one or more strings in the form fieldname=data. When the HTTP
request uses the GET method, the strings are appended to the URL. The
first string is preceded by a “?” character which separates it from the
URL, and the remaining strings are separated by “&amp;” characters. When the
HTTP request uses the POST method, the strings are contained in the
request body, either one per line, or separated by “&amp;” characters if
multiple strings are coded on the same line. For both the GET and POST
methods, Query strings are expressed in URL-encoded format, where “+”
sign represents a space, and “%xx” represents the hexadecimal encoding
of an ASCII character. See “Parsing Query input” sur la page 227 for
examples.</p>
<p>MAP$ FROM-VARIABLE</p>
<p>The MAP$&nbsp;FROM-VARIABLE instruction requests VIRTEL to generate a
commarea from XML or Query format input data (“input-to-commarea”
conversion). The input data is contained in a VIRTEL variable.</p>
<p>groupname MAP$ FROM-VARIABLE,format,VAR=&#8217;varname&#8217;</p>
<p><strong>*groupname*</strong> The label is required. It specifies the name of the
output area to be generated. It must match the label on a preceding
MAP$&nbsp;BEGIN instruction.</p>
<div class="line-block">
<div class="line"><strong>*format* XML</strong> specifies that the input data is in XML format</div>
<div class="line"><strong>QUERY</strong> specifies that the input data is in Query format</div>
<div class="line">If neither XML nor QUERY is specified, the default is XML.</div>
</div>
<p><strong>*varname*</strong> The name of the VIRTEL variable which contains the input
data.</p>
<p>MAP$ TO-VARIABLE</p>
<p>The MAP$&nbsp;TO-VARIABLE instruction requests VIRTEL to copy a commarea into
a VIRTEL variable. The commarea must have been already generated by a
previous MAP$&nbsp;FROM-FIELD, FROM-INPUT, or FROM-VARIABLE instruction.</p>
<p>groupname MAP$ TO-VARIABLE,VAR=&#8217;varname&#8217;</p>
<p><strong>*groupname*</strong> The label is required. It specifies the name of the
output area to be copied. It must match the label on a preceding
MAP$&nbsp;BEGIN instruction.</p>
<p><strong>*varname*</strong> The name of the VIRTEL variable into which the commarea is
to be copied.</p>
</div>
<div class="section" id="option-instruction">
<h6>OPTION$ instruction<a class="headerlink" href="#option-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction allows the scenario to set up parameters for a
subsequent SEND$&nbsp;TO-LINE instruction.</p>
<p>OPTION$ FOR-HTTP</p>
<p>The OPTION$&nbsp;FOR-HTTP instruction, when used in conjunction with a
SEND$&nbsp;TO-LINE instruction referencing an outbound HTTP line, allows a
scenario to make a request to an HTTP server and to receive the
response. The OPTION$&nbsp;FOR-HTTP instruction builds the parameter list for
the subsequent SEND$&nbsp;TO-LINE instruction.</p>
<p>OPTION$ FOR-HTTP, *</p>
<p>(METHOD,&#8217;method&#8217;), *</p>
<p>(SITE,&#8217;sitename&#8217;), *</p>
<p>(TO,&#8217;topath&#8217;), *</p>
<p>(TEXT,&#8217;querytext&#8217;), *</p>
<p>(FROM,&#8217;fromuser&#8217;), *</p>
<p>(PASSWORD,&#8217;password&#8217;), *</p>
<p>(HEADER,&#8217;header&#8217;), *</p>
<p>(FILE-OUT,&#8217;varnameo&#8217;), *</p>
<p>(FILE-IN,&#8217;varnamei&#8217;), *</p>
<p>(RET-CODE,&#8217;varnamer&#8217;), *</p>
<p>TOVAR=&#8217;varnamep&#8217;</p>
<p><strong>*method*</strong> <em>(required)</em> the HTTP method: GET or POST <em>(see note
below)</em>.</p>
<p><strong>*site*</strong> the site portion of the URL <em>(see notes below)</em>.</p>
<p><strong>*topath*</strong> the path portion of the URL <em>(see note below)</em>.</p>
<p><strong>*querytext*</strong> optional text to be appended to the URL <em>(see note
below)</em>.</p>
<p><strong>*fromuser*</strong> the userid of the requester <em>(see note below)</em>.</p>
<p><strong>*password*</strong> the password of the requester <em>(see note below)</em>.</p>
<p><strong>*header*</strong> additional HTTP headers to be inserted in the message.
Multiple headers may be inserted by specifying more than one HEADER
parameter.</p>
<p><strong>*varnameo*</strong> the name of the VIRTEL variable which contains the HTTP
POST data to be sent to the server. This parameter is required when the
<em>method</em> is POST.</p>
<p><strong>*varnamei*</strong> <em>(required)</em> the name of the VIRTEL variable which will
receive the HTTP response data returned by the server.</p>
<p><strong>*varnamer*</strong> the name of the VIRTEL variable which will receive the
HTTP return code returned by the server.</p>
<p><strong>*varnamep*</strong> the name of the VIRTEL variable which will contain the
parameter list.</p>
<p>Note: If the field begins with “*” then it is treated as the name of a
variable.</p>
<p>Note: You can use the SITE parameter to specify the name and port of the
remote HTTP server, provided that the outbound HTTP line specified by
the SEND$&nbsp;TO-LINE instruction is defined with the special value $SITE$
in the “Remote Ident” field. The value of the SITE parameter is also
used to build the Host: header of the outbound HTTP request.</p>
<p>Examples:</p>
<p>OPTION$ FOR-HTTP, *</p>
<p>(METHOD,&#8217;POST&#8217;), *</p>
<p>(SITE,&#8217;api.google.com:80&#8217;), *</p>
<p>(TO,&#8217;/search/beta2&#8217;), *</p>
<p>(HEADER,&#8217;Content-Type: application/soap+xml&#8217;), *</p>
<p>(HEADER,&#8217;SOAPAction: <a class="reference external" href="urn:GoogleSearchAction">urn:GoogleSearchAction</a>&#8216;), *</p>
<p>(FILE-OUT,&#8217;QUESTION&#8217;), *</p>
<p>(FILE-IN,&#8217;ANSWER&#8217;), *</p>
<p>(RET-CODE,&#8217;HTTP-RETURN-CODE&#8217;), *</p>
<p>TOVAR=&#8217;MYPARMS&#8217;</p>
<p>OPTION$ FOR-HTTP, *</p>
<p>(METHOD,&#8217;GET&#8217;), *</p>
<p>(SITE,&#8217;*SITENAME&#8217;), *</p>
<p>(TO,&#8217;/search&#8217;), *</p>
<p>(TEXT,&#8217;?ie=UTF-8&amp;q=test&#8217;), *</p>
<p>(HEADER,&#8217;Accept: text/xml&#8217;), *</p>
<p>(FILE-IN,&#8217;ANSWER&#8217;), *</p>
<p>TOVAR=&#8217;MYPARMS&#8217;</p>
<p>In this example, the VIRTEL variable SITENAME contains the value of the
SITE parameter.</p>
<p>OPTION$ FOR-IND$FILE</p>
<p>The OPTION$&nbsp;FOR-IND$FILE instruction prepares a TSO session for a file
transfer operation using the IND$FILE protocol. This instruction does
not itself perform a file transfer; instead it produces an IND$FILE
command in a VIRTEL variable. The scenario must send the command to the
TSO session to initiate the file transfer.</p>
<p>The format of the OPTION$&nbsp;FOR-IND$FILE command for a transfer from TSO
to the workstation is shown below:</p>
<p>OPTION$ FOR-IND$FILE-DOWNLOAD, *</p>
<p>(METHOD,&#8217;options&#8217;), *</p>
<p>(FROM,&#8217;dsname&#8217;), *</p>
<p>(FILE-OUT,&#8217;outvar&#8217;), *</p>
<p>(RET-CODE,&#8217;retvar&#8217;), *</p>
<p>TOVAR=&#8217;cmdvar&#8217;</p>
<p><strong>*options*</strong> optional parameters (for example, &#8216;ASCII CRLF&#8217;) to be
appended to the IND$FILE command line <em>(see note 1 below)</em>.</p>
<p><strong>*dsname*</strong> <em>(required)</em> the TSO dataset name to be downloaded <em>(see
notes 1 and 2 below)</em>.</p>
<p><strong>*outvar*</strong> <em>(required)</em> the name of the VIRTEL variable which is to
receive the contents of the downloaded file.</p>
<p><strong>*retvar*</strong> the name of the VIRTEL variable which will receive the
completion message sent by IND$FILE at the end of the transfer.</p>
<p><strong>*cmdvar*</strong> <em>(required)</em> the name of the VIRTEL variable which will
contain the generated IND$FILE command.</p>
<p>The format of the OPTION$&nbsp;FOR-IND$FILE command for a transfer from the
workstation to TSO is shown below:</p>
<p>OPTION$ FOR-IND$FILE-UPLOAD, *</p>
<p>(METHOD,&#8217;options&#8217;), *</p>
<p>(TO,&#8217;dsname&#8217;), *</p>
<p>(FILE-IN,&#8217;invar&#8217;), *</p>
<p>(RET-CODE,&#8217;retvar&#8217;), *</p>
<p>TOVAR=&#8217;cmdvar&#8217;</p>
<p><strong>*options*</strong> optional parameters (for example, &#8216;ASCII CRLF NEW&#8217;) to be
appended to the IND$FILE command line <em>(see note 1 below)</em>.</p>
<p><strong>*dsname*</strong> <em>(required)</em> the destination TSO dataset name <em>(see notes 1
and 2 below)</em>.</p>
<p><strong>*invar*</strong> <em>(required)</em> the name of the VIRTEL variable which contains
the data to be uploaded.</p>
<p><strong>*retvar*</strong> the name of the VIRTEL variable which will receive the
completion message sent by IND$FILE at the end of the transfer.</p>
<p><strong>*cmdvar*</strong> <em>(required)</em> the name of the VIRTEL variable which will
contain the generated IND$FILE command.</p>
<p>Note 1: If the field begins with “*” then it is treated as the name of
a variable.</p>
<p>Note 2: TSO will prefix the dataset name by your prefix (usually your
userid) unless the dataset name is enclosed in quotes. If you specify
the dataset name as a literal in the instruction (as opposed to
indirectly as the value of a variable) then triple quotes must be used,
for example: (FROM,&#8217;&#8216;&#8217;SYS1.PARMLIB(IEASYS00)&#8217;&#8216;&#8217;)</p>
<p>Examples:</p>
<p>OPTION$ FOR-IND$FILE-DOWNLOAD, *</p>
<p>(METHOD,&#8217;*OPT&#8217;), &#8220;ASCII CRLF&#8221; or null *</p>
<p>(FROM,&#8217;*DSN&#8217;), TSO dataset name *</p>
<p>(FILE-OUT,&#8217;DOWNLOAD&#8217;), *</p>
<p>(RET-CODE,&#8217;RETURN-CODE&#8217;), *</p>
<p>TOVAR=&#8217;FTCOMMAND&#8217;</p>
<p>In this example, the VIRTEL variable OPT contains the IND$FILE optional
parameters and DSN contains the dataset name. On completion of the
instruction, FTCOMMAND contains the IND$FILE command to be sent to TSO.
When the file transfer completes, the VIRTEL variable DOWNLOAD contains
the contents of the downloaded file, and RETURN-CODE contains the
IND$FILE completion message <em>TRANS03 File transfer complete</em> or an error
message.</p>
<p>OPTION$ FOR-IND$FILE-UPLOAD, *</p>
<p>(METHOD,&#8217;*OPT&#8217;), &#8220;ASCII CRLF&#8221; or null *</p>
<p>(TO,&#8217;*DSN&#8217;), TSO dataset name *</p>
<p>(FILE-IN,&#8217;UPLOAD&#8217;), *</p>
<p>(RET-CODE,&#8217;RETURN-CODE&#8217;), *</p>
<p>TOVAR=&#8217;FTCOMMAND&#8217;</p>
<p>In this example, the VIRTEL variable OPT contains the IND$FILE optional
parameters and DSN contains the dataset name. On completion of the
instruction, FTCOMMAND contains the IND$FILE command to be sent to TSO.
When the file transfer is initiated, VIRTEL sends the contents of the
variable UPLOAD to IND$FILE. When the file transfer completes,
RETURN-CODE contains the IND$FILE completion message <em>TRANS03 File
transfer complete</em> or an error message.</p>
<p>OPTION$ FOR-MQ</p>
<p>Builds a parameter list for a subsequent SEND$&nbsp;TO-LINE instruction when
the line type is MQ.</p>
<p>OPTION$ FOR-MQ, *</p>
<p>(FILE-OUT,&#8217;varname1&#8217;), *</p>
<p>TOVAR=&#8217;varnamep&#8217;</p>
<p><strong>*varname1*</strong> the name of the VIRTEL variable which contains data to be
written to the MQ line.</p>
<p><strong>*varnamep*</strong> the name of the VIRTEL variable which will contain the
parameter list.</p>
<p>OPTION$ FOR-SMTP</p>
<p>Builds a parameter list for a subsequent SEND$&nbsp;TO-LINE instruction when
the line type is SMTP.</p>
<p>OPTION$ FOR-SMTP, *</p>
<p>(TO,&#8217;toaddr&#8217;), *</p>
<p>(FROM,&#8217;fromaddr&#8217;), *</p>
<p>(CC,&#8217;ccaddr&#8217;), *</p>
<p>(BCC,&#8217;bccaddr&#8217;), *</p>
<p>(TEXT,&#8217;bodytext&#8217;), *</p>
<p>(SUBJECT,&#8217;subjtext&#8217;), *</p>
<p>(CHARSET,&#8217;charset&#8217;), *</p>
<p>(HEADER,&#8217;header&#8217;), *</p>
<p>(FILE-OUT,&#8217;varname&#8217;,&#8217;filename&#8217;,&#8217;filetype&#8217;,&#8217;disp&#8217;), *</p>
<p>(ALTERNATE-TEXT,&#8217;altvar&#8217;,&#8217;altfn&#8217;,&#8217;altft&#8217;,&#8217;altdp&#8217;), *</p>
<p>TOVAR=&#8217;varnamep&#8217;</p>
<p><strong>*toaddr*</strong> the email address of the recipient <em>(see note below)</em>.</p>
<p><strong>*fromaddr*</strong> the email address of the sender <em>(see note below)</em>.</p>
<p><strong>*ccaddr*</strong> the email address(es) of the carbon-copy recipient(s) <em>(see
note below)</em>.</p>
<p><strong>*bccaddr*</strong> the email address(es) of the blind carbon-copy
recipient(s) <em>(see note below)</em>.</p>
<p><strong>*bodytext*</strong> a character string to be placed in the message body <em>(see
note below)</em>.</p>
<p><strong>*subjtext*</strong> a character string to be placed in the message subject
line <em>(see note below)</em>.</p>
<p><strong>*charset*</strong> the character set name to be included in the SMTP
Content-type header <em>(see note below)</em>. For example, ISO-8859-15</p>
<p><strong>*header*</strong> additional SMTP headers to be inserted in the message.
Multiple headers may be inserted by specifying more than one HEADER
parameter.</p>
<p><strong>*varname*</strong> the name of the VIRTEL variable which contains data to be
written as an attached file. Multiple files may be attached by
specifying more than one FILE-OUT parameter.</p>
<p><strong>*filename*</strong> the name of the attached file.</p>
<p><strong>*filetype*</strong> the file type to be sent in the Content-type mime header
of the attached file. For example text/plain, application/x-tar, etc.</p>
<p><strong>*disp*</strong> the Content-Disposition of the attached file. Possible values
are inline and attachment. This is an optional subparameter and its
default value is attachment.</p>
<p><strong>*altvar*</strong> the name of the VIRTEL variable which contains data to be
written as an alternate text file. When the ALTERNATE-TEXT parameter is
specified, the generated email will be structured as a
multipart/alternative message, and the <em>bodytext</em> specified in the TEXT
parameter will become a file with content type text/plain</p>
<p><strong>*altfn*</strong> the name of the alternate text file.</p>
<p><strong>*altft*</strong> the file type of the alternate text file, usually text/html</p>
<p><strong>*altdp*</strong> the Content-Disposition of the alternate text file, usually
inline.</p>
<p><strong>*varnamep*</strong> the name of the VIRTEL variable which will contain the
parameter list.</p>
<p>Note: If the field begins with “*” then it is treated as the name of a
variable.</p>
<p>Example:</p>
<p>OPTION$ FOR-SMTP, *</p>
<p>(TO,&#8217;*DESTADDR&#8217;), *</p>
<p>(FROM,&#8217;<a class="reference external" href="mailto:me&#37;&#52;&#48;y&#46;com">me<span>&#64;</span>y<span>&#46;</span>com</a>&#8216;), *</p>
<p>(CC,&#8217;<a class="reference external" href="mailto:info&#37;&#52;&#48;y&#46;com">info<span>&#64;</span>y<span>&#46;</span>com</a>&#8216;), *</p>
<p>(BCC,&#8217;<a class="reference external" href="mailto:archive&#37;&#52;&#48;y&#46;com">archive<span>&#64;</span>y<span>&#46;</span>com</a>&#8216;), *</p>
<p>(TEXT,&#8217;your file is attached&#8217;), *</p>
<p>(SUBJECT,&#8217;analysis result&#8217;), *</p>
<p>(CHARSET,&#8217;ISO-8859-15&#8217;), *</p>
<p>(HEADER,&#8217;X-Priority: 3&#8217;), *</p>
<p>(FILE-OUT,&#8217;MYVAR1&#8217;,&#8217;out.tar&#8217;,&#8217;application/x-tar&#8217;), *</p>
<p>(FILE-OUT,&#8217;MYVAR2&#8217;,,&#8217;application/x-tar&#8217;), *</p>
<p>(ALTERNATE-TEXT,&#8217;M01&#8217;,&#8217;Message.html&#8217;, *</p>
<p>&#8216;text/html&#8217;,&#8217;inline&#8217;), *</p>
<p>TOVAR=&#8217;MYPARMS&#8217;</p>
<p>In this example, the variable DESTADDR contains the value of the TO
parameter.</p>
</div>
<div class="section" id="return-instruction">
<h6>RETURN$ instruction<a class="headerlink" href="#return-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction terminates a subroutine called by a MAP$&nbsp;EXECUTE
instruction (see sur la page 197).</p>
<p>RETURN$</p>
</div>
<div class="section" id="pop-instruction">
<h6>POP$ instruction<a class="headerlink" href="#pop-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction allows a scenario to delete values from VIRTEL table
variables.</p>
<p>POP$ ALL-VALUES-OF,VAR=&#8217;varname&#8217;</p>
<p>POP$ FIRST-VALUE-OF,VAR=&#8217;varname&#8217;</p>
<p>POP$ VAR=&#8217;varname&#8217;</p>
<div class="line-block">
<div class="line"><strong>ALL-VALUES-OF</strong></div>
<div class="line">indicates that all values of the table variable are to be deleted.</div>
</div>
<div class="line-block">
<div class="line"><strong>FIRST-VALUE-OF</strong></div>
<div class="line">indicates that the first value of a table variable is to be deleted.
If the variable contains only one value, then the variable is deleted
entirely.</div>
</div>
<p><strong>*varname*</strong> the name of the VIRTEL variable.</p>
<p>POP$&nbsp;VAR=&#8217;varname&#8217; is equivalent to POP$&nbsp;FIRST-VALUE-OF,VAR=&#8217;varname&#8217;</p>
</div>
<div class="section" id="send-instruction">
<h6>SEND$ instruction<a class="headerlink" href="#send-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction allows a scenario to construct the response to an input
request.</p>
<p>SEND$ AS-ANSWER</p>
<p>Sends the contents of a VIRTEL variable as the response to an HTTP
request.</p>
<p>SEND$ AS-ANSWER,VAR=&#8217;varname&#8217;,TYPE=&#8217;filetype&#8217;,EXPIRES=exphdr</p>
<p><strong>*varname*</strong> the name of the VIRTEL variable which contains the
response data.</p>
<p><strong>*filetype*</strong> the file type to be sent in the Content-Type HTTP header.
Typical values are text/plain, text/html, and text/xml</p>
<div class="line-block">
<div class="line"><strong>*exphdr* EXPIRES=IMMEDIATELY</strong> specifies that the response should
not be kept in a cache <em>(this is the default value)</em></div>
<div class="line"><strong>EXPIRES=ENDOFDAY</strong> specifies that the request result can be kept in
cache until end of day</div>
</div>
<p>The SEND$&nbsp;AS-ANSWER instruction is intended for use with files which can
be displayed directly by the browser (text, html, xml). For other types
of file, which are intended to be saved on the user’s hard drive, use
the SEND$&nbsp;AS-FILE instruction instead.</p>
<p>If the line type is not HTTP, the SEND$&nbsp;AS-ANSWER and SEND$&nbsp;AS-FILE
instructions are processed as SEND$&nbsp;VARIABLE-TO-LINE (see sur la page
212) with the LINE parameter set to the line on which the scenario is
running.</p>
<p>SEND$ AS-FILE</p>
<p>Sends the contents of a VIRTEL variable as an attached file in response
to an HTTP request. Unlike the SEND$&nbsp;AS-ANSWER instruction, the response
includes a Content-Disposition: Attachment header, which means that the
browser displays a “Save As” dialog box instead of attempting to display
the file in the browser window.</p>
<p>SEND$ AS-FILE,VAR=&#8217;varname&#8217;,TYPE=&#8217;filetype&#8217;,NAME=&#8217;filename&#8217;</p>
<p><strong>*varname*</strong> the name of the VIRTEL variable which contains the file.</p>
<p><strong>*filetype*</strong> the file type to be sent in the Content-Type HTTP header.
This parameter may be specified as a literal, or as &#8216;**varname*&#8217; where
<em>varname</em> is the name of a VIRTEL variable whose value is the filetype.
Examples of typical file types are application/pdf, application/x-tar</p>
<p><strong>*filename*</strong> the file name to be included in the Content-Disposition
HTTP header. This parameter may be specified as a literal, or as
&#8216;**varname*&#8217; where <em>varname</em> is the name of a VIRTEL variable whose
value is the filename.</p>
<p>SEND$ TO</p>
<p>Sends an outbound message to a VIRTEL line. The name of the destination
line is specified indirectly through a VIRTEL transaction. The SEND$&nbsp;TO
instruction must be preceded by an OPTION$ instruction (see sur la page
201) which sets up the parameters for the outbound message according to
the line type.</p>
<p>SEND$ TO,&#8217;tranname&#8217;,PARMS=&#8217;varnamep&#8217;,</p>
<p>MAXTIME=maxtime,ERROR=errlabel</p>
<p><strong>*tranname*</strong> the external name of a VIRTEL transaction defined under
the entry point applicable to this scenario. In the transaction
definition, the “Application type” field must be 5 and the “Application”
field must be the internal or external name of a VIRTEL line.</p>
<p><strong>*varnamep*</strong> the name of the VIRTEL variable which contains the
parameter list. This variable must have been created by a previous
OPTION$ instruction.</p>
<p><strong>*maxtime*</strong> the maximum time, in hundredths of a second, to wait for
the response for an outbound HTTP call.</p>
<p><strong>*errlabel*</strong> A branch will be made to this label if the message cannot
be sent to the requested line or if the <em>maxtime</em> is exceeded.</p>
<p>SEND$ TO-LINE</p>
<p>Sends an outbound message on the specified line. SEND$&nbsp;TO-LINE is
identical to SEND$&nbsp;TO except that the name of the line is specified
directly in the scenario instead of via a transaction. The SEND$&nbsp;TO-LINE
instruction must be preceded by an OPTION$ instruction (see sur la page
201) which sets up the parameters for the outbound message according to
the line type.</p>
<p>SEND$ TO-LINE,LINE=&#8217;linename&#8217;,PARMS=&#8217;varnamep&#8217;,</p>
<p>MAXTIME=hsecs,ERROR=errlabel</p>
<p><strong>*linename*</strong> the name of the VIRTEL line on which the message is to be
sent. This may be the internal or external name of a line defined in the
VIRTEL configuration.</p>
<p><strong>*varnamep*</strong> the name of the VIRTEL variable which contains the
parameter list. This variable must have been created by a previous
OPTION$ instruction.</p>
<p><strong>*maxtime*</strong> the maximum time, in hundredths of a second, to wait for
the response for an outbound HTTP call.</p>
<p><strong>*errlabel*</strong> A branch will be made to this label if the message cannot
be sent to the requested line or if the <em>maxtime</em> is exceeded.</p>
<p>SEND$ VARIABLE-TO</p>
<p>Sends the contents of the specified variable as an outbound message on a
VIRTEL line. The name of the destination line is specified indirectly
through a VIRTEL transaction. A SEND$&nbsp;VARIABLE-TO instruction is
equivalent to an OPTION$ instruction (see sur la page 203) followed by a
SEND$&nbsp;TO instruction in the case where OPTION$ specifies only a variable
name.</p>
<p>SEND$ VARIABLE-TO,tranname,VAR=&#8217;varname&#8217;,ERROR=label</p>
<p><strong>*tranname*</strong> the external name of a VIRTEL transaction defined under
the entry point applicable to this scenario. In the transaction
definition, the “Application type” field must be 5 and the “Application”
field must be the internal or external name of a VIRTEL line.</p>
<p><strong>*varname*</strong> the name of the VIRTEL variable which contains data to be
written to the line.</p>
<p><strong>*errlabel*</strong> A branch will be made to this label if the message cannot
be sent to the requested line.</p>
<p>Note: when an input scenario sends a variable to a VIRPASS line, the
response from the VIRPASS line is passed to the output scenario in the
$VIRPASS$ variable.</p>
<p>SEND$ VARIABLE-TO-LINE</p>
<p>Sends the contents of the specified variable as an outbound message on
the specified VIRTEL line. SEND$&nbsp;VARIABLE-TO-LINE is identical to
SEND$&nbsp;VARIABLE-TO except that the name of the line is specified directly
in the scenario instead of via a transaction. A SEND$&nbsp;VARIABLE-TO-LINE
instruction is equivalent to an OPTION$ instruction (see sur la page
203) followed by a SEND$&nbsp;TO-LINE instruction in the case where OPTION$
specifies only a variable name.</p>
<p>SEND$ VARIABLE-TO-LINE,VAR=&#8217;varname&#8217;,LINE=&#8217;linename&#8217;,ERROR=label</p>
<p><strong>*varname*</strong> the name of the VIRTEL variable which contains data to be
written to the line.</p>
<p><strong>*linename*</strong> the name of the VIRTEL line on which the message is to be
sent. This may be the internal or external name of a line defined in the
VIRTEL configuration.</p>
<p><strong>*errlabel*</strong> A branch will be made to this label if the message cannot
be sent to the requested line.</p>
</div>
<div class="section" id="set-instruction">
<h6>SET$ instruction<a class="headerlink" href="#set-instruction" title="Permalink to this headline">¶</a></h6>
<p>This instruction allows various parameters to be set.</p>
<p>SET$ ENCODING</p>
<p>The SET$&nbsp;ENCODING instruction allows a scenario specify the default
encoding for subsequent pages sent to the terminal, and the encoding of
subsequent URLs for this session.</p>
<p>SET$ ENCODING,UTF-8,&#8217;charset&#8217;</p>
<p>SET$ ENCODING,UTF-8</p>
<p>SET$ ENCODING,ISO-FOR-COUNTRY,&#8217;country&#8217;</p>
<p>SET$ ENCODING,ISO-FOR-COUNTRY</p>
<p><strong>*UTF-8*</strong> specifies that the terminal will be placed in UTF-8 mode.</p>
<p><strong>*charset*</strong> specifies the name of the UTF-8 translation table to be
used. Refer to the DEFUTF8 parameter in the section “Parameters of the
VIRTCT” in the <em>VIRTEL Installation Guide</em> for a list of valid
translation table names. If <em>charset</em> is not specified, the value of the
DEFUTF8 parameter in the VIRTCT is used.</p>
<div class="line-block">
<div class="line"><strong>*ISO-FOR-COUNTRY*</strong></div>
<div class="line">specifies that the terminal will be placed in ISO mode.</div>
</div>
<p><strong>*country*</strong> specifies the name of the ISO translation table to be
used. Refer to the SET-COUNTRY-CODE tag sur la page 69 for a list of
valid country names. If <em>country</em> is not specified, the value of the
COUNTRY parameter in the VIRTCT is used.</p>
<p>By default, VIRTEL expects query parameters in the URL to be encoded in
the same character set as the last page sent to the user. For the first
URL of a session, where no page has yet been sent to the user, VIRTEL
assumes the ISO encoding for the default country. The SET$&nbsp;ENCODING
instruction allows a scenario to override this default.</p>
<p>The following example shows part of an input scenario. The scenario
allows the user to override the default input encoding for query
parameters by specifying either IE=UTF-8 or IE=ISO as an additional
parameter of the URL.</p>
<p>COPY$ INPUT-TO-VARIABLE,FIELD=&#8217;IE&#8217;,VAR=&#8217;IE&#8217;</p>
<p>IF$ NOT-FOUND,THEN=SUITE</p>
<p>CASE$ &#8216;IE&#8217;, *</p>
<p>(EQ,&#8217;UTF-8&#8217;,SETUTF8), *</p>
<p>(EQ,&#8217;ISO&#8217;,SETISO), *</p>
<p>ELSE=SUITE</p>
<p>SETUTF8 SET$ ENCODING,UTF-8,&#8217;IBM1147&#8217;</p>
<p>GOTO$ SUITE</p>
<p>SETISO SET$ ENCODING,ISO-FOR-COUNTRY,&#8217;US&#8217;</p>
<p>SUITE EQU *</p>
<p>See also the SET$&nbsp;URL-ENCODING instruction, described sur la page 216.</p>
<p>SET$ PAGE</p>
<p>Indicates the name of the page template to be used for the current 3270
screen and all subsequent screens. This instruction has the same effect
as the HOST4WEB command S GLOBAL PAGE.</p>
<p>SET$ PAGE,&#8217;pagename&#8217;</p>
<p>SET$ PAGE-FROM-VARIABLE</p>
<p>This instruction is similar to SET$&nbsp;PAGE except that the name of the
page template is contained in a VIRTEL variable.</p>
<p>SET$ PAGE-FROM-VARIABLE,&#8217;varname&#8217;,&#8217;suffix&#8217;</p>
<p><strong>*varname*</strong> the name of the VIRTEL variable which contains the page
name. Trailing blanks are removed.</p>
<p><strong>*suffix*</strong> a character string to be appended to the page name.</p>
<p>Example:</p>
<p>COPY$ SCREEN-TO-VARIABLE,SCREEN=(02,12,05),VAR=&#8217;MYSCREEN&#8217;</p>
<p>SET$ PAGE-FROM-VARIABLE,&#8217;MYSCREEN&#8217;,&#8217;.html&#8217;</p>
<p>In this example, if row 2 column 12 of the 3270 screen contains the
characters “MAPъъ” (where ъ represents a blank) then the page name will
be set to “MAP.html”</p>
<p>SET$ PRIORITY</p>
<p>Allows a running scenario to reduce its priority in order to limit its
CPU consumption.</p>
<p>SET$ PRIORITY,level</p>
<p><strong>*level*</strong> specifies the priority to be assigned to the scenario. The
following values may be specified:</p>
<p><strong>*LOW*</strong> the scenario runs at low priority</p>
<p><strong>*MEDIUM*</strong> the scenario runs at medium priority</p>
<p><strong>*HIGH*</strong> the scenario runs at high priority. This is the default
priority assigned to a scenario if no SET$&nbsp;PRIORITY instruction is
executed.</p>
<p>SET$ SIGNON</p>
<p>Allows an IDENTIFICATION scenario to sign on to the security manager.</p>
<p>SET$ SIGNON,&#8217;userid&#8217;,&#8217;password&#8217;,[&#8216;newpassword&#8217;],&#8217;retvar&#8217;</p>
<p><strong>*userid*</strong> The user name.</p>
<p><strong>*password*</strong> The user’s current password.</p>
<p><strong>*newpassword*</strong> The new password, if the user’s current password is to
be changed.</p>
<p><strong>*retvar*</strong> The name of a VIRTEL variable into which the security
manager return code will be stored. The return code is stored as a
decimal string (for example, &#8216;0&#8217;).</p>
<p>The user name and password fields may be specified as a string constant
(not recommended), or as the name of a VIRTEL variable preceded by an
asterisk. The <em>retvar</em> variable name is not preceded by an asterisk.</p>
<p>SET$ TEMPORARY-PAGE</p>
<p>Indicates the name of the page template to be used for the current 3270
screen (but not for subsequent screens). This instruction has the same
effect as the HOST4WEB command S PAGE.</p>
<p>SET$ TEMPORARY-PAGE,&#8217;pagename&#8217;</p>
<p>SET$ TRANSACTION</p>
<p>Allows an IDENTIFICATION scenario to select the transaction which will
be executed.</p>
<p>SET$ TRANSACTION,&#8217;tranname&#8217;</p>
<p><strong>*tranname*</strong> The external name of the transaction to be executed.</p>
<p>SET$ URL-ENCODING</p>
<p>The SET$&nbsp;URL-ENCODING instruction is similar to the SET$&nbsp;ENCODING
instruction, except that SET$&nbsp;URL-ENCODING applies only to URLs received
from the terminal, without affecting the default encoding for pages sent
to the terminal.</p>
<p>SET$ URL-ENCODING,UTF-8,&#8217;charset&#8217;</p>
<p>SET$ URL-ENCODING,UTF-8</p>
<p>SET$ URL-ENCODING,ISO-FOR-COUNTRY,&#8217;country&#8217;</p>
<p>SET$ URL-ENCODING,ISO-FOR-COUNTRY</p>
<p>Refer to the SET$&nbsp;ENCODING instruction sur la page 213 for a description
of the parameters.</p>
<p>The SET$&nbsp;URL-ENCODING instruction can be used in an identification
scenario to specify the encoding for the first URL of a session, where
no page has yet been sent to the user. If the encoding is not set by a
scenario, VIRTEL assumes that the first URL of a session is encoded
using the ISO encoding for the default country.</p>
</div>
<div class="section" id="tovar-instruction">
<h6>TOVAR$ instruction<a class="headerlink" href="#tovar-instruction" title="Permalink to this headline">¶</a></h6>
<p>The TOVAR$ instruction assists in the generation of XML from a
fixed-format data area known as a commarea. The TOVAR$ instruction works
in conjunction with the MAP$ instruction, which describes the format of
the commarea and its relation to the XML datastream.</p>
<p>Whereas the MAP$ instruction allows the XML stream to be converted into
commarea format, the TOVAR$ instruction uses the MAP$ instructions to
perform the reverse operation (“commarea-to-output” conversion). In
other words, it takes a commarea as input and generates a series of
VIRTEL variables, which, with the aid of a suitable page template, can
be used to generate XML. See “VIRTEL as an XML parser/generator” sur la
page 245.</p>
<p>The input commarea is specified according to one of the several formats
of the TOVAR$ instruction, as shown in the following paragraphs.</p>
<p>TOVAR$ FROM-FIELD</p>
<p>The TOVAR$&nbsp;FROM-FIELD instruction requests VIRTEL to generate a set of
VIRTEL variables from an input commarea. The input commarea is obtained
from an HTML form field in the incoming HTTP request. The
TOVAR$&nbsp;FROM-FIELD instruction is normally contained in an INITIAL
scenario.</p>
<p>groupname TOVAR$ FROM-FIELD,FIELD=&#8217;fieldname&#8217;</p>
<p><strong>*groupname*</strong> The label is required. It specifies the name of the
input commarea. It must match the label on a preceding MAP$&nbsp;BEGIN
instruction.</p>
<p><strong>*fieldname*</strong> The name of the HTML form field which contains the input
commarea data.</p>
<p>TOVAR$ FROM-INPUT</p>
<p>The TOVAR$&nbsp;FROM-INPUT instruction requests VIRTEL to generate a set of
VIRTEL variables from an input commarea. The input commarea is obtained
from the data area of the incoming HTTP request. The TOVAR$&nbsp;FROM-INPUT
instruction is normally contained in an INITIAL scenario.</p>
<p>groupname TOVAR$ FROM-INPUT</p>
<p><strong>*groupname*</strong> The label is required. It specifies the name of the
input commarea. It must match the label on a preceding MAP$&nbsp;BEGIN
instruction.</p>
<p>Note: TOVAR$&nbsp;FROM-INPUT with a FIELD parameter is accepted and treated
as TOVAR$&nbsp;FROM-FIELD</p>
<p>The TOVAR$&nbsp;FROM-FIELD and TOVAR$&nbsp;FROM-INPUT instructions both obtain
their data from an incoming HTTP request. The HTTP request may use
either via the GET method (where the input data is appended to the URL)
or the POST method (where the input data is contained in the request
body). The difference between the two instructions is that
TOVAR$&nbsp;FROM-INPUT treats the entire data area as commarea data without
any translation, whereas TOVAR$&nbsp;FROM-FIELD expects the data to be in the
format fieldname=commareadata where commareadata is interpreted as
URL-encoded data (a “+” sign represents a space, and “%xx” represents
the hexadecimal encoding of an ASCII character). TOVAR$&nbsp;FROM-FIELD is
preferred when using the GET method, because certain characters cannot
be included in a URL without using URL-encoding.</p>
<p>TOVAR$ FROM-VARIABLE</p>
<p>The TOVAR$&nbsp;FROM-VARIABLE instruction requests VIRTEL to generate a set
of VIRTEL variables from an input commarea. The input commarea is
contained in a VIRTEL variable. The TOVAR$&nbsp;FROM-VARIABLE instruction is
normally contained in an OUTPUT scenario.</p>
<p>groupname TOVAR$ FROM-VARIABLE,VAR=&#8217;varname&#8217;</p>
<p><strong>*groupname*</strong> The label is required. It specifies the name of the
input commarea. It must match the label on a preceding MAP$&nbsp;BEGIN
instruction.</p>
<p><strong>*varname*</strong> The name of the VIRTEL variable which contains the input
commarea data.</p>
</div>
<div class="section" id="virsv-instruction">
<h6>VIRSV$ instruction<a class="headerlink" href="#virsv-instruction" title="Permalink to this headline">¶</a></h6>
<p>The VIRSV$ instruction allows a service program to be called from a
scenario. A service program is an external program which is not part of
VIRTEL but which executes in the VIRTEL address space. The VIRSV service
request manager dispatches work to service programs. Refer to the
document <em>Using VIRSV</em> for details of writing service programs which
execute under the control of VIRSV.</p>
<p>VIRSV$ CALL <strong>or</strong> CALL-REUSE <strong>or</strong> TRANSACTION,</p>
<p>(&#8216;servname&#8217;,&#8217;progname&#8217;),</p>
<p>(NUMBER,&#8217;n&#8217;),</p>
<p>(STRINGZ,&#8217;cc..cc&#8217;),</p>
<p>(IN-VARIABLE,&#8217;varname&#8217;,len),</p>
<p>(OUT-VARIABLE,&#8217;varname&#8217;,len),</p>
<p>OPTION=(option,option,...),</p>
<p>TRACE=(traceopt,traceopt,...),</p>
<p>ERROR=errlabel,TASKS=count</p>
<p><strong>*CALL*</strong> Indicates that a new instance of the service program will be
created for each request.</p>
<p><strong>*CALL-REUSE*</strong> Indicates that the request will be routed to an
existing instance of the service program, if one is available. Otherwise
a new instance of the service program will be started to process this
request, after which the service program will remain active and
available to process further requests.</p>
<p><strong>*TRANSACTION*</strong> Indicates a call to the service program which is part
of a VIRSV transaction.</p>
<p><strong>*servname*</strong> The name assigned to this service. The VIRSV service
request manager uses this name to identify the request queue which will
process this service request. Choose a unique service name for each
service program. If more than one scenario calls the same service
program, the same service name can be used by each scenario, and in this
case the scenarios will all share the same request queue. Alternatively,
each scenario can specify a different service name, in which case there
will be an independent request queue for each scenario. The service name
must consist of at least 6 alphanumeric characters and must be in
quotes.</p>
<p><strong>*progname*</strong> The name of the service program to be called. The program
name must be in quotes.</p>
<p><strong>*option*</strong> One or more of the following options may be specified:</p>
<p><a href="#id162"><span class="problematic" id="id163">**</span></a>CLOSE
<a href="#id164"><span class="problematic" id="id165">**</span></a>for a transaction call, specifies that the transaction is to be
closed after processing this VIRSV$ instruction.</p>
<p><strong>*traceopt*</strong> Specifies activation or deactivation of the VIRSV trace
facility. One or more of the following options may be specified:</p>
<p><strong>APPLICATION-TRACE</strong> or <a href="#id166"><span class="problematic" id="id167">**</span></a>NO-APPLICATION-TRACE
<a href="#id168"><span class="problematic" id="id169">**</span></a>activates or deactivates tracing by the service program (if the
service program supports this type of trace).</p>
<p><strong>CALLS-TRACE</strong> or <a href="#id170"><span class="problematic" id="id171">**</span></a>NO-CALLS-TRACE
<a href="#id172"><span class="problematic" id="id173">**</span></a>activates or deactivates tracing of the requests and responses
passed between VIRTEL and VIRSV.</p>
<p><strong>DISPATCH-TRACE</strong> or <a href="#id174"><span class="problematic" id="id175">**</span></a>NO-DISPATCH-TRACE
<a href="#id176"><span class="problematic" id="id177">**</span></a>activates or deactivates tracing of the VIRSV request queue and task
dispatcher.</p>
<p><strong>MEMORY-TRACE</strong> or <a href="#id178"><span class="problematic" id="id179">**</span></a>NO-MEMORY-TRACE
<a href="#id180"><span class="problematic" id="id181">**</span></a>activates or deactivates tracing of the memory blocks used by VIRSV
and the service program.</p>
<p>The default value of each trace option is determined by VIRSV. The trace
is written to the VSVTRACE file of the VIRTEL started task.</p>
<p><strong>*errlabel*</strong> A branch will be made to this label if the service cannot
be called, or if VIRSV or the service program returned a non-zero return
code.</p>
<p><strong>*count*</strong> The maximum number of concurrent instances of the service
program which can be started for this service name. If there are already
<em>count</em> instances of the requested service program active and in-use
under this service name, the scenario will wait until an instance
becomes available. The default value is 1. This parameter applies only
if the call type is CALL-REUSE.</p>
<p>The remaining fields indicate parameters passed to the service program.
Any number of parameters may be specified in any order. For each
parameter, VIRTEL places either one or two fullwords into the request
input area. Depending on the parameter type, these fullwords may contain
a binary value, an address, or a pair of addresses, as described below.
The address of the request input area is passed to the service program
in the LIST-ADR-REQU field of the LIST-POINTER structure built by the
CALL VSVPSYNC routine.</p>
<div class="line-block">
<div class="line"><strong>*(NUMBER,&#8217;n&#8217;)*</strong></div>
<div class="line">Indicates a parameter passed to the service program. <em>n</em> is a decimal
number whose value is converted to a 32-bit binary integer and stored
in the request input area. The number <em>n</em> must be placed in quotes.</div>
</div>
<div class="line-block">
<div class="line"><strong>*(POINTER-TO-NUMBER,&#8217;n&#8217;)*</strong></div>
<div class="line">Indicates a parameter passed to the service program. <em>n</em> is a decimal
number whose value is converted to a 32-bit binary integer. A fullword
containing the address of this 32-bit value is stored in the request
input area. The number <em>n</em> must be placed in quotes.</div>
</div>
<div class="line-block">
<div class="line"><strong>*(STRINGZ,&#8217;cc..cc&#8217;)*</strong></div>
<div class="line">Indicates a parameter passed to the service program. A terminating
character (X&#8216;00&#8217;) is appended to the character string <em>cc..cc,</em> and a
fullword containing the address of the string is stored in the request
input area. The string must be placed in quotes.</div>
</div>
<div class="line-block">
<div class="line"><strong>*(STRINGZ-FROM-VARIABLE,&#8217;varname&#8217;)*</strong></div>
<div class="line">Indicates a parameter passed to the service program. The value of the
VIRTEL variable <em>varname</em> is copied to a character string and a
terminating character (X&#8216;00&#8217;) is appended. A fullword containing the
address of this null-terminated string is stored in the request input
area. The variable name must be placed in quotes.</div>
</div>
<div class="line-block">
<div class="line"><strong>*(IN-VARIABLE,&#8217;varname&#8217;,len)*</strong></div>
<div class="line">Indicates a parameter passed to the service program. Two fullwords are
stored in the request input area: the first contains the address of
the value of the VIRTEL variable <em>varname</em> and the second contains the
address of a fullword containing the length of this value. The <em>len</em>
parameter is ignored unless it contains the special value <em>*n</em> (see
below). The variable name must be placed in quotes.</div>
</div>
<p>For a scenario which processes an inbound request on an MQ line, the
special variable name &#8216;$INFILE$&#8217; denotes the contents of the input
request.</p>
<div class="line-block">
<div class="line"><strong>*(OUT-VARIABLE,&#8217;varname&#8217;,len)*</strong></div>
<div class="line">Indicates an output parameter returned by the service program. VIRTEL
allocates a buffer of length <em>len</em> and stores two fullwords in the
request input area: the first contains the address of the buffer and
the second contains the address of a fullword which contains the
buffer length. The service program places the output value in the
buffer and updates the length fullword. VIRTEL copies the contents of
the buffer into the VIRTEL variable <em>varname</em> after the service
program returns. The <em>len</em> parameter contains the desired buffer
length (<em>nn</em>, <em>nn</em>K, or <em>nn</em>M), or the special value <em>*n</em> (see
below). The variable name must be placed in quotes.</div>
</div>
<p>Allocating variable length output buffers</p>
<p>A special form of the <em>len</em> parameter may be used to allocate output
buffers whose length varies depending on the length of an input
variable. This is done by specifying the <em>len</em> parameter in the form
<em>*n</em> where <em>n</em> is a decimal number. When the <em>len</em> parameter of an
input variable is specified as <em>*n</em> this means that the actual length
of the variable is divided by <em>n</em> to obtain the unit of measurement.
Subsequent output variables may then specify length <em>*m</em> where <em>m</em> is a
number. This means that the buffer length for that output variable will
be <em>m</em> times the unit of measurement.</p>
<p>For example:</p>
<p>VIRSV$ CALL-REUSE,(&#8216;SERVTAR&#8217;,&#8217;VENTAR&#8217;), *</p>
<p>(NUMBER,&#8216;2&#8217;), *</p>
<p>(IN-VARIABLE,&#8217;$INFILE$&#8217;,*3), *</p>
<p>(OUT-VARIABLE,&#8217;HEADER&#8217;,*1), *</p>
<p>(OUT-VARIABLE,&#8217;BODY&#8217;,*3), *</p>
<p>(OUT-VARIABLE,&#8217;SIGNATURE&#8217;,4), *</p>
<p>ERROR=REJECTQ,TASKS=5</p>
<p>In this example, assume that the variable $INFILE$ has length 4500
bytes. Because its <em>len</em> parameter is specified as *3, VIRTEL
calculates the unit of measurement as 1500. The output variable HEADER
has <em>len</em> set to *1 which means that the buffer length allocated is one
unit, or 1500 bytes. The output variable BODY has len *3 which means
that its buffer length is 3 units, or 4500 bytes. By contrast, the
output variable SIGNATURE has a fixed buffer length of 4 bytes.</p>
<p>If more than one input variable specifies a <em>len</em> parameter in the
format <em>*n</em> then the largest value is taken as the unit of measurement.</p>
</div>
</div>
<div class="section" id="examples-of-virtel-web-modernisation-scenarios">
<h5>Examples of VIRTEL Web Modernisation Scenarios<a class="headerlink" href="#examples-of-virtel-web-modernisation-scenarios" title="Permalink to this headline">¶</a></h5>
<div class="section" id="creation-of-a-list-of-values-for-a-selected-field">
<h6>Creation of a list of values for a selected field<a class="headerlink" href="#creation-of-a-list-of-values-for-a-selected-field" title="Permalink to this headline">¶</a></h6>
<p>Many 3270 applications consist of fields which can take only one of a
restricted set of values. In this case, it is possible to offer the end
user a list of allowable values by requesting VIRTEL to generate the
field in the form of a SELECT rather than in the form of a normal field.
This type of modification is performed by the FIELD$ instruction.</p>
<p>* &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- *</p>
<p>* Example of SELECT, CHECKBOX, and HIDDEN fields *</p>
<p>* &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- *</p>
<p>*</p>
<p>VIRMM01 SCREENS APPL=SYNAPSE,EXEC=NO</p>
<p>*</p>
<p>SCENARIO OUTPUT</p>
<p>*</p>
<p>TMG IF$ (01,12,12),EQ=&#8217;General Menu&#8217;,THEN=MENUG,ELSE=ERRSCRN</p>
<p>*</p>
<p>MENUG FIELD$ (03,20,1),DEFINE-CHOICE,VAL=9</p>
<p>FIELD$ (03,20,1),DEFINE-CHOICE,VAL=8</p>
<p>FIELD$ (03,20,1),DEFINE-CHOICE,VAL=4</p>
<p>FIELD$ (03,20,1),DEFINE-CHOICE,VAL=3</p>
<p>FIELD$ (03,20,1),DEFINE-CHOICE,VAL=2</p>
<p>FIELD$ (03,20,1),DEFINE-CHOICE,VAL=1</p>
<p>*</p>
<p>FIELD$ (05,20,1),IS-BINARY-CHOICE,VAL=&#8217;X&#8217;</p>
<p>*</p>
<p>FIELD$ (07,20,8),HIDE</p>
<p>*</p>
<p>SCENARIO END</p>
<p>*</p>
<p>ERRSCRN ERROR$ 0099</p>
<p>SCRNEND</p>
<p>END</p>
<p>Figure 1‑92 HTTP presentation module: List of values for input field</p>
</div>
<div class="section" id="making-clickable-fields">
<h6>Making clickable fields<a class="headerlink" href="#making-clickable-fields" title="Permalink to this headline">¶</a></h6>
<p>TESTCT1 SCREENS APPL=Demopfks,EXEC=NO</p>
<p>*</p>
<p>SCENARIO OUTPUT</p>
<p>*</p>
<p>IF$ (02,27,27),EQ=&#8217;C O N T A C T C L I E N T&#8217;,THEN=CONTACT</p>
<p>IF$ (02,27,09),EQ=&#8217;STATEMENT&#8217;,THEN=STATMNT,ELSE=ERRSCRN</p>
<p>*</p>
<p>CONTACT DECLARE$ (23,03,02,&#8216;06&#8217;),AS-PFKEY,&#8217;PF6&#8217;</p>
<p>DECLARE$ (23,08,02,&#8217;EF&#8217;),AS-PFKEY,&#8217;CLEAR&#8217;</p>
<p>DECLARE$ (23,18,02,&#8216;02&#8217;),AS-PFKEY,&#8217;PF2&#8217;</p>
<p>DECLARE$ (23,28,02,&#8216;09&#8217;),AS-PFKEY,&#8217;PF9&#8217;</p>
<p>DECLARE$ (23,38,02,&#8216;13&#8217;),AS-PFKEY,&#8217;PF13&#8217;</p>
<p>DECLARE$ (23,48,02,&#8216;14&#8217;),AS-PFKEY,&#8217;PF14&#8217;</p>
<p>DECLARE$ (23,58,02,&#8216;15&#8217;),AS-PFKEY,&#8217;PF15&#8217;</p>
<p>DECLARE$ (23,68,02,&#8216;16&#8217;),AS-PFKEY,&#8217;PF16&#8217;</p>
<p>SCENARIO END</p>
<p>*</p>
<p>STATMNT DECLARE$ (23,03,02,&#8216;06&#8217;),AS-PFKEY,&#8217;PF6&#8217;</p>
<p>DECLARE$ (23,08,02),AS-PFKEY,&#8217;CLEAR&#8217;</p>
<p>DECLARE$ (23,18,02),AS-PFKEY,&#8217;PF7&#8217;</p>
<p>DECLARE$ (23,28,02),AS-PFKEY,&#8217;PF9&#8217;</p>
<p>DECLARE$ (23,38,02),AS-PFKEY,&#8217;PF13&#8217;</p>
<p>DECLARE$ (23,48,02),AS-PFKEY,&#8217;PF14&#8217;</p>
<p>DECLARE$ (23,58,02),AS-PFKEY,&#8217;PF15&#8217;</p>
<p>DECLARE$ (23,68,02),AS-PFKEY,&#8217;PF17&#8217;</p>
<p>*</p>
<p>* One click, sends PF9 with the cursor position.</p>
<p>DECLARE$ (09,23,08,&#8217;Echéance&#8217;), C</p>
<p>AS-PARAMETER,&#8217;P9&#8217;,&#8217;ZOOM&#8217;,TO=VClick</p>
<p>* A click in position 11,23 sends PF9 with the cursor position.</p>
<p>DECLARE$ (11,23,08),AS-PARAMETER,&#8217;PF9&#8217;,&#8217;ZOOM&#8217;,TO=VClick</p>
<p>*</p>
<p>* A click on the client name invokes an internet google search.</p>
<p>DECLARE$ (04,09,17),AS-HREF,&#8217;&amp;&amp;hl=en&amp;&amp;csr=&#8217;, C</p>
<p>TO=&#8217;<a class="reference external" href="http://www.google.com/search?q=">http://www.google.com/search?q=</a>&#8216;</p>
<p>*</p>
<p>SCENARIO END</p>
<p>*</p>
<p>ERRSCRN ERROR$ 0099</p>
<p>SCRNEND</p>
<p>END</p>
<p>Figure 1‑93 HTTP presentation module: Clickable fields using DECLARE$</p>
</div>
<div class="section" id="adding-calendars-to-date-fields">
<h6>Adding calendars to date fields<a class="headerlink" href="#adding-calendars-to-date-fields" title="Permalink to this headline">¶</a></h6>
<p>By using a combination of an output scenario and a JavaScript
application, date fields on the 3270 screen can be transformed into HTML
fields on which a small calendar window appears when the user clicks on
the field. The user chooses the desired date from the calendar, and
VIRTEL inserts the date in the correct format into the 3270 input field.</p>
<p>An example scenario for declaring date fields is shown below. As usual,
the name of this scenario must be specified in the “Output Scenario”
field of the VIRTEL transaction which calls the host application.</p>
<p>In this example, the correct screen is first identified by using its
screen identifier “DEM275” in row 1 column 2, then three calendar fields
are declared at row 8 column 28, row 8 column 64, and row 9 column 28.
For the purposes of illustration, a different date format is declared
for each field:</p>
<p>SCENCALR SCREENS EXEC=NO</p>
<p>SCENARIO OUTPUT</p>
<p>*</p>
<p>* Identify the correct screen</p>
<p>*</p>
<p>IF$ (01,02,06),EQ=&#8217;DEM275&#8217;,THEN=MENU275</p>
<p>SCENARIO END</p>
<p>*</p>
<p>* Declare the calendar fields</p>
<p>*</p>
<p>MENU275 EQU *</p>
<p>CALENDR$ SCREEN=(8,28),DATEFMT=&#8217;%Y%m%d&#8217;</p>
<p>CALENDR$ SCREEN=(8,64),DATEFMT=&#8217;%m/%d/%y&#8217;</p>
<p>CALENDR$ SCREEN=(9,28),DATEFMT=&#8217;%e-%b-%Y&#8217;</p>
<p>SCENARIO END</p>
<p>SCRNEND</p>
<p>END</p>
<p>Figure 1‑94 HTTP presentation module: Defining calendar fields</p>
<p>In the DATEFMT parameter:</p>
<p>%Y represents the year (4 digits)</p>
<p>%y represents the year (2 digits)</p>
<p>%d represents the day of the month (01-31)</p>
<p>%e represents the day of the month (1-31)</p>
<p>%m represents the month (01-12)</p>
<p>%b represents the abbreviated month name (Jan, Feb, etc)</p>
<p>Refer to the Date.prototype.print function in the <em>calendar.js</em> file for
details of all of the allowable date formats.</p>
<p>The CALENDR$ macro generates two VIRTEL table variables: CALENDAR and
DATEFMT. The CALENDAR variable contains the VIRTEL-generated names of
the 3270 fields which are to be processed as calendar fields. The
DATEFMT variable contains the corresponding date formats for each field.</p>
<p>The page template must include logic to call the calendar application
whenever the output screen has declared calendar fields. The extract
below shows the necessary statements which are included in the VIRTEL
sample page WEB2VIRT.htm:</p>
<p><strong>*In the &lt;head&gt; section:*</strong></p>
<p>{{{ WHEN-EXISTS &#8220;CALENDAR&#8221; }}}</p>
<p>&lt;link rel=&#8221;stylesheet&#8221; type=&#8221;text/css&#8221; media=&#8221;all&#8221;</p>
<p>href=&#8221;dynarch/cal-w2k-c1.css&#8221; title=&#8221;win2k-cold-1&#8221; /&gt;</p>
<p>&lt;script type=&#8221;text/javascript&#8221; src=&#8221;dynarch/calendar.js&#8221;&gt;&lt;/script&gt;</p>
<p>&lt;script type=&#8221;text/javascript&#8221; src=&#8221;dynarch/cal-en.js&#8221;&gt;&lt;/script&gt;</p>
<p>&lt;script type=&#8221;text/javascript&#8221; src=&#8221;dynarch/cal-setup.js&#8221;&gt;&lt;/script&gt;</p>
<p>{{{ SET-LOCAL-OPTIONS (ID) }}}</p>
<p>{{{ END-WHEN-EXISTS &#8220;CALENDAR&#8221; }}}</p>
<p><strong>*After the &lt;form&gt; section:*</strong></p>
<p>{{{ WHEN-EXISTS &#8220;CALENDAR&#8221; }}}</p>
<p>&lt;script language=&#8221;javascript&#8221; type=&#8221;text/javascript&#8221;&gt;</p>
<p>{{{ FOR-EACH-VALUE-IN &#8220;CALENDAR&#8221; }}}</p>
<p>Calendar.setup({inputField:&#8221;{{{CURRENT-VALUE-OF &#8220;CALENDAR&#8221;}}}&#8221;,</p>
<p>ifFormat:&#8221;{{{CURRENT-VALUE-OF &#8220;DATEFMT&#8221;}}}&#8221;});</p>
<p>{{{ END-FOR &#8220;CALENDAR&#8221; }}}</p>
<p>&lt;/script&gt;</p>
<p>{{{ END-WHEN-EXISTS &#8220;CALENDAR&#8221; }}}</p>
<p>Figure 1‑95 HTML page template for calendar fields</p>
</div>
<div class="section" id="virtel-suggest">
<h6>VIRTEL suggest<a class="headerlink" href="#virtel-suggest" title="Permalink to this headline">¶</a></h6>
<p>VIRTEL Suggest is a facility which presents lists of suggested values
for specific 3270 fields. The suggested values are presented in a
drop-down list which appears automatically when the user starts typing
into a field. The list modifies itself dynamically as the user types. At
any time the user can select one of the suggested values by clicking or
moving the cursor to the desired value.</p>
<p>Fields eligible for processing by VIRTEL Suggest are identified by means
of an output scenario containing SUGGEST$ macros. Each SUGGEST$ macro
identifies a “suggest” field and indicates the data source for the list
of suggested values. The data source may be a DB2 table, a FLECS
application <a class="footnote-reference" href="#id209" id="id182">[1]</a>, or a user-written CICS transaction.</p>
<p>An example scenario for declaring a “suggest” field is shown below. As
usual, the name of this scenario must be specified in the “Output
Scenario” field of the VIRTEL transaction which calls the host
application.</p>
<p>In this example, the correct screen is first identified by using its
screen identifier “VIR0091” in row 1 column 2, then a VIRTEL Suggest
field is declared at row 8 column 21. The data source for this field is
column “LASTNAME” in the DB2 table named “DSN8810.EMP”:</p>
<p>SCENAJAX SCREENS EXEC=NO</p>
<p>*</p>
<p>* DEMONSTRATION SCENARIO FOR VIRTEL-SUGGEST FUNCTIONS</p>
<p>*</p>
<p>* The purpose of this scenario is to activate</p>
<p>* a VIRTEL-Suggest field in the demo application VIR0091.</p>
<p>*</p>
<p>SCENARIO OUTPUT</p>
<p>IF$ (1,2,7),EQ=&#8217;VIR0091&#8217;,THEN=DEMOAPPL</p>
<p>SCENARIO END</p>
<p>*</p>
<p>* The test panel identifier is VIR0091</p>
<p>*</p>
<p>DEMOAPPL EQU *</p>
<p>*</p>
<p>* Activate VIRTEL-Suggest in the NAME field</p>
<p>*</p>
<p>SUGGEST$ TRAN=&#8217;suggestD&#8217;</p>
<p>SUGGEST$ TABLE=&#8217;DSN8810.EMP&#8217;</p>
<p>SUGGEST$ SCREEN=(8,21),FIELD=&#8217;LASTNAME&#8217;</p>
<p>*</p>
<p>SCENARIO END</p>
<p>SCRNEND</p>
<p>END</p>
<p>Figure 1‑96 HTTP presentation module: Defining VIRTEL Suggest fields</p>
<p>SUGGEST$ instruction</p>
<p>The parameters of the SUGGEST$ macro instruction are as follows:</p>
<div class="line-block">
<div class="line"><strong>TRAN=&#8217;name&#8217;</strong> the name of the VIRTEL transaction which provides the
link to the data source for the field. The following transactions are
supplied as standard in the VIRTEL entry point WEB2HOST:</div>
<div class="line"><strong>suggestD</strong> Data source is a column in a DB2 table</div>
<div class="line"><strong>suggestF</strong> Data source is a field in a FLECS application (via CICS)</div>
<div class="line"><strong>suggestV</strong> Data source is a field in a FLECS application (via
VIRTEL)</div>
</div>
<p><strong>TABLE=&#8217;name&#8217;</strong> the name of the DB2 table, or the name of the FLECS
application</p>
<p><strong>FIELD=&#8217;name&#8217;</strong> the name of the DB2 column, or the name of the FLECS
field</p>
<div class="line-block">
<div class="line"><strong>SCREEN=(row,col)</strong></div>
<div class="line">the screen position (row, column) of the field on the 3270 screen</div>
</div>
<p>A SUGGEST$ instruction containing only TRAN and/or TABLE parameters may
be used to set the values for subsequent SUGGEST$ instructions. Each
SUGGEST$ instruction which contains a SCREEN parameter and a FIELD
parameter generates a VIRTEL Suggest field. If the TRAN and TABLE
parameters are not specified then the values from the previous SUGGEST$
instruction are used.</p>
<p>Installation pre-requisites</p>
<p>Before you can use the suggestD transaction, you must install the
program VDBSUGST in your CICS system with transaction code VDBS. The JCL
to compile, link, and bind this program is in member DB2COBC of
VIRTEL.SAMPLIB. You must also update the definition of the suggestD
transaction (W2H-53 in the WEB2HOST entry point) to specify the VTAM
applid of the appropriate CICS region.</p>
<p>The suggestF transaction requires the FLECS product to be installed in
your CICS system. You must also update the definition of the suggestF
transaction (W2H-51 in the WEB2HOST entry point) to specify the VTAM
applid of the CICS region in which FLECS is installed.</p>
<p>If you plan to use the suggestV transaction, you must add DD statements
to the VIRTEL started task JCL specifying the FLECS catalog file
(F20CAT) and the pointer files it references. You must also update the
VIRTCT by adding UFILEn parameters for the FLECS catalog file and each
pointer file, together with the corresponding ACB definitions.</p>
<p>Page template for VIRTEL Suggest</p>
<p>The page template must include logic to call the data source transaction
whenever the output screen has declared VIRTEL Suggest fields. The
extract below shows the necessary statements which are included in the
VIRTEL sample page WEB2VIRT.htm:</p>
<p><strong>*In the &lt;head&gt; section:*</strong></p>
<p>{{{ WHEN-EXISTS &#8220;SUGGEST-ELEMENT&#8221; }}}</p>
<p>&lt;link rel=&#8221;stylesheet&#8221; type=&#8221;text/css&#8221; href=&#8221;suggest.css&#8221; /&gt;</p>
<p>&lt;script type=&#8221;text/javascript&#8221; src=&#8221;suggest.js&#8221;&gt;&lt;/script&gt;</p>
<p>{{{ END-WHEN-EXISTS &#8220;SUGGEST-ELEMENT&#8221; }}}</p>
<p><strong>*After the &lt;form&gt; section:*</strong></p>
<p>{{{ WHEN-EXISTS &#8220;SUGGEST-ELEMENT&#8221; }}}</p>
<p>{{{ FOR-EACH-VALUE-IN &#8220;SUGGEST-ELEMENT&#8221; }}}</p>
<p>var o{{{CURRENT-VALUE-OF &#8220;SUGGEST-ELEMENT&#8221;}}}box = new
AutoSuggestControl(</p>
<p>&#8220;{{{CURRENT-VALUE-OF &#8220;SUGGEST-ELEMENT&#8221;}}}&#8221;,</p>
<p>new VirtelSuggestions(),</p>
<p>&#8220;{{{CURRENT-VALUE-OF &#8220;SUGGEST-TRANSNAME&#8221;}}}&#8221;,</p>
<p>&#8220;{{{CURRENT-VALUE-OF &#8220;SUGGEST-TABLENAME&#8221;}}}&#8221;,</p>
<p>&#8220;{{{CURRENT-VALUE-OF &#8220;SUGGEST-FIELDNAME&#8221;}}}&#8221;);</p>
<p>{{{ END-FOR &#8220;SUGGEST-ELEMENT&#8221; }}}</p>
<p>{{{ END-WHEN-EXISTS &#8220;SUGGEST-ELEMENT&#8221; }}}</p>
<p>Figure 1‑97 HTML page template for VIRTEL Suggest fields</p>
<p>The SUGGEST$ macro instruction generates four VIRTEL table variables:
SUGGEST-ELEMENT, SUGGEST-TRANSNAME, SUGGEST-TABLENAME,
SUGGEST-FIELDNAME. The first entry in each table corresponds to the
first VIRTEL Suggest field on the page, the second entry corresponds to
the second VIRTEL Suggest field on the page, and so on.</p>
</div>
<div class="section" id="auto-refresh">
<h6>Auto-refresh<a class="headerlink" href="#auto-refresh" title="Permalink to this headline">¶</a></h6>
<p>The majority of host applications use the 3270 protocol in a synchronous
manner, meaning that each user input (ENTER or PF key) generates one
response consisting of a 3270 screen built by a single VTAM message.
Certain host applications, however, may build a 3270 screen in two or
more segments, by sending more than one VTAM message to the terminal.
Other applications may send asynchronous updates to a 3270 screen which
are not a direct result of user input. Such applications need special
handling to ensure that VIRTEL can present the updated 3270 screen image
to the user without requiring the user to press ENTER to refresh the
screen. VIRTEL handles this situation by means of an AJAX request
containing the VerifyVirtelSession keyword (see “3270 session
management” sur la page 17). By using an output scenario with a suitable
page template, the HTML page can determine whether the 3270 screen image
has been updated, and if so can dynamically refresh the data displayed
in the browser.</p>
<p>An example scenario is shown below. As usual, the name of this scenario
must be specified in the “Output Scenario” field of the VIRTEL
transaction which calls the host application. This scenario is supplied
as member SCENREFR in the VIRTEL SAMPLIB:</p>
<p>SCENREFR SCREENS EXEC=NO</p>
<p>*</p>
<p>* SCENARIO FOR MVS CONSOLE APPLICATION</p>
<p>*</p>
<p>SCENARIO OUTPUT</p>
<p>IF$ (1,11,7),EQ=&#8217;SNACONS&#8217;,THEN=REFR1</p>
<p>IF$ (21,3,7),EQ=&#8217;IEE612I&#8217;,THEN=REFR2</p>
<p>SCENARIO END</p>
<p>*</p>
<p>* SET AUTOREFRESH ONCE FOR SIGNON SCREEN</p>
<p>*</p>
<p>REFR1 EQU *</p>
<p>COPY$ VALUE-TO-VARIABLE,VAR=&#8217;AUTOREFRESH&#8217;,VALUE=&#8217;ONCE&#8217;</p>
<p>SCENARIO END</p>
<p>*</p>
<p>* SET AUTOREFRESH EVERY 2 SECONDS FOR CONSOLE SCREEN</p>
<p>*</p>
<p>REFR2 EQU *</p>
<p>COPY$ VALUE-TO-VARIABLE,VAR=&#8217;AUTOREFRESH&#8217;,VALUE=&#8216;2&#8217;</p>
<p>SCENARIO END</p>
<p>*</p>
<p>SCRNEND</p>
<p>END</p>
<p>Figure 1‑98 HTTP presentation module: 3270 auto-refresh</p>
<p>This example activates auto-refresh for two specific application
screens. The first screen, identified by the word “SNACONS” in row 1
column 11, is built by the application in two parts. For this screen,
the AUTOREFRESH variable is set to “ONCE” which causes the page template
to return to VIRTEL one time only to request the second part of the
screen. The second screen, identified by “IEE612I” in row 21 column 3,
is updated continuously by the application. For this screen, the
AUTOREFRESH variable is set to “2” which causes the browser to issue an
AJAX request every two seconds to ask VIRTEL if the screen has been
updated. A positive response from VIRTEL triggers a request to refresh
the screen.</p>
<p>The following table shows the permissible values for the AUTOREFRESH
variable:</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Value</strong></td>
<td><strong>Meaning</strong></td>
</tr>
<tr class="row-even"><td>nnn</td>
<td>refresh once, then every <em>nnn</em> seconds</td>
</tr>
<tr class="row-odd"><td>nnn,max</td>
<td>refresh once, then after <em>nnn</em> seconds, then double the interval after each refresh, with a maximum interval of <em>max</em> seconds</td>
</tr>
<tr class="row-even"><td><strong>ONCE</strong></td>
<td>refresh once only</td>
</tr>
<tr class="row-odd"><td><strong>NO</strong> or <strong>NONE</strong></td>
<td>do not refresh</td>
</tr>
</tbody>
</table>
<p>Figure 1‑99 Settings for 3270 auto-refresh</p>
<p>The page template must include logic to process the AUTOREFRESH variable
and issue the necessary AJAX functions. The extract below shows the
necessary statements which are included in the VIRTEL sample page
WEB2VIRT.htm:</p>
<p><strong>*In the &lt;head&gt; section:*</strong></p>
<p>&lt;script src=&#8221;js01.js&#8221; type=&#8221;text/javascript&#8221;&gt;&lt;/script&gt;</p>
<p><strong>*After the &lt;form&gt; section:*</strong></p>
<p>&lt;script&gt;</p>
<p>{{{ WHEN-EXISTS &#8220;AUTOREFRESH&#8221; }}}</p>
<p>AutoRefresh(&#8220;{{{CURRENT-VALUE-OF &#8220;AUTOREFRESH&#8221;}}}&#8221;,sesscode);</p>
<p>{{{ END-WHEN-EXISTS &#8220;AUTOREFRESH&#8221; }}}</p>
<p>{{{ WHEN-NOT-EXISTS &#8220;AUTOREFRESH&#8221; }}}</p>
<p>AutoRefresh(&#8220;1.2,10&#8221;,sesscode);</p>
<p>{{{ END-WHEN-NOT-EXISTS &#8220;AUTOREFRESH&#8221; }}}</p>
<p>&lt;/script&gt;</p>
<p>Figure 1‑100 HTML page template for 3270 auto-refresh</p>
<p>This page supplies a default value which takes effect if no AUTOREFRESH
variable is specified by the scenario. The default value is set to
&#8216;1.2,10&#8217; which means that a refresh will occur immediately after each
screen is loaded, another refresh will occur 1.2 seconds later, then at
intervals of 2.4 seconds, 4.8 seconds, and 9.6 seconds, and finally a
refresh will occur every 10 seconds thereafter.</p>
<p>The autorefresh function may be disabled by specifying SCENAUTN in the
“Output scenario” field of the VIRTEL transaction definition. The source
code for the SCENAUTN scenario is supplied in the VIRTEL SAMPLIB.</p>
</div>
<div class="section" id="pdf-output-generation">
<h6>PDF output generation<a class="headerlink" href="#pdf-output-generation" title="Permalink to this headline">¶</a></h6>
<p>This example shows a scenario which generates a PDF output file using
the MakePDF program product via the service program VIRSVPDF.</p>
<p>SCENPDF SCREENS EXEC=NO</p>
<p>*</p>
<p>* Scenario for generating PDF output using MakePDF</p>
<p>*</p>
<p>SCENARIO IDENTIFICATION</p>
<p>*</p>
<p>* Create INPUT file for MakePDF</p>
<p>COPY$ OUTPUT-FILE-TO-VARIABLE,TYPE=LINEBUFFER, -</p>
<p>FILE=&#8217;INPUT.TXT&#8217;,VAR=&#8217;INPUT&#8217;</p>
<p>* Create DOCOPT file for MakePDF</p>
<p>COPY$ OUTPUT-FILE-TO-VARIABLE,TYPE=LINEBUFFER, -</p>
<p>FILE=&#8217;DOCOPT.TXT&#8217;,VAR=&#8217;DOCOPT&#8217;</p>
<p>* Create LAYOUT file for MakePDF</p>
<p>COPY$ OUTPUT-FILE-TO-VARIABLE,TYPE=LINEBUFFER, -</p>
<p>FILE=&#8217;LAYOUT.TXT&#8217;,VAR=&#8217;LAYOUT&#8217;</p>
<p>* Call service program VIRSVPDF which calls MakePDF</p>
<p>VIRSV$ CALL-REUSE,(&#8216;SERVPDF&#8217;,&#8217;VIRSVPDF&#8217;), -</p>
<p>(IN-VARIABLE,&#8217;INPUT&#8217;,*3), -</p>
<p>(IN-VARIABLE,&#8217;DOCOPT&#8217;,*1), -</p>
<p>(IN-VARIABLE,&#8217;LAYOUT&#8217;,*1), -</p>
<p>(OUT-VARIABLE,&#8217;OUTPUT&#8217;,500K), -</p>
<p>(OUT-VARIABLE,&#8217;MAKEPDFMESSAGE&#8217;,160), -</p>
<p>(NUMBER,&#8216;3&#8217;), MakePDF trace level -</p>
<p>TRACE=(APPLICATION-TRACE, Virsv trace level -</p>
<p>NO-CALLS-TRACE,NO-DISPATCH-TRACE,NO-MEMORY-TRACE), -</p>
<p>ERROR=REJECT,TASKS=1</p>
<p>* Send result to browser</p>
<p>SEND$ AS-FILE,VAR=&#8217;OUTPUT&#8217;, -</p>
<p>TYPE=&#8217;application/pdf&#8217;,NAME=&#8217;my.pdf&#8217;</p>
<p>REJECT EQU *</p>
<p>SCENARIO END</p>
<p>SCRNEND</p>
<p>END</p>
<p>Figure 1‑101 HTTP presentation module: PDF output generation</p>
<p>For the purpose of this scenario, INPUT.TXT, DOCOPT.TXT and LAYOUT.TXT
are files created on a PC, then uploaded to VIRTEL as page templates
(see “Uploading HTML pages” sur la page 85). The TYPE=LINEBUFFER
parameters on the COPY$ statements tell VIRTEL that these files should
be converted to MakePDF “LINEBUF” format. The VIRSV$ statement calls an
intermediary service program VIRSVPDF which sets up the commarea and
calls MakePDF. Then the SEND$ statement sends back the result file to
the browser, giving it the name <strong>*my.pdf*</strong>.</p>
<p>The files INPUT.TXT, DOCOPT.TXT, and LAYOUT.TXT for this example are
shown below:</p>
<p>&lt;!&#8211;VIRTEL start=&#8221;{{{&#8221; end=&#8221;}}}&#8221; &#8211;&gt;</p>
<p>{{{PDF-NEW-INPUT }}}{{{PDF-USE-DOCOPT &#8220;1&#8221;}}}{{{PDF-USE-LAYOUT &#8220;1&#8221;}}}</p>
<p>{{{PDF-LINES-PER-PAGE (5) }}}</p>
<p>PAGE 1 FIRST INPUT</p>
<p>{{{CURRENT-VALUE-OF &#8220;I1&#8221;}}}</p>
<p>{{{PDF-NEW-INPUT }}}{{{PDF-USE-DOCOPT &#8220;1&#8221;}}}{{{PDF-USE-LAYOUT &#8220;2&#8221;}}}</p>
<p>PAGE 2 SECOND INPUT</p>
<p>{{{CURRENT-VALUE-OF &#8220;I2&#8221;}}}</p>
<p>{{{PDF-NEW-INPUT }}}{{{PDF-USE-DOCOPT &#8220;1&#8221;}}}{{{PDF-USE-LAYOUT &#8220;3&#8221;}}}</p>
<p>PAGE 3 THIRD INPUT</p>
<p>{{{CURRENT-VALUE-OF &#8220;I3&#8221;}}}</p>
<p>Figure 1‑102 MakePDF INPUT.TXT file for PDF generation</p>
<p>&lt;!&#8211;VIRTEL start=&#8221;{{{&#8221; end=&#8221;}}}&#8221; &#8211;&gt;</p>
<p>{{{PDF-NEW-DOCOPT &#8220;1&#8221;}}}</p>
<p>OPTIONS COMPRESS=YES</p>
<p>PAGE SIZE=A4 PORTRAIT</p>
<p>DEFINEFONT DEFAULT NATIVE=COURIER-BOLD</p>
<p>DEFAULTFONTSIZE 8 9</p>
<p>DefineFont Font1 Native={{{CURRENT-VALUE-OF &#8220;IF1&#8221;}}}</p>
<p>DefineFont Font2 Native={{{CURRENT-VALUE-OF &#8220;IF2&#8221;}}}</p>
<p>DefineFont Font3 Native={{{CURRENT-VALUE-OF &#8220;IF3&#8221;}}}</p>
<p>DOCINFO AUTHOR=&#8221;SYSPERTEC&#8221;</p>
<p>DEFINEOVERLAY FORM1 FILE=OVERLAY1</p>
<p>DEFINEOVERLAY FORM2 FILE=OVERLAY2</p>
<p>DEFINEOVERLAY FORM3 FILE=OVERLAY3</p>
<p>Figure 1‑103 MakePDF DOCOPT.TXT file for PDF generation</p>
<p>&lt;!&#8211;VIRTEL start=&#8221;{{{&#8221; end=&#8221;}}}&#8221; &#8211;&gt;</p>
<p>{{{PDF-NEW-LAYOUT &#8220;1&#8221;}}}</p>
<p>APPLYOVERLAY FORM1</p>
<p>AT (3.0&#8217; 18.0&#8217;)</p>
<p>TEXTBEGIN</p>
<p>Font Font1 size(8 9)</p>
<p>PAGECONTENTS LINES(ALL)</p>
<p>TEXTEND</p>
<p>;</p>
<p>{{{PDF-NEW-LAYOUT &#8220;2&#8221;}}}</p>
<p>APPLYOVERLAY FORM2</p>
<p>AT (3.0&#8217; 18.0&#8217;)</p>
<p>TEXTBEGIN</p>
<p>Font Font2 size(8 9)</p>
<p>PAGECONTENTS LINES(ALL)</p>
<p>TEXTEND</p>
<p>;</p>
<p>{{{PDF-NEW-LAYOUT &#8220;3&#8221;}}}</p>
<p>APPLYOVERLAY FORM3</p>
<p>AT (3.0&#8217; 18.0&#8217;)</p>
<p>TEXTBEGIN</p>
<p>Font Font3 size(8 9)</p>
<p>PAGECONTENTS LINES(ALL)</p>
<p>TEXTEND</p>
<p>;</p>
<p>Figure 1‑104 MakePDF LAYOUT.TXT file for PDF generation</p>
</div>
</div>
</div>
</div>
<div class="section" id="virtel-web-integration">
<h3>VIRTEL Web Integration<a class="headerlink" href="#virtel-web-integration" title="Permalink to this headline">¶</a></h3>
<p>VIRTEL Web Integration allows XML or other web services requests to be
interpreted and transformed into requests which can be processed by
legacy applications such as CICS/COBOL, with the results being
transformed back into XML format for transmission via HTTP or SMTP.</p>
<div class="section" id="virtel-web-integration-scenarios">
<h4>VIRTEL Web Integration scenarios<a class="headerlink" href="#virtel-web-integration-scenarios" title="Permalink to this headline">¶</a></h4>
<p>By using the scenario language described in section “VIRTEL Scenarios”
sur la page 150, legacy transactions can be converted into Web Services.</p>
<div class="section" id="examples-of-scenarios">
<h5>Examples of scenarios<a class="headerlink" href="#examples-of-scenarios" title="Permalink to this headline">¶</a></h5>
<div class="section" id="parsing-query-input">
<h6>Parsing Query input<a class="headerlink" href="#parsing-query-input" title="Permalink to this headline">¶</a></h6>
<p>By using a combination of an INITIAL scenario and a VIRTEL transaction
script, VIRTEL can transform Query parameters in an HTTP request into a
fixed-format data area for processing by a COBOL legacy application
program.</p>
<p>HTTP request with Query data (GET method)</p>
<p>The HTML page shown below generates an HTTP request with Query
parameters:</p>
<p>&lt;html&gt;&lt;head&gt;&lt;title&gt;Syspertec - Query data for VIRTEL&lt;/title&gt;&lt;/head&gt;</p>
<p>&lt;body&gt;</p>
<p>&lt;FORM METHOD=&#8221;GET&#8221; action=&#8221;querydemo.htm+tranq&#8221;&gt;</p>
<p>&lt;p&gt;Ident number: &lt;input type=&#8221;text&#8221; name=&#8221;num&#8221;&gt;&lt;/input&gt;</p>
<p>&lt;p&gt;Check digits: &lt;input type=&#8221;text&#8221; name=&#8221;key&#8221;&gt;&lt;/input&gt;</p>
<p>&lt;p&gt;Request date: &lt;input type=&#8221;text&#8221; name=&#8221;date&#8221;&gt;&lt;/input&gt;</p>
<p>&lt;p&gt;&lt;button type=&#8221;submit&#8221;&gt;Submit&lt;/button&gt;</p>
<p>&lt;/form&gt;</p>
<p>&lt;/body&gt;&lt;/html&gt;</p>
<p>Figure 1‑105 HTML form for generating Query input data (GET method)</p>
<p>If the user enters, for example, the values “1531499136”, “05”, and
“07/01/15” in the three fields and presses the Submit button, an HTTP
request is presented to VIRTEL in the format shown below:</p>
<p>GET querydemo.htm+tranq?num=1531499136&amp;key=05&amp;date=07%2F01%2F15 HTTP/1.0</p>
<p>Host: 192.168.235.30:41000</p>
<p>Accept: */*</p>
<p>Figure 1‑106 Example HTTP request with Query data (GET method)</p>
<p>Note that the “/” characters in the user’s input have been encoded by
the browser as “%2F” because Query parameters are always transmitted in
URL-encoded format in the HTTP request.</p>
<p>HTTP request with Query data (POST method)</p>
<p>By changing the FORM METHOD to POST (instead of GET) in the HTML form,
the HTTP request can be presented to VIRTEL in the alternative format
shown below:</p>
<p>POST /demohttp/querydemo.htm+tran4 HTTP/1.0</p>
<p>Host: 192.168.235.30:41000</p>
<p>Accept: */*</p>
<p>Content-Type: application/x-www-form-urlencoded</p>
<p>Content-Length: 31</p>
<p>num=1531499136&amp;key=05&amp;date=07%2F01%2F15</p>
<p>Figure 1‑107 Example HTTP request with Query data (POST method)</p>
<p>VIRTEL considers this POST request to be identical to the GET request
presented in the previous paragraph.</p>
<p>Presentation module for Query input data</p>
<p>An example INITIAL scenario for converting this Query data to commarea
format is coded in the presentation module SCENQRYI shown below:</p>
<p>SCENQRYI SCREENS APPL=SCENQRYI</p>
<p>SCENARIO INITIAL</p>
<p>COMMAREA MAP$ BEGIN</p>
<p>MAP$ AREA,WITH=&#8217;num&#8217;,LENGTH=10,TYPE=9</p>
<p>MAP$ AREA,WITH=&#8217;key&#8217;,LENGTH=2,TYPE=9</p>
<p>MAP$ AREA,WITH=&#8217;date&#8217;,LENGTH=8,TYPE=X</p>
<p>COMMAREA MAP$ END</p>
<p>COMMAREA MAP$ FROM-INPUT,QUERY</p>
<p>COMMAREA MAP$ TO-VARIABLE,VAR=&#8217;MYAREA&#8217;</p>
<p>SCENARIO END</p>
<p>SCRNEND</p>
<p>END</p>
<p>Figure 1‑108 HTTP presentation module for Query input data</p>
<p>The same presentation module may be used to process both GET and POST
requests.</p>
<p>Contents of generated commarea</p>
<p>The figure below shows the 20-byte commarea generated in the VIRTEL
variable MYAREA:</p>
<blockquote>
<div><p>&#8212;-+&#8212;-1&#8212;-+&#8212;-2</p>
<p>15314991360507/01/15</p>
</div></blockquote>
<p>Figure 1‑109 Commarea generated from Query data</p>
<p>Transaction definition for Query input data</p>
<p>The HTTP requests shown in the GET and POST examples above use the URL
<em>querydemo.htm+tranq</em> to invoke the VIRTEL transaction shown below
(<em>tranq</em> is the “external name” of the transaction). The “TIOA at logon”
field contains a connection script. After signing on to CICS, the
connection script uses the &amp;/S order to process the INITIAL scenario in
the presentation module SCENQRYI. This scenario converts the Query
parameter input data into a VIRTEL variable named MYAREA. The script
then invokes a CICS transaction VQRY, passing the contents of MYAREA as
input data. The CICS transaction performs an EXEC&nbsp;CICS&nbsp;RECEIVE to obtain
the input data.</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTELD2
15:32:33</p>
<p>Internal name ===&gt; CLI-17Q To associate with an entry point name</p>
<p>External name ===&gt; tranq Name displayed on user menu</p>
<p>Description ===&gt; Demonstration VIRTEL Query</p>
<p>Application ===&gt; CICSPROD Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 1 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; CLVTA Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 1 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 0 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 024 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt; Signon to CICS&amp;/W&amp;*F34BE9&amp;/A</p>
<p>&amp;(&amp;/S VQRY&amp;=MYAREA=&amp;/A&amp;)</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; SCENQRYI Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑110 VIRTEL transaction definition for Query input data</p>
</div>
<div class="section" id="parsing-xml-input">
<h6>Parsing XML input<a class="headerlink" href="#parsing-xml-input" title="Permalink to this headline">¶</a></h6>
<p>By using a combination of an INITIAL scenario and a VIRTEL transaction
script, VIRTEL can transform XML input data in an HTTP request into a
fixed-format data area for processing by a COBOL legacy application
program.</p>
<p>HTTP request with XML input data</p>
<p>The simplest method of sending XML data to VIRTEL is to build an HTTP
POST request containing the raw XML data in the request body. This is
the format expected by the MAP$&nbsp;FROM-INPUT instruction described sur la
page 198. The figure below shows an example of an HTTP request
containing XML input data:</p>
<p>POST /demohttp/xmldemo.xml+tran3 HTTP/1.0</p>
<p>Host: 192.168.235.30</p>
<p>Accept: */*</p>
<p>Content-Length: 197</p>
<p>&lt;?xml version=&#8221;1.0&#8221; ?&gt;</p>
<p>&lt;methodCall&gt;</p>
<p>&lt;screenname&gt;T000-GAL&lt;/screenname&gt;</p>
<p>&lt;screentype&gt;3270&lt;/screentype&gt;</p>
<p>&lt;params&gt;</p>
<p>&lt;fieldname&gt;FIELD001&lt;/fieldname&gt;</p>
<p>&lt;uinput&gt;A&lt;/uinput&gt;</p>
<p>&lt;/params&gt;</p>
<p>&lt;/methodCall&gt;</p>
<p>Figure 1‑111 Example HTTP request with XML input data</p>
<p>Presentation module for XML input data</p>
<p>An example INITIAL scenario for processing this XML input data is coded
in the presentation module SCENXMLI shown below:</p>
<p>SCENXMLI SCREENS APPL=SCENXMLI</p>
<p>*</p>
<p>SCENARIO INITIAL</p>
<p>OUTAREA MAP$ BEGIN</p>
<p>MAP$ AREA,WITH=&#8217;screenname&#8217;,LENGTH=8,TYPE=X</p>
<p>PARAMS MAP$ BEGIN,WITH=&#8217;params&#8217;</p>
<p>MAP$ AREA,WITH=&#8217;fieldname&#8217;,LENGTH=8,TYPE=X</p>
<p>MAP$ AREA,WITH=&#8217;uinput&#8217;,LENGTH=20,TYPE=X</p>
<p>PARAMS MAP$ END</p>
<p>OUTAREA MAP$ END</p>
<p>*</p>
<p>OUTAREA MAP$ FROM-INPUT</p>
<p>OUTAREA MAP$ TO-VARIABLE,VAR=&#8217;MYAREA&#8217;</p>
<p>SCENARIO END</p>
<p>*</p>
<p>SCRNEND</p>
<p>END ,</p>
<p>Figure 1‑112 HTTP presentation module for XML input data</p>
<p>Contents of generated commarea</p>
<p>The figure below shows the 36-byte commarea generated in the VIRTEL
variable MYAREA:</p>
<blockquote>
<div><p>&#8212;-+&#8212;-1&#8212;-+&#8212;-2&#8212;-+&#8212;-3&#8212;-+-</p>
<p>T000-GALFIELD001A</p>
</div></blockquote>
<p>Figure 1‑113 Commarea generated from XML input data</p>
<p>Sending XML input as URL-encoded data</p>
<p>For some applications it may be more convenient to send the XML data as
part of the URL. To conform with URL syntax rules, the XML data is
embedded in an HTML text field, and blanks and other special characters
in the XML data are replaced by their corresponding URL-encoded values
(“+” signs and “%xx” sequences). This format can be generated by means
of an HTML form, as shown in the example below:</p>
<p>&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Syspertec - XML Application with
VIRTEL&lt;/TITLE&gt;&lt;/HEAD&gt;</p>
<p>&lt;BODY&gt;&lt;CENTER&gt;</p>
<p>&lt;FORM method=GET name=&#8221;VirtelForm&#8221; action=&#8221;/demohttp/xmldemo.xml+tran3&#8221;&gt;</p>
<p>&lt;TEXTAREA cols=&#8221;45&#8221; rows=&#8221;20&#8221; name=&#8221;MYINPUT&#8221;&gt;</p>
<p>&amp;lt;?xml version=&#8221;1.0&#8221; ?&amp;gt;</p>
<p>&amp;lt;methodCall&amp;gt;</p>
<p>&amp;lt;screenname&amp;gt;T000-GAL&amp;lt;/screenname&amp;gt;</p>
<p>&amp;lt;screentype&amp;gt;3270&amp;lt;/screentype&amp;gt;</p>
<p>&amp;lt;params&amp;gt;</p>
<p>&amp;lt;fieldname&amp;gt;FIELD001&amp;lt;/fieldname&amp;gt;</p>
<p>&amp;lt;uinput&amp;gt;A&amp;lt;/uinput&amp;gt;</p>
<p>&amp;lt;/params&amp;gt;</p>
<p>&amp;lt;/methodCall&amp;gt;</p>
<p>&lt;/TEXTAREA&gt;</p>
<p>&lt;p&gt;&lt;BUTTON type=&#8221;submit&#8221;&gt;Submit&lt;/BUTTON&gt;</p>
<p>&lt;/FORM&gt;&lt;/CENTER&gt;</p>
<p>&lt;/BODY&gt;</p>
<p>&lt;/HTML&gt;</p>
<p>Figure 1‑114 HTML form with XML input data embedded in a text field</p>
<p>The HTTP request generated by the above HTML form is presented to VIRTEL
in the format shown below:</p>
<p>GET
/demohttp/xmldemo.xml+tran3?MYINPUT=%3C%3Fxml+version%3D%221.0%22%3F%</p>
<p>3E%0D%0A%3CmethodCall%3E%0D%0A%3Cscreenname%3ET000-GAL%3C%2Fscreenname%3E</p>
<p>%0D%0A%3Cscreentype%3E3270%3C%2Fscreentype%3E%0D%0A%3Cparams%3E%0D%0A++%3</p>
<p>Cfieldname%3EFIELD001%3C%2Ffieldname%3E%0D%0A++%3Cuinput%3EA%3C%2Fuinput%</p>
<p>3E%0D%0A%3C%2Fparams%3E%0D%0A%3C%2FmethodCall%3E%0D%0A HTTP/1.0</p>
<p>Host: 192.168.235.30</p>
<p>Accept: */*</p>
<p>Figure 1‑115 XML input data in URL-encoded format (HTTP GET method)</p>
<p>By changing the FORM METHOD to POST (instead of GET), the HTTP request
can be presented to VIRTEL in the alternative format shown below:</p>
<p>POST /demohttp/xmldemo.xml+tran3 HTTP/1.0</p>
<p>Host: 192.168.235.30</p>
<p>Accept: */*</p>
<p>Content-Type: application/x-www-form-urlencoded</p>
<p>Content-Length: 314</p>
<p>MYINPUT=%3C%3Fxml+version%3D%221.0%22%3F%3E%0D%0A%3CmethodCall%3E%0D%0A%3C</p>
<p>screenname%3ET000-GAL%3C%2Fscreenname%3E%0D%0A%3Cscreentype%3E3270%3C%2Fsc</p>
<p>reentype%3E%0D%0A%3Cparams%3E%0D%0A++%3Cfieldname%3EFIELD001%3C%2Ffieldnam</p>
<p>e%3E%0D%0A++%3Cuinput%3EA%3C%2Fuinput%3E%0D%0A%3C%2Fparams%3E%0D%0A%3C%2Fm</p>
<p>ethodCall%3E%0D%0A</p>
<p>Figure 1‑116 XML input data in URL-encoded format (HTTP POST method)</p>
<p>Both of these request formats can be processed by a presentation module
similar to the SCENXMLI module shown previously. The only change
necessary to process URL-encoded data is that the statement
OUTAREA&nbsp;MAP$&nbsp;FROM-INPUT must be replaced by the statement
OUTAREA&nbsp;MAP$&nbsp;FROM-FIELD,FIELD=&#8217;MYINPUT&#8217;</p>
<p>Transaction definition for XML input data</p>
<p>The HTTP requests shown above use the URL <em>/demohttp/xmldemo.xml+tran3</em>
to invoke the VIRTEL transaction shown below (<em>tran3</em> is the “external
name” of the transaction). The “TIOA at logon” field contains a
connection script. After signing on to CICS, the connection script uses
the &amp;/S order to process the INITIAL scenario in the presentation module
SCENXMLI. This scenario converts the XML data into a VIRTEL variable
named MYAREA. The script then invokes a CICS transaction VHLP, passing
the contents of MYAREA as input data. The CICS transaction performs an
EXEC&nbsp;CICS&nbsp;RECEIVE to obtain the input data.</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTELD2
15:32:33</p>
<p>Internal name ===&gt; CLI-16E To associate with an entry point name</p>
<p>External name ===&gt; tran3 Name displayed on user menu</p>
<p>Description ===&gt; Demonstration VIRTEL XML</p>
<p>Application ===&gt; CICSPROD Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 1 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; CLVTA Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 1 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 0 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 024 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt; Signon to CICS&amp;/W&amp;*F34BE9&amp;/A</p>
<p>&amp;(&amp;/S VHLP&amp;=MYAREA=&amp;/A&amp;)</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; SCENXMLI Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt; SCENXMLO</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑117 VIRTEL transaction definition for XML input data</p>
<p>XML input with attributes and repeating groups</p>
<p>The figure below shows an example of XML input data containing
attributes and repeating groups of fields:</p>
<p>&lt;?xml version=&#8221;1.0&#8221; ?&gt;</p>
<p>&lt;request&gt;</p>
<p>&lt;id type=&#8221;RP&#8221; date=&#8221;20.01.2006&#8221; numreq=&#8221;2&#8221;&gt;8019A&lt;/id&gt;</p>
<p>&lt;part&gt;</p>
<p>&lt;key suffix=&#8221;01&#8221;&gt;GROMMET&lt;/key&gt;</p>
<p>&lt;stat&gt;3&lt;/stat&gt;</p>
<p>&lt;type&gt;C&lt;/type&gt;</p>
<p>&lt;/part&gt;</p>
<p>&lt;part&gt;</p>
<p>&lt;key suffix=&#8221;02&#8221;&gt;GREVILE&lt;/key&gt;</p>
<p>&lt;type&gt;D&lt;/type&gt;</p>
<p>&lt;stat&gt;3&lt;/stat&gt;</p>
<p>&lt;/part&gt;</p>
<p>&lt;/request&gt;</p>
<p>Figure 1‑118 Example XML input data with attributes and repeating groups</p>
<p>An INITIAL scenario for processing this XML input data is coded in the
presentation module SCENXMLA shown below:</p>
<p>SCENXMLA SCREENS APPL=SCENXMLA</p>
<p>*</p>
<p>SCENARIO INITIAL</p>
<p>*</p>
<p>COMMAREA MAP$ BEGIN</p>
<p>MAP$ AREA,WITH=&#8217;id&#8217;,LENGTH=5</p>
<p>MAP$ AREA-ATTRIBUTE,VALUEOF=&#8217;date&#8217;,LENGTH=8,TYPE=ONLY9</p>
<p>MAP$ AREA-ATTRIBUTE,VALUEOF=&#8217;type&#8217;,LENGTH=2</p>
<p>MAP$ AREA-ATTRIBUTE,VALUEOF=&#8217;numreq&#8217;,LENGTH=2,TYPE=9</p>
<p>DETAIL MAP$ BEGIN,WITH=&#8217;part&#8217;,OCCURS=5</p>
<p>MAP$ AREA-ATTRIBUTE,WITH=&#8217;key&#8217;,VALUEOF=&#8217;suffix&#8217;, *</p>
<p>LENGTH=2,TYPE=9</p>
<p>MAP$ AREA,LENGTH=8</p>
<p>MAP$ AREA,WITH=&#8217;type&#8217;,LENGTH=1</p>
<p>MAP$ AREA,WITH=&#8217;stat&#8217;,LENGTH=1</p>
<p>DETAIL MAP$ END</p>
<p>COMMAREA MAP$ END</p>
<p>*</p>
<p>COMMAREA MAP$ FROM-INPUT</p>
<p>COMMAREA MAP$ TO-VARIABLE,VAR=&#8217;MYCOMMAREA&#8217;</p>
<p>SCENARIO END</p>
<p>*</p>
<p>SCRNEND</p>
<p>END</p>
<p>Figure 1‑119 Presentation module for XML input with attributes and
repeating groups</p>
<p>The figure below shows the 77-byte commarea generated in the VIRTEL
variable MYCOMMAREA:</p>
<blockquote>
<div><p>&#8212;-+&#8212;-1&#8212;-+&#8212;-2&#8212;-+&#8212;-3&#8212;-+&#8212;-4&#8212;-+&#8212;-5&#8212;-+&#8212;-6&#8212;-+&#8212;-7&#8212;-+&#8211;</p>
<p>8019A20012006RP0201GROMMET C302GREVILE D300 00 00</p>
</div></blockquote>
<p>Figure 1‑120 Commarea generated from XML input with attributes and
repeating groups</p>
<p>XML input with redefinition of fields</p>
<p>This example shows how the commarea can be redefined according to the
value of a field in the XML input. In this example, the input can be in
one of two formats, depending on the value of the field whose name is
“reqtype”:</p>
<p><strong>*Request type A*</strong></p>
<p>&lt;?xml version=&#8221;1.0&#8221; ?&gt;</p>
<p>&lt;request&gt;</p>
<p>&lt;reqid&gt;1234&lt;/reqid&gt;</p>
<p>&lt;reqtype&gt;A&lt;/reqtype&gt;</p>
<p>&lt;itemcode&gt;12345&lt;/itemcode&gt;</p>
<p>&lt;details&gt;</p>
<p>&lt;color&gt;blue&lt;/color&gt;</p>
<p>&lt;quantity&gt;5&lt;/quantity&gt;</p>
<p>&lt;/details&gt;</p>
<p>&lt;/request&gt;</p>
<p><strong>*Request type B*</strong></p>
<p>&lt;?xml version=&#8221;1.0&#8221; ?&gt;</p>
<p>&lt;request&gt;</p>
<p>&lt;reqid&gt;2345&lt;/reqid&gt;</p>
<p>&lt;reqtype&gt;B&lt;/reqtype&gt;</p>
<p>&lt;itemcode&gt;23456&lt;/itemcode&gt;</p>
<p>&lt;details&gt;</p>
<p>&lt;lang&gt;EN&lt;/lang&gt;</p>
<p>&lt;format&gt;quarto&lt;/format&gt;</p>
<p>&lt;/details&gt;</p>
<p>&lt;/request&gt;</p>
<p>Figure 1‑121 Example XML input data with redefinition of fields</p>
<p>An INITIAL scenario for processing this XML input data is coded in the
presentation module SCENXMLR shown below:</p>
<p>SCENXMLR SCREENS APPL=SCENXMLR</p>
<p>*</p>
<p>SCENARIO INITIAL</p>
<p>*</p>
<p>HEADER MAP$ BEGIN</p>
<p>MAP$ AREA,WITH=&#8217;reqid&#8217;,LENGTH=4,TYPE=9</p>
<p>MAP$ AREA,WITH=&#8217;reqtype&#8217;,LENGTH=1,TYPE=X,VAR=&#8217;TRIGGER&#8217;</p>
<p>MAP$ AREA,WITH=&#8217;itemcode&#8217;,LENGTH=6,TYPE=9</p>
<p>HEADER MAP$ END</p>
<p>*</p>
<p>HEADER MAP$ FROM-INPUT,FIELD=&#8217;MYINPUT&#8217;</p>
<p>HEADER MAP$ TO-VARIABLE,VAR=&#8217;MYHEAD&#8217;</p>
<p>*</p>
<p>IF$ VARIABLE,&#8217;TRIGGER&#8217;,EQ=&#8217;A&#8217;,THEN=TYPEA</p>
<p>IF$ VARIABLE,&#8217;TRIGGER&#8217;,EQ=&#8217;B&#8217;,THEN=TYPEB</p>
<p>SCENARIO END</p>
<p>*</p>
<p>TYPEA EQU *</p>
<p>DETAILA MAP$ BEGIN,WITH=&#8217;details&#8217;</p>
<p>MAP$ AREA,WITH=&#8217;color&#8217;,LENGTH=8,TYPE=X</p>
<p>MAP$ AREA,WITH=&#8217;quantity&#8217;,LENGTH=5,TYPE=9</p>
<p>DETAILA MAP$ END</p>
<p>*</p>
<p>DETAILA MAP$ FROM-INPUT,FIELD=&#8217;MYINPUT&#8217;</p>
<p>DETAILA MAP$ TO-VARIABLE,VAR=&#8217;MYBODY&#8217;</p>
<p>SCENARIO END</p>
<p>*</p>
<p>TYPEB EQU *</p>
<p>DETAILB MAP$ BEGIN,WITH=&#8217;details&#8217;</p>
<p>MAP$ AREA,WITH=&#8217;lang&#8217;,LENGTH=2,TYPE=X</p>
<p>MAP$ AREA,WITH=&#8217;format&#8217;,LENGTH=8,TYPE=X</p>
<p>DETAILB MAP$ END</p>
<p>*</p>
<p>DETAILB MAP$ FROM-INPUT,FIELD=&#8217;MYINPUT&#8217;</p>
<p>DETAILB MAP$ TO-VARIABLE,VAR=&#8217;MYBODY&#8217;</p>
<p>SCENARIO END</p>
<p>*</p>
<p>SCRNEND</p>
<p>END</p>
<p>Figure 1‑122 Presentation module for XML input with redefinition of
fields</p>
<p>This scenario generates two commareas, which are saved in VIRTEL
variables MYHEAD and MYBODY, as shown below:</p>
<p><strong>*Request type A*</strong></p>
<p>&#8212;-+&#8212;-1&#8212;-+&#8212;-2&#8212;-+&#8212;-3</p>
<p>MYHEAD: 1234A012345</p>
<p>MYBODY: blue 00005</p>
<p><strong>*Request type B*</strong></p>
<p>&#8212;-+&#8212;-1&#8212;-+&#8212;-2&#8212;-+&#8212;-3</p>
<p>MYHEAD: 2345B023456</p>
<p>MYBODY: ENquarto</p>
<p>Figure 1‑123 Commarea generated from XML input with redefinition of
fields</p>
</div>
<div class="section" id="presentation-of-xml-output">
<h6>Presentation of XML output<a class="headerlink" href="#presentation-of-xml-output" title="Permalink to this headline">¶</a></h6>
<p>By using an output scenario and a suitable page template, VIRTEL can
transform application program output into XML when the result is sent
back in the HTTP response.</p>
<p>Presentation module for XML output</p>
<p>An output scenario is used to extract data from the output 3270 data
stream of the transaction and place it into one or more table variables.
The example presentation module SCENXMLO shown below contains an OUTPUT
scenario which creates two variables, ACCTNUM and FULLNAME, from a table
of values displayed on the 3270 screen:</p>
<p>SCENXMLO SCREENS EXEC=NO</p>
<p>SCENARIO OUTPUT</p>
<p>IF$ (04,2,6),EQ=&#8217; &#8216;,THEN=SKIP04</p>
<p>COPY$ SCREEN-TO-VARIABLE,SCREEN=(04,2,6),VAR=&#8217;ACCTNUM&#8217;</p>
<p>COPY$ SCREEN-TO-VARIABLE,SCREEN=(04,10,20),VAR=&#8217;FULLNAME&#8217;</p>
<p>SKIP04 EQU *</p>
<p>IF$ (05,2,6),EQ=&#8217; &#8216;,THEN=SKIP05</p>
<p>COPY$ SCREEN-TO-VARIABLE,SCREEN=(05,2,6),VAR=&#8217;ACCTNUM&#8217;</p>
<p>COPY$ SCREEN-TO-VARIABLE,SCREEN=(05,10,20),VAR=&#8217;FULLNAME&#8217;</p>
<p>SKIP05 EQU *</p>
<p>IF$ (06,2,6),EQ=&#8217; &#8216;,THEN=SKIP06</p>
<p>COPY$ SCREEN-TO-VARIABLE,SCREEN=(06,2,6),VAR=&#8217;ACCTNUM&#8217;</p>
<p>COPY$ SCREEN-TO-VARIABLE,SCREEN=(06,10,20),VAR=&#8217;FULLNAME&#8217;</p>
<p>SKIP06 EQU *</p>
<p>IF$ (07,2,6),EQ=&#8217; &#8216;,THEN=SKIP07</p>
<p>COPY$ SCREEN-TO-VARIABLE,SCREEN=(07,2,6),VAR=&#8217;ACCTNUM&#8217;</p>
<p>COPY$ SCREEN-TO-VARIABLE,SCREEN=(07,10,20),VAR=&#8217;FULLNAME&#8217;</p>
<p>SKIP07 EQU *</p>
<p>SCENARIO END</p>
<p>SCRNEND</p>
<p>END</p>
<p>Figure 1‑124 HTTP presentation module for XML output</p>
<p>Note: It is also possible for the application program to create VIRTEL
table variables directly, either by means of an FAE5 structured field
(described sur la page 275), or via the HOST4WEB command “SET VARIABLE”
(described sur la page 289). The FAE5 structured field allows the
application to pass large amounts of raw data to VIRTEL without being
constrained by the limitations of the 3270 screen geometry. For such
“VIRTEL-aware” applications, an output scenario is not necessary.</p>
<p>Page template for XML output</p>
<p>The URL in this example is <em>/demohttp/xmldemo.xml+tran3</em> which requests
VIRTEL to use the page template <em>xmldemo.xml</em> to process the output of
the <em>tran3</em> transaction. The purpose of the page template is to convert
the transaction output into XML format.</p>
<p>In the page template <em>xmldemo.xml</em> shown below, the output data is
obtained from the VIRTEL table variables ACCTNUM and FULLNAME which were
created either by the output scenario SCENXMLO, or directly by the
application program:</p>
<p>&lt;?xml version=&#8221;1.0&#8221;?&gt;</p>
<p>&lt;!&#8211;VIRTEL start=&#8221;{{{&#8221; end=&#8221;}}}&#8221; &#8211;&gt;</p>
<p>{{{SET-OUTPUT-ENCODING-UTF-8 &#8220;&#8221;}}}</p>
<p>&lt;accounts&gt;</p>
<p>{{{FOR-EACH-VALUE-IN &#8220;ACCTNUM&#8221;}}}</p>
<p>&lt;account&gt;</p>
<p>&lt;id&gt;{{{TRIMMED-VALUE-OF &#8220;ACCTNUM&#8221;}}}&lt;/id&gt;</p>
<p>&lt;name&gt;{{{TRIMMED-VALUE-OF &#8220;FULLNAME&#8221;}}}&lt;/name&gt;</p>
<p>&lt;account&gt;</p>
<p>{{{END-FOR &#8220;ACCTNUM&#8221;}}}</p>
<p>&lt;/accounts&gt;</p>
<p>Figure 1‑125 Example page template for XML output data</p>
</div>
<div class="section" id="virtel-as-an-xml-parser-generator">
<h6>VIRTEL as an XML parser/generator<a class="headerlink" href="#virtel-as-an-xml-parser-generator" title="Permalink to this headline">¶</a></h6>
<p>An application can use the VIRTEL HTTP server as an XML parser/generator
engine. A client program establishes a TCP/IP session with the VIRTEL
HTTP server, and sends XML or commarea data to VIRTEL in an HTTP
request. VIRTEL performs conversion to or from XML, and returns the
resulting commarea or XML data to the client program in the HTTP
response.</p>
<p>It is the INITIAL scenario associated with the VIRTEL transaction which
determines whether the conversion is from XML to commarea format, or
vice versa. Conversion from XML to commarea format is performed by a
transaction whose INITIAL scenario contains a MAP$&nbsp;FROM-FIELD or
MAP$&nbsp;FROM-INPUT instruction. Conversion from commarea to XML format is
performed by a transaction whose INITIAL scenario contains a
TOVAR$&nbsp;FROM-FIELD or TOVAR$&nbsp;FROM-INPUT instruction. Both scenarios can
reference a common set of MAP$ statements which describe the
relationship between the XML stream and the commarea. In each case an
appropriate page template must also be used, as shown in the detailed
examples which follow.</p>
<p>Communication via VIRKIX</p>
<p>A client program running under CICS on MVS can use VIRKIX to establish
the HTTP connection, send the request, and receive the response. The
client program may send the request in either ASCII or EBCDIC; both
formats are recognized and supported by VIRTEL. Notice the use of the
special header GIVE-LENGTH-PREFIX which requests VIRTEL to add a 4-byte
length prefix to the HTTP response, to conform with the format expected
by VIRKIX CALL type &#8216;M&#8217;.</p>
<p>Example MAP$ statements</p>
<p>The copy member SCONVMAP shown below contains the MAP$ statements common
to both examples presented in this section. This member is copied into
each of the scenarios SCONVXML and SCONVPLA by means of an assembler
COPY statement.</p>
<p><strong>*Member name SCONVMAP*</strong></p>
<p>CAREA MAP$ BEGIN</p>
<p>MAP$ AREA,WITH=&#8217;date&#8217;,LENGTH=8,TYPE=(ONLY9,LEFT-ALIGNED), *</p>
<p>FORMAT=(&#8216;9999-99-99&#8217;,9)</p>
<p>IDENT MAP$ BEGIN,WITH=&#8217;identity&#8217;</p>
<p>MAP$ EVENTUAL-AREA,FROM-CONSTANT,&#8216;1&#8217;,WHEN=(ELEMENT,&#8217;bic&#8217;)</p>
<p>MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#8216;2&#8217;,WHEN=(ELEMENT,&#8217;iban&#8217;)</p>
<p>MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#8216;3&#8217;,WHEN=(ELEMENT,&#8217;rib&#8217;)</p>
<p>MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#8217; &#8216;</p>
<p>MAP$ AREA,LENGTH=8</p>
<p>IDENT MAP$ END</p>
<p>VERIF MAP$ BEGIN,WITH=&#8217;verified&#8217;</p>
<p>MAP$ EVENTUAL-AREA,FROM-CONSTANT,&#8216;1&#8217;,WHEN=(VALUE,&#8217;yes&#8217;)</p>
<p>MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#8216;0&#8217;,WHEN=(VALUE,&#8217;no&#8217;)</p>
<p>MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#8216;0&#8217;</p>
<p>VERIF MAP$ END</p>
<p>MAP$ AREA,WITH=&#8217;amount&#8217;,LENGTH=5,TYPE=ONLY9, *</p>
<p>FORMAT=(&#8216;$999.99&#8217;,9)</p>
<p>CAREA MAP$ END</p>
<p>Figure 1‑126 MAP$ statements for VIRTEL XML parser/generator</p>
<p>XML-to-commarea conversion using the VIRTEL XML parser</p>
<p>The figure below shows an example transaction definition to be used for
XML-to-commarea conversion using the VIRTEL XML parser. The external
name “tranxml” is the name referenced in the URL of the HTTP request
which calls the transaction. The special application name $NONE$
indicates that no host application is to be called. The /&amp;S order
specified in the “TIOA at Logon” field causes the INITIAL scenario
SCONVXML (see Figure 1‑128) to be executed.</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTELD2
16:39:25</p>
<p>Internal name ===&gt; HTTP-16X To associate with an entry point name</p>
<p>External name ===&gt; tranxml Name displayed on user menu</p>
<p>Description ===&gt; VIRTEL XML parser</p>
<p>Application ===&gt; $NONE$ Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 2 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; HTLOC Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 1 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 0 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt; &amp;/S &amp;/T</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; SCONVXML Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑127 VIRTEL transaction definition for XML-to-commarea
conversion</p>
<p>The initial scenario for XML-to-commarea conversion is shown below:</p>
<p><strong>*Member name SCONVXML*</strong></p>
<p>SCONVXML SCREENS APPL=SCONVXML</p>
<p>SCENARIO INITIAL</p>
<p>COPY SCONVMAP <strong>*(copy member shown in*</strong> Figure 1‑126<strong>*)*</strong></p>
<p>CAREA MAP$ FROM-INPUT</p>
<p>CAREA MAP$ TO-VARIABLE,VAR=&#8217;MYAREA&#8217;</p>
<p>SCENARIO END</p>
<p>SCRNEND</p>
<p>END</p>
<p>Figure 1‑128 Initial scenario for XML-to-commarea conversion</p>
<p>An example request for XML-to-commarea conversion using the VIRTEL XML
parser is shown in the figure below:</p>
<p>POST /demohttp/myarea.txt+tranxml HTTP/1.1</p>
<p>Host: 192.168.235.30</p>
<p>Accept: */*</p>
<p>Content-Length: 172</p>
<p>Special: GIVE-LENGTH-PREFIX</p>
<p>&lt;?xml version=&#8221;1.0&#8221; ?&gt;</p>
<p>&lt;request&gt;</p>
<p>&lt;date&gt;2006-06-21&lt;/date&gt;</p>
<p>&lt;identity&gt;&lt;iban&gt;AB1234CD&lt;/iban&gt;&lt;/identity&gt;</p>
<p>&lt;verified&gt;yes&lt;/verified&gt;</p>
<p>&lt;amount&gt;$123.45&lt;/amount&gt;</p>
<p>&lt;/request&gt;</p>
<p>Figure 1‑129 Input request for XML-to-commarea conversion</p>
<p>The HTTP request shown in Figure 1‑129 specifies the use of a page
template named <em>myarea.txt</em> which is stored in a VIRTEL directory and is
shown in the figure below. By use of this page template, the commarea
MYAREA created by the INITIAL scenario SCONVXML is inserted into the
HTTP response data:</p>
<p><strong>*Page template myarea.txt*</strong></p>
<p>&lt;!&#8211;VIRTEL start=&#8221;{{{&#8221; end=&#8221;}}}&#8221; &#8211;&gt;</p>
<p>{{{ SET-CONTENT-TYPE &#8220;text/plain&#8221;}}}</p>
<p>{{{ CURRENT-VALUE-OF &#8220;MYAREA&#8221; }}}</p>
<p>Figure 1‑130 Page template for XML-to-commarea conversion</p>
<p>The figure below shows the HTTP response returned by VIRTEL. The body of
the response contains the input data converted to commarea format:</p>
<p>HTTP/1.1 200 Ok</p>
<p>Server: Virtel/4.32</p>
<p>Date: Wed, 21 Jun 2006 15:31:02 GMT</p>
<p>Expires: 0</p>
<p>Content-length: 00000029</p>
<p>Content-type: text/plain</p>
<p>200606212AB1234CD112345</p>
<p>Figure 1‑131 Output response from XML-to-commarea conversion</p>
<p>Commarea-to-XML conversion using the VIRTEL XML generator</p>
<p>The figure below shows an example transaction definition to be used for
commarea-to-XML conversion using the VIRTEL XML generator. The external
name “trancom” is the name referenced in the URL of the HTTP request
which calls the transaction. The special application name $NONE$
indicates that no host application is to be called. The /&amp;S order
specified in the “TIOA at Logon” field causes the INITIAL scenario
SCONVPLA (see Figure 1‑133) to be executed.</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTELD2
16:39:58</p>
<p>Internal name ===&gt; HTTP-16Y To associate with an entry point name</p>
<p>External name ===&gt; trancom Name displayed on user menu</p>
<p>Description ===&gt; VIRTEL XML generator</p>
<p>Application ===&gt; $NONE$ Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 2 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; HTLOC Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 1 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 0 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt; &amp;/S &amp;/T</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; SCONVPLA Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑132 VIRTEL transaction definition for commarea-to-XML
conversion</p>
<p>The initial scenario for commarea-to-XML conversion is shown below:</p>
<p><strong>*Member name SCONVPLA*</strong></p>
<p>SCONVPLA SCREENS APPL=SCONVPLA</p>
<p>SCENARIO INITIAL</p>
<p>COPY SCONVMAP <strong>*(copy member shown in*</strong> Figure 1‑126<strong>*)*</strong></p>
<p>CAREA TOVAR$ FROM-INPUT</p>
<p>SCENARIO END</p>
<p>SCRNEND</p>
<p>END</p>
<p>Figure 1‑133 Initial scenario for commarea-to-XML conversion</p>
<p>An example request for commarea-to-XML conversion using the VIRTEL XML
parser is shown in the figure below:</p>
<p>POST /demohttp/mydata.xml+trancom HTTP/1.1</p>
<p>Host: 192.168.235.30</p>
<p>Accept: */*</p>
<p>Content-Length: 27</p>
<p>Special: GIVE-LENGTH-PREFIX</p>
<p>200606212AB1234CD112345</p>
<p>Figure 1‑134 Input request for commarea-to-XML conversion</p>
<p>The HTTP request shown in Figure 1‑134 specifies the use of a page
template named <em>mydata.xml</em> which is stored in a VIRTEL directory and is
shown in the figure below. By use of this page template, the output
variables created by the TOVAR$ instruction in the INITIAL scenario
SCONVPLA are inserted into the HTTP response data:</p>
<p><strong>*Page template mydata.xml*</strong></p>
<p>&lt;?xml version=&#8221;1.0&#8221; encoding=&#8221;UTF-8&#8221;?&gt;</p>
<p>&lt;!&#8211;VIRTEL start=&#8221;{{{&#8221; end=&#8221;}}}&#8221; &#8211;&gt;</p>
<p>{{{ SET-CONTENT-TYPE &#8220;text/xml&#8221;}}}{{{SET-OUTPUT-ENCODING-UTF-8 &#8220;&#8221;}}}</p>
<p>&lt;request&gt;</p>
<p>&lt;date&gt;{{{CURRENT-VALUE-OF &#8220;date&#8221;}}}&lt;/date&gt;</p>
<p>&lt;identity&gt;</p>
<p>{{{WHEN-EXISTS &#8220;bic&#8221;}}}&lt;bic&gt;{{{CURRENT-VALUE-OF
&#8220;bic&#8221;}}}&lt;/bic&gt;{{{END-WHEN-EXISTS &#8220;bic&#8221;}}}</p>
<p>{{{WHEN-EXISTS &#8220;iban&#8221;}}}&lt;iban&gt;{{{CURRENT-VALUE-OF
&#8220;iban&#8221;}}}&lt;/iban&gt;{{{END-WHEN-EXISTS &#8220;iban&#8221;}}}</p>
<p>{{{WHEN-EXISTS &#8220;rib&#8221;}}}&lt;rib&gt;{{{CURRENT-VALUE-OF
&#8220;rib&#8221;}}}&lt;/rib&gt;{{{END-WHEN-EXISTS &#8220;rib&#8221;}}}</p>
<p>&lt;/identity&gt;</p>
<p>&lt;verified&gt;{{{CURRENT-VALUE-OF &#8220;verified&#8221;}}}&lt;/verified&gt;</p>
<p>&lt;amount&gt;{{{CURRENT-VALUE-OF &#8220;amount&#8221;}}}&lt;/amount&gt;</p>
<p>&lt;/request&gt;</p>
<p>Figure 1‑135 Page template for commarea-to-XML conversion</p>
<p>The figure below shows the HTTP response returned by VIRTEL. The body of
the response contains the input commarea data converted to XML format:</p>
<p>HTTP/1.1 200 Ok</p>
<p>Server: Virtel/4.32</p>
<p>Date: Wed, 21 Jun 2006 16:02:55 GMT</p>
<p>Expires: 0</p>
<p>Content-length: 00000207</p>
<p>Content-type: text/xml</p>
<p>&lt;?xml version=&#8221;1.0&#8221; encoding=&#8221;UTF-8&#8221;?&gt;</p>
<p>&lt;request&gt;</p>
<p>&lt;date&gt;2006-06-21&lt;/date&gt;</p>
<p>&lt;identity&gt;</p>
<p>&lt;iban&gt;AB1234CD&lt;/iban&gt;</p>
<p>&lt;/identity&gt;</p>
<p>&lt;verified&gt;yes&lt;/verified&gt;</p>
<p>&lt;amount&gt;$123.45&lt;/amount&gt;</p>
<p>&lt;/request&gt;</p>
<p>Figure 1‑136 Output response from commarea-to-XML conversion</p>
</div>
</div>
<div class="section" id="automatic-scenario-generation">
<h5>Automatic scenario generation<a class="headerlink" href="#automatic-scenario-generation" title="Permalink to this headline">¶</a></h5>
<div class="section" id="mapgen-program">
<h6>MAPGEN program<a class="headerlink" href="#mapgen-program" title="Permalink to this headline">¶</a></h6>
<p>The MAPGEN program allows the automatic generation of scenarios from
COBOL copybooks.</p>
<p>The input to the MAPGEN program is a COBOL copybook containing data
division definitions of a commarea. The output from the MAPGEN program
may be:</p>
<ul class="simple">
<li>a scenario for “input-to-commarea” conversion</li>
<li>a scenario for “commarea-to-output” conversion</li>
<li>an optional page template to convert the generated output variables
into XML format</li>
</ul>
<p>The MAPGEN program (MAPGREX) and the JCL to execute it (MAPGJCL) are
delivered as members of the VIRTEL SAMPLIB. The start of the MAPGJCL job
is shown below:</p>
<p>//VIRMAPGN JOB 1,MAPGEN,CLASS=A,MSGCLASS=X,NOTIFY=&amp;SYSUID</p>
<p>//*</p>
<p>//* MAPGEN : Generate VIRTEL SCENARIO from COBOL copybook</p>
<p>//*</p>
<p>// SET QUAL=yourqual.VIRTnnn Prefix of VIRTEL dataset names</p>
<p>// SET COPYLIB=your.cobol.srcelib Library containing copybook</p>
<p>// SET MEMBER=copybook Copybook member name</p>
<p>// SET STYLE=APOST APOST or QUOTE</p>
<p>// SET PREFIX=&#8217;TIOA-&#8216; Field name prefix to be removed</p>
<p>// SET CASE=LOWER Field names UPPER or LOWER case</p>
<p>// SET CODE=&#8217;ENC=IE&#8217; UTF-8 or ISO or ENC=varname</p>
<p>// SET FORMAT=QUERY XML QUERY &#8216;XML=f&#8217; COM &#8216;COM=x&#8217;</p>
<p>// SET VAR=MYCOMMAREA Output (XML/QUERY) Input (COM)</p>
<p>// SET XMLGEN=NO YES or NO to run XMLGEN step</p>
<p>//*</p>
<p>Figure 1‑137 Automatic scenario generation: MAPGJCL job</p>
<p>The parameters required to customize this job are coded as SET
statements at the start of the job. The meaning of the parameters is as
follows:</p>
<div class="line-block">
<div class="line"><strong>QUAL=*yourqual.VIRTnnn*</strong></div>
<div class="line">Prefix of VIRTEL dataset names. This job requires access to the
SAMPLIB, LOADLIB, and SCRNAPI.MACLIB datasets. The generated scenario
is written as a load module in the LOADLIB dataset.</div>
</div>
<div class="line-block">
<div class="line"><strong>COPYLIB=*your.cobol.srcelib*</strong></div>
<div class="line">Name of library containing the input copybook</div>
</div>
<div class="line-block">
<div class="line"><strong>MEMBER=*copybook*</strong></div>
<div class="line">Member name of the input copybook in the COPYLIB library</div>
</div>
<div class="line-block">
<div class="line"><strong>STYLE=APOST</strong>|<strong>QUOTE</strong></div>
<div class="line">Specifies whether the copybook uses single or double quotation marks
to delimit strings. APOST (single quotation marks) is the default</div>
</div>
<p><strong>PREFIX=&#8217;*prefix*&#8217;</strong> <a href="#id183"><span class="problematic" id="id184">*</span></a>(optional)
<a href="#id185"><span class="problematic" id="id186">*</span></a>If specified, the prefix will be removed from the field names in the
copybook</p>
<p><strong>CASE=LOWER</strong>|<strong>UPPER</strong> <a href="#id187"><span class="problematic" id="id188">*</span></a>(optional)
<a href="#id189"><span class="problematic" id="id190">*</span></a>If specified, all field names in the copybook will be converted to
LOWER or UPPER case. If not specified, the case will be preserved.</p>
<p><strong>CODE=*encoding*</strong> <a href="#id191"><span class="problematic" id="id192">*</span></a>(optional)
<a href="#id193"><span class="problematic" id="id194">*</span></a>Specifies the encoding of HTML form-field parameters in the input
URL. The following encodings may be specified:</p>
<div class="line-block">
<div class="line"><strong>UTF-8</strong></div>
<div class="line">Input form-fields are encoded in UTF-8 format</div>
</div>
<div class="line-block">
<div class="line"><strong>ISO</strong></div>
<div class="line">Input form-fields are encoded in non-UTF-8 format</div>
</div>
<div class="line-block">
<div class="line"><strong>&#8216;ENC=*fieldname*&#8217;</strong></div>
<div class="line">The contents of the URL form-field named <em>fieldname</em> are queried to
obtain the encoding value (UTF-8 or ISO). This allows the client to
dynamically specify the encoding method by means of a URL parameter.</div>
</div>
<p>If CODE is not specified, or if CODE=&#8217;ENC=<em>fieldname</em>&#8216; is specified
and the URL does not contain the parameter <em>fieldname</em>=UTF-8 or
<em>fieldname</em>=ISO, then the VIRTEL default encoding (ISO) is assumed.</p>
<div class="line-block">
<div class="line"><strong>FORMAT=*format*</strong></div>
<div class="line">Specifies the type of scenario to be generated. The following formats
may be specified:</div>
</div>
<div class="line-block">
<div class="line"><strong>QUERY</strong></div>
<div class="line">Generates an INITIAL scenario which accepts input data encoded as HTML
form-fields, and produces an output commarea. The generated scenario
contains a MAP$&nbsp;FROM-INPUT,QUERY instruction (described sur la page
199)</div>
</div>
<div class="line-block">
<div class="line"><strong>XML</strong></div>
<div class="line">Generates an INITIAL scenario which accepts XML input data in the body
of an HTTP request, and produces an output commarea. The generated
scenario contains a MAP$&nbsp;FROM-INPUT,XML instruction (described sur la
page 199)</div>
</div>
<div class="line-block">
<div class="line"><strong>&#8216;XML=*fieldname*&#8217;</strong></div>
<div class="line">Generates an INITIAL scenario which accepts XML input encoded within
an HTML form-field named <em>fieldname</em>, and produces an output commarea.
The generated scenario contains a MAP$&nbsp;FROM-FIELD instruction with the
parameter FIELD=<em>fieldname</em> (described sur la page 197)</div>
</div>
<div class="line-block">
<div class="line"><strong>COM</strong></div>
<div class="line"><em>When VAR is not specified:</em> Generates an INITIAL scenario which
accepts an input commarea in the body of an HTTP request, and produces
a set of VIRTEL variables whose names correspond to the fields in the
copybook. The generated scenario contains a TOVAR$&nbsp;FROM-INPUT
instruction (described sur la page 218)</div>
<div class="line"><em>When VAR is specified:</em> Generates an OUTPUT scenario which accepts an
input commarea contained in the VIRTEL variable named by the VAR
parameter, and produces a set of VIRTEL variables whose names
correspond to the fields in the copybook. The generated scenario
contains a TOVAR$&nbsp;FROM-VARIABLE instruction (described sur la page
218)</div>
</div>
<div class="line-block">
<div class="line"><strong>&#8216;COM=*fieldname*&#8217;</strong></div>
<div class="line">Generates an INITIAL scenario which accepts an input commarea encoded
within an HTML form-field named <em>fieldname</em>, and produces a set of
VIRTEL variables whose names correspond to the fields in the copybook.
The generated scenario contains a TOVAR$&nbsp;FROM-FIELD instruction with
the parameter FIELD=<em>fieldname</em> (described sur la page 217)</div>
</div>
<div class="line-block">
<div class="line"><strong>VAR=*commareaname*</strong></div>
<div class="line"><a href="#id195"><span class="problematic" id="id196">*</span></a>For FORMAT=QUERY, FORMAT=XML, FORMAT=&#8217;XML=fieldname&#8217;:
<a href="#id197"><span class="problematic" id="id198">*</span></a>Specifies the name of the VIRTEL variable into which the output
commarea is written. If not specified, the default is VAR=AREA</div>
<div class="line"><em>For FORMAT=COM:</em></div>
<div class="line">Optionally specifies the name of the VIRTEL variable which contains
the input commarea</div>
</div>
<div class="line-block">
<div class="line"><strong>XMLGEN=YES</strong>|<strong>NO</strong></div>
<div class="line">Specifies whether an additional XMLGEN step is to be run. This
parameter is useful when FORMAT=COM or FORMAT=&#8217;COM=<em>fieldname</em>&#8216; is
specified. If XMLGEN=YES then the job also generates a VIRTEL page
template suitable for converting the VIRTEL result variables into XML
format. The generated page template is written to
<em>userid.XMLGEN.OUTPUT</em> which must be preallocated as a sequential
dataset. The contents of this dataset should then be transferred to
your workstation where it can be uploaded into a VIRTEL directory (see
“Uploading pages by HTTP” sur la page 93).</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="incoming-e-mails">
<h3>Incoming E-mails<a class="headerlink" href="#incoming-e-mails" title="Permalink to this headline">¶</a></h3>
<p>The arrival of an e-mail on an SMTP line can trigger one of two types of
action in VIRTEL, depending on the entry point chosen by the rules of
the SMTP line:</p>
<ul class="simple">
<li>Transfer of attached files to a VIRTEL directory</li>
<li>Start a CICS transaction (or other VTAM application)</li>
</ul>
<div class="section" id="rules-of-the-smtp-line">
<h4>Rules of the SMTP line<a class="headerlink" href="#rules-of-the-smtp-line" title="Permalink to this headline">¶</a></h4>
<p>When an e-mail arrives on an SMTP line, VIRTEL examines the rules of the
line to determine which entry point will be used to process the incoming
message. In the example below, the rule specifies that when the e-mail
destination address is <em>cicsmail&#64;sample.com</em>, and the sender address is
<em>customer&#64;client.com</em>, then entry point SMTPCICS will be used:</p>
<p>DETAIL of RULE from RULE SET: S-SMTP &#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
15:46:00</p>
<p>Name ===&gt; SM200EML Rule priority is per name</p>
<p>Status ===&gt; ACTIVE 19 May 2004 15:46:00 VIRDBA</p>
<p>Description ===&gt; Appels entrants SMTP</p>
<p>Entry point ===&gt; SMTPCICS Target Entry Point</p>
<p>Parameter ===&gt; optional &amp;1 value</p>
<p>Trace ===&gt; 1=commands 2=data 3=partner</p>
<p>C : 0=IGNORE 1=IS 2=IS NOT 3=STARTS WITH 4=DOES NOT 5=ENDS WITH 6=DOES
NOT</p>
<p>0 IP Subnet ===&gt; 000.000.000.000 Mask ===&gt; 000.000.000.000</p>
<p>1 Host ===&gt; <a class="reference external" href="mailto:cicsmail&#37;&#52;&#48;sample&#46;com">cicsmail<span>&#64;</span>sample<span>&#46;</span>com</a></p>
<p>1 eMail ===&gt; <a class="reference external" href="mailto:customer&#37;&#52;&#48;client&#46;com">customer<span>&#64;</span>client<span>&#46;</span>com</a></p>
<p>0 Calling DTE ===&gt; Calling DTE address</p>
<p>0 Called ===&gt; Called DTE address</p>
<p>0 CUD0 (Hex) ===&gt; First 4 bytes of CUD (X25 protocol)</p>
<p>0 User Data ===&gt;</p>
<p>0 Days ===&gt; M: T: W: T: F: S: S:</p>
<p>0 Start time ===&gt; H: M: S: End time ===&gt; H: M: S:</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P4=Activate P5=Inactivate P12=Entry P.</p>
<p>CREATION OK</p>
<p>Figure 1‑138 Rule for routing an incoming e-mail on an SMTP line</p>
</div>
<div class="section" id="file-transfer-by-e-mail">
<h4>File transfer by e-mail<a class="headerlink" href="#file-transfer-by-e-mail" title="Permalink to this headline">¶</a></h4>
<p>An entry point which is used for file file transfer (including the
upload of HTML pages) has a single transaction which calls VIRTEL module
VIR0041B. This transaction is defined with application type 2 and
startup mode 1. The menu program specified in the entry point must be
VIR0021B.</p>
<p>Only authorized users (see “Correspondent management” sur la page 81)
can perform transfers.</p>
<p>ENTRY POINT DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
15:52:26</p>
<p>Name ===&gt; SMTP Name this ENTRY POINT (LOGON DATA)</p>
<p>Description ===&gt; Receive e-mail for file transfer</p>
<p>Transactions ===&gt; SMTP Prefix for associated transactions</p>
<p>Videotex key ===&gt; If videotex, keyword or $NONE$</p>
<p>Transparency ===&gt; Server types NOT to emulate</p>
<p>Time out ===&gt; 0005 minutes Maximum inactive time</p>
<p>Do if timeout ===&gt; 0 0=logoff 1=bip+logoff 2=anti pad</p>
<p>Emulation ===&gt; EMAIL Type of terminal:</p>
<p>MINITEL : 40 or 80 columns PC : Emulation done by VirtelPC</p>
<p>HTML : Web Browser VT : VT 100</p>
<p>EBCDIC : not translated X25 : uses low level dialog</p>
<p>Signon program ===&gt; Controls user name and password</p>
<p>Menu program ===&gt; VIR0021B List of transactions</p>
<p>Identification scenario ===&gt; eg XML identification</p>
<p>Type 3 compression ===&gt; Discover typical screens (Virtel/PC)</p>
<p>Mandatory identification ===&gt; (PC or minitel)</p>
<p>3270 swap key ===&gt; eg P24</p>
<p>Extended colors ===&gt; E: extended X: extended + DBCS</p>
<p>P1=Update P3=Return P4=Transactions</p>
<p>Enter=Add</p>
<p>Figure 1‑139 Entry point for file transfer by SMTP</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
15:56:00</p>
<p>Internal name ===&gt; SMTP-05 To associate with an entry point name</p>
<p>External name ===&gt; E-Mail Name displayed on user menu</p>
<p>Description ===&gt; File transfer by SMTP</p>
<p>Application ===&gt; VIR0041B Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 2 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 1 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 1 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>Translation(s) ===&gt; 0=idem 1=8040 2=8080 3=4040 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt;</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑140 Transaction for file transfer by SMTP</p>
</div>
<div class="section" id="starting-an-application-by-e-mail">
<h4>Starting an application by e-mail<a class="headerlink" href="#starting-an-application-by-e-mail" title="Permalink to this headline">¶</a></h4>
<p>When an entry point is used for starting an application by e-mail, the
application must be associated with a relay (or pseudo-3270 terminal)
through which the application can retrieve the contents of the e-mail.
It is therefore necessary to specify the name of a relay LU in the
definition of the terminals attached to the SMTP line (refer to the
VIRTEL Connectivity Reference documentation for details of defining an
SMTP line).</p>
<p>For this type of application, the entry point chosen by the rules of the
SMTP line has a single VIRTEL transaction, defined with application type
1 and startup mode 1, which calls the target VTAM application (such as
CICS). The name of the CICS transaction to be started can be specified
in the “TIOA at logon” field of the VIRTEL transaction definition. The
menu program specified in the entry point must be VIR0021B.</p>
<p>ENTRY POINT DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
16:07:14</p>
<p>Name ===&gt; SMTPCICS Name this ENTRY POINT (LOGON DATA)</p>
<p>Description ===&gt; CICS transaction started by e-mail</p>
<p>Transactions ===&gt; SMCICS Prefix for associated transactions</p>
<p>Videotex key ===&gt; If videotex, keyword or $NONE$</p>
<p>Transparency ===&gt; Server types NOT to emulate</p>
<p>Time out ===&gt; 0001 minutes Maximum inactive time</p>
<p>Do if timeout ===&gt; 0 0=logoff 1=bip+logoff 2=anti pad</p>
<p>Emulation ===&gt; EMAIL Type of terminal:</p>
<p>MINITEL : 40 or 80 columns PC : Emulation done by VirtelPC</p>
<p>HTML : Web Browser VT : VT 100</p>
<p>EBCDIC : not translated X25 : uses low level dialog</p>
<p>Signon program ===&gt; Controls user name and password</p>
<p>Menu program ===&gt; VIR0021B List of transactions</p>
<p>Identification scenario ===&gt; eg XML identification</p>
<p>Type 3 compression ===&gt; Discover typical screens (Virtel/PC)</p>
<p>Mandatory identification ===&gt; (PC or minitel)</p>
<p>3270 swap key ===&gt; eg P24</p>
<p>Extended colors ===&gt; E: extended X: extended + DBCS</p>
<p>P1=Update P3=Return P4=Transactions</p>
<p>Enter=Add</p>
<p>Figure 1‑141 Entry point for application started by SMTP</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
16:09:12</p>
<p>Internal name ===&gt; SMCICS-1 To associate with an entry point name</p>
<p>External name ===&gt; MAILIN Name displayed on user menu</p>
<p>Description ===&gt; CICS transaction started by e-mail</p>
<p>Application ===&gt; SPCICST Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 1 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 1 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 1 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>Translation(s) ===&gt; 0=idem 1=8040 2=8080 3=4040 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt; MELI</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 1‑142 Transaction for application started by SMTP</p>
<p>The corresponding CICS definition is shown in the example below:</p>
<p>DEFINE PROFILE(MELPROF) GROUP(VIRTSMTP)</p>
<p>DESCRIPTION(TRANSACTION TO PROCESS INCOMING EMAILS)</p>
<p>UCTRAN(NO)</p>
<p>DEFINE TRANSACTION(MELI) GROUP(VIRTSMTP)</p>
<p>DESCRIPTION(TRANSACTION TO PROCESS INCOMING EMAILS)</p>
<p>PROGRAM(SMTPMELI) PROFILE(MELPROF)</p>
<p>DEFINE PROGRAM(SMTPMELI) GROUP(VIRTSMTP)</p>
<p>DESCRIPTION(PROGRAM TO PROCESS INCOMING EMAILS)</p>
<p>Figure 1‑143 CICS definitions for application started by e-mail</p>
<p>Note that the UCTRAN(NO) parameter must be specified both in the PROFILE
and in the TYPETERM, and that the RECEIVESIZE specified in the TYPETERM
must be sufficient to contain the e-mail response data structured field.</p>
<p>One the application has been launched, it can retrieve data from the
e-mail by sending an FAC8 code 12 structured field to VIRTEL via the
relay LU and reading the response (see “Retrieve data from an e-mail” in
the VIRTEL Programming Interface documentation sur la page 290).</p>
</div>
</div>
<div class="section" id="virtel-batch">
<h3>VIRTEL Batch<a class="headerlink" href="#virtel-batch" title="Permalink to this headline">¶</a></h3>
<p>The VIRTEL Batch facility allows you to run VIRTEL as a batch job to
execute HTTP-like requests. VIRTEL reads HTTP-like requests from a SYSIN
dataset, executes the desired transaction, and writes an HTTP-like
response to a SYSOUT dataset. When all of the HTTP-like requests have
been processed, VIRTEL terminates if requested.</p>
<p>VIRTEL runs as a batch job when both of the following conditions are
true:</p>
<p>1) The VIRTCT contains a BATCH1 parameter. For details, refer to
“Parameters of the VIRTCT” in the <em>VIRTEL Installation Guide</em> manual.</p>
<p>2) A BATCH line is defined in the VIRTEL configuration in the VIRARBO
file. For details, refer to “Definition of a BATCH line” in the <em>VIRTEL
Connectivity Reference</em> manual.</p>
<p>Before running a VIRTEL Batch job for the first time, several
preparatory steps must be performed:</p>
<ul class="simple">
<li>A VIRTCT for VIRTEL Batch must be assembled and link-edited into the
VIRTEL load library</li>
<li>A configuration file (VIRARBO) for VIRTEL Batch must be built</li>
<li>A page template file (HTMLTRSF) for the VIRTEL Batch job must be
allocated and loaded</li>
<li>Work files (VIRSWAP, VIRHTML) for the VIRTEL Batch job must be
allocated and initialized</li>
</ul>
<p>These preparatory steps, which in general only need to be performed
once, are described in the following sections.</p>
<div class="section" id="assembling-the-virtct-for-virtel-batch">
<h4>Assembling the VIRTCT for VIRTEL Batch<a class="headerlink" href="#assembling-the-virtct-for-virtel-batch" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL Batch requires a special VIRTCT which must be assembled and
link-edited into the VIRTEL load library. The figure below shows SAMPLIB
member VIRTCTBA, which is an example VIRTCT suitable for running VIRTEL
Batch. The job ASMTCT in the VIRTEL SAMPLIB should be run once to
assemble and link-edit this module as VIRTCTBA in the VIRTEL load
library:</p>
<p>VIRTCTBA TITLE &#8216;VIRTCT FOR VIRTEL BATCH&#8217;</p>
<p>PRINT GEN</p>
<p>VIRTERM TYPE=INITIAL,APPLID=*NOAPPL*, *</p>
<p>BATCH1=(SYSIN,DCBI1,SYSPRINT,DCBO1), *</p>
<p>VIRSV1=(VIRSV), *</p>
<p>HTVSAM=VIRHTML, *</p>
<p>BUFSIZE=16000, *</p>
<p>STATS=NO, *</p>
<p>UFILE1=(HTMLTRSF,ACBH1,0,10,01), *</p>
<p>MEMORY=ABOVE, *</p>
<p>COMPANY=&#8217;YOUR COMPANY NAME&#8217;, *</p>
<p>ADDR1=&#8217;YOUR COMPANY ADDRESS&#8217;, *</p>
<p>ADDR2=&#8217;YOUR COMPANY ADDRESS&#8217;, *</p>
<p>LICENCE=&#8217;YOUR LICENCE ID&#8217;, *</p>
<p>EXPIRE=(2008,12,31), *</p>
<p>CODE=&#8216;00000000&#8217; *</p>
<p>TITRE1=&#8217;VIRTEL BATCH&#8217;</p>
<p>*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;*</p>
<p>ACBH1 ACB AM=VSAM,DDNAME=HTMLTRSF,MACRF=(SEQ,DIR,OUT,LSR), *</p>
<p>STRNO=3</p>
<p>*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;*</p>
<p>DCBI1 DCB DDNAME=SYSIN, SYSIN DD *</p>
<p>DCBE=DCBI1X, *</p>
<p>LRECL=80, *</p>
<p>DSORG=PS, *</p>
<p>RECFM=FB, *</p>
<p>MACRF=(GL)</p>
<p>DCBI1X DCBE EODAD=0,RMODE31=BUFF</p>
<p>*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;*</p>
<p>DCBO1 DCB DDNAME=SYSPRINT, SYSPRINT DD *</p>
<p>DCBE=DCBO1X, *</p>
<p>LRECL=133, *</p>
<p>DSORG=PS, *</p>
<p>RECFM=FBA, *</p>
<p>MACRF=(PM)</p>
<p>DCBO1X DCBE RMODE31=BUFF</p>
<p>*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;*</p>
<p>END</p>
<p>Figure 1‑144 Example VIRTCT for VIRTEL Batch</p>
</div>
<div class="section" id="building-the-configuration-file-for-virtel-batch">
<h4>Building the configuration file for VIRTEL Batch<a class="headerlink" href="#building-the-configuration-file-for-virtel-batch" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL Batch requires its own configuration file (VIRARBO) which defines
a Batch Line, the page template dataset, a Batch Entry Point, and the
Transactions which will be executed by the VIRTEL Batch job. The figure
below shows SAMPLIB member VIRBATAR, which is an example of a job to
create the VIRARBO file for use by VIRTEL Batch. This job should be run
once before the first execution of a VIRTEL Batch job:</p>
<p>//VIRBATAR JOB 1,VIRBATAR,CLASS=A,MSGCLASS=X,NOTIFY=&amp;SYSUID</p>
<p>// SET LOADLIB=yourqual.VIRTnnn.LOADLIB</p>
<p>//DEFINE EXEC PGM=IDCAMS</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>DELETE (yourqual.VIRBATCH.ARBO) CLUSTER PURGE</p>
<p>SET MAXCC = 0</p>
<p>DEFINE CLUSTER(NAME(yourqual.VIRBATCH.ARBO) -</p>
<p>KEYS(9 0) RECSZ(100 4089) FSPC(10 10) -</p>
<p>VOL(XXXXXX) REC(250,50) SHR(4) SPEED) -</p>
<p>DATA(NAME(yourqual.VIRBATCH.ARBO.DATA) CISZ(4096)) -</p>
<p>INDEX(NAME(yourqual.VIRBATCH.ARBO.INDEX))</p>
<p>//CONFIG EXEC PGM=VIRCONF,COND=(0,NE),PARM=&#8217;LOAD,LANG=&amp;LANG&#8217;</p>
<p>//STEPLIB DD DSN=&amp;LOADLIB,DISP=SHR</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//VIRARBO DD DSN=yourqual.VIRBATCH.ARBO,DISP=SHR</p>
<p>LINE ID=B-BT1,NAME=BATCH-L1,</p>
<p>DESC=&#8217;VIRTEL Batch line&#8217;,</p>
<p>TYPE=BATCH1,ENTRY=EPBATCH,TERMINAL=BT,</p>
<p>INOUT=1,PROTOCOL=VIRHTTP,RULESET=B-BT1</p>
<p>TERMINAL ID=BTLOC000,</p>
<p>DESC=&#8217;VIRTEL Batch terminals (no relay)&#8217;,</p>
<p>TYPE=3,COMPRESS=2,INOUT=3,STATS=12,REPEAT=4</p>
<p>TERMINAL ID=BTVTA000,RELAY=*HTTPOOL,</p>
<p>DESC=&#8217;VIRTEL Batch terminals (with relay)&#8217;,</p>
<p>TYPE=3,COMPRESS=2,INOUT=3,STATS=12,REPEAT=4</p>
<p>TERMINAL ID=BTVTP000,RELAY=RVIRBT00,POOL=*HTTPOOL,</p>
<p>DESC=&#8217;Relay pool for HTTP&#8217;,</p>
<p>TYPE=3,COMPRESS=2,INOUT=3,STATS=12,REPEAT=4</p>
<p>SUBDIR ID=W2H-DIR,</p>
<p>DESC=&#8217;Pages for WEB2HOST&#8217;,</p>
<p>FSTYPE=V,DDNAME=HTMLTRSF,KEY=W2H-KEY,</p>
<p>NAMELEN=64,AUTHUP=X,AUTHDOWN=X,AUTHDEL=X</p>
<p>ENTRY ID=EPBATCH,</p>
<p>DESC=&#8217;VIRTEL Batch entry point&#8217;,</p>
<p>TRANSACT=BAT,TIMEOUT=1,ACTION=0,EXTCOLOR=X,</p>
<p>EMUL=HTML,SIGNON=VIR0020H,MENU=VIR0021A</p>
<p>TRANSACT ID=BAT-00,NAME=EPBATCH,</p>
<p>DESC=&#8217;Default directory = entry point name&#8217;,</p>
<p>APPL=W2H-DIR,TYPE=4,</p>
<p>TERMINAL=BTLOC,STARTUP=2,SECURITY=0</p>
<p>TRANSACT ID=BAT-14,NAME=&#8217;Protide&#8217;,</p>
<p>DESC=&#8217;XML conversion&#8217;,</p>
<p>APPL=$NONE$,TYPE=2,</p>
<p>TERMINAL=BTLOC,STARTUP=1,SECURITY=0,</p>
<p>TIOASTA=&#8217;&amp;/S OK &amp;/T&#8217;,</p>
<p>EXITSTA=SCENSVIO</p>
<p>* END OF CONFIGURATION</p>
<p>Figure 1‑145 Job to build configuration file for VIRTEL Batch</p>
</div>
<div class="section" id="allocating-the-page-template-file-for-virtel-batch">
<h4>Allocating the page template file for VIRTEL Batch<a class="headerlink" href="#allocating-the-page-template-file-for-virtel-batch" title="Permalink to this headline">¶</a></h4>
<p>Each VIRTEL Batch job requires an HTMLTRSF file which contains the page
templates used by the transactions which will be executed by the VIRTEL
Batch job. The figure below shows SAMPLIB member VIRBATAT, which is an
example job to allocate the HTMLTRSF file and to copy the page templates
from the sample file (SAMPTRSF) distributed with VIRTEL. This job should
be run once before the first execution of a VIRTEL Batch job:</p>
<p>//VIRBATAT JOB 1,VIRBATAT,CLASS=A,MSGCLASS=X,NOTIFY=&amp;SYSUID</p>
<p>//*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-*</p>
<p>//* DEFINITION OF FILE HTMLTRSF *</p>
<p>//*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-*</p>
<p>//SAMPTRF EXEC PGM=IDCAMS</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>DELETE (yourqual.VIRBATCH.HTMLTRSF) CLUSTER PURGE</p>
<p>SET MAXCC = 0</p>
<p>DEFINE CLUSTER (NAME(yourqual.VIRBATCH.HTMLTRSF) -</p>
<p>VOL(XXXXXX) SHR(2) KEYS(16 0) RECSZ(100 32758) REC(250 100)) -</p>
<p>DATA (NAME(yourqual.VIRBATCH.HTMLTRSF.DATA) SPANNED CISZ(4096)) -</p>
<p>INDEX (NAME(yourqual.VIRBATCH.HTMLTRSF.INDEX) CISZ(512))</p>
<p>//*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-*</p>
<p>//* INITIALISATION OF FILE HTMLTRSF *</p>
<p>//*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-*</p>
<p>//SAMPTRF EXEC PGM=IDCAMS</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//SAMPTRSF DD DSN=yourqual.VIRTnnn.SAMP.TRSF,DISP=SHR</p>
<p>//HTMLTRSF DD DSN=yourqual.VIRBATCH.HTMLTRSF,DISP=OLD</p>
<p>//SYSIN DD *</p>
<p>REPRO INFILE(SAMPTRSF) OUTFILE(HTMLTRSF)</p>
<p>Figure 1‑146 Job to allocate page template file for VIRTEL Batch</p>
</div>
<div class="section" id="allocating-work-files-for-virtel-batch">
<h4>Allocating work files for VIRTEL Batch<a class="headerlink" href="#allocating-work-files-for-virtel-batch" title="Permalink to this headline">¶</a></h4>
<p>Each VIRTEL Batch job requires its own VIRSWAP and VIRHTML files. The
figure below shows SAMPLIB member VIRBATAW, which is an example job to
allocate these files:</p>
<p>//VIRBATAW JOB 1,VIRBATAW,CLASS=A,MSGCLASS=X,NOTIFY=&amp;SYSUID</p>
<p>//*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-*</p>
<p>//* DEFINITION OF FILES VIRSWAP AND VIRHTML *</p>
<p>//*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-*</p>
<p>//VIRWORK EXEC PGM=IDCAMS</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>DELETE (yourqual.VIRBATCH.SWAP) CLUSTER PURGE</p>
<p>DELETE (yourqual.VIRBATCH.HTML) CLUSTER PURGE</p>
<p>SET MAXCC = 0</p>
<p>DEFINE CLUSTER (NAME(yourqual.VIRBATCH.SWAP) -</p>
<p>VOL(XXXXXX) KEYS(16 0) REC(10,5) RECSZ(100 8185) -</p>
<p>REUSE FSPC(10 10) SHR(2) SPEED) -</p>
<p>DATA (NAME(yourqual.VIRBATCH.SWAP.DATA) CISZ(8192)) -</p>
<p>INDEX (NAME(yourqual.VIRBATCH.SWAP.INDEX))</p>
<p>DEFINE CLUSTER (NAME(yourqual.VIRBATCH.HTML) -</p>
<p>VOL(XXXXXX) KEYS(64 0) REC(5 5) RECSZ(1000 4089) -</p>
<p>FSPC(10 10) SHR(4) SPEED) -</p>
<p>DATA (NAME(yourqual.VIRBATCH.HTML.DATA) CISZ(4096)) -</p>
<p>INDEX (NAME(yourqual.VIRBATCH.HTML.INDEX))</p>
<p>//*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-*</p>
<p>//* INITIALISATION OF FILE VIRHTML *</p>
<p>//*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-*</p>
<p>//INIHTML EXEC PGM=IDCAMS</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//INIT DD DATA,DLM=AA</p>
<p>$$$$IWS.WORKREC.INW$TEMP</p>
<p>AA</p>
<p>//VIRHTML DD DSN=yourqual.VIRBATCH.HTML,DISP=OLD</p>
<p>REPRO INFILE(INIT) OUTFILE(VIRHTML)</p>
<p>Figure 1‑147 Job to allocate work files for VIRTEL Batch</p>
</div>
<div class="section" id="running-the-virtel-batch-job">
<h4>Running the VIRTEL Batch job<a class="headerlink" href="#running-the-virtel-batch-job" title="Permalink to this headline">¶</a></h4>
<p>The figure below shows SAMPLIB member VIRBATCH, which contains an
example of a VIRTEL Batch job:</p>
<p>//VIRBATCH JOB 1,VIRBATCH,CLASS=G,MSGCLASS=X,NOTIFY=&amp;SYSUID</p>
<p>// SET TCT=BA</p>
<p>// SET QUAL1=yourqual.VIRT452</p>
<p>// SET QUAL2=yourqual.VIRBATCH</p>
<p>//VIRBAT EXEC PGM=VIR0000,REGION=64M,PARM=&amp;TCT</p>
<p>//STEPLIB DD DISP=SHR,DSN=&amp;QUAL1..LOADLIB</p>
<p>//DFHRPL DD DISP=SHR,DSN=&amp;QUAL1..LOADLIB</p>
<p>//SERVLIB DD DISP=SHR,DSN=&amp;QUAL1..LOADLIB</p>
<p>//VIRARBO DD DISP=OLD,DSN=&amp;QUAL2..ARBO</p>
<p>//VIRSWAP DD DISP=OLD,DSN=&amp;QUAL2..SWAP</p>
<p>//VIRHTML DD DISP=OLD,DSN=&amp;QUAL2..HTML</p>
<p>//HTMLTRSF DD DISP=OLD,DSN=&amp;QUAL2..HTMLTRSF</p>
<p>//SYSIN DD *</p>
<p><a href="#id199"><span class="problematic" id="id200">*</span></a>(commands and data statements, see below) *</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//VIRLOG DD SYSOUT=*</p>
<p>Figure 1‑148 Example JCL for VIRTEL Batch</p>
<p>The SYSIN file contains commands and data statements. The following
commands are valid in the SYSIN file:</p>
<p><strong>.GET</strong> indicates the start of an HTTP GET command</p>
<p><strong>.POST</strong> indicates the start of an HTTP POST command</p>
<p><strong>.RAW</strong> indicates the start of a raw HTTP request command</p>
<p><strong>.END</strong> indicates the end of a GET, POST, or RAW command</p>
<p><strong>.EOJ</strong> causes VIRTEL to terminate</p>
<p>These commands are described in the following sections.</p>
</div>
<div class="section" id="virtel-batch-commands">
<h4>VIRTEL Batch commands<a class="headerlink" href="#virtel-batch-commands" title="Permalink to this headline">¶</a></h4>
<div class="section" id="virtel-batch-get-command">
<h5>VIRTEL Batch GET command<a class="headerlink" href="#virtel-batch-get-command" title="Permalink to this headline">¶</a></h5>
<p>The following figure shows an example SYSIN file containing two GET
commands:</p>
<p>.GET</p>
<p>/protide.htm+protide VIRTEL transaction name</p>
<p>schema=TCC Schema name</p>
<p>in=&#8217;TCC.DATA&#8217; Input dataset name</p>
<p>out=&#8217;TCC.XML&#8217; Output dataset name</p>
<p>mode=wb,recfm=vb,lrecl=512,space=(cyl,(10,5)) Output file attributes</p>
<p>output_encoding=U Output encoding U or E</p>
<p>.END</p>
<p>.GET</p>
<p>/protide.htm+protide VIRTEL transaction name</p>
<p>schema=CRPR Schema name</p>
<p>in=&#8217;CRPR.XML&#8217; Input dataset name</p>
<p>out=&#8217;CRPR.DATA&#8217; Output dataset name</p>
<p>mode=wb,recfm=fb,lrecl=200 Output file attributes</p>
<p>input_encoding=U Input encoding U or E</p>
<p>.END</p>
<p>.EOJ</p>
<p>Figure 1‑149 Example VIRTEL Batch GET commands</p>
<p>Each .GET command is followed by one or more data statements.</p>
<p>The first statement following the .GET command is the VIRTEL URL of the
HTTP request (see “VIRTEL URL formats” sur la page 12). Only the
<em>pathname</em>, <em>pagename</em>, and <em>tranname</em> parts of the URL are required.
The <em>http://ipaddr:port</em> part of the URL must be omitted.</p>
<p>All subsequent statements (if any) following the .GET command are
appended to the URL as query parameters. To conform with standard HTTP
query syntax, VIRTEL adds a “?” before the first parameter and a “&amp;”
before each subsequent parameter. Thus, in the above example, VIRTEL
generates two HTTP requests:</p>
<p>GET&nbsp;/protide.htm+protide?schema=TCC&amp;in=&#8217;TCC.DATA&#8217;&amp;out=&#8217;TCC.XML&#8217;&amp;mode=wb,recfm=vb,lrecl=512,space=(cyl,(10,5))&amp;output_encoding=U&nbsp;HTTP/1.1</p>
<p>GET&nbsp;/protide.htm+protide?schema=CRPR&amp;in=&#8217;CRPR.XML&#8217;&amp;out=&#8217;CRPR.DATA&#8217;&amp;mode=wb,recfm=fb,lrecl=200&amp;input_encoding=U&nbsp;HTTP/1.1</p>
<p>Figure 1‑150 Example VIRTEL Batch GET requests</p>
</div>
<div class="section" id="virtel-batch-post-command">
<h5>VIRTEL Batch POST command<a class="headerlink" href="#virtel-batch-post-command" title="Permalink to this headline">¶</a></h5>
<p>The following figure shows an example SYSIN file containing a POST
command followed by XML data:</p>
<p>.POST text/xml</p>
<p>/xmldemo.xml+tran3</p>
<p>&lt;?xml version=&#8221;1.0&#8221; ?&gt;</p>
<p>&lt;methodCall&gt;</p>
<p>&lt;screenname&gt;T000-GAL&lt;/screenname&gt;</p>
<p>&lt;screentype&gt;3270&lt;/screentype&gt;</p>
<p>&lt;params&gt;</p>
<p>&lt;fieldname&gt;FIELD001&lt;/fieldname&gt;</p>
<p>&lt;uinput&gt;A&lt;/uinput&gt;</p>
<p>&lt;/params&gt;</p>
<p>&lt;/methodCall&gt;</p>
<p>.END</p>
<p>.EOJ</p>
<p>Figure 1‑151 Example VIRTEL Batch POST command</p>
<p>Each .POST command is followed by two or more data statements containing
the URL and the request body.</p>
<p>The first statement following the .POST command is the VIRTEL URL of the
HTTP request (see “VIRTEL URL formats” sur la page 12). Only the
<em>pathname</em>, <em>pagename</em>, and <em>tranname</em> parts of the URL are required.
The <em>http://ipaddr:port</em> part of the URL must be omitted.</p>
<p>All subsequent statements following the .POST command are considered to
be the request body. VIRTEL automatically generates a Content-length:
header corresponding to the size of the request body. VIRTEL also adds a
Content-type: header if the content type is specified as an operand of
the .POST command as shown in the example. Thus, in the above example,
VIRTEL generates the following HTTP request:</p>
<p>POST /xmldemo.xml+tran3 HTTP/1.1</p>
<p>Content-Length: 00000201</p>
<p>Content-Type: text/xml</p>
<p>Special: GIVE-LENGTH-PREFIX</p>
<p>&lt;?xml version=&#8221;1.0&#8221; ?&gt;</p>
<p>&lt;methodCall&gt;</p>
<p>&lt;screenname&gt;T000-GAL&lt;/screenname&gt;</p>
<p>&lt;screentype&gt;3270&lt;/screentype&gt;</p>
<p>&lt;params&gt;</p>
<p>&lt;fieldname&gt;FIELD001&lt;/fieldname&gt;</p>
<p>&lt;uinput&gt;A&lt;/uinput&gt;</p>
<p>&lt;/params&gt;</p>
<p>&lt;/methodCall&gt;</p>
<p>Figure 1‑152 Example VIRTEL Batch POST request</p>
</div>
<div class="section" id="virtel-batch-raw-command">
<h5>VIRTEL Batch RAW command<a class="headerlink" href="#virtel-batch-raw-command" title="Permalink to this headline">¶</a></h5>
<p>The following figure shows an example SYSIN file containing a RAW
command followed by HTTP request data:</p>
<p>.RAW</p>
<p>POST /virmsg.txt+uplw2h HTTP/1.1</p>
<p>Content-Type: multipart/form-data;
boundary=&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;9503744825200</p>
<p>Content-Length: 227</p>
<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-9503744825200</p>
<p>Content-Disposition: form-data; name=&#8221;file&#8221;; filename=&#8221;test.txt&#8221;</p>
<p>Content-Type: text/plain</p>
<p>This is the test data file for upload</p>
<p>More test data here</p>
<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-9503744825200&#8211;</p>
<p>.END</p>
<p>.EOJ</p>
<p>Figure 1‑153 Example VIRTEL Batch RAW command</p>
<p>Each .RAW command is followed by one or more data statements containing
the HTTP request line, the request headers, and the request body. A
blank line separates the request headers from the request body. VIRTEL
generates an HTTP request exactly as contained in the data statements.</p>
</div>
</div>
<div class="section" id="virtel-batch-return-codes">
<h4>VIRTEL Batch return codes<a class="headerlink" href="#virtel-batch-return-codes" title="Permalink to this headline">¶</a></h4>
<p>When a VIRTEL Batch job terminates, the condition code is set to the
highest ERROR$ code set by the of the scenarios executed (value 0 to
255).</p>
<p>The condition code may also be set to 4 or 5 (unless a scenario has
indicated a higher value) if a request executed by the batch job
produced an HTTP response code in the range 4xx or 5xx.</p>
<p>In the case of a scenario abend, the completion code contains the offset
of the abend within the scenario.</p>
<p>If the VIRTEL Batch job terminates because of an error condition (for
example, an invalid batch command, missing DD statement, or insufficient
memory) then the condition code is set to 16.</p>
</div>
</div>
</div>
<div class="section" id="outgoing-calls">
<h2>Outgoing Calls<a class="headerlink" href="#outgoing-calls" title="Permalink to this headline">¶</a></h2>
<div class="section" id="outgoing-e-mails">
<h3>Outgoing E-mails<a class="headerlink" href="#outgoing-e-mails" title="Permalink to this headline">¶</a></h3>
<p>The FAD4 structured field allows a host application to send an e-mail.
This function is described in the VIRTEL Programming Interface
documentation sur la page 294.</p>
<p>The entry point used to invoke the host application must contain a
type-3 transaction with external name $MAIL$. The “Application” field
must contain the name of the SMTP line to be used for sending the
outgoing e-mail.</p>
<p>An example transaction is shown below:</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRE2
13:43:23</p>
<p>Internal name ===&gt; W2H-75 To associate with an entry point name</p>
<p>External name ===&gt; $mail$ Name displayed on user menu</p>
<p>Description ===&gt; Send messages via SMTP</p>
<p>Application ===&gt; S-SMTP Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 3 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 2 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 1 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt;</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 2‑1 Transaction definition for outgoing e-mails</p>
<p>Refer to the VIRTEL Connectivity Reference documentation for details of
defining transactions, entry points, and SMTP lines.</p>
</div>
</div>
<div class="section" id="programming-interfaces">
<h2>Programming Interfaces<a class="headerlink" href="#programming-interfaces" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id201">
<h3>Introduction<a class="headerlink" href="#id201" title="Permalink to this headline">¶</a></h3>
<p>Certain VIRTEL functions can be driven by application programs. These
functions are generally requested by sending specially formatted
commands to VIRTEL on the same 3270 session through which the
application communicates with the end user.</p>
<p>An application can request VIRTEL functions in the following ways:</p>
<ul class="simple">
<li>By sending a message containing structured fields recognized by
VIRTEL</li>
<li>By embedding HOST4WEB commands in the 3270 screen (available from
VIRTEL version 4.28 onwards)</li>
</ul>
<div class="section" id="structured-fields">
<h4>Structured fields<a class="headerlink" href="#structured-fields" title="Permalink to this headline">¶</a></h4>
<p>In addition to sending normal screen display data, a 3270 application
may also send data in specially formatted fields known as “structured
fields”. Structured fields are sent using a special 3270 command “Write
Structured Field” (code X&#8217;F3&#8217;). Each structured field contains a 2-byte
identification code. VIRTEL intercepts structured fields whose code
begins with X&#8217;FA&#8217;. By sending structured fields to VIRTEL on the 3270
session, the VIRTEL Web Integration application can direct VIRTEL to
perform certain functions.</p>
<p>The operations available to VIRTEL Web Integration applications via
structured fields are as follows:</p>
<ul class="simple">
<li>Specify the HTML page template to be used to format 3270 screens for
the browser</li>
<li>Specify the directory from which HTML page templates are to be
retrieved</li>
<li>Send a list of values (a table variable) to an HTML page</li>
<li>Send an outgoing e-mail</li>
<li>Retrieve the contents of an incoming e-mail</li>
</ul>
<div class="section" id="general-format-of-a-3270-structured-field">
<h5>General format of a 3270 structured field<a class="headerlink" href="#general-format-of-a-3270-structured-field" title="Permalink to this headline">¶</a></h5>
<p>As a general rule, the format of a structured field is as shown below:</p>
<p>X&#8217;nnnnccccdd....dd&#8217;</p>
<p>where <strong>*nnnn*</strong> represents the length, <strong>*cccc*</strong> is the identification
code, and <strong>*dd....dd*</strong> is the data. The length includes the length of
the <strong>*nnnn*</strong> and <strong>*cccc*</strong> fields, thus <strong>*nnnn*</strong> is always 4 more
than the length of the data.</p>
</div>
<div class="section" id="sending-structured-fields-via-the-write-structured-field-command">
<h5>Sending structured fields via the Write Structured Field command<a class="headerlink" href="#sending-structured-fields-via-the-write-structured-field-command" title="Permalink to this headline">¶</a></h5>
<p>VIRTEL recognizes that a message contains structured fields whenever the
application uses the 3270 command X&#8217;F3&#8217; (Write Structured Field) to send
the message to the terminal.</p>
<p>For CICS applications, the STRFIELD option of the EXEC CICS SEND command
requests CICS to send the message using command code X&#8217;F3&#8217;:</p>
<p>EXEC CICS SEND FROM(DATA1)</p>
<p>LENGTH(LENGTH OF DATA1)</p>
<p>STRFIELD</p>
<p>END-EXEC.</p>
<p>For non-CICS applications, the appropriate method of generating a Write
Structured Field command should be used. It is also possible to convert
a normal message into a structured field message by means of VIRTEL exit
4 (outbound message exit).</p>
</div>
<div class="section" id="sending-structured-fields-using-the-srtvirtel-prefix">
<h5>Sending structured fields using the SRTVIRTEL prefix<a class="headerlink" href="#sending-structured-fields-using-the-srtvirtel-prefix" title="Permalink to this headline">¶</a></h5>
<p>If the application monitor does not support the X&#8217;F3&#8217; (Write Structured
Field) command for sending structured fields (for example, IMS), VIRTEL
provides an alternative method for processing structured field data. If
the 3270 message begins with the special header:</p>
<p>X&#8216;1140401D40&#8217;,C&#8217;SRTVIRTEL&#8217;,X&#8216;11404B&#8217;</p>
<p>then VIRTEL treats the remainder of the message as structured fields.</p>
<p>The SRTVIRTEL header is built by the application, and the application
monitor adds 3270 command byte X&#8217;F1&#8217; (Write), X&#8217;F5&#8217; (Erase/Write), or
X&#8216;7E&#8217; (Erase/Write Alternate), followed by an appropriate WCC (Write
Control Character).</p>
<p>For example,</p>
<p>F1 C3 1140401D40 C&#8217;SRTVIRTEL&#8217; 11404B 0016 FAE5 08 08 E3D9F0F0F0F0F0F1
818683A796A34040</p>
<p>is processed identically to:F3 0016 FAE5 08 08 E3D9F0F0F0F0F0F1
818683A796A34040</p>
</div>
</div>
<div class="section" id="how-to-determine-if-running-under-virtel">
<h4>How to determine if running under VIRTEL<a class="headerlink" href="#how-to-determine-if-running-under-virtel" title="Permalink to this headline">¶</a></h4>
<p>Because the structured fields described in this chapter are understood
only by VIRTEL and not by regular 3270 terminals, your application will
need to determine whether it is communicating with a VIRTEL
pseudo-terminal before writing a VIRTEL structured field. This section
describes some techniques that your application can use to decide if it
is communicating with VIRTEL pseudo-terminal or with a regular 3270
terminal.</p>
<div class="section" id="use-a-different-transaction-code">
<h5>Use a different transaction code<a class="headerlink" href="#use-a-different-transaction-code" title="Permalink to this headline">¶</a></h5>
<p>By defining two different transaction codes which invoke the same CICS
application program (for example, DEMO for 3270, and VEMO for VIRTEL),
the application can test the field EIBTRNID to determine if it is
running under VIRTEL.</p>
<p>The figure below shows sample DFHCSDUP statements to associate two
transaction codes (DEMO and VEMO) with a single application program
DEMOPROG:</p>
<p>DEFINE TRANSACTION(DEMO) GROUP(DEMOGRP)</p>
<p>PROGRAM(DEMOPROG) PROFILE(DFHCICST) STATUS(ENABLED)</p>
<p>DEFINE TRANSACTION(<strong>VEMO</strong>) GROUP(DEMOGRP)</p>
<p>PROGRAM(DEMOPROG) PROFILE(DFHCICST) STATUS(ENABLED)</p>
<p>Figure 3‑1 Defining an alternate CICS transaction code for an
application</p>
<p>The figure below shows sample VIRCONF statements to define a VIRTEL
transaction which starts the application using the CICS transaction code
VEMO:</p>
<p>TRANSACT ID=CLI-10,</p>
<p>NAME=&#8217;CICS&#8217;,</p>
<p>DESC=&#8217;Logon to DEMO application&#8217;,</p>
<p>APPL=DBDCCICS,</p>
<p>TYPE=1,</p>
<p>TERMINAL=CLVTA,</p>
<p>STARTUP=1,</p>
<p>SECURITY=1,</p>
<p>TIOASTA=&#8221;Signon&amp;/W&amp;*7D4C7D&amp;&#8216;114BE9&#8217;&amp;U&amp;&#8216;114CF9&#8217;&amp;P&amp;/Acompl-</p>
<p>ete&amp;/W <strong>VEMO</strong>&amp;/A&#8221;</p>
<p>Figure 3‑2 Invoking the alternate transaction code from VIRTEL</p>
<p>The figure below shows sample COBOL statements which allow the DEMOPROG
program to take different actions based upon the CICS transaction code:</p>
<p><strong>*in Working-Storage:*</strong></p>
<p>01 THIS-IS-VIRTEL-CALL-SW PIC X.</p>
<p>88 THIS-IS-VIRTEL-CALL VALUE &#8216;Y&#8217;.</p>
<p>88 THIS-IS-NOT-VIRTEL-CALL VALUE &#8216;N&#8217;.</p>
<p><strong>*in the Procedure Division:*</strong></p>
<p>IF EIBTRNID (1 : 1) = &#8216;<strong>V</strong>&#8216;</p>
<p>MOVE &#8216;Y&#8217; TO THIS-IS-VIRTEL-CALL-SW</p>
<p>ELSE</p>
<p>MOVE &#8216;N&#8217; TO THIS-IS-VIRTEL-CALL-SW</p>
<p>END-IF</p>
<p>Figure 3‑3 Detecting VIRTEL by testing the transaction code</p>
</div>
<div class="section" id="include-parameters-after-the-transaction-code">
<h5>Include parameters after the transaction code<a class="headerlink" href="#include-parameters-after-the-transaction-code" title="Permalink to this headline">¶</a></h5>
<p>By adding additional data after the transaction code when the
transaction is invoked by VIRTEL, the application can receive the
parameter data to verify whether it is running under VIRTEL. In the
following example we add a V after the transaction code when the
application is called via VIRTEL.</p>
<p>The figure below shows sample VIRCONF statements to define a VIRTEL
transaction which starts the CICS transaction DEMO with an additional
parameter (“V”):</p>
<p>TRANSACT ID=CLI-10,</p>
<p>NAME=&#8217;CICS&#8217;,</p>
<p>DESC=&#8217;Logon to DEMO application&#8217;,</p>
<p>APPL=DBDCCICS,</p>
<p>TYPE=1,</p>
<p>TERMINAL=CLVTA,</p>
<p>STARTUP=1,</p>
<p>SECURITY=1,</p>
<p>TIOASTA=&#8221;Signon&amp;/W&amp;*7D4C7D&amp;&#8216;114BE9&#8217;&amp;U&amp;&#8216;114CF9&#8217;&amp;P&amp;/Acompl-</p>
<p>ete&amp;/W DEMO<strong>V</strong>&amp;/A&#8221;</p>
<p>Figure 3‑4 Invoking a CICS transaction with additional parameters</p>
<p>The figure below shows sample COBOL statements which must be added to
the DEMOPROG program to receive and test the parameter data. When the
transaction is started by VIRTEL, the parameter field contains “V”. When
the transaction is started from a terminal, using the transaction code
DEMO with no additional parameters, the parameter field contains spaces:</p>
<p><strong>*in Working-Storage:*</strong></p>
<p>01 CICS-TIOA.</p>
<p>02 CICS-TIOA-TRANID PIC X(4) VALUE SPACES.</p>
<p>02 CICS-TIOA-PARAMV PIC X(1) VALUE SPACES.</p>
<p>02 FILLER PIC X(75) VALUE SPACES.</p>
<p>01 THIS-IS-VIRTEL-CALL-SW PIC X.</p>
<p>88 THIS-IS-VIRTEL-CALL VALUE &#8216;Y&#8217;.</p>
<p>88 THIS-IS-NOT-VIRTEL-CALL VALUE &#8216;N&#8217;.</p>
<p><strong>*in the Procedure Division:*</strong></p>
<p>EXEC CICS RECEIVE</p>
<p>INTO(CICS-TIOA)</p>
<p>END-EXEC</p>
<p>IF CICS-TIOA-PARAMV = &#8216;<strong>V</strong>&#8216;</p>
<p>MOVE &#8216;Y&#8217; TO THIS-IS-VIRTEL-CALL-SW</p>
<p>ELSE</p>
<p>MOVE &#8216;N&#8217; TO THIS-IS-VIRTEL-CALL-SW</p>
<p>END-IF</p>
<p>Figure 3‑5 Detecting VIRTEL by inspecting the contents of the TIOA</p>
</div>
<div class="section" id="use-a-specific-range-of-terminal-names">
<h5>Use a specific range of terminal names<a class="headerlink" href="#use-a-specific-range-of-terminal-names" title="Permalink to this headline">¶</a></h5>
<p>Since all VIRTEL requests are made from the VIRTEL terminal pool, the
application program can test the CICS terminal id or the VTAM LU name to
determine if it is running under VIRTEL, as shown in the following
example:</p>
<p>TERMINAL ID=W2HTP000,</p>
<p>RELAY=<strong>VIRTVT00</strong>,</p>
<p>POOL=*W2HPOOL,</p>
<p>DESC=&#8217;Relay pool for HTTP&#8217;,</p>
<p>RELAY2=VIRTPR00,</p>
<p>TYPE=3,</p>
<p>COMPRESS=2,</p>
<p>INOUT=3,</p>
<p>STATS=12,</p>
<p>REPEAT=0080</p>
<p>Figure 3‑6 Defining the VIRTEL terminal pool</p>
<p><strong>VIRTVT</strong>?? APPL
AUTH=(ACQ,PASS),MODETAB=ISTINCLM,DLOGMOD=SNX32702,EAS=1</p>
<p>Figure 3‑7 VTAM definition for the VIRTEL terminal pool</p>
<p><strong>*in Working-Storage:*</strong></p>
<p>01 THIS-IS-VIRTEL-CALL-SW PIC X.</p>
<p>88 THIS-IS-VIRTEL-CALL VALUE &#8216;Y&#8217;.</p>
<p>88 THIS-IS-NOT-VIRTEL-CALL VALUE &#8216;N&#8217;.</p>
<p><strong>*in the Procedure Division:*</strong></p>
<p>IF EIBTRMID (1 : 2) = &#8216;<strong>VT</strong>&#8216;</p>
<p>MOVE &#8216;Y&#8217; TO THIS-IS-VIRTEL-CALL-SW</p>
<p>ELSE</p>
<p>MOVE &#8216;N&#8217; TO THIS-IS-VIRTEL-CALL-SW</p>
<p>END-IF</p>
<p>Figure 3‑8 Detecting VIRTEL by testing the CICS terminal id</p>
<p><strong>*in Working-Storage:*</strong></p>
<p>01 MYLUNAME PIC X(8).</p>
<p>01 THIS-IS-VIRTEL-CALL-SW PIC X.</p>
<p>88 THIS-IS-VIRTEL-CALL VALUE &#8216;Y&#8217;.</p>
<p>88 THIS-IS-NOT-VIRTEL-CALL VALUE &#8216;N&#8217;.</p>
<p><strong>*in the Procedure Division:*</strong></p>
<p>EXEC CICS ASSIGN</p>
<p>NETNAME(MYLUNAME)</p>
<p>END-EXEC</p>
<p>IF MYLUNAME (1 : 4) = &#8216;<strong>VIRT</strong>&#8216;</p>
<p>MOVE &#8216;Y&#8217; TO THIS-IS-VIRTEL-CALL-SW</p>
<p>ELSE</p>
<p>MOVE &#8216;N&#8217; TO THIS-IS-VIRTEL-CALL-SW</p>
<p>END-IF</p>
<p>Figure 3‑9 Detecting VIRTEL by testing the VTAM LU name</p>
</div>
</div>
</div>
<div class="section" id="id202">
<h3>VIRTEL Web Integration<a class="headerlink" href="#id202" title="Permalink to this headline">¶</a></h3>
<div class="section" id="fa88-transmit-large-data-message-to-application">
<h4>FA88: Transmit large data message to application<a class="headerlink" href="#fa88-transmit-large-data-message-to-application" title="Permalink to this headline">¶</a></h4>
<p>By using the <strong>FA88</strong> structured field, an application can request data
from an HTTP terminal without being limited to the size of a 3270
screen.</p>
<p>The application sends an FA88 structured field containing the name of a
URL parameter to be retrieved. The “send message to terminal” flag
causes VIRTEL to send an HTTP response to the terminal. When the
terminal sends its next URL, VIRTEL sends to the application an FA88
structured field response containing the value of the URL parameter. The
application may retrieve the value in multiple segments. If the value
exceeds 32K in size then it must be retrieved in multiple segments. Once
the first segment has been received, the application requests subsequent
segments by sending another FA88 structured field containing the
“immediate answer” flag and the offset of the segment requested. VIRTEL
responds with an FA88 structured field response containing the segment
requested. In each response VIRTEL sets the flag byte to indicate
whether there is more data to be retrieved, and if so the number of
bytes remaining. The application continues the procedure until there is
no more data to be retrieved.</p>
<p>The format of the FA88 structured field sent by the application is shown
below:</p>
<ul class="simple">
<li>2 bytes Length of structured field = 14 + n</li>
<li>2 bytes Structured field identification code = X&#8217;FA88&#8217;</li>
<li>1 bytes X&#8216;00&#8217;</li>
<li>1 bytes Flags:</li>
</ul>
<p>X&#8216;01&#8217; = immediate answer</p>
<p>X&#8216;04&#8217; = send message to terminal</p>
<ul class="simple">
<li>2 bytes Maximum segment size requested (m)</li>
<li>4 bytes Offset of requested segment (o)</li>
<li>2 bytes Length of name (n)</li>
<li>n bytes Name of URL parameter</li>
</ul>
<p>Figure 3‑10 Format of structured field FA88</p>
<p>The format of the FA88 structured field response returned by VIRTEL is
shown below:</p>
<ul class="simple">
<li>2 bytes Length of structured field = 14 + n + x</li>
<li>2 bytes Structured field identification code = X&#8217;FA88&#8217;</li>
<li>1 bytes X&#8216;00&#8217;</li>
<li>1 bytes Flags:</li>
</ul>
<p>X&#8216;02&#8217; = there is more data</p>
<ul class="simple">
<li>2 bytes Length of segment returned (x)</li>
<li>4 bytes Number of bytes remaining (r)</li>
<li>2 bytes Length of name (n)</li>
<li>n bytes Name of variable</li>
<li>x bytes Requested data segment</li>
</ul>
<p>Figure 3‑11 Format of structured field response FA88</p>
</div>
<div class="section" id="fac8-selection-of-page-template">
<h4>FAC8: Selection of page template<a class="headerlink" href="#fac8-selection-of-page-template" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL recognizes the <strong>FAC8</strong> structured field for the following
operations:</p>
<ul class="simple">
<li>Identifier un utilisateur à partir de sa signature Windows</li>
<li>Retourner vers la page d’accueil sur déconnexion de l’application</li>
<li>Change of directory for HTML page templates</li>
<li>Change of HTML page template</li>
</ul>
<p>To perform more than one function at a time, multiple FAC8 structured
fields can be sent in the same message.</p>
<div class="section" id="structured-field-fac8-code-06">
<h5>Structured field FAC8 code 06<a class="headerlink" href="#structured-field-fac8-code-06" title="Permalink to this headline">¶</a></h5>
<p>Structured field FAC8 code 06 allows the application to specify the name
of the VIRTEL directory to be used to retrieve the page template for the
current 3270 screen and all subsequent screens.</p>
<p>The format of a structured field FAC8 code 06 is:</p>
<blockquote>
<div><ul class="simple">
<li>2 bytes Length of structured field = X&#8216;000D&#8217;</li>
<li>2 bytes Structured field identification code = X&#8217;FAC8&#8217;</li>
<li>1 bytes Code = X&#8216;06&#8217; (change VIRTEL directory)</li>
<li>8 bytes Directory name</li>
</ul>
</div></blockquote>
<p>Figure 3‑12 Format of structured field FAC8 code 06</p>
</div>
<div class="section" id="structured-field-fac8-code-07">
<h5>Structured field FAC8 code 07<a class="headerlink" href="#structured-field-fac8-code-07" title="Permalink to this headline">¶</a></h5>
<p>Structured field FAC8 code 07 allows the application to specify the name
of the page template for the current 3270 screen and all subsequent
screens.</p>
<p>The format of a structured field FAC8 code 07 is:</p>
<blockquote>
<div><ul class="simple">
<li>2 bytes Length of structured field = variable (n+5)</li>
<li>2 bytes Structured field identification code = X&#8217;FAC8&#8217;</li>
<li>1 bytes Code = X&#8216;07&#8217; (change HTML page template)</li>
<li>n bytes Page template name</li>
</ul>
</div></blockquote>
<p>Figure 3‑13 Format of structured field FAC8 code 07</p>
</div>
<div class="section" id="cobol-example">
<h5>COBOL example<a class="headerlink" href="#cobol-example" title="Permalink to this headline">¶</a></h5>
<p><strong>*in Working-Storage: *</strong></p>
<p>*////////////////////////////////////////////////////////////////*</p>
<p>*///* - FAC8 request to VIRTEL (HTML page management) *///*</p>
<p>*///* - send structured field: *///*</p>
<p>*///* F3 LLLL FAC8 F PAGE or DIRECTORY *///*</p>
<p>*///* LLLL: Length of structured field (2 BYTES) *///*</p>
<p>*///* FAC8: Structured field id code (2 BYTES) *///*</p>
<p>*///* F : Requested function (1 BYTE BINARY) *///*</p>
<p>*///* 01: identifier l&#8217;utilisateur *///*</p>
<p>*///* 05: fonction &#8220;sommaire&#8221; *///*</p>
<p>*///* 06: change VIRTEL directory *///*</p>
<p>*///* 07: change HTML page template *///*</p>
<p>*///* PAGE or DIRECTORY: name (8 bytes) *///*</p>
<p>*////////////////////////////////////////////////////////////////*</p>
<p>01 FAC8-DEM.</p>
<p>05 FAC8-LONG PIC S9(4) COMP VALUE +5.</p>
<p>05 FAC8-FILL1 PIC X(02) VALUE X&#8217;FAC8&#8217;.</p>
<p>05 FAC8-FONCTION PIC X(01) VALUE &#8216; &#8216;.</p>
<p>05 FAC8-ARGUMENT PIC X(08) VALUE SPACES.</p>
<p>01 FAC8-DEM-IDENT-USER PIC X(01) VALUE X&#8216;01&#8217;.</p>
<p>01 FAC8-DEM-SOMMAIRE PIC X(01) VALUE X&#8216;05&#8217;.</p>
<p>01 FAC8-DEM-REPERTOIRE PIC X(01) VALUE X&#8216;06&#8217;.</p>
<p>01 FAC8-DEM-PAGE-HTML PIC X(01) VALUE X&#8216;07&#8217;.</p>
<p><strong>*in the Procedure Division:*</strong></p>
<p>MOVE LENGTH OF FAC8-DEM TO FAC8-LONG.</p>
<p>MOVE FAC8-DEM-PAGE-HTML TO FAC8-FONCTION.</p>
<p>MOVE &#8216;TOUTNOIR&#8217; TO FAC8-ARGUMENT.</p>
<p>PERFORM 8150-ENVOI-FAC8 THRU 8150-FIN</p>
<p>PERFORM 8830-ENVOI-MAP THRU 8830-FIN.</p>
<p>*////////////////////// SEND STRUCTURED FIELD ///////////////////*</p>
<p>8150-ENVOI-FAC8.</p>
<p>EXEC CICS SEND FROM (FAC8-DEM)</p>
<p>FROMLENGTH (FAC8-LONG)</p>
<p>STRFIELD</p>
<p>END-EXEC.</p>
<p>8150-FIN.</p>
<p>*/////////////////////// SEND MESSAGE 3270 ///////////////////////*</p>
<p>8830-ENVOI-MAP.</p>
<p>EXEC CICS SEND MAP (&#8216;NOMMAP2&#8217;)</p>
<p>MAPSET (&#8216;NONMAP2&#8217;)</p>
<p>ERASE</p>
<p>CURSOR (CICS-TS-POS-CURS)</p>
<p>END-EXEC.</p>
<p>8830-FIN.</p>
<p>Figure 3‑14 Example of sending structured field FAC8</p>
<p>An example of this function is supplied in member FAC8SAMP of the VIRTEL
SAMPLIB.</p>
</div>
</div>
<div class="section" id="fae5-fae6-sending-a-table-variable">
<h4>FAE5, FAE6: Sending a table variable<a class="headerlink" href="#fae5-fae6-sending-a-table-variable" title="Permalink to this headline">¶</a></h4>
<p>Structured field FAE5 allows the application to send a named data table
(“table variable”) to VIRTEL. The data in the table variable is made
available for insertion in the current HTML page by means of VIRTEL tags
coded in the page template (see “Handling table variables” sur la page
53), or by means of a scenario instruction (see “FIELD$
DEFINE-VARIABLE-CHOICE” sur la page 182) which allows the application to
supply lists of drop-down values for selection fields.</p>
<div class="section" id="structured-field-fae5">
<h5>Structured field FAE5<a class="headerlink" href="#structured-field-fae5" title="Permalink to this headline">¶</a></h5>
<p>The application can send one or more FAE5 structured fields. Each
structured field contains the name of a variable followed by a table of
values. The format of structured field FAE5 is shown below:</p>
<ul class="simple">
<li>2 bytes Length of structured field = variable</li>
<li>2 bytes Structured field identification code = X&#8217;FAE5&#8217;</li>
<li>1 bytes Length of each value (p)</li>
<li>1 bytes Length of name (n)</li>
<li>n bytes Name of variable</li>
<li>p bytes Value 1</li>
<li>p bytes Value 2</li>
<li>etc</li>
</ul>
<p>Figure 3‑15 Format of structured field FAE5 – format 1</p>
<p>The above format limits the length of each value to a maximum of 255
bytes. A second format of the FAE5 structured field allows the
application to set a single value whose length is equal to the remainder
of the structured field:</p>
<ul class="simple">
<li>2 bytes Length of structured field = variable</li>
<li>2 bytes Structured field identification code = X&#8217;FAE5&#8217;</li>
<li>1 bytes X&#8216;00&#8217;</li>
<li>1 bytes Length of name (n)</li>
<li>n bytes Name of variable</li>
<li>x bytes Value (x=structured field length – 6 – n)</li>
</ul>
<p>Figure 3‑16 Format of structured field FAE5 – format 2</p>
<p>After the application has sent a message containing an FAE5 structured
field, VIRTEL considers the current screen complete and sends the
response to the user.</p>
</div>
<div class="section" id="structured-field-fae6">
<h5>Structured field FAE6<a class="headerlink" href="#structured-field-fae6" title="Permalink to this headline">¶</a></h5>
<p>Structured field FAE6 is identical to FAE5, except that VIRTEL does not
consider the current screen to be complete, and waits for a further
output message from the application before sending the response to the
user.</p>
</div>
<div class="section" id="id203">
<h5>COBOL example<a class="headerlink" href="#id203" title="Permalink to this headline">¶</a></h5>
<p><strong>*in Working-Storage:*</strong></p>
<p>01 FAE5-LONG PIC S9(4) COMP VALUE +0.</p>
<p>01 FAE5-AREA.</p>
<p>05 FAE5-VARIABLE-1.</p>
<p>10 FAE5-SFLENGTH-1 PIC S9(4) COMP VALUE +0.</p>
<p>10 FILLER PIC X(2) VALUE X&#8217;FAE5&#8217;.</p>
<p>10 FAE5-LONG-POSTE-1 PIC X VALUE X&#8216;0A&#8217;.</p>
<p>10 FAE5-LONG-NOM-1 PIC X VALUE X&#8216;08&#8217;.</p>
<p>10 FAE5-NOM-1 PIC X(8) VALUE &#8216;VARNAME1&#8217;.</p>
<p>10 FAE5-POSTE-1-1 PIC X(10) VALUE &#8216;VALUE1&#8217;.</p>
<p>10 FAE5-POSTE-1-2 PIC X(10) VALUE &#8216;VALUE2&#8217;.</p>
<p>10 FAE5-POSTE-1-3 PIC X(10) VALUE &#8216;VALUE3&#8217;.</p>
<p>05 FAE5-VARIABLE-2.</p>
<p>10 FAE5-SFLENGTH-2 PIC S9(4) COMP VALUE +0.</p>
<p>10 FILLER PIC X(2) VALUE X&#8217;FAE5&#8217;.</p>
<p>10 FAE5-LONG-POSTE-2 PIC X VALUE X&#8216;04&#8217;.</p>
<p>10 FAE5-LONG-NOM-2 PIC X VALUE X&#8216;08&#8217;.</p>
<p>10 FAE5-NOM-2 PIC X(8) VALUE &#8216;VARNAME2&#8217;.</p>
<p>10 FAE5-POSTE-2-1 PIC 9(6) VALUE 123.</p>
<p>10 FAE5-POSTE-2-2 PIC 9(6) VALUE 234.</p>
<p>10 FAE5-POSTE-2-3 PIC 9(6) VALUE 456.</p>
<p><strong>*in the Procedure Division:*</strong></p>
<p>MOVE LENGTH OF FAE5-VARIABLE-1 TO FAE5-SFLENGTH-1</p>
<p>MOVE LENGTH OF FAE5-VARIABLE-2 TO FAE5-SFLENGTH-2</p>
<p>MOVE LENGTH OF FAE5-AREA TO FAE5-LONG</p>
<p>EXEC CICS SEND FROM(FAE5-AREA)</p>
<p>LENGTH(FAE5-LONG)</p>
<p>STRFIELD</p>
<p>END-EXEC</p>
<p>Figure 3‑17 Example of sending structured field FAE5</p>
</div>
</div>
<div class="section" id="call-interfaces">
<h4>Call interfaces<a class="headerlink" href="#call-interfaces" title="Permalink to this headline">¶</a></h4>
<p>Application programs running in a CICS or IMS environment using Language
Environment (LE) can request certain VIRTEL Web Integration functions by
means of callable modules. These modules construct the necessary
structured fields and send them to VIRTEL via CICS or IMS, thus
simplifying the job of the application programmer. These modules are
primarily designed to be called by CICS or IMS-COBOL programs, however
they can also be used by application programs written in other
languages. The modules, CALL&nbsp;VIRSETA, CALL&nbsp;VIRSETV (for CICS),
CALL&nbsp;VIRSETAI, CALL&nbsp;VIRSETVI (for IMS) and CALL&nbsp;VIRTEL, are described in
the following sections.</p>
<div class="section" id="call-virseta">
<h5>CALL VIRSETA<a class="headerlink" href="#call-virseta" title="Permalink to this headline">¶</a></h5>
<p>This module allows a CICS application program to copy an array of values
into a VIRTEL table variable. The calling program supplies the name of
the variable and an array containing the values. The VIRSETA module
builds one or more FAE6 structured fields containing the variable name
and the values, and sends the structured field(s) to VIRTEL using the
EXEC&nbsp;CICS&nbsp;SEND&nbsp;STRFIELD command.</p>
<p>The total size of the structured fields sent by a single call to VIRSETA
cannot exceed 32K, but additional data can be added to the VIRTEL table
variable by calling VIRSETA again with the same variable name.</p>
<p>When VIRSETA is used to copy values into a VIRTEL table variable, all of
the values must have the same length. To create a VIRTEL table variable
containing values of varying lengths, use CALL&nbsp;VIRSETV described in the
next section.</p>
<div class="section" id="call-virseta-parameters">
<h6>CALL VIRSETA parameters<a class="headerlink" href="#call-virseta-parameters" title="Permalink to this headline">¶</a></h6>
<p>Parameters passed by calling program:</p>
<blockquote>
<div><ol class="arabic simple">
<li>DFHEIBLK</li>
<li>DFHCOMMAREA</li>
</ol>
<p>3. Variable name (variable length EBCDIC string of 1-255 characters
terminated by blank or X&#8216;00&#8217;)</p>
<ol class="arabic simple" start="4">
<li>An array of elements each containing one data item</li>
</ol>
<p>5. Element size (signed halfword) contains the length of each
element of the array</p>
<p>6. Count (signed halfword) contains the number of elements in the
array</p>
<p>7. Data length (signed halfword) contains the length of the data
item contained in each element of the array. This may be less than
or equal to the element size.</p>
</div></blockquote>
</div>
<div class="section" id="call-virseta-example">
<h6>CALL VIRSETA example<a class="headerlink" href="#call-virseta-example" title="Permalink to this headline">¶</a></h6>
<p><strong>*in Working-Storage:*</strong></p>
<p>01 WS-ARRAY.</p>
<p>05 WS-ELEMENT OCCURS 50 TIMES.</p>
<p>10 WS-DATA-ITEM PIC X(80).</p>
<p>10 FILLER PIC X(20).</p>
<p>77 WS-ELEMENT-SIZE PIC S9(4) COMP SYNC.</p>
<p>77 WS-COUNT PIC S9(4) COMP SYNC.</p>
<p>77 WS-DATA-LENGTH PIC S9(4) COMP SYNC.</p>
<p><strong>*in the Procedure Division:*</strong></p>
<p>MOVE LENGTH OF WS-ELEMENT (1) TO WS-ELEMENT-SIZE.</p>
<p>MOVE 50 TO WS-COUNT.</p>
<p>MOVE LENGTH OF WS-DATA-ITEM (1) TO WS-DATA-LENGTH.</p>
<p>CALL &#8216;VIRSETA&#8217; USING DFHEIBLK</p>
<p>DFHCOMMAREA</p>
<p>BY CONTENT &#8216;MYVAR &#8216;</p>
<p>BY REFERENCE WS-ARRAY</p>
<p>WS-ELEMENT-SIZE</p>
<p>WS-COUNT</p>
<p>WS-DATA-LENGTH.</p>
<p>Figure 3‑18 Example of VIRTEL Web Integration application using CALL
VIRSETA</p>
</div>
<div class="section" id="call-virseta-return-codes">
<h6>CALL VIRSETA return codes<a class="headerlink" href="#call-virseta-return-codes" title="Permalink to this headline">¶</a></h6>
<p>If the call was successful, VIRSETA returns to the calling program.
Otherwise, VIRSETA terminates with an EXEC&nbsp;CICS&nbsp;ABEND.</p>
<p>The following abend codes may be issued by VIRSETA:</p>
<p><strong>VSA1</strong> Length of variable name is outside the range 1-255, or the
required terminator (blank or X&#8216;00&#8217;) is missing</p>
<p><strong>VSA2</strong> Data length is less than 1, or exceeds the element length.</p>
<p><strong>VSA3</strong> Count is less than 1.</p>
<p><strong>VSA4</strong> Data exceeds the maximum allowed size. If the length of each
data item is 255 or less, then the total size of the data (count x data
length) must not exceed 32760 – N, where N is the number of characters
in the variable name. If the length of each data item is 256 or more,
then count x (data length + 6 + N) must not exceed 32767.</p>
<p>Additionally CICS may issue an abend if the EXEC CICS SEND STRFIELD
command is unsuccessful.</p>
</div>
</div>
<div class="section" id="call-virsetv">
<h5>CALL VIRSETV<a class="headerlink" href="#call-virsetv" title="Permalink to this headline">¶</a></h5>
<p>This module allows a CICS application program to set the value of a
VIRTEL variable. The calling program supplies the name of the variable
and the value to be set. The VIRSETV module builds an FAE6 structured
field containing the variable name and value, and sends the structured
field to VIRTEL using the EXEC&nbsp;CICS&nbsp;SEND&nbsp;STRFIELD command.</p>
<p>VIRTEL variables containing more than one value are known as table
variables. The application program can create a table variable by
calling the VIRSETV module several times with the same variable name.
The first call creates the variable and adds the first value to it.
Subsequent calls add additional values to the table variable.</p>
<div class="section" id="call-virsetv-parameters">
<h6>CALL VIRSETV parameters<a class="headerlink" href="#call-virsetv-parameters" title="Permalink to this headline">¶</a></h6>
<p>Parameters passed by calling program:</p>
<blockquote>
<div><ol class="arabic simple">
<li>DFHEIBLK</li>
<li>DFHCOMMAREA</li>
</ol>
<p>3. Variable name (variable length EBCDIC string of 1-255 characters
terminated by blank or X&#8216;00&#8217;)</p>
<ol class="arabic simple" start="4">
<li>Value (variable length)</li>
<li>Length (signed halfword field containing length of value)</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="call-virsetv-example">
<h6>CALL VIRSETV example<a class="headerlink" href="#call-virsetv-example" title="Permalink to this headline">¶</a></h6>
<p><strong>*in Working-Storage:*</strong></p>
<p>77 WS-BUFFER PIC X(80) VALUE &#8216;** MY VALUE **&#8217;.</p>
<p>77 WS-LENGTH PIC S9(4) COMP SYNC.</p>
<p><strong>*in the Procedure Division:*</strong></p>
<p>MOVE LENGTH OF WS-BUFFER TO WS-LENGTH.</p>
<p>CALL &#8216;VIRSETV&#8217; USING DFHEIBLK</p>
<p>DFHCOMMAREA</p>
<p>BY CONTENT &#8216;MYVAR &#8216;</p>
<p>BY REFERENCE WS-BUFFER</p>
<p>WS-LENGTH.</p>
<p>Figure 3‑19 Example of VIRTEL Web Integration application using CALL
VIRSETV</p>
</div>
<div class="section" id="call-virsetv-return-codes">
<h6>CALL VIRSETV return codes<a class="headerlink" href="#call-virsetv-return-codes" title="Permalink to this headline">¶</a></h6>
<p>If the call was successful, VIRSETV returns to the calling program.
Otherwise, VIRSETV terminates with an EXEC&nbsp;CICS&nbsp;ABEND.</p>
<p>The following abend codes may be issued by VIRSETV:</p>
<p><strong>VSV1</strong> Length of variable name is outside the range 1-255, or the
required terminator (blank or X&#8216;00&#8217;) is missing</p>
<p><strong>VSV2</strong> Length of value is negative or exceeds the maximum allowed
length (32760 minus the length of the variable name).</p>
<p>Additionally CICS may issue an abend if the EXEC CICS SEND STRFIELD
command is unsuccessful.</p>
</div>
</div>
<div class="section" id="call-virsetai">
<h5>CALL VIRSETAI<a class="headerlink" href="#call-virsetai" title="Permalink to this headline">¶</a></h5>
<p>This module allows an IMS application program to copy an array of values
into a VIRTEL table variable. The calling program supplies the name of
the variable and an array containing the values. The VIRSETAI module
builds one or more FAE6 structured fields containing the variable name
and the values, and sends the structured field(s) to VIRTEL using the
CALL &#8216;CBLTDLI&#8217; USING ISRT, LS-IOPCB, OUTPUT-MESSAGE, MFS command.</p>
<p>The total size of the structured fields sent by a single call to
VIRSETAI cannot exceed 32K, but additional data can be added to the
VIRTEL table variable by calling VIRSETAI again with the same variable
name.</p>
<p>When VIRSETAI is used to copy values into a VIRTEL table variable, all
of the values must have the same length. To create a VIRTEL table
variable containing values of varying lengths, use CALL&nbsp;VIRSETVI
described in the next section.</p>
<div class="section" id="call-virsetai-parameters">
<h6>CALL VIRSETAI parameters<a class="headerlink" href="#call-virsetai-parameters" title="Permalink to this headline">¶</a></h6>
<p>Parameters passed by calling program:</p>
<blockquote>
<div><p>1. Variable name (variable length EBCDIC string of 1-255 characters
terminated by blank or X&#8216;00&#8217;)</p>
<ol class="arabic simple" start="2">
<li>An array of elements each containing one data item</li>
</ol>
<p>3. Element size (signed halfword) contains the length of each
element of the array</p>
<p>4. Count (signed halfword) contains the number of elements in the
array</p>
<p>5. Data length (signed halfword) contains the length of the data
item contained in each element of the array. This may be less than
or equal to the element size.</p>
<ol class="arabic simple" start="6">
<li>IMS I/O PCB</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="call-virsetai-example">
<h6>CALL VIRSETAI example<a class="headerlink" href="#call-virsetai-example" title="Permalink to this headline">¶</a></h6>
<p><strong>*in Working-Storage:*</strong></p>
<p>01 WS-TABLE.</p>
<p>05 WS-ELEMENT PIC X(80) OCCURS 100 TIMES.</p>
<p>77 WS-TESTDATA PIC X(10) VALUE &#8216;TEST DATA&#8217;.</p>
<p>77 WS-ELEMSIZE PIC S9(4) COMP SYNC.</p>
<p>77 WS-COUNT PIC S9(4) COMP SYNC.</p>
<p>77 WS-DATALEN PIC S9(4) COMP SYNC.</p>
<p>77 WS-RC1 PIC X.</p>
<p><strong>*in Procedure Division:*</strong></p>
<p>MOVE WS-TESTDATA TO WS-ELEMENT (1).</p>
<p>MOVE WS-TESTDATA TO WS-ELEMENT (2).</p>
<p>MOVE WS-TESTDATA TO WS-ELEMENT (3).</p>
<p>MOVE LENGTH OF WS-ELEMENT (1) TO WS-ELEMSIZE.</p>
<p>MOVE 3 TO WS-COUNT.</p>
<p>MOVE LENGTH OF WS-TESTDATA TO WS-DATALEN.</p>
<p>CALL &#8216;VIRSETAI&#8217; USING CONTENT &#8216;MYVAR &#8216;</p>
<p>REFERENCE WS-TABLE</p>
<p>WS-ELEMSIZE</p>
<p>WS-COUNT</p>
<p>WS-DATALEN</p>
<p>LS-IOPCB</p>
<p>RETURNING WS-RC1.</p>
<p>IF WS-RC1 NOT EQUAL 0 GO TO ERROR.</p>
<p>Figure 3‑20 Example of VIRTEL Web Integration application using CALL
VIRSETAI</p>
</div>
</div>
<div class="section" id="call-virsetvi">
<h5>CALL VIRSETVI<a class="headerlink" href="#call-virsetvi" title="Permalink to this headline">¶</a></h5>
<p>This module allows an IMS application program to set the value of a
VIRTEL variable. The calling program supplies the name of the variable
and the value to be set. The VIRSETVI module builds an FAE6 structured
field containing the variable name and value, and sends the structured
field to VIRTEL using the CALL &#8216;CBLTDLI&#8217; USING ISRT, LS-IOPCB,
OUTPUT-MESSAGE, MFS command.</p>
<p>VIRTEL variables containing more than one value are known as table
variables. The application program can create a table variable by
calling the VIRSETVI module several times with the same variable name.
The first call creates the variable and adds the first value to it.
Subsequent calls add additional values to the table variable.</p>
<div class="section" id="call-virsetvi-parameters">
<h6>CALL VIRSETVI parameters<a class="headerlink" href="#call-virsetvi-parameters" title="Permalink to this headline">¶</a></h6>
<p>Parameters passed by calling program:</p>
<blockquote>
<div><p>1. Variable name (variable length EBCDIC string of 1-255 characters
terminated by blank or X&#8216;00&#8217;)</p>
<ol class="arabic simple" start="2">
<li>Value (variable length)</li>
<li>Length (signed halfword field containing length of value)</li>
<li>IMS I/O PCB</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="call-virsetvi-example">
<h6>CALL VIRSETVI example<a class="headerlink" href="#call-virsetvi-example" title="Permalink to this headline">¶</a></h6>
<p><strong>*in Working-Storage:*</strong></p>
<p>77 WS-BUFFER PIC X(80) VALUE &#8216;** MY VALUE **&#8217;.</p>
<p>77 WS-LENGTH PIC S9(4) COMP SYNC.</p>
<p>77 WS-RC1 PIC X.</p>
<p><strong>*in Procedure Division:*</strong></p>
<p>MOVE LENGTH OF WS-BUFFER TO WS-LENGTH.</p>
<p>CALL &#8216;VIRSETVI&#8217; USING CONTENT &#8216;MYVAR &#8216;</p>
<p>REFERENCE WS-BUFFER</p>
<p>WS-LENGTH</p>
<p>LS-IOPCB</p>
<p>RETURNING WS-RC1.</p>
<p>IF WS-RC1 NOT EQUAL 0 GO TO ERROR.</p>
<p>Figure 3‑21 Example of VIRTEL Web Integration application using CALL
VIRSETVI</p>
</div>
</div>
<div class="section" id="call-virtel">
<h5>CALL VIRTEL<a class="headerlink" href="#call-virtel" title="Permalink to this headline">¶</a></h5>
<p>Application programs running in a CICS environment with LE can also call
a module named VIRTEL (see source delivered in the VIRTEL SAMPLIB
library at installation time) which builds and sends the structured
fields necessary to invoke the following functions:</p>
<ul class="simple">
<li>specify page template and directory (structured field FAC8)</li>
<li>send data for table variables (structured field FAE6)</li>
</ul>
<div class="section" id="call-virtel-example">
<h6>CALL VIRTEL example<a class="headerlink" href="#call-virtel-example" title="Permalink to this headline">¶</a></h6>
<p>The following COBOL example shows how to use CALL VIRTEL to send two
table variables (CHP_NUM1 and CPT_NUM1) and to request the use of a
specific page template (page WEB2VIRT in directory DEMO):</p>
<p><strong>*in Working-Storage:*</strong></p>
<p>* CALL &#8216;VIRTEL&#8217; takes one parameter with maximum size 2048 bytes</p>
<p>01 PARAMETRES-VIRTEL-FAC8.</p>
<p>02 VIRTEL-FONCTION-FAC8 PIC X(10) VALUE &#8216;SENDPAGW&#8217;.</p>
<p>02 VIRTEL-CODE-RETOUR-FAC8 PIC 9(02) VALUE 0.</p>
<p>02 VIRTEL-PAGE-HTML PIC X(10) VALUE &#8216;WEB2VIRT&#8217;.</p>
<p>02 VIRTEL-REPERTOIRE PIC X(10) VALUE &#8216;DEMO &#8216;.</p>
<p>02 VIRTEL-FILLER-FAC8 PIC X(2016).</p>
<p>01 PARAMETRES-VIRTEL-FAE6.</p>
<p>02 VIRTEL-FONCTION-FAE6 PIC X(10) VALUE &#8216;SENDTABW&#8217;.</p>
<p>02 VIRTEL-CODE-RETOUR-FAE6 PIC 9(02) VALUE 0.</p>
<p>02 VIRTEL-LONG-NOM PIC 9(02).</p>
<p>02 VIRTEL-LONG-POSTE PIC 9(02).</p>
<p>02 VIRTEL-NBR-POSTE PIC 9(03).</p>
<p>02 VIRTEL-FAE6-DATA.</p>
<p>05 VIRTEL-NOM PIC X(08).</p>
<p>05 VIRTEL-POSTE-01 PIC X(10).</p>
<p>05 VIRTEL-POSTE-02 PIC X(10).</p>
<p>05 VIRTEL-POSTE-03 PIC X(10).</p>
<p>05 VIRTEL-POSTE-04 PIC X(10).</p>
<p>05 VIRTEL-POSTE-05 PIC X(10).</p>
<p>05 VIRTEL-POSTE-06 PIC X(10).</p>
<p>05 VIRTEL-POSTE-07 PIC X(10).</p>
<p>05 VIRTEL-POSTE-08 PIC X(10).</p>
<p>05 VIRTEL-POSTE-09 PIC X(10).</p>
<p>05 VIRTEL-FILLER-FAE6 PIC X(1937).</p>
<p>02 VIRTEL-FAE6-DATA1 REDEFINES VIRTEL-FAE6-DATA.</p>
<p>05 VIRTEL-NOM1 PIC X(08).</p>
<p>05 VIRTEL-POSTE1-01 PIC X(10).</p>
<p>05 VIRTEL-POSTE1-02 PIC X(10).</p>
<p>05 VIRTEL-POSTE1-03 PIC X(10).</p>
<p>05 VIRTEL-POSTE1-04 PIC X(10).</p>
<p>05 VIRTEL-POSTE1-05 PIC X(10).</p>
<p>05 VIRTEL-POSTE1-06 PIC X(10).</p>
<p>05 VIRTEL-POSTE1-07 PIC X(10).</p>
<p>05 VIRTEL-POSTE1-08 PIC X(10).</p>
<p>05 VIRTEL-POSTE1-09 PIC X(10).</p>
<p>05 VIRTEL-FILLER1-FAE6 PIC X(913).</p>
<p><strong>*in the Procedure Division:*</strong></p>
<p>MOVE &#8216;SENDPAGW&#8217; TO VIRTEL-FONCTION-FAC8 MOVE 0 TO
VIRTEL-CODE-RETOUR-FAC8 MOVE &#8216;WEB2VIRT&#8217; TO VIRTEL-PAGE-HTML</p>
<p>MOVE &#8216;DEMO &#8216; TO VIRTEL-REPERTOIRE</p>
<p>MOVE SPACES TO VIRTEL-FILLER-FAC8</p>
<p>CALL &#8216;VIRTEL&#8217; USING DFHEIBLK</p>
<p>PARAMETRES-VIRTEL-FAC8</p>
<p>MOVE &#8216;SENDTABW&#8217; TO VIRTEL-FONCTION-FAE6 MOVE 0 TO
VIRTEL-CODE-RETOUR-FAE6 MOVE 08 TO VIRTEL-LONG-POSTE.</p>
<p>MOVE 9 TO VIRTEL-NBR-POSTE.</p>
<p>MOVE 08 TO VIRTEL-LONG-NOM.</p>
<p>MOVE &#8216;CHP_NUM1&#8217; TO VIRTEL-NOM.</p>
<p>MOVE &#8216;VAL-001&#8217; TO VIRTEL-POSTE-01</p>
<p>MOVE &#8216;VAL-002&#8217; TO VIRTEL-POSTE-02.</p>
<p>MOVE &#8216;VAL-003&#8217; TO VIRTEL-POSTE-03.</p>
<p>MOVE &#8216;VAL-004&#8217; TO VIRTEL-POSTE-04.</p>
<p>MOVE &#8216;VAL-005&#8217; TO VIRTEL-POSTE-05.</p>
<p>MOVE &#8216;VAL-006&#8217; TO VIRTEL-POSTE-06.</p>
<p>MOVE &#8216;VAL-007&#8217; TO VIRTEL-POSTE-07.</p>
<p>MOVE &#8216;VAL-008&#8217; TO VIRTEL-POSTE-08.</p>
<p>MOVE &#8216;VAL-009&#8217; TO VIRTEL-POSTE-09.</p>
<p>MOVE SPACES TO VIRTEL-FILLER-FAE6</p>
<p>CALL &#8216;VIRTEL&#8217; USING DFHEIBLK PARAMETRES-VIRTEL-FAE6 MOVE
VIRTEL-CODE-RETOUR-FAE6 TO TD-MSG-RETCODE</p>
<p>MOVE &#8216;SENDTABW&#8217; TO VIRTEL-FONCTION-FAE6</p>
<p>MOVE 0 TO VIRTEL-CODE-RETOUR-FAE6</p>
<p>MOVE 08 TO VIRTEL-LONG-POSTE.</p>
<p>MOVE 9 TO VIRTEL-NBR-POSTE.</p>
<p>MOVE 08 TO VIRTEL-LONG-NOM.</p>
<p>MOVE &#8216;CPT_NUM1&#8217; TO VIRTEL-NOM1.</p>
<p>MOVE &#8216;CPT-0001&#8217; TO VIRTEL-POSTE1-01.</p>
<p>MOVE &#8216;CPT-0002&#8217; TO VIRTEL-POSTE1-02.</p>
<p>MOVE &#8216;CPT-0003&#8217; TO VIRTEL-POSTE1-03.</p>
<p>MOVE &#8216;CPT-0004&#8217; TO VIRTEL-POSTE1-04.</p>
<p>MOVE &#8216;CPT-0005&#8217; TO VIRTEL-POSTE1-05.</p>
<p>MOVE &#8216;CPT-0006&#8217; TO VIRTEL-POSTE1-06.</p>
<p>MOVE &#8216;CPT-0007&#8217; TO VIRTEL-POSTE1-07.</p>
<p>MOVE &#8216;CPT-0008&#8217; TO VIRTEL-POSTE1-08.</p>
<p>MOVE &#8216;CPT-0009&#8217; TO VIRTEL-POSTE1-09.</p>
<p>MOVE SPACES TO VIRTEL-FILLER1-FAE6</p>
<p>CALL &#8216;VIRTEL&#8217; USING DFHEIBLK</p>
<p>PARAMETRES-VIRTEL-FAE6</p>
<p>MOVE VIRTEL-CODE-RETOUR-FAE6 TO TD-MSG-RETCODE</p>
<p>Figure 3‑22 Example of VIRTEL Web Integration application using CALL
VIRTEL</p>
</div>
<div class="section" id="call-virtel-return-codes">
<h6>CALL VIRTEL return codes<a class="headerlink" href="#call-virtel-return-codes" title="Permalink to this headline">¶</a></h6>
<p>Return codes for the SENDPAGW function</p>
<p>The VIRTEL-CODE-RETOUR field should be initialized to 0. The following
values may be returned:</p>
<p><strong>0</strong> OK, VIRTEL request accepted (does not guarantee that page has been
displayed in browser)</p>
<p><strong>1</strong> Invalid function</p>
<p><strong>2</strong> HTML page name invalid (blank or low-value)</p>
<p><strong>3</strong> Directory name invalid (blank or low-value)</p>
<p>Return codes for the SENDTABW function</p>
<p>The VIRTEL-CODE-RETOUR field should be initialized to 0. The following
values may be returned:</p>
<p><strong>0</strong> OK, VIRTEL request accepted (does not guarantee that page has been
displayed in browser)</p>
<p><strong>1</strong> Invalid function</p>
<p><strong>11</strong> Length of NAME non-numeric</p>
<p><strong>12</strong> Length of VALUE non-numeric</p>
<p><strong>13</strong> Number of values is non-numeric</p>
</div>
</div>
</div>
<div class="section" id="host4web-commands">
<h4>HOST4WEB commands<a class="headerlink" href="#host4web-commands" title="Permalink to this headline">¶</a></h4>
<p>When an application is invoked from a browser via an entry point defined
with emulation type HOST4WEB, the application can use a set of VIRTEL
control commands known as “HOST4WEB” commands, which are coded in the
3270 screen. <a class="footnote-reference" href="#id210" id="id204">[2]</a></p>
<div class="section" id="conditions-for-processing">
<h5>Conditions for processing<a class="headerlink" href="#conditions-for-processing" title="Permalink to this headline">¶</a></h5>
<p>HOST4WEB commands are recognized by VIRTEL when the entry point
definition specifies emulation type HTML, HOST4WEB, or H4W, and any of
the following conditions is true:</p>
<ul class="simple">
<li>the VIRTEL transaction definition contains value 1 in the “H4W
Commands” field</li>
<li>the VIRTEL transaction definition contains value 2 in the “H4W
Commands” field and the message has a ‘2VIRTEL’ prefix (see below)</li>
<li>the VIRTEL transaction definition contains value 4 in the “H4W
Commands” field and the entry point definition specifies emulation
type HOST4WEB or H4W</li>
<li>the VIRTEL transaction definition contains value 4 in the “H4W
Commands” field and the entry point definition specifies emulation
type HTML and the message has a ‘2VIRTEL’ prefix (see below)</li>
<li>the previous screen contained the HOST4WEB command C&nbsp;SCAN&nbsp;NEXT&nbsp;SCREEN</li>
<li>the application previously sent an FAD5 code 01 structured field</li>
</ul>
<p>All HOST4WEB commands must begin immediately after a 3270 attrbute byte,
in other words each command must appear at the start of a 3270 field.
The non-display attribute may be used, if desired, to prevent the
command appearing on the screen. To define a non-display field in BMS,
specify ATTRB=(ASKIP,DRK). To define a non-display field in ISPF, use an
attribute character defined as INTENS(NON) in the )ATTR section of the
panel.</p>
<p>ISPF applications must use the ISPEXEC CONTROL DISPLAY REFRESH command
before the ISPEXEC DISPLAY PANEL command to ensure that HOST4WEB
commands are transmitted to VIRTEL in their entirety.</p>
</div>
<div class="section" id="virtel-prefix">
<h5>2VIRTEL prefix<a class="headerlink" href="#virtel-prefix" title="Permalink to this headline">¶</a></h5>
<p>An application can send a 3270 message with a special prefix to indicate
to VIRTEL that the screen contains HOST4WEB commands.</p>
<p>The prefix consists of a 3270 field starting with the characters
‘2VIRTEL’. This field must be the first field transmitted in the
message.</p>
<p>The field can be defined with the “non-display” attribute, if desired,
to prevent the prefix appearing on the screen.</p>
</div>
<div class="section" id="list-of-commands">
<h5>List of commands<a class="headerlink" href="#list-of-commands" title="Permalink to this headline">¶</a></h5>
<div class="section" id="c-auto-variables-command-auto-variables">
<h6>C AUTO VARIABLES (Command Auto Variables)<a class="headerlink" href="#c-auto-variables-command-auto-variables" title="Permalink to this headline">¶</a></h6>
<p>C AUTO VARIABLES</p>
<p>Requests VIRTEL to automatically free all variables whenever a user
response is sent to the application. This command cancels the effect of
the KEEP VARIABLES command.</p>
<p>NOTE: structured field FAD5 code 08 produces the same effect as this
command.</p>
</div>
<div class="section" id="c-keep-variables-command-keep-variables">
<h6>C KEEP VARIABLES (Command Keep Variables)<a class="headerlink" href="#c-keep-variables-command-keep-variables" title="Permalink to this headline">¶</a></h6>
<p>C KEEP VARIABLES</p>
<p>Requests VIRTEL to keep all variables created by the application.
Normally VIRTEL will free all variables whenever a user response is sent
to the application. This command allows the variables to be kept for use
by a subsequent output screen. The variables may be freed by a
subsequent KILL VARIABLES command, otherwise they will be automatically
freed at the end of the transaction.</p>
<p>NOTE: structured field FAD5 code 02 produces the same effect as this
command.</p>
</div>
<div class="section" id="c-kill-variables-command-kill-variables">
<h6>C KILL VARIABLES (Command Kill Variables)<a class="headerlink" href="#c-kill-variables-command-kill-variables" title="Permalink to this headline">¶</a></h6>
<p>C KILL VARIABLES</p>
<p>Requests VIRTEL to free all variables.</p>
<p>NOTE: structured field FAD5 code 04 produces the same effect as this
command.</p>
</div>
<div class="section" id="c-return-command-return">
<h6>C RETURN (Command Return)<a class="headerlink" href="#c-return-command-return" title="Permalink to this headline">¶</a></h6>
<p>C RETURN</p>
<p>Requests VIRTEL to immediately return a response to the application with
a simulated “Enter”. The screen containing this command is never
displayed to the user.</p>
</div>
<div class="section" id="c-scan-next-screen-command-scan">
<h6>C SCAN NEXT SCREEN (Command Scan)<a class="headerlink" href="#c-scan-next-screen-command-scan" title="Permalink to this headline">¶</a></h6>
<p>C SCAN NEXT SCREEN</p>
<p>Indicates that the following screen will contain HOST4WEB commands,
which will be processed by VIRTEL without the need for a ‘2VIRTEL’
prefix.</p>
<p>NOTE: structured field FAD5 code 01 produces the same effect as this
command.</p>
</div>
<div class="section" id="c-wait-next-screen-command-wait">
<h6>C WAIT NEXT SCREEN (Command Wait)<a class="headerlink" href="#c-wait-next-screen-command-wait" title="Permalink to this headline">¶</a></h6>
<p>C WAIT NEXT SCREEN</p>
<p>Indicates that the current screen should not be sent to the user yet.</p>
</div>
<div class="section" id="c-termsess-command-terminate-session">
<h6>C TERMSESS (Command Terminate Session)<a class="headerlink" href="#c-termsess-command-terminate-session" title="Permalink to this headline">¶</a></h6>
<p>C TERMSESS</p>
<p>Allows a service transaction to request termination of the host
application session after the current message has been sent.</p>
</div>
<div class="section" id="g-emulation-type-get-emulation-type">
<h6>G EMULATION TYPE (Get Emulation Type)<a class="headerlink" href="#g-emulation-type-get-emulation-type" title="Permalink to this headline">¶</a></h6>
<p>G EMULATION TYPE</p>
<p>When VIRTEL returns the next input to the application, the contents of
this field are replaced by the emulation type defined in the entry
point.</p>
</div>
<div class="section" id="g-page-name-get-current-template-name">
<h6>G PAGE NAME (Get Current Template Name)<a class="headerlink" href="#g-page-name-get-current-template-name" title="Permalink to this headline">¶</a></h6>
<p>G PAGE NAME</p>
<p>When VIRTEL returns the next input to the application, the contents of
this field are replaced by the name of the current page template.</p>
</div>
<div class="section" id="g-url-parameter-get-url-parameter">
<h6>G URL PARAMETER (Get URL Parameter)<a class="headerlink" href="#g-url-parameter-get-url-parameter" title="Permalink to this headline">¶</a></h6>
<p>G URL PARAMETER <em>paramname</em></p>
<p>When VIRTEL returns the next input to the application, the contents of
this field are replaced by the value of the parameter <em>paramname</em> in the
URL.</p>
</div>
<div class="section" id="s-directory-set-temporary-directory-name">
<h6>S DIRECTORY (Set Temporary Directory Name)<a class="headerlink" href="#s-directory-set-temporary-directory-name" title="Permalink to this headline">¶</a></h6>
<p>S DIRECTORY <em>dirname</em></p>
<p>Indicates the name of the directory from which VIRTEL is to retrieve the
page template for the current 3270 screen (but not for subsequent
screens). <em>dirname</em> is the name of a VIRTEL directory defined in the
Directory Management sub-application (as described sur la page 20). This
name must not contain any blanks.</p>
</div>
<div class="section" id="s-global-page-set-global-template-name">
<h6>S GLOBAL PAGE (Set Global Template Name)<a class="headerlink" href="#s-global-page-set-global-template-name" title="Permalink to this headline">¶</a></h6>
<p>S GLOBAL PAGE <em>pagename</em></p>
<p>Indicates the name of the page template to be used for the current 3270
screen and all subsequent screens. This name must not contain any
blanks.</p>
</div>
<div class="section" id="s-page-set-temporary-template-name">
<h6>S PAGE (Set Temporary Template Name)<a class="headerlink" href="#s-page-set-temporary-template-name" title="Permalink to this headline">¶</a></h6>
<p>S PAGE <em>pagename</em></p>
<p>Indicates the name of the page template to be used for the current 3270
screen (but not for subsequent screens). This name must not contain any
blanks.</p>
</div>
<div class="section" id="s-variable-set-variable">
<h6>S VARIABLE (Set Variable)<a class="headerlink" href="#s-variable-set-variable" title="Permalink to this headline">¶</a></h6>
<p>S VARIABLE <em>varname</em>+<em>value</em>+</p>
<p>Adds a new value to a table variable named <em>varname</em>. The variable is
automatically created if necessary. The <em>value</em> is contained in the 3270
field immediately following the S VARIABLE <em>varname</em> command, and the
<em>value</em> has the same length as the 3270 field which contains it.. The
“+” characters in the figure above represent the 3270 attribute bytes
which act as field delimiters.</p>
</div>
</div>
</div>
</div>
<div class="section" id="e-mail">
<h3>E-mail<a class="headerlink" href="#e-mail" title="Permalink to this headline">¶</a></h3>
<div class="section" id="fac8-retrieve-data-from-an-e-mail">
<h4>FAC8: Retrieve data from an e-mail<a class="headerlink" href="#fac8-retrieve-data-from-an-e-mail" title="Permalink to this headline">¶</a></h4>
<p>An application started by an incoming e-mail (see “Incoming e-mails” sur
la page 255) can retrieve data from the content of the e-mail. To
request VIRTEL to extract the data from the e-mail, the application
sends a structured field FAC8 code 12 or 13 to the associated relay
(3270 pseudo-terminal). VIRTEL intercepts the structured field and sends
a response to the application in the form of a QUERY REPLY (x‘88’)
structured field.</p>
<div class="section" id="structured-field-fac8-code-12">
<h5>Structured field FAC8 code 12<a class="headerlink" href="#structured-field-fac8-code-12" title="Permalink to this headline">¶</a></h5>
<p>The format of a structured field FAC8 code 12 is:</p>
<blockquote>
<div><ul class="simple">
<li>2 bytes Length of structured field = X&#8216;0007&#8217;</li>
<li>2 bytes Structured field identification code = X&#8217;FAC8&#8217;</li>
<li>1 bytes Code = X&#8216;12&#8217; (extraction of e-mail data)</li>
<li>2 bytes Option indicating the category of data requested:</li>
</ul>
<p>0004 Received:</p>
<p>0008 Message-ID:</p>
<p>000C Date:</p>
<p>0010 References:</p>
<p>0014 Content-Type:</p>
<p>0018 MIME-Version:</p>
<p>001C Subject:</p>
<p>0020 (message text)</p>
<p>003C MAIL FROM: (see note)</p>
<p>0040 RCPT TO: (see note)</p>
<p>Note: MAIL FROM and RCPT TO are respectively the name of the sender
and recipient as specified in the SMTP envelope.</p>
</div></blockquote>
<p>Figure 3‑23 Format of structured field FAC8 code 12</p>
<p>The response consists of one or more structured fields, prefixed by an
AID byte x‘88’ (QUERY REPLY). The format of the query reply structured
field is:</p>
<blockquote>
<div><ul class="simple">
<li>2 bytes Length of structured field = variable</li>
</ul>
<div class="line-block">
<div class="line">- 2 bytes Type of response data.</div>
<div class="line">Values are same as the ‘option’ field of the corresponding
request.</div>
</div>
<ul class="simple">
<li>4 bytes (type 0020 only) number of lines of text</li>
<li>4 bytes (type 0020 only) flags (reserved)</li>
<li>n bytes Data (in EBCDIC)</li>
</ul>
</div></blockquote>
<p>Figure 3‑24 Format of the response to structured field FAC8 code 12</p>
<p>Notes:</p>
<ul class="simple">
<li>Response types other than 0020 do not contain the number of lines or
flags.</li>
<li>Response types are returned in the same order as specified in the
request.</li>
<li>All of the response types requested are present, even if they are
zero length.</li>
<li>Lines of message text are delimited by X&#8216;0D25&#8217; (EBCDIC
carriage-return / line-feed).</li>
</ul>
</div>
<div class="section" id="structured-field-fac8-code-13">
<h5>Structured field FAC8 code 13<a class="headerlink" href="#structured-field-fac8-code-13" title="Permalink to this headline">¶</a></h5>
<p>Structured field FAC8 code 13 searches the e-mail for a specific
character string, then returns the string together with the remainder of
the line.</p>
<p>The format of a structured field FAC8 code 13 is:</p>
<blockquote>
<div><ul class="simple">
<li>2 bytes Length of structured field = 7 + length of string</li>
<li>2 bytes Structured field identification code = X&#8217;FAC8&#8217;</li>
<li>1 bytes Code = X&#8216;13&#8217; (scan e-mail data)</li>
<li>2 bytes Option indicating the category of data to be searched:</li>
</ul>
<p>(see structured field FAC8 code 12)</p>
<ul class="simple">
<li>n bytes Character string to search for</li>
</ul>
</div></blockquote>
<p>Figure 3‑25 Format of structured field FAC8 code 13</p>
<p>The response consists of one or more structured fields, prefixed by an
AID byte x‘88’ (QUERY REPLY). The format of the query reply structured
field is:</p>
<blockquote>
<div><ul class="simple">
<li>2 bytes Length of structured field = variable</li>
</ul>
<div class="line-block">
<div class="line">- 2 bytes Type of response data.</div>
<div class="line">Values are same as the ‘option’ field of the corresponding
request.</div>
</div>
<ul class="simple">
<li>n bytes Data (in EBCDIC)</li>
</ul>
</div></blockquote>
<p>Figure 3‑26 Format of the response to structured field FAC8 code 13</p>
<p>Notes:</p>
<ul class="simple">
<li>The data returned includes the character string searched for, and all
characters which follow, up to the end of the line. The characters
X&#8216;0D25&#8217;, indicating the end of line, are not included in the
response.</li>
<li>Response types are returned in the same order as specified in the
request.</li>
<li>All of the response types requested are present, even if they are
zero length.</li>
<li>Structured fields FAC8 code 12 and code 13 can be combined in the
same request / response.</li>
</ul>
</div>
<div class="section" id="id205">
<h5>COBOL example<a class="headerlink" href="#id205" title="Permalink to this headline">¶</a></h5>
<p>Example (in Cobol format) of receiving an e-mail:</p>
<p><strong>*in Working-Storage:*</strong></p>
<p>* Request FAC812 to VIRTEL</p>
<p>01 FAC812-DEM-LENG PIC S9(4) COMP VALUE +0.</p>
<p>01 FAC812-DEM-EMAIL.</p>
<p>05 FILLER PIC S9(4) COMP VALUE +7.</p>
<p>05 FILLER PIC X(3) VALUE X&#8217;FAC812&#8217;.</p>
<p>05 FAC812-DEM-OPTION-SUBJ PIC X(2) VALUE X&#8216;001C&#8217;.</p>
<p>05 FILLER PIC S9(4) COMP VALUE +7.</p>
<p>05 FILLER PIC X(3) VALUE X&#8217;FAC812&#8217;.</p>
<p>05 FAC812-DEM-OPTION-TEXT PIC X(2) VALUE X&#8216;0020&#8217;.</p>
<p>05 FILLER PIC S9(4) COMP VALUE +17.</p>
<p>05 FILLER PIC X(3) VALUE X&#8217;FAC813&#8217;.</p>
<p>05 FAC813-DEM-OPTION-OREF PIC X(2) VALUE X&#8216;0020&#8217;.</p>
<p>05 FILLER PIC X(10) VALUE &#8216;Order ref:&#8217;.</p>
<p>* Response from Virtel following FAC812</p>
<p>01 FAC812-REP-LENG PIC S9(4) COMP VALUE +0.</p>
<p>01 FAC812-REP-AREA.</p>
<p>05 FAC812-REP-SUBJ-LENG PIC S9(4) COMP.</p>
<p>05 FAC812-REP-SUBJ-CODE PIC X(2).</p>
<p>05 FAC812-REP-SUBJ-DATA.</p>
<p>10 FAC812-REP-SUBJ-CHAR PIC X</p>
<p>OCCURS 0 TO 256 TIMES</p>
<p>DEPENDING ON SUBJ-LENG.</p>
<p>05 FAC812-REP-TEXT-LENG PIC S9(4) COMP.</p>
<p>05 FAC812-REP-TEXT-CODE PIC X(2).</p>
<p>05 FAC812-REP-TEXT-NLIG PIC S9(8) COMP.</p>
<p>05 FAC812-REP-TEXT-FLAG PIC X(4).</p>
<p>05 FAC812-REP-TEXT-DATA.</p>
<p>10 FAC812-REP-TEXT-CHAR PIC X</p>
<p>OCCURS 0 TO 1000 TIMES</p>
<p>DEPENDING ON TEXT-LENG.</p>
<p>05 FAC813-REP-OREF-LENG PIC S9(4) COMP.</p>
<p>05 FAC813-REP-OREF-CODE PIC X(2).</p>
<p>05 FAC813-REP-OREF-DATA.</p>
<p>10 FAC813-REP-OREF-CHAR PIC X</p>
<p>OCCURS 0 TO 256 TIMES</p>
<p>DEPENDING ON OREF-LENG.</p>
<p>01 SUBJ-LENG PIC S9(4) COMP VALUE +0.</p>
<p>01 SUBJ-MESSAGE.</p>
<p>05 FILLER PIC X(5) VALUE &#8216;SUBJ:&#8217;.</p>
<p>05 SUBJ-DATA PIC X(50).</p>
<p>01 TEXT-LENG PIC S9(4) COMP VALUE +0.</p>
<p>01 TEXT-MESSAGE.</p>
<p>05 FILLER PIC X(5) VALUE &#8216;TEXT:&#8217;.</p>
<p>05 TEXT-DATA PIC X(80).</p>
<p>01 OREF-LENG PIC S9(4) COMP VALUE +0.</p>
<p>01 OREF-MESSAGE.</p>
<p>05 FILLER PIC X(5) VALUE &#8216;OREF:&#8217;.</p>
<p>05 OREF-DATA PIC X(50).</p>
<p>01 ERR-MESSAGE PIC X(40) VALUE</p>
<p>&#8216;RBC8 UNEXPECTED RESPONSE FROM VIRTEL&#8217;.</p>
<p><strong>*in the Procedure Division:*</strong></p>
<p>MOVE +256 TO SUBJ-LENG</p>
<p>MOVE +1000 TO TEXT-LENG</p>
<p>MOVE +256 TO OREF-LENG</p>
<p>MOVE LENGTH OF FAC812-DEM-EMAIL TO FAC812-DEM-LENG</p>
<p>MOVE LENGTH OF FAC812-REP-AREA TO FAC812-REP-LENG</p>
<p>EXEC CICS CONVERSE FROM(FAC812-DEM-EMAIL)</p>
<p>FROMLENGTH(FAC812-DEM-LENG)</p>
<p>INTO(FAC812-REP-AREA)</p>
<p>TOLENGTH(FAC812-REP-LENG)</p>
<p>STRFIELD</p>
<p>END-EXEC</p>
<p>IF EIBAID EQUAL X&#8216;88&#8217;</p>
<p>SUBTRACT 4 FROM FAC812-REP-SUBJ-LENG GIVING SUBJ-LENG</p>
<p>MOVE FAC812-REP-SUBJ-DATA TO SUBJ-DATA</p>
<p>EXEC CICS WRITEQ TD QUEUE(&#8216;CSMT&#8217;)</p>
<p>FROM(SUBJ-MESSAGE)</p>
<p>END-EXEC</p>
<p>SUBTRACT 12 FROM FAC812-REP-TEXT-LENG</p>
<p>GIVING TEXT-LENG</p>
<p>MOVE FAC812-REP-TEXT-DATA TO TEXT-DATA</p>
<p>EXEC CICS WRITEQ TD QUEUE(&#8216;CSMT&#8217;)</p>
<p>FROM(TEXT-MESSAGE)</p>
<p>END-EXEC</p>
<p>SUBTRACT 4 FROM FAC813-REP-OREF-LENG GIVING OREF-LENG</p>
<p>MOVE FAC813-REP-OREF-DATA TO OREF-DATA</p>
<p>EXEC CICS WRITEQ TD QUEUE(&#8216;CSMT&#8217;)</p>
<p>FROM(OREF-MESSAGE)</p>
<p>END-EXEC</p>
<p>ELSE</p>
<p>EXEC CICS WRITEQ TD QUEUE(&#8216;CSMT&#8217;)</p>
<p>FROM(ERR-MESSAGE)</p>
<p>END-EXEC</p>
<p>END-IF</p>
<p>EXEC CICS ISSUE DISCONNECT</p>
<p>END-EXEC.</p>
<p>Figure 3‑27 Example of sending structured field FAC8 code 12 and 13</p>
</div>
</div>
<div class="section" id="fad4-sending-an-e-mail-from-a-host-application">
<h4>FAD4: Sending an e-mail from a host application<a class="headerlink" href="#fad4-sending-an-e-mail-from-a-host-application" title="Permalink to this headline">¶</a></h4>
<p>It is possible at any time to send an e-mail from a host application
under VIRTEL control. This operation is performed by sending a WRITE
STRUCTURED FIELD to the 3270 session which is intercepted by VIRTEL. The
structured field data consists of a sequence of FAD4 structured fields
as described below:</p>
<blockquote>
<div><ul class="simple">
<li>2 bytes Length of structured field = variable</li>
<li>2 bytes Structured field identification code = X&#8217;FAD4&#8217;</li>
<li>n bytes Command code</li>
<li>n bytes Value associated with command code</li>
</ul>
</div></blockquote>
<p>Figure 3‑28 Format of structured field FAD4</p>
<p>The possible command codes are:</p>
<blockquote>
<div><p><strong>N</strong> (Name) : e-mail address of recipient.</p>
<p><strong>F</strong> (From) : e-mail address of sender. If this code is not
supplied, the default sender address specified on the SMTP line will
be used.</p>
<p><strong>X&#8217;CD&#8217;</strong> (Code) : Message identification.</p>
<p><strong>S</strong> (Subject) : Message subject line.</p>
<p><strong>T</strong> (Text) : Message text. The sequence X&#8216;0D25&#8217; (EBCDIC
carriage-return / line-feed) can be used to separate lines of text.</p>
<p><strong>C</strong> (Charset) : Add a message header indicating the character set
used; <strong>ISO-8859-15</strong> for European character set with Euro currency
sign.</p>
<p><strong>H</strong> (Header) : Add one or more headers. The sequence X&#8216;0D25&#8217;
(EBCDIC carriage-return / line-feed) indicates the end of each of
the headers in this structured field.</p>
</div></blockquote>
<p>The entry point used to invoke the host application must contain a
type-3 transaction whose external name is $MAIL$ and whose “Application”
field contains the name of the SMTP line to be used for sending the
outgoing e-mail.</p>
<div class="section" id="id206">
<h5>COBOL example<a class="headerlink" href="#id206" title="Permalink to this headline">¶</a></h5>
<p>Example (in Cobol format) of sending an e-mail :</p>
<p><strong>*in Working-Storage:*</strong></p>
<p>01 FAD4-LONG PIC S9(4) COMP VALUE +0.</p>
<p>01 FAD4-AREA.</p>
<p>05 FAD4-COMMANDE-N.</p>
<p>10 FAD4-SFLENGTH-N PIC S9(4) COMP VALUE +0.</p>
<p>10 FILLER PIC X(2) VALUE X&#8217;FAD4&#8217;.</p>
<p>10 FILLER PIC X VALUE &#8216;N&#8217;.</p>
<p>10 FAD4-DESTINATION PIC X(22)</p>
<p>VALUE <a class="reference external" href="mailto:'bowler&#37;&#52;&#48;saint&#46;cloud&#46;com">'bowler<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a>&#8216;.</p>
<p>05 FAD4-COMMANDE-F.</p>
<p>10 FAD4-SFLENGTH-F PIC S9(4) COMP VALUE +0.</p>
<p>10 FILLER PIC X(2) VALUE X&#8217;FAD4&#8217;.</p>
<p>10 FILLER PIC X VALUE &#8216;F&#8217;.</p>
<p>10 FAD4-SENDER PIC X(22)</p>
<p>VALUE <a class="reference external" href="mailto:'virtel&#37;&#52;&#48;saint&#46;cloud&#46;com">'virtel<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a>&#8216;.</p>
<p>05 FAD4-COMMANDE-CD.</p>
<p>10 FAD4-SFLENGTH-CD PIC S9(4) COMP VALUE +0.</p>
<p>10 FILLER PIC X(2) VALUE X&#8217;FAD4&#8217;.</p>
<p>10 FILLER PIC X VALUE X&#8217;CD&#8217;.</p>
<p>10 FAD4-MESSAGE-ID PIC X(32)</p>
<p>VALUE &#8216;20010321174652K07F44354K608EAF00&#8217;.</p>
<p>05 FAD4-COMMANDE-S.</p>
<p>10 FAD4-SFLENGTH-S PIC S9(4) COMP VALUE +0.</p>
<p>10 FILLER PIC X(2) VALUE X&#8217;FAD4&#8217;.</p>
<p>10 FILLER PIC X VALUE &#8216;S&#8217;.</p>
<p>10 FAD4-SUBJECT PIC X(17)</p>
<p>VALUE &#8216;email from virtel&#8217;.</p>
<p>05 FAD4-COMMANDE-T.</p>
<p>10 FAD4-SFLENGTH-T PIC S9(4) COMP VALUE +0.</p>
<p>10 FILLER PIC X(2) VALUE X&#8217;FAD4&#8217;.</p>
<p>10 FILLER PIC X VALUE &#8216;T&#8217;.</p>
<p>10 FAD4-TEXT-LINE-1 PIC X(14) VALUE &#8216;Balance report&#8217;.</p>
<p>10 FILLER PIC X(2) VALUE X&#8216;0D25&#8217;.</p>
<p>10 FAD4-TEXT-LINE-2 PIC X(9) VALUE &#8216;Total is &#8216;.</p>
<p>10 FAD4-CURRENCY PIC X VALUE X&#8216;9F&#8217;.</p>
<p>10 FAD4-AMOUNT PIC 9999 VALUE 2345.</p>
<p>10 FILLER PIC X(2) VALUE X&#8216;0D25&#8217;.</p>
<p>05 FAD4-COMMANDE-H.</p>
<p>10 FAD4-SFLENGTH-H PIC S9(4) COMP VALUE +0.</p>
<p>10 FILLER PIC X(2) VALUE X&#8217;FAD4&#8217;.</p>
<p>10 FILLER PIC X VALUE &#8216;H&#8217;.</p>
<p>10 FAD4-HEADER-1 PIC X(33)</p>
<p>VALUE &#8216;X-Transaction-Server: CICS-TS 2.2&#8217;.</p>
<p>10 FILLER PIC X(2) VALUE X&#8216;0D25&#8217;.</p>
<p>10 FAD4-HEADER-2 PIC X(28)</p>
<p>VALUE &#8216;X-Operating-System: z/OS 1.4&#8217;.</p>
<p>10 FILLER PIC X(2) VALUE X&#8216;0D25&#8217;.</p>
<p>05 FAD4-COMMANDE-C.</p>
<p>10 FAD4-SFLENGTH-C PIC S9(4) COMP VALUE +0.</p>
<p>10 FILLER PIC X(2) VALUE X&#8217;FAD4&#8217;.</p>
<p>10 FILLER PIC X VALUE &#8216;C&#8217;.</p>
<p>10 FAD4-CHARSET PIC X(33) VALUE &#8216;ISO-8859-15&#8217;.</p>
<p><strong>*in the Procedure Division:*</strong></p>
<p>MOVE LENGTH OF FAD4-COMMANDE-N TO FAD4-SFLENGTH-N</p>
<p>MOVE LENGTH OF FAD4-COMMANDE-F TO FAD4-SFLENGTH-F</p>
<p>MOVE LENGTH OF FAD4-COMMANDE-CD TO FAD4-SFLENGTH-CD</p>
<p>MOVE LENGTH OF FAD4-COMMANDE-S TO FAD4-SFLENGTH-S</p>
<p>MOVE LENGTH OF FAD4-COMMANDE-T TO FAD4-SFLENGTH-T</p>
<p>MOVE LENGTH OF FAD4-COMMANDE-H TO FAD4-SFLENGTH-H</p>
<p>MOVE LENGTH OF FAD4-COMMANDE-C TO FAD4-SFLENGTH-C</p>
<p>MOVE LENGTH OF FAD4-AREA TO FAD4-LONG</p>
<p>EXEC CICS SEND FROM(FAD4-AREA)</p>
<p>LENGTH(FAD4-LONG)</p>
<p>STRFIELD</p>
<p>END-EXEC.</p>
<p>Figure 3‑29 Example of sending structured field FAD4</p>
<p>Example of the e-mail generated by the above program:</p>
<p>Date: Fri, 30 Apr 2004 15:14:05 +0100</p>
<p>From: <a class="reference external" href="mailto:virtel&#37;&#52;&#48;saint&#46;cloud&#46;com">virtel<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a></p>
<p>Organization: SYSPERTEC COMMUNICATION</p>
<p>To: <a class="reference external" href="mailto:bowler&#37;&#52;&#48;saint&#46;cloud&#46;com">bowler<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a></p>
<p>Message-id: &lt;<a class="reference external" href="mailto:20010321174652K07F44354K608EAF00-bowler&#37;&#52;&#48;saint&#46;cloud&#46;com">20010321174652K07F44354K608EAF00-bowler<span>&#64;</span>saint<span>&#46;</span>cloud<span>&#46;</span>com</a>&gt;</p>
<p>Content-Type: text/plain; charset=ISO-8859-15</p>
<p>Content-Transfer-Encoding: 8bit</p>
<p>X-Transaction-Server: CICS-TS 2.2</p>
<p>X-Operating-System: z/OS 1.4</p>
<p>Subject: email from virtel</p>
<p>Balance report</p>
<p>Total is €2345</p>
<p>Figure 3‑30 Example of e-mail generated by structured field FAD4</p>
</div>
</div>
</div>
</div>
<div class="section" id="id207">
<h2>Security<a class="headerlink" href="#id207" title="Permalink to this headline">¶</a></h2>
<div class="section" id="virtel-web-access-security">
<h3>VIRTEL Web Access Security<a class="headerlink" href="#virtel-web-access-security" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id208">
<h4>Introduction<a class="headerlink" href="#id208" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL examines the URL of every VIRTEL Web Access request which arrives
from a browser. Since there is no permanent IP session between the
browser and VIRTEL, there is less risk of a session being “hijacked”. In
addition to standard network security features (firewall, network sign
on, SSO, etc.), each URL sent to VIRTEL has a structure which allows
VIRTEL to enforce authorization rules based on Entry Point, Rules, and
Transactions, which are VIRTEL entities described in the “VIRTEL
Connectivity Reference” manual.</p>
</div>
<div class="section" id="technical-characteristics">
<h4>Technical characteristics<a class="headerlink" href="#technical-characteristics" title="Permalink to this headline">¶</a></h4>
<div class="section" id="specifying-security-in-the-entry-point">
<h5>Specifying security in the entry point<a class="headerlink" href="#specifying-security-in-the-entry-point" title="Permalink to this headline">¶</a></h5>
<p>VIRTEL supplies a signon program for HTTP lines called <strong>VIR0020H</strong>
(refer to the “VIRTEL Connectivity Reference” manual for more details
about how to specify a signon program in an entry point).</p>
<p>When the first call is made to a secure transaction under an entry point
which specifies VIR0020H as its signon program, VIRTEL requests the
browser (via a 401 response) to display a dialog box inviting the user
to enter a userid and password. VIRTEL passes the userid and password to
the security manager (RACF, etc.) for validation. VIRTEL can also
propagate the userid and password to other applications (for example,
CICS) by means of connection / disconnection scripts defined in the
transaction (see the “VIRTEL Connectivity Reference” manual for
details). Depending on the userid, the security manager may authorize or
deny access to the requested transaction.</p>
<p><a class="reference internal" href="../../../_images/image521.png"><img alt="SmartCaptureSend" src="../../../_images/image521.png" style="width: 5.80208in; height: 3.93750in;" /></a></p>
<p>Figure 4‑1 Example of signon dialog box displayed by browser</p>
</div>
<div class="section" id="specifying-security-in-the-transaction">
<h5>Specifying security in the transaction<a class="headerlink" href="#specifying-security-in-the-transaction" title="Permalink to this headline">¶</a></h5>
<p>To display the signon dialog box shown above, the transaction under the
entry point must specify <strong>SECURITY</strong> <strong>1 (standard).</strong> Refer to the
“Transactions” section of the “VIRTEL Connectivity Reference” manual for
details of the security field in the VIRTEL transaction definition.</p>
<p>Security can be specified either on the application transaction
(transaction type 1, 2, 3), or on the directory transaction (transaction
type 4). In the above example, “SECURE” is the directory transaction,
and “Cics” is the application transaction. Specifying security at the
directory level can be useful in that it forces the user to sign on even
when displaying a static page which has no associated application
transaction.</p>
</div>
<div class="section" id="mixed-case-password-support">
<h5>Mixed-case password support<a class="headerlink" href="#mixed-case-password-support" title="Permalink to this headline">¶</a></h5>
<p>If SECUR=RACROUTE or SECUR=(RACROUTE,RACF) is specified in the VIRTCT,
and if the security manager reports that it supports lower-case
characters in passwords, then VIRTEL will pass all passwords to the
security manager in mixed case as entered by the user. Otherwise VIRTEL
will translate all passwords to upper case before passing them to the
security manager. Message VIR0861I at startup indicates that VIRTEL will
use mixed-case passwords.</p>
</div>
<div class="section" id="automatic-retrieval-of-username">
<h5>Automatic retrieval of username<a class="headerlink" href="#automatic-retrieval-of-username" title="Permalink to this headline">¶</a></h5>
<p>NTLM security allows VIRTEL to retrieve the username under which the
user has already signed on to Windows. This allows VIRTEL Web Access to
sign on the user without requiring him or her to enter a username and
password.</p>
<p>When <strong>SECURITY</strong> <strong>2 (NTLM)</strong> is specified in the VIRTEL transaction
definition (either the application transaction or the directory
transaction) VIRTEL requests the browser to supply the Windows username.</p>
<p>Note: when the user is identified by NTLM, VIRTEL does not have access
to the user’s password, and therefore VIRTEL cannot verify the validity
of the username, and cannot propagate the signon to other applications
such as CICS.</p>
<p>Before NTML can be used with the Firefox browser, the server name must
be configured into the browser. Type <a class="reference external" href="about:config">about:config</a> in the address bar,
and enter the VIRTEL Web Access server address (for example,
192.168.235.61:41000) as the value of the
network.automatic-ntlm-auth.trusted-uris parameter.</p>
</div>
<div class="section" id="data-encryption-by-ssl">
<h5>Data encryption by SSL<a class="headerlink" href="#data-encryption-by-ssl" title="Permalink to this headline">¶</a></h5>
<p>The AT-TLS feature (“Application Transparent Transport Layer Security”),
available with z/OS Communication Server V1R7 and later releases, allows
direct access to the VIRTEL Web Access server in SSL mode (HTTPS),
without using an intermediate server. The SSLSETUP job in the VIRTEL
SAMPLIB contains an example of the definitions required to place VIRTEL
Web Access sessions under AT-TLS control.</p>
<p>For VSE sites, or earlier versions of MVS where AT-TLS is not available,
access to VIRTEL in HTTPS mode can be achieved by means of an
intermediate server (such as Apache) operating in Reverse-Proxy mode.
The function of the reverse proxy is to transform the dataflow into HTTP
mode before sending it on to VIRTEL.</p>
</div>
<div class="section" id="identification-by-certificate">
<h5>Identification by certificate<a class="headerlink" href="#identification-by-certificate" title="Permalink to this headline">¶</a></h5>
<p>The definition of a transaction with <strong>SECURITY</strong> <strong>3 (TLS)</strong> allows
VIRTEL to recognize a VIRTEL Web Access user by means of a digital
certificate installed in the user’s web browser. VIRTEL will use the
RACF userid associated with the certificate to determine the user&#8217;s
authority to execute the transaction.</p>
<p>VIRTEL is able to obtain the client’s userid, without requiring the user
to sign on, when all of the following conditions are true:</p>
<ul class="simple">
<li>The user enters VIRTEL via a secure https session using the AT-TLS
function of z/OS V1R7 or later</li>
<li>The <em>TTLSConnectionAction</em> or <em>TTLSEnvironmentAction</em> statement in
the policy agent configuration file contains the parameter
<em>HandshakeRole ServerWithClientAuth</em></li>
<li>The client’s browser presents a valid certificate during SSL
handshake</li>
<li>The z/OS Security Server (RACF) recognizes the certificate as
belonging to the user (Refer to &#8220;Chapter 21 RACF and Digital
Certificates&#8221; in &#8220;SA22-7683-05 z/OS Security Server RACF Security
Administrator&#8217;s Guide&#8221; for more information on associating user IDs
with certificates)</li>
</ul>
<p>The sample job SSLUCERT in the VIRTEL SAMPLIB illustrates how to
generate a user client certificate using RACF. The certificate is
registered in the RACF database and is exported to a PKCS12 (.P12) file
which contains both the user certificate and the user&#8217;s private key
encrypted under a passphrase. The .P12 file must be downloaded in binary
to the user&#8217;s workstation and installed in the user&#8217;s browser.</p>
<p>Note that when a user is identified by certificate, VIRTEL does not have
access to the user’s password, and therefore cannot propagate the signon
to other applications such as CICS.</p>
</div>
<div class="section" id="password-encryption">
<h5>Password encryption<a class="headerlink" href="#password-encryption" title="Permalink to this headline">¶</a></h5>
<p>VIRTEL Web Access offers the possibility of encrypting passwords (3270
non-display fields) transmitted in HTML pages. VIRTEL uses the
encryption facilities provided by the System z hardware through the z/OS
Integrated Cryptographic Service Facility (ICSF). Password encryption is
available only when using VIRTEL Web Access in Ajax mode using the
WEB2AJAX.htm page template (see “Presentation modes” sur la page 117).</p>
<p>To activate the password encryption option for WEB2AJAX.htm you must
specify a CRYPT<em>n</em> parameter in the VIRTCT (see “Parameters of the
VIRTCT” in the <em>VIRTEL Installation Guide</em>). The CRYPT<em>n</em> parameter
must specify CRYPT3270 as the name and ICSF as the encryption engine, as
in example shown below:</p>
<p>CRYPT1=(CRYPT3270,3TDEA,RSA-1024,ICSF,HEX), *</p>
<p>Figure 4‑2 CRYPTn parameter for password encryption using WEB2AJAX.htm</p>
</div>
<div class="section" id="signon-using-html-fields">
<h5>Signon using HTML fields<a class="headerlink" href="#signon-using-html-fields" title="Permalink to this headline">¶</a></h5>
<p>The definition of a transaction with <strong>SECURITY 4 (HTML)</strong> allows VIRTEL
to obtain the userid and password from fields embedded in the HTML page.</p>
<p>When a security type 4 transaction is requested, and the user is not
already signed on, VIRTEL will send the requested page to the browser
without connecting to the application. The page template must use the
CREATE-VARIABLE-IF tag (described sur la page 64) to determine whether
signon is required, and the DECLARE-FIELD-AS tag (described sur la page
64) to declare the username and password fields.</p>
<p>Following an unsuccessful signon attempt, the special variable $ERRMSG$
contains one or more error messages which may be included in the page
template.</p>
<p>The figure below shows an example of a transaction with security type 4:</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SP3VIR5
11:35:36</p>
<p>Internal name ===&gt; HTTP-16 To associate with an entry point name</p>
<p>External name ===&gt; cicsHtml Name displayed on user menu</p>
<p>Description ===&gt; Access CICSD with HTML security</p>
<p>Application ===&gt; SPCICSD Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 1 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; HTVT Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 2 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 4 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt; Signon to CICS&amp;/W&amp;&#8216;114BE9&#8217;&amp;U&amp;&#8216;114CF9&#8217;&amp;P&amp;/A</p>
<p>TIOA at logoff ===&gt; &amp;£6D</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 4‑3 HTML security: Example transaction with security type 4</p>
<p>The figure below shows an example of a page template containing userid
and password fields which can be used with the security type 4
transaction shown Figure 4‑3:</p>
<p>&lt;!&#8211;VIRTEL start=&#8221;{{{&#8221; end=&#8221;}}}&#8221; &#8211;&gt;</p>
<p>&lt;!doctype html public &#8220;-//w3c//dtd html 4.0//en&#8221;&gt;</p>
<p>&lt;html&gt;&lt;head&gt;{{{ SET-OUTPUT-ENCODING-UTF-8 &#8220;&#8221; }}}</p>
<p>&lt;meta http-equiv=&#8221;Content-Type&#8221; content=&#8221;text/html; charset=utf-8&#8221;&gt;</p>
<p>{{{CREATE-VARIABLE-IF (SIGNON-IS-NEEDED) &#8220;$$SIGTYPE&#8221;}}}</p>
<p>{{{CREATE-VARIABLE-IF (APPLICATION-IS-CONNECTED) &#8220;$$APP&#8221;}}}</p>
<p>&lt;script language=&#8221;javascript&#8221; src=&#8221;../w2h/js01.js&#8221;
type=&#8221;text/javascript&#8221;&gt;&lt;/script&gt;</p>
<p>&lt;script&gt;document.write(&#8220;&lt;link rel=&#8217;stylesheet&#8217; type=&#8217;text/css&#8217;
href=&#8217;../w2h/STYL&#8221;+w2hparm.style+&#8221;.css&#8217; /&gt;&#8221;)&lt;/script&gt;</p>
<p>{{{WHEN-EXISTS &#8220;$$SIGTYPE&#8221;}}}</p>
<p>&lt;link rel=&#8221;stylesheet&#8221; type=&#8221;text/css&#8221; href=&#8221;../w2h/login.css&#8221; /&gt;</p>
<p>&lt;title&gt;{{{NAME-OF (VIRTEL)}}} signon&lt;/title&gt;</p>
<p>&lt;script src=&#8221;../w2h/md5.js&#8221; type=&#8221;text/javascript&#8221;&gt;&lt;/script&gt;</p>
<p>&lt;/head&gt;</p>
<p>&lt;body&gt;</p>
<p>{{{DECLARE-FIELD-AS (USERNAME) &#8220;USERNAME&#8221;}}}</p>
<p>{{{DECLARE-FIELD-AS (PASSWORD,HEX) &#8220;PASSWORD&#8221;}}}</p>
<p>{{{DECLARE-FIELD-AS (NEW-PASSWORD,HEX) &#8220;NEWPASSWORD&#8221;}}}</p>
<p>{{{DEFINE-HTML-PFKEY &#8220;pf&#8221;}}}</p>
<p>&lt;script&gt;</p>
<p>genloginform(&#8220;{{{NAME-OF (PAGE)}}}++{{{AJAX-SESSION-CODE}}}&#8221;,</p>
<p>&#8220;{{{NAME-OF (VIRTEL)}}}&#8221;,&#8221;{{{NAME-OF
(TRANSACTION-EXTERNAL)}}}&#8221;,&#8221;{{{NAME-OF (USER)}}}&#8221;,&#8221;{{{NAME-OF
(PASSWORD)}}}&#8221;,</p>
<p>&#8220;{{{TRIMMED-VALUE-OF &#8220;$ERRMSG$&#8221;}}}&#8221;);</p>
<p>&lt;/script&gt;</p>
<p>&lt;/body&gt;</p>
<p>{{{END-WHEN-EXISTS &#8220;$$SIGTYPE&#8221;}}}</p>
<p>{{{WHEN-NOT-EXISTS &#8220;$$SIGTYPE&#8221;}}}</p>
<p>&lt;body onLoad=&#8221; VirtelFormload()&#8221;&gt;</p>
<p>&lt;p&gt;Logged in as &lt;strong&gt;{{{TRIMMED-VALUE-OF &#8220;$$SIG&#8221;}}}&lt;/strong&gt;&lt;/p&gt;</p>
<p>{{{FOR-EACH-VALUE-IN &#8220;$ERRMSG$&#8221;}}}</p>
<p>&lt;p&gt;{{{CURRENT-VALUE-OF &#8220;$ERRMSG$&#8221;}}}&lt;/p&gt;</p>
<p>{{{END-FOR &#8220;$ERRMSG$&#8221;}}}</p>
<p>&lt;form name=virtelForm</p>
<p>action=&#8221;classics.htm++{{{ SESSION-CODE }}}&#8221; method=&#8221;POST&#8221;&gt;</p>
<p>&lt;pre&gt;&lt;div id=&#8221;printReady&#8221;&gt;{{{ GENERATE-HTML (1,1,5000) }}}&lt;/div&gt;&lt;/pre&gt;</p>
<p>&lt;input type=&#8221;submit&#8221; name=&#8221;disco&#8221; value=&#8221;Disconnect&#8221;</p>
<p>onclick=&#8221;submitForm(&#8216;DISCONNECT&#8217;)&#8221; &gt;</p>
<p>{{{ DEFINE-HTML-PFKEY &#8220;pf&#8221; }}}&lt;input name=&#8221;pf&#8221; type=&#8221;HIDDEN&#8221;
value=&#8221;ENTER&#8221;&gt;</p>
<p>{{{ DEFINE-HTML-FOCUS-FIELD &#8220;focusField&#8221; }}}</p>
<p>&lt;input name=&#8221;focusField&#8221; type=&#8221;hidden&#8221; value=&#8221;{{{FIELD-WITH-CURSOR}}}&#8221;&gt;</p>
<p>&lt;/form&gt;</p>
<p>{{{END-WHEN-NOT-EXISTS &#8220;$$SIGTYPE&#8221;}}}</p>
<p>&lt;/body&gt;&lt;/html&gt;</p>
<p>Figure 4‑4 HTML security: Example page template</p>
</div>
<div class="section" id="security-by-rule">
<h5>Security by rule<a class="headerlink" href="#security-by-rule" title="Permalink to this headline">¶</a></h5>
<p>The rules attached to an HTTP line allow security to be implemented at
the entry point level. The following example shows a set of three rules
which are used to filter incoming HTTP calls. The first rule, 1HT00100,
assigns an entry point specifically for users known to VIRTEL and
identified by means of a “cookie” included in their HTTP request. In
this case, the entry point will be chosen according to the set of rules
associated with that particular user (see “E-mail correspondent
management” sur la page 81). The second rule, 1HT00200, assigns the
entry point EPINTERN to clients whose IP address is 192.168.n.n, and
only during the period Monday to Friday during the hours 08:30 to 17:30.
The third rule, 1HT00900, assigns the entry point EPPUBLIC to all other
requests (this entry point could, for example, display a page containing
the message “Access not authorised”).</p>
<p>LIST of RULES in RULE SET: H-HTTP &#8212;&#8212;&#8212;&#8212;&#8212;- Applid: SPVIRD2
13:57:53</p>
<p>Name Status Description Entry</p>
<p>Point</p>
<p>1HT00100 ACTIVE HTTP access (users authorised by cookie) $COOKIE$</p>
<p>1HT00200 ACTIVE HTTP access (internal network, working hours) EPINTERN</p>
<p>1HT00900 ACTIVE HTTP access (other users) EPPUBLIC</p>
<p>P1=Update P2=Suppress P3=Return</p>
<p>P6=1st page P7=Page-1 P8=Page+1 P12=Edit</p>
<p>Figure 4‑5 HTTP security by rule: List of rules</p>
<p>DETAIL of RULE from RULE SET: H-HTTP &#8212;&#8212;&#8212;&#8212;- Applid: SPVIRD2
14:04:18</p>
<p>Name ===&gt; 1HT00100 Rule priority is per name</p>
<p>Status ===&gt; ACTIVE Mon, 24 Sep 2001 14:19:14</p>
<p>Description ===&gt; HTTP access (users authorised by cookie)</p>
<p>Entry point ===&gt; $COOKIE$ Target Entry Point</p>
<p>Parameter ===&gt; optional &amp;1 value</p>
<p>Trace ===&gt; 1=commands 2=data 3=partner</p>
<p>C : 0=IGNORE 1=IS 2=IS NOT 3=STARTS WITH 4=DOES NOT 5=ENDS WITH 6=DOES
NOT</p>
<p>0 IP Subnet ===&gt; Mask ===&gt;</p>
<p>0 Host ===&gt;</p>
<p>0 eMail ===&gt;</p>
<p>0 Calling DTE ===&gt; Calling DTE address or proxy</p>
<p>0 Called ===&gt; Called DTE address</p>
<p>0 CUD0 (Hex) ===&gt; First 4 bytes of CUD (X25 protocol)</p>
<p>0 User Data ===&gt;</p>
<p>0 Days ===&gt; M: T: W: T: F: S: S:</p>
<p>0 Start time ===&gt; H: M: S: End time ===&gt; H: M: S:</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P4=Activate P5=Inactivate P12=Entry P.</p>
<p>Figure 4‑6 HTTP security by rule: Users authorized by cookie</p>
<p>DETAIL of RULE from RULE SET: H-HTTP &#8212;&#8212;&#8212;&#8212;- Applid: SPVIRD2
14:08:45</p>
<p>Name ===&gt; 1HT00200 Rule priority is per name</p>
<p>Status ===&gt; ACTIVE 02 Jun 2006 14:08:41 VIRDBA</p>
<p>Description ===&gt; HTTP access (internal network, working hours)</p>
<p>Entry point ===&gt; EPINTERN Target Entry Point</p>
<p>Parameter ===&gt; optional &amp;1 value</p>
<p>Trace ===&gt; 1=commands 2=data 3=partner</p>
<p>C : 0=IGNORE 1=IS 2=IS NOT 3=STARTS WITH 4=DOES NOT 5=ENDS WITH 6=DOES
NOT</p>
<p>1 IP Subnet ===&gt; 192.168.000.000 Mask ===&gt; 255.255.000.000</p>
<p>0 Host ===&gt;</p>
<p>0 eMail ===&gt;</p>
<p>0 Calling DTE ===&gt; Calling DTE address or proxy</p>
<p>0 Called ===&gt; Called DTE address</p>
<p>0 CUD0 (Hex) ===&gt; First 4 bytes of CUD (X25 protocol)</p>
<p>0 User Data ===&gt;</p>
<p>1 Days ===&gt; M: X T: X W: X T: X F: X S: S:</p>
<p>1 Start time ===&gt; H: 08 M: 30 S: 00 End time ===&gt; H: 17 M: 30 S: 00</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P4=Activate P5=Inactivate P12=Entry P.</p>
<p>Figure 4‑7 HTTP security by rule: Internal network, working hours</p>
<p>DETAIL of RULE from RULE SET: H-HTTP &#8212;&#8212;&#8212;&#8212;- Applid: SPVIRD2
14:10:50</p>
<p>Name ===&gt; 1HT00900 Rule priority is per name</p>
<p>Status ===&gt; ACTIVE 02 Jun 2006 14:08:05 VIRDBA</p>
<p>Description ===&gt; HTTP access (other users)</p>
<p>Entry point ===&gt; EPPUBLIC Target Entry Point</p>
<p>Parameter ===&gt; optional &amp;1 value</p>
<p>Trace ===&gt; 1=commands 2=data 3=partner</p>
<p>C : 0=IGNORE 1=IS 2=IS NOT 3=STARTS WITH 4=DOES NOT 5=ENDS WITH 6=DOES
NOT</p>
<p>0 IP Subnet ===&gt; 000.000.000.000 Mask ===&gt; 000.000.000.000</p>
<p>0 Host ===&gt;</p>
<p>0 eMail ===&gt;</p>
<p>0 Calling DTE ===&gt; Calling DTE address or proxy</p>
<p>0 Called ===&gt; Called DTE address</p>
<p>0 CUD0 (Hex) ===&gt; First 4 bytes of CUD (X25 protocol)</p>
<p>0 User Data ===&gt;</p>
<p>0 Days ===&gt; M: T: W: T: F: S: S:</p>
<p>0 Start time ===&gt; H: M: S: End time ===&gt; H: M: S:</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P4=Activate P5=Inactivate P12=Entry P.</p>
<p>Figure 4‑8 HTTP security by rule: Other users</p>
</div>
</div>
</div>
</div>
<div class="section" id="howto-information">
<h2>HOWTO information<a class="headerlink" href="#howto-information" title="Permalink to this headline">¶</a></h2>
<p>This chapter presents information about how to perform some common tasks
with VIRTEL.</p>
<div class="section" id="web-access-howto">
<h3>Web Access HOWTO<a class="headerlink" href="#web-access-howto" title="Permalink to this headline">¶</a></h3>
<p>This section presents techniques and tips for some common tasks
associated with VIRTEL Web Access.</p>
<div class="section" id="how-to-use-different-screen-sizes">
<h4>How to use different screen sizes<a class="headerlink" href="#how-to-use-different-screen-sizes" title="Permalink to this headline">¶</a></h4>
<p>Although the standard 3270 screen size is 24 rows by 80 columns, certain
applications benefit from the use of terminals with larger screen sizes.
The screen size is determined by the LOGMODE used for the session
between VIRTEL and the host application. VTAM offers logmodes for the
following standard screen sizes:</p>
<ul class="simple">
<li>model 2&nbsp;: 24x80 (logmode SNX32702)</li>
<li>model 3&nbsp;: 32x80 (logmode SNX32703)</li>
<li>model 4&nbsp;: 43x80 (logmode SNX32704)</li>
<li>model 5&nbsp;: 27x132 (logmode SNX32705)</li>
</ul>
<p>There are two different ways that the VIRTEL administrator can set up
the configuration to allow the VIRTEL Web Access user to select the
desired logmode:</p>
<ul class="simple">
<li>define a separate VIRTEL transaction for each screen size, and allow
the user to select the appropriate transaction</li>
<li>group the VTAM relay LUs into pools, each pool having a different
logmode, and allow the user to select the pool by coding an
appropriate parameter on the URL</li>
</ul>
<div class="section" id="logmode-defined-by-the-transaction">
<h5>LOGMODE defined by the transaction<a class="headerlink" href="#logmode-defined-by-the-transaction" title="Permalink to this headline">¶</a></h5>
<p>With this method, the administrator defines multiple VIRTEL transactions
for a single application, each transaction specifying a different
logmode. For example, transactions Tso2 and Tso5 delivered in the sample
configuration both define TSO as the target application, but specify
different logmodes SNX32702 and SNX32705 respectively. The user selects
the desired transaction from the <em>applist</em> menu displayed by the “Other
applications” link in the VIRTEL Web Access menu.</p>
<p>The figure below shows the definition of the Tso5 transaction defined
under the WEB2HOST entry point:</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTEL
17:12:54</p>
<p>Internal name ===&gt; W2H-13M5 To associate with an entry point name</p>
<p>External name ===&gt; Tso5 Name displayed on user menu</p>
<p>Description ===&gt; Logon to Tso (3270 model 5)</p>
<p>Application ===&gt; TSO Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 1 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; DEVT Prefix of name of partner terminals</p>
<p>Logmode ===&gt; SNX32705 Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 1 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 0 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Logon message ===&gt;</p>
<p>TIOA at logon ===&gt;</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 5‑1 Example of TSO transaction TSO specifying logmode SNX32705</p>
<p>The URL to access this transaction could be of the format:
<em>http://n.n.n.n:41001/w2h/WEB3270.htm+Tso5</em></p>
</div>
<div class="section" id="assigning-a-logmode-by-url-parameter">
<h5>Assigning a LOGMODE by URL parameter<a class="headerlink" href="#assigning-a-logmode-by-url-parameter" title="Permalink to this headline">¶</a></h5>
<p>The URL which allows the browser to connect to a host application via
VIRTEL may contain a parameter, such as “model5” as shown in this
example:</p>
<p><a class="reference external" href="http://n.n.n.n:41001/w2h/WEB3270.htm+Tso+model5">http://n.n.n.n:41001/w2h/WEB3270.htm+Tso+model5</a></p>
<p>This form of a VIRTEL URL is described in the section “Dynamic URL with
userdata” sur la page 16.</p>
<p>This form of URL is processed by VIRTEL with reference to the “rule set”
associated with the HTTP line. VIRTEL looks for a rule whose “User Data”
field matches the value of the parameter (<em>model5</em>). The “Parameter”
field of the selected rule assigns a relay LU name from the pool defined
with logmode SNX32705.</p>
<p>The VTAM definition of the relay pool is shown in the example below. In
this example, LU names in the range RHTVT5<em>nn</em> are defined to have the
model5 logmode SNX32705:</p>
<p>VIRTAPPL VBUILD TYPE=APPL</p>
<p>* &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212; *</p>
<p>* RHTVTxxx : Relay for VTAM applications acceded by WEB to HOST *</p>
<p>* &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212; *</p>
<p>* 3270 model 2 terminals</p>
<p>RHTVT0?? APPL AUTH=(ACQ,PASS),MODETAB=ISTINCLM,DLOGMOD=SNX32702,EAS=1</p>
<p>* 3270 model 5 terminals</p>
<p>RHTVT5?? APPL AUTH=(ACQ,PASS),MODETAB=ISTINCLM,DLOGMOD=SNX32705,EAS=1</p>
<p>Figure 5‑2 VTAM definition of terminal groups</p>
<p>The screen below shows an example rule which assigns a relay LU from the
range RHTVT5<em>nn</em> when the URL contains the parameter <em>model5</em>:</p>
<p>DETAIL of RULE from RULE SET: W-HTTP &#8212;&#8212;&#8212;&#8212;- Applid: VIRTEL
17:15:15</p>
<p>Name ===&gt; WHT00150 Rule priority is per name</p>
<p>Status ===&gt; INACTIVE Mon, 24 Sep 2001 14:19:14</p>
<p>Description ===&gt; HTTP access (with model5 URL parameter)</p>
<p>Entry point ===&gt; WEB2HOST Target Entry Point</p>
<p>Parameter ===&gt; RHTVT5* &amp;1 value or LUNAME</p>
<p>Trace ===&gt; 1=commands 2=data 3=partner</p>
<p>C : 0=IGNORE 1=IS 2=IS NOT 3=STARTS WITH 4=DOES NOT 5=ENDS WITH 6=DOES
NOT</p>
<p>0 IP Subnet ===&gt; Mask ===&gt;</p>
<p>0 Host ===&gt;</p>
<p>0 eMail ===&gt;</p>
<p>0 Calling DTE ===&gt; Calling DTE address or proxy</p>
<p>0 Called ===&gt; Called DTE address</p>
<p>0 CUD0 (Hex) ===&gt; First 4 bytes of CUD (X25 protocol)</p>
<p>1 User Data ===&gt; model5</p>
<p>0 Days ===&gt; M: T: W: T: F: S: S:</p>
<p>0 Start time ===&gt; H: M: S: End time ===&gt; H: M: S:</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P4=Activate P5=Inactivate P12=Entry P.</p>
<p>Figure 5‑3 Example rule for selection of logmode by URL</p>
<p>The LU name (RHTVT5*nn*) assigned by the rule must belong to the LU pool
shared assigned to the HTTP line, as shown in the example below:</p>
<p>TERMINAL DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTEL
13:32:28</p>
<p>Terminal ===&gt; W2HTP500 ?wxyZZZZ for dynamic allocation</p>
<p>w : Sna or Non-sna or * (category)</p>
<p>x : 1, 2, 3, 4, 5 or * (model)</p>
<p>y : Colour, Monochrome or *</p>
<p>Z : any characters</p>
<p>Relay ===&gt; RHTVT500 Name seen by VTAM applications</p>
<p>= : copied from the terminal name</p>
<p>*Pool name ===&gt; *W2HPOOL Pool where to put this terminal</p>
<p>Description ===&gt; Relay pool for HTTP (3270 model 5)</p>
<p>Entry Point ===&gt; Enforced Entry Point</p>
<p>2nd relay ===&gt; RHTIM500 Possible 2nd relay (Printer)</p>
<p>Terminal type ===&gt; 3 1=LU1 2=3270 3=FC P=Printer S=Scs</p>
<p>Compression ===&gt; 2 0, 1, 2 or 3 : compression type</p>
<p>Possible Calls ===&gt; 3 0=None 1=Inbound 2=Outbound 3=Both</p>
<p>Write Stats to ===&gt; 12 1,4=VIRSTAT 2=VIRLOG</p>
<p>Repeat ===&gt; 0020 Number of generated terminals</p>
<p>P1=Update P3=Return Enter=Add</p>
<p>P12=Server</p>
<p>Figure 5‑4 Definition of model 5 terminals in the W2HPOOL pool</p>
</div>
<div class="section" id="user-specified-logmode">
<h5>User-specified LOGMODE<a class="headerlink" href="#user-specified-logmode" title="Permalink to this headline">¶</a></h5>
<p>When the entry point definition specifies SCENLOGM in the
“Identification scenario” field, the user may override the default
logmode by appending an additional parameter LOGMODE=modename to the
URL, as shown in this example:</p>
<p><a class="reference external" href="http://n.n.n.n:41001/w2h/WEB3270.htm+Tso?logmode=SNX32705">http://n.n.n.n:41001/w2h/WEB3270.htm+Tso?logmode=SNX32705</a></p>
<p>The source code for the SCENLOGM scenario is supplied in the VIRTEL
SAMPLIB.</p>
<p>Note: To activate this functionality, SCENLOGM must be specified in the
“Identification scenario” field of the ENTRY POINT (not the transaction
definition)</p>
</div>
<div class="section" id="dynamic-logmode-with-user-specified-screen-size">
<h5>Dynamic logmode with user-specified screen size<a class="headerlink" href="#dynamic-logmode-with-user-specified-screen-size" title="Permalink to this headline">¶</a></h5>
<p>VIRTEL Web Access also supports the use of “dynamic” logmodes, such as
D4A32XX3, which allow the user to specify a non-standard alternate
screen size. When the entry point definition specifies SCENLOGM in the
“Identification scenario” field, the user may also append ROWS and COLS
parameters to the URL, as shown in this example:</p>
<p><a class="reference external" href="http://n.n.n.n:41001/w2h/WEB3270.htm+Tso?logmode=D4A32XX3&amp;rows=54&amp;cols=132">http://n.n.n.n:41001/w2h/WEB3270.htm+Tso?logmode=D4A32XX3&amp;rows=54&amp;cols=132</a></p>
<p>VIRTEL allows a maximum screen size of 62 rows by 160 columns. The host
application must also support the use of non-standard screen sizes.</p>
</div>
</div>
<div class="section" id="how-to-override-the-codepage-by-url-parameter">
<h4>How to override the codepage by URL parameter<a class="headerlink" href="#how-to-override-the-codepage-by-url-parameter" title="Permalink to this headline">¶</a></h4>
<p>Users who require a codepage different from the default DEFUTF8 value
specified in the VIRTCT can specify the desired codepage as a parameter
of the URL, as shown in this example:</p>
<p><a class="reference external" href="http://n.n.n.n:41001/w2h/WEB2AJAX.htm+Tso?codepage=IBM1047">http://n.n.n.n:41001/w2h/WEB2AJAX.htm+Tso?codepage=IBM1047</a></p>
<p>Note: To activate this functionality, SCENLOGM must be specified in the
“Identification scenario” field of the ENTRY POINT (not the transaction
definition)</p>
<p>The value of the CODEPAGE parameter may be either:</p>
<ol class="arabic simple">
<li>one of the values listed for the DEFUTF8 parameter of the VIRTCT (see
“Parameters of the VIRTCT” in the <em>VIRTEL Installation Guide</em>); or</li>
<li>one of the additional codepages you have specified in the CHARSET
parameter in your VIRTCT at VIRTEL installation time</li>
</ol>
</div>
<div class="section" id="how-to-handle-host-session-termination">
<h4>How to handle host session termination<a class="headerlink" href="#how-to-handle-host-session-termination" title="Permalink to this headline">¶</a></h4>
<p>When the user terminates the application session by pressing the
“Disconnect” button in the browser, various options are available:</p>
<ul class="simple">
<li>Return to the application selection menu</li>
<li>Display a specific HTML page</li>
<li>Close the browser window and return to the desktop</li>
</ul>
<p>Remember that it is always best to exit cleanly from the host
application by pressing the “Disconnect” button, rather than closing the
browser window. If the browser window is closed abruptly, the host
session resources may not be freed until the expiry of the timeout
period specified in the entry point definition.</p>
<div class="section" id="return-to-the-application-selection-menu">
<h5>Return to the application selection menu<a class="headerlink" href="#return-to-the-application-selection-menu" title="Permalink to this headline">¶</a></h5>
<p>When a “Disconnect” request is received, VIRTEL returns to the root URL
and displays the default page for the line, which will normally be an
application selection menu. For detailed information, see “VIRTEL URL
formats” sur la page 12.</p>
<p>The user can then choose to connect to the same or a different
application by clicking on the appropriate link in the application
selection menu.</p>
</div>
<div class="section" id="displaying-a-specific-page-on-disconnection">
<h5>Displaying a specific page on disconnection<a class="headerlink" href="#displaying-a-specific-page-on-disconnection" title="Permalink to this headline">¶</a></h5>
<p>Those sites wishing to display a specific page at the end of a session
may use the “Last page” field in the definition of the entry point
associated with the HTTP line or the entry point selected by the rules
of the line. The “Last page” field indicates the name of the page to be
displayed following disconnection from the host application. The
indicated file must be uploaded to the same directory as specified in
the URL for the host application (for example W2H-DIR if the URL
specifies <em>/w2h/WEB3270.htm</em>).</p>
<p>The “Last page” may contain instructions to the user and may include
system information provided by VIRTEL (such as the application and
terminal name, date and time, etc.)</p>
</div>
<div class="section" id="closing-the-browser-window-automatically">
<h5>Closing the browser window automatically<a class="headerlink" href="#closing-the-browser-window-automatically" title="Permalink to this headline">¶</a></h5>
<p>Sites who wish to close the browser window and return to the desktop
when the user disconnects from the host application may specify
<em>close.htm</em> in the “Last page” field of the entry point definition. This
page contains JavaScript code which will attempt to close the current
browser window. Depending on the browser version and security settings,
the window may close, a prompt may be issued, or the window may remain
open. The <em>close.htm</em> page is delivered as standard in the W2H-DIR
directory but may be copied to another directory if required.</p>
<p>The figure below shows an example of an entry point definition with
<em>close.htm</em> specified as the “Last page”:</p>
<p>ENTRY POINT DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTEL
14:35:23</p>
<p>Name ===&gt; WEB2HOST Name this ENTRY POINT (LOGON DATA)</p>
<p>Description ===&gt; HTTP entry point (SysperTec menu)</p>
<p>Transactions ===&gt; W2H Prefix for associated transactions</p>
<p>Last page ===&gt; CLOSE.HTM Displayed at end of session</p>
<p>Transparency ===&gt; Server types NOT to emulate</p>
<p>Time out ===&gt; 0005 minutes Maximum inactive time</p>
<p>Do if timeout ===&gt; 0 0=logoff 1=bip+logoff 2=anti pad</p>
<p>Emulation ===&gt; HTML Type of terminal:</p>
<p>HOST4WEB : program driven HTML : Web Browser</p>
<p>SCENARIO : script driven EMAIL : SMTP client</p>
<p>MINITEL : 40 or 80 columns X25 : uses low level dialog</p>
<p>Signon program ===&gt; VIR0020H Controls user name and password</p>
<p>Menu program ===&gt; VIR0021A List of transactions</p>
<p>Identification scenario ===&gt; eg XML identification</p>
<p>Type 3 compression ===&gt; Discover typical screens (Virtel/PC)</p>
<p>Mandatory identification ===&gt; (PC or minitel)</p>
<p>3270 swap key ===&gt; eg P24</p>
<p>Extended colors ===&gt; X E: extended X: extended + DBCS</p>
<p>P1=Update P3=Return P4=Transactions</p>
<p>Enter=Add</p>
<p>Figure 5‑5 Example of entry point with last page</p>
</div>
</div>
<div class="section" id="how-to-access-a-host-application-directly">
<h4>How to access a host application directly<a class="headerlink" href="#how-to-access-a-host-application-directly" title="Permalink to this headline">¶</a></h4>
<p>It is not always necessary to pass via an application selection menu to
connect to a host application. A host application may be accessed
directly by opening the URL containing the complete path to the
application. This URL may result in the display of the host signon
screen, the first application screen, or possibly (if a script or
scenario is used), a subsequent screen sent by the application. For more
information about how VIRTEL can be used to automate the process of
connection to a host application, see “VIRTEL URL formats” sur la page
12 of this manual, and “Connection/Disconnection Scripts” in the <em>VIRTEL
Connectivity Reference</em> manual.</p>
<div class="section" id="full-path-url">
<h5>Full path URL<a class="headerlink" href="#full-path-url" title="Permalink to this headline">¶</a></h5>
<div class="line-block">
<div class="line">For example, you can access the VIRTEL transaction whose external name
is “Cics” by pointing the browser at a URL of the following format:</div>
<div class="line"><em>http://n.n.n.n:41001/w2h/WEB2AJAX.htm+Cics</em></div>
</div>
<p>At the end of the session with the host application, VIRTEL examines the
“Last page” field (see previous section) to decide whether to return to
the desktop or to redisplay the application selection menu.</p>
</div>
<div class="section" id="default-url-for-the-entry-point">
<h5>Default URL for the entry point<a class="headerlink" href="#default-url-for-the-entry-point" title="Permalink to this headline">¶</a></h5>
<div class="line-block">
<div class="line">An application URL may be coded in the “TIOA at logon” field of the
default transaction for the entry point (the default transaction is
the transaction whose external name is the same as the entry point
name). This allows the user to go directly to the host application
simply by entering a URL of the format:</div>
<div class="line"><em>http://n.n.n.n:41001</em></div>
</div>
<p>The example below shows the default transaction for the WEB2HOST entry
point set up to go directly to the transaction whose external name is
“Cics”:</p>
<p>TRANSACTION DETAIL DEFINITION &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- Applid: VIRTEL
15:01:02</p>
<p>Internal name ===&gt; W2H-00 To associate with an entry point name</p>
<p>External name ===&gt; WEB2HOST Name displayed on user menu</p>
<p>Description ===&gt; Default directory = entry point name</p>
<p>Application ===&gt; W2H-DIR Application to be called</p>
<p>PassTicket ===&gt; 0 Name ===&gt; 0=no 1=yes 2=unsigned</p>
<p>Application type ===&gt; 4 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE</p>
<p>Pseudo-terminals ===&gt; DELOC Prefix of name of partner terminals</p>
<p>Logmode ===&gt; Specify when LOGMODE must be changed</p>
<p>How started ===&gt; 2 1=menu 2=sub-menu 3=auto</p>
<p>Security ===&gt; 0 0=none 1=basic 2=NTLM 3=TLS 4=HTML</p>
<p>H4W commands ? ===&gt; 0=no 1=yes 2=if2VIRTEL 4=auto</p>
<p>Check URL Prefix ===&gt;</p>
<p>TIOA at logon ===&gt; /w2h/WEB2AJAX.htm+Cics</p>
<p>TIOA at logoff ===&gt;</p>
<p>Initial Scenario ===&gt; Final Scenario ===&gt;</p>
<p>Input Scenario ===&gt; Output Scenario ===&gt;</p>
<p>P1=Update P3=Return P12=Server</p>
<p>Figure 5‑6 Example of default URL</p>
<p>For more information see “VIRTEL URL formats” en page 12.</p>
</div>
</div>
<div class="section" id="how-to-change-the-font-for-web-access">
<h4>How to change the font for Web Access<a class="headerlink" href="#how-to-change-the-font-for-web-access" title="Permalink to this headline">¶</a></h4>
<p>The Web Access Settings menu (described sur la page 106) allows you to
change the font family and font size. By default VIRTEL will calculate
an appropriate font size to fit the browser window size, but you can
choose a fixed font size if you prefer. VIRTEL Web Access uses a
fixed-pitch font to display the 3270 screen. If you do not like the
default font then you can choose any fixed-pitch font installed on the
workstation. Typical fonts available on Windows workstations are Courier
New, Fixedsys, Terminal, Consolas, and Lucida Console. You can use the
Windows Control Panel – Fonts dialog to view the installed fonts.</p>
</div>
<div class="section" id="how-to-customize-the-enter-key-settings">
<h4>How to customize the Enter key settings<a class="headerlink" href="#how-to-customize-the-enter-key-settings" title="Permalink to this headline">¶</a></h4>
<p>Many 3270 users prefer to customize the keyboard mapping so that the
“Enter” key on the main keyboard is handled as a 3270 newline, while the
right “Ctrl” key and the “Enter” key on the numeric keypad are treated
as 3270 Enter.</p>
<p>The Web Access Settings menu (described sur la page 106) allows you to
specify this configuration using the following settings:</p>
<p>&#8220;ctrl&#8221;:&#8221;ENTER&#8221;,</p>
<p>&#8220;enter&#8221;:&#8221;Newline&#8221;,</p>
<p>&#8220;kpenter&#8221;:&#8221;ENTER&#8221;</p>
<p>Note however that versions 6, 7, and 8 of Internet Explorer do not
distinguish between the Enter key on the main keyboard and the Enter key
on the numeric keypad. For users who want the two “Enter” keys to be
handled differently, Syspertec supplies an additional DLL to be
installed in Internet Explorer as a “Browser Helper Object”. This DLL
can be installed by clicking on the “Install VirtKey BHO” link on the
VIRTEL Web Access menu. After installing the DLL, go to “Tools” –
“Internet Options” – “Advanced” and check that the option “Enable
third-party browser extensions” is ticked, then stop and restart
Internet Explorer. Administrator privilege is needed to install the
Browser Helper Object, but once installed the BHO can be used by users
without administrator privileges.</p>
<p>Although other browsers (including Internet Explorer 9) are capable of
recognizing the keypad Enter key without the need for a BHO, older
releases of Firefox, Chrome, and Safari do not distinguish between the
left and right Ctrl keys. This means that when “ctrl” is set to “ENTER”
then both Ctrl keys will be handled as 3270 Enter. In addition, the
AltGr key will be treated as Ctrl under Firefox. The most recent
versions of Firefox (from version 15 onwards for Windows 7 and from
version 17 onwards for Windows XP) and Chrome (from version 23 onwards)
are capable of distinguishing between the left and right Ctrl keys like
Internet Explorer.</p>
</div>
<div class="section" id="how-to-change-the-default-user-settings">
<h4>How to change the default user settings<a class="headerlink" href="#how-to-change-the-default-user-settings" title="Permalink to this headline">¶</a></h4>
<p>The site default settings for Web Access are stored in the file
w2hparm.js (see “Global modification of Web Access settings” sur la page
113)</p>
</div>
<div class="section" id="how-to-define-a-reverse-proxy">
<h4>How to define a reverse proxy<a class="headerlink" href="#how-to-define-a-reverse-proxy" title="Permalink to this headline">¶</a></h4>
<p>If your installation uses a reverse proxy (or bastion host) between the
user’s browser and the VIRTEL Web Access server, then the VIRTEL log and
statistics file will show the IP address of the proxy instead of the
address of the end user. In order for VIRTEL to recognize and log the
originating user’s IP address, you must declare the proxy in the HTFORWD
parameter of the VIRTCT (see “Parameters of the VIRTCT” in the <em>VIRTEL
Installation Guide</em>) or in a rule attached to the HTTP line (see “Rules”
in the <em>VIRTEL Connectivity Reference</em> manual).</p>
</div>
<div class="section" id="how-to-support-virtual-hosting">
<h4>How to support virtual hosting<a class="headerlink" href="#how-to-support-virtual-hosting" title="Permalink to this headline">¶</a></h4>
<p>Name-based virtual hosting is a method for supporting multiple sites
(for example, <em>site1.mycompany.com</em> and <em>site2.mycompany.com</em>) using the
same IP address and port number. By means of the “HTTP Host” field in
the rules attached to the HTTP line, VIRTEL can recognize the site name
and direct the request to a specific entry point. Refer to “Rules” in
the <em>VIRTEL Connectivity Reference</em> manual for further details. You can
install a set sample definitions for virtual hosting by running the
ARBOLOAD job (delivered in the VIRTEL SAMPLIB) with the VHOST=YES
parameter.</p>
</div>
</div>
</div>
<div class="section" id="index">
<h2>Index<a class="headerlink" href="#index" title="Permalink to this headline">¶</a></h2>
<p>$ERRMSG$</p>
<p>Special variable, 300</p>
<p>2VIRTEL, 287</p>
<p>3270 presentation, 117</p>
<p>ACTION$, 154</p>
<p>ADD-TO-FIELDS, 42</p>
<p>ADVANCE-TO-NEXT-VALUE-OF, 55</p>
<p>AFTER-NOT-LAST-VALUE-OF, 61</p>
<p>AJAX, 230</p>
<p>Ajax 3270, 117</p>
<p>Ajax HTML, 117</p>
<p>AJAX-SESSION-CODE, 28</p>
<p>Application selection menu, 116</p>
<p>APPLICATION-IS-CONNECTED, 64</p>
<p>applist, 116</p>
<p>appmenu, 116</p>
<p>AS-ANSWER, 209</p>
<p>AS-FILE, 210</p>
<p>AT-TLS, 299</p>
<p>Auto-refresh, 230</p>
<p>bastion host, 312</p>
<p>CASE$, 158</p>
<p>colors</p>
<p>customization, 136</p>
<p>Commands</p>
<p>HOST4WEB, 287</p>
<p>Commarea, 188, 234</p>
<p>Commarea-to-output conversion, 217</p>
<p>CONVERT$, 160</p>
<p>Cookies</p>
<p>Session Cookie, 19</p>
<p>COPY$, 161</p>
<p>COPY-FROM, 33</p>
<p>Correspondent</p>
<p>e-mail, 81</p>
<p>Local, 81</p>
<p>Management, 81</p>
<p>COUNTRY-CODE, 69</p>
<p>CREATE-VARIABLE-FROM, 34, 35</p>
<p>CREATE-VARIABLE-IF, 63, 64</p>
<p><strong>Crosshair cursor</strong>, 109</p>
<p>cURL</p>
<p>Batch upload, 102</p>
<p>CURRENT-VALUE-OF, 53</p>
<p><strong>Cursor</strong></p>
<p>Crosshair, 109</p>
<p>custom.css, 136</p>
<p>customize colors, 136</p>
<p>DEBUG$, 176</p>
<p>DECLARE$, 177</p>
<p>DECLARE-FIELD-AS, 64, 67</p>
<p>DEFAULT-FIELD-WITH-CURSOR, 45</p>
<p>DEFINE-AUTOMATIC-COUNTER, 55</p>
<p>DEFINE-CHOICE, 181</p>
<p>DEFINE-CURSOR-POSITION-FIELD, 44</p>
<p>DEFINE-DFHMDF-COLUMN, 37</p>
<p>DEFINE-DFHMDF-NAME, 36</p>
<p>DEFINE-HTML-FIELD, 35</p>
<p>DEFINE-HTML-FIELD-NAME, 35</p>
<p>DEFINE-HTML-FOCUS-FIELD, 44</p>
<p>DEFINE-HTML-PFKEY, 47</p>
<p>DEFINE-SUB-VARIABLE, 56</p>
<p>DEFINE-VARIABLE-CHOICE, 182</p>
<p>DELETE-ALL-VARIABLES, 56</p>
<p>Detecting Virtel, 269</p>
<p>Directory management</p>
<p>Definition, 24</p>
<p>DISCONNECT, 154</p>
<p>DO-COUNT-UP-WITH, 55</p>
<p>e-mail</p>
<p>File transfer, 254</p>
<p>Incoming, 253</p>
<p>Reception, 290</p>
<p>Sending, 294</p>
<p>Starting an application, 255</p>
<p>ENCODING, 213</p>
<p>Encryption</p>
<p>Password, 300</p>
<p>ENCRYPTION-PARAMETERS, 66</p>
<p>END-DO-COUNT, 55</p>
<p>END-FOR, 55</p>
<p>ERASE-FIELD, 162, 172, 173</p>
<p>ERROR$, 180</p>
<p>FAIL, 151, 158, 186</p>
<p>FIELD$, 181</p>
<p>FIELD-NAME-TO-VARIABLE, 161</p>
<p>FIELD-WITH-CURSOR, 45</p>
<p>File transfer</p>
<p>SMTP, 254</p>
<p>TSO, 125</p>
<p>FILTER$, 183</p>
<p>Final scenario, 151</p>
<p>FOR-EACH-VALUE-IN, 53</p>
<p>FOR-HTTP, 201</p>
<p>FOR-IND$FILE, 203</p>
<p>FOR-MQ, 205</p>
<p>FOR-SMTP, 206</p>
<p>Function keys</p>
<p>Web-to-Host, 47</p>
<p>GENERATE-HTML, 32</p>
<p>GENERATE-VARIABLES, 38</p>
<p>GENERATE-VIR3270, 39</p>
<p>GIVE-LENGTH-PREFIX, 245</p>
<p>GOTO$, 184</p>
<p>H4W, 10</p>
<p>Headers</p>
<p>HTTP, 167</p>
<p>HIDE, 182</p>
<p>HOST4WEB, 10</p>
<p>Commands, 287</p>
<p>Host-for-Web, 10</p>
<p>Host-Web-Services, 10</p>
<p><strong>Hotspots</strong>, 110</p>
<p>HTML</p>
<p>Page Upload, 85</p>
<p>Pages</p>
<p>Creation, 27</p>
<p>Function keys, 47</p>
<p>Tags VIRTEL, 27</p>
<p>Presentation</p>
<p>Modification of, 150</p>
<p>Query, 188, 234</p>
<p>Tags</p>
<p>ADD-TO-FIELDS, 42</p>
<p>ADVANCE-TO-NEXT-VALUE-OF, 55</p>
<p>AFTER-NOT-LAST-VALUE-OF, 61</p>
<p>COPY-FROM, 33</p>
<p>COUNTRY-CODE, 69</p>
<p>CREATE-VARIABLE-FROM, 34, 35</p>
<p>CREATE-VARIABLE-IF, 63, 64</p>
<p>CURRENT-VALUE-OF, 53</p>
<p>DECLARE-FIELD-AS, 67</p>
<p>DECLARE-FIELD-AS, 64</p>
<p>DEFAULT-FIELD-WITH-CURSOR, 45</p>
<p>DEFINE-AUTOMATIC-COUNTER, 55</p>
<p>DEFINE-CURSOR-POSITION-FIELD, 44</p>
<p>DEFINE-DFHMDF-COLUMN, 37</p>
<p>DEFINE-DFHMDF-NAME, 36</p>
<p>DEFINE-HTML-FIELD, 35</p>
<p>DEFINE-HTML-FIELD-NAME, 35</p>
<p>DEFINE-HTML-FOCUS-FIELD, 44</p>
<p>DEFINE-HTML-PFKEY, 47</p>
<p>DEFINE-SUB-VARIABLE, 56</p>
<p>DELETE-ALL-VARIABLES, 56</p>
<p>DO-COUNT-UP-WITH, 55</p>
<p>ENCRYPTION-PARAMETERS, 66</p>
<p>END-DO-COUNT, 55</p>
<p>END-FOR, 55</p>
<p>FIELD-WITH-CURSOR, 45</p>
<p>FOR-EACH-VALUE-IN, 53</p>
<p>GENERATE-HTML, 32</p>
<p>GENERATE-VARIABLES, 38</p>
<p>GENERATE-VIR3270, 39</p>
<p>IF-PRINT-IS-READY, 78</p>
<p>IF-SECURITY-TOKEN-IS-READY, 77</p>
<p>IF-USER-IS-ALLOWED-TO, 61</p>
<p>INVALID-PFKEYS, 48</p>
<p>IP-ADDRESS-OF-LINE, 58</p>
<p>IP-PORT-OF-LINE, 58</p>
<p>NAME-OF, 59</p>
<p>NO-BLANKS-VALUE-OF, 54</p>
<p>NUMBER-OF, 60</p>
<p>ON-ATTRIBUTE, 40</p>
<p>ON-CHARACTER-ATTRIBUTE, 41</p>
<p>ON-END-OF-ATTRIBUTE, 41</p>
<p>ON-END-OF-CHARACTER-ATTRIBUTE, 42</p>
<p>PDF-LINES-PER-PAGE, 79</p>
<p>PDF-NEW-DOCOPT, 79</p>
<p>PDF-NEW-INPUT, 79</p>
<p>PDF-NEW-LAYOUT, 79</p>
<p>PDF-OUTLINE, 79</p>
<p>PDF-PAGE-BREAK, 80</p>
<p>PDF-USE-DOCOPT, 80</p>
<p>PDF-USE-LAYOUT, 80</p>
<p>PDF-VARIABLE, 80</p>
<p>POSITION-OF-THE-CURSOR, 46</p>
<p>PRINT, 78</p>
<p>PUBLIC-KEY, 67</p>
<p>SECURITY-TOKEN, 77</p>
<p>SET-CONTENT-TYPE, 74</p>
<p>SET-COUNTRY-CODE, 69</p>
<p>SET-HEADER, 75</p>
<p>SET-HTTP-RETURN-CODE, 72</p>
<p>SET-LOCAL-OPTIONS, 51, 67</p>
<p>SET-MAX-AGE, 73</p>
<p>SET-OUTPUT-ENCODING-UTF-8, 70</p>
<p>SET-PAGE-CACHEABLE, 73</p>
<p>SET-PAGE-NOT-CACHEABLE, 73</p>
<p>TRIMMED-VALUE-OF, 54</p>
<p>UNSET-LOCAL-OPTIONS, 52</p>
<p>USER-SIGNON-CODE, 65</p>
<p>VALID-PFKEYS, 48</p>
<p>WHEN-EXISTS, 61</p>
<p>WHEN-NEXT-EVENT, 62</p>
<p>WHEN-NOT-BLANK, 62</p>
<p>WHEN-NOT-EXISTS, 62</p>
<p>WHILE-EVENT, 62</p>
<p>VIRTEL Tags</p>
<p>AJAX-SESSION-CODE, 28</p>
<p>SESSION-CODE, 28</p>
<p>SET-INITIAL-TIMEOUT, 28</p>
<p>HTML presentation, 117</p>
<p>HTTP</p>
<p>Security, 297</p>
<p>HTTP Headers</p>
<p>GIVE-LENGTH-PREFIX, 245</p>
<p>HTTP-HEADER, 167</p>
<p>HTTPS, 299</p>
<p>HWS, 10</p>
<p>Identification scenario, 151</p>
<p>IF$, 185</p>
<p>IF-PRINT-IS-READY, 78</p>
<p>IF-SECURITY-TOKEN-IS-READY, 77</p>
<p>IF-USER-IS-ALLOWED-TO, 61</p>
<p>IND$FILE, 125</p>
<p>INDSCEN$, 187</p>
<p>Initial scenario, 151</p>
<p>Input scenario, 151</p>
<p>Input XML, 188</p>
<p>INPUT-FILE-TO-VARIABLE, 161</p>
<p>INPUT-TO-SCREEN, 162</p>
<p>INPUT-TO-VARIABLE, 163</p>
<p>INVALID-PFKEYS, 48</p>
<p>IP-ADDRESS-OF-LINE, 58</p>
<p>IP-PORT-OF-LINE, 58</p>
<p>IS-BINARY-CHOICE, 182</p>
<p>LIST-TO-VARIABLE, 164</p>
<p>logo, 139</p>
<p>MAP$, 188</p>
<p>ABEND, 189</p>
<p>ABEND-AT, 189</p>
<p>AREA, 189</p>
<p>AREA-ATTRIBUTE, 192</p>
<p>BEGIN, 193</p>
<p>BEGIN,EVENT, 194</p>
<p>BEGIN,TOP, 194</p>
<p>ELSETHEN-AREA, 195</p>
<p>END, 194</p>
<p>EVENTUAL-AREA, 195</p>
<p>EXECUTE, 197</p>
<p>FROM-FIELD, 198</p>
<p>FROM-INPUT, 199</p>
<p>FROM-VARIABLE, 200</p>
<p>TO-VARIABLE, 200</p>
<p>Menu</p>
<p>Application selection, 116</p>
<p>NAME-OF, 59, 168, 174</p>
<p>NEXT-ELEMENT, 193</p>
<p>NO-BLANKS-VALUE-OF, 54</p>
<p>NUMBER-OF, 60, 169, 174</p>
<p>OFFAREA, 163, 190</p>
<p>OFFSET-LENGTH, 163, 190</p>
<p>ON-ATTRIBUTE, 40</p>
<p>ON-CHARACTER-ATTRIBUTE, 41</p>
<p>ON-END-OF-ATTRIBUTE, 41</p>
<p>ON-END-OF-CHARACTER-ATTRIBUTE, 42</p>
<p>OPTION$, 201</p>
<p>Output scenario, 152</p>
<p>OUTPUT-FILE-TO-VARIABLE, 165</p>
<p>PAGE, 214</p>
<p>PAGE-FROM-VARIABLE, 214</p>
<p>Pages HTML</p>
<p>Upload, 85</p>
<p>Parser/Generator</p>
<p>XML, 245</p>
<p>Passe-Partout, 21</p>
<p>Password encryption, 300</p>
<p>PCL printing, 120, 124</p>
<p>PDF</p>
<p>Example, 232</p>
<p>PDF-LINES-PER-PAGE, 79</p>
<p>PDF-NEW-DOCOPT, 79</p>
<p>PDF-NEW-INPUT, 79</p>
<p>PDF-NEW-LAYOUT, 79</p>
<p>PDF-OUTLINE, 79</p>
<p>PDF-PAGE-BREAK, 80</p>
<p>PDF-USE-DOCOPT, 80</p>
<p>PDF-USE-LAYOUT, 80</p>
<p>PDF-VARIABLE, 80</p>
<p><strong>Point-and-shoot</strong>, 110</p>
<p>POP$, 208</p>
<p>POSITION-OF-THE-CURSOR, 46</p>
<p>Prefix</p>
<p>2VIRTEL, 287</p>
<p>Presentation mode</p>
<p>3270, 117</p>
<p>Ajax 3270, 117</p>
<p>Ajax HTML, 117</p>
<p>HTML, 117</p>
<p>Tablet, 117</p>
<p>PRINT, 78</p>
<p>Printing, 120</p>
<p>Autoconnect, 122</p>
<p>CICS definitions, 123</p>
<p>PCL, 124</p>
<p>PCL-to-PDF, 124</p>
<p>VIRTEL definitions, 120</p>
<p>VTAM definitions, 123</p>
<p>PrintVirtelSession, 18</p>
<p>PRIORITY, 214</p>
<p>proxy</p>
<p>reverse, 312</p>
<p>PUBLIC-KEY, 67</p>
<p>Query</p>
<p>URL parameters, 17, 162, 163, 213</p>
<p>Query data, 188, 234</p>
<p>REPLACE, 161, 163, 164, 166, 169, 172</p>
<p>RETURN$, 208</p>
<p>reverse proxy, 312</p>
<p>Scenario, 151</p>
<p>SCENARIO, 153</p>
<p>Scenarios, 150</p>
<p>SCREENS, 153</p>
<p>SCREEN-TO-VARIABLE, 166</p>
<p>SCRNEND, 153</p>
<p>Security</p>
<p>Transport Layer, 299</p>
<p>Web-to-Host, 297</p>
<p>SECURITY-TOKEN, 77</p>
<p>Selection fields, 182, 275</p>
<p>SEND$, 209</p>
<p>SERVE-ANOTHER-USER, 154</p>
<p>Service Programs</p>
<p>VIRSV, 219</p>
<p>Service Transaction, 11, 154</p>
<p>SESSION-CODE, 28</p>
<p>SET$, 213</p>
<p>SET-CONTENT-TYPE, 74</p>
<p>SET-COUNTRY-CODE, 69</p>
<p>SET-HEADER, 75</p>
<p>SET-HTTP-RETURN-CODE, 72</p>
<p>SET-INITIAL-TIMEOUT, 28</p>
<p>SET-LOCAL-OPTIONS, 51, 67</p>
<p>SET-MAX-AGE, 73</p>
<p>SET-OUTPUT-ENCODING-UTF-8, 70</p>
<p>SET-PAGE-CACHEABLE, 73</p>
<p>SET-PAGE-NOT-CACHEABLE, 73</p>
<p>Settings</p>
<p>Web Access, 105</p>
<p>Signon</p>
<p>HTML Example, 300</p>
<p>SIGNON, 215</p>
<p>SIGNON-IS-OK, 64</p>
<p>SMTP</p>
<p>File transfer, 254</p>
<p>Starting an application, 255</p>
<p>SRCNAPI MACLIB, 150</p>
<p>SRTVIRTEL, 268</p>
<p>SSL, 299</p>
<p>Starting</p>
<p>Application by e-mail, 255</p>
<p>STRFIELD, 268</p>
<p>Structured field</p>
<p>FA88, 272</p>
<p>FAC8, 253, 273, 290</p>
<p>FAD4, 294</p>
<p>FAD5, 288</p>
<p>FAE5, 275</p>
<p>FAE6, 275</p>
<p>How to detect Virtel, 269</p>
<p>Presentation, 267</p>
<p>SRTVIRTEL, 268</p>
<p>Web-to-Host, 272, 273, 275</p>
<p>Structured Field, 267</p>
<p>SUCCESS, 151, 158, 186</p>
<p>Suggest, 227</p>
<p>SUGGEST$, 228</p>
<p>SYSTEM-TO-VARIABLE, 167</p>
<p>Table variable, 182</p>
<p>Table variables, 53, 275</p>
<p>Tablet, 117</p>
<p>TEMPORARY-PAGE, 215</p>
<p>TERMSESS, 154</p>
<p>TO, 211</p>
<p>TO-APPLICATION, 154</p>
<p>TO-LINE, 211</p>
<p>TO-TERMINAL, 157</p>
<p>TOVAR$, 217</p>
<p>FROM-FIELD, 217</p>
<p>FROM-INPUT, 218</p>
<p>FROM-VARIABLE, 218</p>
<p>Trace</p>
<p>VIRSV, 220</p>
<p>Transaction</p>
<p>Passe-Partout, 21</p>
<p>Universal HTTP, 21</p>
<p>TRANSACTION, 215</p>
<p>TRIMMED-VALUE-OF, 54</p>
<p>TSO</p>
<p>File transfer, 125</p>
<p>Universal Transaction, 21</p>
<p>UNSET-LOCAL-OPTIONS, 52</p>
<p>Upload</p>
<p>Batch cURL, 102</p>
<p>Uploading HTML pages, 85</p>
<p>URL</p>
<p>Query parameters, 17, 162, 163, 213</p>
<p>URL-ENCODING, 216</p>
<p>UseCookieSession, 19</p>
<p>USER-SECURITY-PROFILE, 169</p>
<p>USER-SIGNON-CODE, 65</p>
<p>ValidateVirtelSession, 18</p>
<p>VALID-PFKEYS, 48</p>
<p>VALUE-OF, 168, 174</p>
<p>VALUE-TO-SCREEN, 172</p>
<p>VALUE-TO-VARIABLE, 172</p>
<p>Variable</p>
<p>Table, 53, 182, 275</p>
<p>Variables</p>
<p>$ERRMSG$, 300</p>
<p>VARIABLE-TO, 212</p>
<p>VARIABLE-TO-LINE, 212</p>
<p>VARIABLE-TO-SCREEN, 173</p>
<p>VARIABLE-TO-SYSTEM, 174</p>
<p>VerifyVirtelSession, 18</p>
<p>Example, 230</p>
<p>VIRSV, 219</p>
<p>Example, 232</p>
<p>VIRSV$, 219</p>
<p>VIRSVFIO, 163, 190</p>
<p>VIRTEL Suggest, 227</p>
<p>VIRTEL Web Access, 9</p>
<p>VIRTEL Web Integration, 10</p>
<p>VIRTEL Web Modernisation, 10</p>
<p>VirtelSession, 17</p>
<p>Virtual hosting, 312</p>
<p>VSVTRACE, 220</p>
<p>VWA, 9</p>
<p>VWI, 10</p>
<p>VWM, 10</p>
<p>W2H, 9</p>
<p>Web Access, 9</p>
<p>Settings, 105</p>
<p>Hiding, 115</p>
<p>Modifying, 113</p>
<p>Web Integration, 10</p>
<p>Web Modernisation, 10</p>
<p>WEB2HOST, 9</p>
<p>Web-to-Host, 9</p>
<p>Pages</p>
<p>Conditional generation, 61</p>
<p>Pages HTML</p>
<p>Creation, 27</p>
<p>Function keys, 47</p>
<p>Tags - ADD-TO-FIELDS, 42</p>
<p>Tags - ADVANCE-TO-NEXT-VALUE-OF, 55</p>
<p>Tags – AFTER-NOT-LAST-VALUE-OF, 61</p>
<p>Tags - AJAX-SESSION-CODE, 28</p>
<p>Tags - COPY-FROM, 33</p>
<p>Tags – COUNTRY-CODE, 69</p>
<p>Tags - CREATE-VARIABLE-FROM, 34, 35</p>
<p>Tags – CREATE-VARIABLE-IF, 63, 64</p>
<p>Tags - CURRENT-VALUE-OF, 53</p>
<p>Tags – DECLARE-FIELD-AS, 64, 67</p>
<p>Tags – DEFAULT-FIELD-WITH-CURSOR, 45</p>
<p>Tags - DEFINE-AUTOMATIC-COUNTER, 55</p>
<p>Tags – DEFINE-CURSOR-POSITION-FIELD, 44</p>
<p>Tags - DEFINE-DFHMDF-COLUMN, 37</p>
<p>Tags - DEFINE-DFHMDF-NAME, 36</p>
<p>Tags - DEFINE-HTML-FIELD, 35</p>
<p>Tags - DEFINE-HTML-FIELD-NAME, 35</p>
<p>Tags – DEFINE-HTML-FOCUS-FIELD, 44</p>
<p>Tags – DEFINE-HTML-PFKEY, 47</p>
<p>Tags - DEFINE-SUB-VARIABLE, 56</p>
<p>Tags - DELETE-ALL-VARIABLES, 56</p>
<p>Tags - DO-COUNT-UP-WITH, 55</p>
<p>Tags – ENCRYPTION-PARAMETERS, 66</p>
<p>Tags - END-DO-COUNT, 55</p>
<p>Tags - END-FOR, 55</p>
<p>Tags - FIELD-WITH-CURSOR, 45</p>
<p>Tags - FOR-EACH-VALUE-IN, 53</p>
<p>Tags - GENERATE-HTML, 32</p>
<p>Tags - GENERATE-VARIABLES, 38</p>
<p>Tags - GENERATE-VIR3270, 39</p>
<p>Tags – IF-PRINT-IS-READY, 78</p>
<p>Tags – IF-SECURITY-TOKEN-IS-READY, 77</p>
<p>Tags – IF-USER-IS-ALLOWED-TO, 61</p>
<p>Tags - INVALID-PFKEYS, 48</p>
<p>Tags – IP-ADDRESS-OF-LINE, 58</p>
<p>Tags – IP-PORT-OF-LINE, 58</p>
<p>Tags – NAME-OF, 59</p>
<p>Tags – NO-BLANKS-VALUE-OF, 54</p>
<p>Tags – NUMBER-OF, 60</p>
<p>Tags - ON-ATTRIBUTE, 40</p>
<p>Tags - ON-CHARACTER-ATTRIBUTE, 41</p>
<p>Tags - ON-END-OF-ATTRIBUTE, 41</p>
<p>Tags - ON-END-OF-CHARACTER-ATTRIBUTE, 42</p>
<p>Tags – PDF-LINES-PER-PAGE, 79</p>
<p>Tags – PDF-NEW-DOCOPT, 79</p>
<p>Tags – PDF-NEW-INPUT, 79</p>
<p>Tags – PDF-NEW-LAYOUT, 79</p>
<p>Tags – PDF-OUTLINE, 79</p>
<p>Tags – PDF-PAGE-BREAK, 80</p>
<p>Tags – PDF-USE-DOCOPT, 80</p>
<p>Tags – PDF-USE-LAYOUT, 80</p>
<p>Tags – PDF-VARIABLE, 80</p>
<p>Tags – POSITION-OF-THE-CURSOR, 46</p>
<p>Tags – PRINT, 78</p>
<p>Tags – PUBLIC-KEY, 67</p>
<p>Tags – SECURITY-TOKEN, 77</p>
<p>Tags - SESSION-CODE, 28</p>
<p>Tags – SET-CONTENT-TYPE, 74</p>
<p>Tags – SET-COUNTRY-CODE, 69</p>
<p>Tags – SET-HEADER, 75</p>
<p>Tags – SET-HTTP-RETURN-CODE, 72</p>
<p>Tags - SET-INITIAL-TIMEOUT, 28</p>
<p>Tags - SET-LOCAL-OPTIONS, 51, 67</p>
<p>Tags – SET-MAX-AGE, 73</p>
<p>Tags – SET-OUTPUT-ENCODING-UTF-8, 70</p>
<p>Tags – SET-PAGE-CACHEABLE, 73</p>
<p>Tags – SET-PAGE-NOT-CACHEABLE, 73</p>
<p>Tags – TRIMMED-VALUE-OF, 54</p>
<p>Tags - UNSET-LOCAL-OPTIONS, 52</p>
<p>Tags – USER-SIGNON-CODE, 65</p>
<p>Tags - VALID-PFKEYS, 48</p>
<p>Tags – WHEN-EXISTS, 61</p>
<p>Tags – WHEN-NEXT-EVENT, 62</p>
<p>Tags – WHEN-NOT-BLANK, 62</p>
<p>Tags – WHEN-NOT-EXISTS, 62</p>
<p>Tags – WHILE-EVENT, 62</p>
<p>Pages XML</p>
<p>Creation, 27</p>
<p>Security, 297</p>
<p>WHEN-EXISTS, 61</p>
<p>WHEN-NEXT-EVENT, 62</p>
<p>WHEN-NOT-BLANK, 62</p>
<p>WHEN-NOT-EXISTS, 62</p>
<p>WHILE-EVENT, 62</p>
<p>XML</p>
<p>Commarea-to-XML conversion, 217</p>
<p>Example</p>
<p>Input, 237</p>
<p>Output, 243</p>
<p>Input, 188</p>
<p>Pages</p>
<p>Creation, 27</p>
<p>Tags VIRTEL, 27</p>
<p>Parser/Generator, 245</p>
<p>XML-to-commarea conversion, 188, 237</p>
<table class="docutils footnote" frame="void" id="id209" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id182">[1]</a></td><td>FLECS is a multi-criteria application generator from Syspertec
Communication.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id210" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id204">[2]</a></td><td>HOST4WEB commands are available from VIRTEL 4.28 onwards.</td></tr>
</tbody>
</table>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Connectivity/index.html" class="btn btn-neutral float-right" title="Virtel connectivity Guide" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../Install/index.html" class="btn btn-neutral" title="Virtel Installation Guide" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Syspertec. All rights reserved.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>