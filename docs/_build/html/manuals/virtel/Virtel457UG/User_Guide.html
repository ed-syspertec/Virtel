

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User Guide V4.57 &mdash; Virtel 7 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'7',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Connectivity Reference V4.58" href="../Virtel458CN/connectivity_guide.html" />
    <link rel="prev" title="Migration Guide V4.57" href="../Virtel457MI/Migration_Guide.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Virtel
          

          
            
            <img src="../../../_static/logo_virtel_web.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                4.57
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../virtel.html">Virtel Manuals</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../virtel.html#v4-53">V4.53</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../virtel.html#v4-56">V4.56</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../virtel.html#v4-57">V4.57</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../Virtel457AP/audit_operations_ and_performance.html">Audit, Administration, Operations and Performance V4.57</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Virtel457CN/connectivity_guide.html">Connectivity Reference V4.57</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Virtel457IG/Installation_Guide.html">Installation Guide V4.57</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Virtel457MG/messages.html">Messages V4.57</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Virtel457MI/Migration_Guide.html">Migration Guide V4.57</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">User Guide V4.57</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-virtel-engine">The Virtel Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#outgoing-calls">Outgoing Calls</a></li>
<li class="toctree-l4"><a class="reference internal" href="#programming-interfaces">Programming Interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#incoming-calls">Incoming Calls</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ug-security">Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="#howtos">HOWTOs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#appendix">Appendix</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../virtel.html#v4-58">V4.58</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../newsletters.html">Technical Newsletters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../howto.html">Miscellaneous</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Virtel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../virtel.html">Virtel Manuals</a> &raquo;</li>
        
      <li>User Guide V4.57</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/manuals/virtel/Virtel457UG/User_Guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="user-guide-v4-57">
<span id="virtel457ug"></span><h1>User Guide V4.57<a class="headerlink" href="#user-guide-v4-57" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="../../../_images/logo_virtel_web12.png"><img alt="image1" src="../../../_images/logo_virtel_web12.png" style="width: 275.0px; height: 102.0px;" /></a></p>
<p><strong>VIRTEL User Guide</strong></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is a draft version of the document.</p>
</div>
<p>Version : 4.57</p>
<p>Release Date : 08 Jan 2018. Publication Date : 08/01/2018</p>
<p>Syspertec Communication</p>
<p>196, Bureaux de la Colline 92213 Saint-Cloud Cedex Tél. : +33 (0) 1 46 02 60 42</p>
<p><a class="reference external" href="http://www.syspertec.com/">www.syspertec.com</a></p>
<p>NOTICE</p>
<blockquote>
<div><p>Reproduction, transfer, distribution, or storage, in any form, of all or any part of
the contents of this document, except by prior authorization of SysperTec
Communication, is prohibited.</p>
<p>Every possible effort has been made by SysperTec Communication to ensure that this document
is complete and relevant. In no case can SysperTec Communication be held responsible for
any damages, direct or indirect, caused by errors or omissions in this document.</p>
<p>As SysperTec Communication uses a continuous development methodology; the information
contained in this document may be subject to change without notice. Nothing in this
document should be construed in any manner as conferring a right to use, in whole or in
part, the products or trademarks quoted herein.</p>
<p>“SysperTec Communication” and “VIRTEL” are registered trademarks. Names of other products
and companies mentioned in this document may be trademarks or registered trademarks of
their respective owners.</p>
</div></blockquote>
<p>What’s new in Virtel 4.57</p>
<p><em>VIRTEL Web Access:</em></p>
<ul class="simple">
<li>Bidirectional presentation support.</li>
<li>Enhanced font stretch mode. Optimization of screen size.</li>
<li>Additional RACHECK support for ForceLUNAME</li>
<li>Licence warning feature</li>
<li>Enhancements to USSMSG10 support module</li>
<li>Enhancements to Virtel Web Macro interface (VWM)<ul>
<li>Keyboard mapping enhancements</li>
</ul>
</li>
<li>Enhancements to Virtel Dynamic Directories Interface (DDI)<ul>
<li>Hotkey support for DDI macros</li>
<li>New refresh options.</li>
</ul>
</li>
</ul>
<p><em>VIRTEL Web Modernisation &amp; Integration:</em></p>
<ul class="simple">
<li>Enhancements to COPY$ NAME-OF. Support for TERMINAL, GROUP and RELAY items.</li>
<li>Enhancements to DEFAULT-FILED-WITH-CURSOR statement.</li>
</ul>
<p><em>Miscellaneous:</em></p>
<ul class="simple">
<li>Customizable HELP solution.</li>
<li>DNS access to resolve IP address or DNS name.</li>
<li>TCT option to support mixed case passwords</li>
<li>Additional language support</li>
<li>Batch export/import of RAW TRSF files.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For further details see the Technical Newsletter: TN201706 - What’s new in Virtel 4.57.</p>
</div>
<div class="section" id="the-virtel-engine">
<h2>The Virtel Engine<a class="headerlink" href="#the-virtel-engine" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<div class="section" id="what-is-virtel">
<span id="index-0"></span><h4>What is Virtel<a class="headerlink" href="#what-is-virtel" title="Permalink to this headline">¶</a></h4>
<p>Simply put, Virtel is a host-based protocol converter that runs as a started task on the mainframe. At the core of Virtel is the Virtel Engine which sits between host applications and external environments such as the web or another external server. Virtel supports the following standard protocol - TCP/IP, SMTP, HTTP/S, SOAP, MQ-SERIES, SNA, 3270, ICAL (IMS) and the inherited protocols - X25, XOT, XTP, LU 6.2 to interface between host applications and external services. A classic example for Virtel would be interfacing between legacy 3270 applications, running on the host, and the web. Virtel would provide protocol conversion between data arriving from the browser is converted into a 3270 data-stream and sent to the application. Users would no longer require 3270 terminal emulators products to interface with legacy host applications. Access can now be provided through the users standard web browser. Various character code page sets are supported, including DBCS character code sets.</p>
<p>The following diagram illustrates some of the protocols and applications supported by the Virtel Engine.</p>
<p><img alt="image0" src="../../../_images/overview.png" />
<em>The Virtel Engine</em></p>
<p>Virtel provides three models. Web Access (VWA/W2H), Web Modernisation (VWM) and Web Integration (VWI). In the next section each model is described in detail. Regardless of the model, Virtel’s mainframe requirements are the same. The basic file requirements are as follows:-</p>
<blockquote>
<div><ul class="simple">
<li>SAMP TRSF VSAM File. Contains the templates and web artefacts (JavaScript, Images, HTML, CSS elements etc.) which are served to the browser.</li>
<li>HTML TRSF VSAM File. Contains user customisation web artefacts (JavaScript, HTML, Images, HTML, CSS elements etc.)</li>
<li>LOADLIB PDS.         Virtel load library</li>
<li>ARBO VSAM File.      Contains customer configuration data.</li>
<li>Ancillary files.     Statistics, logs, tracing etc.</li>
</ul>
</div></blockquote>
<p>Virtel normally runs as a started task on the mainframe. Multiple instances of Virtel can be run on the same LPAR and can run within a SYSPLEX environment, benefiting from the load balancing services that such environments provide. See the Virtel Installation manual for a full description of the Virtel mainframe requirements. Virtel can also be run as a batch process, providing a “batch” service between external servers. See the section <a class="reference internal" href="#ug-virtel-batch"><span class="std std-ref">Virtel Batch</span></a> or the Virtel Connectivity Manual for further information on running Virtel in batch.</p>
<p>Like any other web page servers Virtel responds to an incoming URL and serves template pages. The URL targets one of the TCPIP ports that Virtel is listening on. The URL will identify the IP address of the z/OS environment, and the port address will target the Virtel Instance. The pathname and parameters of the URL will identify the Virtel Transaction that will be used to process the URL request. A URL example is shown below. This is a URL requesting a connection to a CICS application called SPCICS. SPCICS is the name of the Virtel transaction that will deal with the request. The pathname “/w2h/WEB2AJAX.htm” identifies a Virtel 3270 template that will be used to support the transaction, providing the framework to convert between 3270 data-stream and HTML presentations.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">170.33</span><span class="p">:</span><span class="mi">41002</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">WEB2AJAX</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">SPCICS</span>
</pre></div>
</div>
<p>For more information on the Virtel URL formats see the section <a class="reference internal" href="#ug-url-formats"><span class="std std-ref">Virtel URL Formats</span></a>.</p>
</div>
<div class="section" id="virtel-web-access-vwa">
<span id="index-1"></span><h4>VIRTEL Web Access (VWA)<a class="headerlink" href="#virtel-web-access-vwa" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL Web Access, formerly known as “Web-to-Host” (W2H), is a set of functions which provides access to mainframe 3270 legacy applications via the user’s browser window. In the VWA model the Virtel Engine comprises of two components, a HTTP server and a VTAM component serving the back-end VTAM legacy applications, pertaining to operate as an LU2 device(s).</p>
<p>The principle operation of VWA is the production and delivery of 3270 data-streams as HTML pages. Static template page and web elements supporting VWA are stored and maintained in a Virtel directory on the mainframe at the host site. The pages served to the browser contain standard HTML tags, CSS, JavaScript elements and HTML tags specific to VIRTEL. Invoked by a browser or a program, these pages form the basis of an “on the fly” translation of 3270 data-streams, thus enabling the dynamic generation and delivery of a 3270 presentation to the browser. No terminal emulation software is required. The VWA model also includes functions which allow dynamic modification of the original 3270 presentation, with the aim of making the interface as “clickable” as possible. This chapter describes the set of functions required to support VWA and presupposes a certain knowledge Web technologies and HTML page construction.</p>
<p>Some fundamental differences to standard terminal emulation protocol must be taken into consideration:</p>
<ol class="arabic simple">
<li>Sessions between a browser and the Virtel HTTP server are in disconnected mode, while they are in connected mode between VIRTEL VTAM component and the host application.</li>
<li>The flow of information between the Virtel HTTP server and a client’s browser occurs on the initiative of the client or through an optional ‘Long Poll’ asynchronous session.</li>
<li>A single request from the browser will only invoke a single response from the HTTP server, while the transmission of a message to an application on the host may generate several response messages at once (for example, a message to clear the screen followed by a new screen image).</li>
</ol>
<p>These differences give rise to a need to ensure maintenance of session context between a client and a host application. This is done by the <span class="target" id="index-2"></span>SESSION-CODE tag embedded in the Virtel template pages. Although the HTML pages used to display 3270 data contain specific VIRTEL tags, these pages can be developed using standard web development tools. The pages containing VIRTEL specific tags are stored in a VIRTEL directory along with other Virtel web elements such as Java Script modules, CSS style sheets and images. The VIRTEL directory, known as the W2H directory, is located in the VSAM SAMP.TRSF file.</p>
<p>Let’s look at how VWA works.</p>
<p><img alt="vwa_overview" src="../../../_images/vwa_overview.png" />
<em>VWA Overview</em></p>
<ol class="arabic simple">
<li>The user enters a URL which points to the Virtel Engine. In this case <em>http:www.myHost.com/WEB2AJAX+TSO5</em>. Virtel, running as a web server, will be listening on default port 80 for any incoming calls. When Virtel receives the call-in it will process the pathname of the URL (<em>/WEB2AJAX+TSO5</em>) to determine a course of action.</li>
<li>The pathname /WEB2AJAX+TSO identifies a Virtel HTML page TEMPLATE (WEB2AJAX) and a transaction. In this case the transaction is TSO. Virtel, through its configuration, recognizes the TSO transaction as being a VTAM application and initiates a VTAM session with TSO.</li>
<li>A VTAM connection is established between TSO and Virtel with Virtel acting as a virtual terminal relay between the browser and TSO. Subsequent HTML pages received from the browser will now be converted to 3270 data streams and will be sent to TSO as if they had come from a 3270 terminal. 3270 data streams sent by the TSO application will be converted into HTML pages using the WEB2AJAX template and sent to the browser.</li>
<li>TSO responds to the session request and sends a 3270 screen to Virtel.</li>
<li>Virtel, acting as a SLU in the VTAM session, receives the 3270 data stream from the host and constructs a HTML web-page incorporating the 3270 data. It uses the HTML page WEB2AJAX.HTML as a template. Virtel pages are maintained in the W2H directory located within the SAMP.TRSF VSAM file.</li>
<li>The constructed HTML page is sent to the users browser.</li>
<li>The browser displays the page created by Virtel which will resemble a 3270 screen.</li>
</ol>
<p>Features of Virtels VWA Presentation</p>
<p>A sophisticated and rich set of features are available with VWA through the use of the tool bar. Configuration of the tool-bar is also possible. The following list summarizes the tool-bar features presented with the standard VWA 3270 template:-</p>
<p><img alt="vwa_example" src="../../../_images/vwa_example.png" />
<em>VWA 3270 Example</em></p>
<blockquote>
<div><ul class="simple">
<li>Keyboard Controls. A user can send a variety of keyboard functions, such as PA2, ATTN, etc. through the keyboard control.</li>
<li>IND$FILE support.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The IND$FILE function must not be considered as a replacement for a FTP client/server architecture. Sending or receiving large files across this interface could result in performance issues. Virtel provides a means of restricting file transfer sizes to avoid such a situation.</p>
</div>
<ul class="simple">
<li>Screen capture controls which provide a variety of capture options including 1/2/3 page-up images within a single capture buffer.</li>
<li>User setting controls enables an individual user to set their own Virtel controls and preferences.</li>
<li>Macro Support. Enables a user to create macros to drive screen logic and repetitive tasks.</li>
<li>Configurable help panels. Bespoke help panels can be developed to support business applications.</li>
<li>Language support. Virtel supports a variety of different languages.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="virtel-web-modernisation-vwm">
<span id="index-3"></span><h4>VIRTEL Web Modernisation (VWM)<a class="headerlink" href="#virtel-web-modernisation-vwm" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL Web Modernisation, formerly known as “Host-Web-Services” (HWS), allows the presentation of 3270 host applications to be modified, without modifying the application itself. The presentation can be adapted to a format (HTML, XML, Excel, etc.) suited to the requester, while hiding the details of navigation within the 3270 transactions.</p>
<p>This function is implemented through a combination of the VIRTEL Web Access functions described in <a class="reference internal" href="#ug-creating-html"><span class="std std-ref">Creating HTML and XML templates</span></a>, and the Virtel scenario language described in <a class="reference internal" href="#ug-virtel-scenarios"><span class="std std-ref">Web Modernisation VIRTEL Scenarios</span></a>.</p>
<p>VIRTEL Web Modernisation allows “frozen” or “untouchable” 3270 transactions to be accessed by intermediate servers (n-tier architecture) or from a browser, while hiding the details of     navigation within the transactions. Variable input data for the transaction can either be included in the URL (GET method), or sent as data with the HTTP request (POST method).</p>
<p>With modernisation, for example, several 3270 round trips can be made to the host application within a presentation scenario before returning the final result to the browser. Data could be extracted from the individual host responses and encapsulated into one HTML page. For example when a user requests a “list” this could result in a sequence of key strokes and displays between the application and Virtel. Taking the example:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">User</span> <span class="n">enters</span> <span class="s2">&quot;ASMITH&quot;</span> <span class="ow">in</span> <span class="n">CICS</span> <span class="n">MAP</span> <span class="k">as</span> <span class="n">a</span> <span class="n">search</span> <span class="n">operand</span><span class="o">.</span> <span class="n">Presses</span> <span class="n">Enter</span><span class="o">.</span>
<span class="n">First</span> <span class="n">Screen</span> <span class="n">returned</span><span class="o">.</span>
<span class="n">User</span> <span class="n">press</span> <span class="n">PFK8</span> <span class="n">to</span> <span class="n">obtain</span> <span class="nb">next</span> <span class="n">screen</span><span class="o">.</span>
<span class="n">Second</span> <span class="n">screen</span> <span class="n">returned</span><span class="o">.</span>
<span class="n">User</span> <span class="n">press</span> <span class="n">PFK8</span> <span class="n">to</span> <span class="n">obtain</span> <span class="nb">next</span> <span class="n">screen</span><span class="o">.</span>
<span class="n">Third</span> <span class="n">screen</span> <span class="n">returned</span><span class="o">.</span> <span class="n">Last</span> <span class="ow">in</span> <span class="n">sequence</span><span class="o">.</span>
</pre></div>
</div>
<p>The above business logic i.e. “search for a name” can be incorporated into a Virtel Scenario as illustrated in the diagram below. We have called the scenario GETDATA. The user enters the search argument “ASMITH” and presses Enter. The HTML request is sent to Virtel. The HTML request, based upon the submitted URL, is targeted towards transaction CUSTDATA which is a VTAM application transaction associated with CICS6, a legacy CICS application. The CUSTDATA Virtel transaction is defined with scenario GETDATA. This configuration data is maintained in the VIRTEL ARBO file.</p>
<p>When the user submits the URL from the browser Virtel will establishe a VTAM session with CICS6 and then will continue to run the scenario GETDATA. The scenario contains the business logic which will perfom the key stokes to obtain all the relevant data from multiple 3270 screens. The scenario will then build a modernised web page which will contain a GUI “drop down list” encapsulating all data obtained from the three 3270 CICS displays. The HTML response is sent back to the user.</p>
<p>The user has entered only one keystroke to submit the transaction and received one response. The data within the HTML response will represent all the data extracted from several 3270 displays. The response data will be presented in a “modernised” GUI fashion.</p>
<p><img alt="vwm_overview" src="../../../_images/vwm_overview.png" />
<em>VWM Overview</em></p>
<ol class="arabic simple">
<li>The user enters a URL which identifies the Virtel transaction CUSTDATA.</li>
<li>The configuration data for the transaction CUSTDATA is loaded from the Virtel Configuration repository held within the Virtel ARBO VSAM dataset. The transaction CUSTDATA has a scenario associated with it called GETDATA.</li>
<li>The GETDATA scenario is then used to navaigate through 3270 screens, collecting data from each screen.</li>
<li>The scenarion builds a “clickable” GUI template using the data extracted from the three 3270 screens. The template is presented to the browser.</li>
<li>The user has a modernised version of the original 3270 presentation incorporating a GUI drop down from which they can navigate to the next sceen. A master/detail pattern has been deployed by the Virtel scenario, presenting the user with data from three separate 3270 screens. Modernisation improves the users UX/UI presentation experince and by doing so enhances and improvers navigation of the legacy business logic. Less network transfer is consumed as the number of original 3270 screens is consolidated into one Virtel GUI master/detail screen.</li>
</ol>
</div>
<div class="section" id="virtel-web-integration-vwi">
<span id="index-4"></span><h4>VIRTEL Web Integration (VWI)<a class="headerlink" href="#virtel-web-integration-vwi" title="Permalink to this headline">¶</a></h4>
<p>The objective of VIRTEL Web Integration, formerly known as  “Host-for-Web” (H4W), is to allow a host application to take maximum control of its web interface, for example through web services. This is in complete contrast to VWA/VWM, whose objective is to avoid modification of host applications.</p>
<p>To control its web interface, an application has at its disposal primarily the 3270 screen, the VIRTEL table variable facility, the HTML page template, and a set of VIRTEL commands contained in structured fields. Additionally, for browser requests which enter VIRTEL using an entry point which specifies emulation type “HOST4WEB”, the application can also use a set of VIRTEL control commands which can be embedded in the 3270 screen via a BMS map, ISPF panel, or 3270 data stream. These HOST4WEB commands, available from VIRTEL version 4.28 onwards, provide the same general functions as the structured field commands in earlier versions.</p>
<p>Table variables, structured field commands, and HOST4WEB commands, are sent by the application to the 3270 session using standard methods (EXEC CICS SEND, ISPEXEC DISPLAY PANEL, TSO TPUT, etc). VIRTEL intercepts and acts upon these commands, for example by selecting the page template or loading data which can be referenced by VIRTEL orders embedded in the page templates and used to build lists of values or data tables.</p>
<p>VMI enables an application to create a dynamic dialog between its transactions and web applications through the creation of interactive bidirectional dialogs across the Internet between host (CICS, IMS, Ideal, Natural, etc.) and server-based applications using XML/HTML web services or other communication procedures.</p>
<p><strong>Incoming and outgoing Web Services Support</strong></p>
<p>Incoming calls</p>
<blockquote>
<div><ul class="simple">
<li>To expose host applications to web clients though web services, Virtel can be configured to:</li>
<li>Receive and parse incoming web service calls</li>
<li>Execute the appropriate transactions</li>
<li>Receive data returned by the transactions in the form of screens, structured fields, COMMAREA, or database segments</li>
<li>Reformat and wrap that data with XML, JSON, HTML, SOAP, CSV, PDF, Word, JSON, etc.</li>
<li>Serve it back to the web callers</li>
</ul>
</div></blockquote>
<p>Outgoing calls</p>
<blockquote>
<div><ul class="simple">
<li>In the outgoing direction (host-initiated web services) the mechanism is the same, just reverse.</li>
</ul>
</div></blockquote>
<p>VWI can be configured to support a wide range of interfaces, protocols and APIs which can :-</p>
<blockquote>
<div><ul class="simple">
<li>Expose mainframe applications and data as web services to web clients</li>
<li>Invoke web services for the count of mainframe applications</li>
<li>Support interactive exchange procedures between mainframe and web applications for cooperative work</li>
<li>Function as a SOAP, MQ, PHP… server</li>
<li>Transfer data blocks larger than 32KB, or blocks of data with variable format</li>
<li>Convert data from DBCS (Double Byte Character Set) used by Japanese, Chinese, Russian… workstations or applications to EBCDIC, and vice/versa</li>
<li>Serve 3270 data as international icons to eliminate natural languages from user interfaces</li>
<li>Replace web connectors developed by IBM (CWS, CTG, HOD, IMS Connect, etc) and ISVs, or home-grown (CICS socket programming)</li>
</ul>
</div></blockquote>
<p><img alt="vwi_overview" src="../../../_images/vwi_overview.png" />
<em>VWI Overview</em></p>
<p>For more information, refer to the chapter <a class="reference internal" href="#ug-programming-interfaces"><span class="std std-ref">“Programming Interfaces”</span></a>.</p>
<span class="target" id="ug-service-transactions"></span></div>
<div class="section" id="virtel-service-transactions">
<span id="index-5"></span><h4>VIRTEL Service Transactions<a class="headerlink" href="#virtel-service-transactions" title="Permalink to this headline">¶</a></h4>
<p>A Service Transaction is a long-running VIRTEL transaction which maintains a session with a host application and uses this session to serve a series of HTTP request / responses. Unlike a regular HTTP transaction, which serves requests only from its originating user, identified by a specific VIRTEL SESSION-CODE, a service transaction can serve a different user each time it processes an HTTP request. Service transactions are typically used to provide fast access to public information such as the lists of field values displayed by the “VIRTEL Suggest” feature.</p>
<p>A service transaction is started by an HTTP URL in exactly the same way as a regular transaction, but when it has finished processing its first HTTP request, it indicates its readiness to serve another user, either by means of the script command &amp;) described under the heading “Transactions — Connection / Disconnection Scripts” in the VIRTEL Connectivity Reference documentation, or by means of the <a class="reference internal" href="#ug-action-serve-another-users"><span class="std std-ref">ACTION$ SERVE-ANOTHER-USER</span></a> command in a scenario.</p>
<p>A service transaction remains connected to the host application between input messages. It is then eligible to process any HTTP request which specifies the same entry point and transaction name. Since service transactions can potentially be used by many different users, a typical service transaction will provide information which is not sensitive to being signed-on as a particular user.</p>
<span class="target" id="ug-url-formats"></span></div>
</div>
<div class="section" id="virtel-url-formats">
<span id="index-6"></span><h3>VIRTEL URL Formats<a class="headerlink" href="#virtel-url-formats" title="Permalink to this headline">¶</a></h3>
<div class="section" id="static-pages">
<h4>Static pages<a class="headerlink" href="#static-pages" title="Permalink to this headline">¶</a></h4>
<p>Virtel locates static HTML pages through the URL passed to the Virtel Engine and the configuration definitions defined within the Virtel ARBO VSAM file. An endpoint for Virtel is defined by a Virtel line definition which identifies the TCP/IP port that Virtel listens on for incoming calls. By default Virtel uses two endpoints or ports, 41001 for Administration and port 41002 for user or client transactions. Each endpoint is associated with a default Entry Point; WEB2HOST in the case of 41001 and CLIWHOST for 41002. Transactions are associated with End Points. An endpoint can be associated with more than one Entry Point.  Virtel provides a Rule facility whereby an Entry Point can be selected by incoming call criteria - IP address for example.
<img alt="static_pages" src="../../../_images/static_pages.png" />
<em>Virtel Static Pages</em></p>
<p>Virtel stores pages and web elements within VIRTEL diretories located in TRSF VSAM files. The general form of the URL for an HTML page stored in a VIRTEL directory is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">pathname</span><span class="o">/</span><span class="n">pagename</span>
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Corresponds to the “Local ident” field of an HTTP line defined to
VIRTEL. The rules of the line are used to select the entry point.
This entry point, which must specify emulation type HTML, contains
the list of transactions which the user is authorized to invoke.</dd>
<dt>pathname</dt>
<dd>Represents a VIRTEL directory containing HTML pages or other elements. Refer to the section <a class="reference internal" href="#ug-how-the-path-name"><span class="std std-ref">“How the path name corresponds to a VIRTEL directory”</span></a> below for details of how the pathname is used to select the VIRTEL directory.</dd>
<dt>pagename</dt>
<dd>Is the name of an element (HTML page, etc.) in the specified
directory. VIRTEL converts the element name to upper case (unless
“case sensitive” is specified in the directory definition), and
truncates the name if necessary to the maximum length specified in
the directory definition (see <a class="reference internal" href="#ug-directory-management"><span class="std std-ref">“Directory Management”</span></a>).</dd>
</dl>
<p>VIRTEL also accepts certain abbreviated forms of the URL:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">pathname</span>
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
<dt>pathname</dt>
<dd>Represents a VIRTEL directory, as described above. In this case, VIRTEL loads a default page from this directory. The default page name is the same as the entry point name. Note: the trailing slash is compulsory.</dd>
</dl>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">pagename</span>
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
<dt>pagename</dt>
<dd>Is the name of a page to be loaded from the default directory. The
default directory corresponds to a default pathname equal to the
entry point name.</dd>
</dl>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span>
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
</dl>
<p>In this case, VIRTEL loads the default URL. VIRTEL obtains the default URL from the “TIOA at logon” field of the default transaction. The default transaction is a type 4 transaction which has the same name as the entry point. See example 7 below for an example of a default URL. If the “TIOA at logon” field of the default transaction is blank, then VIRTEL loads the default page from the default directory. The default page has the same name as the entry point, and the default directory corresponds to a default pathname equal to the entry point name.</p>
<span class="target" id="ug-how-the-path-name"></span></div>
<div class="section" id="how-the-path-name-corresponds-to-a-virtel-directory">
<span id="index-7"></span><h4>How the path name corresponds to a VIRTEL directory<a class="headerlink" href="#how-the-path-name-corresponds-to-a-virtel-directory" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>The pathname specified in a VIRTEL URL is used to select a VIRTEL
directory which contains HTML page templates and other elements such
as CSS stylesheets, JavaScript procedures, and GIF or JPEG images.
VIRTEL directories have a simple 8-character case-insensitive name,
whereas the pathname is expressed in Unix-style syntax (one or more
case-</p>
<p>sensitive components separated by slashes), as is conventional for
web applications. VIRTEL must therefore translate the Unix-style
pathname into a VIRTEL directory name.</p>
<p>The process of mapping a pathname to a VIRTEL directory name is
carried out by means of VIRTEL transactions which are defined under
the entry point selected for each request by the rules of the HTTP
line. The entry point contains both processing transactions
(application types 1, 2, and 3) and directory transactions
(application type 4).</p>
<p>To find the directory which corresponds to the pathname, VIRTEL
looks for a type 4 transaction whose external name matches the first
component of the pathname, and whose “Check URL prefix” field is
either blank or matches the start of the pathname. The name of the
VIRTEL directory is contained in the “Application name” field of the
first such matching transaction found under the entry point.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>The comparison of the first component of the pathname with the transaction external name is case insensitive, and if the first component of the pathname is longer than 8 characters, only the first 8 characters are compared.</li>
<li>The comparison of the beginning of the pathname against the transaction’s “Check URL prefix” field is case sensitive.</li>
<li>The “Check URL prefix” field may contain “%20” to represent a blank and “?” to ignore a character position.</li>
<li>If the “Check URL prefix” field is completely blank it is considered to match any pathname whose first component matches the transaction external name.</li>
</ul>
</div>
</div></blockquote>
<div class="section" id="examples">
<span id="index-8"></span><h5>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h5>
<p>Assume that entry point WEB2HOST contains the following transactions:</p>
<p><img alt="image67" src="../../../_images/image676.png" />
<em>Transactions under entry point WEB2HOST</em></p>
<p>In this example, transactions W2H-00, W2H-03*, W2H-05* are  “application type 4” (directory transactions). Other transactions, such as “application type 1” (processing transactions i.e. TSO, CICS, etc.) play no part in the directory selection process.</p>
<p>The figure below shows an example of the detail of a directory transaction:-</p>
<p><img alt="image68" src="../../../_images/image686.png" />
<em>Example of a directory transaction</em></p>
</div>
<div class="section" id="example-1-neither-pathname-nor-pagename-specified">
<h5>Example 1: Neither pathname nor pagename specified<a class="headerlink" href="#example-1-neither-pathname-nor-pagename-specified" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span>
</pre></div>
</div>
<p>The pathname defaults to the entry point name, WEB2HOST, which  matches transaction W2H-00. The pagename also defaults to WEB2HOST.  VIRTEL therefore fetches page WEB2HOST from the directory W2H-DIR.</p>
</div>
<div class="section" id="example-2-pagename-specified">
<h5>Example 2: pagename specified<a class="headerlink" href="#example-2-pagename-specified" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">menu</span><span class="o">.</span><span class="n">htm</span>
</pre></div>
</div>
<p>The pathname defaults to the entry point name, WEB2HOST, which matches transaction W2H-00. VIRTEL therefore fetches page menu.htm from the directory W2H-DIR.</p>
</div>
<div class="section" id="example-3-pathname-specified">
<h5>Example 3: Pathname specified<a class="headerlink" href="#example-3-pathname-specified" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">user</span><span class="o">/</span>
</pre></div>
</div>
<p>The pathname /w2h/user matches transaction W2H-04. The pagename defaults to the entry point name, WEB2HOST. VIRTEL therefore fetches page WEB2HOST from the directory USR-DIR.</p>
</div>
<div class="section" id="example-4-pathname-and-pagename-specified">
<h5>Example 4: Pathname and pagename specified<a class="headerlink" href="#example-4-pathname-and-pagename-specified" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>The pathname /w2h/user matches transaction W2H-03U. VIRTEL therefore fetches page index.html from the directory USR-DIR.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user3</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
</div>
<div class="section" id="example-5-undefined-pathname-specified">
<h5>Example 5: Undefined pathname specified<a class="headerlink" href="#example-5-undefined-pathname-specified" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">badpath</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>In this case the pathname /w2h/badpath does not match any transaction. VIRTEL therefore rejects the request.</p>
</div>
<div class="section" id="example-6-partly-defined-pathname-specified">
<h5>Example 6: Partly-defined pathname specified<a class="headerlink" href="#example-6-partly-defined-pathname-specified" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">SECURE</span><span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">myPage</span><span class="o">.</span><span class="n">html</span>
</pre></div>
</div>
<p>The pathname /SECURE/misc is not specifically defined to VIRTEL. However there is a transaction W2H-02 whose external name is SECURE and whose “Check URL prefix” field is blank, which matches all     pathnames whose first component is /SECURE. VIRTEL therefore fetches the any /SECURE/misc/myPage.html from the designated directory W2H-DIR.</p>
</div>
<div class="section" id="example-7-entry-point-with-default-url">
<h5>Example 7: Entry point with default URL<a class="headerlink" href="#example-7-entry-point-with-default-url" title="Permalink to this headline">¶</a></h5>
<p>When a user connects to a VIRTEL line without specifying either pathname or pagename, as in the example below, the entry point may be configured to redirect the request to a default URL:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span>
</pre></div>
</div>
<p>A default URL may be specified in the transaction whose external name is the same as the entry point name. In the example type 4 transaction CLI-00 shown below, the default URL for the entry point CLIHOST is //w2h/appmenu.htm+applist and thus the URL</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span>
</pre></div>
</div>
<p>is processed by VIRTEL as if</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">//</span><span class="n">w2h</span><span class="o">/</span><span class="n">appmenu</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">applist</span>
</pre></div>
</div>
<p>had been specified.</p>
<p><img alt="image69" src="../../../_images/image694.png" /> <em>Example of a default transaction with default URL</em></p>
<p>The entry point CLIWHOST can access the w2h directory through a directory definition specifing the external directory path as an external name in the transaction. Here the transaction needs access to web elements located in the W2H-DIR. The /w2h/ pathname in w2h/appmenu.htm matches the external name of the directory transaction CLI-03W. This match defines a path to the W2H-DIR:-</p>
<p><img alt="image70" src="../../../_images/image703.png" /> <em>Providing access to a directory through a transactions external name</em></p>
</div>
</div>
<div class="section" id="dynamic-pages">
<span id="index-9"></span><h4>Dynamic pages<a class="headerlink" href="#dynamic-pages" title="Permalink to this headline">¶</a></h4>
<p>The general form of the URL for a VIRTEL Web Access, VIRTEL Web Integration, or VIRTEL Web Modernisation transaction is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">pathname</span><span class="o">/</span><span class="n">pagename</span><span class="o">+</span><span class="n">tranname</span>
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
<dt>pathname</dt>
<dd>Represents a VIRTEL directory, as described earlier.</dd>
<dt>pagename</dt>
<dd>Is the name of an element (HTML or XML) in the specified directory.
This name may be converted to upper case and truncated to the
maximum length defined in the directory definition, as previously
described. This element is used as the “template page” into which
VIRTEL inserts dynamic data.</dd>
<dt>tranname</dt>
<dd>Is the external name of a transaction defined under the entry point.
The application program (which may be a CICS transaction or other
VTAM application, a VIRTEL sub-application, or an external server)
invoked by this transaction provides the dynamic data which VIRTEL
inserts into the template page.</dd>
</dl>
<span class="target" id="ug-dynamic-url"></span><div class="section" id="dynamic-url-with-userdata">
<span id="index-10"></span><h5>Dynamic URL with userdata<a class="headerlink" href="#dynamic-url-with-userdata" title="Permalink to this headline">¶</a></h5>
<p>A second form of URL allows user data to be passed to VIRTEL:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">pathname</span><span class="o">/</span><span class="n">pagename</span><span class="o">+</span><span class="n">tranname</span><span class="o">+</span><span class="n">userdata</span>
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
<dt>pathname</dt>
<dd>Represents a VIRTEL directory, as described earlier.</dd>
<dt>pagename</dt>
<dd>Is the name of a template page, as before.</dd>
<dt>tranname</dt>
<dd>Is the name of the transaction which provides the dynamic data for
the template page.</dd>
<dt>userdata</dt>
<dd>Is a character string which can be tested by the “User Data” field in the rules of the HTTP line (see “Rules” in the VIRTEL Connectivity Reference documentation). This allows the administrator to assign an entry point to the request based upon the contents of the userdata in the URL. The userdata also becomes the value of the “routing parameter” associated with the tranname transaction. The routing parameter can be referenced by the variable &amp;1 in the “TIOA at logon” field of the tranname transaction (see “Defining transaction parameters” in the VIRTEL Connectivity Reference documentation). Additionally, if the rule which is selected specifies “$URL$” in its “Parameter” field, <strong>and only if</strong> the HTTP terminal relays are defined in a logical pool (see “HTTP Terminals” under the heading “Definition of an HTTP line” in the VIRTEL Connectivity Reference documentation), then the routing parameter is used by VIRTEL to select a relay LU for the tranname transaction.</dd>
</dl>
</div>
<div class="section" id="dynamic-url-with-parameters">
<span id="index-11"></span><h5>Dynamic URL with parameters<a class="headerlink" href="#dynamic-url-with-parameters" title="Permalink to this headline">¶</a></h5>
<p>A third form of URL allows one or more parameters to be passed to a transaction by means of an “Input Scenario” or by a “Connection / Disconnection Script”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://ipaddr:port/pathname/pagename+tranname?param1=value&amp;param2=value
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
<dt>pathname</dt>
<dd>Represents a VIRTEL directory, as described earlier.</dd>
<dt>pagename</dt>
<dd>Is the name of a template page, as before.</dd>
<dt>tranname</dt>
<dd>Is the name of the transaction which provides the dynamic data for
the template page. This transaction must be defined with the name of
a presentation module in its “Output Scenario” field.</dd>
<dt>param1, param2, …</dt>
<dd>These are the names of the parameters which the scenario can pick up using
the COPY$ INPUT-TO-VARIABLE or COPY$ INPUT-TO-SCREEN instructions
(described 153) or which can be substituted in a script by means of
the &amp;=paramn= system variable (see “Transactions – Connection /
Disconnection Scripts” in the VIRTEL Connectivity Reference
documentation. The cumulative length of the URL parameters is
limited by the BUFSIZE parameter of the VIRTCT. If blanks or other
special characters are required in the parameter value, then the
special characters must be coded in the standard URL escape format
%xx where xx is the hexadecimal value of the character in ASCII. For
example, a blank is represented as %20.</dd>
</dl>
</div>
<div class="section" id="dynamic-url-with-userdata-and-parameters">
<h5>Dynamic URL with userdata and parameters<a class="headerlink" href="#dynamic-url-with-userdata-and-parameters" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div>A URL may contain both userdata and query parameters, as shown in
the following example. The various components of the URL have the
same meaning as described in the preceding two sections.</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://ipaddr:port/pathname/pagename+tranname+userdata?param1=value&amp;param2=value
</pre></div>
</div>
<span class="target" id="ug-session-management"></span></div>
</div>
<div class="section" id="session-management">
<span id="index-12"></span><h4>3270 session management<a class="headerlink" href="#session-management" title="Permalink to this headline">¶</a></h4>
<div class="section" id="virtelsession-parameter">
<h5>VirtelSession parameter<a class="headerlink" href="#virtelsession-parameter" title="Permalink to this headline">¶</a></h5>
<p>Once a session has been established with the host 3270 application, the template page allows the user to link to the next screen in the 3270 application dialog by means of a URL in the following format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">pathname</span><span class="o">/</span><span class="n">pagename</span><span class="o">++</span><span class="n">VirtelSession</span><span class="o">=</span><span class="n">sessionid</span>
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
<dt>pathname</dt>
<dd>Represents a VIRTEL directory, as described earlier.</dd>
<dt>pagename</dt>
<dd>Is the name of the template page to be used for displaying the next
3270 screen (usually the same as the current template page).</dd>
<dt>sessionid</dt>
<dd>Is a VIRTEL-generated code which allows VIRTEL to identify the user as being already connected to an existing host session. The parameter VirtelSession=sessionid is inserted by the
<em>{{{SESSION-CODE}}}</em> tag embedded in the template page (see <a class="reference internal" href="#ug-session-context-mangement"><span class="std std-ref">“Session And Context Management”</span></a>).</dd>
</dl>
</div>
<div class="section" id="printvirtelsession-parameter">
<span id="index-13"></span><h5>PrintVirtelSession parameter<a class="headerlink" href="#printvirtelsession-parameter" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div>A second form of the URL with SESSION-CODE allows display of print data sent by the application to the virtual printer associated with the specified session. Normally this URL will be embedded in a
template page and will be triggered by the <em>{{{IF-PRINT-IS-READY}}}</em> tag.</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">pathname</span><span class="o">/</span><span class="n">pagename</span><span class="o">++</span><span class="n">PrintVirtelSession</span><span class="o">=</span><span class="n">sessionid</span>
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
<dt>pathname</dt>
<dd>Represents a VIRTEL directory, as described earlier.</dd>
<dt>pagename</dt>
<dd>Is the name of the template page to be used for displaying the print data. This page must contain the special <em>{{{PRINT}}}</em> tag (see <a class="reference internal" href="#ug-printing"><span class="std std-ref">“3287 Printing”</span></a>) at the point at which the print data are to be inserted in the page.</dd>
<dt>sessionid</dt>
<dd>Is a code which allows VIRTEL to identify the printer associated with the user’s 3270 session. The parameter PrintVirtelSession=sessionid (where sessionid is the associated 3270 session identifier), is generated by the <em>{{{SESSION-CODE}}}</em> tag as in the following example:-</dd>
</dl>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">imprim</span><span class="o">.</span><span class="n">htm</span><span class="o">++</span><span class="n">Print</span><span class="p">{{{</span><span class="n">SESSION</span><span class="o">-</span><span class="n">CODE</span><span class="p">}}}</span>
</pre></div>
</div>
</div>
<div class="section" id="validatevirtelsession-parameter">
<span id="index-14"></span><h5>ValidateVirtelSession parameter<a class="headerlink" href="#validatevirtelsession-parameter" title="Permalink to this headline">¶</a></h5>
<p>A third form of URL with <em>{{{SESSION-CODE}}}</em> allows a JavaScript procedure embedded in a template page to determine whether there are pending updates to the 3270 screen image. For this type of URL, VIRTEL returns no data, only an HTTP response code. The possible response codes are:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>205 (Reset Content)</dt>
<dd>The host application has updated the 3270 screen image since the last time it was sent to the user.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>304 (Not Modified)</dt>
<dd>The host application has not updated the 3270 screen image</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>404 (Not Found)</dt>
<dd>The sessionid code does not represent a valid host session.</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When response code 205 is indicated, the JavaScript procedure sends a further request to VIRTEL to retrieve the updated 3270 screen image. This technique can be useful in handling host applications
which use multiple 3270 write commands to paint a single 3270 screen, where the user might otherwise be presented with a partially updated screen. An example of this technique is contained in the
WEB2VIRT.htm page delivered in the VIRTEL sample directory W2H-DIR.</p>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">pathname</span><span class="o">/</span><span class="n">pagename</span><span class="o">++</span><span class="n">ValidateVirtelSession</span><span class="o">=</span><span class="n">sessionid</span>
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
<dt>pathname</dt>
<dd>Represents a VIRTEL directory, as described earlier.</dd>
<dt>pagename</dt>
<dd>May be specified but is not used.</dd>
<dt>sessionid</dt>
<dd>Is a code which allows VIRTEL to identify the 3270 session whose
status is being queried. The parameter ValidateVirtelSession=sessionid, where sessionid is the associated 3270 session identifier, is generated by the <em>{{{SESSION-CODE}}}</em> tag as in the following example:-</dd>
</dl>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">check</span><span class="o">.</span><span class="n">htm</span><span class="o">++</span><span class="n">Validate</span><span class="p">{{{</span><span class="n">SESSION</span><span class="o">-</span><span class="n">CODE</span><span class="p">}}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>For compatibility with previous versions, the keyword VerifyVirtelSession is also accepted. VerifyVirtelSession is similar to ValidateVirtelSession except that it produces only two possible return codes:</p>
<blockquote class="last">
<div><ul class="simple">
<li>205 (screen updated)</li>
<li>304 (screen not updated or session invalid)</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="usecookiesession-parameter">
<span id="index-15"></span><h5>$UseCookieSession$ parameter<a class="headerlink" href="#usecookiesession-parameter" title="Permalink to this headline">¶</a></h5>
<p>As an alternative to specifying the VirtelSession parameter in the URL, the SESSION-CODE may be sent to VIRTEL in a cookie. An example URL is shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://ipaddr:port/pathname/pagename++$UseCookieSession$
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
<dt>pathname</dt>
<dd>Represents a VIRTEL directory, as described earlier.</dd>
<dt>pagename</dt>
<dd>Is the name of the template page to be used for displaying the next
3270 screen (usually the same as the current template page).</dd>
<dt>$UseCookieSession$</dt>
<dd>Indicates that the SESSION-CODE is contained in the VirtelSession cookie.</dd>
</dl>
<p>The VirtelSession cookie should be generated by Javascript as shown in the example below. This function may be added to the custom Javascript script (see <a class="reference internal" href="#ug-customization-javascript-functions"><span class="std std-ref">“Site customization of Javascript functions”</span></a>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">Save</span> <span class="n">VirtelSession</span> <span class="n">cookie</span> <span class="n">after</span> <span class="n">each</span> <span class="n">subpage</span> <span class="ow">is</span> <span class="n">loaded</span> <span class="o">*/</span>
<span class="n">function</span> <span class="n">after_responseHandle</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">xtim</span><span class="p">)</span> <span class="p">{</span>
<span class="n">var</span> <span class="n">node</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s2">&quot;sesscode&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">text</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">textContent</span> <span class="o">||</span> <span class="n">node</span><span class="o">.</span><span class="n">innerText</span><span class="p">;</span>
    <span class="n">var</span> <span class="n">sess</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">/^</span><span class="n">VirtelSession</span><span class="o">=/</span><span class="n">i</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="n">createCookie</span><span class="p">(</span><span class="s2">&quot;VirtelSession&quot;</span><span class="p">,</span> <span class="n">sess</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Figure 1.5 Custom Javascript function to generate a VirtelSession cookie</em></p>
</div>
</div>
<div class="section" id="capability-urls">
<span id="index-16"></span><h4>Capability URLs<a class="headerlink" href="#capability-urls" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div>A URL may contain a “capability token” generated by another terminal. In this case the URL inherits certain rights or capabilities conferred by the other terminal. The capabilities inherited depend on the parameters specified in the SET-HEADER tag which generated the capability token. For further details, see <a class="reference internal" href="#ug-capability-tokens"><span class="std std-ref">“Capability Tokens”</span></a>.</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">pathname</span><span class="o">/</span><span class="n">pagename</span><span class="o">+</span><span class="n">tranname</span><span class="o">+</span><span class="n">capabilitytoken</span>
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
<dt>pathname</dt>
<dd>Represents a VIRTEL directory, as described earlier.</dd>
<dt>pagename</dt>
<dd>Is the name of a template page, as before.</dd>
<dt>tranname</dt>
<dd>(optional) Is the name of the transaction which supplies the dynamic data for the page. If the transaction name is omitted then two “+” signs must separate the pagename from the capabilitytoken.</dd>
<dt>capability</dt>
<dd>token is a token which grants rights to another terminal’s
resources. This code, whose format is x-Virtel-name:token, is
generated by the <a class="reference internal" href="#ug-set-header"><span class="std std-ref">“{{{SET-HEADER}}}”</span></a> tag.
The code is case-sensitive and so the capitalization must be exactly
the same as the generated token.</dd>
</dl>
<span class="target" id="ug-cookie-upload"></span></div>
<div class="section" id="transmission-of-security-tokens-by-url">
<span id="index-17"></span><h4>Transmission of Security Tokens by URL<a class="headerlink" href="#transmission-of-security-tokens-by-url" title="Permalink to this headline">¶</a></h4>
<p>A security code, which identifies a user during a HTTP page upload request, is normally transmitted between the browser and VIRTEL as a cookie (see <a class="reference internal" href="#ug-uploading-html-pages"><span class="std std-ref">“Uploading HTML Pages”</span></a>). If, for security or other reasons, your browser does not allow the use of cookies, then the security code can, as an alternative, be embedded in a URL of the form shown below:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">pathname</span><span class="o">/</span><span class="n">pagename</span><span class="o">+</span><span class="n">tranname</span><span class="o">+</span><span class="n">securitycode</span>
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
<dt>pathname</dt>
<dd>Represents a VIRTEL directory, as described earlier.</dd>
<dt>pagename</dt>
<dd>Is the name of a template page, as before.</dd>
<dt>tranname</dt>
<dd>Is the name of the transaction which supplies the dynamic data for the page.</dd>
<dt>securitycode</dt>
<dd>Is the code which allows VIRTEL to identify the user. This code, whose format is VirtelCookie=xxxxxxxxxxxxxxxx, is generated by the “{{{SECURITY-TOKEN}}}” tag, as shown in the example below:-</dd>
</dl>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">upload2</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">upload</span><span class="o">+</span><span class="n">VirtelCookie</span><span class="o">=</span><span class="p">{{{</span><span class="n">SECURITY</span><span class="o">-</span><span class="n">TOKEN</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The following format allows a static page to be displayed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">pathname</span><span class="o">/</span><span class="n">pagename</span><span class="o">++</span><span class="n">securitycode</span>
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
<dt>pathname</dt>
<dd>Represents a VIRTEL directory, as described earlier.</dd>
<dt>pagename</dt>
<dd>Is the name of the page.</dd>
<dt>securitycode</dt>
<dd><p class="first">Is a code of format VirtelCookie=xxxxxxxxxxxxxxxx which allows VIRTEL to identify the user, as before.</p>
<p class="last">On receipt of this URL, VIRTEL treats the VirtelCookie= parameter as if it were a cookie transmitted by the browser.</p>
</dd>
</dl>
<span class="target" id="ug-signon-propagation"></span></div>
<div class="section" id="propagation-of-signon-by-url">
<span id="index-18"></span><h4>Propagation of signon by URL<a class="headerlink" href="#propagation-of-signon-by-url" title="Permalink to this headline">¶</a></h4>
<p>A URL embedded in a page sent by VIRTEL may contain a VirtelUserSignon parameter in order to propagate the user’s signon credentials to another page. The value of the parameter is generated by the <a class="reference internal" href="#ug-user-signon-code"><span class="std std-ref">“({{{USER-SIGNON-CODE}}} tag “</span></a>. This can be useful in cases where the browser does not propagate the user name and password from one page to another, for example when using VIRTEL transaction security type 4. The format of a URL containing a signon code is shown below:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ipaddr</span><span class="p">:</span><span class="n">port</span><span class="o">/</span><span class="n">pathname</span><span class="o">/</span><span class="n">pagename</span><span class="o">+</span><span class="n">tranname</span><span class="o">+</span><span class="n">VirtelUserSignon</span><span class="o">=</span><span class="n">signoncode</span>
</pre></div>
</div>
<dl class="docutils">
<dt>ipaddr:port</dt>
<dd>Is the address of the HTTP line, as before.</dd>
<dt>pathname</dt>
<dd>Represents a VIRTEL directory, as described earlier.</dd>
<dt>pagename</dt>
<dd>Is the name of a template page, as before.</dd>
<dt>tranname</dt>
<dd>Is the name of the transaction which supplies the dynamic data for the page.</dd>
<dt>signoncode</dt>
<dd>Is a code which allows VIRTEL to identify the signed-on user. This code is generated by the <em>{{{USER-SIGNON-CODE}}}</em> tag, as shown in the example below:-</dd>
</dl>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">web2virt</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">cics</span><span class="o">+</span><span class="n">VirtelUserSignon</span><span class="o">=</span><span class="p">{{{</span><span class="n">USER</span><span class="o">-</span><span class="n">SIGNON</span><span class="o">-</span><span class="n">CODE</span><span class="p">}}}</span>
</pre></div>
</div>
</div>
<div class="section" id="the-universal-transaction">
<span id="index-19"></span><h4>The Universal Transaction<a class="headerlink" href="#the-universal-transaction" title="Permalink to this headline">¶</a></h4>
<p>A transaction may be defined with an external name consisting of an asterisk, and this is considered to be a “universal” transaction. A universal transaction matches any URL not already matched by a preceding transaction in the entry point. This allows VIRTEL to process URLs whose format does not conform to the classic VIRTEL formats previously described.</p>
</div>
</div>
<div class="section" id="directory-management">
<span id="ug-directory-management"></span><h3>Directory Management<a class="headerlink" href="#directory-management" title="Permalink to this headline">¶</a></h3>
<p id="index-20">HTML and XML template pages and other entities such as CSS stylesheets, JavaScript procedures, and GIF or JPEG images used by VIRTEL Web Access are stored in directories within a VSAM KSDS managed by VIRTEL. Each KSDS defined to VIRTEL can contain one or more directories. The system administrator can upload pages and other elements into a VIRTEL directory by using a web browser or by e-mail, as described in detail in the section <a class="reference internal" href="#ug-uploading-html-pages"><span class="std std-ref">“Uploading HTML Pages”</span></a>.</p>
<div class="section" id="accessing-the-administration-application">
<h4>Accessing the administration application<a class="headerlink" href="#accessing-the-administration-application" title="Permalink to this headline">¶</a></h4>
<p>Virtel provides an administrative portal which contains various sub applications used to administer Virtel. The administrative portal can be access either through the 3270 administration application or the HTML GUI portal.</p>
</div>
<div class="section" id="access-through-3270">
<h4>Access through 3270<a class="headerlink" href="#access-through-3270" title="Permalink to this headline">¶</a></h4>
<p>Access to the 3270 application is through a normal VTAM logon using the VIRTEL APPLID as the application name. For example, from a VTAM screen enter LOGON APPLID=VIRTEL. The following screen will appear:-</p>
<p><img alt="image113" src="../../../_images/image1131.png" />
<em>Logon screen for 3270 Administration</em></p>
<p>After logging in with security details the main application menu will be presented. Select PF1 from the main menu to access the administration and configuration menu.</p>
<p><img alt="image114" src="../../../_images/image1141.png" />
<em>Directory sub application</em></p>
<p>The directory management sub-application allows the administrator to define directories. The sub-application is accessible by [PF6] from the configuration menu, or by [PF12] from the system services menu followed by option 3, or from the VIRTEL Multi-Session menu via a transaction which invokes VIRTEL module VIR0042.</p>
</div>
<div class="section" id="security">
<h4>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h4>
<p>If security is active, access to the directory management sub-application from the configuration menu or the system services menu is controlled by resource $$PCPC$$.</p>
<p>When invoked via a transaction, normal transaction security rules apply.</p>
<p>In addition, each directory is protected by a resource whose name is the same as the directory name. The administrator must have access to this resource in order to view or manage the contents of the    directory, or to upload pages to the directory. When an external security product is used, the resource is defined in the class named by the RNODE parameter in the VIRTCT (see “Parameters of the VIRTCT” in the VIRTEL Installation Guide).</p>
<p>Security management is described in the VIRTEL Security documentation.</p>
</div>
<div class="section" id="creating-modifying-and-deleting-directories">
<h4>Creating, modifying, and deleting directories<a class="headerlink" href="#creating-modifying-and-deleting-directories" title="Permalink to this headline">¶</a></h4>
<p>When the directory management sub-application is invoked, it displays a list of the directories already defined in the system:-</p>
<p><img alt="image71" src="../../../_images/image7111.png" /> <em>Figure 1.6 Directory management summary screen</em></p>
<div class="section" id="using-the-associated-admin-3270-functions">
<h5>Using the associated Admin(3270) functions<a class="headerlink" href="#using-the-associated-admin-3270-functions" title="Permalink to this headline">¶</a></h5>
<p>These functions are accessed from either the browsers Administration portal or by logging on to Virtel using it’s VTAM interface.</p>
</div>
<div class="section" id="deleting-a-directory-definition">
<h5>Deleting a directory definition<a class="headerlink" href="#deleting-a-directory-definition" title="Permalink to this headline">¶</a></h5>
<p>To delete a directory definition, place the cursor on the name of the directory to be deleted and press [PF2]. The message CONFIRM DELETE appears at the bottom of the screen. Press [PF2] again. The message DELETE OK indicates that the deletion of the directory definition was successful. While the message CONFIRM DELETE is displayed, you can press any function key other than [PF2] to cancel the operation.</p>
</div>
<div class="section" id="displaying-directory-contents">
<h5>Displaying directory contents<a class="headerlink" href="#displaying-directory-contents" title="Permalink to this headline">¶</a></h5>
<p>To display the contents of a directory, place the cursor on the directory name and press [PF4]. VIRTEL displays the directory contents management screen described below.</p>
</div>
<div class="section" id="adding-a-directory-definition">
<h5>Adding a directory definition<a class="headerlink" href="#adding-a-directory-definition" title="Permalink to this headline">¶</a></h5>
<p>To create a new directory definition, place the cursor on the blank line after the last directory, and press [PF12] to display an empty directory detail screen. Fill in all of the fields and press [ENTER]. The message CREATION OK indicates that the directory definition was successfully created.</p>
</div>
<div class="section" id="scrolling-the-list-of-directories">
<h5>Scrolling the list of directories<a class="headerlink" href="#scrolling-the-list-of-directories" title="Permalink to this headline">¶</a></h5>
<p>To scroll to the top of the list, press [PF6]. To scroll up or down the list, press [PF7] or [PF8].</p>
</div>
<div class="section" id="exiting-from-directory-management">
<h5>Exiting from directory management<a class="headerlink" href="#exiting-from-directory-management" title="Permalink to this headline">¶</a></h5>
<p>To return to the configuration menu, press [PF3].</p>
</div>
</div>
<div class="section" id="defining-directory-parameters">
<h4>Defining directory parameters<a class="headerlink" href="#defining-directory-parameters" title="Permalink to this headline">¶</a></h4>
<p>To access the detail screen for any directory, place the cursor on the directory name and press [PF12]:</p>
<p><img alt="image72" src="../../../_images/image724.png" /> <em>Directory management detail screen</em></p>
<dl class="docutils">
<dt>Name</dt>
<dd>The name of the directory as known by VIRTEL. If security is active,
this name must also be defined as a resource to which the user must
be authorized.</dd>
<dt>Description</dt>
<dd>Comment associated with the directory.</dd>
<dt>Type</dt>
<dd><strong>V</strong> (or blank) indicates that the directory is held in a VSAM
KSDS.</dd>
<dt>DD name</dt>
<dd>The file name of the VSAM KSDS which contains the directory. This name must be defined in one of the UFILEn parameters in the VIRTCT, and a DD statement with the same name must appear in the VIRTEL
started task JCL.</dd>
<dt>Keyword</dt>
<dd>This is an 8-byte key which allows multiple directories to be stored within a single VSAM KSDS. Each directory in a KSDS must have a unique key.</dd>
<dt>Size of names</dt>
<dd>The maximum length of the names of HTML pages and other elements stored in this directory. The minimum (and default) value is 8. The maximum value is 64.</dd>
<dt>Case</dt>
<dd>Any non-blank character in this field indicates that the element names stored in this directory are case sensitive. Blank indicates that the names are not case sensitive.</dd>
<dt>Copy up</dt>
<dd>This field is used by VIRTEL/PC. For VIRTEL Web Access directories, the value <strong>X</strong> must be coded.</dd>
<dt>Copy down</dt>
<dd>This field is used by VIRTEL/PC. For VIRTEL Web Access directories, the value <strong>X</strong> must be coded.</dd>
<dt>Delete</dt>
<dd><p class="first">This field is used by VIRTEL/PC. For VIRTEL Web Access directories, the value <strong>X</strong> must be coded.</p>
<p class="last">After pressing [PF4] at the directory management summary screen or detail screen, VIRTEL displays a list of the files in the directory:</p>
</dd>
</dl>
<p><img alt="image73" src="../../../_images/image734.png" /> <em>Figure 1.8 Directory contents management screen</em></p>
</div>
<div class="section" id="associated-functions">
<h4>Associated functions<a class="headerlink" href="#associated-functions" title="Permalink to this headline">¶</a></h4>
<div class="section" id="deleting-an-element">
<h5>Deleting an element<a class="headerlink" href="#deleting-an-element" title="Permalink to this headline">¶</a></h5>
<p>To delete an element from a directory, place the cursor on the name of the element to be deleted and press [PF2]. The message CONFIRM DELETE appears at the bottom of the screen. Press [PF2] again. The message DELETE OK indicates that the deletion of the element was successful. While the message CONFIRM DELETE is displayed, you can press any function key other than [PF2] to cancel the operation.</p>
</div>
<div class="section" id="copying-an-element-to-another-directory">
<h5>Copying an element to another directory<a class="headerlink" href="#copying-an-element-to-another-directory" title="Permalink to this headline">¶</a></h5>
<p>To copy an element from directory A to directory B, first display the contents of directory A. In field [7] type the name of the target directory B, then press [ENTER]. Next, place the cursor on the name of the element to be copied, then press [PF6]. The message COPY COMPLETED indicates that the operation was successful. If the element exists in the target directory, the copy fails and the message THIS FILE IS ALREADY IN THE TARGET DIRECTORY is displayed at the bottom of the screen.</p>
</div>
<div class="section" id="scrolling-the-list">
<h5>Scrolling the list<a class="headerlink" href="#scrolling-the-list" title="Permalink to this headline">¶</a></h5>
<p>The list of elements can be scrolled up and down using [PF7] and [PF8].</p>
</div>
<div class="section" id="exiting-from-directory-contents-management">
<h5>Exiting from directory contents management<a class="headerlink" href="#exiting-from-directory-contents-management" title="Permalink to this headline">¶</a></h5>
<p>To return to the list of directories, press [PF3].</p>
</div>
</div>
<div class="section" id="acccess-administration-portal-via-the-web">
<h4>Acccess administration portal via the web<a class="headerlink" href="#acccess-administration-portal-via-the-web" title="Permalink to this headline">¶</a></h4>
<p>Access to the HTML GUI Administration portal is through the web using the Administration endpoint. By default this is port 41001. The URL <a class="reference external" href="http://192.168.129.33:41001">http://192.168.129.33:41001</a> is an example of a URL to access the WEB administration portal. After providing security information the following screen will appear:-</p>
<p><img alt="image115" src="../../../_images/image1151.png" />
<em>Logon screen for Web Administration</em></p>
<p>Selecting the Admin (HTML) will prompt for a userid and password. After providing security details the following administration portal will appear:-</p>
<p><img alt="image116" src="../../../_images/image1161.png" />
<em>Web Administration Portal</em></p>
<blockquote>
<div>Directory administration can be invoked from the Directory link. Selecting a directory will display a content menu proving options to list, edit, delete or create new directories.</div></blockquote>
<p><img alt="image117" src="../../../_images/image1171.png" />
<em>Directory Context Menu</em></p>
<p>When selecting a directory, the detail panel will be displayed. The ICONs on the right hand side of the title bar provide actions such as add, update or list.</p>
<p><img alt="image118" src="../../../_images/image1181.png" />
<em>Directory Detail Display</em></p>
<span class="target" id="ug-creating-html"></span></div>
</div>
<div class="section" id="creating-virtel-template-pages">
<span id="index-21"></span><h3>Creating Virtel Template Pages<a class="headerlink" href="#creating-virtel-template-pages" title="Permalink to this headline">¶</a></h3>
<div class="section" id="index-22">
<span id="id1"></span><h4>Introduction<a class="headerlink" href="#index-22" title="Permalink to this headline">¶</a></h4>
<p>Template pages are the means by which VIRTEL presents host application data to the user via a web browser. In addition to standard HTML or XML tags, template pages contain VIRTEL-specific tags enabling integration of information delivered by the mainframe application programs. HTML template pages may contain GIF or JPEG images, sounds, scripts such as JavaScript or any other function or program elements that are compatible with the browser. Template pages may be produced either by hand or by using standard HTML or XML design tools available on the market.</p>
<p>For VWA, users would not be required to produce or modify any template pages as all the necessary template pages are provided by the Virtel product. For VWM or VWI, new pages may be produced by Virtel tools such as Virtel Screen Redesigner to support modernisation or integration projects. Virtel Studio may also introduce new templates to support business logic in Virtel scenarios. Sometimes it may be necessary to modify these pages.</p>
<p>The following sections provide details on Virtel tags.</p>
</div>
<div class="section" id="defining-the-tag-delimiters">
<span id="index-23"></span><h4>Defining the tag delimiters<a class="headerlink" href="#defining-the-tag-delimiters" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL-specific tags are used to insert data originating at the host into an HTML or XML page, and to manage colours and function keys in an HTML page. VIRTEL-specific tags are identified by special begin and end delimiters. The delimiters themselves are defined by means of a comment placed between the tags &lt;HEAD&gt; and &lt;/HEAD&gt; of the HTML page. The actual delimiters may vary from one page to another.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;!--VIRTEL start=&quot;{{{&quot; end=&quot;}}}&quot; --&gt;
</pre></div>
</div>
<p>In this example, VIRTEL-specific tags are defined as being represented by a succession of 3 opening braces and terminated by a succession of 3 closing braces. This convention is maintained throughout the remainder of this chapter. A minimum template required for Virtel to work with and display a 3270 application looks something like this:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;html&gt;
    &lt;head&gt;
        &lt;!--VIRTEL start=&quot;{{{&quot; end=&quot;}}}&quot; --&gt;
        &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
        &lt;title&gt;Virtel Unplugged - Example 1&lt;/title&gt;
        &lt;script&gt;
            function SetFocus() {
            console.log(&quot;SetFocus&quot;);
                    document.virtelForm.{{{FIELD-WITH-CURSOR}}}.focus();
            }

            function SubmitForm(e) {
            if (e &amp;&amp; e.keyCode == 13) {
            document.virtelForm.submit();
            }
            }
        &lt;/script&gt;

    &lt;/head&gt;
    &lt;body onLoad=&quot;SetFocus()&quot;&gt;
        &lt;form name=&quot;virtelForm&quot; action=&quot;{{{NAME-OF (PAGE)}}}++{{{SESSION-CODE}}}&quot; method=&quot;POST&quot;&gt;
            &lt;pre&gt;
            &lt;div id=&quot;printReady&quot; onkeypress=&quot;SubmitForm(event)&quot;&gt;
            {{{ GENERATE-HTML (1,1,1920) }}}
            &lt;/div&gt;
            &lt;/pre&gt;
            {{{DEFINE-HTML-FOCUS-FIELD &quot;FOCUSFIELD&quot;}}}
            &lt;input name=&quot;FOCUSFIELD&quot; type=&quot;HIDDEN&quot; value=&quot;{{{FIELD-WITH-CURSOR}}}&quot;&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
<p><em>Sample Virtel Template</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See the use of the Virtel tags {{{ }}} within the HTML template. Virtel injects data into these fields before sending the template to the browser.</p>
</div>
<span class="target" id="ug-session-context-mangement"></span></div>
<div class="section" id="session-and-context-management">
<span id="index-24"></span><h4>Session and context management<a class="headerlink" href="#session-and-context-management" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL uses the concept of a session code to maintain the context between a client using a browser and the host application to which the client is connected. This code allows VIRTEL to identify the client and to associate the client with a session already established with a host application.</p>
<div class="section" id="session-code-tag">
<span id="index-25"></span><h5>SESSION-CODE tag<a class="headerlink" href="#session-code-tag" title="Permalink to this headline">¶</a></h5>
<p>The SESSION-CODE tag is used to create the URL associated with form submission.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">SESSION</span><span class="o">-</span><span class="n">CODE</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The SESSION-CODE tag allows a session code to be inserted in the template page in the format VirtelSession=xxxxxxxxxxxxxxxx. The value of the session code changes after each message. For examples of its use, see <a class="reference internal" href="#ug-transmitting-data"><span class="std std-ref">“Transmitting Data To The Host”</span></a>, and <a class="reference internal" href="#ug-printing"><span class="std std-ref">“3287 Printing”</span></a>.</p>
</div>
<div class="section" id="ajax-session-code-tag">
<span id="index-26"></span><h5>AJAX-SESSION-CODE tag<a class="headerlink" href="#ajax-session-code-tag" title="Permalink to this headline">¶</a></h5>
<p>The AJAX-SESSION-CODE tag is similar to the SESSION-CODE tag, but it generates the code in a different format which does not change with each request. This is useful when implementing an AJAX dialog between the application and the browser. For this type of application, it is not always possible to transmit the VIRTEL session code to the browser, especially if a Javascript library is used.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">AJAX</span><span class="o">-</span><span class="n">SESSION</span><span class="o">-</span><span class="n">CODE</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The AJAX-SESSION-CODE tag allows a session code to be inserted in the template page in the format AjaxSession=xxxxxxxxxxxxxxxx. For example:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">txt</span><span class="o">+</span><span class="n">cics</span><span class="o">+</span><span class="p">{{{</span> <span class="n">AJAX</span><span class="o">-</span><span class="n">SESSION</span><span class="o">-</span><span class="n">CODE</span> <span class="p">}}}</span>
</pre></div>
</div>
</div>
<div class="section" id="set-initial-timeout-tag">
<span id="index-27"></span><h5>SET-INITIAL-TIMEOUT tag<a class="headerlink" href="#set-initial-timeout-tag" title="Permalink to this headline">¶</a></h5>
<p>The SET-INITIAL-TIMEOUT tag allows a timeout to be started when VIRTEL builds the page.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">INITIAL</span><span class="o">-</span><span class="n">TIMEOUT</span> <span class="s2">&quot;n&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>For example, if the instruction</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">INITIAL</span><span class="o">-</span><span class="n">TIMEOUT</span> <span class="s2">&quot;10&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>is coded in a page or a sub-page, then VIRTEL will cancel the session if the workstation has not sent another request after 10 seconds.</p>
<span class="target" id="ug-transmitting-data"></span></div>
</div>
<div class="section" id="transmitting-data-to-the-host">
<span id="index-28"></span><h4>Transmitting data to the host<a class="headerlink" href="#transmitting-data-to-the-host" title="Permalink to this headline">¶</a></h4>
<p>Transmission of data to the host uses the principle of sending an HTML form. In conjunction with the SESSION-CODE tag, the form allows the transmission of input fields to the host application, and the display of the subsequent application screen.</p>
<p>The form is defined as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;FormName&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;VirtelURL&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;get&quot;</span><span class="o">&gt;</span>
    <span class="n">Data</span> <span class="n">which</span> <span class="n">will</span> <span class="n">be</span> <span class="n">transmitted</span> <span class="n">to</span> <span class="n">the</span> <span class="n">HTTP</span> <span class="n">server</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
</div>
<dl class="docutils">
<dt>name</dt>
<dd>Form name. The name of the form is used in JavaScript procedures to refer to various elements of the form. For an example, see the section <a class="reference internal" href="#ug-cursor-management"><span class="std std-ref">“Cursor management”</span></a>.</dd>
<dt>action</dt>
<dd>URL transmitted to the server, in the following format:</dd>
</dl>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;pagename++{{{SESSION-CODE}}}&quot;</span>
</pre></div>
</div>
<dl class="docutils">
<dt>pagename</dt>
<dd>Is the name of the template page to be used to display the subsequent screen sent by the host application (usually the same as the current template page)</dd>
<dt>SESSION-CODE</dt>
<dd>Identifies the session established with the host application</dd>
<dt>method</dt>
<dd>Transmission mode. Always POST.</dd>
</dl>
<p>Example :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Virtel&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;WEB2VIRT.htm++{{{SESSION-CODE}}}&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="where-to-position-the-elements-of-an-html-page">
<h4>Where to position the elements of an HTML page<a class="headerlink" href="#where-to-position-the-elements-of-an-html-page" title="Permalink to this headline">¶</a></h4>
<p>By design, an HTML page starts with the &lt;HTML&gt; tag and is terminated by the &lt;/HTML&gt; tag. In order to be able to be correctly interpreted by the browser, other tags are necessary, for example &lt;HEAD&gt; and &lt;/HEAD&gt; as well as &lt;BODY&gt; and &lt;/BODY&gt;. All other tags are optional.</p>
<p>As shown previously, data transmitted to the HTTP server by the client is itself placed in between the tag fields &lt;FORM&gt; and &lt;/FORM&gt;. In order to minimise traffic, it is also advisable to place only useful data in the tag fields for example, generated fields or copies resulting from GENERATE-HTML and COPY-FROM tags, as well as indispensable fields such as focusField and pfkField. Other data may be placed anywhere in the area of the HTML page, provided that their position conforms to the standards. The following presents a <span class="target" id="index-29"></span>template structure example.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;HTML&gt;
&lt;HEAD&gt;&lt;!------------------ start of HTML page header    --------------------&gt;
&lt;style&gt;
&lt;!-- définition des classes de style
    .GREEN {font-family: monospace; background: #000000; color: #00FF00; }
//--&gt;&lt;/style&gt;
&lt;!--VIRTEL start=&quot;{{{&quot; end=&quot;}}}&quot; --&gt;
{{{ON-ATTRIBUTE (PROTECTED,WHITE)&lt;font color=white&gt;}}}
{{{ON-END-OF-ATTRIBUTE (PROTECTED,WHITE)&lt;/font&gt;}}}
{{{ADD-TO-FIELDS (NORMAL,NOCOLOR) class=&quot;GREEN&quot; }}}
{{{DEFINE-HTML-PFKEY &quot;PFKFIELD&quot;}}}
{{{DEFINE-HTML-FOCUS-FIELD &quot;FOCUSFIELD&quot;}}}
&lt;title&gt;Sample HTML page&lt;/title&gt;
&lt;/HEAD&gt;&lt;!------------------ end of HTML page header    --------------------&gt;

&lt;script language=&quot;JavaScript&quot;&gt;&lt;!-- function SetFocus()
    { document.virtelForm.{{{FIELD-WITH-CURSOR}}}.focus(); } function
SaveFocus(CurrentFieldName)
    { document.virtelForm.FOCUSFIELD.value = CurrentFieldName; }
function SubmitForm(valeur)
    { document.virtelForm.PFKFIELD.value = valeur;
      document.virtelForm.submit(); }
function ShowPopup()
    { var popup =
        window.open(&quot;&quot;,&quot;PopupImpression&quot;,&#39;width=614,height=129&#39;);
        popup.location = &quot;imprim.htm++Print{{{SESSION-CODE}}}&quot;; }    --&gt;&lt;/script&gt;

&lt;!---------------------- start of HTML page body    --------------------&gt;
&lt;BODY onLoad=&quot;SetFocus()&quot;&gt;
&lt;!------------------------- start of HTML form    -----------------------&gt;
&lt;FORM name=&quot;virtelForm&quot;
    action=&quot;example.html++{{{SESSION-CODE}}}&quot;
    method==&quot;POST&quot;&gt;

{{{ GENERATE-HTML (1,1,1920) }}}

&lt;input name=&quot;PFKFIELD&quot; type=&quot;HIDDEN&quot; value=&quot;&quot;&gt;
&lt;input name=&quot;FOCUSFIELD&quot; type=&quot;HIDDEN&quot; value=&quot;{{{FIELD-WITH-CURSOR}}}&quot;&gt;
&lt;/FORM&gt;
&lt;!--------------------- end of HTML form    ----------------------&gt;

&lt;!—-Place submit buttons and hypertext links here. For example:--&gt;
&lt;a href=&quot;Javascript:submitform(&#39;PF1&#39;)&quot; &gt;soumettre avec PF01&lt;/a&gt;
&lt;INPUT TYPE=&quot;BUTTON&quot; size=&quot;5&quot; onclick=&quot;SubmitForm(this.value)&quot;    value=&quot;PF01&quot;&gt;
&lt;script language=&quot;JavaScript&quot;&gt;&lt;!--    {{{IF-PRINT-IS-READY
    ShowPopUp();
}}}
--&gt;&lt;/script&gt;
&lt;/BODY&gt;&lt;!------------------ end of HTML page body    --------------------&gt;
&lt;/HTML&gt;
</pre></div>
</div>
<p>For a full example, see the WEB2VIRT.htm page delivered with VIRTEL.</p>
<span class="target" id="ug-inserting-host-data"></span></div>
<div class="section" id="inserting-host-application-data-into-a-page">
<span id="index-30"></span><h4>Inserting host application data into a page<a class="headerlink" href="#inserting-host-application-data-into-a-page" title="Permalink to this headline">¶</a></h4>
<p>Insertion of host application data in an HTML or XML page is achieved with the GENERATE-HTML and COPY-FROM tags.</p>
<div class="section" id="generate-html-tag">
<span id="index-31"></span><h5>GENERATE-HTML tag<a class="headerlink" href="#generate-html-tag" title="Permalink to this headline">¶</a></h5>
<p>The GENERATE-HTML tag instructs VIRTEL to convert all or part of the 3270 screen into HTML form data. Output fields are converted into text, while input fields are converted into HTML input statements.     The generated text and input fields are aligned so as to correspond as far as possible with the layout of the original 3270 screen. The resulting generation takes account of the nature of the data as well     as the information specified in the ON-ATTRIBUTE, ON-END-OF-ATTRIBUTE and ADD-TO-FIELDS tags.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">GENERATE</span><span class="o">-</span><span class="n">HTML</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>row,col</dt>
<dd>Starting position (row and column number on the 3270 screen) of the
data to be copied. This starting position will usually contain a
3270 attribute character.</dd>
<dt>len</dt>
<dd>Length of the data to be copied (including attribute characters).</dd>
</dl>
<p>For example, the command <em>{{{ GENERATE-HTML (01,01,1920) }}}</em> will  generate the total contents of the 3270 screen.</p>
<p>An alternative form of the GENERATE-HTML tag allows the position and length to be specified by means of a symbolic name defined in a previous DEFINE-DFHMDF-NAME or DEFINE-DFHMDF-COLUMN tag (see <a class="reference internal" href="#ug-define-dfhmdf-column"><span class="std std-ref">“{{{DEFINE-DFHMDF-COLUMN}}}”</span></a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">GENERATE</span><span class="o">-</span><span class="n">HTML</span> <span class="s2">&quot;name&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>name</dt>
<dd>symbolic name defined in a previous DEFINE-DFHMDF-NAME or
DEFINE-DFHMDF-COLUMN tag.</dd>
</dl>
</div>
<div class="section" id="copy-from-tag">
<span id="index-32"></span><h5>COPY-FROM tag<a class="headerlink" href="#copy-from-tag" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div>The COPY-FROM tag copies data into the HTML page from a specific
location on the 3270 screen. Unlike the GENERATE-HTML tag, the
COPY-FROM tag copies only the data and does not process any
associated 3270 field attributes.</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">COPY</span><span class="o">-</span><span class="n">FROM</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>row,col</dt>
<dd>Starting position (row and column number on the 3270 screen) of the
data to be copied. This will typically be the first character after
the attribute character which defines the start of the field.</dd>
<dt>len</dt>
<dd>Length of the data to be copied.</dd>
</dl>
<p>An alternative form of the COPY-FROM tag allows the position and length to be specified by means of a symbolic name defined in a previous DEFINE-DFHMDF-NAME or DEFINE-DFHMDF-COLUMN tag (described 37).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">COPY</span><span class="o">-</span><span class="n">FROM</span> <span class="s2">&quot;name&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>name</dt>
<dd><p class="first">symbolic name defined in a previous DEFINE-DFHMDF-NAME or DEFINE-DFHMDF-COLUMN tag.</p>
<p class="last">Normally, any binary zeroes in the copied data will be removed. However, if the BLANK-BINARY-ZEROES option is set (see <a class="reference internal" href="#ug-setting-local-options"><span class="std std-ref">“Setting and unsetting local options”</span></a>) then binary zeroes will be converted to blanks.</p>
</dd>
</dl>
<span class="target" id="ug-create-variable-from"></span></div>
<div class="section" id="create-variable-from-tag">
<span id="index-33"></span><h5>CREATE-VARIABLE-FROM tag<a class="headerlink" href="#create-variable-from-tag" title="Permalink to this headline">¶</a></h5>
<p>The CREATE-VARIABLE-FROM tag copies data from the 3270 screen into a VIRTEL variable. There are several formats of the COPY-VARIABLE-FROM tag, as described below.</p>
<p>In the first form of CREATE-VARIABLE-FROM, the name of a variable is specified within the tag. Data is extracted from the indicated location on the screen, continuing until an attribute character is found or until the specified length is reached. Any non-alphanumeric characters are removed, all alphabetic characters are converted to upper case, and the resulting data is copied into the variable. If the variable does not exist, it will be created. If the variable already exists, the new value will be appended to any existing values.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">CREATE</span><span class="o">-</span><span class="n">VARIABLE</span><span class="o">-</span><span class="n">FROM</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span> <span class="s2">&quot;varname&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>row,col</dt>
<dd>Starting position (row and column number on the 3270 screen) of the
data to be copied. This will typically be the first character after
an attribute character which defines the start of a field.</dd>
<dt>len</dt>
<dd>Length of the data to be copied.</dd>
<dt>varname</dt>
<dd><blockquote class="first">
<div>The name of the variable to be created</div></blockquote>
<p class="last">The second form of CREATE-VARIABLE-FROM is distinguished by the absence of a variable name within the tag. In this case, the variable name is obtained from the 3270 screen. Data is extracted from the indicated location on the screen, continuing until an attribute character is found or until the specified length is reached. Any non-alphanumeric characters are removed, all alphabetic characters are converted to upper case, and the resulting string is used as a variable name. If the variable does not exist, it will be created. If the variable already exists, a new value will be appended to any existing values. If the variable name was terminated by an attribute character, then the data in the following field is used as the value of the variable. Otherwise the string “EMPTY” will
be used as the value of the variable.</p>
</dd>
</dl>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">CREATE</span><span class="o">-</span><span class="n">VARIABLE</span><span class="o">-</span><span class="n">FROM</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>row,col</dt>
<dd>Line and column number on the 3270 screen containing the variable name.</dd>
<dt>len</dt>
<dd>Total length of the variable name and value to be copied.</dd>
</dl>
<p>The third form of CREATE-VARIABLE-FROM allows a rectangle to be copied from the screen. With a fourth sub- parameter specified, the instruction will not stop collecting data after encountering an     attribute, but will continue adding values to the variable for the specified height on the screen. Any attributes found in the rectangle will be copied as blanks. If the variable does not exist, it will be
created. If the variable already exists, the new values will be appended to any existing values.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">CREATE</span><span class="o">-</span><span class="n">VARIABLE</span><span class="o">-</span><span class="n">FROM</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="s2">&quot;varname&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>row,col</dt>
<dd>Starting position (row and column number on the 3270 screen) of the
data to be copied.</dd>
<dt>width,height</dt>
<dd>Size (in columns and rows) of the rectangle to be copied.</dd>
<dt>varname</dt>
<dd>The name of the variable to be created</dd>
</dl>
</div>
<div class="section" id="define-html-field-name-tag">
<span id="index-34"></span><h5>DEFINE-HTML-FIELD-NAME tag<a class="headerlink" href="#define-html-field-name-tag" title="Permalink to this headline">¶</a></h5>
<p>The DEFINE-HTML-FIELD-NAME tag requests that VIRTEL should use a specific HTML input field name for the specified
3270 field, instead of an automatically generated name. The DEFINE-HTML-FIELD-NAME tag may be followed by a
GENERATE-HTML tag, in which case VIRTEL will generate an HTML input field with the specified name, or the input
field may be explicitly coded in the page template, in which case VIRTEL will use the name to associate the HTML input
field with the 3270 field at the specified position. Normally this tag is not needed because the automatically generated
field names are adequate for all except certain specialised applications.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">DEFINE</span><span class="o">-</span><span class="n">HTML</span><span class="o">-</span><span class="n">FIELD</span><span class="o">-</span><span class="n">NAME</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span> <span class="s2">&quot;name&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>row,col</dt>
<dd>Line and column number of the start of the field on the 3270 screen. This must be the first character after the attribute character.</dd>
<dt>len</dt>
<dd>Length of the input field (excluding attribute character).</dd>
<dt>name</dt>
<dd>Name to be associated with the HTML input field.</dd>
</dl>
</div>
<div class="section" id="define-html-field-tag">
<span id="index-35"></span><h5>DEFINE-HTML-FIELD tag<a class="headerlink" href="#define-html-field-tag" title="Permalink to this headline">¶</a></h5>
<p>The DEFINE-HTML-FIELD tag is equivalent to a DEFINE-HTML-FIELD-NAME tag followed by a GENERATE-HTML tag.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">DEFINE</span><span class="o">-</span><span class="n">HTML</span><span class="o">-</span><span class="n">FIELD</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span> <span class="s2">&quot;name&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>row,col</dt>
<dd>Line and column number of the start of the field on the 3270 screen.
This must be the first character after the attribute character.</dd>
<dt>len</dt>
<dd>Length of the input field (excluding attribute character).</dd>
<dt>name</dt>
<dd>Name to be associated with the HTML input field.</dd>
</dl>
</div>
<div class="section" id="define-dfhmdf-name-tag">
<span id="index-36"></span><h5>DEFINE-DFHMDF-NAME tag<a class="headerlink" href="#define-dfhmdf-name-tag" title="Permalink to this headline">¶</a></h5>
<p>The DEFINE-DFHMDF-NAME tag allows a field on the 3270 screen to be given a symbolic name which can be used in a
subsequent GENERATE-HTML tag or COPY-FROM tag.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">DEFINE</span><span class="o">-</span><span class="n">DFHMDF</span><span class="o">-</span><span class="n">NAME</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span> <span class="s2">&quot;name&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>row,col</dt>
<dd>Position (row and column number on the 3270 screen) of the attribute character which precedes the field on the 3270 screen.</dd>
<dt>len</dt>
<dd>Length of the 3270 field (excluding attribute character).</dd>
<dt>name</dt>
<dd>Name to be associated with the field.</dd>
</dl>
<p>The name specified by the DEFINE-DFHMDF-NAME tag can then be used in subsequent GENERATE-HTML tags or COPYFROM tags, instead of specifying an explicit row, column, and length. In addition, the DEFINE-DFHMDF-NAME tag generates an implicit DEFINE-HTML-FIELD-NAME tag.</p>
<p>For example, the following tag defines a 10-character input field having attribute byte at row 1 column 59. The field  itself occupies row 1 columns 60 to 69:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">DEFINE</span><span class="o">-</span><span class="n">DFHMDF</span><span class="o">-</span><span class="n">NAME</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="s2">&quot;XDAT10&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>Subsequently:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">GENERATE</span><span class="o">-</span><span class="n">HTML</span> <span class="s2">&quot;XDAT10&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>is interpreted as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">GENERATE</span><span class="o">-</span><span class="n">HTML</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">COPY</span><span class="o">-</span><span class="n">FROM</span> <span class="s2">&quot;XDAT10&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>is interpreted as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">COPY</span><span class="o">-</span><span class="n">FROM</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>and the following tag will be automatically generated:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">DEFINE</span><span class="o">-</span><span class="n">HTML</span><span class="o">-</span><span class="n">FIELD</span><span class="o">-</span><span class="n">NAME</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="s2">&quot;XDAT10&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>Notice that VIRTEL automatically adjusts the starting position and length as necessary to account for the attribute byte.</p>
<span class="target" id="ug-define-dfhmdf-column"></span></div>
<div class="section" id="define-dfhmdf-column-tag">
<span id="index-37"></span><h5>DEFINE-DFHMDF-COLUMN tag<a class="headerlink" href="#define-dfhmdf-column-tag" title="Permalink to this headline">¶</a></h5>
<p>The DEFINE-DFHMDF-COLUMN tag is similar to the DEFINE-DFHMDF-NAME tag except that it allows the definition of a field which is repeated in the same column position on several consecutive lines of the screen.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">DEFINE</span><span class="o">-</span><span class="n">DFHMDF</span><span class="o">-</span><span class="n">COLUMN</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="n">ht</span><span class="p">)</span> <span class="s2">&quot;name&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>row,col</dt>
<dd>Position (row and column number on the 3270 screen) of the attribute character which precedes the first occurrence of the field on the 3270 screen.</dd>
<dt>len</dt>
<dd>Length of each 3270 field (excluding attribute character).</dd>
<dt>ht</dt>
<dd>Height of column (number of lines).</dd>
<dt>name</dt>
<dd>Name to be associated with the field.</dd>
</dl>
<p>The name specified by the DEFINE-DFHMDF-COLUMN tag can be used in subsequent GENERATE-HTML tags or COPYFROM tags instead of specifying an explicit row, column, and length. The first time the field name is referenced in a GENERATE-HTML or COPY-FROM tag, the first occurrence of the field will be used. Each time the field name is referenced subsequently, the row number is incremented automatically. After the end of the series is reached, any subsequent reference wraps back to the first row number. In addition, the DEFINE-DFHMDF-COLUMN tag implicitly generates a series of DEFINE-HTML-FIELD-NAME tags, each of which contains the field name suffixed by _1, _2, etc.</p>
<p>For example, the following tag defines a column of 5-character input fields having attribute bytes in column 1. The fields themselves occupy columns 2 to 6. The first field is in row 9 and there are 12 occurrences:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">DEFINE</span><span class="o">-</span><span class="n">DFHMDF</span><span class="o">-</span><span class="n">COLUMN</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="s2">&quot;NBLIGN&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>Subsequently:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">GENERATE</span><span class="o">-</span><span class="n">HTML</span> <span class="s2">&quot;NBLIGN&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>is interpreted as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">GENERATE</span><span class="o">-</span><span class="n">HTML</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">COPY</span><span class="o">-</span><span class="n">FROM</span> <span class="s2">&quot;NBLIGN&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>is interpreted as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">COPY</span><span class="o">-</span><span class="n">FROM</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>where n takes the next value in the range 9 to 20. The following tags will be automatically generated:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">DEFINE</span><span class="o">-</span><span class="n">HTML</span><span class="o">-</span><span class="n">FIELD</span><span class="o">-</span><span class="n">NAME</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="s2">&quot;NBLIGN_1&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span><span class="n">DEFINE</span><span class="o">-</span><span class="n">HTML</span><span class="o">-</span><span class="n">FIELD</span><span class="o">-</span><span class="n">NAME</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="s2">&quot;NBLIGN_2&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>and so on until:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">DEFINE</span><span class="o">-</span><span class="n">HTML</span><span class="o">-</span><span class="n">FIELD</span><span class="o">-</span><span class="n">NAME</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="s2">&quot;NBLIGN_12&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>Notice that VIRTEL automatically adjusts the starting positions and lengths as necessary to account for the attribute byte.</p>
</div>
<div class="section" id="generate-variables-tag">
<span id="index-38"></span><h5>GENERATE-VARIABLES tag<a class="headerlink" href="#generate-variables-tag" title="Permalink to this headline">¶</a></h5>
<p>The GENERATE-VARIABLES tag functions like GENERATE-HTML except that, instead of generating HTML, it generates a set of table variables for each attribute found in the designated portion of the screen.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">GENERATE</span><span class="o">-</span><span class="n">VARIABLES</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span> <span class="s2">&quot;prefix&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>row,col</dt>
<dd>Starting position (row and column number on the 3270 screen) of the data to be copied. This starting position will usually contain a 3270 attribute character.</dd>
<dt>len</dt>
<dd>Length of the data to be copied (including attribute characters).</dd>
<dt>prefix</dt>
<dd><p class="first">The prefix of the generated variable names.</p>
<p class="last">A set of these variables is generated for each field found on the screen:</p>
</dd>
<dt>prefixNAME</dt>
<dd>Field name
Example : V00002E9 for an input field, blank for an output field</dd>
<dt>prefixLINE</dt>
<dd>Line position of the field attribute (first line = 1)</dd>
<dt>prefixCOLUMN</dt>
<dd>Column position of the field attribute (first column = 1)</dd>
<dt>prefixLENGTH</dt>
<dd>Field length (excluding attribute)</dd>
<dt>prefixATTRB</dt>
<dd>Attribute: ASKIP, PROT, UNPROT, NUM, BRT, NORM, DET, MDT</dd>
<dt>prefixCOLOR</dt>
<dd>Color: NEUTRAL, BLUE, RED, PINK, GREEN, TURQUOISE, YELLOW, WHITE</dd>
<dt>prefixHILIGHT</dt>
<dd>Highlight: BLINK, REVERSE, UNDERLINE, OFF</dd>
<dt>prefixVALUE</dt>
<dd>The text contained in the field (excluding attribute)</dd>
</dl>
<p>For example, the tag {{{ GENERATE-VARIABLES (01,01,1920) “MYPREFIX” }}} generates a set of table variables describing the entire contents of the 3270 screen. Normally, any binary zeroes in the field will be removed from the VALUE. However, if the BLANK-BINARY-ZEROES option is set (see <a class="reference internal" href="#ug-setting-local-options"><span class="std std-ref">“Setting and unsetting local options”</span></a>) then binary zeroes will be converted to blanks.</p>
</div>
<div class="section" id="generate-vir3270-tag">
<span id="index-39"></span><h5>GENERATE-VIR3270 tag<a class="headerlink" href="#generate-vir3270-tag" title="Permalink to this headline">¶</a></h5>
<p>GENERATE-VIR3270, in conjunction with supporting JavaScript functions, is used by VIRTEL Web Access to generate an HTML page which reproduces as closely as possible the look and feel of a classic 3270 screen.
The GENERATE-VIR3270 tag functions like GENERATE-HTML except that, instead of generating HTML form fields corresponding to 3270 input fields, it generates all 3270 fields as HTML spans. Special attribute keywords are added to each span to indicate the type of field, the screen position, and the 3270 field attributes. A subspan is generated for characters whose character attributes differ from the field attributes. In addition, GENERATE-VIR3270 generates a hidden HTML form field for each 3270 input field, and these fields are written as HTML fragments into a VIRTEL table variable so that they can be inserted later in the page.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">GENERATE</span><span class="o">-</span><span class="n">VIR3270</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span> <span class="s2">&quot;fragvar&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>row,col</dt>
<dd>Starting position (row and column number on the 3270 screen) of the data to be copied.</dd>
<dt>len</dt>
<dd>Length of the data to be copied.</dd>
<dt>fragvar</dt>
<dd>The name of the table variable for the hidden HTML form fields.</dd>
</dl>
<p>The table below shows the HTML attributes generated for each field and 3270 attribute position on the screen:-</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="18%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Attribute  Name</th>
<th class="head">Meaning</th>
<th class="head">Values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>vt=</td>
<td>Field type</td>
<td>O = Output, I = Input, A = 3270 attribute, C = Character subspan</td>
</tr>
<tr class="row-odd"><td>vr=</td>
<td>Row</td>
<td>Row number (first row = 1)</td>
</tr>
<tr class="row-even"><td>vc=</td>
<td>Column</td>
<td>Column number (first column = 1)</td>
</tr>
<tr class="row-odd"><td>vp=</td>
<td>Position</td>
<td>Offset from start of screen (R1C1 = 0)</td>
</tr>
<tr class="row-even"><td>vl=</td>
<td>Length</td>
<td>Length of span or subspan</td>
</tr>
<tr class="row-odd"><td>continuing=</td>
<td>“YES”</td>
<td>Indicates continuation of a field.</td>
</tr>
</tbody>
</table>
<p>An example of the GENERATE-VIR3270 tag is shown below:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;printReady&quot;</span><span class="o">&gt;</span><span class="p">{{{</span><span class="n">GENERATE</span><span class="o">-</span><span class="n">VIR3270</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1920</span><span class="p">)</span> <span class="s2">&quot;INFIELDS&quot;</span><span class="p">}}}</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
<span class="p">{{{</span><span class="n">DEFINE</span><span class="o">-</span><span class="n">HTML</span><span class="o">-</span><span class="n">PFKEY</span> <span class="s2">&quot;pf&quot;</span><span class="p">}}}</span><span class="o">&lt;</span><span class="nb">input</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pf&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;HIDDEN&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;infields&quot;</span><span class="o">&gt;</span>
    <span class="p">{{{</span><span class="n">FOR</span><span class="o">-</span><span class="n">EACH</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">IN</span> <span class="s2">&quot;INFIELDS&quot;</span><span class="p">}}}{{{</span><span class="n">CURRENT</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">OF</span> <span class="s2">&quot;INFIELDS&quot;</span><span class="p">}}}</span>
    <span class="p">{{{</span><span class="n">END</span><span class="o">-</span><span class="n">FOR</span> <span class="s2">&quot;INFIELDS&quot;</span><span class="p">}}}</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Continuing a field after end of a line/or screen.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;printReady&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;mainFont&quot;</span><span class="o">&gt;&lt;</span><span class="n">span</span> <span class="n">vt</span><span class="o">=</span><span class="s2">&quot;I&quot;</span> <span class="n">continuing</span><span class="o">=</span><span class="s2">&quot;YES&quot;</span>
<span class="n">vp</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="n">vr</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="n">vc</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="n">vl</span><span class="o">=</span><span class="s2">&quot;1760&quot;</span> <span class="n">vn</span><span class="o">=</span><span class="s2">&quot;V0000000&quot;</span>  <span class="n">class</span><span class="o">=</span><span class="s2">&quot;NGREEN2&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="colour-and-font-management">
<span id="index-40"></span><h4>Colour and font management<a class="headerlink" href="#colour-and-font-management" title="Permalink to this headline">¶</a></h4>
<p>The management of the size and the colours of the text is effected for all fields by means of the ON-ATTRIBUTE and ON-END-OF-ATTRIBUTE tags. For applications which use 3270 character attributes (order code x’28’), the colour and highlighting of individual characters within a field can be managed by means of the ON-CHARACTER-ATTRIBUTE and ON-END-OF-CHARACTER-ATTRIBUTE tags. Input fields may be supplied with additional information by way of the ADDTO-FIELDS tag.</p>
<div class="section" id="on-attribute-tag">
<span id="index-41"></span><h5>ON-ATTRIBUTE tag<a class="headerlink" href="#on-attribute-tag" title="Permalink to this headline">¶</a></h5>
<p>The ON-ATTRIBUTE and ON-END-OF-ATTRIBUTE tags allow HTML tags to be inserted before and after each field
depending on the 3270 attributes specified by the host application.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="o">..</span><span class="p">,</span><span class="n">pn</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">standard</span> <span class="n">HTML</span> <span class="n">tag</span><span class="o">&gt;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>Inserts the value specified by “standard html tag” before the field when the conditions p1 to pn are fulfilled. The
parameters p1 to pn may appear in any order, each parameter representing one of the following values:</p>
<dl class="docutils">
<dt>p1</dt>
<dd>Type of field: PROTECTED, UNPROTECTED, NON-DISPLAY, NUMERIC, MDTON, DETECTABLE. ALPHANUMERIC, INTENSIFIED, BRIGHT, NORMAL</dd>
<dt>p2</dt>
<dd>Highlighting: NOHILIGHT, BLINK, REVERSE, UNDERSCORE</dd>
<dt>p3</dt>
<dd>Colour: NOCOLOR, BLUE, RED, PINK, GREEN, YELLOW, TURQUOISE, WHITE</dd>
</dl>
<p>When more than one ON-ATTRIBUTE tag matches the same field, the tags are processed in reverse order and the
generated HTML is accumulated from each matching ON-ATTRIBUTE tag. The WITH-NO-MATCH-BELOW keyword
allows an ON-ATTRIBUTE tag to match the field only if no match has been found with the ON-ATTRIBUTE tags already
processed.</p>
</div>
<div class="section" id="on-end-of-attribute-tag">
<span id="index-42"></span><h5>ON-END-OF-ATTRIBUTE tag<a class="headerlink" href="#on-end-of-attribute-tag" title="Permalink to this headline">¶</a></h5>
<p>The presence of the ON-ATTRIBUTE tag requires the presence of an ON-END-OF-ATTRIBUTE tag having the same values
for the p1 to pn parameters.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">END</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="o">..</span><span class="p">,</span><span class="n">pn</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">standard</span> <span class="n">HTML</span> <span class="n">tag</span><span class="o">&gt;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>Inserts the value specified by “standard html tag” after the field when the conditions p1 to pn are fulfilled.
As previously described for the ON-ATTRIBUTE tag, multiple matching ON-END-OF-ATTRIBUTE tags are processed in
reverse order, and the optional WITH-NO-MATCH-BELOW keyword causes the ON-END-OF-ATTRIBUTE tag to match
only if no match has been found with the ON-END-OF-ATTRIBUTE tags already processed.
Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">WITH</span><span class="o">-</span><span class="n">NO</span><span class="o">-</span><span class="n">MATCH</span><span class="o">-</span><span class="n">BELOW</span><span class="p">)</span><span class="o">&lt;</span><span class="n">font</span> <span class="n">color</span><span class="o">=</span><span class="n">green</span><span class="o">&gt;</span><span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">END</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span> <span class="n">WITH</span><span class="o">-</span><span class="n">NO</span><span class="o">-</span><span class="n">MATCH</span><span class="o">-</span><span class="n">BELOW</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">font</span><span class="o">&gt;</span><span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">NORMAL</span><span class="p">,</span><span class="n">NOCOLOR</span><span class="p">)</span><span class="o">&lt;</span><span class="n">font</span> <span class="n">color</span><span class="o">=</span><span class="c1">#00CCFF&gt;}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">END</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">NORMAL</span><span class="p">,</span><span class="n">NOCOLOR</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">font</span><span class="o">&gt;</span><span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">INTENSIFIED</span><span class="p">,</span><span class="n">NOCOLOR</span><span class="p">)</span><span class="o">&lt;</span><span class="n">font</span> <span class="n">color</span><span class="o">=</span><span class="n">white</span><span class="o">&gt;</span><span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">END</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">INTENSIFIED</span><span class="p">,</span><span class="n">NOCOLOR</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">font</span><span class="o">&gt;</span><span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">BLUE</span><span class="p">)</span><span class="o">&lt;</span><span class="n">font</span> <span class="n">color</span><span class="o">=</span><span class="c1">#00CCFF&gt;}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">END</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">BLUE</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">font</span><span class="o">&gt;</span><span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">RED</span><span class="p">)</span><span class="o">&lt;</span><span class="n">font</span> <span class="n">color</span><span class="o">=</span><span class="c1">#c41200&gt;}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">END</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">RED</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">font</span><span class="o">&gt;</span><span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">PINK</span><span class="p">)</span><span class="o">&lt;</span><span class="n">font</span> <span class="n">color</span><span class="o">=</span><span class="n">pink</span><span class="o">&gt;</span><span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">END</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">PINK</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">font</span><span class="o">&gt;</span><span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">GREEN</span><span class="p">)</span><span class="o">&lt;</span><span class="n">font</span> <span class="n">color</span><span class="o">=</span><span class="c1">#00FF00&gt;}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">END</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">GREEN</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">font</span><span class="o">&gt;</span><span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">TURQUOISE</span><span class="p">)</span><span class="o">&lt;</span><span class="n">font</span> <span class="n">color</span><span class="o">=</span><span class="c1">#40E0D0&gt;}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">END</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">TURQUOISE</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">font</span><span class="o">&gt;</span><span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">YELLOW</span><span class="p">)</span><span class="o">&lt;</span><span class="n">font</span> <span class="n">color</span><span class="o">=</span><span class="c1">#FFFF33&gt;}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">END</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">YELLOW</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">font</span><span class="o">&gt;</span><span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">WHITE</span><span class="p">)</span><span class="o">&lt;</span><span class="n">font</span> <span class="n">color</span><span class="o">=</span><span class="n">white</span><span class="o">&gt;</span><span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">END</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">PROTECTED</span><span class="p">,</span><span class="n">WHITE</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">font</span><span class="o">&gt;</span><span class="p">}}}</span>
</pre></div>
</div>
<p><em>Example set of ON-ATTRIBUTE and ON-END-OF-ATTRIBUTE tags</em></p>
</div>
<div class="section" id="on-character-attribute-tag">
<span id="index-43"></span><h5>ON-CHARACTER-ATTRIBUTE tag<a class="headerlink" href="#on-character-attribute-tag" title="Permalink to this headline">¶</a></h5>
<p>If the page template contains ON-CHARACTER-ATTRIBUTE and ON-END-OF-CHARACTER-ATTRIBUTE tags, changes in
colour or highlighting of individual characters within a field are surrounded by the specified HTML code during
processing by GENERATE-HTML. Since HTML code cannot be included in the “value” clause of an input field,
GENERATE-HTML does not generate HTML code for character attributes within input fields.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">CHARACTER</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">standard</span> <span class="n">HTML</span> <span class="n">tag</span><span class="o">&gt;</span> <span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>p1,p2</dt>
<dd>Highlighting and colour parameters as specified for the ON-ATTRIBUTE tag.</dd>
</dl>
</div>
<div class="section" id="on-end-of-character-attribute-tag">
<span id="index-44"></span><h5>ON-END-OF-CHARACTER-ATTRIBUTE tag<a class="headerlink" href="#on-end-of-character-attribute-tag" title="Permalink to this headline">¶</a></h5>
<p>The ON-END-OF-CHARACTER-ATTRIBUTE tag specifies the HTML code to be inserted at the termination of a character
string opened by an ON-CHARACTER-ATTRIBUTE tag.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">ON</span><span class="o">-</span><span class="n">END</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">CHARACTER</span><span class="o">-</span><span class="n">ATTRIBUTE</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">standard</span> <span class="n">HTML</span> <span class="n">tag</span><span class="o">&gt;</span><span class="p">}}}</span>
</pre></div>
</div>
</div>
<div class="section" id="add-to-fields-tag">
<span id="index-45"></span><h5>ADD-TO-FIELDS tag<a class="headerlink" href="#add-to-fields-tag" title="Permalink to this headline">¶</a></h5>
<p>The presence of an ADD-TO-FIELDS tag allows the definition of each HTML input field to be modified according to the 3270 attributes specified by the host application.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">ADD</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">FIELDS</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="o">..</span><span class="p">,</span><span class="n">pn</span><span class="p">)</span> <span class="n">part</span> <span class="n">of</span> <span class="n">standard</span> <span class="n">HTML</span> <span class="n">tag</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>Inserts the value specified by “part of standard html tag” into the HTML &lt;INPUT&gt; tag when the conditions p1 to pn (described in the previous paragraph) are fulfilled.</p>
<p>When more than one ADD-TO-FIELDS tag matches the same field, the tags are processed in order of appearance and the generated HTML is accumulated from each matching ADD-TO-FIELDS tag. The WITH-NO-MATCH-ABOVE keyword
allows an ADD-TO-FIELDS tag to match the field only if no match has been found with the ADD-TO-FIELDS tags already processed.</p>
<p><strong>Example:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">ADD</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">FIELDS</span> <span class="p">(</span><span class="n">NORMAL</span><span class="p">,</span><span class="n">NOCOLOR</span><span class="p">)</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;GREEN&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ADD</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">FIELDS</span> <span class="p">(</span><span class="n">INTENSIFIED</span><span class="p">,</span><span class="n">NOCOLOR</span><span class="p">)</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;RED&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ADD</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">FIELDS</span> <span class="p">(</span><span class="n">BLUE</span><span class="p">)</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;BLUE&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ADD</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">FIELDS</span> <span class="p">(</span><span class="n">RED</span><span class="p">)</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;RED&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ADD</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">FIELDS</span> <span class="p">(</span><span class="n">PINK</span><span class="p">)</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;PINK&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ADD</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">FIELDS</span> <span class="p">(</span><span class="n">GREEN</span><span class="p">)</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;GREEN&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ADD</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">FIELDS</span> <span class="p">(</span><span class="n">TURQUOISE</span><span class="p">)</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;TURQUOISE&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ADD</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">FIELDS</span> <span class="p">(</span><span class="n">YELLOW</span><span class="p">)</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;YELLOW&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ADD</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">FIELDS</span> <span class="p">(</span><span class="n">WHITE</span><span class="p">)</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;WHITE&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">ADD</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">FIELDS</span> <span class="p">(</span><span class="n">DISPLAY</span><span class="p">,</span><span class="n">WITH</span><span class="o">-</span><span class="n">NO</span><span class="o">-</span><span class="n">MATCH</span><span class="o">-</span><span class="n">ABOVE</span><span class="p">)</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;GREEN&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p><em>Example set of ADD-TO-FIELDS tags</em></p>
<p>In the above example, the parameter class makes reference to a style class defined in the HTML page header:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot;&gt;
&lt;style&gt;&lt;!--
.BLUE {font-family: monospace; background: #00CCFF; }
.RED {font-family: monospace; background: red; }
.PINK {font-family: monospace; background: pink; }
.GREEN {font-family: monospace; background: #00FF00;}
.TURQUOISE {font-family: monospace; background: #40E0D0; }
.YELLOW {font-family: monospace; background: #FFFF33;}
.WHITE {font-family: monospace; background: #FFFFFF; }
//--&gt;&lt;/style&gt;
&lt;!--VIRTEL start=&quot;{{{&quot; end=&quot;}}}&quot; --&gt;
&lt;title&gt;Syspertec - example of generation of HTML pages}}} &lt;/title&gt;
&lt;/head&gt;
</pre></div>
</div>
<p><em>Example styles for ADD-TO-FIELDS tags</em></p>
<p>For certain fields, the action of the ADD-TO-FIELDS tag may be nullified by the NO-ADD-TO-CHECKBOX and NO-ADDTO-LISTBOX local options (see <a class="reference internal" href="#ug-setting-local-options"><span class="std std-ref">“Setting and unsetting local options”</span></a>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The ADD-TO-FIELDS tag affects input fields only</p>
</div>
<span class="target" id="ug-cursor-management"></span></div>
</div>
<div class="section" id="cursor-management">
<span id="index-46"></span><h4>Cursor management<a class="headerlink" href="#cursor-management" title="Permalink to this headline">¶</a></h4>
<p>In each message sent from the host application to the browser, VIRTEL automatically manages the positioning of the
cursor insofar as is possible. Conversely, when a message is sent to VIRTEL from the browser, it is necessary to know
the position of the cursor in order to inform the application on the host side. The cursor position cannot be handled
relatively therefore, the cursor’s exact position is communicated via a hidden field specifying the name of the field
having the focus at the time of transmission.
Cursor management is determined by the tags DEFINE-HTML-FOCUS-FIELD, FIELD-WITH-CURSOR, DEFAULT-FIELDWITH-
CURSOR and by two JavaScript procedures. More precise positioning of the cursor can be controlled by the
optional tags DEFINE-CURSOR-POSITION-FIELD and POSITION-OF-THE-CURSOR.</p>
<div class="section" id="define-html-focus-field-tag">
<span id="index-47"></span><h5>DEFINE-HTML-FOCUS-FIELD tag<a class="headerlink" href="#define-html-focus-field-tag" title="Permalink to this headline">¶</a></h5>
<p>The DEFINE-HTML-FOCUS-FIELD tag informs VIRTEL of the existence of the focusField.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">DEFINE</span><span class="o">-</span><span class="n">HTML</span><span class="o">-</span><span class="n">FOCUS</span><span class="o">-</span><span class="n">FIELD</span> <span class="s2">&quot;focusField&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The focusField is a hidden field which will receive the name of the field having the focus, that is to say the input field
on which the cursor is positioned, at the moment of transmission of a message from the browser to VIRTEL.</p>
<p>This field must be defined in the following way:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">INPUT</span> <span class="n">NAME</span><span class="o">=</span><span class="s2">&quot;focusField&quot;</span> <span class="n">TYPE</span><span class="o">=</span><span class="s2">&quot;HIDDEN&quot;</span> <span class="n">VALUE</span><span class="o">=</span><span class="s2">&quot;{{{FIELD-WITH-CURSOR}}}&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="define-cursor-position-field-tag">
<h5>DEFINE-CURSOR-POSITION-FIELD tag<a class="headerlink" href="#define-cursor-position-field-tag" title="Permalink to this headline">¶</a></h5>
<p>The DEFINE-CURSOR-POSITION-FIELD tag informs VIRTEL of the existence of the cursorField.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">DEFINE</span><span class="o">-</span><span class="n">CURSOR</span><span class="o">-</span><span class="n">POSITION</span><span class="o">-</span><span class="n">FIELD</span> <span class="s2">&quot;cursorField&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The cursorField is an optional hidden field in which the JavaScript routines may place the exact position of the cursor
when a message is transmitted from the browser to VIRTEL. The cursor position is indicated by a string of the format
Vnnnnnnn or Pnnnnnnn, where V indicates that the cursor is in a non-protected (input) field, P indicates a protected
(output) field, and nnnnnnn is the hexadecimal offset of the cursor from the start of the screen (where 0000000
represents row 1 column 1).</p>
<p>The cursorField must be defined in the following way:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">INPUT</span> <span class="n">NAME</span><span class="o">=</span><span class="s2">&quot;cursorField&quot;</span> <span class="n">TYPE</span><span class="o">=</span><span class="s2">&quot;HIDDEN&quot;</span> <span class="n">VALUE</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>If both focusField and cursorField are sent to VIRTEL, then VIRTEL will use cursorField to determine the position of the cursor.</p>
</div>
<div class="section" id="field-with-cursor-tag">
<h5>FIELD-WITH-CURSOR tag<a class="headerlink" href="#field-with-cursor-tag" title="Permalink to this headline">¶</a></h5>
<p>The FIELD-WITH-CURSOR tag enables VIRTEL to insert the name of the field having the focus at the time of transmission of the message to the browser.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">FIELD</span><span class="o">-</span><span class="n">WITH</span><span class="o">-</span><span class="n">CURSOR</span> <span class="p">}}}</span>
</pre></div>
</div>
</div>
<div class="section" id="default-field-with-cursor-tag">
<span id="index-48"></span><h5>DEFAULT-FIELD-WITH-CURSOR tag<a class="headerlink" href="#default-field-with-cursor-tag" title="Permalink to this headline">¶</a></h5>
<p>The DEFAULT-FIELD-WITH-CURSOR tag specifies the name generated by the FIELD-WITH-CURSOR tag when the 3270 screen contains no input fields.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">DEFAULT</span><span class="o">-</span><span class="n">FIELD</span><span class="o">-</span><span class="n">WITH</span><span class="o">-</span><span class="n">CURSOR</span> <span class="s2">&quot;fieldname&quot;</span> <span class="o">|</span> <span class="s2">&quot;NOFIELD&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>In the DEFAULT-FIELD-WITH-CURSOR tag, fieldname must be the name of an HTML input field defined in the template
page. If no DEFAULT-FIELD-WITH-CURSOR tag is present, and the screen contains no input fields, VIRTEL will convert
the first field on the screen into an input field, so that the FIELD-WITH-CURSOR tag can generate the name of a valid
input field.</p>
<p>The “NOFIELD” option prevents a dummy field from being created.</p>
</div>
<div class="section" id="positioning-the-focus-when-a-message-is-sent-to-the-browser">
<h5>Positioning the focus when a message is sent to the browser<a class="headerlink" href="#positioning-the-focus-when-a-message-is-sent-to-the-browser" title="Permalink to this headline">¶</a></h5>
<p>The positioning of the focus is done with the help of a JavaScript procedure referenced by the &lt;BODY&gt; tag of the HTML page:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Script for focus position management
&lt;script language=&quot;Javascript&quot;&gt;
&lt;!-- comment to mask script for some browsers
function setfocus()
{
    document.virtelForm.{{{ FIELD-WITH-CURSOR }}}.focus();
}
//--&gt;
&lt;/script&gt;
</pre></div>
</div>
<dl class="docutils">
<dt>Cursor position initialisation</dt>
<dd>&lt;body onload=”setfocus()”&gt;</dd>
</dl>
</div>
<div class="section" id="positioning-the-focus-in-the-browser">
<h5>Positioning the focus in the browser<a class="headerlink" href="#positioning-the-focus-in-the-browser" title="Permalink to this headline">¶</a></h5>
<p>Once present in the client’s browser, the user may need to move the focus to a different field, either by using the TAB key on the keyboard or by using the mouse. The focusField field is automatically updated if the ADD-TO-FIELDS tag calls a script which updates the focus field. Script for saving the name of the field having the focus:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;script language=&quot;Javascript&quot;&gt;
&lt;!-- comment to mask script for some browsers
function savefocus(CurrentFieldName)
{
    document.virtelForm.focusField.value = CurrentFieldName;
}
//--&gt;
&lt;/script&gt;
</pre></div>
</div>
<p><em>Automatic call of the update script</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">ADD</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">FIELDS</span> <span class="n">onfocus</span> <span class="o">=</span> <span class="s2">&quot;savefocus(this.name)&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
</div>
<div class="section" id="position-of-the-cursor-tag">
<span id="index-49"></span><h5>POSITION-OF-THE-CURSOR tag<a class="headerlink" href="#position-of-the-cursor-tag" title="Permalink to this headline">¶</a></h5>
<p>The POSITION-OF-THE-CURSOR tag allows VIRTEL to send the exact position of the cursor to the browser by including a
string of the format Vnnnnnnn or Pnnnnnnn in the HTML page. Vnnnnnnn means that the cursor is in a non-protected
(input) field. Pnnnnnnn means that the cursor is in a protected (output) field. In both cases, nnnnnnn is the
hexadecimal offset of the cursor from the start of the screen (where 0000000 represents row 1 column 1).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">POSITION</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">THE</span><span class="o">-</span><span class="n">CURSOR</span> <span class="p">}}}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="function-key-management">
<span id="index-50"></span><h4>Function key management<a class="headerlink" href="#function-key-management" title="Permalink to this headline">¶</a></h4>
<p>By design, the transmission of information delivered by a 3270 application is effected by using only the function keys, usually the PF and PA keys. Also by design, the navigation from an HTML page is radically different, generally using the mouse to submit requests to the HTTP server. This difference in philosophy makes it difficult, even impossible in certain instances, to detect the use of a function key via the browser. Conserving the ergonomic aspects of the web in an application that allows full use of the function keys is naturally not an easy thing to do, it is, however, made possible by the following functions.</p>
<span class="target" id="ug-pfkfield"></span><span class="target" id="index-51"></span><div class="section" id="definition-of-the-pfkfield-field">
<span id="index-52"></span><h5>Definition of the pfkField field<a class="headerlink" href="#definition-of-the-pfkfield-field" title="Permalink to this headline">¶</a></h5>
<p>As with the management of the cursor, the pfkField is a hidden field designed to accept the name of the function key that VIRTEL must use to transmit data to the application on the host.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">INPUT</span> <span class="n">NAME</span><span class="o">=</span><span class="s2">&quot;pfkField&quot;</span> <span class="n">TYPE</span><span class="o">=</span><span class="s2">&quot;HIDDEN&quot;</span> <span class="n">VALUE</span><span class="o">=</span><span class="s2">&quot;ENTER&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p id="index-53">VIRTEL is notified of the existence of the field by the following tag:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">DEFINE</span><span class="o">-</span><span class="n">HTML</span><span class="o">-</span><span class="n">PFKEY</span> <span class="o">=</span> <span class="s2">&quot;pfkField&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
</div>
<div class="section" id="updating-the-pfkfield">
<h5>Updating the pfkField<a class="headerlink" href="#updating-the-pfkfield" title="Permalink to this headline">¶</a></h5>
<p>The field pfkField is updated by using a JavaScript procedure called at the time of the submission of the request. The script used is referenced in the BUTTON field definition or in the HTML link used for the submission.</p>
<p>Save the name of the field having the focus</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;script language=&quot;Javascript&quot;&gt;
&lt;!-- comment to mask script for some browsers
function submitform(pfkey)
{
    document.virtelForm.pfkField.value = pfkey;
    document.virtelForm.submit();
}
//--&gt;
&lt;/script&gt;
</pre></div>
</div>
<p>Automatic call of the update script from a field of type BUTTON</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">INPUT</span> <span class="n">TYPE</span><span class="o">=</span><span class="s2">&quot;BUTTON&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5&quot;</span> <span class="n">VALUE</span><span class="o">=</span><span class="s2">&quot;PF01&quot;</span>
    <span class="n">onclick</span><span class="o">=</span><span class="s2">&quot;submitform(this.value)&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Automatic call of the SCRIPT from a hypertext link</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;Javascript:submitform(&#39;PF1&#39;)&quot;</span> <span class="o">&gt;</span><span class="n">submit</span> <span class="k">with</span> <span class="n">PF01</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The function keys may be defined in the following manner in the “value” keyword of the INPUT TYPE=BUTTON field.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">3270 function key</th>
<th class="head">PfkField value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ENTER</td>
<td>ENTER</td>
</tr>
<tr class="row-odd"><td>CLEAR SCREEN</td>
<td>CLEAR</td>
</tr>
<tr class="row-even"><td>PA1, PA2, PA3</td>
<td>PA1, PA2, PA3</td>
</tr>
<tr class="row-odd"><td>PF1 to PF24</td>
<td>PF01 to PF24 (variations PF1, F1, F01, P1, P01 are also accepted)</td>
</tr>
<tr class="row-even"><td>Attention</td>
<td>ATTN</td>
</tr>
</tbody>
</table>
<p><em>Function key values for pfkField</em></p>
</div>
<div class="section" id="disallowed-function-keys">
<span id="index-54"></span><h5>Disallowed function keys<a class="headerlink" href="#disallowed-function-keys" title="Permalink to this headline">¶</a></h5>
<p id="index-55">Certain function keys may be explicitly restricted by means of the INVALID-PFKEYS tag containing the list of prohibited PF keys.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">INVALID</span><span class="o">-</span><span class="n">PFKEYS</span> <span class="p">(</span><span class="n">pfk1</span><span class="p">,</span> <span class="n">pfk2</span><span class="p">,</span> <span class="o">..</span> <span class="p">,</span> <span class="n">pfkn</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<p id="index-56">On the other hand, an exhaustive list of authorised function keys may be specified with the VALID-PFKEYS tag.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">VALID</span><span class="o">-</span><span class="n">PFKEYS</span> <span class="p">(</span><span class="n">pfk1</span><span class="p">,</span> <span class="n">pfk2</span><span class="p">,</span> <span class="o">..</span> <span class="p">,</span> <span class="n">pfkn</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>For example, Disallow ATTN, PF08 and PF24</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">INVALID</span><span class="o">-</span><span class="n">PFKEYS</span> <span class="p">(</span><span class="n">ATTN</span><span class="p">,</span><span class="n">PF08</span><span class="p">,</span><span class="n">PF24</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>Disallow all function keys except ENTER and PF03</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">VALID</span><span class="o">-</span><span class="n">PFKEYS</span> <span class="p">(</span><span class="n">ENTER</span><span class="p">,</span><span class="n">PF03</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
</div>
<div class="section" id="pf-key-processing-by-scenario">
<h5>PF key processing by scenario<a class="headerlink" href="#pf-key-processing-by-scenario" title="Permalink to this headline">¶</a></h5>
<p>A page template can generate a “pseudo-PFkey” intended to be interpreted by an INPUT scenario. This is done by setting the pfkField to a value beginning with SCENARIO. The pseudo-PFKey will be accepted by VIRTEL and treated as ENTER, but it will not be transmitted to the application. The scenario can retrieve the value of the pfkField by means of the COPY$ INPUT-TO-VARIABLE instruction.</p>
<p><strong>For example:</strong></p>
<p>Definition of the BUTTON field in the page template:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">DEFINE</span><span class="o">-</span><span class="n">HTML</span><span class="o">-</span><span class="n">PFKEY</span> <span class="s2">&quot;pf&quot;</span> <span class="p">}}}</span>
<span class="o">&lt;</span><span class="n">INPUT</span> <span class="n">TYPE</span><span class="o">=</span><span class="s2">&quot;BUTTON&quot;</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5&quot;</span> <span class="n">VALUE</span><span class="o">=</span><span class="s2">&quot;SCENARIO-DFHMDF&quot;</span>
        <span class="n">onclick</span><span class="o">=</span><span class="s2">&quot;submitform(this.value)&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Retrieving and testing the PF key value in the INPUT scenario:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    COPY$ INPUT-TO-VARIABLE,FIELD=&#39;pf&#39;,VAR=&#39;PF&#39;
    IF$ NOT-FOUND,THEN=NOPARAMS
    CASE$ &#39;PF&#39;,(NE,&#39;SCENARIO-DFHMDF&#39;,NOPARAMS)
* generate the screen capture:
    COPY$ OUTPUT-FILE-TO-VARIABLE, *
        FILE=&#39;DFHMDF.TXT&#39;,VAR=&#39;CAPTURE&#39;
* send result to browser
    SEND$ AS-FILE,VAR=&#39;CAPTURE&#39;, *
        TYPE=&#39;text/plain&#39;,NAME=&#39;dfhmdf.asm&#39;
NOPARAMS EQU *
</pre></div>
</div>
</div>
<div class="section" id="the-null-pf-key">
<span id="index-57"></span><h5>The Null PF key<a class="headerlink" href="#the-null-pf-key" title="Permalink to this headline">¶</a></h5>
<p>A page template or JavaScript program can request VIRTEL to resend the contents of the current 3270 screen, without sending any input to the host application, by setting the pfkField to the value NULL-PF</p>
<span class="target" id="ug-setting-local-options"></span></div>
</div>
<div class="section" id="setting-and-unsetting-local-options">
<span id="index-58"></span><h4>Setting and unsetting local options<a class="headerlink" href="#setting-and-unsetting-local-options" title="Permalink to this headline">¶</a></h4>
<p>The SET-LOCAL-OPTIONS and UNSET-LOCAL-OPTIONS tags allow the activation or deactivation of miscellaneous processing options associated with HTML generation. These options are normally deactivated, but any or all of them can be activated by default using the HTSETn parameters in the VIRTCT. Refer to the VIRTEL Installation Guide for details of the HTSETn parameters. The SET-LOCAL-OPTIONS and UNSET-LOCAL-OPTIONS tags apply only to the current page, and take effect from the point in the page at which they appear.</p>
<p>The options which can be specified are:</p>
<dl class="docutils">
<dt>AUTO-INCREMENT-VARIABLES</dt>
<dd>When this option is activated, table variables referenced outside a FOR-EACH-VALUE-IN loop will be automatically advanced to their next value each time they are reused. If this option is not active, the CURRENT-VALUE-OF tag always produces the first value of a table variable when it is referenced outside a loop.</dd>
<dt>BLANK-BINARY-ZEROES</dt>
<dd>Affects the processing of the COPY-FROM and GENERATE-VARIABLES tags (see <a class="reference internal" href="#ug-inserting-host-data"><span class="std std-ref">“Inserting host application data in a page”</span></a>).</dd>
<dt>DO-NOT-IGNORE-BINARY-ZEROES</dt>
<dd>When this option is activated, then all 3270 NUL characters in input fields generated by VIRTEL will be sent to the browser as SUB characters (x‘1A’). When this option is not activated, then VIRTEL will remove 3270 NUL characters from input fields.</dd>
<dt>HTML-ESCAPES, JAVASCRIPT-ESCAPES, JSON-ESCAPES, NO-ESCAPES, XML-ESCAPES</dt>
<dd>Affects the processing of the CURRENT-VALUE-OF, TRIMMED-VALUE-OF and NO-BLANKS-VALUE-OF tags (see <a class="reference internal" href="#ug-table-variables"><span class="std std-ref">“Handling table variables”</span></a>). Similarly affects the processing of the values generated by GENERATEVARIABLES.</dd>
<dt>ID</dt>
<dd>Indicates that VIRTEL will generate HTML input fields with the parameter “id” in addition to the “name” parameter. The “id” has the same value as the “name”. This is intended for use with JavaScript code which refers to VIRTELgenerated fields using the getElementById method.</dd>
<dt>MAXLENGTH</dt>
<dd>Indicates that VIRTEL will generate HTML input fields with the parameter “maxlength” in addition to “size”. The “maxlength” parameter ensures that the number of characters that can be entered into an HTML field does not exceed the 3270 field length. By default, VIRTEL does not generate “maxlength”, which allows an unlimited number of characters to be entered in each HTML field, and VIRTEL truncates the value as necessary before sending the data to the host application.</dd>
<dt>MDT-IF-RECEIVED</dt>
<dd>When this option is activated, VIRTEL will consider all input fields received from the browser to be “modified” fields to be sent to the host application. Fields in the page not received from the browser are considered to be unmodified and are not sent to the host application. When this option is not activated, VIRTEL inspects the contents of all fields received from the browser to determine whether the field has been modified. VIRTEL sends modified fields to the host application, and any fields not received from the browser are sent as empty fields. Notes: (1) This option must be coded in the page template before the fields to which it applies. (2) This option cannot be specified in the VIRTCT.</dd>
<dt>NO-ADD-TO-CHECKBOX</dt>
<dd>When this option is activated, HTML attributes defined within an ADD-TO-FIELDS tag are not added to &lt;input type=checkbox&gt; clauses generated by the GENERATE-HTML tag in conjunction with the FIELD$ IS-BINARY-CHOICE instruction.</dd>
<dt>NO-ADD-TO-LISTBOX</dt>
<dd>When this option is activated, HTML attributes defined within an ADD-TO-FIELDS tag are not added to &lt;select&gt; clauses generated by the GENERATE-HTML tag in conjunction with the FIELD$ DEFINE-CHOICE or FIELD$ DEFINEVARIABLE-CHOICE instructions.</dd>
<dt>OPTION-DEFAULT-COMPATIBILITY</dt>
<dd>Prior to the version 4.56 the default parameters for the site or the user specific default setting were taken from the values present in a “w2hparm.js” file. The version 4.56 introduces a new way of proceeding to specify these parameters either at the point of entry level but at each transaction level by using the new “option” field in the transaction definition. Using the PTION-DEFAULT-COMPATIBILITY option will maintain compatibility with the previous mode. This option can be made overall when specified in one of the HTRESn parameter of the VIRTCT.</dd>
<dt>TRACE-LINE</dt>
<dd>Setting this option within a page starts a VIRTEL line trace on the HTTP line. Unsetting this option stops the line trace. Refer to the VIRTEL Messages and Operations Guide for more information about line traces.</dd>
<dt>TRACE-RELAY</dt>
<dd>Setting this option within a page starts a VIRTEL terminal trace on the VTAM session. Unsetting this option stops the terminal trace. Refer to the VIRTEL Messages and Operations Guide for more information about terminal traces.</dd>
</dl>
<div class="section" id="set-local-options-tag">
<span id="index-59"></span><h5>SET-LOCAL-OPTIONS tag<a class="headerlink" href="#set-local-options-tag" title="Permalink to this headline">¶</a></h5>
<p>The SET-LOCAL-OPTIONS tag activates one or more HTML processing options for the remainder of the current page, or until deactivated by UNSET-LOCAL-OPTIONS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">LOCAL</span><span class="o">-</span><span class="n">OPTIONS</span> <span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>option</dt>
<dd>one or more HTML processing options as described above</dd>
</dl>
</div>
<div class="section" id="unset-local-options-tag">
<span id="index-60"></span><h5>UNSET-LOCAL-OPTIONS tag<a class="headerlink" href="#unset-local-options-tag" title="Permalink to this headline">¶</a></h5>
<p>The UNSET-LOCAL-OPTIONS tag deactivates one or more HTML processing options previously activated by SET-LOCALOPTIONS or by HTSETn. The specified options are deactivated for the remainder of the current page, or until reactivated by SET-LOCAL-OPTIONS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">UNSET</span><span class="o">-</span><span class="n">LOCAL</span><span class="o">-</span><span class="n">OPTIONS</span> <span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>option</dt>
<dd>one or more HTML processing options as described above.</dd>
</dl>
<span class="target" id="ug-table-variables"></span></div>
</div>
<div class="section" id="handling-table-variables">
<span id="index-61"></span><h4>Handling table variables<a class="headerlink" href="#handling-table-variables" title="Permalink to this headline">¶</a></h4>
<p>A table variable is a list of values sent to VIRTEL by a host application in a structured field of type “FAE5 or FAE6”,^page 247. Table variables may also be created by means of a VIRTEL tag embedded in the page template (see <a class="reference internal" href="#ug-create-variable-from"><span class="std std-ref">“CREATE-VARIABLE-FROM”</span></a>), via a scenario (see <a class="reference internal" href="#ug-copy"><span class="std std-ref">“COPY$ instructions”</span></a>), or by means of a S VARIABLE command contained in the host 3270 data stream (see <a class="reference internal" href="#ug-host4web"><span class="std std-ref">“HOST4WEB commands”</span></a>).</p>
<div class="section" id="for-each-value-in-tag">
<span id="index-62"></span><h5>FOR-EACH-VALUE-IN tag<a class="headerlink" href="#for-each-value-in-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">FOR</span><span class="o">-</span><span class="n">EACH</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">IN</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The FOR-EACH-VALUE-IN tag marks the start of a loop. varname is the name of a table variable. VIRTEL generates everything between the FOR-EACH-VALUE-IN tag and the END-FOR tag once for each value in varname. If varname has no values then nothing is generated. The current value of varname, and of any other table variables referenced in the loop, changes when the END-FOR tag is encountered.</p>
</div>
<div class="section" id="current-value-of-tag">
<span id="index-63"></span><h5>CURRENT-VALUE-OF tag<a class="headerlink" href="#current-value-of-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">CURRENT</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">OF</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The CURRENT-VALUE-OF tag is used in a loop bracketed by the FOR-EACH-VALUE-IN and END-FOR tags. varname is the name of a table variable. If it is the variable named in the FOR-EACH-VALUE-IN tag, it determines the number of iterations of the loops. Otherwise, its value is simply changed when the END-FOR tag is encountered.</p>
<p>The CURRENT-VALUE-OF tag also allows variables to be inserted in a template page outside of a FOR-EACH-VALUE-IN loop. In this case, the variable varname must have been created from the HTTP request by an INPUT scenario by means of the COPY$ INPUT-TO-VARIABLE instruction.</p>
<p>The local options HTML-ESCAPES, JAVASCRIPT-ESCAPES, JSON-ESCAPES, NO-ESCAPES, and XML-ESCAPES (see <a class="reference internal" href="#ug-setting-local-options"><span class="std std-ref">“Setting and unsetting local options”</span></a>) may affect the processing of this tag.</p>
<p>If the HTML-ESCAPES local option is set, special characters in the value of the variable will be replaced by the corresponding HTML escape sequence as shown in the table below:-</p>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Character</th>
<th class="head">HTML escape sequence</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&lt;</td>
<td>&amp;lt;</td>
</tr>
<tr class="row-odd"><td>&gt;</td>
<td>&amp;gt;</td>
</tr>
<tr class="row-even"><td>“</td>
<td>&amp;quote;</td>
</tr>
<tr class="row-odd"><td>&amp;</td>
<td>&amp;amp;</td>
</tr>
</tbody>
</table>
<p>If the JAVASCRIPT-ESCAPES local option is set, special characters in the value of the variable will be replaced by the corresponding JavaScript escape sequence as shown in the table below:-</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Character</th>
<th class="head">JavaScript escape sequence</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>“</td>
<td>&quot;</td>
</tr>
<tr class="row-odd"><td>‘</td>
<td>'</td>
</tr>
<tr class="row-even"><td>\</td>
<td>\ \</td>
</tr>
</tbody>
</table>
<p>If the JSON-ESCAPES local option is set, special characters in the value of the variable will be replaced by the corresponding JSON escape sequence as shown in the table below:-</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Character</th>
<th class="head">JSON escape sequence</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>“</td>
<td>&quot;</td>
</tr>
<tr class="row-odd"><td>\</td>
<td>\ \</td>
</tr>
<tr class="row-even"><td>Hex 00 to 1f</td>
<td>\uxxxx</td>
</tr>
</tbody>
</table>
<p>If the XML-ESCAPES local option is set, special characters in the value of the variable will be replaced by the corresponding XML escape sequence as shown in the table below:-</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Character</td>
<td>HTML escape sequence</td>
</tr>
<tr class="row-even"><td>&lt;</td>
<td>&amp;#60;</td>
</tr>
<tr class="row-odd"><td>&gt;</td>
<td>&amp;#62;</td>
</tr>
<tr class="row-even"><td>“</td>
<td>&quot;</td>
</tr>
<tr class="row-odd"><td>&amp;</td>
<td>&amp;#38;</td>
</tr>
<tr class="row-even"><td>‘</td>
<td>'</td>
</tr>
</tbody>
</table>
<p>Setting any of the HTML-ESCAPES, JAVASCRIPT-ESCAPES, JSON-ESCAPES, or XML-ESCAPES local options causes the other options to be automatically unset.</p>
<p>Setting the NO-ESCAPES local option disables all escape processing.</p>
</div>
<div class="section" id="no-blanks-value-of-tag">
<span id="index-64"></span><h5>NO-BLANKS-VALUE-OF tag<a class="headerlink" href="#no-blanks-value-of-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">NO</span><span class="o">-</span><span class="n">BLANKS</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">OF</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The NO-BLANKS-VALUE-OF tag is similar to the CURRENT-VALUE-OF tag, but the value is truncated at the first blank.</p>
</div>
<div class="section" id="trimmed-value-of-tag">
<h5>TRIMMED-VALUE-OF tag<a class="headerlink" href="#trimmed-value-of-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">TRIMMED</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">OF</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The TRIMMED-VALUE-OF tag is similar to the CURRENT-VALUE-OF tag, except that leading and trailing blanks (if any) are removed from the value before it is substituted in the page.</p>
</div>
<div class="section" id="end-for-tag">
<h5>END-FOR tag<a class="headerlink" href="#end-for-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">END</span><span class="o">-</span><span class="n">FOR</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The END-FOR tag marks the end of a loop started by the FOR-EACH-VALUE-IN tag.</p>
</div>
<div class="section" id="advance-to-next-value-of">
<span id="index-65"></span><h5>ADVANCE-TO-NEXT-VALUE-OF<a class="headerlink" href="#advance-to-next-value-of" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">ADVANCE</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">NEXT</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">OF</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The ADVANCE-TO-NEXT-VALUE-OF tag causes subsequent references to the table variable varname (via the CURRENTVALUE-OF tag, the TRIMMED-VALUE-OF tag, or the NO-BLANKS-VALUE-OF tag) to refer to the next value in the table.</p>
</div>
<div class="section" id="do-count-up-with-tag">
<span id="index-66"></span><h5>DO-COUNT-UP-WITH tag<a class="headerlink" href="#do-count-up-with-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">DO</span><span class="o">-</span><span class="n">COUNT</span><span class="o">-</span><span class="n">UP</span><span class="o">-</span><span class="n">WITH</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The DO-COUNT-UP-WITH tag marks the start of a loop. varname is the name of a variable. VIRTEL generates everything between the DO-COUNT-UP-WITH tag and the END-DO-COUNT tag n times, where n is the current value of varname. During the execution of the loop, the value of varname varies from 1 to n, and other table variables referenced in the loop change when the END-DO-COUNT tag is encountered.</p>
</div>
<div class="section" id="end-do-count-tag">
<span id="index-67"></span><h5>END-DO-COUNT tag<a class="headerlink" href="#end-do-count-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">END</span><span class="o">-</span><span class="n">DO</span><span class="o">-</span><span class="n">COUNT</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The END-DO-COUNT tag marks the end of a loop started by the DO-COUNT-UP-WITH tag.</p>
</div>
<div class="section" id="define-automatic-counter-tag">
<span id="index-68"></span><h5>DEFINE-AUTOMATIC-COUNTER tag<a class="headerlink" href="#define-automatic-counter-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">DEFINE</span><span class="o">-</span><span class="n">AUTOMATIC</span><span class="o">-</span><span class="n">COUNTER</span> <span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">incr</span><span class="p">,</span> <span class="nb">max</span><span class="p">)</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The DEFINE-AUTOMATIC-COUNTER tag allows automatic generation of a counter variable in a loop started by the FOREACH-VALUE-IN tag. The parameters are:</p>
<dl class="docutils">
<dt>init</dt>
<dd>the initial value of the counter variable</dd>
<dt>incr</dt>
<dd>the increment added at each END-FOR</dd>
<dt>max</dt>
<dd>the maximum value of the counter variable</dd>
<dt>varname</dt>
<dd>the name of the counter variable</dd>
</dl>
<p>The variable generated can be the loop master variable (the variable named in the FOR-EACH-VALUE-IN) or a slave variable. When the counter reaches its maximum value, the loop terminates if it is the master, or continues if it is the slave. In the latter case the counter variable starts again from its initial value.</p>
</div>
<div class="section" id="define-sub-variable-tag">
<span id="index-69"></span><h5>DEFINE-SUB-VARIABLE tag<a class="headerlink" href="#define-sub-variable-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">DEFINE</span><span class="o">-</span><span class="n">SUB</span><span class="o">-</span><span class="n">VARIABLE</span> <span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="s2">&quot;subname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The DEFINE-SUB-VARIABLE tag allows a sub-variable to be defined. A sub-variable remaps part of the current value of the loop master variable in a FOR-EACH-VALUE-IN loop. The parameters are:</p>
<dl class="docutils">
<dt>offset</dt>
<dd>the offset of the sub-variable in the loop master variable</dd>
<dt>length</dt>
<dd>the length (in characters) of the sub-variable</dd>
<dt>count</dt>
<dd>the number of occurrences of the sub-variable</dd>
<dt>subname</dt>
<dd>the name of the sub-variable</dd>
</dl>
<p>A sub-variable consists of count values, each of length bytes, starting at offset in the loop master variable. The first byte of the loop master variable is considered to be offset 0. Sub-variables are defined outside but referenced within a FOR-EACH-VALUE-IN loop. A sub-variable can be referenced wherever a normal table variable would be valid, including the loop master variable of an inner FOR-EACH-VALUE-IN loop, which could in itself be redefined by other sub-variables. When the sub-variable is referenced, it acts as an implicit redefinition of the current value of the master variable of the innermost FOR-EACH-VALUE-IN loop in which the reference appears. Thus, the same sub-variable could possibly redefine different loop master variables if it is referenced in more than one place.</p>
<p id="index-70"><strong>Examples</strong></p>
<p>A host application uses an FAE5 structured field to create a table variable called HOSTDATA. The HOSTDATA variable consists of an array of 20-byte records. Each record consists of an 8-byte key, followed by six 2-byte codes. The following code generates an HTML table from this data. Each row of the table contains the row number, the key, and the codes. A hyperlink is generated for each code, by removing any trailing blanks from the code and appending “.html”:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">DEFINE</span><span class="o">-</span><span class="n">AUTOMATIC</span><span class="o">-</span><span class="n">COUNTER</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">9999</span><span class="p">)</span> <span class="s2">&quot;ROWNUM&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span><span class="n">DEFINE</span><span class="o">-</span><span class="n">SUB</span><span class="o">-</span><span class="n">VARIABLE</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="s2">&quot;KEY&quot;</span><span class="p">}}}</span>
<span class="p">{{{</span><span class="n">DEFINE</span><span class="o">-</span><span class="n">SUB</span><span class="o">-</span><span class="n">VARIABLE</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="s2">&quot;CODES&quot;</span><span class="p">}}}</span>
<span class="o">&lt;</span><span class="n">table</span><span class="o">&gt;&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Row</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Key</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">6</span><span class="o">&gt;</span><span class="n">Codes</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="p">{{{</span><span class="n">FOR</span><span class="o">-</span><span class="n">EACH</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">IN</span> <span class="s2">&quot;HOSTDATA&quot;</span><span class="p">}}}</span>
    <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{{</span><span class="n">CURRENT</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">OF</span> <span class="s2">&quot;ROWNUM&quot;</span><span class="p">}}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{{</span><span class="n">CURRENT</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">OF</span> <span class="s2">&quot;KEY&quot;</span><span class="p">}}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="p">{{{</span><span class="n">FOR</span><span class="o">-</span><span class="n">EACH</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">IN</span> <span class="s2">&quot;CODES&quot;</span><span class="p">}}}</span>
    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s1">&#39;{{{NO-BLANKS-VALUE-OF &quot;CODES&quot;}}}.html&#39;</span><span class="o">&gt;</span>
        <span class="p">{{{</span><span class="n">CURRENT</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">OF</span> <span class="s2">&quot;CODES&quot;</span><span class="p">}}}</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="p">{{{</span><span class="n">END</span><span class="o">-</span><span class="n">FOR</span> <span class="s2">&quot;CODES&quot;</span><span class="p">}}}</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<span class="p">{{{</span><span class="n">END</span><span class="o">-</span><span class="n">FOR</span> <span class="s2">&quot;HOSTDATA&quot;</span><span class="p">}}}</span>
<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="delete-all-variables-tag">
<span id="index-71"></span><h5>DELETE-ALL-VARIABLES tag<a class="headerlink" href="#delete-all-variables-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">DELETE</span><span class="o">-</span><span class="n">ALL</span><span class="o">-</span><span class="n">VARIABLES</span><span class="p">}}}</span>
<span class="p">{{{</span><span class="n">DELETE</span><span class="o">-</span><span class="n">ALL</span><span class="o">-</span><span class="n">VARIABLES</span> <span class="s2">&quot;prefix&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The DELETE-ALL-VARIABLES tag deletes all variables in the VIRTEL variable pool. An optional prefix parameter allows deletion of only those variables whose names begin with the specified prefix.</p>
</div>
</div>
<div class="section" id="inserting-virtel-configuration-values-into-a-template">
<span id="index-72"></span><h4>Inserting VIRTEL configuration values into a template<a class="headerlink" href="#inserting-virtel-configuration-values-into-a-template" title="Permalink to this headline">¶</a></h4>
<div class="section" id="ip-address-of-line-tag">
<span id="index-73"></span><h5>IP-ADDRESS-OF-LINE tag<a class="headerlink" href="#ip-address-of-line-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">IP</span><span class="o">-</span><span class="n">ADDRESS</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">LINE</span> <span class="s2">&quot;n-xxxxxx&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The IP-ADDRESS-OF-LINE tag will be replaced by the IP address of the specified VIRTEL line. For example, {{{IPADDRESS-OF-LINE “H-HTTP”}}} might generate 192.168.229.147.</p>
</div>
<div class="section" id="ip-port-of-line-tag">
<span id="index-74"></span><h5>IP-PORT-OF-LINE tag<a class="headerlink" href="#ip-port-of-line-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">IP</span><span class="o">-</span><span class="n">PORT</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">LINE</span> <span class="s2">&quot;n-xxxxxx&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The IP-PORT-OF-LINE tag will be replaced by the port number of the specified VIRTEL line. For example, {{{IP-PORT-OFLINE”H-HTTP”}}} might generate 41000</p>
</div>
<div class="section" id="name-of-tag">
<span id="index-75"></span><h5>NAME-OF tag<a class="headerlink" href="#name-of-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">NAME</span><span class="o">-</span><span class="n">OF</span> <span class="p">(</span><span class="n">xxxxxx</span><span class="p">)}}}</span>
<span class="p">{{{</span><span class="n">NAME</span><span class="o">-</span><span class="n">OF</span> <span class="p">(</span><span class="n">xxxxxx</span><span class="p">,</span> <span class="nb">len</span><span class="p">)}}}</span>
</pre></div>
</div>
<p>The NAME-OF tag allows the insertion in a page of various data items related to the VIRTEL transaction in progress.</p>
<dl class="docutils">
<dt>xxxxxx</dt>
<dd><p class="first">the name of the data item to be inserted. Valid values are:</p>
<dl class="last docutils">
<dt>VIRTEL</dt>
<dd>The VIRTEL APPLID specified in the VIRTCT</dd>
<dt>RELAY</dt>
<dd>The relay LU name used to connect to the host application</dd>
<dt>PRINT-RELAY</dt>
<dd>The relay LU name of the associated printer</dd>
<dt>TERMINAL</dt>
<dd>The DNS name or IP address of a terminal.</dd>
<dt>PSEUDO-TERMINAL</dt>
<dd>The VIRTEL terminal name</dd>
<dt>ENTRY-POINT</dt>
<dd>The VIRTEL entry point name</dd>
<dt>LINE-INTERNAL</dt>
<dd>The internal name of the VIRTEL line</dd>
<dt>LINE-EXTERNAL</dt>
<dd>The external name of the VIRTEL line</dd>
<dt>GROUP</dt>
<dd>The user’s group name, if signon has occurred</dd>
<dt>USER</dt>
<dd>The user’s user name, if signon has occurred</dd>
<dt>PASSWORD</dt>
<dd>The user’s password, if signon has occurred</dd>
<dt>USER-IP-ADDRESS</dt>
<dd>The IP address of the client terminal</dd>
<dt>SNA-STATUS</dt>
<dd><dl class="first last docutils">
<dt>The status of the host LU2 session:</dt>
<dd><ul class="first last simple">
<li>X: input is inhibited</li>
<li>blank: input is allowed</li>
</ul>
</dd>
</dl>
</dd>
<dt>TRANSACTION-INTERNAL</dt>
<dd>The internal name of the VIRTEL transaction</dd>
<dt>TRANSACTION-EXTERNAL</dt>
<dd>The external name of the VIRTEL transaction</dd>
<dt>URL</dt>
<dd>The URL excluding the query string</dd>
<dt>QUERY</dt>
<dd>The query string from the URL</dd>
<dt>PAGE</dt>
<dd>The name of the current HTML page template</dd>
<dt>PAGE-INTERNAL</dt>
<dd>The name of the original HTML page template specified in the URL</dd>
<dt>DIRECTORY</dt>
<dd>The current VIRTEL directory name</dd>
<dt>CHARACTER-SET</dt>
<dd>The name of the current UTF-8 character set, or the country code if the page is not in UTF-8 mode (see <a class="reference internal" href="#ug-ebcdic-translation"><span class="std std-ref">“EBCDIC translation management”</span></a>)</dd>
<dt>DATE-TIME</dt>
<dd>The current date and time (14 characters in the format YYYYMMDDHHMMSS)</dd>
<dt>VIRTEL-VERSION</dt>
<dd>The VIRTEL version number</dd>
<dt>xxx-SYMBOL</dt>
<dd>The value of the system symbol xxx (only if SYSPLUS=YES is specified in the VIRTCT). Example: SYSNAME-SYMBOL</dd>
<dt>len</dt>
<dd>An optional length. If specified, the value of the data item will be padded with blanks or truncated on the right to the specified length.</dd>
</dl>
</dd>
</dl>
<p><strong>Notes on using Terminal data item</strong></p>
<p>For this to work, it is necessary to specify a value to the 3rd sub-parameter of the TCP1= (or TCP2=) parameter in the VIRTCT. (Any value may be specified). Not yet implemented in VSE. For example:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TCP1</span><span class="o">=</span><span class="p">(</span><span class="n">TCPIP</span><span class="p">,,</span><span class="n">DNS</span><span class="p">,</span><span class="mi">65535</span><span class="p">),</span>
</pre></div>
</div>
<p>During Virtel integration, the following messages will appear in the Virtel log:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">+</span><span class="n">VIRDNS1W</span> <span class="n">TKP1</span> <span class="n">DNS</span> <span class="n">SUBTASK</span> <span class="n">DNS</span>      <span class="n">STARTING</span> <span class="n">VIRDNS1</span>
<span class="o">+</span><span class="n">VIRDNS2W</span> <span class="n">TKP1</span> <span class="n">DNS</span> <span class="n">SUBTASK</span> <span class="n">VIRDNS1</span>  <span class="n">STARTED</span>
</pre></div>
</div>
<p>An example scenario might look like:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ SYSTEM-TO-VARIABLE,VAR=&#39;TERMINAL&#39;,                      *
      FIELD=(NAME-OF,TERMINAL)
ERROR$ 0,&#39;TERMINAL: &#39;,&#39;*TERMINAL&#39;
</pre></div>
</div>
<p>The above example would disply this in the Virtel log:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">VIRHT51I</span> <span class="n">DEMOHTTP</span> <span class="n">CONNECTING</span> <span class="n">HTLOC005</span> <span class="n">TO</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">092.058</span><span class="p">:</span><span class="mi">53786</span>
<span class="n">TERMINAL</span><span class="p">:</span> <span class="n">w8</span><span class="o">-</span><span class="n">jmsaby</span><span class="o">.</span><span class="n">syspertec</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
</div>
<div class="section" id="number-of-tag">
<span id="index-76"></span><h5>NUMBER-OF tag<a class="headerlink" href="#number-of-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">NUMBER</span><span class="o">-</span><span class="n">OF</span> <span class="p">(</span><span class="n">xxxxxx</span><span class="p">)}}}</span>
</pre></div>
</div>
<p>The NUMBER-OF tag allows the insertion in a page of various data items related to the VIRTEL transaction in progress.</p>
<dl class="docutils">
<dt>xxxxxx</dt>
<dd>The name of the data item to be inserted. Valid values are:</dd>
<dt>SCREEN-COLUMNS</dt>
<dd>The width of the current host 3270 screen</dd>
<dt>SCREEN-LINES</dt>
<dd>The depth of the current host 3270 screen</dd>
</dl>
</div>
</div>
<div class="section" id="conditional-generation">
<span id="index-77"></span><h4>Conditional generation<a class="headerlink" href="#conditional-generation" title="Permalink to this headline">¶</a></h4>
<div class="section" id="after-not-last-value-of-tag">
<span id="index-78"></span><h5>AFTER-NOT-LAST-VALUE-OF tag<a class="headerlink" href="#after-not-last-value-of-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">AFTER</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">LAST</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">OF</span> <span class="s2">&quot;varname&quot;</span> <span class="o">...</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The AFTER-NOT-LAST-VALUE-OF tag brackets a section of the page which is to be generated for all except the last iteration of a FOR-EACH-VALUE-IN loop. The HTML content represented by “…” is generated unless the current value of the variable varname is the last in the table. The AFTER-NOT-LAST-VALUE-OF tag is useful, for example, when generating a comma-separated list of values, as shown in the example below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="p">{{{</span><span class="n">FOR</span><span class="o">-</span><span class="n">EACH</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">IN</span> <span class="s2">&quot;MYVAR&quot;</span><span class="p">}}}</span> <span class="s2">&quot;{{{CURRENT-VALUE-OF &quot;</span><span class="n">MYVAR</span><span class="s2">&quot;}}} &quot;</span>
<span class="p">{{{</span><span class="n">AFTER</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">LAST</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">OF</span> <span class="s2">&quot;MYVAR&quot;</span> <span class="p">,}}}{{{</span><span class="n">END</span><span class="o">-</span><span class="n">FOR</span> <span class="s2">&quot;MYVAR&quot;</span><span class="p">}}}</span> <span class="p">]</span>
</pre></div>
</div>
<p>If the variable myvar contains the values 1, 2, and 3, then this example would generate [ “1”, “2”, “3” ]</p>
</div>
<div class="section" id="if-user-is-allowed-to-tag">
<span id="index-79"></span><h5>IF-USER-IS-ALLOWED-TO tag<a class="headerlink" href="#if-user-is-allowed-to-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">IF</span><span class="o">-</span><span class="n">USER</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">ALLOWED</span><span class="o">-</span><span class="n">TO</span> <span class="s2">&quot;resourcename&quot;</span> <span class="o">...</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The IF-USER-IS-ALLOWED-TO tag brackets a section of the page whose appearance is conditional on the user’s authorization to access the resource resourcename. The HTML content represented by “…” is generated only if the signed-on user is authorized to access the specified resource.</p>
</div>
<div class="section" id="when-exists-and-end-when-exists-tags">
<span id="index-80"></span><h5>WHEN-EXISTS and END-WHEN-EXISTS tags<a class="headerlink" href="#when-exists-and-end-when-exists-tags" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">WHEN</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
<span class="o">...</span>
<span class="p">{{{</span><span class="n">END</span><span class="o">-</span><span class="n">WHEN</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The WHEN-EXISTS and END-WHEN-EXISTS tags bracket a section of the page whose appearance is conditional on the existence of a named table variable. The variable can be created by a VIRTEL Web Integration application using the FAE5 or FAE6 structured fields, or it can be created by a scenario. The HTML content represented by “…” is generated only if the named variable exists in the context of the current page and has at least one value.</p>
</div>
<div class="section" id="when-not-exists-and-end-when-not-exists-tags">
<span id="index-81"></span><h5>WHEN-NOT-EXISTS and END-WHEN-NOT-EXISTS tags<a class="headerlink" href="#when-not-exists-and-end-when-not-exists-tags" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">WHEN</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
<span class="o">...</span>
<span class="p">{{{</span><span class="n">END</span><span class="o">-</span><span class="n">WHEN</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The WHEN-NOT-EXISTS and END-WHEN-NOT-EXISTS tags are similar to the WHEN-EXISTS and END-WHEN-EXISTS tags, except that the section of the page enclosed by the tags is generated only if the named table variable does not exist.</p>
</div>
<div class="section" id="when-not-blank-and-end-when-not-blank-tags">
<span id="index-82"></span><h5>WHEN-NOT-BLANK and END-WHEN-NOT-BLANK tags<a class="headerlink" href="#when-not-blank-and-end-when-not-blank-tags" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">WHEN</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">BLANK</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
<span class="o">...</span>
<span class="p">{{{</span><span class="n">END</span><span class="o">-</span><span class="n">WHEN</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">BLANK</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The WHEN-NOT-BLANK and END-WHEN-NOT-BLANK tags bracket a section of the page which is generated only if the current value of a named table variable is non-blank. The HTML content represented by “…” is omitted if the named variable does not exist, or if its current value is null or all blanks.</p>
</div>
<div class="section" id="when-next-event-and-end-when-next-event-tags">
<span id="index-83"></span><h5>WHEN-NEXT-EVENT and END-WHEN-NEXT-EVENT tags<a class="headerlink" href="#when-next-event-and-end-when-next-event-tags" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">WHEN</span><span class="o">-</span><span class="n">NEXT</span><span class="o">-</span><span class="n">EVENT</span> <span class="s2">&quot;eventname&quot;</span><span class="p">}}}</span>
<span class="o">...</span>
<span class="p">{{{</span><span class="n">END</span><span class="o">-</span><span class="n">WHEN</span><span class="o">-</span><span class="n">NEXT</span><span class="o">-</span><span class="n">EVENT</span> <span class="s2">&quot;eventname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The WHEN-NEXT-EVENT and END-WHEN-NEXT-EVENT tags allow an XML template to be written which uses variables generated by a commarea-to-output conversion scenario. These tags work in conjunction with the $EVENT$ variable generated by the “MAP$ EVENTUAL-AREA and <a class="reference internal" href="#ug-map-eventual-elsethen"><span class="std std-ref">MAP$ ELSE-THEN-AREA”</span></a>. The section of the page enclosed by the WHEN-NEXT-EVENT and END-WHEN-NEXT-EVENT tags is generated only if the current value of the $EVENT$ variable matches the specified eventname.</p>
</div>
<div class="section" id="while-event-and-end-while-event-tags">
<span id="index-84"></span><h5>WHILE-EVENT and END-WHILE-EVENT tags<a class="headerlink" href="#while-event-and-end-while-event-tags" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">WHILE</span><span class="o">-</span><span class="n">EVENT</span> <span class="s2">&quot;eventname&quot;</span><span class="p">}}}</span>
<span class="o">...</span>
<span class="p">{{{</span><span class="n">END</span><span class="o">-</span><span class="n">WHILE</span><span class="o">-</span><span class="n">EVENT</span> <span class="s2">&quot;eventname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The WHILE-EVENT and END-WHILE-EVENT tags work in conjunction with the $EVENT$ variable generated by the <a class="reference internal" href="#ug-map-eventual-elsethen"><span class="std std-ref">“MAP$ EVENTUAL-AREA and MAP$ ELSE-THEN-AREA”</span></a>. The WHILE-EVENT tag marks the start of a loop. Everything between the WHILE-EVENT and END-WHILE-EVENT tags is generated once for each value of the $EVENT$ variable, as long as the current value of the $EVENT$ variable matches the specified eventname
.</p>
<span class="target" id="ug-debugging-create-variable"></span></div>
</div>
<div class="section" id="debugging-facilities">
<span id="index-85"></span><h4>Debugging facilities<a class="headerlink" href="#debugging-facilities" title="Permalink to this headline">¶</a></h4>
<span class="target" id="ug-create-variable-if"></span><div class="section" id="create-variable-if-tracing-scenario-tag">
<span id="index-86"></span><h5>CREATE-VARIABLE-IF(TRACING-SCENARIO) tag<a class="headerlink" href="#create-variable-if-tracing-scenario-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">CREATE</span><span class="o">-</span><span class="n">VARIABLE</span><span class="o">-</span><span class="n">IF</span> <span class="p">(</span><span class="n">TRACING</span><span class="o">-</span><span class="n">SCENARIO</span><span class="p">)</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The CREATE-VARIABLE-IF tag with the TRACING-SCENARIO parameter retrieves the contents of the scenario trace created by the <a class="reference internal" href="#ug-capability-tokens"><span class="std std-ref">“Capability Tokens”</span></a>). If the trace is active, the variable varname will be created. The value of this variable is a JSON structure (see example below) which can be used by Virtel Studio.</p>
<p>The trace data for a specific terminal may be obtained by specifying an x-Virtel-Debug=capability-token parameter in the URL. The <a class="reference internal" href="#ug-capability-tokens"><span class="std std-ref">“capability tokens”</span></a> is generated by a SET-HEADER tag issued by the terminal which owns the trace data.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;scenario&quot;</span><span class="p">:</span><span class="s2">&quot;EXECUTE3&quot;</span><span class="p">,</span> <span class="s2">&quot;externalName&quot;</span><span class="p">:</span><span class="s2">&quot;EXECUTE3&quot;</span><span class="p">,</span>
<span class="s2">&quot;compiled&quot;</span><span class="p">:</span><span class="s2">&quot;02/04/13 18.49 &quot;</span><span class="p">,</span> <span class="s2">&quot;terminal&quot;</span><span class="p">:</span><span class="s2">&quot;HTVTA012&quot;</span><span class="p">,</span> <span class="s2">&quot;relay&quot;</span><span class="p">:</span><span class="s2">&quot;R5HVT511&quot;</span><span class="p">,</span>
<span class="s2">&quot;trace&quot;</span><span class="p">:[</span>
<span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span><span class="s2">&quot;20:38:41.14&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">:</span><span class="s2">&quot;00014A&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">:</span><span class="s2">&quot;COPY$&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span><span class="s2">&quot;20:38:41.14&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">:</span><span class="s2">&quot;00015E&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">:</span><span class="s2">&quot;TOVAR$&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span><span class="s2">&quot;20:38:41.14&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">:</span><span class="s2">&quot;000046&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">:</span><span class="s2">&quot;MAP$&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span><span class="s2">&quot;20:38:41.14&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">:</span><span class="s2">&quot;000058&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">:</span><span class="s2">&quot;MAP$&quot;</span><span class="p">,</span><span class="s2">&quot;p&quot;</span><span class="p">:[{</span><span class="s2">&quot;Customer&quot;</span><span class="p">:</span><span class="s2">&quot;A0111115&quot;</span><span class="p">}]},</span>
<span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span><span class="s2">&quot;20:38:41.14&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">:</span><span class="s2">&quot;000066&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">:</span><span class="s2">&quot;MAP$&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span><span class="s2">&quot;20:38:41.14&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">:</span><span class="s2">&quot;000078&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">:</span><span class="s2">&quot;MAP$&quot;</span><span class="p">,</span><span class="s2">&quot;p&quot;</span><span class="p">:[{</span><span class="s2">&quot;Datemin&quot;</span><span class="p">:</span><span class="s2">&quot;20110505&quot;</span><span class="p">}]},</span>
<span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span><span class="s2">&quot;20:38:41.14&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">:</span><span class="s2">&quot;000086&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">:</span><span class="s2">&quot;MAP$&quot;</span><span class="p">,</span><span class="s2">&quot;p&quot;</span><span class="p">:[{</span><span class="s2">&quot;Datemax&quot;</span><span class="p">:</span><span class="s2">&quot;20110525&quot;</span><span class="p">}]},</span>
<span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span><span class="s2">&quot;20:38:41.14&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">:</span><span class="s2">&quot;000110&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">:</span><span class="s2">&quot;MAP$&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span><span class="s2">&quot;20:38:41.14&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">:</span><span class="s2">&quot;000170&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">:</span><span class="s2">&quot;CASE$&quot;</span><span class="p">,</span><span class="s2">&quot;p&quot;</span><span class="p">:[{</span><span class="s2">&quot;CURLINE&quot;</span><span class="p">:</span><span class="s2">&quot;0&quot;</span><span class="p">}]},</span>
<span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span><span class="s2">&quot;20:38:41.14&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">:</span><span class="s2">&quot;0001FC&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">:</span><span class="s2">&quot;COPY$&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;t&quot;</span><span class="p">:</span><span class="s2">&quot;20:38:41.14&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">:</span><span class="s2">&quot;000214&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">:</span><span class="s2">&quot;COPY$&quot;</span><span class="p">}]}</span>
</pre></div>
</div>
<p><em>Exampleof a JSON structure generated by TRACING-SCENARIO</em></p>
<p>For more informations, see <a class="reference internal" href="#ug-create-variable-if"><span class="std std-ref">“CREATE-VARIABLE-IF”</span></a>.</p>
</div>
</div>
<div class="section" id="signon-and-password-management">
<span id="index-87"></span><h4>Signon and password management<a class="headerlink" href="#signon-and-password-management" title="Permalink to this headline">¶</a></h4>
<div class="section" id="create-variable-if-condition-tag">
<span id="index-88"></span><h5>CREATE-VARIABLE-IF(Condition) tag<a class="headerlink" href="#create-variable-if-condition-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">CREATE</span><span class="o">-</span><span class="n">VARIABLE</span><span class="o">-</span><span class="n">IF</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="s2">&quot;varname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The CREATE-VARIABLE-IF tag allows the conditional creation of a VIRTEL variable. If the specified condition is true, the variable varname will be created and initialized with a value as shown in the list of condition names below. This variable can be used subsequently to conditionally generate a section of the page bracketed by WHEN-EXISTS and END-WHEN-EXISTS tags.</p>
<p>The possible values of the condition parameter for the CREATE-VARIABLE-IF tag are listed below:-</p>
<dl class="docutils">
<dt>SIGNON-IS-NEEDED</dt>
<dd>The variable varname is created if a signon is needed, i.e. if the
transaction security type is non-zero and the user has not yet
successfully signed on at the terminal.</dd>
<dt>SIGNON-IS-OK</dt>
<dd>The variable varname is created if the user has successfully signed
on at the terminal. The initial value of the variable is the user
name.</dd>
<dt>APPLICATION-IS-CONNECTED</dt>
<dd><p class="first">The variable varname is created if the terminal is connected to a
host application. The initial value of the variable is either the
VTAM application name, or the external name of the VIRTEL
transaction, depending on the value of the AIC parameter in the
VIRTCT (see “Parameters of the VIRTCT” in the VIRTEL Installation
Guide).</p>
<p class="last">For more informations, see <a class="reference internal" href="#ug-debugging-create-variable"><span class="std std-ref">“CREATE-VARIABLE-IF”</span></a>, in the “Debugging facilities” section.</p>
</dd>
</dl>
</div>
<div class="section" id="declare-field-as-tag">
<span id="index-89"></span><h5>DECLARE-FIELD-AS tag<a class="headerlink" href="#declare-field-as-tag" title="Permalink to this headline">¶</a></h5>
<p>When used in conjunction with a security type 4 transaction, the DECLARE-FIELD-AS tag allows VIRTEL to obtain the userid and password from fields embedded in the HTML page. For an example, see <a class="reference internal" href="#ug-signon-using-html"><span class="std std-ref">“Signon using HTML fields”</span></a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">DECLARE</span><span class="o">-</span><span class="n">FIELD</span><span class="o">-</span><span class="n">AS</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span><span class="o">...</span><span class="p">)</span> <span class="s2">&quot;fieldname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The DECLARE-FIELD-AS tag indicates to VIRTEL that the HTML field whose name is fieldname is to be treated as a userid or password field when used with a transaction defined as having security type 4. One of more attribute values must be specified. The possible attributes are listed below:-</p>
<dl class="docutils">
<dt>USERNAME</dt>
<dd>Indicates that the field contains the name of the user (userid) to be signed on.</dd>
<dt>PASSWORD</dt>
<dd>Indicates that the field contains the user’s password.</dd>
<dt>NEW-PASSWORD</dt>
<dd>Indicates that the field contains a new password. VIRTEL will request the security product to change the user’s current password to the new value if the signon is successful.</dd>
<dt>HEX</dt>
<dd>Indicates that VIRTEL expects the browser to encode the field in hexadecimal.</dd>
<dt>BASE64</dt>
<dd>Indicates that VIRTEL expects the browser to encode the field in base64 format.</dd>
<dt>ENCRYPTED</dt>
<dd>Indicates that VIRTEL expects the browser to encrypt the field using the session key specified elsewhere in the page (see <a class="reference internal" href="#ug-declare-field-crypto"><span class="std std-ref">“DECLARE-FIELD-AS CRYPTO-SESSION-KEY”</span></a>).</dd>
</dl>
<p>Examples:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">DECLARE</span><span class="o">-</span><span class="n">FIELD</span><span class="o">-</span><span class="n">AS</span> <span class="p">(</span><span class="n">USERNAME</span><span class="p">)</span> <span class="s2">&quot;USERNAME&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span><span class="n">DECLARE</span><span class="o">-</span><span class="n">FIELD</span><span class="o">-</span><span class="n">AS</span> <span class="p">(</span><span class="n">PASSWORD</span><span class="p">,</span><span class="n">BASE64</span><span class="p">)</span> <span class="s2">&quot;PASSWORD&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span><span class="n">DECLARE</span><span class="o">-</span><span class="n">FIELD</span><span class="o">-</span><span class="n">AS</span> <span class="p">(</span><span class="n">NEW</span><span class="o">-</span><span class="n">PASSWORD</span><span class="p">,</span><span class="n">ENCRYPTED</span><span class="p">)</span> <span class="s2">&quot;NEWPASS&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The same field can be both declared and defined:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">DEFINE</span><span class="o">-</span><span class="n">HTML</span><span class="o">-</span><span class="n">FIELD</span><span class="o">-</span><span class="n">NAME</span> <span class="p">(</span><span class="mi">04</span><span class="p">,</span><span class="mi">06</span><span class="p">,</span><span class="mi">08</span><span class="p">)</span> <span class="s2">&quot;NOM&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span><span class="n">DECLARE</span><span class="o">-</span><span class="n">FIELD</span><span class="o">-</span><span class="n">AS</span> <span class="p">(</span><span class="n">BASE64</span><span class="p">)</span> <span class="s2">&quot;NOM&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The above example indicates that the field NOM is transmitted to VIRTEL in base64 format. In this case, the DEFINE must precede the DECLARE.</p>
<span class="target" id="ug-user-signon-code"></span><p id="index-90">USER-SIGNON-CODE tag</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">USER</span><span class="o">-</span><span class="n">SIGNON</span><span class="o">-</span><span class="n">CODE</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The USER-SIGNON-CODE tag generates a unique value called a signoncode which may be used with the VirtelUserSignon parameter of the URL to propagate the signed-on user’s credentials to another page (see <a class="reference internal" href="#ug-signon-propagation"><span class="std std-ref">“Propagation of signon by URL”</span></a>).</p>
</div>
</div>
<div class="section" id="encryption-management">
<span id="index-91"></span><h4>Encryption management<a class="headerlink" href="#encryption-management" title="Permalink to this headline">¶</a></h4>
<p>The presence of certain tags in a page template causes VIRTEL to generate encryption keys and to encrypt and decrypt selected data in the page. The use of these tags is dependent upon the specification of a CRYPTn parameter in the VIRTCT (see “Parameters of the VIRTCT”) in the VIRTEL Installation Guide manual.</p>
<p id="index-92">ENCRYPTION-PARAMETERS tag</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">ENCRYPTION</span><span class="o">-</span><span class="n">PARAMETERS</span> <span class="s2">&quot;cryptname&quot;</span><span class="p">}}}</span>
<span class="p">{{{</span><span class="n">ENCRYPTION</span><span class="o">-</span><span class="n">PARAMETERS</span> <span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="s2">&quot;cryptname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The ENCRYPTION-PARAMETERS tag inserts into the page the contents of one or all fields of the CRYPTn parameter whose name field is cryptname. If the VIRTCT does not contain a CRYPTn parameter with name cryptname then the ENCRYPTION-PARAMETERS tag returns a null value.</p>
<p>If the optional field parameter is specified, the ENCRYPTION-PARAMETERS tag returns the specified or defaulted value of one field of the CRYPTn parameter, without quotes. The names of the fields are:-</p>
<dl class="docutils">
<dt>NAME</dt>
<dd>The name of this set of encryption parameters.</dd>
<dt>ALGORITHM</dt>
<dd>The symmetric encryption algorithm.</dd>
<dt>INITIAL-ALGORITHM</dt>
<dd>The asymmetric encryption algorithm.</dd>
<dt>DRIVER</dt>
<dd>The name of the encryption engine.</dd>
<dt>FORMAT</dt>
<dd>The encoding used for encrypted text.</dd>
<dt>CHAINING</dt>
<dd>The chaining method for symmetric encryption.</dd>
<dt>PADDING</dt>
<dd>The padding method for symmetric encryption.</dd>
</dl>
<p>If the field parameter is not specified, then the ENCRYPTION-PARAMETERS tag returns the specified or defaulted values of all fields of the CRYPTn parameter. Each value is surrounded by single quotes and the values are separated by commas.</p>
<p>Example: If the VIRTCT contains the following parameters:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CRYPT1</span><span class="o">=</span><span class="p">(</span><span class="n">CRYPTNULL</span><span class="p">,</span><span class="n">NONE</span><span class="p">,</span><span class="n">NONE</span><span class="p">,</span><span class="n">NO</span><span class="o">-</span><span class="n">ENCRYPTION</span><span class="p">,</span><span class="n">HEX</span><span class="p">),</span> <span class="o">*</span>
<span class="n">CRYPT2</span><span class="o">=</span><span class="p">(</span><span class="n">CRYPT3270</span><span class="p">,</span><span class="mi">3</span><span class="n">TDEA</span><span class="p">,</span><span class="n">RSA</span><span class="o">-</span><span class="mi">1024</span><span class="p">,</span><span class="n">ICSF</span><span class="p">,</span><span class="n">HEX</span><span class="p">),</span> <span class="o">*</span>
</pre></div>
</div>
<p>then the tag {{{ENCRYPTION-PARAMETERS (ALGORITHM) “CRYPT3270”}}} returns the value 3TDEA, and the tag {{{ENCRYPTION-PARAMETERS “CRYPT3270”}}}
returns the value ‘CRYPT3270’,‘3TDEA’,’RSA-1024’,’ICSF’,’HEX’,’CBC’,’PKCS7’</p>
<div class="section" id="public-key-tag">
<span id="index-93"></span><h5>PUBLIC-KEY tag<a class="headerlink" href="#public-key-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">PUBLIC</span><span class="o">-</span><span class="n">KEY</span> <span class="p">(</span><span class="n">component</span><span class="p">)</span> <span class="s2">&quot;cryptname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The presence of one or more PUBLIC-KEY tags in a page template causes VIRTEL to generate a public/private key pair for the session, and to insert the value of the specified component of the public key into the page. The public/private key pair is generated according to the INITIAL-ALGORITHM specified in the CRYPTn parameter whose name field is cryptname. If the VIRTCT does not contain a CRYPTn parameter with name cryptname then no key is generated and
the PUBLIC-KEY tag returns a null value.</p>
<dl class="docutils">
<dt>component</dt>
<dd>is the name of the public key component to be inserted into the page. Possible values are:</dd>
<dt>EXPONENT</dt>
<dd>The hexadecimal value of the public exponent.</dd>
<dt>MODULUS</dt>
<dd>The hexadecimal value of the modulus.</dd>
</dl>
</div>
<div class="section" id="index-94">
<span id="id2"></span><h5>DECLARE-FIELD-AS tag<a class="headerlink" href="#index-94" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default" id="ug-declare-field-crypto"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">DECLARE</span><span class="o">-</span><span class="n">FIELD</span><span class="o">-</span><span class="n">AS</span> <span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="s2">&quot;fieldname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>When used in conjunction with the PUBLIC-KEY tag, the DECLARE-FIELD-AS tag indicates to VIRTEL that the HTML field whose name is fieldname is to be treated as an encrypted session key. VIRTEL decrypts the contents of the field using the corresponding private key (which is known only to VIRTEL) and uses it as the session key when symmetric encryption is requested by the SET-LOCAL-OPTIONS (ENCRYPT-PASSWORD-FIELDS) tag. The possible attributes are listed below:</p>
<dl class="docutils">
<dt>CRYPTO-SESSION-KEY</dt>
<dd>indicates that the field contains the session key encrypted under the public key specified by the PUBLIC-KEY tag.</dd>
</dl>
</div>
<div class="section" id="index-95">
<span id="id3"></span><h5>SET-LOCAL-OPTIONS tag<a class="headerlink" href="#index-95" title="Permalink to this headline">¶</a></h5>
<p>When used in conjunction with the PUBLIC-KEY and DECLARE-FIELD-AS (CRYPTO-SESSION-KEY) tags, the SET-LOCALOPTIONS
tag activates encryption for selected fields that are sent and received in HTML pages.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">LOCAL</span><span class="o">-</span><span class="n">OPTIONS</span> <span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>option</dt>
<dd>the following values indicate the use of encryption :</dd>
<dt>ENCRYPT-PASSWORD-FIELDS</dt>
<dd>indicates that 3270 non-display unprotected (data entry) fields are encrypted in both inbound and outbound messages, and that 3270 non-display protected (output only) fields are replaced by blanks in outbound messages.</dd>
</dl>
<p>Encryption is performed according to the symmetric encryption method indicated by the CRYPTn parameter specified by the PUBLIC-KEY tag, using the session key specified by the DECLARE-FIELD-AS (CRYPTO-SESSION-KEY) tag. The GENERATE-HTML tag automatically adds an additional VCRYPT attribute to each encrypted field.</p>
</div>
</div>
<div class="section" id="ebcdic-translation-management">
<span id="ug-ebcdic-translation"></span><h4>EBCDIC translation management<a class="headerlink" href="#ebcdic-translation-management" title="Permalink to this headline">¶</a></h4>
<p>By default, VIRTEL translates host application EBCDIC data into ISO-8859-1 before sending it to the browser. This default behaviour is suitable for Western European and English speaking countries. The COUNTRY parameter in the VIRTCT indicates which EBCDIC country codepage is used by host applications, and serves to select the appropriate default EBCDIC-to-ISO-8859-1 translation table within VIRTEL. Translation tables other than the default may be selected by means of the SET-COUNTRY-CODE tag.</p>
<span class="target" id="ug-set-country-code"></span><div class="highlight-default" id="index-96"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">SET</span><span class="o">-</span><span class="n">COUNTRY</span><span class="o">-</span><span class="n">CODE</span> <span class="s2">&quot;countryname&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The SET-COUNTRY-CODE tag allows the 3270 host application data to be translated to ISO-8859-1 according to an EBCDIC codepage other than the default codepage implied by the COUNTRY parameter in the VIRTCT. It may also be used to translate from the French EBCDIC codepage to ASCII Western European codepage 850, or to translate from Latin-2 EBCDIC Multilingual (CP870) to either ISO-8859-2 Latin-2 (CP912) or PC Latin-2 (CP852).</p>
<p>This tag takes effect starting from the point where it appears in the template page, and it may appear multiple times in
a single page. The possible values for the countryname parameter are shown in the table below:-</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="37%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Country name</th>
<th class="head">EBCDIC codepage</th>
<th class="head">ASCII codepage</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>US</td>
<td>CP 037</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-odd"><td>FR</td>
<td>CP 297</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-even"><td>NO</td>
<td>CP 277</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-odd"><td>IT</td>
<td>CP 280</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-even"><td>GB (UK)</td>
<td>CP 285</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-odd"><td>FR-850</td>
<td>CP 297</td>
<td>CP 850</td>
</tr>
<tr class="row-even"><td>L2</td>
<td>CP 870</td>
<td>ISO-8859-2</td>
</tr>
<tr class="row-odd"><td>P2</td>
<td>CP 870</td>
<td>CP 852</td>
</tr>
<tr class="row-even"><td>DE</td>
<td>CP 273</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-odd"><td>BE</td>
<td>CP 500</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-even"><td>FI</td>
<td>CP 278</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-odd"><td>ES (SP)</td>
<td>CP 284</td>
<td>ISO-8859-1</td>
</tr>
<tr class="row-even"><td>IS (IC)</td>
<td>CP 871</td>
<td>ISO-8859-1</td>
</tr>
</tbody>
</table>
<p><em>Country Codes for EBCDIC to ASCII translation</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Values in parentheses are accepted for compatibility with previous versions of VIRTEL</p>
</div>
<div class="section" id="country-code-tag">
<span id="index-97"></span><h5>COUNTRY-CODE tag<a class="headerlink" href="#country-code-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">COUNTRY</span><span class="o">-</span><span class="n">CODE</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The COUNTRY-CODE tag inserts the country code into the page, where it can be tested by JavaScript.</p>
</div>
<div class="section" id="set-output-encoding-utf-8-tag">
<span id="index-98"></span><h5>SET-OUTPUT-ENCODING-UTF-8 tag<a class="headerlink" href="#set-output-encoding-utf-8-tag" title="Permalink to this headline">¶</a></h5>
<p>For countries which use a non-Western European language, VIRTEL can generate data in UTF-8 encoding instead of
ISO-8859-1. This is done by embedding the SET-OUTPUT-ENCODING-UTF-8 tag in the page template:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">OUTPUT</span><span class="o">-</span><span class="n">ENCODING</span><span class="o">-</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> <span class="s2">&quot;charset&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The SET-OUTPUT-ENCODING-UTF-8 tag indicates that host data inserted in the template page by VIRTEL is to be in UTF-8 format, translated according to the EBCDIC country codepage whose name is specified within quotes. The possible values for charset are given under the description of the DEFUTF8 parameter of the VIRTCT. If no charset value is specified, as for example {{{SET-OUTPUT-ENCODING-UTF-8 “”}}}, then the default value of charset is the codepage
specified by the DEFUTF8 parameter of the VIRTCT described in the VIRTEL Installation Guide.</p>
<p>When SET-OUTPUT-ENCODING-UTF-8 is specified, the rest of the template page must also be coded in UTF-8, and, in the case of an HTML page, must contain the HTML tag:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=UTF-8&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>In the case of an XML page, no such instruction is needed because XML is considered to be encoded in UTF8 by default.</p>
<p><strong>Examples</strong></p>
<p>A 3270 application generates US EBCDIC (CECP 037). The following statements, coded between the &lt;HEAD&gt; and &lt;/HEAD&gt; tags in the template page, ensure the correct translation of this application’s data:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">SET</span><span class="o">-</span><span class="n">COUNTRY</span><span class="o">-</span><span class="n">CODE</span> <span class="s2">&quot;US&quot;</span><span class="p">}}}</span>
<span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=iso-8859-1&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Another 3270 application generates output using the Chinese Simplified EBCDIC character set (IBM1388). The output is to be translated to UTF-8 and inserted into a template page which must also be encoded in UTF-8:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">SET</span><span class="o">-</span><span class="n">OUTPUT</span><span class="o">-</span><span class="n">ENCODING</span><span class="o">-</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> <span class="s2">&quot;IBM1388&quot;</span><span class="p">}}}</span>
<span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=UTF-8&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>A third 3270 application generates output using the Spanish EBCDIC character set, which is to be translated to UTF-8 and inserted into the template page. In this example, we assume that the parameter DEFUTF8=IBM1145 has been specified in the VIRTCT, so we can use this as the default value for the SET-OUTPUT-ENCODING-UTF-8 tag:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">SET</span><span class="o">-</span><span class="n">OUTPUT</span><span class="o">-</span><span class="n">ENCODING</span><span class="o">-</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> <span class="s2">&quot;&quot;</span><span class="p">}}}</span>
<span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=UTF-8&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>In each case, the {{{SET}}} statement tells VIRTEL what character set to generate, while the &lt;META&gt; statement tells the browser what character set to expect. If you specify neither SET-OUTPUT-ENCODING-UTF-8 nor SET-COUNTRY-CODE, then VIRTEL will generate ISO-8859-1 according to the default COUNTRY parameter specified in the VIRTCT.</p>
</div>
</div>
<div class="section" id="http-protocol-management">
<span id="index-99"></span><h4>HTTP protocol management<a class="headerlink" href="#http-protocol-management" title="Permalink to this headline">¶</a></h4>
<p>Normally when VIRTEL delivers a page via HTTP it includes an HTTP response status code of “200 OK”. The SET-HTTPRETURN-CODE allows the page to specify an alternative HTTP response status code. This may be useful, for example, in a page which contains an error message from an application.</p>
<div class="section" id="set-http-return-code-tag">
<span id="index-100"></span><h5>SET-HTTP-RETURN-CODE tag<a class="headerlink" href="#set-http-return-code-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">HTTP</span><span class="o">-</span><span class="n">RETURN</span><span class="o">-</span><span class="n">CODE</span> <span class="s2">&quot;rc text&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The SET-HTTP-RETURN-CODE tag indicates to VIRTEL the HTTP status code and supplementary text which will be sent in the HTTP response message when this page is delivered. rc is a 3-digit numeric status code, as defined by RFC 2616, and text is the text which accompanies the numeric code.</p>
<p><strong>Example :</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;!--VIRTEL start=&quot;{{{&quot; end=&quot;}}}&quot; --&gt;
&lt;html&gt;&lt;body&gt;&lt;h1&gt;Database record not found&lt;/h1&gt;
{{{SET-HTTP-RETURN-CODE &quot;404 Not in DB2&quot;}}}
&lt;p&gt;The requested record was not found in the database.
&lt;/body&gt;&lt;/html&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="cache-management">
<span id="index-101"></span><h4>Cache management<a class="headerlink" href="#cache-management" title="Permalink to this headline">¶</a></h4>
<p>When delivering static elements such as menu pages, images, and JavaScript programs, VIRTEL indicates to the browser that the element is eligible to be stored in the browser’s cache. This improves performance because the browser does not have to request the element from VIRTEL each time it is required. By contrast, dynamic elements (i.e. elements which contain VIRTEL tags) are generally marked as non-cacheable because their content is likely to
change each time the page is requested. The VIRTEL tags described in this section are used to override the default cacheable/non-cacheable behaviour.</p>
<div class="section" id="set-page-cacheable-tag">
<span id="index-102"></span><h5>SET-PAGE-CACHEABLE tag<a class="headerlink" href="#set-page-cacheable-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">PAGE</span><span class="o">-</span><span class="n">CACHEABLE</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>When an element contains a SET-PAGE-CACHEABLE tag, VIRTEL will generate two HTTP headers: an Expires: header which indicates that the browser may cache the element until midnight, and a Last-Modified:.header which contains the date that the element was uploaded to VIRTEL. This is the default for static elements.</p>
</div>
<div class="section" id="set-page-not-cacheable-tag">
<span id="index-103"></span><h5>SET-PAGE-NOT-CACHEABLE tag<a class="headerlink" href="#set-page-not-cacheable-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">PAGE</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">CACHEABLE</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>When an element contains a SET-PAGE-NOT-CACHEABLE tag, VIRTEL will generate an Expires: 0 HTTP header indicating that the browser should not store the element in its cache. This is the default for dynamic elements.</p>
</div>
<div class="section" id="set-max-age-tag">
<span id="index-104"></span><h5>SET-MAX-AGE tag<a class="headerlink" href="#set-max-age-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">MAX</span><span class="o">-</span><span class="n">AGE</span> <span class="s2">&quot;secs&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>When an element contains a SET-MAX-AGE tag, VIRTEL will not generate the normal Expires: and Last-Modified:.HTTP headers, but instead it will generate a Cache-Control: max-age=secs header, where secs represents the validity time (in seconds) during which the browser may keep the element in its cache.^</p>
</div>
</div>
<div class="section" id="mime-type-management">
<span id="index-105"></span><h4>MIME type management<a class="headerlink" href="#mime-type-management" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL associates a MIME-type with each page template or other element stored in a directory. VIRTEL always sends the MIME-type to the browser when the browser requests any element. Some browsers use the MIME-type to determine how to display the element. For example, HTML pages must have MIME-type “text/html”, XML pages must have MIME-type “text/xml”, JPG files must have MIME-type “image/jpeg”, etc.</p>
<p>VIRTEL normally sets the MIME-type to the value indicated by the browser or mailer at the time the page is uploaded. However, in certain cases VIRTEL may force the MIME-type to a different value:-</p>
<ul class="simple">
<li>If the filename extension is .HTM or .HTML, or is absent, VIRTEL will force the MIME-type to be “text/html”. This is because some versions of Internet Explorer upload HTML files using MIME-type “text/plain”</li>
<li>If the file contains a SET-CONTENT-TYPE tag, then VIRTEL will force the MIME-type to the value specified in the tag</li>
</ul>
<div class="section" id="set-content-type-tag">
<span id="index-106"></span><h5>SET-CONTENT-TYPE tag<a class="headerlink" href="#set-content-type-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">SET</span><span class="o">-</span><span class="n">CONTENT</span><span class="o">-</span><span class="n">TYPE</span> <span class="s2">&quot;mimetype&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The SET-CONTENT-TYPE tag allows the administrator to override the MIME-type supplied by the browser or mailer when the element is uploaded. VIRTEL stores the value of the parameter mimetype in the directory with the element. In the following example, the page template is to be stored with a MIME-type which will cause the browser to process it as spreadsheet data:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">SET</span><span class="o">-</span><span class="n">CONTENT</span><span class="o">-</span><span class="n">TYPE</span> <span class="s2">&quot;application/vnd.ms-excel&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<span class="target" id="ug-capability-tokens"></span></div>
</div>
<div class="section" id="capability-tokens">
<span id="index-107"></span><h4>Capability tokens<a class="headerlink" href="#capability-tokens" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL capability tokens permit an HTTP transaction to access data associated with an transaction running on another terminal. The token is delivered by VIRTEL by means of an x-Virtel HTTP response header from the terminal which owns the capability, and the same token is returned to VIRTEL in a subsequent URL sent by the terminal which wishes to use the capability (see <a class="reference internal" href="#ug-capability-types"><span class="std std-ref">“Capability URLs”</span></a>). The x-Virtel HTTP header is generated by a SET-HEADER tag
embedded in a page template sent by the terminal which owns the capability.</p>
<span class="target" id="ug-set-header"></span><p id="index-108">SET-HEADER tag</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">HEADER</span> <span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="s2">&quot;header-string&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>When the SET-HEADER tag is present in a page template, VIRTEL generates an HTTP response header.</p>
<p>When type is one of the VIRTEL capability types listed below, the quoted string header-string is the name of the header; this name should start with x-Virtel- should end with a colon (:) and should not contain blanks. The capability value is an opaque string added by VIRTEL.</p>
<p>When type is AS-IS the quoted string header-string is a complete header (including value) to be added as-is. No capability processing is performed in this case.</p>
<span class="target" id="ug-capability-types"></span><p id="index-109">The VIRTEL capability types are:-</p>
<dl class="docutils">
<dt>TO-ALLOW-READ-OF-SCENARIO-TRACE</dt>
<dd>Generates a capability token which permits a subsequent requester to obtain this terminal’s trace data by means of the CREATE-VARIABLE-IF TRACING-SCENARIO tag described on page 61.</dd>
<dt>GIVING-ACCESS-TO-%USER%-DIRECTORY-WITH-MY-USERID</dt>
<dd>The capability token generated by this tag may be used by a subsequent request to access a directory which has %USER% in the keyword field of its definition. The userid of the capability owning transaction will be used as the directory key when the directory is accessed.</dd>
<dt>GIVING-ACCESS-TO-%GROUP%-DIRECTORY-WITH-MY-USERID</dt>
<dd>The capability token generated by this tag may be used by a subsequent request to access a directory which has %GROUP% in the keyword field of its definition. The RACF group name of the capability owning transaction will be used as the directory key when the directory is accessed.</dd>
<dt>GIVING-ACCESS-TO-%USER%-DIRECTORY-IN-VARIABLE-%USER%</dt>
<dd>The capability token generated by this tag may be used by a subsequent request to access a directory which has %USER% in the keyword field of its definition. The value of the %USER% variable of the capability owning transaction will be used as the directory key when the directory is accessed.</dd>
<dt>GIVING-ACCESS-TO-%GROUP%-DIRECTORY-IN-VARIABLE-%GROUP%</dt>
<dd>The capability token generated by this tag may be used by a subsequent request to access a directory which has %GROUP% in the keyword field of its definition. The value of the %GROUP% variable of the capability owning transaction will be used as the directory key when the directory is accessed.</dd>
</dl>
<p><strong>Examples:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">HEADER</span> <span class="p">(</span><span class="n">AS</span><span class="o">-</span><span class="n">IS</span><span class="p">)</span> <span class="s2">&quot;Cache-control: no-cache&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">HEADER</span> <span class="p">(</span><span class="n">TO</span><span class="o">-</span><span class="n">ALLOW</span><span class="o">-</span><span class="n">READ</span><span class="o">-</span><span class="n">OF</span><span class="o">-</span><span class="n">SCENARIO</span><span class="o">-</span><span class="n">TRACE</span><span class="p">)</span> <span class="s2">&quot;x-Virtel-Debug:&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">HEADER</span> <span class="p">(</span><span class="n">GIVING</span><span class="o">-</span><span class="n">ACCESS</span><span class="o">-</span><span class="n">TO</span><span class="o">-%</span><span class="n">USER</span><span class="o">%-</span><span class="n">DIRECTORY</span><span class="o">-</span><span class="n">IN</span><span class="o">-</span><span class="n">VARIABLE</span><span class="o">-%</span><span class="n">USER</span><span class="o">%</span><span class="p">)</span>
    <span class="s2">&quot;x-Virtel-User-Directory:&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">HEADER</span> <span class="p">(</span><span class="n">GIVING</span><span class="o">-</span><span class="n">ACCESS</span><span class="o">-</span><span class="n">TO</span><span class="o">-%</span><span class="n">USER</span><span class="o">%-</span><span class="n">DIRECTORY</span><span class="o">-</span><span class="n">WITH</span><span class="o">-</span><span class="n">MY</span><span class="o">-</span><span class="n">USERID</span><span class="p">)</span>
    <span class="s2">&quot;x-Virtel-User-Directory:&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">HEADER</span> <span class="p">(</span><span class="n">GIVING</span><span class="o">-</span><span class="n">ACCESS</span><span class="o">-</span><span class="n">TO</span><span class="o">-%</span><span class="n">GROUP</span><span class="o">%-</span><span class="n">DIRECTORY</span><span class="o">-</span><span class="n">IN</span><span class="o">-</span><span class="n">VARIABLE</span><span class="o">-%</span><span class="n">GROUP</span><span class="o">%</span><span class="p">)</span>
    <span class="s2">&quot;x-Virtel-Group-Directory:&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">HEADER</span> <span class="p">(</span><span class="n">GIVING</span><span class="o">-</span><span class="n">ACCESS</span><span class="o">-</span><span class="n">TO</span><span class="o">-%</span><span class="n">GROUP</span><span class="o">%-</span><span class="n">DIRECTORY</span><span class="o">-</span><span class="n">WITH</span><span class="o">-</span><span class="n">MY</span><span class="o">-</span><span class="n">USERID</span><span class="p">)</span>
    <span class="s2">&quot;x-Virtel-Group-Directory:&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
</div>
<div class="section" id="template-page-upload">
<span id="index-110"></span><h4>Template Page upload<a class="headerlink" href="#template-page-upload" title="Permalink to this headline">¶</a></h4>
<p>The SECURITY-TOKEN and IF-SECURITY-TOKEN-IS-READY tags are used during uploading of HTML pages from a browser (see <a class="reference internal" href="#ug-uploading-html-pages"><span class="std std-ref">“Uploading pages by HTTP (secured by cookie)”</span></a>).</p>
<div class="section" id="security-token-tag">
<span id="index-111"></span><h5>SECURITY-TOKEN tag<a class="headerlink" href="#security-token-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">SECURITY</span><span class="o">-</span><span class="n">TOKEN</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>If the SECURITY-TOKEN tag is present in a template page, VIRTEL substitutes a newly generated user security code to be used for the next transfer. For example:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;script language=&quot;JavaScript&quot;&gt;&lt;!--
var VirtelRef = &quot;{{{SECURITY-TOKEN}}}&quot;;
--&gt;&lt;/script&gt;
</pre></div>
</div>
<p>If a security code exists, the above code might generate:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">VirtelRef</span> <span class="o">=</span> <span class="s2">&quot;20040427130843.07F5D1DC.56A85680Bgpamk4WZRKKBiZWjS4OTlqSES4OWlA==&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">otherwise</span> <span class="n">it</span> <span class="n">will</span> <span class="n">generate</span><span class="p">:</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">VirtelRef</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Two examples of the use of the SECURITY-TOKEN tag are supplied in the HTMLBAS directory used by VIRTEL entry point DEMOHTTP. The upload.htm page stores and retransmits the user security code in the form of a cookie (VirtelRef=xxxxxxxxxxxxxxxx). The upload2.htm page retransmits the user security code using the VirtelCookie=parameter of the URL (see <a class="reference internal" href="#ug-cookie-upload"><span class="std std-ref">“Transmission of upload cookie by URL”</span></a>), but it does not store the code.</p>
</div>
<div class="section" id="if-security-token-is-ready-tag">
<span id="index-112"></span><h5>IF-SECURITY-TOKEN-IS-READY tag<a class="headerlink" href="#if-security-token-is-ready-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span><span class="n">IF</span><span class="o">-</span><span class="n">SECURITY</span><span class="o">-</span><span class="n">TOKEN</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">READY</span>
    <span class="n">SetHostWarning</span><span class="p">();</span>
<span class="p">}}}</span>
</pre></div>
</div>
<p>The IF-SECURITY-TOKEN-IS-READY tag encloses HTML or JavaScript code to be generated only if a non-empty SECURITY-TOKEN is present.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The total size of this tag, including the enclosed code, must not exceed the size of an inter-block buffer (120 characters) otherwise it will not be correctly processed if it spans blocks.</p>
</div>
<span class="target" id="ug-printing"></span></div>
</div>
<div class="section" id="printing">
<span id="index-113"></span><h4>3287 printing<a class="headerlink" href="#printing" title="Permalink to this headline">¶</a></h4>
<p>Each relay LU, through which a user connects to a host application, can be associated with a second LU which represents a virtual printer (see the description of HTTP terminals in the VIRTEL Connectivity Reference documentation). Data sent to this virtual printer by a host application (such as CICS) are stored by VIRTEL and can be retrieved by means of the tags IF-PRINT-IS-READY, SESSION-CODE, and PRINT embedded in a template page.</p>
<div class="section" id="if-print-is-ready-tag">
<span id="index-114"></span><h5>IF-PRINT-IS-READY tag<a class="headerlink" href="#if-print-is-ready-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">IF</span><span class="o">-</span><span class="n">PRINT</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">READY</span> <span class="o">...</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The IF-PRINT-IS-READY tag encloses a section of the page which is generated only if print data exists on the virtual printer associated with the user’s session. The HTML content represented by “…” is
generated only if VIRTEL has data ready to be printed.</p>
</div>
<div class="section" id="index-115">
<span id="id4"></span><h5>SESSION-CODE tag<a class="headerlink" href="#index-115" title="Permalink to this headline">¶</a></h5>
<p>The SESSION-CODE tag, prefixed by the word “Print”, generates a session code which allows a subsidiary window to be opened for the print data associated with the specified session. The template page displayed in this window can retrieve the stored print data by means of the PRINT tag. The user can then view the print data, and can, if desired, send the data to a physical workstation printer using the normal procedure for printing from a browser.</p>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;script language=&quot;Javascript&quot; type=&quot;text/Javascript&quot;&gt;
&lt;!--
    function ShowPopup()
    {
        var popupURL = &quot;imprim.htm++Print{{{ SESSION-CODE }}}&quot;
        var popupName = &quot;PopupImpression&quot;;
        var popup = window.open(&quot;&quot;, popupName,
            &#39;status=yes,resizable=yes,scrollbars=yes,toolbar=yes,&#39; +
            &#39;menubar=yes,width=614,height=129&#39;);
        popup.location = popupURL;
    }
    {{{IF-PRINT-IS-READY
        ShowPopup();
    }}}
// --&gt;
&lt;/script&gt;
</pre></div>
</div>
</div>
<div class="section" id="print-tag">
<span id="index-116"></span><h5>PRINT tag<a class="headerlink" href="#print-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">PRINT</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The PRINT tag allows a template page, such as the imprim.htm page supplied with VIRTEL, to retrieve 3287 print data. The structured field FAD3 also allows print data to be fed to VIRTEL for retrieval with the PRINT tag.</p>
</div>
</div>
<div class="section" id="generating-pdf-output">
<span id="ug-pdf-output"></span><h4>Generating PDF output<a class="headerlink" href="#generating-pdf-output" title="Permalink to this headline">¶</a></h4>
<p>When a page template is processed in a scenario by a COPY$ OUTPUT-FILE-TO-VARIABLE instruction with the TYPE=LINEBUFFER parameter, the page template may contain additional tags. These tags are used to assist in the construction of INPUT, DOCOPT, and LAYOUT files in the “LINEBUF” format required by the MakePDF program product.</p>
<p>These files may then be passed to the VIRSVPDF service program which invokes MakePDF to generate output files in PDF format. Refer to <a class="reference internal" href="#ug-pdf"><span class="std std-ref">“PDF output generation”</span></a> for an example scenario.</p>
<div class="section" id="pdf-lines-per-page-tag">
<span id="index-117"></span><h5>PDF-LINES-PER-PAGE tag<a class="headerlink" href="#pdf-lines-per-page-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">PDF</span><span class="o">-</span><span class="n">LINES</span><span class="o">-</span><span class="n">PER</span><span class="o">-</span><span class="n">PAGE</span> <span class="s2">&quot;nn&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The PDF-LINES-PER-PAGE tag inserts “1” in the ASA carriage control character position after every nn lines.</p>
</div>
<div class="section" id="pdf-new-docopt-tag">
<span id="index-118"></span><h5>PDF-NEW-DOCOPT tag<a class="headerlink" href="#pdf-new-docopt-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">PDF</span><span class="o">-</span><span class="n">NEW</span><span class="o">-</span><span class="n">DOCOPT</span> <span class="s2">&quot;n&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The PDF-NEW-DOCOPT tag is used only in a MakePDF DOCOPT file. It identifies the DOCOPT file by the character “n”. This allows the DOCOPT file to be referenced by the PDF-USE-DOCOPT tag in the corresponding INPUT file.</p>
</div>
<div class="section" id="pdf-new-input-tag">
<span id="index-119"></span><h5>PDF-NEW-INPUT tag<a class="headerlink" href="#pdf-new-input-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">PDF</span><span class="o">-</span><span class="n">NEW</span><span class="o">-</span><span class="n">INPUT</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The PDF-NEW-INPUT tag is used only in a MakePDF INPUT file. It identifies the start of a new segment in the INPUT file.</p>
</div>
<div class="section" id="pdf-new-layout-tag">
<span id="index-120"></span><h5>PDF-NEW-LAYOUT tag<a class="headerlink" href="#pdf-new-layout-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">PDF</span><span class="o">-</span><span class="n">NEW</span><span class="o">-</span><span class="n">LAYOUT</span> <span class="s2">&quot;n&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The PDF-NEW-LAYOUT tag is used only in a MakePDF LAYOUT file. It identifies the LAYOUT file by the character “n”. This allows the LAYOUT file to be referenced by the PDF-USE-LAYOUT tag in the corresponding INPUT file.</p>
</div>
<div class="section" id="pdf-outline-tag">
<span id="index-121"></span><h5>PDF-OUTLINE tag<a class="headerlink" href="#pdf-outline-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">PDF</span><span class="o">-</span><span class="n">OUTLINE</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The PDF-OUTLINE tag inserts “&#64;” in the ASA carriage control character position.</p>
</div>
<div class="section" id="pdf-page-break-tag">
<span id="index-122"></span><h5>PDF-PAGE-BREAK tag<a class="headerlink" href="#pdf-page-break-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">PDF</span><span class="o">-</span><span class="n">PAGE</span><span class="o">-</span><span class="n">BREAK</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The PDF-PAGE-BREAK tag inserts “1” in the ASA carriage control character position.</p>
</div>
<div class="section" id="pdf-use-docopt-tag">
<span id="index-123"></span><h5>PDF-USE-DOCOPT tag<a class="headerlink" href="#pdf-use-docopt-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">PDF</span><span class="o">-</span><span class="n">USE</span><span class="o">-</span><span class="n">DOCOPT</span> <span class="s2">&quot;n&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The PDF-USE-DOCOPT tag is used only in a MakePDF INPUT file. It specifies that the INPUT file is associated with the DOCOPT file identified by the character “n”</p>
</div>
<div class="section" id="pdf-use-layout-tag">
<span id="index-124"></span><h5>PDF-USE-LAYOUT tag<a class="headerlink" href="#pdf-use-layout-tag" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">PDF</span><span class="o">-</span><span class="n">USE</span><span class="o">-</span><span class="n">LAYOUT</span> <span class="s2">&quot;n&quot;</span><span class="p">}}}</span>
</pre></div>
</div>
<p>The PDF-USE-LAYOUT tag is used only in a MakePDF INPUT file. It specifies that the INPUT file is associated with the LAYOUT file identified by the character “n”</p>
<p id="index-125">PDF-VARIABLE tag</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{{</span> <span class="n">PDF</span><span class="o">-</span><span class="n">VARIABLE</span> <span class="p">}}}</span>
</pre></div>
</div>
<p>The PDF-VARIABLE tag inserts “=” in the ASA carriage control character position.</p>
</div>
</div>
</div>
<div class="section" id="web-access-customization">
<span id="ug-uploading-html-pages"></span><h3>Web Access Customization<a class="headerlink" href="#web-access-customization" title="Permalink to this headline">¶</a></h3>
<div class="section" id="uploading-html-pages">
<h4>Uploading HTML Pages<a class="headerlink" href="#uploading-html-pages" title="Permalink to this headline">¶</a></h4>
<p>A part of Web Access Customization will require the uploading of HTML templates or other web entities such as customised JavaScript or CSS files. The Virtel Administration guide provides information on how to upload files to the Virtel mainframe server.</p>
</div>
<div class="section" id="web-access-settings">
<h4>Web Access Settings<a class="headerlink" href="#web-access-settings" title="Permalink to this headline">¶</a></h4>
<p>The VIRTEL Web Access user can use the Settings menu to modify certain options such as font size, 3270 key mappings, and color schemes. The user’s settings are stored in a browser local storage which remains valid so long as cookies are not deleted from the workstation. The settings stored in the user’s local storage override the default settings for VIRTEL Web Access which are distributed in the w2hparm.js file, located in the default W2H-DIR directory. See <a class="reference internal" href="#ug-global-modifications"><span class="std std-ref">“Global modification of Web Access settings”</span></a>.</p>
<span class="target" id="ug-settings-menu"></span><div class="section" id="web-access-settings-menu">
<span id="index-126"></span><h5>Web Access Settings menu<a class="headerlink" href="#web-access-settings-menu" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="../../../_images/image182.jpeg"><img alt="image18" src="../../../_images/image182.jpeg" style="width: 0.22500in; height: 0.22500in;" /></a> When the user clicks the settings ICON on the VIRTEL Web Access toolbar, the Virtel Web Access settings panel is displayed. The panel has four setting tabs which are described below.</p>
</div>
<div class="section" id="display-tab">
<span id="index-127"></span><h5>Display Tab<a class="headerlink" href="#display-tab" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="../../../_images/image198.png"><img alt="image19" src="../../../_images/image198.png" style="width: 4.0in; height: 5.5in;" /></a></p>
<p><em>VIRTEL Web Access Settings Display Tab (part 1 of 4)</em></p>
<dl class="docutils">
<dt>Font family</dt>
<dd>Name of font. The panel displays a list of fonts known to VIRTEL and installed on the workstation, in addition to the fonts supplied by VIRTEL. If the required font is not in the list, click the ellipsis to the right of the selection box and type the name of the font in the box. Any fixed-width font installed on the workstation may be specified.</dd>
<dt>Font Size</dt>
<dd>Size of font. Possible values are:</dd>
<dt>Window</dt>
<dd>VIRTEL calculates the font size to fit the browser’s window size.</dd>
<dt>nn</dt>
<dd>VIRTEL uses a fixed font size. nn is the size in “points”: 8pt, 10pt, 12pt, 14pt, or 16pt.</dd>
<dt>NoStretch</dt>
<dd>By default Virtel attempts to optimize the window presentation to the users screen size. Setting the NOStretch option forces Virtel to calculate a fixed font size to fit the display screen size.</dd>
<dt>Cursor</dt>
<dd><p class="first">The shape of the 3270 cursor. The possible settings are:</p>
<dl class="last docutils">
<dt>Smart</dt>
<dd>The character at the cursor position is underlined and the position and color changes to always remain visible for any character (depending on the selected character’s style : bgnd color, reverse, underlined).</dd>
<dt>Bar</dt>
<dd>The underlined character at the cursor position is in reverse video</dd>
<dt>Block</dt>
<dd>The block character at the cursor position is in reverse video</dd>
<dt>Blink</dt>
<dd>The block character at the cursor position is in blinking reverse video</dd>
<dt>Vertical line, Horiz line</dt>
<dd><p class="first">When activated, causes the position of the cursor to be marked with a vertical line and/or a horizontal line extending to the edges of the 3270 window (also known as a “crosshair cursor”).</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For Internet Explorer versions 6 and 7, Blink is the same as Block</p>
</div>
</dd>
</dl>
</dd>
<dt>Display Style</dt>
<dd><p class="first">Allows a choice of color schemes by selection of CSS style sheet. By default, possible values are:</p>
<dl class="last docutils">
<dt>3270</dt>
<dd>extended colors on black background</dd>
<dt>Gray</dt>
<dd>extended colors on gray background</dd>
<dt>White</dt>
<dd><p class="first">gray characters on white background</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To add or remove a style, see <a class="reference internal" href="#ug-customize-display"><span class="std std-ref">“Customize display style”</span></a>). Administrators can add some new customs style as describe in the section <a class="reference internal" href="#ug-customize-display"><span class="std std-ref">“How to customize display style”</span></a>.</p>
</div>
</dd>
</dl>
</dd>
<dt>Print style</dt>
<dd><p class="first">Allows a choice of color schemes for the screen capture window. By default, possible values are:</p>
<dl class="last docutils">
<dt>3270</dt>
<dd>extended colors on black background</dd>
<dt>Color</dt>
<dd>extended colors on white background</dd>
<dt>White</dt>
<dd>black characters on white background</dd>
</dl>
</dd>
<dt>Toolbar</dt>
<dd><ul class="first last simple">
<li>Show the toggle button for 3278T mode</li>
<li>Hide the Virtel information.</li>
</ul>
</dd>
<dt>Miscellaneous</dt>
<dd><ul class="first last simple">
<li><dl class="first docutils">
<dt>Highlight input fields</dt>
<dd>Permits the user to display a different background color for 3270 input fields. When this option is selected, all input fields will have a class designator HIGHLIGHTED_INPUTFIELD in addition to their regular class. The style definition may be overridden by the administrator in the custom.css file.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Bidirectional data</dt>
<dd>Allows the Alt-ENTER key to globally switch the screen display from ‘left to right’ to ‘right to left’. This provides support for languages that require “right-to-left” screen presentation such as Arabic. This option may be set in w2hparm through the “w2hparm.mirrorMode” setting.</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="miscellaneous-display">
<span id="index-128"></span><h5>Miscellaneous Display<a class="headerlink" href="#miscellaneous-display" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="../../../_images/image208.png"><img alt="image20" src="../../../_images/image208.png" style="width: 4.0in; height: 5.5in;" /></a></p>
<p><em>VIRTEL Web Access Settings Miscellaneous Tab (part 2 of 4)</em></p>
<dl class="docutils">
<dt>Double click</dt>
<dd><p class="first">Specifies the action taken for a mouse double-click. Possible settings are :</p>
<dl class="last docutils">
<dt>off</dt>
<dd>Indicates that the double-click function is deactivated.</dd>
<dt>Word Selection</dt>
<dd>Draws a box around the word that the mouse is pointing in preparation for a copy or cut operation.</dd>
<dt>ENTER</dt>
<dd>Activates the “point-and-shoot” function. When set to ENTER, double clicking the mouse moves the cursor to the mouse position and sends a 3270 ENTER to the host application.</dd>
</dl>
</dd>
<dt>Edition</dt>
<dd><dl class="first last docutils">
<dt>Paste erase EOF</dt>
<dd>When activated, a paste operation will erase the rest of an input field to the right of the pasted text</dd>
<dt>Paste moves the cursor</dt>
<dd>When activated, a paste operation will move the cursor to the end of the field</dd>
<dt>Map Ctrl+V to Paste by Typing</dt>
<dd>Indicates that Ctrl+V will act “paste by typing”, i.e cursor will be positionned at the end of the pasted text instead of remaining at the position it was before using Ctrl+V.</dd>
<dt>Move cursor on activate</dt>
<dd>This setting takes effect only when the user clicks on a background 3270 window in order to bring the window to the foreground. When the option is activated, the window is brought to the foreground and the 3270 cursor moves to the location in the window where the user clicked; the copy/paste box and context menu are removed if present. When the option is not activated, the window is brought to the foreground and the cursor remains in its previous position; the copy/paste box and context menu remain displayed if present.</dd>
<dt>Preserve insertion mode</dt>
<dd>This setting takes effect only when the keyboard is in insertion mode. When the option is activated, the cursor will remain in insert mode until the user returns to normal entry mode by using the “insert” key again, otherwise the cursor returns to normal whenever a transmission key is used.</dd>
</dl>
</dd>
<dt>Pads</dt>
<dd><dl class="first last docutils">
<dt>Keep macro pad open</dt>
<dd>If checked, the macro window remains open all the time. If not, it disappears as soon as you have clicked a macro.</dd>
<dt>Keep keypad open</dt>
<dd>If checked, the keypad window remains open all the time. If not, it disappears as soon as you have clicked a function key in it.</dd>
<dt>Macro pad in the window</dt>
<dd>If checked, determines the location of the macro pad.</dd>
</dl>
</dd>
<dt>Hotspots</dt>
<dd><dl class="first last docutils">
<dt>Display URL hotspots</dt>
<dd>When activated, any text starting with http, https, mailto, file, or ftp (except in 3270 input fields) is transformed into a hyperlink.</dd>
<dt>Display PF key hotspots</dt>
<dd>When activated, any text starting with Fnn= or PFnn= (except in 3270 input fields) is transformed into a clickable area. Clicking on the area is equivalent to pressing PF nn.</dd>
</dl>
</dd>
<dt>Capture</dt>
<dd><dl class="first last docutils">
<dt>Auto-capture</dt>
<dd>When activated, causes a snapshot of each screen displayed by the host application to be automatically appended to the screen capture window.</dd>
<dt>Bring capture to the foreground</dt>
<dd>When activated, causes the capture windows to come in the foreground whenever the cature icon is used.</dd>
</dl>
</dd>
<dt>Miscellaneous</dt>
<dd><dl class="first last docutils">
<dt>Auto-print</dt>
<dd>When activated, causes the Windows print function to be launched automatically in the print window as a result of a screen snapshot or print request.</dd>
<dt>Response time monitor</dt>
<dd><p class="first">When activated, two counters are displayed on the status line below the 3270 screen, for example: H:110ms J:31ms. The first number (H=Host) represents the response time of the VIRTEL server, from the last Enter or PF key until the receipt of the most recent message from the server. The second number (J=JavaScript) is the time taken by the browser scripts to prepare the screen for display. The sum of the two numbers is the response time perceived by the user.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The response time monitor is active in Ajax mode only.</p>
</div>
</dd>
<dt>Omit nulls from input</dt>
<dd>When activated, VIRTELWeb Access will remove all nulls from modified input fields before sending to the server, in strict conformance with 3270 protocol. When not activated, leading and embedded nulls are converted to blanks, and only trailing nulls are suppressed, which many users find more convenient.</dd>
<dt>Remap caret to logical not</dt>
<dd>If checked, translates the “caret” sign (Shift+6 on a US keyboard) to EBCDIC X‘5F’, which is the “logical not” sign (¬) in codepage 037/1140.</dd>
<dt>AsynchSupport</dt>
<dd><p class="first">By default Virtel uses a “Long Poll” technique to asynchronously update the display when the mainframe has data to send regardless of the users input key requests. This feature may be disabled through this check box. Users who use the Virtel i4web AS/400 interface should disable “Long Poll”. This option may be set in w2hparm through the “w2hparm.AsynchSupport” setting.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If disabled Virtel will only update the screen after receiveing an input key request from the user.</p>
</div>
</dd>
</dl>
</dd>
</dl>
</div>
<div class="section" id="key-mappings-display">
<span id="index-129"></span><h5>Key Mappings Display<a class="headerlink" href="#key-mappings-display" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="../../../_images/image2118.png"><img alt="image21" src="../../../_images/image2118.png" style="width: 4.0in; height: 5.5in;" /></a></p>
<p><em>VIRTEL Web Access Settings Key Mappings Tab (part 3 of 4)</em></p>
<p>This tab is used to map specific functions to certain keyboard keys. The tab contains five sub categories whose names are explicit enough to not require more precision. However the following notes provide further information on possible browser differences.</p>
<dl class="docutils">
<dt>Esc key to Alt+F3</dt>
<dd>Defines the mapping of workstation keyboard to 3270 keys. The value “no” indicates that the keystroke is ignored. For example the 3270 PA1 key may be assigned to the PageUp key, to the Alt+PageUp key, and/or to the Alt+F1 key on the user’s keyboard.</dd>
<dt>Ctrl key</dt>
<dd>For Internet Explorer, the “Ctrl key” setting refers to the right Ctrl key. For Firefox, Chrome, and Safari the “Ctrl key” setting applies to both the left and right Ctrl keys identically. For Firefox, the “Keypad Enter” setting is ignored. For Internet Explorer versions 6, 7, and 8, a browser helper object(BHO = virtkey.dll) must be installed to allow recognition of the keypad Enter key. This BHO is not needed for Internet Explorer 9.</dd>
<dt>Keypad /*-+.</dt>
<dd>Allows keys on the numeric keypad to be assigned to certain 3270 functions including PA1, PA2, Tab, Backtab, and Newline. Also allows the decimal point on the numeric keypad to be remapped to comma for European countries.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remapping of the numeric keypad is only supported for Internet Explorer, Chrome, and Safari. Keypad settings are ignored for Firefox and Opera.</p>
</div>
</div>
<div class="section" id="import-export-parameters">
<span id="index-130"></span><h5>Import/Export parameters<a class="headerlink" href="#import-export-parameters" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="../../../_images/image2214.png"><img alt="image22" src="../../../_images/image2214.png" style="width: 4.0in; height: 5.5in;" /></a></p>
<p><em>VIRTEL Web Access Settings Import/Export Tab (part 4 of 4)</em></p>
<p>This tab lets the user to save and restore his settings into (or from) a local file. This backup method is different and independent of the method used when the “save” button is pressed. (See below).</p>
</div>
<div class="section" id="id5">
<h5>Associated functions<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<p>After modifying the Settings menu, the user presses one of the buttons:</p>
<dl class="docutils">
<dt>Save</dt>
<dd>save the options in browser local storage.</dd>
<dt>Cancel</dt>
<dd>exit without saving the modifications made to this menu.</dd>
<dt>Defaults</dt>
<dd>returns all of the settings to their default values. The default values are specified by the installation in w2hparm.js.</dd>
</dl>
<p>Deletion of browser cookies may delete the values saved in local storage. For Internet Explorer, ensure that the option “Delete browsing history on exit” in Tools – Internet Options” is not checked.</p>
</div>
<div class="section" id="where-user-settings-are-stored">
<h5>Where user settings are stored<a class="headerlink" href="#where-user-settings-are-stored" title="Permalink to this headline">¶</a></h5>
<p>When the user press the “save” button, his Web Access settings and macros are stored in browser local storage. For Internet Explorer 6, local storage is stored in the folder :
%userprofile%/UserData For Internet Explorer 8 and 9, local storage is stored in the folder :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">userprofile</span><span class="o">%/</span><span class="n">Local</span> <span class="n">Settings</span><span class="o">/</span><span class="n">Application</span> <span class="n">Data</span><span class="o">/</span><span class="n">Microsoft</span><span class="o">/</span><span class="n">Internet</span> <span class="n">Explorer</span><span class="o">/</span><span class="n">DOMStore</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To see DOMStore you must untick “hide protected operating system files” in Windows folder options.</p>
</div>
<p>For other browsers, see</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">sitepoint</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">building</span><span class="o">-</span><span class="n">web</span><span class="o">-</span><span class="n">pages</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">local</span><span class="o">-</span><span class="n">storage</span><span class="o">/</span>
</pre></div>
</div>
<span class="target" id="ug-global-modifications"></span></div>
<div class="section" id="global-modification-of-web-access-settings">
<span id="index-131"></span><h5>Global modification of Web Access settings<a class="headerlink" href="#global-modification-of-web-access-settings" title="Permalink to this headline">¶</a></h5>
<p>Those installations who wish to modify the default Web Access settings for all users can do so by modifying the w2hparm.js file. This file is included in the sources.zip file which can be obtained from the VIRTEL Web Access menu accessible by URL <a class="reference external" href="http://n.n.n.n:41001">http://n.n.n.n:41001</a>.</p>
<p>The w2hparm.js file as delivered is just a dummy file and contains no default settings. See <cite>“Appendix A - w2hparm values” &lt;#UG_w2hparm_defaults&gt;</cite> for a list of the possible w2hparm values.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="o">//</span> <span class="n">w2hparm</span><span class="o">.</span><span class="n">js</span> <span class="p">(</span><span class="n">W2H</span><span class="o">-</span><span class="n">DIR</span><span class="p">)</span>
<span class="o">//</span> <span class="n">w2h</span> <span class="n">parameters</span> <span class="n">to</span> <span class="n">override</span> <span class="ow">or</span> <span class="n">hide</span><span class="o">.</span>
<span class="o">//</span>
<span class="o">//</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">this</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">sample</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">replaced</span> <span class="n">after</span> <span class="n">a</span> <span class="n">new</span> <span class="n">install</span><span class="o">.</span>
<span class="o">//</span> <span class="n">please</span> <span class="n">see</span> <span class="n">the</span> <span class="n">documentation</span> <span class="n">on</span> <span class="n">possible</span> <span class="n">parameter</span> <span class="n">values</span>
<span class="o">//</span> <span class="ow">and</span> <span class="n">on</span> <span class="n">how</span> <span class="n">to</span> <span class="nb">set</span> <span class="n">this</span> <span class="n">file</span> <span class="n">up</span> <span class="ow">in</span> <span class="n">CLI</span><span class="o">-</span><span class="n">DIR</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">W2H</span><span class="o">-</span><span class="n">DIR</span>
<span class="o">//</span>
<span class="n">var</span> <span class="n">w2hparm</span> <span class="o">=</span> <span class="p">{};</span>      <span class="o">//</span> <span class="n">empty</span> <span class="n">objet</span><span class="p">:</span> <span class="n">no</span> <span class="n">overrides</span>
<span class="o">//</span>
<span class="o">//</span> <span class="n">sample</span> <span class="n">values</span><span class="p">:</span>
<span class="o">//</span>  <span class="s2">&quot;font&quot;</span><span class="p">:</span><span class="s2">&quot;Droid Sans Mono&quot;</span><span class="p">,</span>
<span class="o">//</span>  <span class="s2">&quot;ctrl&quot;</span><span class="p">:</span><span class="s2">&quot;ENTER&quot;</span><span class="p">,</span>
<span class="o">//</span>  <span class="s2">&quot;ctrl&quot;</span><span class="p">:</span><span class="s2">&quot;Newline&quot;</span><span class="p">,</span>
<span class="o">//</span>  <span class="s2">&quot;enter&quot;</span><span class="p">:</span><span class="s2">&quot;Newline&quot;</span><span class="p">,</span>
<span class="o">//</span>  <span class="s2">&quot;enter&quot;</span><span class="p">:</span><span class="s2">&quot;ENTER&quot;</span><span class="p">,</span>
<span class="o">//</span> <span class="n">sample</span><span class="p">:</span>
<span class="o">//</span> <span class="n">var</span> <span class="n">w2hparm</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ctrl&quot;</span><span class="p">:</span><span class="s2">&quot;no&quot;</span><span class="p">,</span><span class="s2">&quot;enter&quot;</span><span class="p">:</span><span class="s2">&quot;ENTER&quot;</span><span class="p">};</span>
<span class="o">//</span>
<span class="o">//</span> <span class="n">w2hparm</span> <span class="n">parameters</span> <span class="n">to</span> <span class="n">hide</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span> <span class="s2">&quot;home&quot;</span> <span class="ow">and</span> <span class="s2">&quot;shiftins&quot;</span><span class="p">)</span>
<span class="o">//</span> <span class="n">Remove</span> <span class="n">the</span> <span class="o">//</span> <span class="ow">and</span> <span class="n">update</span> <span class="n">the</span> <span class="n">items</span>
<span class="o">//</span> <span class="n">var</span> <span class="n">w2hparmHide</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;home&quot;</span><span class="p">,</span><span class="s2">&quot;shiftins&quot;</span><span class="p">];</span>
</pre></div>
</div>
<p><em>w2hparm.js: Dummy file as delivered for VIRTEL Web Access</em></p>
<p>w2hparm values values may be changed or added by creating a new w2hparm.js file.</p>
<p>For example, installations who wish to map the 3270 ATTN key to the Esc (Escape) key for use with Multisession applications such as NVAS (IBM® NetView™ Access Services) can add the following instruction to the w2hparm.js file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;escape&quot;</span><span class="p">:</span><span class="s2">&quot;ATTN&quot;</span><span class="p">,</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Modifications to the global settings are only effective after the expiry of the w2hparm.js file in the browser’s cache which occurs at midnight each day. A user can force the use of the updated global settings file by clearing the browser cache, deleting any cookies associated with the VIRTEL server, and refreshing the 3270 page using the Ctrl-R key.</p>
</div>
<p>After modifying the w2hparm.js file, it must be uploaded to VIRTEL’s CLI-DIR directory by means of the “Upload” link on the VIRTEL Web Access menu (URL <a class="reference external" href="http://n.n.n.n:41001">http://n.n.n.n:41001</a>). Then you must check the Entry Point (usually CLIWHOST) and check that the transaction whose “External name” is w2h and whose “Check URL Prefix” field is set to /w2h/w2hparm-js specifies CLI-DIR in the “Application” field. For the CLIWHOST entry point this is transaction CLI-03P. If you want your customized changes to be applicable to transactions under Entry Point WEB2HOST then change the W2H-03P transaction so that the application field points to “CLI-DIR” and not “W2H-DIR”.</p>
<p>As of Virtel V4.56 an enhanced customisation feature is available which provides customization at a global and transaction level for Javascript, CSS and other web elements. To use this feature the w2hparm.js should include the “global-settings” attribute. The following is an example:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;global-settings&quot;</span><span class="p">:{</span>
<span class="s2">&quot;pathToJsCustom&quot;</span><span class="p">:</span><span class="s2">&quot;../option/custJS.global.js&quot;</span><span class="p">,</span>
<span class="s2">&quot;pathToCssCustom&quot;</span><span class="p">:</span> <span class="s2">&quot;../option/custCSS.global.css&quot;</span><span class="p">,</span>
<span class="s2">&quot;pathToHelp&quot;</span><span class="p">:</span> <span class="s2">&quot;../option/myHelp.html&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following supported global properties are:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;pathToJsCustom&quot;</span>  <span class="o">-</span> <span class="n">Customized</span> <span class="n">JavaSCript</span> <span class="n">elements</span>
<span class="s2">&quot;pathToW2hparm&quot;</span>   <span class="o">-</span> <span class="n">Customized</span> <span class="n">w2hparm</span> <span class="n">parameters</span>
<span class="s2">&quot;pathToCssCustom&quot;</span> <span class="o">-</span> <span class="n">Customized</span> <span class="n">CSS</span> <span class="n">stylesheets</span>
<span class="s2">&quot;pathToPrintCss&quot;</span>  <span class="o">-</span> <span class="n">Customized</span> <span class="n">Print</span> <span class="n">CSS</span> <span class="n">Style</span> <span class="n">sheets</span>
<span class="s2">&quot;pathToHelp&quot;</span>      <span class="o">-</span> <span class="n">Customized</span> <span class="n">Help</span> <span class="n">pages</span>
</pre></div>
</div>
<p>Adding the global-settings property to the “VWA settings” file w2hparms.js provides the pointers to the customized components located within the “option” directory as identified by the /option/ pathname. In the sample above customised CSS, Javascript and Help element pointers are defined. For further details see <a class="reference internal" href="#ug-customizing-with-option"><span class="std std-ref">“Customisation Modes”</span></a>.</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">Updating w2hparm.js in the default W2H-DIR directory is not recommended as changes will be overwritten by maintenance or future Virtel release updates. Keep customized elements sucha as w2hparm.js in the CLI-DIR directory.</p>
</div>
<p id="index-133">The list of keywords and possible values which can be coded in the w2hparm.js file is listed in <a class="reference internal" href="#ug-w2hparm-defaults"><span class="std std-ref">“Appendix A - w2hparm values”</span></a>.</p>
</div>
<div class="section" id="choosing-web-access-settings-mode">
<span id="index-134"></span><h5>Choosing Web Access settings mode<a class="headerlink" href="#choosing-web-access-settings-mode" title="Permalink to this headline">¶</a></h5>
<p>As of Virtel Release V4.57 only the “Version 2” user interface settings are supported, as described at the beginning of this section. In previous versions of Virtel the w2hparm property “settingsGUI” was used to select either “V1” or “V2” presentation interfaces. The “V1” user interface has now been deprecated and is no longer supported.</p>
</div>
<div class="section" id="hiding-web-access-settings">
<span id="index-135"></span><h5>Hiding Web Access settings<a class="headerlink" href="#hiding-web-access-settings" title="Permalink to this headline">¶</a></h5>
<p>To prevent the user from overriding the site defaults, the administrator can remove individual settings from the user’s Web Access Settings menu. The names of settings to be hidden are specified in the w2hparmHide variable in the w2hparm.js file. The example below shows how to hide the default font, font size, and style settings from the menu:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">w2hparmHide</span> <span class="n">values</span>
<span class="n">var</span> <span class="n">w2hparmHide</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="s2">&quot;fontsize&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">];</span>
</pre></div>
</div>
<p><em>w2hparm.js: Hiding VIRTEL Web Access settings</em></p>
</div>
</div>
</div>
<div class="section" id="application-selection-menu">
<span id="index-136"></span><h3>Application Selection Menu<a class="headerlink" href="#application-selection-menu" title="Permalink to this headline">¶</a></h3>
<p>The VIRTEL application selection menu is dynamically generated by the appmenu.htm page in conjunction with the applist transaction. For example, the following URL displays the application selection menu for the CLIWHOST entry point (line C-HTTP port 41002):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="p">:</span><span class="mi">41002</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">appmenu</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">applist</span>
</pre></div>
</div>
<p>The application selection menu for the WEB2HOST entry point (line W-HTTP port 41001) is accessible from the “Other applications” link on the VIRTEL Web Access main menu.</p>
<div class="section" id="contents-of-menu">
<h4>Contents of menu<a class="headerlink" href="#contents-of-menu" title="Permalink to this headline">¶</a></h4>
<p>An example of the application selection menu is shown in the figure below:</p>
<p><img alt="image27" src="../../../_images/image275.png" /> <em>Application selection menu</em></p>
<p>The application selection menu contains clickable links to the transactions defined under the entry point. A transaction will appear in the menu if all of the following conditions are met:
- The “Application type” is 1 (VTAM) or 2 (VIRTEL)
- The “How started” field is 1 (menu)
- The user is logged on and authorized via the security subsystem to the security resource whose name is the internal name of the transaction (except when the transaction “Security” field is 0)</p>
<p>If the user is not logged on, then only public transactions (security type 0) are displayed.</p>
<p>If the APPSTAT=YES parameter is specified in the VIRTCT (see “Parameters of the VIRTCT” in the VIRTEL Installation
Guide) then the status of VTAM applications is indicated by a green bar for active applications, and by a red bar for
inactive applications.</p>
<p>To add an application to the menu, use the VIRTEL administration panels to define a transaction under the entry point,
press F1 to update the entry point, then refresh the appmenu.htm page in the browser.</p>
<span class="target" id="ug-presentation-modes"></span></div>
<div class="section" id="presentation-modes">
<span id="index-137"></span><h4>Presentation modes<a class="headerlink" href="#presentation-modes" title="Permalink to this headline">¶</a></h4>
<p>The application selection menu offers a choice of several different presentation modes, selectable by clicking one of the buttons at the top right of the screen. The selected presentation mode determines which page template will be used to access the selected host applications.</p>
<dl class="docutils">
<dt>Auto</dt>
<dd>This presentation mode is similar to the 3270 presentation mode, but it uses a static main page (WEB2AJAX.htm) together with an Ajax-loaded sub-page (WEB2SUB.html). This can reduce network load and provide faster response time with a better 3270 user experience. Ajax mode also offers password encryption as an option (see <a class="reference internal" href="#ug-password-encryption"><span class="std std-ref">“Password encryption”</span></a>).</dd>
<dt>Classic</dt>
<dd>This presentation mode, which uses the WEB2VIRT.htm page template, is intended as a first step towards VIRTEL Web Modernisation. In this mode the 3270 screen image is displayed as an HTML form, to which presentation enhancements such as drop-down lists, checkboxes, and calendars can be added by means of VIRTEL Web Modernisation scenarios (see <a class="reference internal" href="#ug-virtel-scenarios"><span class="std std-ref">“Web Modernisation VIRTEL Scenarios”</span></a>).</dd>
<dt>Tablet</dt>
<dd>This presentation mode it uses the SMARTWEB2VIRT.htm page template for an HTML presentation adapted for tablets and smartphones.</dd>
</dl>
<div class="section" id="the-appmenu-htm-template">
<span id="index-138"></span><h5>The appmenu.htm template<a class="headerlink" href="#the-appmenu-htm-template" title="Permalink to this headline">¶</a></h5>
<p>The appmenu.htm page for the VIRTEL application selection menu is delivered in the W2H-DIR directory. The page may be customized if required to meet installation standards. The appmenutable and appmenuitem styles in the STYLBLUE.css stylesheet allow the appearance of the menu to be customized. The source code for the page and the stylesheet may be obtained from the sources.zip file accessible from the VIRTEL Web Access menu. After modifying the page or the stylesheet, follow the “Upload” link on the VIRTEL Web Access menu to upload the updated files to the W2H-DIR directory.</p>
</div>
<div class="section" id="definition-of-the-applist-transaction">
<h5>Definition of the applist transaction<a class="headerlink" href="#definition-of-the-applist-transaction" title="Permalink to this headline">¶</a></h5>
<p>A transaction with external name applist must be present in the list of transactions at the entry point associated with
the line. VIRTEL supplies as standard transactions W2H-90 (for entry point WEB2HOST, line W-HTTP port 41001) and
CLI-90 (for entry point CLIWHOST, line C-HTTP port 41002). The applist transaction must specify application name
VIR0021S and application type 2. Security type 1 requires the user to sign on so that the transaction can determine
which applications the user is authorized to. The user must also be authorized to the applist transaction itself by its
internal name (W2H-90 or CLI-90).</p>
<p>The figure below shows the definition of the applist transaction CLI-90:</p>
<p><img alt="image81" src="../../../_images/image8110.png" />
Definition of applist transaction</p>
</div>
<div class="section" id="application-menu-as-the-default-transaction-for-the-entry-point">
<h5>Application menu as the default transaction for the entry point<a class="headerlink" href="#application-menu-as-the-default-transaction-for-the-entry-point" title="Permalink to this headline">¶</a></h5>
<p>When the appmenu.htm+applist URL is coded in the “TIOA at logon” field of the default transaction for the entry
point, the application selection menu will be displayed whenever the user accesses the HTTP line using its root URL
(for example, <a class="reference external" href="http://n.n.n.n:41002">http://n.n.n.n:41002</a> for line C-HTTP).</p>
<p>The default transaction is the transaction whose external name is the same as the entry point name, and the example
below shows the default transaction for the CLIWHOST entry point:</p>
<p><img alt="image82" src="../../../_images/image824.png" />
Specifying the application selection menu in the default transaction</p>
</div>
</div>
</div>
<div class="section" id="printing-with-web-access">
<span id="ug-printing-web-access"></span><span id="index-139"></span><h3>Printing With Web Access<a class="headerlink" href="#printing-with-web-access" title="Permalink to this headline">¶</a></h3>
<p>VIRTEL provides printing support by means of virtual 3287 type printers. Each user connected to VIRTEL Web Access
has a virtual 3287 printer associated with the user’s 3270 display terminal. The name of the virtual printer is displayed
in the status bar at the bottom of the Web Access window. Data sent to the virtual printer from a host application (for
example, CICS, QMF, or VPS) is captured by VIRTEL and is saved in virtual storage.</p>
<p><img alt="image28" src="../../../_images/image287.png" /> <em>A printer icon appears in the Web Access toolbar to notify the user that print data is available</em></p>
<p>When the user clicks on this icon, VIRTEL sends the print data to the user’s browser, either as an attached file or in a
pop-up window.</p>
<p id="index-140">Two types of virtual printer are supported:</p>
<ul class="simple">
<li>LUTYPE1 (SCS): VIRTEL sends the print data to the browser as an attached file.</li>
<li>LUTYPE3 (3270 data stream): VIRTEL converts the print data to HTML and the browser displays it in a pop-up window.</li>
</ul>
<div class="section" id="virtel-definitions-for-virtual-printers">
<h4>VIRTEL definitions for virtual printers<a class="headerlink" href="#virtel-definitions-for-virtual-printers" title="Permalink to this headline">¶</a></h4>
<p>In the VIRTEL configuration file, LUTYPE1 virtual printers are defined with the “Terminal type” field set to 1 or S. The
“Relay” field contains the VTAM LU name known to the host application. The figure below shows an example definition
of 80 LUTYPE1 virtual printers with LU names REHIM000 to REHIM079:</p>
<p><a class="reference internal" href="../../../_images/image833.png"><img alt="image83" src="../../../_images/image833.png" style="width: 15.0cm; height: 9.0cm;" /></a></p>
<p><em>VIRTEL definition of LUTYPE1 virtual printers</em></p>
<p>Similarly, LUTYPE3 virtual printers are defined with the “Terminal type” field set to 2 or P. The figure below shows an
example definition of 80 LUTYPE3 virtual printers with LU names REHIP000 to REHIP079:</p>
<p><a class="reference internal" href="../../../_images/image843.png"><img alt="image84" src="../../../_images/image843.png" style="width: 15.0cm; height: 9.0cm;" /></a></p>
<p><em>VIRTEL definition of LUTYPE3 virtual printers</em></p>
</div>
<div class="section" id="associating-virtual-printers-with-terminals">
<h4>Associating virtual printers with terminals<a class="headerlink" href="#associating-virtual-printers-with-terminals" title="Permalink to this headline">¶</a></h4>
<p>To associate virtual printers with the corresponding terminal LU names, define the printer LU name in the “2nd relay”
field of the terminal pool definition. In the example below, Web Access terminals with LU names REHVT000-079 are
associated with virtual printer LU names REHIM000-079 (LUTYPE3). There is a one-for-one correspondence between
the display terminal’s LU name and the printer LU name.</p>
<p><a class="reference internal" href="../../../_images/image853.png"><img alt="image85" src="../../../_images/image853.png" style="width: 15.0cm; height: 9.0cm;" /></a></p>
<p><em>VIRTEL terminal definitions for virtual printers</em></p>
</div>
<div class="section" id="autoconnect-for-virtual-printers">
<span id="index-141"></span><h4>Autoconnect for virtual printers<a class="headerlink" href="#autoconnect-for-virtual-printers" title="Permalink to this headline">¶</a></h4>
<p>Virtual printer LUs are activated by VIRTEL at start-up time, and will remain in ACTIV state until they are acquired by the
application. For virtual printers defined with terminal type 1 or 2, the application must initiate the acquire (for
example, by CEMT SET TERM(xxxx) ACQ in CICS).
Virtual printers defined with terminal type P or S may be automatically connected to a controlling host application
when a user starts a Web Access session using the associated terminal LU. The “Entry Point” field of the virtual printer
definition should contain the name of an entry point which specifies VIR0021B as its menu program. The entry point
must have one transaction whose “Application” field contains the name of the host application to which the printer is
to be connected.
The example below shows an entry point definition for connecting printers to CICS:</p>
<p><img alt="image86" src="../../../_images/image863.png" />
Entry point definition for virtual printer autoconnect</p>
<p><img alt="image87" src="../../../_images/image873.png" />
Transaction definition for virtual printer autoconnect</p>
</div>
<div class="section" id="vtam-definitions-for-virtual-printers">
<span id="index-142"></span><h4>VTAM definitions for virtual printers<a class="headerlink" href="#vtam-definitions-for-virtual-printers" title="Permalink to this headline">¶</a></h4>
<p>Virtual printer LUs must be defined to VTAM with an appropriate LOGMODE (normally SCS for LUTYPE1, or DSILGMOD
for LUTYPE3). The necessary APPL statements may be coded in the VIRTAPPL member of the VTAMLST library, as
shown in the example below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>REHIM??? APPL AUTH=(ACQ,PASS),MODETAB=ISTINCLM,DLOGMOD=SCS,EAS=1
REHIP??? APPL AUTH=(ACQ,PASS),MODETAB=ISTINCLM,DLOGMOD=DSILGMOD,EAS=1
</pre></div>
</div>
<p><em>VTAM definitions for virtual printers</em></p>
</div>
<div class="section" id="cics-definitions-for-virtual-printers">
<h4>CICS definitions for virtual printers<a class="headerlink" href="#cics-definitions-for-virtual-printers" title="Permalink to this headline">¶</a></h4>
<p>If the virtual printer is defined to CICS via RDO, use an appropriate TYPETERM as shown in the table below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="26%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">VIRTEL Terminal Type</th>
<th class="head">CICS TYPETERM</th>
<th class="head">CICS DEVICE type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1 or S</td>
<td>DFHSCSP</td>
<td>SCSPRINT</td>
</tr>
<tr class="row-odd"><td>2 or P</td>
<td>DFHLU3 or
DFH3270P</td>
<td>LUTYPE3 or
3270P</td>
</tr>
</tbody>
</table>
<p><em>CICS TYPETERM definitions for virtual printers</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">From version 4.50 onwards, VIRTEL supports the QUERY parameter for SCS printers as well as for LUTYPE3 printers.</p>
</div>
</div>
<div class="section" id="scenarios-for-scs-printing">
<span id="index-143"></span><h4>Scenarios for SCS printing<a class="headerlink" href="#scenarios-for-scs-printing" title="Permalink to this headline">¶</a></h4>
<p>When virtual printers are defined with terminal type 1 or S, all VIRTEL transactions defined under an entry point which
offers printing must indicate the name of an “Input Scenario”. The scenario processes the HTTP request containing a
PF=SCENARIO-PRINT parameter which is issued when the user presses the “Get print data” icon (below) on the VIRTEL
Web Access toolbar.</p>
<p><img alt="image28" src="../../../_images/image287.png" /></p>
<p>The scenario accesses the SCS print data which is accumulated in a VIRTEL variable called $PRINT$, and instructs
VIRTEL to send the print data to the browser as an attached file.
Several suitable scenarios are delivered as standard in the VIRTEL SAMPLIB and LOADLIB:</p>
<dl class="docutils">
<dt>SCENFPDF</dt>
<dd>converts an SCS data stream into a PDF document</dd>
<dt>SCENFPCL</dt>
<dd>downloads PCL data into a raw printer file</dd>
<dt>SCENPPDF</dt>
<dd>converts PCL data into a PDF document (requires additional VIRTEL PCL2PDF feature running on a Windows server)</dd>
</dl>
</div>
<div class="section" id="scs-to-pdf-conversion">
<span id="index-144"></span><h4>SCS to PDF conversion<a class="headerlink" href="#scs-to-pdf-conversion" title="Permalink to this headline">¶</a></h4>
<p>When the SCENFPDF input scenario is specified in the VIRTEL transaction definition, the SCS data produced by the
application is passed to VIRTEL’s MAKEPDF component, and the resulting PDF file is sent to the browser. The browser
normally displays a dialog giving the user the choice of opening or saving the PDF file.</p>
</div>
<div class="section" id="pcl-printing">
<h4>PCL printing<a class="headerlink" href="#pcl-printing" title="Permalink to this headline">¶</a></h4>
<p>Certain applications such as VPS are capable of sending print data in PCL (HP Printer Command Language) format to
SNA printers. The PCL commands and data are sent as SCS transparent data on sessions with LUTYPE1 logical units.
The transparent data (contained in blocks of up to 253 ASCII characters preceded by a X’35’ SCS command) is extracted
from the SCS data stream and is copied into the VIRTEL variable $PRINT$.
PCL data may also be delivered in EBCDIC as part of the normal SCS data stream, and this data will be converted to
ASCII using the codepage defined by the COUNTRY parameter in the VIRTCT (see “Parameters of the VIRTCT” in the
VIRTEL Installation Guide).</p>
<p>The SCENFPCL scenario delivered as standard in the VIRTEL SAMPLIB and LOADLIB allows PCL data to be downloaded
to the user’s workstation as an attached file. The user may either save the file, or open it using an appropriate program
(such as PCL Reader from Page Technology Marketing, Inc.) to display and optionally print the PCL data.</p>
</div>
<div class="section" id="pcl-to-pdf-conversion">
<h4>PCL to PDF conversion<a class="headerlink" href="#pcl-to-pdf-conversion" title="Permalink to this headline">¶</a></h4>
<p>For customers who have licensed the optional PCL2PDF feature of VIRTEL, PCL output from host applications can be
delivered to the workstation as PDF documents.</p>
<p>The SCENPPDF scenario captures PCL data and sends it to an external server for conversion. The external server is a
Windows Server 2008R2 platform running the Syspertec PCL2PDF application. The VIRTEL configuration must include a
line with external name PCL2PDF which defines the IP address of the Windows server, as shown in the example below:</p>
<p><img alt="image88" src="../../../_images/image883.png" />
VIRTEL line definition for PCL2PDF server</p>
<p>A batch job, supplied as member PCL2PDF of the VIRTEL SAMPLIB, allows the definition of the PCL2PDF line to be
added to the VIRTEL configuration.</p>
</div>
</div>
<div class="section" id="tso-file-transfer">
<span id="ug-tso-file-transfer"></span><span id="index-145"></span><h3>TSO File Transfer<a class="headerlink" href="#tso-file-transfer" title="Permalink to this headline">¶</a></h3>
<p>VIRTEL Web Access supports transfer of files between the browser and a TSO session using the IND$FILE protocol.</p>
<div class="section" id="definitions-required-for-file-transfer">
<h4>Definitions required for file transfer<a class="headerlink" href="#definitions-required-for-file-transfer" title="Permalink to this headline">¶</a></h4>
<p>To activate the file transfer function you must access TSO via a VIRTEL transaction which specifies SCENINDT in both
the “Input scenario” and the “Output scenario” fields of the transaction definition. The figure below shows the sample
TSO transaction W2H-13 supplied with VIRTEL:</p>
<p><img alt="image89" src="../../../_images/image893.png" /> <em>TSO transaction definition for file transfer</em></p>
<p>The source code of the SCENINDT scenario is supplied in the VIRTEL SAMPLIB.
To activate the file transfer function when a user-written scenario is specified in the transaction definition, the
INDSCEN$ macro instruction must be added to both the input and output sections of the scenario.</p>
</div>
<div class="section" id="toolbar-icons-for-file-transfer">
<h4>Toolbar icons for file transfer<a class="headerlink" href="#toolbar-icons-for-file-transfer" title="Permalink to this headline">¶</a></h4>
<p>When file transfer is activated, two new icons (receive file) and (send file) appear on the VIRTEL Web Access toolbar:
VIRTEL Web Access toolbar for TSO file transfer:-</p>
<p><img alt="image90" src="../../../_images/image902.png" />
<em>VIRTEL Web Access toolbar for TSO file transfer</em></p>
</div>
<div class="section" id="receiving-a-file">
<h4>Receiving a file<a class="headerlink" href="#receiving-a-file" title="Permalink to this headline">¶</a></h4>
<p>To transfer a file from TSO to your workstation, go to ISPF option 6 (or TSO READY) and click the “Receive” icon on the
toolbar. The “Receive File” dialog will open:</p>
<p><img alt="image30" src="../../../_images/image302.jpeg" />
VIRTEL IND$FILE receive dialog (part 1)</p>
<p>Specify the TSO dataset name, surrounded by quotes if necessary. Dataset names without quotes will be prefixed by
your TSO prefix (usually your userid). Click either “Text” or “Binary”. “Text” translates the file from EBCDIC to ASCII and
inserts carriage return line feed sequences (x’0D0A’) at the end of each record. “Binary” performs no translation.
Finally click “Receive” to start the transfer.
When the file transfer is complete, the browser’s “Download” dialog appears:</p>
<p><img alt="image31" src="../../../_images/image313.jpeg" />
VIRTEL IND$FILE receive dialog (part 2)</p>
<p>Click “Save”. The “Save As” dialog will open to allow you to specify the name and location of the destination file on
your workstation:</p>
<p><img alt="image32" src="../../../_images/image323.jpeg" />
VIRTEL IND$FILE receive dialog (part 3)</p>
<p>Now select the destination file and click “Save”. If the file already exists you will be prompted for permission to
overwrite it. The “Download Complete” dialog appears when the file has been saved:</p>
<p><img alt="image33" src="../../../_images/image332.jpeg" />
VIRTEL IND$FILE receive dialog (part 4)</p>
</div>
<div class="section" id="sending-a-file">
<h4>Sending a file<a class="headerlink" href="#sending-a-file" title="Permalink to this headline">¶</a></h4>
<p>To transfer a file from your workstation to TSO, go to ISPF option 6 (or TSO READY) and click the “Send” icon on the
toolbar. The “Send File” dialog will open:</p>
<p><img alt="image34" src="../../../_images/image342.jpeg" />
VIRTEL IND$FILE send dialog (part 1)</p>
<p>Click the “Browse…” button and the “Choose File to Upload” dialog will appear:</p>
<p><img alt="image35" src="../../../_images/image352.jpeg" />
VIRTEL IND$FILE send dialog (part 2)</p>
<p>Choose the file you want to upload, and click “Open” to return to the “Send File” dialog:</p>
<p><img alt="image36" src="../../../_images/image362.jpeg" /></p>
<p>VIRTEL IND$FILE send dialog (part 3)</p>
<p>Specify the TSO dataset name, surrounded by quotes if necessary. Dataset names without quotes will be prefixed by
your TSO prefix (usually your userid).</p>
<p>If the TSO dataset does not yet exist, you may optionally specify space (units, primary quantity, and secondary
quantity), and DCB attributes (record format, logical record length, and block size). If you do not specify these
attributes, the TSO IND$FILE will use its default values.</p>
<p>Check the “Append” checkbox to append the file to the end of an existing TSO file. The “New” checkbox indicates that
the TSO file must not already exist.</p>
<p>Click either “Text” or “Binary”. “Text” translates the file from ASCII to EBCDIC and treats carriage return line feed
sequences (x’0D0A’) as end of each record markers. “Binary” performs no translation. Finally click “Send” to start the
transfer.</p>
<p><img alt="image37" src="../../../_images/image372.jpeg" /></p>
<p>VIRTEL IND$FILE send dialog (part 4)</p>
<p>The message “File transfer complete” is displayed upon successful completion of the upload.</p>
</div>
<div class="section" id="selecting-pc-codepage-for-file-transfer">
<h4>Selecting PC Codepage for file transfer<a class="headerlink" href="#selecting-pc-codepage-for-file-transfer" title="Permalink to this headline">¶</a></h4>
<p>Users can select a PC Codepage for file transfer. Possible values are :</p>
<dl class="docutils">
<dt>Windows (CP-1252)</dt>
<dd>When selected, causes the file being translated by VIRTEL according to the CP-1252 ASCII-EBCDIC translation table.</dd>
<dt>MS-DOS (CP-850)</dt>
<dd>When selected, causes the file being translated by VIRTEL according to the CP-850 ASCII-EBCDIC translation table.</dd>
</dl>
<p>The selected CP-850 table depends on the value of the COUNTRY parameter specified in the VIRTCT. If this value is
“FR”, “DE” or “BE”, system will use corresponding table FR-850, DE-850 or BE-850. If the specified country value is
different, by default the BE-850 table will be used to support CECP 500 international EBCDIC.</p>
</div>
<div class="section" id="saving-and-reusing-file-transfer-parameters">
<h4>Saving and reusing file transfer parameters<a class="headerlink" href="#saving-and-reusing-file-transfer-parameters" title="Permalink to this headline">¶</a></h4>
<p>Users who frequently carry out the same or similar file transfers can save the file transfer parameters for later reuse.
To save a file transfer, enter the dataset name and the type of transfer, then click the “Save” button:</p>
<p><img alt="image38" src="../../../_images/image386.png" />
VIRTEL IND$FILE Receive dialog (saved transfers)</p>
<p>The user can then choose a name for the saved transfer, and click “OK” to save the parameters. At the next transfer,
the user clicks the name of the saved transfer to retrieve the parameters, then clicks “Receive” to start the transfer.</p>
<p><img alt="image39" src="../../../_images/image396.png" />
VIRTEL IND$FILE Saving the file transfer parameters</p>
<p>Users can save transfer parameters for both “Send” and “Receive”. The parameters are saved in browser local storage.
The number of sets of parameters which can be saved is limited only by the amount of local storage available.</p>
</div>
</div>
<div class="section" id="accessing-vtam-applications">
<span id="ug-accessing-vtam-applications"></span><span id="index-146"></span><h3>Accessing VTAM Applications<a class="headerlink" href="#accessing-vtam-applications" title="Permalink to this headline">¶</a></h3>
<p>Normally the VIRTEL administrator provides access to VTAM applications by configuring a specific VIRTEL transaction
for each application. However some users require the ability to access any VTAM application, including those not
configured by the administrator, similar to the function provided by VTAM’s USSTAB USS10 screen. For these users,
VIRTEL provides transactions named W2H-16 and CLI-16 whose external name is VTAM.
This transaction displays a screen on which the user can enter the ACBNAME of the VTAM application, together with
optional LOGON DATA and LOGMODE.</p>
<div class="section" id="vtam-logon-screen">
<h4>VTAM logon screen<a class="headerlink" href="#vtam-logon-screen" title="Permalink to this headline">¶</a></h4>
<p>To access VIRTEL’s VTAM logon screen, click on “Other applications” on the VIRTEL Web Access menu (port 41001) or
enter its URL directly:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="p">:</span><span class="mi">41001</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">WEB2AJAX</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">VTAM</span>
</pre></div>
</div>
<p><img alt="image91" src="../../../_images/image919.png" />
<em>VTAM logon screen in VIRTEL Web Access mode</em></p>
<p>To access, for example, TSO with logmode SNX32705, type TSO in the “LOGON APPLID” field and SNX32705 in the
“LOGMODE” field, then press enter.</p>
<p>You can exit this screen by pressing F3.</p>
<p>Lines 3 and 4 of the screen indicate the name of your installation and are taken from the TITRE1 and TITRE2
parameters of the VIRTCT (see VIRTEL Installation Guide).</p>
<p>The layout of the VTAM logon screen can be customized by assembling the map in member EIRM00U in the VIRTEL
SAMPLIB.</p>
</div>
<div class="section" id="installing-the-vtam-logon-transaction">
<h4>Installing the VTAM logon transaction<a class="headerlink" href="#installing-the-vtam-logon-transaction" title="Permalink to this headline">¶</a></h4>
<p>To permit access to the VTAM logon screen, the administrator defines a VIRTEL transaction which calls VIRTEL program
VIR0021U, as shown in the example below. The transaction should have “Security” set to 1 to force the user to sign on
before the screen is displayed.</p>
<p>The VTAM logon screen is protected by a security resource named prefix.W2H-16 or prefix.CLI-16 (where prefix is the
value of the PRFSECU parameter in the VIRTCT) in the RACF FACILITY class. Provided the “Security” field is set to 1, and
security is activated in the VIRTCT, only those users having READ access to the resource can obtain the VTAM logon
screen.</p>
<p><img alt="image41" src="../../../_images/image4115.png" />
<em>Example VIRTEL transaction for VTAM logon via Web Access</em></p>
</div>
</div>
<div class="section" id="site-customization-colors-and-logo">
<span id="ug-customization-colors-logo"></span><span id="index-147"></span><h3>Site Customization - Colors And Logo<a class="headerlink" href="#site-customization-colors-and-logo" title="Permalink to this headline">¶</a></h3>
<p>The VIRTEL administrator can customize the color settings for all applications or for specific applications. The custom settings are defined in a style sheet which by default is called  custom.css. The file is modified by an administrator and then uploaded to a VIRTEL directory designated for storage of customer files. In compatibility mode this is usually CLI-DIR, normally found within the HTML-TRSF VSAM file. In “Option mode”, however, this can be any user directory or file name. See <a class="reference internal" href="#ug-customizing-with-option"><span class="std std-ref">“Virtel Customization modes”</span></a> for more details on the customization modes.</p>
<div class="section" id="using-a-css-file-for-customization">
<span id="index-148"></span><h4>Using a CSS file for customization<a class="headerlink" href="#using-a-css-file-for-customization" title="Permalink to this headline">¶</a></h4>
<p>In “Default mode” the custom.css file is loaded from the directory designated by the transaction W2H-03CC (for entry point WEB2HOST on port 41001) or CLI-03CC (for entry point CLIWHOST on port 41002). These transactions have external name w2h and specify the path name /w2h/custom-css in the URL Prefix field. When VIRTEL is first installed, these transactions point to directory W2H-DIR for W2H-03CC and to directory CLI-DIR for CLI-03CC which contains a dummy version of the file custom.css. A custom.css file or a designated “Option” mode CSS file can be modified to include bespoke CSS customization. The following process looks at how to customize the delivered custom.css file, maintaining a copy in the CLI-DIR, and running in “Compatibility Mode”. See <a class="reference internal" href="#ug-customizing-with-option"><span class="std std-ref">“Virtel Customization Modes”</span></a> for more details on the customization modes. All of the following examples relate to updating a customized copy of custom.css. If running in “Option mode” this file could be called /option/custCSS.myCICS1.css, applicable to a transaction only, or /option/custCSS.global.css, a global entry applicable to all Entry Points and transactions.</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">Updating custom.css in the default W2H-DIR directory is not recommended as changes will be overwritten by maintenance or future Virtel release updates. Keep customized elements such as custom.css in the CLI-DIR directory or in a designated “option” file.</p>
</div>
<p>The procedure for activating customized settings in “Compatibility Mode” using the 3270 Administration panels are given below:</p>
<ol class="arabic simple">
<li>Obtain a copy of the default custom.css file from the sources.zip file or download a copy from the browser:-</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="p">:</span><span class="mi">41001</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">custom</span><span class="o">.</span><span class="n">css</span>
</pre></div>
</div>
<p>(where n.n.n.n is the IP address of your VIRTEL)</p>
<ol class="arabic simple" start="2">
<li>Save the custom.css file in a directory on your workstation.</li>
<li>Open the custom.css file using a text editor such as notepad.</li>
<li>Edit the custom.css file with the color and/or logo settings you require (see examples below), then save the updated file.</li>
<li>Open the VIRTEL Web Access menu (URL <a class="reference external" href="http://n.n.n.n:41001">http://n.n.n.n:41001</a>) and click the “Upload” link</li>
<li>Click “Browse” and navigate to the directory where you saved the updated custom.css. Click on the custom.css file, then click the “CLI-DIR” button to upload the file to VIRTEL.</li>
<li>From the VIRTEL Web Access menu (URL <a class="reference external" href="http://n.n.n.n:41001">http://n.n.n.n:41001</a>) click the “Admin” link.</li>
<li>Press “F3 - Entry Points” then click “CLIWHOST”</li>
<li>Press “F4 - Transactions” then click “CLI-03CC”</li>
<li>Press “F12 - View/Add” and type CLI-DIR in the “Application” field, overwriting the original value W2H-DIR</li>
<li>Press “F1 - Update” at the Transaction Detail Definition screen, then “F3 – Return” twice to return to the List of Entry Points screen, then “F1 – Update” again to update the entry point.</li>
<li>Run Virtel in “Compatibility mode” by updating the TCT. See <cite>“Running in Compatibility Mode”&lt;#UG_compatibility mode&gt;</cite> for further details.</li>
</ol>
</div>
<div class="section" id="customizing-the-toolbar-color-by-application">
<span id="index-149"></span><h4>Customizing the toolbar color by application<a class="headerlink" href="#customizing-the-toolbar-color-by-application" title="Permalink to this headline">¶</a></h4>
<p>It is sometimes useful for the user to have a clear visual indication of which system he or she is logged on to. This example shows how to set the color of the toolbar to yellow for application SPCICSP and pink for application SPCICSQ.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span> <span class="n">style</span> <span class="n">sheet</span> <span class="k">for</span> <span class="n">site</span> <span class="n">customization</span>
<span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="n">Copyright</span> <span class="n">SysperTec</span> <span class="n">Communication</span> <span class="mi">2007</span><span class="p">,</span><span class="mi">2010</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>
<span class="o">*/</span>
<span class="o">.</span><span class="n">SPCICSP</span> <span class="c1">#toolbar {background-color:yellow;}</span>
<span class="o">.</span><span class="n">SPCICSQ</span> <span class="c1">#toolbar {background-color:pink;}</span>
</pre></div>
</div>
<p><em>Example custom.css for coloring the toolbar according to CICS region</em></p>
<p><img alt="image42" src="../../../_images/image423.jpeg" />
Web Access screen with yellow toolbar for SPCICSP</p>
<p><img alt="image43" src="../../../_images/image432.jpeg" />
Web Access screen with pink toolbar for SPCICSQ</p>
</div>
<div class="section" id="adding-custom-text-to-the-toolbar">
<span id="index-150"></span><h4>Adding custom text to the toolbar<a class="headerlink" href="#adding-custom-text-to-the-toolbar" title="Permalink to this headline">¶</a></h4>
<p>Another way of providing a clear visual indication of which application the user is logged on to is to add a text label to the toolbar. In this example the text “MVS1” is displayed when logged on to application TSO1A, and “MVS2” is displayed for application TSO2A.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span> <span class="n">style</span> <span class="n">sheet</span> <span class="k">for</span> <span class="n">site</span> <span class="n">customisation</span>
<span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="n">Copyright</span> <span class="n">SysperTec</span> <span class="n">Communication</span> <span class="mi">2007</span><span class="p">,</span><span class="mi">2010</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>
<span class="o">*/</span>
<span class="o">.</span><span class="n">TSO1A</span> <span class="o">.</span><span class="n">toolbarLast</span><span class="p">:</span><span class="n">before</span> <span class="p">{</span>
<span class="n">content</span><span class="p">:</span> <span class="s2">&quot;MVS1&quot;</span><span class="p">;</span>
<span class="n">color</span><span class="p">:</span> <span class="n">gray</span><span class="p">;</span>
<span class="n">opacity</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">;</span>
<span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span> <span class="mi">30</span><span class="n">px</span><span class="p">;</span>
<span class="n">width</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
<span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">center</span><span class="p">;</span>
<span class="n">z</span><span class="o">-</span><span class="n">index</span><span class="p">:</span> <span class="mi">1000</span><span class="p">;</span>
<span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">text</span><span class="o">-</span><span class="n">stroke</span><span class="p">:</span> <span class="mi">1</span><span class="n">px</span> <span class="c1">#000;</span>
<span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">text</span><span class="o">-</span><span class="n">fill</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="n">transparent</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">.</span><span class="n">TSO2A</span> <span class="o">.</span><span class="n">toolbarLast</span><span class="p">:</span><span class="n">before</span> <span class="p">{</span>
<span class="n">content</span><span class="p">:</span> <span class="s2">&quot;MVS2&quot;</span><span class="p">;</span>
<span class="n">color</span><span class="p">:</span> <span class="n">red</span><span class="p">;</span>
<span class="n">opacity</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">;</span>
<span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span> <span class="mi">30</span><span class="n">px</span><span class="p">;</span>
<span class="n">width</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
<span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">center</span><span class="p">;</span>
<span class="n">z</span><span class="o">-</span><span class="n">index</span><span class="p">:</span> <span class="mi">1000</span><span class="p">;</span>
<span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">text</span><span class="o">-</span><span class="n">stroke</span><span class="p">:</span> <span class="mi">1</span><span class="n">px</span> <span class="n">red</span><span class="p">;</span>
<span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">text</span><span class="o">-</span><span class="n">fill</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="n">transparent</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example custom.css for adding custom text to the toolbar</em></p>
<p><img alt="image44" src="../../../_images/image442.jpeg" />
<em>Web Access screen with custom text in the toolbar</em></p>
<span class="target" id="ug-hide-information"></span></div>
<div class="section" id="showing-hiding-server-informations">
<span id="index-151"></span><h4>Showing / Hiding server informations<a class="headerlink" href="#showing-hiding-server-informations" title="Permalink to this headline">¶</a></h4>
<p>It is sometimes useful to have a clear visual indication of which server a user is logged on to, its version and the maintenance level applied on the system. By default, the value specified into the APPLID parameter of the VIRTCT is displayed at the top-right of the toolbar as shown below. This information is followed by the running version number
and the VIRTEL Web access level of maintenance used. This last information is enclosed in parentheses.</p>
<p><img alt="image45" src="../../../_images/image452.jpeg" /></p>
<p>The running version and the level of maintenance cannot be hidden, only the server name can be permanently removed by modifying the w2hparm.hideinfo attributes present in the customized w2hparms.js file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="n">Configuration</span> <span class="n">of</span> <span class="n">the</span> <span class="n">server</span> <span class="n">name</span> <span class="n">connected</span> <span class="n">to</span><span class="o">.</span>
<span class="o">*/</span>
<span class="n">w2hparm</span><span class="o">.</span><span class="n">hideinfo</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
</pre></div>
</div>
<p><em>Example w2hparm.js for hiding the mainframe application name on which a user is connected to.</em></p>
<p>If the default value is preserved, the user can hide this information for his own usage by checking “Hide Virtel
information in toolbar” in the Display tab of the settings panel.</p>
<span class="target" id="ug-hide-toolbar"></span></div>
<div class="section" id="hiding-the-toolbar">
<span id="index-152"></span><h4>Hiding the toolbar<a class="headerlink" href="#hiding-the-toolbar" title="Permalink to this headline">¶</a></h4>
<p>The administrator may wish to prevent users from accessing features like copy/paste, print, and settings. This example shows how to hide the toolbar using a custom.css file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span> <span class="n">style</span> <span class="n">sheet</span> <span class="k">for</span> <span class="n">site</span> <span class="n">customization</span>
<span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="n">Copyright</span> <span class="n">SysperTec</span> <span class="n">Communication</span> <span class="mi">2007</span><span class="p">,</span><span class="mi">2010</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>
<span class="o">*/</span>
<span class="c1">#toolbar {display:none;}/*</span>
</pre></div>
</div>
<p><em>Example custom css for hiding the toolbar</em></p>
<p>You can also use a custom Javascript to remove icons individually from the toolbar, see <a class="reference internal" href="#ug-remove-icons"><span class="std std-ref">“Removing unwanted toolbar icons”</span></a>.</p>
<div class="section" id="modifying-the-3270-colors">
<span id="index-153"></span><h5>Modifying the 3270 colors<a class="headerlink" href="#modifying-the-3270-colors" title="Permalink to this headline">¶</a></h5>
<p>Some installations prefer to modify the colors displayed on the 3270 screen to make the characters more readable.
This example shows how to modify the colors used by VIRTEL Web Access:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span> <span class="n">style</span> <span class="n">sheet</span> <span class="n">customisation</span> <span class="k">for</span> <span class="mi">3270</span> <span class="n">colors</span>
<span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="n">Copyright</span> <span class="n">SysperTec</span> <span class="n">Communication</span> <span class="mi">2012</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>
<span class="o">*/</span>
<span class="o">.</span><span class="n">NBLUE</span><span class="p">,</span> <span class="o">.</span><span class="n">UBLUE</span><span class="p">,</span> <span class="o">.</span><span class="n">BBLUE</span> <span class="p">{</span><span class="n">color</span><span class="p">:</span><span class="c1">#7890F0;}</span>
<span class="o">.</span><span class="n">RBLUE</span> <span class="p">{</span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span><span class="c1">#7890F0;}</span>
<span class="o">.</span><span class="n">NRED</span><span class="p">,</span> <span class="o">.</span><span class="n">URED</span><span class="p">,</span> <span class="o">.</span><span class="n">BRED</span> <span class="p">{</span><span class="n">color</span><span class="p">:</span><span class="c1">#F21816;}</span>
<span class="o">.</span><span class="n">RRED</span> <span class="p">{</span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span><span class="c1">#F21816;}</span>
<span class="o">.</span><span class="n">NPINK</span><span class="p">,</span> <span class="o">.</span><span class="n">UPINK</span><span class="p">,</span> <span class="o">.</span><span class="n">BPINK</span> <span class="p">{</span><span class="n">color</span><span class="p">:</span><span class="c1">#FF00FE;}</span>
<span class="o">.</span><span class="n">RPINK</span> <span class="p">{</span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span><span class="c1">#FF00FE;}</span>
<span class="o">.</span><span class="n">NGREEN</span><span class="p">,</span> <span class="o">.</span><span class="n">UGREEN</span><span class="p">,</span> <span class="o">.</span><span class="n">BGREEN</span> <span class="p">{</span><span class="n">color</span><span class="p">:</span><span class="c1">#24D82F;}</span>
<span class="o">.</span><span class="n">RGREEN</span> <span class="p">{</span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span><span class="c1">#24D82F;}</span>
<span class="o">.</span><span class="n">NTURQUOISE</span><span class="p">,</span> <span class="o">.</span><span class="n">UTURQUOISE</span><span class="p">,</span> <span class="o">.</span><span class="n">BTURQUOISE</span> <span class="p">{</span><span class="n">color</span><span class="p">:</span><span class="c1">#58F0F1;}</span>
<span class="o">.</span><span class="n">RTURQUOISE</span> <span class="p">{</span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span><span class="c1">#58F0F1;}</span>
<span class="o">.</span><span class="n">NYELLOW</span><span class="p">,</span> <span class="o">.</span><span class="n">UYELLOW</span><span class="p">,</span> <span class="o">.</span><span class="n">BYELLOW</span> <span class="p">{</span><span class="n">color</span><span class="p">:</span><span class="c1">#FFFF00;}</span>
<span class="o">.</span><span class="n">RYELLOW</span> <span class="p">{</span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span><span class="c1">#FFFF00;}</span>
<span class="o">.</span><span class="n">NWHITE</span><span class="p">,</span> <span class="o">.</span><span class="n">UWHITE</span><span class="p">,</span> <span class="o">.</span><span class="n">BWHITE</span> <span class="p">{</span><span class="n">color</span><span class="p">:</span><span class="c1">#FFFFFF;}</span>
<span class="o">.</span><span class="n">RWHITE</span> <span class="p">{</span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span><span class="c1">#FFFFFF;}</span>
</pre></div>
</div>
<p><em>Example custom.css for modifying the 3270 colors</em></p>
<p>In this stylesheet, BLUE, RED, PINK, GREEN, TURQUOISE, YELLOW, and WHITE represent the 7 colors of the 3270 palette, with a prefix indicating the highlighting mode: N=normal, U=underscore, B=blink, R=reverse video. The color values (for example, #7890F0) are expressed in hexadecimal RGB encoding or as color names. For more explanation, see :-</p>
<ul class="simple">
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Web_colors">http://en.wikipedia.org/wiki/Web_colors</a></li>
<li><a class="reference external" href="http://www.w3schools.com/html/html_colornames.asp">http://www.w3schools.com/html/html_colornames.asp</a></li>
</ul>
</div>
</div>
<div class="section" id="adding-a-company-logo">
<span id="index-154"></span><h4>Adding a company logo<a class="headerlink" href="#adding-a-company-logo" title="Permalink to this headline">¶</a></h4>
<p>This example shows how to display an icon (for example, a company logo) at the left of the toolbar:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>/*
* VIRTEL Web Access style sheet customisation for company logo
* (c)Copyright SysperTec Communication 2012 All Rights Reserved
*/
#toolbar td#companyIcon {
height:30px;
display:table-cell;
}
#companyIcon div {
background-image:url(&quot;/w2h/virtblue.jpg&quot;);
background-position:0px -4px;
background-repeat:no-repeat;
height:26px;
width:145px;
}
Example custom.css for displaying company logo in the toolbar
This example shows how to replace the Virtel logo in the VIRTEL Web Access menu and the Application menu by your
company logo:
/*
* VIRTEL Web Access style sheet for site customisation
* (c)Copyright SysperTec Communication 2013 All Rights Reserved
* $Id$
*/
#appmenulogo {
background-image: url(&quot;mycompany.gif&quot;);
height: 65px;
width: 266px;
}
</pre></div>
</div>
<p><em>Example custom.css for replacing the Virtel logo by a company logo</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If no explicit path is given, the company logo will be loaded from the same directory as the custom.css file.</p>
</div>
</div>
<div class="section" id="removing-3d-hover-effects-on-the-toolbar-buttons">
<span id="index-155"></span><h4>Removing 3D/hover effects on the toolbar buttons<a class="headerlink" href="#removing-3d-hover-effects-on-the-toolbar-buttons" title="Permalink to this headline">¶</a></h4>
<p>This example shows how to remove the 3D/hover effects on toolbar buttons by adding orders in the custom.css file:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span> <span class="n">style</span> <span class="n">sheet</span> <span class="n">customisation</span> <span class="k">for</span> <span class="n">removing</span> <span class="mi">3</span><span class="n">D</span><span class="o">/</span><span class="n">hover</span> <span class="n">effects</span>
<span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="n">Copyright</span> <span class="n">SysperTec</span> <span class="n">Communication</span> <span class="mi">2014</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>
<span class="o">*/</span>
<span class="c1">#toolbar td .tbButton, #toolbar td .tbButton:hover, #toolbar td .tbButton:active {</span>
<span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="n">inherit</span><span class="p">;</span>
<span class="n">border</span><span class="p">:</span> <span class="n">inherit</span><span class="p">;</span>
<span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="p">:</span> <span class="n">inherit</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example custom.css for removing 3D/hover effects on buttons</em></p>
</div>
<div class="section" id="changing-background-color-of-the-toolbar-buttons">
<span id="index-156"></span><h4>Changing background color of the toolbar buttons<a class="headerlink" href="#changing-background-color-of-the-toolbar-buttons" title="Permalink to this headline">¶</a></h4>
<p>This example shows how to change the backgroung color of the toolbar buttons by adding orders in the custom.css file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span> <span class="n">style</span> <span class="n">sheet</span> <span class="n">customisation</span> <span class="n">the</span> <span class="n">background</span> <span class="n">of</span> <span class="n">the</span> <span class="n">toolbar</span> <span class="n">buttons</span>
<span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="n">Copyright</span> <span class="n">SysperTec</span> <span class="n">Communication</span> <span class="mi">2014</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>
<span class="o">*/</span>
<span class="o">|-</span> <span class="n">transparent</span> <span class="s2">&quot;at rest&quot;</span>
<span class="o">|-</span> <span class="n">white</span> <span class="n">when</span> <span class="n">cursor</span> <span class="n">moves</span> <span class="n">on</span>
<span class="o">|-</span> <span class="n">yellow</span> <span class="n">when</span> <span class="n">button</span> <span class="ow">is</span> <span class="n">clicked</span>
<span class="c1">#toolbar td .tbButton {</span>
<span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="n">inherit</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">#toolbar td .tbButton:hover {</span>
<span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="n">white</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">#toolbar td .tbButton:active {</span>
<span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="n">yellow</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">|</span> <span class="n">To</span> <span class="n">remove</span> <span class="n">the</span> <span class="n">background</span> <span class="n">color</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">border</span> <span class="n">of</span> <span class="n">buttons</span> <span class="s2">&quot;at rest&quot;</span><span class="p">:</span>
<span class="c1">#toolbar td .tbButton {</span>
<span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="n">inherit</span><span class="p">;</span>
<span class="n">border</span><span class="p">:</span> <span class="mi">1</span><span class="n">px</span> <span class="n">solid</span> <span class="n">transparent</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example custom.css managing the background color of the toolbar buttons</em></p>
</div>
<div class="section" id="icon-display-troubleshooting">
<span id="index-157"></span><h4>Icon display troubleshooting<a class="headerlink" href="#icon-display-troubleshooting" title="Permalink to this headline">¶</a></h4>
<p>If some icons on the toolbar are displayed with some parasites on the border, please check that the browser is not in a zoom mode greater than 100%.</p>
</div>
</div>
<div class="section" id="site-customization-javascript-functions">
<span id="index-158"></span><h3>Site Customization - Javascript Functions<a class="headerlink" href="#site-customization-javascript-functions" title="Permalink to this headline">¶</a></h3>
<p id="index-159">A custom Javascript file can be used for calling bespoke functions or setting attributes in Virtel objects which can control or modify default behaviour. When running in “default” or “compatibility mode” this file is normally called custom.js. An alternate mode, known as “Option Mode” provides better granularity for bespoke enhancements. See <a class="reference internal" href="#ug-customizing-with-option"><span class="std std-ref">“Virtel Customising modes”</span></a> for further details on how to customise Virtel using the available mode settings. AS delivered, Virtel runs in the “default” mode, locating a dummy custom.js file from the W2H-DIR directory. The remainder of this section refers to running Virtel in “compatibility” mode and customizing a custom.js file and maintaining it in the CLI-DIR directory. This will require that the HTSET1=(OPTION-DEFAULT-COMPATIBILITY) option is coded in the TCT. If running in “Option Mode” remove this statement from the TCT.</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">Updating custom.js in the default W2H-DIR directory is not recommended as changes will be overwritten by maintenance or future Virtel release updates. Keep customized elements such as custom.js in the CLI-DIR directory or in a designated “option” file.</p>
</div>
<p>To take into account site-specific Javascript extensions for Web Access, the WEB2AJAX.htm page template loads a custom Javascript file when a session is started. An empty file, called custom.js by default, is delivered as standard in the W2HDIR directory. The CLI-03CJ (/w2h/custom-js) transaction as delivered under the CLIWHOST entry point refers to the W2H-DIR directory. An administrator can modify this transaction to reference a different directory containing a site-specific version of custom.js. The CLI-DIR directory, which is intended for client-specific files, may be used for this purpose.  The changes as described in this section pertain to running in “Compatibility mode” whereby modifications are made to a modified custom.js file. See <a class="reference internal" href="#ug-customizing-with-option"><span class="std std-ref">“Virtel Customization modes”</span></a> for more details on the available customization modes.</p>
<p>To facilitate site-specific modifications to custom.js, VIRTEL Web Access calls various custom exits at strategic points in its processing. These exits are optional Javascript functions which can be codes custom.js if required. The exits are described below.</p>
<div class="section" id="javascript-exits-which-can-be-customized">
<span id="index-160"></span><h4>Javascript Exits which can be customized<a class="headerlink" href="#javascript-exits-which-can-be-customized" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default" id="index-161"><div class="highlight"><pre><span></span><span class="n">before_launchApplink</span><span class="p">(</span><span class="n">href</span><span class="p">)</span>
</pre></div>
</div>
<p>This function is called before launching an application from the applist menu.</p>
<div class="highlight-default" id="index-162"><div class="highlight"><pre><span></span><span class="n">after_standardInit</span><span class="p">()</span>
</pre></div>
</div>
<p>This function is called after the session with the host application has started.</p>
<div class="highlight-default" id="index-163"><div class="highlight"><pre><span></span><span class="n">before_submitForm</span><span class="p">(</span><span class="n">pfKey</span><span class="p">,</span><span class="n">oForm</span><span class="p">)</span>
</pre></div>
</div>
<p>This function is called before submitting a request to the VIRTEL server. The arguments passed to before_submitForm are:</p>
<dl class="docutils">
<dt>pfKey</dt>
<dd>the name of the key pressed: “ENTER”, “PF1”, etc.</dd>
<dt>oForm</dt>
<dd>a DOM object representing the form to be submitted (usually document.virtelForm)</dd>
</dl>
<div class="highlight-default" id="index-164"><div class="highlight"><pre><span></span><span class="n">after_responseHandle</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">url</span><span class="p">,</span><span class="n">xtim</span><span class="p">)</span>
</pre></div>
</div>
<p>This function is called after receiving a response from the VIRTEL server. The arguments passed to after_responseHandle are:</p>
<dl class="docutils">
<dt>o</dt>
<dd>the XMLHttpRequest object (contains the status and responseText)</dd>
<dt>url</dt>
<dd>the URL which was used in the request</dd>
<dt>xtim</dt>
<dd>a Javascript Date object representing the time the request was sent to the server</dd>
</dl>
<div class="highlight-default" id="index-165"><div class="highlight"><pre><span></span><span class="n">modify_settingsValues</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
<p>This function is called before the list of possible values for a parameter is displayed in the VIRTEL Web Access Settings menu. It allows the list of values to be modified. The arguments passed to modify_settingsValues are:</p>
<dl class="docutils">
<dt>name</dt>
<dd>the parameter name</dd>
<dt>values</dt>
<dd>the list of possible values</dd>
</dl>
<p>The return value is treated as the new list of possible values. If the function returns null or undefined, the list remains
unchanged.</p>
<div class="highlight-default" id="index-166"><div class="highlight"><pre><span></span><span class="n">when_init</span><span class="p">()</span>
</pre></div>
</div>
<p>This function is called for each subpage after vir3270 initialisation.</p>
<div class="highlight-default" id="index-167"><div class="highlight"><pre><span></span><span class="n">when_focusGained</span><span class="p">()</span>
</pre></div>
</div>
<p>This function is called whenever the 3270 window gains the focus.</p>
<div class="highlight-default" id="index-168"><div class="highlight"><pre><span></span><span class="n">when_focusLost</span><span class="p">()</span>
</pre></div>
</div>
<p>This function is called whenever the 3270 window loses the focus.</p>
</div>
<div class="section" id="customizing-toolbar-icons">
<span id="index-169"></span><h4>Customizing Toolbar icons<a class="headerlink" href="#customizing-toolbar-icons" title="Permalink to this headline">¶</a></h4>
<p>This example uses the after_standardInit function to insert additional icons into the toolbar when the session is started. Icons may subsequently be added or removed from the toolbar after each screen by means of the after_responseHandle function.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="n">Copyright</span> <span class="n">SysperTec</span> <span class="n">Communication</span> <span class="mi">2012</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>
<span class="mf">1.</span> <span class="n">Incoming</span> <span class="n">calls</span>
<span class="mi">125</span>
<span class="o">*</span> <span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span> <span class="n">customer</span><span class="o">-</span><span class="n">specific</span> <span class="n">Javascript</span> <span class="n">functions</span>
<span class="o">*/</span>
<span class="o">/*</span>
<span class="o">*</span> <span class="n">Adds</span> <span class="n">a</span> <span class="n">button</span> <span class="n">to</span> <span class="n">the</span> <span class="n">toolbar</span> <span class="n">which</span> <span class="n">performs</span> <span class="n">a</span> <span class="n">Google</span> <span class="n">search</span> <span class="k">for</span>
<span class="o">*</span> <span class="n">the</span> <span class="n">text</span> <span class="n">selected</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">red</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">the</span> <span class="mi">3270</span> <span class="n">screen</span><span class="p">,</span> <span class="ow">or</span> <span class="k">for</span> <span class="n">the</span>
<span class="o">*</span> <span class="n">word</span> <span class="n">at</span> <span class="n">the</span> <span class="n">cursor</span> <span class="k">if</span> <span class="n">no</span> <span class="n">box</span> <span class="ow">is</span> <span class="n">drawn</span>
<span class="o">*/</span>
<span class="n">function</span> <span class="n">after_standardInit</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">addtoolbarbutton</span><span class="p">(</span><span class="mi">999</span><span class="p">,</span> <span class="s2">&quot;http://www.google.com/favicon.ico&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Search engine query&quot;</span><span class="p">,</span> <span class="n">do_search</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">function</span> <span class="n">do_search</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">var</span> <span class="n">searcharg</span> <span class="o">=</span> <span class="n">VIR3270</span><span class="o">.</span><span class="n">getBoxedText</span><span class="p">()</span> <span class="o">||</span> <span class="n">VIR3270</span><span class="o">.</span><span class="n">getWordAtCursor</span><span class="p">();</span>
  <span class="n">var</span> <span class="n">windowname</span> <span class="o">=</span> <span class="s2">&quot;search&quot;</span><span class="p">;</span>
  <span class="n">var</span> <span class="n">searchURL</span> <span class="o">=</span> <span class="s2">&quot;http://www.google.com&quot;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">searcharg</span><span class="p">)</span> <span class="n">searchURL</span> <span class="o">+=</span> <span class="s2">&quot;/search?q=&quot;</span> <span class="o">+</span>
    <span class="n">encodeURIComponent</span><span class="p">(</span><span class="n">searcharg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">/</span>\<span class="n">s</span><span class="o">+/</span><span class="n">g</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">));</span>
<span class="n">var</span> <span class="n">windowopts</span> <span class="o">=</span> <span class="s2">&quot;location=yes,status=yes,resizable=yes,&quot;</span><span class="o">+</span>
   <span class="s2">&quot;scrollbars=yes,toolbar=yes,menubar=yes,width=640,height=480&quot;</span><span class="p">;</span>
<span class="n">var</span> <span class="n">searchwin</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">searchURL</span><span class="p">,</span> <span class="n">windowname</span><span class="p">,</span> <span class="n">windowopts</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">searchwin</span><span class="p">)</span> <span class="n">searchwin</span><span class="o">.</span><span class="n">focus</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example custom.js to customize the toolbar icons</em></p>
</div>
<div class="section" id="centering-non-standard-icons">
<span id="index-170"></span><h4>Centering non-standard icons<a class="headerlink" href="#centering-non-standard-icons" title="Permalink to this headline">¶</a></h4>
<p>The best size for an icon is 32x32 pixels. For bigger or smaller icons, it possible to offer better center rendering in modifying the content of the class attribute passed within the “addtoolbarbutton” function in conjunction of using a specific css attribute.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="n">Copyright</span> <span class="n">SysperTec</span> <span class="n">Communication</span> <span class="mi">2014</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>
<span class="o">*</span> <span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span> <span class="n">customer</span><span class="o">-</span><span class="n">specific</span> <span class="n">Javascript</span> <span class="n">functions</span>
<span class="o">*</span> <span class="n">Resizing</span> <span class="n">a</span> <span class="n">too</span> <span class="n">small</span> <span class="ow">or</span> <span class="n">too</span> <span class="n">big</span> <span class="n">toolbar</span> <span class="n">icon</span><span class="o">.</span>
<span class="o">*</span> <span class="n">For</span> <span class="n">example</span> <span class="n">toosmall_pic</span><span class="o">.</span><span class="n">png</span><span class="o">=</span><span class="mi">22</span><span class="n">x22</span> <span class="ow">and</span> <span class="n">toobig_pic</span><span class="o">.</span><span class="n">jpg</span><span class="o">=</span><span class="mi">145</span><span class="n">x30</span>
<span class="o">*/</span>
<span class="n">addtoolbarbutton</span><span class="p">(</span><span class="mi">999</span><span class="p">,</span> <span class="s2">&quot;/w2h/toosmall_pic.png&quot;</span><span class="p">,</span> <span class="s2">&quot;Custom button #1 tooltip&quot;</span><span class="p">,</span> <span class="n">do_search</span><span class="p">,</span> <span class="s2">&quot;tbButton size22x22&quot;</span><span class="p">);</span>
<span class="n">addtoolbarbutton</span><span class="p">(</span><span class="mi">999</span><span class="p">,</span> <span class="s2">&quot;/w2h/toobig_pic.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;Custom button #2 tooltip&quot;</span><span class="p">,</span> <span class="n">do_search</span><span class="p">,</span> <span class="s2">&quot;tbButton size145x30&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><em>Example custom.js to specify the toolbar icon size</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="c1">#toolbar td img.tbButton.size22x22 {</span>
  <span class="n">width</span><span class="p">:</span> <span class="mi">22</span><span class="n">px</span><span class="p">;</span>
  <span class="n">height</span><span class="p">:</span> <span class="mi">22</span><span class="n">px</span><span class="p">;</span>
  <span class="n">padding</span><span class="p">:</span> <span class="mi">5</span><span class="n">px</span><span class="p">;</span> <span class="o">/*</span> <span class="n">padding</span> <span class="ow">is</span> <span class="n">calculated</span> <span class="n">to</span> <span class="n">center</span> <span class="n">the</span> <span class="n">picture</span> <span class="n">horizontally</span> <span class="ow">and</span> <span class="n">vertically</span> <span class="ow">in</span> <span class="n">the</span> <span class="mi">32</span><span class="n">x32</span> <span class="n">allocated</span> <span class="o">*/</span>
<span class="p">}</span>

<span class="c1">#toolbar td img.tbButton.size145x30 {</span>
  <span class="n">width</span><span class="p">:</span> <span class="mi">145</span><span class="n">px</span><span class="p">;</span>
  <span class="n">height</span><span class="p">:</span> <span class="mi">30</span><span class="n">px</span><span class="p">;</span>
  <span class="n">padding</span><span class="p">:</span> <span class="mi">1</span><span class="n">px</span> <span class="mi">0</span><span class="p">;</span> <span class="o">/*</span> <span class="n">padding</span> <span class="ow">is</span> <span class="n">calculated</span> <span class="n">to</span> <span class="n">center</span> <span class="n">the</span> <span class="n">picture</span> <span class="n">vertically</span> <span class="ow">in</span> <span class="n">the</span> <span class="mi">32</span><span class="n">x32</span> <span class="n">allocated</span> <span class="n">area</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">30</span><span class="o">+</span><span class="mi">1</span> <span class="o">*/</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example custom.css to manage a toolbar icon with a non standard size</em></p>
<span class="target" id="ug-remove-icons"></span></div>
<div class="section" id="removing-unwanted-toolbar-icons">
<span id="index-171"></span><h4>Removing unwanted toolbar icons<a class="headerlink" href="#removing-unwanted-toolbar-icons" title="Permalink to this headline">¶</a></h4>
<p>This example uses the after_standardInit function to disable macro functions by removing the corresponding icons from the toolbar.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="n">Copyright</span> <span class="n">SysperTec</span> <span class="n">Communication</span> <span class="mi">2012</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>
<span class="o">*</span> <span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span> <span class="n">customer</span><span class="o">-</span><span class="n">specific</span> <span class="n">Javascript</span> <span class="n">functions</span>
<span class="o">*/</span>
<span class="n">function</span> <span class="n">after_standardInit</span><span class="p">()</span> <span class="p">{</span>
  <span class="o">/*</span> <span class="n">Remove</span> <span class="n">macro</span> <span class="n">buttons</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">toolbar</span> <span class="o">*/</span>
  <span class="n">removetoolbarbutton</span><span class="p">(</span><span class="s2">&quot;startrecording&quot;</span><span class="p">);</span>
  <span class="n">removetoolbarbutton</span><span class="p">(</span><span class="s2">&quot;playback&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example custom.js to remove selected toolbar icons</em></p>
<p>The names of the other toolbar icons which can be removed in this way are:-</p>
<ul class="simple">
<li>capture</li>
<li>disconnect</li>
<li>document-print-preview</li>
<li>edit-copy</li>
<li>edit-cut</li>
<li>edit-paste</li>
<li>emptybuf</li>
<li>file-rcv</li>
<li>file-send</li>
<li>help</li>
<li>keypad</li>
<li>playback</li>
<li>printer</li>
<li>settings</li>
<li>settingsV2</li>
<li>startrecording, playback, printer</li>
</ul>
<p>To hide the toolbar completely, see <a class="reference internal" href="#ug-hide-toolbar"><span class="std std-ref">“Hiding the toolbar”</span></a>.</p>
<p>To hide only the VIRTEL Application name, see <a class="reference internal" href="#ug-hide-information"><span class="std std-ref">“Showing / Hiding server informations”</span></a>.</p>
</div>
<div class="section" id="positioning-toolbar-icons">
<span id="index-172"></span><h4>Positioning Toolbar Icons<a class="headerlink" href="#positioning-toolbar-icons" title="Permalink to this headline">¶</a></h4>
<p>In certain circumstances, the default position of an icon may not be at the user’s convenience. Is possible to change an icon’s position based on the position of another icon.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="n">Customize</span> <span class="n">the</span> <span class="n">location</span> <span class="n">of</span> <span class="n">dynamic</span> <span class="n">toolbar</span> <span class="n">buttons</span><span class="o">.</span>
<span class="o">*</span> <span class="n">The</span> <span class="n">calls</span> <span class="n">to</span> <span class="n">this</span> <span class="n">function</span> <span class="n">are</span> <span class="n">ignored</span> <span class="n">when</span> <span class="n">they</span>
<span class="o">*</span> <span class="k">return</span> <span class="n">nothing</span><span class="p">,</span> <span class="ow">or</span> <span class="n">an</span> <span class="n">integer</span> <span class="ow">not</span> <span class="n">greater</span> <span class="n">than</span> <span class="mf">0.</span>
<span class="o">*</span>
<span class="o">*</span> <span class="n">Customizable</span> <span class="n">buttons</span> <span class="n">IDs</span> <span class="p">:</span>
<span class="o">*</span> <span class="o">&gt;</span> <span class="s1">&#39;3278T&#39;</span>
<span class="o">*</span> <span class="o">&gt;</span> <span class="s1">&#39;document-print-preview&#39;</span>
<span class="o">*</span> <span class="o">&gt;</span> <span class="s1">&#39;file-send&#39;</span>
<span class="o">*</span> <span class="o">&gt;</span> <span class="s1">&#39;file-recv&#39;</span>
<span class="o">*</span> <span class="o">&gt;</span> <span class="s1">&#39;printer&#39;</span>
<span class="o">*/</span>
<span class="n">function</span> <span class="n">customize_toolbarButtonIndex</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">id</span><span class="o">===</span><span class="s1">&#39;printer&#39;</span> <span class="o">||</span> <span class="nb">id</span><span class="o">===</span><span class="s1">&#39;document-print-preview&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="k">return</span> <span class="n">getToolbarButtonIndex</span><span class="p">(</span><span class="s1">&#39;disconnect&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example custom.js to select a position for printer icon</em></p>
</div>
<div class="section" id="modifying-the-text-of-the-status-bar">
<span id="index-173"></span><h4>Modifying the text of the status bar<a class="headerlink" href="#modifying-the-text-of-the-status-bar" title="Permalink to this headline">¶</a></h4>
<p>This example uses the after_responseHandle function to modify the text in the status bar at the bottom of the Web Access screen. This example displays the text “Your printer name is xxxx” in the status bar.
The status bar text is an object which can therefore be modified using an API.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="n">Copyright</span> <span class="n">SysperTec</span> <span class="n">Communication</span> <span class="mi">2012</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>
<span class="o">*</span> <span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span> <span class="n">customer</span><span class="o">-</span><span class="n">specific</span> <span class="n">Javascript</span> <span class="n">functions</span>
<span class="o">*/</span>
<span class="n">function</span> <span class="n">after_responseHandle</span><span class="p">(</span><span class="n">httpXmlObj</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">xmitTimestamp</span><span class="p">)</span> <span class="p">{</span>
<span class="n">vwaStatusBar</span><span class="o">.</span><span class="n">setRelay</span><span class="p">();</span> <span class="o">//</span> <span class="n">clears</span> <span class="n">relay</span> <span class="n">field</span>
<span class="n">vwaStatusBar</span><span class="o">.</span><span class="n">setPrintRelay</span><span class="p">(</span><span class="s2">&quot;Your printer name is: &quot;</span> <span class="o">+</span> <span class="n">vwaStatusBar</span><span class="o">.</span><span class="n">getPrintRelay</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example custom.js to modify the text of the status bar</em></p>
<p>With this method, an API is provided which allows code in custom.js to change some fields in the status bar without having to manipulate the DOM of the page. The “vwaStatusBar” object can be used to do this.</p>
<p>The editing functions are:-</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Function</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>vwaStatusBar.setRelay(txt)</td>
<td>Change the “Relay” field.</td>
</tr>
<tr class="row-odd"><td>vwaStatusBar.setPrintRelay(txt)</td>
<td>Change the “Printer relay” field.</td>
</tr>
<tr class="row-even"><td>vwaStatusBar.setStatus(txt)</td>
<td>Change the “Status” field.</td>
</tr>
<tr class="row-odd"><td>vwaStatusBar.setStatusClass(txt)</td>
<td>Allow to assign a specific CSS class to the “Status” field.</td>
</tr>
</tbody>
</table>
<p>If the parameter is empty or undefined, the corresponding field is not displayed. If the content is too long, it is truncated to the right.</p>
<p>The query functions are:-</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Function</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>vwaStatusBar.getCursCol()</td>
<td>Return the “x” position of the cursor.</td>
</tr>
<tr class="row-odd"><td>vwaStatusBar.getCursRow()</td>
<td>Return the “y” position of the cursor.</td>
</tr>
<tr class="row-even"><td>vwaStatusBar.getRelay(parameter)</td>
<td>Return the content of the “Relay” field.</td>
</tr>
<tr class="row-odd"><td>vwaStatusBar.getPrintRelay(parameter)</td>
<td>Return the content of the “Printer relay” field.</td>
</tr>
<tr class="row-even"><td>vwaStatusBar.getStatus()</td>
<td>Return the content of the “Status” field.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>For the “getRelay()” and “getPrinterRelay()” functions, an optional parameter may be specified.</li>
<li>When specified, valid values are “true” or “false” (without the quotes). When the parameter is ommited, or is not a valid value, the default “false” will be used.</li>
<li>When “setRelay(txt)” or “setPrinterRelay(txt)” is used the “txt” value overprints the field at the browser level before displaying to the end user. Behind this “overprinted value”, an initial value exists that has been placed by VIRTEL mainframe side before sending message to the browser. When using the “getRelay()” or “getPrinterRelay()” functions, you may want to retrieve the initial or overprinted value. When in “false” mode the function returns the initial value. When in “true” mode the function retruns the overprinted value.</li>
</ul>
</div>
</div>
<div class="section" id="custom-hotspot-recognition">
<span id="index-174"></span><h4>Custom hotspot recognition<a class="headerlink" href="#custom-hotspot-recognition" title="Permalink to this headline">¶</a></h4>
<p>This example uses the after_responseHandle function to modify the regular expression which is used to identify PF key hotspots.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>/*
* (c)Copyright SysperTec Communication 2012 All Rights Reserved
* VIRTEL Web Access customer-specific Javascript functions
*/
function after_responseHandle(httpXmlObj, url, xmitTimestamp) {
VIR3270.customPfKeysHotspotRegex =
/(P?F\d{1,2}|PA[1-3]|ENTER|CLEAR)((?:\/P?F\d{1,2})?\s*[=:-])/;
}
</pre></div>
</div>
<p><em>Example custom.js to modify PF key hotspot recognition</em></p>
</div>
<div class="section" id="adding-a-watermark-to-the-3270-screen">
<span id="index-175"></span><h4>Adding a watermark to the 3270 screen<a class="headerlink" href="#adding-a-watermark-to-the-3270-screen" title="Permalink to this headline">¶</a></h4>
<p>This example uses the after_standardInit function in conjunction with a custom stylesheet to add a watermark to the Web Access screen. The watermark displays the application name in light text behind the 3270 screen content. The application name is obtained from the class attribute of the body tag.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="n">Copyright</span> <span class="n">SysperTec</span> <span class="n">Communication</span> <span class="mi">2012</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>
<span class="o">*</span> <span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span> <span class="n">customer</span><span class="o">-</span><span class="n">specific</span> <span class="n">Javascript</span> <span class="n">functions</span>
<span class="o">*/</span>
<span class="n">function</span> <span class="n">after_standardInit</span><span class="p">()</span> <span class="p">{</span>
<span class="n">var</span> <span class="n">o</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
<span class="n">o</span><span class="o">.</span><span class="n">className</span> <span class="o">=</span> <span class="s2">&quot;watermark&quot;</span><span class="p">;</span>
<span class="n">o</span><span class="o">.</span><span class="n">innerHTML</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">className</span><span class="p">;</span>
<span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">o</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example custom.js to add a watermark to the Web Access 3270 screen</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="n">Copyright</span> <span class="n">SysperTec</span> <span class="n">Communication</span> <span class="mi">2012</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>
<span class="o">*</span> <span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span> <span class="n">style</span> <span class="n">sheet</span> <span class="k">for</span> <span class="n">site</span> <span class="n">customisation</span>
<span class="o">*/</span>
<span class="o">.</span><span class="n">watermark</span> <span class="p">{</span>
<span class="n">position</span><span class="p">:</span> <span class="n">absolute</span><span class="p">;</span>
<span class="n">pointer</span><span class="o">-</span><span class="n">events</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<span class="n">left</span><span class="p">:</span> <span class="mi">150</span><span class="n">px</span><span class="p">;</span>
<span class="n">top</span><span class="p">:</span> <span class="mi">100</span><span class="n">px</span><span class="p">;</span>
<span class="n">color</span><span class="p">:</span> <span class="n">gray</span><span class="p">;</span>
<span class="n">opacity</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">;</span>
<span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span> <span class="mi">10</span><span class="n">em</span><span class="p">;</span>
<span class="n">width</span><span class="p">:</span> <span class="mi">60</span><span class="o">%</span><span class="p">;</span>
<span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">center</span><span class="p">;</span>
<span class="n">z</span><span class="o">-</span><span class="n">index</span><span class="p">:</span> <span class="mi">1000</span><span class="p">;</span>
<span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">text</span><span class="o">-</span><span class="n">stroke</span><span class="p">:</span> <span class="mi">1</span><span class="n">px</span> <span class="c1">#FFF;</span>
<span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">text</span><span class="o">-</span><span class="n">fill</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="n">transparent</span><span class="p">;</span>
<span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">transform</span><span class="p">:</span> <span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="n">deg</span><span class="p">);</span>
<span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="n">transform</span><span class="p">:</span> <span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="mi">40</span><span class="n">deg</span><span class="p">);</span>
<span class="nb">filter</span><span class="p">:</span> <span class="n">alpha</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span> <span class="n">progid</span><span class="p">:</span><span class="n">DXImageTransform</span><span class="o">.</span><span class="n">Microsoft</span><span class="o">.</span><span class="n">Matrix</span><span class="p">(</span><span class="n">M11</span><span class="o">=</span><span class="mf">0.819</span><span class="p">,</span> <span class="n">M12</span><span class="o">=</span><span class="mf">0.574</span><span class="p">,</span> <span class="n">M21</span><span class="o">=-</span><span class="mf">0.574</span><span class="p">,</span> <span class="n">M22</span><span class="o">=</span><span class="mf">0.819</span><span class="p">,</span> <span class="p">}</span>
</pre></div>
</div>
<p><em>Example custom.css to define the style of the watermark</em></p>
<p><img alt="image46" src="../../../_images/image466.png" />
<em>Web Access screen with application name as watermark</em></p>
</div>
<div class="section" id="modifying-web-access-settings">
<span id="index-176"></span><h4>Modifying Web Access Settings<a class="headerlink" href="#modifying-web-access-settings" title="Permalink to this headline">¶</a></h4>
<p>The exit modify_settingsValues allows the administrator to modify or replace the list of values allowed for specific parameters in the VIRTEL Web Access Settings menu.
The example shown below replaces the list of fonts, and adds two extra values “20” and “24” to the list of font sizes:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="n">Copyright</span> <span class="n">SysperTec</span> <span class="n">Communication</span> <span class="mi">2012</span> <span class="n">All</span> <span class="n">Rights</span> <span class="n">Reserved</span>
<span class="o">*</span> <span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span> <span class="n">customer</span><span class="o">-</span><span class="n">specific</span> <span class="n">Javascript</span> <span class="n">functions</span>
<span class="o">*/</span>
<span class="n">function</span> <span class="n">modify_settingsValues</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="p">{</span>
<span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;font&quot;</span><span class="p">)</span>
<span class="k">return</span> <span class="p">[</span><span class="s2">&quot;Courier New&quot;</span><span class="p">,</span> <span class="s2">&quot;Lucida Console&quot;</span><span class="p">,</span> <span class="s2">&quot;Consolas&quot;</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;fontsize&quot;</span><span class="p">)</span>
<span class="k">return</span> <span class="n">values</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="s2">&quot;20&quot;</span><span class="p">,</span> <span class="s2">&quot;24&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example custom.js to modify Settings values</em></p>
</div>
</div>
<div class="section" id="site-customization-the-help-page">
<span id="index-177"></span><h3>Site Customization - The Help Page<a class="headerlink" href="#site-customization-the-help-page" title="Permalink to this headline">¶</a></h3>
<p>Users can obtain help on VIRTEL Web Access functions by clicking the help icon in the Web Access toolbar:</p>
<p><img alt="image47" src="../../../_images/image476.png" /></p>
<p>which causes the browser to display the page /w2h/custom-help/help.html delivered as standard with VIRTEL Web Access.
The administrator can create a custom version of the help.html page and upload it to a VIRTEL directory destined for
site-specific pages, such as CLI-DIR.</p>
<div class="section" id="standard-help-page">
<span id="index-178"></span><h4>Standard Help Page<a class="headerlink" href="#standard-help-page" title="Permalink to this headline">¶</a></h4>
<p>The standard help.html page is shown below:</p>
<p><img alt="image48" src="../../../_images/image482.jpeg" />
<em>Standard Virtel help page for Web Access</em></p>
</div>
<div class="section" id="installing-a-custom-help-page">
<span id="index-179"></span><h4>Installing a Custom Help Page<a class="headerlink" href="#installing-a-custom-help-page" title="Permalink to this headline">¶</a></h4>
<p>To install a customized help.html page, the administrator must perform the following operations:-</p>
<ul class="simple">
<li>Upload the customized help.html file into a VIRTEL directory such as CLI-DIR</li>
<li>Modify the VIRTEL transactions CLI-03CH so that it points to the CLI-DIR directory (instead of W2H-DIR as initially installed), then press F1-F3-F3-F1 to update the transaction and the CLIWHOST entry point. Perform the same operation on transaction W2H-03CH and entry point WEB2HOST.</li>
</ul>
</div>
</div>
<div class="section" id="enable-copy-cut-and-paste">
<span id="index-180"></span><h3>Enable Copy, Cut And Paste<a class="headerlink" href="#enable-copy-cut-and-paste" title="Permalink to this headline">¶</a></h3>
<p>Copy, cut or paste operation are done using standard function key combinations CTRL + C, CTRL + X or CTRL + V or using a pop-up menu when using the right mouse button. These operations often require access to the clipboard, which, depending on the browser used, may require the installation of an additional module.</p>
<div class="section" id="internet-explorer">
<span id="index-181"></span><h4>Internet Explorer<a class="headerlink" href="#internet-explorer" title="Permalink to this headline">¶</a></h4>
<p>For Internet Explorer, the usage of the clipboard is systematic for copy / cut / paste operation and does not require any additional module. From IE9 and above, depending on the value of “Tools | Internet options | Security tab | Custom level | Scroll to, Drag and drop or cut and paste files” you will be authorized - or not - to access the clipboard. If prompted, during the first attempt to use copy / cut / paste function the browser will display a window requesting confirmation to access the clipboard. Once the decision is communicated, it remains valid until closing the window with the domain.</p>
</div>
<div class="section" id="firefox">
<span id="index-182"></span><h4>Firefox<a class="headerlink" href="#firefox" title="Permalink to this headline">¶</a></h4>
<p>An ADDON is required to perform any copy / cut / paste operation with another application or with another internet
domain. The ADDON is available for download at the following address:</p>
<p><a class="reference external" href="https://addons.mozilla.org/fr/firefox/addon/virtel-webaccess-add-on/">https://addons.mozilla.org/fr/firefox/addon/virtel-webaccess-add-on/</a></p>
<p>If the browser version is compatible with the latest version of ADDON published click the “+ Add to Firefox” icon. Any
additional window will open to confirm the installation.</p>
<p><img alt="image49" src="../../../_images/image492.jpeg" /></p>
<p>If the browser version is too old to be supported by the latest version of ADDON published, the link “+ Add to Firefox”
will not be available. Click on the link “View full history version” at the bottom of the page as shown below.</p>
<p><img alt="image50" src="../../../_images/image502.jpeg" /></p>
<p>On the next page, select the ADDON version of the most compatible version available for the browser in use. Click “+
Add to Firefox”. Several versions of the ADDON can be installed in parallel, however, only one must be active at any
given time.</p>
<div class="section" id="additional-installation-requirements">
<h5>Additional Installation requirements<a class="headerlink" href="#additional-installation-requirements" title="Permalink to this headline">¶</a></h5>
<p>Once the additional module has been installed, it will be necessary to specify the permissions.</p>
<p>On the toolbar, click on the “Menu” in the upper right (1) icon, then click on “Modules” (2). If this section does not
appear directly in the tool window, click on “Customise” (3) tool to add “Modules” in the menu. It is also possible to
directly access the extension manager by typing “about: addons” in the URL bar of the browser.</p>
<p><img alt="image52" src="../../../_images/image5211.png" /></p>
<p>On the ADDONS page, select “Extension” to display the VIRTEL extension. Click on the “Options” button to display a
setup screen similar to the one shown below.</p>
<p><img alt="image53" src="../../../_images/image532.jpeg" /></p>
<p><img alt="image54" src="../../../_images/image542.jpeg" /></p>
<p>The following options should be set</p>
<dl class="docutils">
<dt>Automatic update</dt>
<dd><ul class="first last simple">
<li>by default</li>
<li>enabled</li>
<li>off</li>
</ul>
</dd>
<dt>Authorized domains:</dt>
<dd>Contains a list of domains for which permission to access the clipboard is granted. Each domain is separated from the next with a comma. The * indicates that all values are valid for the corresponding criteria. All definitions should end with an asterisk character, for example, “<a class="reference external" href="http://www.mydomain.com/">http://www.mydomain.com/</a>” is not a valid definition because it does not end with *.</dd>
</dl>
<p>Example of definitions:-</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.mydomain.com/*">http://www.mydomain.com/*</a> allow access to the clipboard for the domain. Typing  <a class="reference external" href="http://www.mydomain.com:8080/">http://www.mydomain.com:8080/</a> will be denied access, the presence of a port number in the URL does not match the rule.</li>
<li><a class="reference external" href="http://192.168.92.161:41001/*">http://192.168.92.161:41001/*</a> allows URLs communicating on the 41001 port access to the clipboard for specified IP address. URLs using another port will be denied access.</li>
<li><a class="reference external" href="http://192.168.92.161:*">http://192.168.92.161:*</a> allows URL communicating on any port to access the clipboard for specified IP address.</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All entries must ends with a wildchar (*) character. Only one wildchar character is allowed for each entry.</p>
</div>
<dl class="docutils">
<dt>Show notifications:</dt>
<dd>Display a POP_UP window in the bottom right of the screen summarizing the result of last copy / paste operation.</dd>
<dt>Refresh preferences:</dt>
<dd>Saves the last configuration changes.</dd>
</dl>
</div>
</div>
<div class="section" id="chrome">
<span id="index-183"></span><h4>Chrome<a class="headerlink" href="#chrome" title="Permalink to this headline">¶</a></h4>
<p>An extension is required for any copy / cut / paste operation with another application or with another internet
domain. The extension can be obtained on the Chrome WebStore at the following address:-</p>
<p><a class="reference external" href="https://chrome.google.com/webstore/category/apps?hl=en-GB">https://chrome.google.com/webstore/category/apps?hl=en-GB</a></p>
<p>Enter “Virtel Extender WebAccess” in the search field and launch the search. The extension appears in the “Extensions” list.</p>
<p><img alt="image51" src="../../../_images/image513.jpeg" /></p>
<p>Click on the extension item and then, on the next page, click “Add to Chrome”.</p>
<div class="section" id="id6">
<h5>Additional installation requirements<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<p>Once the extension has been installed, it will be necessary to specify the permissions.</p>
<p>Go to the Chrome extension manager by typing “chrome://extensions” in the URL bar of the browser. From the extensions page, Locate the VIRTEL extension. Verify that the extension is activated and then click on the “Options” link.</p>
<p><img alt="image56" src="../../../_images/image564.png" /></p>
<p>The following options should be set:</p>
<p><img alt="image57" src="../../../_images/image574.png" /></p>
<p>To view the log screen select “See Logs” from the Virtel Extension Options. The following log screen will be displayed.</p>
<p><img alt="image58" src="../../../_images/image586.png" /></p>
<dl class="docutils">
<dt>Allow copy / paste operation:</dt>
<dd><p class="first">Allows operations copy / cut / paste on the domains specified in the definitions parameter.</p>
<dl class="last docutils">
<dt>For all domains:</dt>
<dd>All domains are open for any copy / cut / paste operations.</dd>
<dt>For these domains only:</dt>
<dd>Only the domains defined in a list are allowed. When multiple domains are required, the list must be defined with one line per domain reference.</dd>
<dt>Example of definitions:</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="http://www.mydomain.com/*">http://www.mydomain.com/*</a> allow access to the clipboard for the domain. Typing <a class="reference external" href="http://www.mydomain.com:8080/">http://www.mydomain.com:8080/</a> will be denied access, the presence of a port number in the URL does not match the rule.</li>
<li><a class="reference external" href="http://192.168.92.161:41001/*">http://192.168.92.161:41001/*</a> allows URLs communicating on the 41001 port access to the clipboard for specified IP address. URLs using another port will be denied access.</li>
<li><a class="reference external" href="http://192.168.92.161">http://192.168.92.161</a>:<em>/</em> allows URL communicating on any port to access the clipboard for specified IP address.</li>
</ul>
</dd>
</dl>
</dd>
</dl>
<p><strong>IFrame support:</strong></p>
<p>Allows operation of copy / cut / paste operation when VIRTEL Web Access window is encapsulated in an IFrame.This
information is supplemented by a list of areas on which these operations are allowed. This list may be identical to
that defined in the previous section and, if required, may contain additional restrictions through a restrictive list.
When a restrictive list is specified, the relevant fields should appear in the previous list.</p>
<p><strong>Logging:</strong></p>
<p>Whenever a copy / cut / paste operation is attempted the domain involved can be saved to a list. This list is presented in the following form:
By default the system registers a historical log all operations. It is possible to restrict registration to only rejected
requests by checking the “Record only the gold failes Rejected requests” box. Managing the number of log entries
and setting a retention time is configurable via “Maximum entries in history” and “Delete history entries after”
settings.</p>
</div>
</div>
<div class="section" id="manage-the-settings-on-host-with-chrome">
<span id="index-184"></span><h4>Manage the settings on Host with chrome<a class="headerlink" href="#manage-the-settings-on-host-with-chrome" title="Permalink to this headline">¶</a></h4>
<p>Under certain conditions, it is possible to manage domain authorizations centrally by storing on the extension parameters on the host. Usually these parameters are managed by the user as described in the previous paragraph. The implementation of this method of extension management requires:</p>
<ul class="simple">
<li>Virtel version V4.56 or later</li>
<li>Presence of Update # 5503 or later</li>
<li>Use of the Virtel Chrome Extension Version 40.0 or later</li>
</ul>
<p>To enable host management the “waaoAddOnHost” parameter must be set to “true” in the w2hparm.js file. If the “waaoAddOnHost” parameter is not present or set to anything other than true, the domain management of the permissions remains under control of the end user.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span> <span class="n">var</span> <span class="n">w2hparm</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">&quot;waaoAddOnHost&quot;</span><span class="p">:</span><span class="n">true</span>
<span class="p">};</span>
</pre></div>
</div>
<p><em>Set the waaoAddOnHost parameter to ‘true’ to manage Copy / Cut / Paste authorization from the Host.</em></p>
<p>In addition to the parameter ‘waaoAddOnHost’ being set to “true”, a Javascript file named “waao-setting.js” maintains a list of parameters and permissions. This Javascript file must be uploaded into a directory that should then be referenced in the Virtel Entry Point by the transaction with an external name of “option” (lowercase).</p>
<p><img alt="image55" src="../../../_images/image554.png" /></p>
<p>The ‘option’ transactions can be installed using the ARBOLOAD member in the CNTL library, setting the parameter OPTION=YES. This will install the transactions CLI-03CO and W2H-03CO, setting the ‘option’ directory to point to the CLI-DIR through the internal pathname /option/.</p>
<p>An example of the waao-setting.js follows:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>function getDefaults() {
    /*
    * This object contains the default settings for the Chrome Add-on options panel.
    *
    * If the add-on has no options saved (or if these default are enforced using &#39;settings_* then these values are used as the add-on configuration.
    */
    return {
    /*
    * Allow the user to change these extension settings using the options page?
    * When false, the user can still see the options, but is cannot change them.
    *
    * Valid values : {true,false}
    */
    settings_locked : true,
    /*
    * Default options for the &quot;Copy/Paste Settings&quot; section of the options page
    */
    system_copy_paste: {
        /*
        * Allow copy/paste operations in system clipboard?
        * Setting this to false will also disable copy/paste operations across iframes (&#39;iframes_*
        * Valid values : {true,false}
        */
        allow : true,
        from_all_domains : false,
        allowed_domains :
        [
        // &#39;https://*&#39;,
        &#39;http://192.168.170.46:41333/*&#39;
        ]
        },
        /*
        * Default options for the &quot;IFrames Support&quot; section of the options page
        */
        iframes_copy_paste: {
        allow : true,
        from_system_domains : false,
        allowed_domains :
        [
        // &#39;https://*&#39;,
        // &#39;http://*&#39;,
        ]
    },
    /*
    * Default options for the &quot;Logging&quot; section of the options page
    */
    logs: {
        /*
        * Enable logging of the copy/paste operations?
        *
        * Valid values : {true,false}
        */
        allow : true,
        /*
        * Only record the copy/paste operations that failed or were rejected?
        *
        * Valid values : {true,false}
        */
        only_failures: false,
        /*
        * Limit the maximum number of entries to keep in the history log?
        * Please note that the log is only cleaned when a new entry is recorded.
        *
        * Valid values : {true,false}
        */
        do_limit_count: true,
        /*
        * Maximum number of entries to keep in the history log.
        * When recording a new entry in the log, the oldest entry is discarded if this limit *
        * Only meaningful if &#39;logs.do_limit_count&#39; is true (not used otherwise).
        *
        * Valid values : any integer greater or equal than 1.
        */
        limit_count: 25,
        /*
        * Limit the number of days that entries should be kept in the history log?
        * Please note that the log is only cleaned when a new entry is recorded.
        *
        * Valid values : {true,false}
        */
        do_limit_days: false,
        /*
        * Maximum number of days that entries will be kept in the history log.
        * When recording a new entry in the log, any entry older than this threshold will be *
        * Only meaningful if &#39;logs.do_limit_days&#39; is true (not used otherwise).
        *
        * Valid values : any integer greater or equal than 1.
        */
        limit_days: 7
        },
    };
}
</pre></div>
</div>
</div>
<div class="section" id="using-extensions">
<h4>Using Extensions<a class="headerlink" href="#using-extensions" title="Permalink to this headline">¶</a></h4>
<p>Use the right mouse button to open a selection menu for copy / cut / paste operations. The operational status of this feature is displayed in an ICON in top right.</p>
<p><a class="reference internal" href="../../../_images/image596.png"><img alt="image59" src="../../../_images/image596.png" style="width: 1.95686in; height: 1.92531in;" /></a>
<a class="reference internal" href="../../../_images/image59a.png"><img alt="image59a" src="../../../_images/image59a.png" style="width: 1.95686in; height: 1.92531in;" /></a></p>
<p><em>Green</em>: Indicates that the module is properly installed and that the URL is allowed. A leading “H” indicates that the settings are being controlled by the host.(Chrome only)*</p>
<p><a class="reference internal" href="../../../_images/image605.png"><img alt="image60" src="../../../_images/image605.png" style="width: 1.95686in; height: 1.93583in;" /></a></p>
<p><em>Orange</em>: Indicates that the module is installed correctly but the URL is not defined as an authorized domain. A leading “H” indicates that the settings are managed by the host.(Chrome only)*</p>
<p><a class="reference internal" href="../../../_images/image6115.png"><img alt="image61" src="../../../_images/image6115.png" style="width: 1.96740in; height: 1.94635in;" /></a></p>
<p><em>Red</em>:
- For Chrome, the expansion module is not installed or for Host maintained environments, the waao-setting.js has not be located (Chrome only).</p>
<blockquote>
<div><p>Host related problems could be that:-</p>
<blockquote>
<div><ul class="simple">
<li>The Virtel Entry Point does not include the ‘option’ transaction.</li>
<li>The “waao-setting.js” cannot be found in the directory defined in the ‘option’ transaction. In this case an error message will be displayed in the Virtel log.</li>
<li>The “waao-setting.js is invalid or corrupt. In this case an error message will be displayed in the Virtel log.</li>
</ul>
</div></blockquote>
</div></blockquote>
<ul class="simple">
<li>For Firefox, it may indicate that the field is not allowed, or that the navigation is done in private mode. If running in private mode, the function is supported from version 0.6.33.1 and above.*</li>
</ul>
</div>
<div class="section" id="edge">
<span id="index-185"></span><h4>Edge<a class="headerlink" href="#edge" title="Permalink to this headline">¶</a></h4>
<p>Virtel uses the browsers Clipboard API to support Copy, Cut and Paste operations.</p>
</div>
</div>
<div class="section" id="virtel-customization-modes">
<span id="ug-customizing-with-option"></span><span id="index-186"></span><h3>Virtel Customization Modes<a class="headerlink" href="#virtel-customization-modes" title="Permalink to this headline">¶</a></h3>
<p id="index-187">Virtel V4.56 introduces some enhancements to customisation. From Virtel 4.56 onwards, customization is now possible at a global level, effecting all transactions for an entry point, or at a transaction level, effecting only specific transactions. Previous customisation was only at the entry point level. The two customization modes are known as “Compatibility” mode and “Option” mode. As delivered, Virtel V4.56 defaults to having no customization mode active. This means neither “compatibility” mode or “option” mode. To turn one on these modes on the following actions must be performed.</p>
<div class="section" id="compatibility-mode">
<span id="ug-compatibility-mode"></span><h4>Compatibility Mode<a class="headerlink" href="#compatibility-mode" title="Permalink to this headline">¶</a></h4>
<p>To maintain compatibility with older releases of Virtel, the original customisation design continues to be supported as “compatibility” mode. This mode can be activated performing the following actions</p>
<ul class="simple">
<li>Included the following statement in the TCT:-</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">HTSETn</span><span class="o">=</span><span class="p">(</span><span class="n">OPTION</span><span class="o">-</span><span class="n">DEFAULT</span><span class="o">-</span><span class="n">COMPATIBILITY</span><span class="p">)</span> <span class="n">where</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="n">_4</span><span class="o">.</span>
</pre></div>
</div>
<ul class="simple">
<li>Modify the elements (w2hparm.js, custom.css, custom.js etc.) and upload to the relevant directory. This would normally be CLI-DIR</li>
<li>Update the relevant transactions to point to the CLI-DIR for the elements you wish to customize or modify. The transactions are:-</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">XXX</span><span class="o">-</span><span class="mi">03</span><span class="n">Cz</span>   <span class="n">where</span> <span class="n">XXX</span> <span class="o">=</span> <span class="n">W2H</span> <span class="p">(</span><span class="n">WEB2HOST</span> <span class="n">Entry</span> <span class="n">Point</span><span class="p">)</span> <span class="ow">or</span> <span class="n">CLI</span> <span class="p">(</span><span class="n">CLIWHOST</span> <span class="n">Entry</span> <span class="n">Point</span><span class="p">)</span><span class="o">.</span>
                   <span class="n">z</span> <span class="o">=</span> <span class="n">C</span> <span class="k">for</span> <span class="n">custom</span><span class="o">.</span><span class="n">css</span><span class="p">,</span> <span class="n">H</span> <span class="k">for</span> <span class="n">help</span><span class="o">.</span><span class="n">html</span> <span class="ow">and</span> <span class="n">J</span> <span class="k">for</span> <span class="n">custom</span><span class="o">.</span><span class="n">js</span>

<span class="n">XXX</span><span class="o">-</span><span class="mi">03</span><span class="n">P</span>    <span class="n">where</span> <span class="n">XXX</span> <span class="o">=</span> <span class="n">W2H</span> <span class="p">(</span><span class="n">WEB2HOST</span> <span class="n">Entry</span> <span class="n">Point</span><span class="p">)</span> <span class="ow">or</span> <span class="n">CLI</span> <span class="p">(</span><span class="n">CLIWHOST</span> <span class="n">Entry</span> <span class="n">Point</span><span class="p">)</span><span class="o">.</span>
                   <span class="n">This</span> <span class="n">transaction</span> <span class="n">provides</span> <span class="n">the</span> <span class="n">directory</span> <span class="k">for</span> <span class="n">a</span> <span class="n">modified</span> <span class="n">w2hparm</span><span class="o">.</span><span class="n">js</span>
</pre></div>
</div>
<p>By default, the applications associated with these transactions are set to “W2H-DIR”. See job SAMPLIB(CUSTCSS). Run this job after changing the directory(APPL=) from W2H-DIR to CLI-DIR.</p>
<p>As an example, if the w2hparm option “Enter=Enter” is required rather than the default “Enter=Newline” and a modified toolbar is also required for transactions running under the CLIWHOST entry point then the following transactions would be changed:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CLI</span><span class="o">-</span><span class="mi">03</span><span class="n">P</span>         <span class="n">Appl</span><span class="o">.</span> <span class="o">=</span> <span class="n">CLI</span><span class="o">-</span><span class="n">DIR</span>   <span class="n">Default</span> <span class="o">=</span> <span class="n">W2H</span><span class="o">-</span><span class="n">DIR</span><span class="o">.</span> <span class="n">w2hparm</span><span class="o">.</span><span class="n">js</span> <span class="k">for</span> <span class="n">CLI</span> <span class="n">transactions</span>
<span class="n">CLI</span><span class="o">-</span><span class="mi">03</span><span class="n">CJ</span>        <span class="n">Appl</span><span class="o">.</span> <span class="o">=</span> <span class="n">CLI</span><span class="o">-</span><span class="n">DIR</span>   <span class="n">Default</span> <span class="o">=</span> <span class="n">W2H</span><span class="o">-</span><span class="n">DIR</span><span class="o">.</span> <span class="n">Custom</span><span class="o">.</span><span class="n">js</span> <span class="k">for</span> <span class="n">CLI</span> <span class="n">transactions</span>
</pre></div>
</div>
<ul class="simple">
<li>w2hparm.js would be modified and uploaded to CLI-DIR.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">w2hparm</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;enter&quot;</span><span class="p">:</span><span class="s2">&quot;ENTER&quot;</span>
<span class="p">};</span>
</pre></div>
</div>
<ul class="simple">
<li>Custom.js would be modified to support the tool bar change and uploaded to CLI-DIR.</li>
</ul>
<p>The transaction W2H-03CJ is left pointing to W2H-DIR meaning that applications under the WEB2HOST entry point would have the default tool bar.</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">Updating elements in the default W2H-DIR directory is not recommended as they will be overwritten by maintenance or Virtel release updates. Keep customized elements in the CLI-DIR directory.</p>
</div>
</div>
<div class="section" id="option-mode">
<h4>Option mode<a class="headerlink" href="#option-mode" title="Permalink to this headline">¶</a></h4>
<p>This Option mode uses the /option/ pathname to locate a directory where all the relevant customisation elements reside. The recommended directory is CLI-DIR. To use this mode the w2hparm.js file must include the “global-settings” attribute. The following is an example:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">w2hparm</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;enter&quot;</span><span class="p">:</span><span class="s2">&quot;ENTER&quot;</span><span class="p">,</span>
    <span class="s2">&quot;global-settings&quot;</span><span class="p">:{</span>
        <span class="s2">&quot;pathToJsCustom&quot;</span><span class="p">:</span><span class="s2">&quot;../option/custJS.global.js&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pathToCssCustom&quot;</span><span class="p">:</span> <span class="s2">&quot;../option/custCSS.global.css&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pathToHelp&quot;</span><span class="p">:</span> <span class="s2">&quot;../option/myHelp.html&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This attribute defines the “global” customised names using the following pattern:- key.id.type where:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">key</span>     <span class="o">=</span> <span class="n">one</span> <span class="n">of</span> <span class="n">the</span> <span class="n">supported</span> <span class="n">key</span> <span class="n">values</span> <span class="n">prefixed</span> <span class="k">with</span> <span class="n">the</span> <span class="n">string</span> <span class="s2">&quot;pathTo&quot;</span>
<span class="nb">id</span>      <span class="o">=</span> <span class="k">global</span> <span class="ow">or</span> <span class="n">an</span> <span class="n">option</span> <span class="n">identifier</span>
<span class="nb">type</span>    <span class="o">=</span> <span class="n">css</span><span class="p">,</span> <span class="n">html</span> <span class="ow">or</span> <span class="n">js</span> <span class="p">(</span><span class="n">The</span> <span class="n">customized</span> <span class="nb">type</span><span class="p">)</span>
</pre></div>
</div>
<p>The supported “pathToxxxxx” keys are used to select the file where the customised elements should be located. Note the customized elements are located through the /option/ pathname. Customized elements currently supported are:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pathToCssCustom</span>     <span class="n">Custom</span> <span class="n">CSS</span> <span class="n">files</span><span class="o">.</span>
<span class="n">pathToJSCustom</span>      <span class="n">Custom</span> <span class="n">Javascript</span> <span class="n">files</span>
<span class="n">pathToW2hparm</span>       <span class="n">Custom</span> <span class="n">w2hparm</span> <span class="n">parameters</span>
<span class="n">pathToPrintCss</span>      <span class="n">Custom</span> <span class="nb">print</span> <span class="n">style</span> <span class="n">CSS</span>
<span class="n">pathToHelp</span>          <span class="n">Custom</span> <span class="n">Help</span> <span class="n">pages</span>
</pre></div>
</div>
<p>To activate the “option” mode perform the following actions:-</p>
<ul class="simple">
<li>Update the W2hparm.js to include the global-settings option. Include the relevant keynames within the global option settings you wish to modify.</li>
<li>Update the XXX-03P transactions to point to the CLI-DIR. The modified w2hparm.js will now be loaded from CLI-DIR and not the default W2H-DIR.</li>
<li>Upload the modified w2hparm.js to the CLI-DIR directory.</li>
<li>Run the supplied ARBOLOAD job in the CNTL library with OPTION=YES set. This will add two new transactions to the W2H and CLI entries to define the /option pathname.</li>
<li>Create the customized files (Javascript, CSS, help, parm) and upload them to the CLI directory.</li>
</ul>
</div>
<div class="section" id="default-mode">
<h4>Default mode<a class="headerlink" href="#default-mode" title="Permalink to this headline">¶</a></h4>
<p>As delivered, the default mode level is used. This means all web elements are obtained or located within the supplied W2H-DIR using the default settings.</p>
</div>
<div class="section" id="global-level-modifications-all-transactions-under-an-entry-point">
<span id="index-188"></span><h4>Global level modifications (All transactions under an Entry Point)<a class="headerlink" href="#global-level-modifications-all-transactions-under-an-entry-point" title="Permalink to this headline">¶</a></h4>
<p>For example, to support a global modified w2hparm and a modified toolbar for transactions running under the CLIWHOST entry point the following actions would be required.</p>
<p>For the “Enter” key requirment, update the default w2hparm.js to include a global setting for pathToW2hparm. The w2hparm.js should be uploaded to the CLI-DIR directory or another directory other than W2H-DIR. The transaction CLI-03P application field will also have to be updated to point to the correct directory for the modified w2hparm.js. Normally CLI-DIR:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">w2hparm</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;global-settings&quot;</span><span class="p">:{</span>
         <span class="s2">&quot;pathToW2hparm&quot;</span><span class="p">:</span><span class="s2">&quot;../option/w2hparm.global.js&quot;</span><span class="p">,</span>
         <span class="s2">&quot;pathToJSCustom&quot;</span><span class="p">:</span><span class="s2">&quot;../option/custJS.global.js&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Create the file w2hparm.global.js file and define the required changes. Upload this file to CLI-DIR. For example to modify the keyboard Enter key:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="o">//</span><span class="n">CLI</span><span class="o">-</span><span class="n">DIR</span> <span class="o">-</span> <span class="n">w2hparm</span><span class="o">.</span><span class="k">global</span><span class="o">.</span><span class="n">js</span>
    <span class="o">/*</span>
     <span class="o">*</span> <span class="n">Override</span> <span class="n">default</span> <span class="n">w2hparm</span> <span class="n">values</span><span class="o">.</span> <span class="n">Change</span> <span class="n">Enter</span> <span class="n">key</span> <span class="n">to</span> <span class="n">equal</span> <span class="s2">&quot;Enter&quot;</span><span class="o">.</span> <span class="n">Default</span> <span class="o">=</span> <span class="s2">&quot;Newline&quot;</span> <span class="n">key</span><span class="o">.</span>
    <span class="o">*/</span>

<span class="n">w2hparm</span><span class="o">.</span><span class="n">enter</span><span class="o">=</span><span class="s2">&quot;Enter&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Create the file custJS.global.js file and define the required changes. Upload this file to CLI-DIR. For example to modify the toolbar:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">CLI</span><span class="o">-</span><span class="n">DIR</span> <span class="o">-</span> <span class="n">custJS</span><span class="o">.</span><span class="n">myOptions</span><span class="o">.</span><span class="n">js</span>
<span class="o">//</span><span class="n">Add</span> <span class="n">Print</span> <span class="n">Button</span> <span class="n">To</span> <span class="n">Toolbar</span>
<span class="n">function</span> <span class="n">after_standardInit</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">addtoolbarbutton</span><span class="p">(</span><span class="mi">000</span><span class="p">,</span><span class="s2">&quot;../print.ico&quot;</span><span class="p">,</span><span class="s2">&quot;Print Screen&quot;</span><span class="p">,</span><span class="n">do_print</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The print.ico should also be uploaded to the CLI-DIR directory.</p>
</div>
<p>This has the effect of changing the tool bar for all transactions which is not what is required. The transactions under WEB2HOST will require there option field to be set to “compatibility” to ensure that the default toolbar is shown.</p>
<p><img alt="image98" src="../../../_images/image981.png" /></p>
</div>
<div class="section" id="transaction-level-modifications-individual-transactions">
<span id="index-189"></span><h4>Transaction level modifications (Individual transactions)<a class="headerlink" href="#transaction-level-modifications-individual-transactions" title="Permalink to this headline">¶</a></h4>
<p>If only certain transactions should have the modified tool bar then set a unique option identifier for those transactions. The “option” identifier will be used to associate customized elements against specific transaction(s). In this example the value “myOptions” has been chosen as an identifier. A transaction level “core option file”, using the format “option.identifier.js”, will be used to locate customized elements. Using the option identifier “myOptions” the file will be called option.myOptions.js. It should be created and uploaded to CLI-DIR. The customized settings are held in a Javascript variable named oCustom.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">CLI</span><span class="o">-</span><span class="n">DIR</span> <span class="o">-</span> <span class="n">option</span><span class="o">.</span><span class="n">myOptions</span><span class="o">.</span><span class="n">js</span><span class="o">.</span> <span class="n">Transaction</span> <span class="n">level</span> <span class="n">core</span> <span class="n">option</span> <span class="n">file</span>
<span class="n">var</span> <span class="n">oCustom</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;pathToJsCustom&quot;</span><span class="p">:</span><span class="s2">&quot;../option/custJS.myOptions.js&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A file called custJS.myOptions.js is created which will contain the toolbar modification code:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">CLI</span><span class="o">-</span><span class="n">DIR</span> <span class="o">-</span> <span class="n">custJS</span><span class="o">.</span><span class="n">myOptions</span><span class="o">.</span><span class="n">js</span>
<span class="o">//</span><span class="n">Add</span> <span class="n">Print</span> <span class="n">Button</span> <span class="n">To</span> <span class="n">Toolbar</span>
<span class="n">function</span> <span class="n">after_standardInit</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">addtoolbarbutton</span><span class="p">(</span><span class="mi">000</span><span class="p">,</span><span class="s2">&quot;../print.ico&quot;</span><span class="p">,</span><span class="s2">&quot;Print Screen&quot;</span><span class="p">,</span><span class="n">do_print</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Using “option” mode In the above examples all transactions will be subjected to parm changes defined in the file w2hparm.global.js. Transactions which have the option id set to “myOptions” will have any customized changes located through the core option file “option.myOption.js”. These will override any “global” settings. The following files are created and copied to CLI-DIR:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">option</span><span class="o">.</span><span class="n">myOptions</span><span class="o">.</span><span class="n">js</span>  <span class="o">-</span> <span class="n">core</span> <span class="n">option</span> <span class="n">file</span> <span class="k">for</span> <span class="n">identifier</span> <span class="s2">&quot;myOptions&quot;</span>
<span class="n">custjJS</span><span class="o">.</span><span class="n">myOptions</span><span class="o">.</span><span class="n">js</span> <span class="o">-</span> <span class="n">customized</span> <span class="n">java</span> <span class="n">script</span> <span class="n">file</span> <span class="k">for</span> <span class="s2">&quot;myOptions&quot;</span><span class="o">.</span>
<span class="n">w2hparm</span><span class="o">.</span><span class="n">js</span>           <span class="o">-</span> <span class="n">contains</span> <span class="s2">&quot;global-settings&quot;</span> <span class="n">attribute</span><span class="o">.</span>
<span class="n">w2hparm</span><span class="o">.</span><span class="k">global</span><span class="o">.</span><span class="n">js</span>    <span class="o">-</span> <span class="k">global</span> <span class="n">settings</span>
</pre></div>
</div>
<p>Files defined in the core option files “option.id.js” with the keys pathTo[key] are copied to the CLI-DIR. They will be located through the /option/ pathname. The values associated the the keys pathTo[key] can be any file name and not necessarily the names used in the examples. The /option/ path is always required. For example:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">CLI</span><span class="o">-</span><span class="n">DIR</span> <span class="o">-</span> <span class="n">option</span><span class="o">.</span><span class="n">myTest</span><span class="o">.</span><span class="n">js</span><span class="o">.</span> <span class="n">Transaction</span> <span class="n">level</span> <span class="n">option</span> <span class="n">settings</span>
<span class="n">var</span> <span class="n">oCustom</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">&quot;pathToW2hparm&quot;</span><span class="p">:</span><span class="s2">&quot;../option/my_parms.js&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="compatibility-option-id">
<span id="index-190"></span><h4>Compatibility Option id<a class="headerlink" href="#compatibility-option-id" title="Permalink to this headline">¶</a></h4>
<p>For compatibility the transaction option field can be defined with the special identifier “compatibility”. This indicates that the “compatibility” mode of operation should be used to search for customized elements. For example custom.css would be located through the transaction XXX-03CJ.</p>
</div>
<div class="section" id="defining-transaction-options">
<span id="index-191"></span><h4>Defining Transaction Options<a class="headerlink" href="#defining-transaction-options" title="Permalink to this headline">¶</a></h4>
<p>Using the HTML transaction display a user can click on the “Spanner” ICON to help in setting up the option files. This include the core option file and the relevant Javascript and CSS files.</p>
<p><img alt="image94" src="../../../_images/image942.png" />
<em>Transaction display with the option spanner ICON</em></p>
<p>On clicking the “spanner” icon a tabbed “Option” panel will be displayed. A pre-allocated core option environment, based upon the “option” field value, will be built. Two tabbed options are available, “BASIC” and “ADVANCED”:-</p>
<p><img alt="image92" src="../../../_images/image922.png" />
<em>Defining core option file</em></p>
<div class="section" id="basic-mode">
<h5>Basic Mode<a class="headerlink" href="#basic-mode" title="Permalink to this headline">¶</a></h5>
<p>Within the Basic mode of operation, the Validate button will create a core option file and upload it to the CLI-DIR directory. Within this file, Javascript and CSS settings keys, if selected, will point to the customisation files as defined by the “option” field. In the example below the Javascript and CSS customization files have been selected. This will effectively create a core option file <em>option.myOptions.js</em> which will be loaded upto the CLI_DIR. Within this core option file the key elements pathToJsCustom and pathtoCssCustom will be generated. These will point to files /option/custJS.myOptions.js and /option/custCSS.myOptions.css.</p>
<p><img alt="image93" src="../../../_images/image932.png" />
<em>Basic Mode Operation</em></p>
<p>The generated core option file option.myOptions.js will look like thsi:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">customization</span> <span class="k">for</span> <span class="n">option</span><span class="o">=</span><span class="n">myOptions</span>
<span class="n">var</span> <span class="n">oCustom</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pathToCssCustom&quot;</span><span class="p">:</span><span class="s2">&quot;../option/custCSS.myOptions.css&quot;</span><span class="p">,</span><span class="s2">&quot;pathToJsCustom&quot;</span><span class="p">:</span><span class="s2">&quot;../option/custJS.myOptions.js&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>This can be modified to add other custom elements such as PrintCSS, Parm or Help.</p>
</div>
<div class="section" id="advanced-mode">
<h5>Advanced Mode<a class="headerlink" href="#advanced-mode" title="Permalink to this headline">¶</a></h5>
<p>By selecting the Advanced mode tab the core option file can be downloaded in preparation for further modification.</p>
<p><img alt="image95" src="../../../_images/image952.png" />
<em>Advanced Mode Operation</em></p>
</div>
</div>
</div>
<div class="section" id="macros">
<span id="index-192"></span><h3>Macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h3>
<p>In the world of the 3270 emulation, the term of “Macro” brings together two separate concepts. The first one designates the recording of a sequence of repetitive actions that the user wishes to automate such as for example a signon process, the second designates a complex dialogue between the terminal and an application running on the mainframe side. This second category often requires the usage of a programming language to develop an executable module that operates from the workstation in partnership with the 3270 emulator.</p>
<p>This section discusses the answer to the first concept, the second one is discussed in the section <a class="reference internal" href="#ug-virtel-scenarios"><span class="std std-ref">“Web Modernisation VIRTEL Scenarios”</span></a>.</p>
<p>The macro interface is accessed from the Virtel toolbar. By pressing the REC button on the VIRTEL Web Access toolbar, the user can start recording a sequence of keystrokes. A second click on the REC button terminates the recording and allows the user to assign a name to the macro which has been recorded. The PLAY button on the toolbar allows the user to display a list of macros already recorded. From here a sub-menu can be displayed where macros can be replayed, edited, saved or deleted.
macro.</p>
<p><a class="reference internal" href="../../../_images/image63a.png"><img alt="image63a" src="../../../_images/image63a.png" style="width: 454.3px; height: 474.6px;" /></a></p>
<p><em>Play and Record buttons</em></p>
<div class="section" id="storing-the-macros">
<span id="index-193"></span><h4>Storing the Macros<a class="headerlink" href="#storing-the-macros" title="Permalink to this headline">¶</a></h4>
<p>Depending on the version of VIRTEL, the macros can be saved in:</p>
<ul class="simple">
<li>the Browser Local Storage (V4.53 and later),</li>
<li>on the workstation or network hard disk in a .json file,(V4.53 and later)</li>
<li>into a VSAM file on the host site (VIRTEL Storage) (V4.54 and later) using the DDI interface.</li>
</ul>
<p id="index-194">Macros are stored as a JavaScript array of JSON objects in a file called macros.json. For example:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;macros&quot;</span><span class="p">:[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;SDSF&quot;</span><span class="p">,</span><span class="s2">&quot;rev&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;def&quot;</span><span class="p">:[</span><span class="s2">&quot;move(435)&quot;</span><span class="p">,</span><span class="s2">&quot;ENTER&quot;</span><span class="p">,{</span><span class="s2">&quot;txt&quot;</span><span class="p">:</span><span class="s2">&quot;=M&quot;</span><span class="p">},</span><span class="s2">&quot;ErEof&quot;</span><span class="p">,</span><span class="s2">&quot;ENTER&quot;</span><span class="p">,{</span><span class="s2">&quot;txt&quot;</span><span class="p">:</span><span class="s2">&quot;6&quot;</span><span class="p">},</span><span class="s2">&quot;ENTER&quot;</span><span class="p">]}],</span><span class="s2">&quot;desc&quot;</span><span class="p">:</span><span class="s2">&quot;user macros&quot;</span><span class="p">,</span><span class="s2">&quot;fmt&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;user&quot;</span><span class="p">:</span><span class="s2">&quot;SPTHOLT&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="macros-in-local-storage">
<span id="index-195"></span><h4>Macros in Local Storage<a class="headerlink" href="#macros-in-local-storage" title="Permalink to this headline">¶</a></h4>
<p>By default macros created by the user are saved on the workstation in the “Browsers Local Storage”.</p>
<p>Because the browsers Local Storage isn’t persistent storage macros can be easily destroyed by actions at the browser level. For this reason it is possible to export the Local Storage data of the user macros to a file on a hard drive. Conversely, the saved macros can be re-imported back into Local Storage. Import and Export feature are available in the pop-up windows opened using the PLAY button on the toolbar.</p>
<p>The recorded macros display has a small context window which can be opened with a right-click. This menu provides the following functions:-</p>
<ul class="simple">
<li>Delete</li>
<li>Save as</li>
<li>Edit</li>
<li>Run</li>
</ul>
<p><a class="reference internal" href="../../../_images/image63b.png"><img alt="image63b" src="../../../_images/image63b.png" style="width: 411.5px; height: 365.0px;" /></a></p>
<p><em>Macro Sub_Menu Functions</em></p>
</div>
<div class="section" id="macro-controls">
<span id="index-196"></span><h4>Macro controls<a class="headerlink" href="#macro-controls" title="Permalink to this headline">¶</a></h4>
<p>Virtel provides several options which can control the display and functionality of the macro logic. The features are enabled or disabled through w2hparm settings. The features are:-</p>
<div class="section" id="key-mapping">
<h5>Key Mapping<a class="headerlink" href="#key-mapping" title="Permalink to this headline">¶</a></h5>
<p>Boolean setting to indicate whether keymapping is supported. When set to “true”, a hot key combination can be allocated to the macro. The default is false. When saving the macro you have the option of assigning a “hot key” or shortcut to the macro through keyboard mapping. Keyboard mapping can be a combination of ALT or CTRL keys and another keyboard key (F1 thru F12, A thru to Z, 1 thru 9). Beware that some keyboard combinations may be reserved for the operating system or Virtel functions. For example, CTRL-R is a browser refresh option. Allocating this combination as a hotkey will only invoke the browser refresh option and not the Virtel macro. Keyboard mapping is a feature that is turned on through a parameter in the w2hparm.js file.
By default, keyboard mapping is set to false.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">w2hparm</span><span class="o">.</span><span class="n">keymapping</span><span class="o">=</span><span class="n">true</span><span class="o">|</span><span class="n">false</span>
</pre></div>
</div>
<p>With keyboard mapping enabled the macro interface will display the associated key mapping against the macro.</p>
<p><img alt="image96" src="../../../_images/image962.png" /></p>
<p><em>Editing macro with keymapping</em></p>
</div>
<div class="section" id="keep-macro-pad">
<h5>Keep_Macro_Pad<a class="headerlink" href="#keep-macro-pad" title="Permalink to this headline">¶</a></h5>
<p>Boolean setting to indicate whether to maintain the macro interface open or to close it as soon as a macro has been executed.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">w2hparm</span><span class="o">.</span><span class="n">keepmacpad</span> <span class="n">true</span><span class="o">|</span><span class="n">false</span>
</pre></div>
</div>
</div>
<div class="section" id="macro-pad">
<h5>Macro_Pad<a class="headerlink" href="#macro-pad" title="Permalink to this headline">¶</a></h5>
<p>Boolean to indicate whether the macro interface should be presented as a sub-window in the VWA window, or as a separate window.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">w2hparm</span><span class="o">.</span><span class="n">macroPad</span> <span class="n">true</span><span class="o">|</span><span class="n">false</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="macros-in-virtel-storage">
<span id="index-197"></span><h4>Macros in VIRTEL Storage<a class="headerlink" href="#macros-in-virtel-storage" title="Permalink to this headline">¶</a></h4>
<p>The “VirtelMacros” function allows GLOBAL, GROUP, and USER macros to be stored under the name “macro.json” in a VSAM file on the VIRTEL host system. This feature uses the dynamic directory interface(DDI) capability of Virtel to store macros in a central repository, in this case a VSAM file on the mainframe. With this centralised environment macros can be managed, thereby keeping control of critical business logic. Macros will be automatically downloaded and refreshed on a users workstation depending on the options set in the w2hparm settings. Each DDi directory maintains a separate copy of the macros.json file.</p>
<p>The DDI and administration features of Virtel should only be made available to an “Administrator”. In Virtel an “Administrator” would be a user who has READ access to all the Virtel security profiles, in particular those starting VIRTEL.*. See the section “Security” in the Virtel Installation Guide for details on setting up Virtel Administrators and protecting resources. The following transactions and related security profiles are used by DDI.</p>
<p>For the minimal authorization to access the DDI, a user must be granted to access the VIRTEL transaction defined under WEB2HOST entry point with the external name. The following transactions are implemented as part of the Virtel macros feature</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">virtel</span><span class="o">.</span><span class="n">xxx</span><span class="o">-</span><span class="mi">03</span><span class="n">z</span>

<span class="n">where</span> <span class="n">xxx</span> <span class="o">=</span> <span class="n">W2H</span> <span class="ow">or</span> <span class="n">CLI</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">G</span> <span class="k">for</span> <span class="n">GROUP</span><span class="p">,</span> <span class="n">U</span> <span class="k">for</span> <span class="n">USER</span> <span class="ow">and</span> <span class="n">A</span> <span class="k">for</span> <span class="n">GLOBAL</span><span class="o">.</span>

<span class="n">virtel</span><span class="o">.</span><span class="n">W2H</span><span class="o">-</span><span class="mi">07</span>            <span class="n">DDI</span> <span class="n">Interface</span>                  <span class="n">W2H</span> <span class="n">only</span>
<span class="n">virtel</span><span class="o">.</span><span class="n">W2H</span><span class="o">-</span><span class="mi">66</span>            <span class="n">Upload</span> <span class="n">capability</span> <span class="n">token</span><span class="o">.</span>       <span class="n">W2H</span> <span class="n">only</span>
<span class="n">virtel</span><span class="o">.</span><span class="n">xxx</span><span class="o">-</span><span class="mi">80</span><span class="n">z</span>           <span class="n">Directory</span> <span class="n">upload</span>               <span class="n">W2H</span> <span class="ow">and</span> <span class="n">CLI</span>
<span class="n">virtel</span><span class="o">.</span><span class="n">USR</span><span class="o">-</span><span class="n">DIR</span>           <span class="n">User</span> <span class="n">directory</span>                 <span class="n">W2H</span> <span class="ow">and</span> <span class="n">CLI</span>
<span class="n">virtel</span><span class="o">.</span><span class="n">GRP</span><span class="o">-</span><span class="n">DIR</span>           <span class="n">Group</span> <span class="n">directory</span>                <span class="n">W2H</span> <span class="ow">and</span> <span class="n">CLI</span>
<span class="n">virtel</span><span class="o">.</span><span class="n">GLB</span><span class="o">-</span><span class="n">DIR</span>           <span class="n">Global</span> <span class="n">directory</span>               <span class="n">W2H</span> <span class="ow">and</span> <span class="n">CLI</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-to-use-ddi-and-macros">
<h4>Setting up to use DDI and macros<a class="headerlink" href="#setting-up-to-use-ddi-and-macros" title="Permalink to this headline">¶</a></h4>
<p>Run the SAMPLIB/CNTL ARBOLOAD job with the “SET VMACROS=YES” parameter coded. This defines the VirtelMacros functions and transactions required by DDI and macro suport. If this setup is not run the following message will appear when DDI is selected from the main Admin. portal page:-</p>
<p><em>“Your Virtel is not configured for dynamic directories”</em></p>
<p>Assuming everything has been configured correctly, the following display should be appear when selecting the DDI option from the main portal interface.</p>
<p><img alt="image97" src="../../../_images/image972.png" /></p>
<p><em>The Main DDI Page</em></p>
<p>Depending on the security setup a User or Administrator can have access to macros stored in one of the following centralized DDI directories:-</p>
<ul class="simple">
<li>a dedicated directory labeled with his userid - USR-DIR</li>
<li>a group directory labeled with his groupid - GRP-DIR</li>
<li>a global directory which can be accessed by all users -Global DIR.</li>
</ul>
<p>A User can only manage the macros stored in their dedicated user directory whereas Virtel Administrators have access to all directories and can manage macros stored in USER, GROUP and GLOBAL directories.</p>
<p>Multiple macros.json files can be defined: a global file containing shared macros for all users, and group and user files where macros specific to a group or to a user are stored.</p>
<p>User macros created by each user are stored in macros.json files loaded into the USR-DIR directory with keyword %USER%. When the macros are loaded into or read from this directory, VIRTEL substitutes the keyword %USER% with the users security userid.</p>
<p>Group macros are defined for a specific group name recognized by the security subsystem (RACF, TOPS, ACF2). They are stored in a macros.json file loaded into the GRP-DIR directory with keyword %GROUP%. At execution time, VIRTEL substitutes the keyword %GROUP% by the name of the group supplied by the security subsystem. Group macros are avaialble to users who belong to the group.</p>
<p>Global macros accessible to all users are stored in the macros.json file loaded into the GLB-DIR directory.</p>
<p>A prerequisite for using group and user macros is that the user must sign on to VIRTEL with a userid and password, either by accessing VIRTEL via a secure transaction (one whose “Security” field is non-zero), or by executing a SET$ SIGNON instruction contained in a scenario.</p>
<p id="index-198">In a Sysplex distributed environment, the VSAM files that contains the macros, normally the HTML TRSF file, cannot be shared between multiple instances of the VIRTEL STC. Each VIRTEL must have its own HTML VSAM macro file if administration is to be performed on the “running” system. For production environments where multiple instances share the same VSAM files (SAMP,HTML,ARBO) and run in a “READ ONLY” environment enforced through the use of the TCT parameter VSAMTYP=READONLY, DDI management will not be possible. This an incompatible environment for DDI macro management as macros cannot be updated. A solution to this is to have an “update” window where “READ ONLY” is turn off while macro maintenance is performed. Once checked out, the “READ ONLY” environment can be re-initialized. New macros will then be available to users. In a “READ ONLY” environment users will not be able to maintain any user environment as they will not have “write” access to the HTML.TRSF VSAM file.</p>
<div class="section" id="enabeling-macros-in-virtel-storage">
<h5>Enabeling macros in Virtel Storage<a class="headerlink" href="#enabeling-macros-in-virtel-storage" title="Permalink to this headline">¶</a></h5>
<p id="index-199">When VIRTEL is first installed, no macros.json files exist. To allow macros to be stored and loaded from the host site, the administrator activates the VirtelMacros function by
adding the code shown below to a customised w2hparm parm file. This parameter file should reside in the CLI-DIR directory (or another option site-defined directory). See <a class="reference internal" href="#ug-customizing-with-option"><span class="std std-ref">“Customisation Modes”</span></a> for further details on how to customise and configure Virtel.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">w2hparm</span><span class="o">.</span><span class="n">useVirtelMacros</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;macrosAutoRefresh&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Where value can be:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>“never” | “once” | “daily” | “session”
</pre></div>
</div>
<ul class="simple">
<li>“never”    DDI is on. Macros will not be automatically refreshed. This is the default. User has to use the refresh button.</li>
<li>“once”     DDI is on. Macros will be refreshed automatically at the start of the session.</li>
<li>“daily”    DDI is on. Macros will be refreshed daily.</li>
<li>“session”  DDi is on. Macros will be refreshed at the start of each session.</li>
</ul>
<p>Depending on the value will determine whether and when macros are downloaded from Virtel storage. A user can always initiate a download by pressing the Macros Icon on the toolbar.</p>
<p>Once VirtelMAcros have been activated each VIRTEL Web Access user has access to one or more macros.json files stored in:</p>
<ul class="simple">
<li>a dedicated directory labeled with his userid - USR-DIR</li>
<li>a group directory labeled with his groupid - GRP-DIR</li>
<li>a global directory which can be accessed by all users - Global DIR</li>
</ul>
<p>A user can only manage the macros stored in his own directory. To be able to manage macros stored in Group or Gloabl directories requires that specific authorizations are defined within the security tool. If no file exists, a 404 error is produced, and no macros are listed in the macro window. Access to the DDI interface is through the Administration Portal. Ensure that Administrators have access to the relevant security profiles.</p>
<span class="target" id="index-200"></span></div>
</div>
<div class="section" id="user-macros-synchronization">
<span id="index-201"></span><h4>User Macros synchronization<a class="headerlink" href="#user-macros-synchronization" title="Permalink to this headline">¶</a></h4>
<p>The sharing of macros across multiple instances of Virtel was introduced in Virtel 4.54. This feature is particularly useful where a user can connect to one of several instances of Virtel within in Sysplex Distributed environment zith separate HTML TRSF files. User macros are maintained in the browser’s cache and in the TRSF files through the %USR% directory entry defined in the ARBO file. Before the synchronization feature, if a user added or updated a macro and then reconnected to a different Virtel instance the macro entry maintained in the host TRSF wouldn’t reflect the latest updates held within the user’s browser cache, consequently any cache refresh would lose those updates.</p>
<p>With this feature a timestamp is used to synchronize macros between the browser’s cache and the supporting TRSF file. If the timestamp in the cache is later than the macro entry in the local TRSF file, the TRSF file will be updated. Conversely, if the macros in the local TRSF is later than the cache equivalent, then the macro will be reloaded in cache from the TRSF file. Any changes made will be refelcted back to the local TRSF file. If a subsequent logon is targeted to a different Virtel instance, and possibly a different TRSF, then the cache in the the browser will updated the local TRSF file as the timestamp in the browser for the macro will be later than the timestamp held in the TRSF file. Using this timestamp comparison ensures that the macros and synchronized between the users browser cache and the supporting TRSF file.</p>
<p>This feature is activated by setting the following w2hparm setting. This parameter file should be loaded into the CLI-DIR directory or a directory designated by the /Option/ pathname if “Option” mode customization is being used. The w2hparm modification must be activated as described in <a class="reference internal" href="#ug-customizing-with-option"><span class="std std-ref">“Customising Modes”</span></a>. Once this customization has been done, the macros will be automaticaly be synchonized across VIRTEL instances where each Virtel has its own HTML TRSF file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">w2hparm</span><span class="o">.</span><span class="n">synchronizeVirtelMacros</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="managing-macros-with-ddi">
<span id="index-202"></span><h4>Managing macros with DDI<a class="headerlink" href="#managing-macros-with-ddi" title="Permalink to this headline">¶</a></h4>
<p>The normal practice for an administrator in managing the macro repository would be to capture and create a macro in their user directory, upload it to the mainframe repository using the DDI interface, modify it for general use, and then copy it to any group, user or global directory for general availability. The upload process is through a drag and drop operation within DDI interface. To copy a macros.json to another user or group requires downloading the macro first then dragging the file into the relevant DDI panel area designated by the dotted lines.</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">Do not use the Virtel Drag and Drop function to upload DDI macros. You must use the DDI upload interface!</p>
</div>
<div class="section" id="uploading-a-macro-json-file-to-the-ddi-directory">
<span id="index-203"></span><h5>Uploading a macro.json file to the DDI directory<a class="headerlink" href="#uploading-a-macro-json-file-to-the-ddi-directory" title="Permalink to this headline">¶</a></h5>
<p>Open the DDI interface, select Global. The Global directory will open. Drag the macros.json file into the area designated by a series of dotted lines. This will initiate a file upload into the global directory of the macro repository:-</p>
<p><img alt="image105" src="../../../_images/image1052.png" /></p>
<p><em>The DDI Global Upload</em></p>
<p>Once you have a copy in the global area, right click on the macros.json file to open a context menu. This menu provides some additional functions such as Copy, Download, Delete and Edit. For macros.json the copy function is not applicable.</p>
<p><img alt="image106" src="../../../_images/image1062.png" /></p>
<p><em>Additional file functions in DDI</em></p>
<p>Selecting “Edit” will open the same editor interface that was used when editing macros in local storage. Here the Administrator can modify the macros held within the macros.json file. Macros can be saved with different names and associated with different key mappings. Options like Save As, Edit and Delete are available within a context menu when you right click on a macro.</p>
<p><img alt="image107" src="../../../_images/image1072.png" /></p>
<p><em>Updating macros with the Global Directory</em></p>
</div>
<div class="section" id="making-macros-available-to-users">
<h5>Making macros available to users<a class="headerlink" href="#making-macros-available-to-users" title="Permalink to this headline">¶</a></h5>
<p>Any macro that an Administrator creates can be made available to users either at the Global, Group or Userid level. To make macros available at a userid level, select the User TAB from the DDI main panel. Enter the user’s USERID in the user name field and press the “Green Tick” icon. This will create an area within the DDI macro repository. Upload the macros.json file you wish to make available to this user by dragging the file into the area designated by the dotted lines. This will initiate an upload of the macro into the User’s userid area.</p>
<p><img alt="image108" src="../../../_images/image1082.png" /></p>
<p><em>Creating a macros.json file for a user</em></p>
<p>As with any file within the DDI repository, a context menu can be brought up by right clicking on the macro file name.</p>
<p><img alt="image109" src="../../../_images/image1092.png" /></p>
</div>
<div class="section" id="editing-a-users-macro">
<h5>Editing a Users macro<a class="headerlink" href="#editing-a-users-macro" title="Permalink to this headline">¶</a></h5>
<p>An Administrator can update any macros held within the DDI repository. Changes will be reflected in the user’s local storage once the user open’s their macro display with the “Green” ICON arrow. The following display shows the DDI repository macros as displayed in the user’s browser. Remember that User macros are related to the User’s Userid and associated Group. This ability to associate macros to a Userid and Group means that all macros, related to business assets, can be managed and maintained in a central DDI repository. Maintenance can be applied centrally and distributed out to the User’s local storage browser. If allowed by the Administrator, Users will only have the option of modifying their own user macros. Any changes made by a user will be uploaded to the mainframe and stored in the User’s macro area within the DDI repository. This keeps the user macro modifications in sync with the DDI repository.</p>
<p><img alt="image110" src="../../../_images/image1102.png" /></p>
<p><em>User display of the DDI macro interface</em></p>
</div>
<div class="section" id="updating-ddi-macros-at-the-group-level">
<span id="index-204"></span><h5>Updating DDI macros at the Group level<a class="headerlink" href="#updating-ddi-macros-at-the-group-level" title="Permalink to this headline">¶</a></h5>
<p>To make macros available at a Group level, select the Group TAB from the DDI main panel. Enter the Group name in the group name field and press the “Green Tick” icon. This will create an area within the DDI macro repository were macros for this group can be held. Upload the Group macros.json file you wish to make available to this group by dragging the file into the area designated by the dotted lines. This will initiate an upload of the Group macro.</p>
<p><img alt="image111" src="../../../_images/image11111.png" /></p>
<p><em>Macro Group Directory List</em></p>
<p>To obtain the associated context menu right click on the file name – macros.json. This will provide the additional functionality to Edit, Download or Delete the macro.</p>
</div>
<div class="section" id="notes">
<h5>Notes:<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h5>
<p id="index-205"><strong>DDI files</strong></p>
<p>Macros are maintained in the macros.json file. Each macro mode, local or DDI (User, Group and Global) will maintain a separate macros.json file. Virtel’s DDI can also be used to store files other than the macros.json file. Things like corporate images, bespoke Javascript deployments etc. When copying files to DDI you must use the DDI drag and drop interface. Do not use the Administration drag and drop interface.</p>
<p><strong>Save As feature</strong></p>
<p>The “SAVE AS” function does not have the ability to re-assign key mapping. This can only be done through the macro editor. To clone a macro with a new key mapping perform the following operations:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Open macro “A”
Save as “B”
Open macro “B” in Editor.
Save with key board mapping.
</pre></div>
</div>
</div>
</div>
<div class="section" id="automatic-refresh-of-macros-in-local-storage">
<span id="index-206"></span><h4>Automatic refresh of macros in local storage<a class="headerlink" href="#automatic-refresh-of-macros-in-local-storage" title="Permalink to this headline">¶</a></h4>
<p>Updates to DDI macros held in local storage can only be updated once the user refreshes or redisplays the macros. This triggers the download from the mainframe. Macros are not “automatically” updated in the background due to the performance. If an Administrator updates a macro on the mainframe that update will only be available to the user when the user redisplays or refreshes his local storage by using the “Green” display ICON. This behaviour can be overridden by setting the “macrosAutoRefresh” value in w2hparm. For example, setting the value “daily” will update the local storage of the macros from the Virtel storage once a day. This will ensure that users have the latest copy of the macros.json files.</p>
</div>
<div class="section" id="format-of-the-macros-json-file">
<span id="index-207"></span><h4>Format of the macros.json file<a class="headerlink" href="#format-of-the-macros-json-file" title="Permalink to this headline">¶</a></h4>
<p>Each macros.json file contains a set of macros as shown in the example below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;macros&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="p">{</span><span class="s2">&quot;def&quot;</span><span class="p">:[</span><span class="s2">&quot;PF3&quot;</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="s2">&quot;ENTER&quot;</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span><span class="mi">112</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="s2">&quot;ENTER&quot;</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="s2">&quot;ENTER&quot;</span><span class="p">],</span>
<span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;macro1&quot;</span><span class="p">},</span>
<span class="p">{</span><span class="s2">&quot;def&quot;</span><span class="p">:[</span><span class="mi">105</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span><span class="mi">112</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="s2">&quot;ENTER&quot;</span><span class="p">],</span>
<span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;macro2&quot;</span><span class="p">}</span>
<span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Example of a macros.json file</em></p>
<p>An empty file (containing no macros) contains only:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;macros&quot;</span><span class="p">:</span> <span class="p">[]}</span>
</pre></div>
</div>
<p><em>Example of an empty macros.json file</em></p>
</div>
<div class="section" id="available-macro-commands">
<span id="ug-macro-commands"></span><span id="index-208"></span><h4>Available macro commands<a class="headerlink" href="#available-macro-commands" title="Permalink to this headline">¶</a></h4>
<p>The following commands can be used in a macro file :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&quot;any string of characters to input into 3270 screen&quot;
move(pos)
copy(startRow,startCol,endRow,endCol)
paste(pos)
paste(pos,nbRows,nbCols)
key(keyIdentifier)
List of available key identifiers (case sensitive!!):
- ENTER
- CLEAR
- ATTN
- PF[1-24]
- PA[1-3]
- InsToogle
- NewLine
- Home
- Tab
- Backtab
- Bksp
- Left
- Right
- Down
- Up
- End
- ErEof
- Del
- Reset
- FieldMark
- Dup
</pre></div>
</div>
</div>
<div class="section" id="ddi-macro-errors">
<span id="index-209"></span><h4>DDI Macro Errors<a class="headerlink" href="#ddi-macro-errors" title="Permalink to this headline">¶</a></h4>
<p>Error message : Failed to upload the user macros to Virtel (Status code 400 Bad Request). This message can appear when editing a macro. Virtel is unable to reflect your macro changes in the USR-DIR directory. This could be because:-</p>
<ul class="simple">
<li>Virtel is running in a READ ONLY mode.</li>
<li>You do not have the authority to upload to the USR-DIR. See transaction xxx-80U.</li>
</ul>
<p>If you get the following Error Panal when trying to execute a DDI macro it could be due to the fact thet the transaction you are running doesn’t have security set. Make sure the transaction is secure with “Security = basic”. DDI requires USERID and GROUP information. This can only be obtained with secure transactions.</p>
<p><img alt="image119" src="../../../_images/image1191.png" /></p>
</div>
</div>
<div class="section" id="virtel-web-modernisation">
<span id="ug-virtel-scenarios"></span><span id="index-210"></span><h3>VIRTEL Web Modernisation<a class="headerlink" href="#virtel-web-modernisation" title="Permalink to this headline">¶</a></h3>
<div class="section" id="virtel-presentation-modules-and-scenarios">
<span id="index-211"></span><h4>VIRTEL Presentation modules and Scenarios<a class="headerlink" href="#virtel-presentation-modules-and-scenarios" title="Permalink to this headline">¶</a></h4>
<p>Without modifying existing applications, VIRTEL offers several possibilities for dynamic modification of 3270 data extracted by the {{{GENERATE-HTML}}} tag before it is presented in an HTML page. For instance, it is possible to define, for each field selected, a list of permitted values, or to generate a URL as a function of the value of a fixed field.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As opposed to the specific tags presented in the Virtel Web Access section, the set of presentation rules in Web Modernisation are not defined in an HTML page, but as an assembled program. The program can be stored as a .390 object module in the scenario directory SCE-DIR or as a linked module in the Virtel loadlib. The default for Virtel V4.57 is to maintain these .390 object modules in the SCE-DIR. VIRTEL scenarios were originally assembled and link-edited into a load library concatenated to the DFHRPL DD statement in the VIRTEL started task. From VIRTEL version 4.48 onwards, there is also the possibility of generating, syntax checking, and compiling scenarios using Virtel Studio on an Eclipse platform, and uploading the resulting executable code into a VIRTEL directory stored in a VSAM file. This is now the default for Virtel.</p>
</div>
<p id="index-212">An HTML presentation module is made up of several scenarios composed of the following instructions: SCREENS, SCRNEND, SCENARIO, ACTION$, CONVERT$, COPY$, DECLARE$, ERROR$, FIELD$, GOTO$, IF$, MAP$, SET$, TOVAR$, VIRSV$ and END. These instructions are assembler macros contained in the VIRT457.SCRNAPI.MACLIB library (for MVS) or the VIRT457.VIRSAPI SUBLIB library (for VSE). The other instructions included in this library are for internal use and must not be used directly. Each module begins with a SCREENS instruction, is terminated by a SCRNEND instruction, and must contain at least one SCENARIO.</p>
<p>The types of scenarios that can be stored in a presentation module are:-</p>
<ul class="simple">
<li>Identification scenario. Specified on the Entry Point definition. Processes inbound calls and cqn be used to route requests to other Entry points.</li>
<li>Initial scenario. Invoked during transaction connection.</li>
<li>Final scenario. Invoked during transaction disconnection.</li>
<li>Input scenario. Invoked to process inbound message data - from the browser.</li>
<li>Output scenario. Invoked to process outbound message data - to the browser.</li>
</ul>
</div>
<div class="section" id="scenarios-stored-in-a-load-library">
<span id="index-213"></span><h4>Scenarios stored in a load library<a class="headerlink" href="#scenarios-stored-in-a-load-library" title="Permalink to this headline">¶</a></h4>
<p>After compilation, the resulting module must be placed in one of the libraries defined in the DFHRPL concatenation in the VIRTEL started task (for MVS), or in one of the libraries in the LIBDEF SEARCH statement (for VSE). Refer to member ASMSCEN in the VIRTEL SAMPLIB for an example job to assemble and link a presentation module in z/OS.</p>
<p>The F VIRTEL,NEW=scenario-name command (see VIRTEL Messages and Operations Guide) allows VIRTEL to take into account the new version of a scenario assembled and link-edited into a load library.</p>
</div>
<div class="section" id="scenarios-stored-in-a-vsam-directory">
<span id="index-214"></span><h4>Scenarios stored in a VSAM directory<a class="headerlink" href="#scenarios-stored-in-a-vsam-directory" title="Permalink to this headline">¶</a></h4>
<p>If the “Directory for scenarios” field in the Entry Point is non-blank, VIRTEL will load scenarios from the specified directory instead of from the DFHRPL load library.
Scenarios in VSAM are ordinary VIRTEL files and their extension must be .390; they are normally assembled on a workstation and uploaded to the “Directory for scenarios” by means of Virtel Studio. If a new version of a scenario is uploaded in a VSAM directory, the new version will be used immediately whenever a new connection needs it; no VIRTEL command is necessary. If a terminal is already executing the old version of the scenario, it is not affected, and continues with a copy of the old version. If another scenario with the same name exists
in another directory, it is not modified by the upload.</p>
<p><img alt="image112" src="../../../_images/image1121.png" />
<em>Entry Point display with SCE-DIR for scenarios</em></p>
</div>
<div class="section" id="using-a-presentation-module">
<h4>Using a presentation module<a class="headerlink" href="#using-a-presentation-module" title="Permalink to this headline">¶</a></h4>
<p>In order to be used, the name of the HTML presentation module must be specified in the “Initial Scenario”, “Final Scenario”, “Input Scenario” or “Output Scenario” field of the transaction supporting access to the application (see “Parameters of the transaction” in the VIRTEL Connectivity Reference manual), or in the “Identification scenario” field of the entry point (see “Parameters of the entry point” in the VIRTEL Connectivity Reference manual).</p>
</div>
<div class="section" id="types-of-scenario">
<h4>Types of scenario<a class="headerlink" href="#types-of-scenario" title="Permalink to this headline">¶</a></h4>
<p>A presentation module can contain one of each of the following types of scenario:</p>
<div class="section" id="index-215">
<span id="identification-scenario"></span><h5>Identification scenario<a class="headerlink" href="#index-215" title="Permalink to this headline">¶</a></h5>
<p>An identification scenario is invoked when an inbound call is assigned to an entry point. Because an identification
scenario is executed before a transaction is selected and before connecting to a host application, the scenario may use
the SET$ TRANSACTION instruction to select the transaction which specifies the host application (if any) to be used.
The identification scenario is required when the entry point specifies the name of this presentation module in its
“Identification scenario” field.</p>
</div>
<div class="section" id="initial-scenario">
<span id="index-216"></span><h5>Initial scenario<a class="headerlink" href="#initial-scenario" title="Permalink to this headline">¶</a></h5>
<p>An initial scenario is invoked when an &amp;/S order is processed in a connection script (see “Connection / Disconnection
Scripts” in the VIRTEL Connectivity Reference manual). The initial scenario is required when the “TIOA at logon” field
of the transaction contains &amp;/S and the name of the presentation module is coded in the “Initial Scenario” field of the
transaction.</p>
</div>
<div class="section" id="final-scenario">
<span id="index-217"></span><h5>Final scenario<a class="headerlink" href="#final-scenario" title="Permalink to this headline">¶</a></h5>
<p>A final scenario is invoked when an &amp;/S order is processed in a disconnection script (see “Connection / Disconnection
Scripts” in the VIRTEL Connectivity Reference manual). The final scenario is required when the “TIOA at logoff” field of
the transaction contains &amp;/S and the name of the presentation module is coded in the “Final Scenario” field of the
transaction.</p>
</div>
<div class="section" id="input-scenario">
<span id="index-218"></span><h5>Input scenario<a class="headerlink" href="#input-scenario" title="Permalink to this headline">¶</a></h5>
<p>An input scenario is invoked once at the start of the session (on receipt of the first message from the application to the
terminal after the connection has been established with the host application), and again on receipt of each inbound
message (from the terminal to the application). The input scenario is required when the name of the presentation
module is coded in the “Input Scenario” field of the transaction.</p>
<p>When the input scenario is invoked on receipt of the first outbound message (from the application to the terminal),
the scenario may terminate with a CASE$ FAIL or an IF$ FAIL instruction. In this case, the outbound message is
discarded and the input scenario is invoked again on receipt on the next outbound message from the application. This
process continues until the input scenario terminates with a CASE$ SUCCESS or IF$ SUCCESS instruction, or reaches
SCENARIO END, after which the input scenario stops processing outbound messages and is subsequently invoked for
each inbound message.</p>
</div>
<div class="section" id="output-scenario">
<span id="index-219"></span><h5>Output scenario<a class="headerlink" href="#output-scenario" title="Permalink to this headline">¶</a></h5>
<p>An output scenario is invoked on receipt of each outbound message (sent from the application to the terminal). The
output scenario is required when the name of the presentation module is coded in the “Output Scenario” field of the
transaction.</p>
</div>
<div class="section" id="developing-presentation-modules-with-virtel-studio">
<span id="index-220"></span><h5>Developing presentation modules with Virtel Studio<a class="headerlink" href="#developing-presentation-modules-with-virtel-studio" title="Permalink to this headline">¶</a></h5>
<p>Although presentation modules can be hard coded as an assembler routine and loaded into a Load library the recommended approach is to use the Eclipse Virtel Studio development aid. Virtel Studio is a Eclipse framework which runs on a PC. It enables a developer to assemble and upload presentation modules to a Virtel Server.</p>
<p><img alt="image120" src="../../../_images/image1201.png" /></p>
<p><em>Virtel Studio presentation IDE</em></p>
<p>Virtel Studio assembles a VSC module and produces a .390 object deck. This is loaded upto the Virtel server. Virtel Studio only supports scenarios within a VSAM directory.</p>
</div>
</div>
<div class="section" id="virtel-scenario-language">
<span id="index-221"></span><h4>Virtel Scenario language<a class="headerlink" href="#virtel-scenario-language" title="Permalink to this headline">¶</a></h4>
<div class="section" id="scenario-instructions">
<span id="index-222"></span><h5>SCENARIO instructions<a class="headerlink" href="#scenario-instructions" title="Permalink to this headline">¶</a></h5>
<p>This instruction encloses ACTION$, CONVERT$, COPY$, DECLARE$, ERROR$, FIELD$, GOTO$, IF$, MAP$, SET$, TOVAR$, and VIRSV$ instructions.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SCENARIO</span> <span class="n">value</span>
</pre></div>
</div>
<dl class="docutils">
<dt>value</dt>
<dd><p class="first">Determines the type of processing. The permitted values are:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>IDENTIFICATION</dt>
<dd>Marks the start of the identification scenario.</dd>
<dt>INITIAL</dt>
<dd>Marks the start of the initial scenario.</dd>
<dt>FINAL</dt>
<dd>Marks the start of the final scenario.</dd>
<dt>INPUT</dt>
<dd>Marks the start of the input scenario.</dd>
<dt>OUTPUT</dt>
<dd>Marks the start of the output scenario.</dd>
<dt>END</dt>
<dd>Marks the end of a scenario. In the case of an input or output scenario, the scenario is stopped, but will resume on receipt of the next input or output message.</dd>
<dt>DISCARD</dt>
<dd>Marks the end of a scenario. In the case of an input or output scenario, the scenario stops, and does not resume for the remainder of the life of the VIRTEL transaction.</dd>
<dt>SUBROUTINE</dt>
<dd>Marks the start of a subroutine scenario which must ends with a SCENARIO END instruction. A subroutine scenario is invoked using PERFORM$ instruction. A subroutine scenario can invoke another subroutine scenario, and so on up to 3 levels. A sample of such type of scenario is available in the PREFORM$ instruction description.</dd>
<dt>SUCCESS</dt>
<dd>Stops scenario processing but continue normal VIRTEL processing of the current message.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
</div>
<div class="section" id="screens-instruction">
<span id="index-223"></span><h5>SCREENS instruction<a class="headerlink" href="#screens-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction specifies the name of the presentation module and its execution mode. Each SCREENS instructions is
terminated by a SCRNEND instruction and may contain only SCENARIO or ERROR$ instructions.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">modname</span> <span class="n">SCREENS</span> <span class="n">APPL</span><span class="o">=</span><span class="n">value1</span><span class="p">,</span><span class="n">EXEC</span><span class="o">=</span><span class="n">value2</span>
</pre></div>
</div>
<dl class="docutils">
<dt>modname</dt>
<dd>Name of the presentation module (8 characters maximum). Under certain conditions, this value will allow calls to a script from a subsystem by way of a CALL command.</dd>
<dt>APPL</dt>
<dd>Specifies the name of the target transaction when the presentation module is called by a program.</dd>
<dt>EXEC</dt>
<dd><p class="first">Determines the mode in which the script is used. The possible values are:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>YES</dt>
<dd>The script may be called by a CALL from a subsystem with the possible passing of parameters</dd>
<dt>NO</dt>
<dd>The script may not be externally called.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
</div>
<div class="section" id="scrnend-instruction">
<span id="index-224"></span><h5>SCRNEND instruction<a class="headerlink" href="#scrnend-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction marks the end of a presentation module.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SCRNEND</span>
</pre></div>
</div>
</div>
<div class="section" id="action-instruction">
<span id="index-225"></span><h5>ACTION$ instruction<a class="headerlink" href="#action-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction specifies actions to be taken.</p>
<p id="index-226"><strong>ACTION$ DISCONNECT</strong></p>
<p>Terminate the application.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ DISCONNECT
</pre></div>
</div>
<p id="index-227"><strong>ACTION$ REFRESH-TERMINAL</strong></p>
<p>This instruction allows a scenario to trigger a 205 response to the Long Poll session.
This 205 response will then tell the JavaScript to refresh the terminal 3270 emulation screen, so that the user can see
whatever was changed by the scenario.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ REFRESH-TERMINAL
</pre></div>
</div>
<p id="ug-action-serve-another-users"><span id="index-228"></span><strong>ACTION$ SERVE-ANOTHER-USER</strong></p>
<p>Indicates that the transaction is now a service transaction (see <a class="reference internal" href="#ug-service-transactions"><span class="std std-ref">“Service Transactions”</span></a>).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ SERVE-ANOTHER-USER
</pre></div>
</div>
<p id="index-229"><strong>ACTION$ TERMSESS</strong></p>
<p>Requests disconnection from the host application after the next message has been sent to the client’s browser.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ TERMSESS
</pre></div>
</div>
<p id="index-230"><strong>ACTION$ TO-APPLICATION</strong></p>
<p>Send a message to the application, consisting of the input fields in the screen image buffer and the function key
specified by pfkey.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ TO-APPLICATION,KEY=pfkey,                     X
    AND=(WAIT|SCRIPT,&#39;string&#39;),                       X
    AND=(PROCESS-RESPONSE,&#39;string&#39;),                  X
    AND=(DO-NOT-PROCESS-RESPONSE),                    X
    MAXTIME=nnn,                                      X
    LASTMSG=YES,ASYNCH=YES
</pre></div>
</div>
<dl class="docutils">
<dt>pfkey</dt>
<dd><p class="first">a 3270 AID key. The allowable values are:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>F1-F9</td>
<td>PF1 to PF9</td>
</tr>
<tr class="row-odd"><td>7A-7C</td>
<td>PF10 to PF12</td>
</tr>
<tr class="row-even"><td>C1-C9</td>
<td>PF13 to PF21</td>
</tr>
<tr class="row-odd"><td>4A-4C</td>
<td>PF22 to PF24</td>
</tr>
<tr class="row-even"><td>6C</td>
<td>PA1</td>
</tr>
<tr class="row-odd"><td>6E</td>
<td>PA2</td>
</tr>
<tr class="row-even"><td>6B</td>
<td>PA3</td>
</tr>
<tr class="row-odd"><td>6D</td>
<td>Clear</td>
</tr>
<tr class="row-even"><td>7D</td>
<td>Enter</td>
</tr>
<tr class="row-odd"><td>FD</td>
<td>Attn</td>
</tr>
</tbody>
</table>
</dd>
<dt>AND=(WAIT,’string’)</dt>
<dd>(optional) after sending the message to the application, the scenario waits until the application sends a message containing the specified character string. Intervening messages are processed by VIRTEL but are not passed to the scenario or sent to the terminal.</dd>
<dt>AND=(SCRIPT,’string’)</dt>
<dd>(optional) after sending the message to the application, VIRTEL executes the string as a Connection/Disconnection script. See “Connection/Disconnection Scripts” in the Virtel in the VIRTEL Connectivity Reference manual.</dd>
<dt>AND=(PROCESS-RESPONSE,’string’)</dt>
<dd>(optional) allows an input scenario to explicitly request that control is to be returned when the next message is received from the application. The string is optional. If specified, after sending the message to the application, VIRTEL executes the string as a Connection/Disconnection script. See “Connection/Disconnection Scripts” in the VIRTEL Connectivity Reference manual.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For an input scenario, AND=(PROCESS-RESPONSE) is the default value immediately after the connection.</p>
</div>
<dl class="docutils">
<dt>AND=(DO-NOT-PROCESS-RESPONSE)</dt>
<dd>(optional) allows an input scenario to explicitly state that is does not want to process the response from the application. After this instruction, the input scenario will not see any messages from the application, only input messages from the terminal.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For an input scenario, AND=(DO-NOT-PROCESS-RESPONSE) is the default value once the connection stage is passed.</p>
</div>
<dl class="docutils">
<dt>MAXTIME=nnn</dt>
<dd>(optional) specifies the maximum time, in hundredths of a second, that the scenario will wait for a message from the application. When this time expires, the APPLICATION-TIMEOUT flag will be set (see <a class="reference internal" href="#ug-if"><span class="std std-ref">“IF$ instruction”</span></a>) and the scenario will resume execution. If the MAXTIME parameter is not specified, then the scenario will wait indefinitely, or until VIRTEL disconnects the session when the timeout value of the entry point is exceeded.</dd>
<dt>LASTMSG=YES</dt>
<dd>(optional) requests disconnection after the application responds to the pfkey sent.</dd>
<dt>ASYNCH=YES</dt>
<dd><p class="first">(optional) indicate that the sending of the message to the application is not to prevent the normal screen display.</p>
<p>When the ACTION$ TO-APPLICATION instruction is executed in an output scenario, or in an input scenario before the first message has been delivered to the terminal, the specified function key is sent to the application and the scenario is suspended awaiting the next outbound message from the host application. When the next outbound message arrives, the scenario is resumed starting with the next instruction after the ACTION$ TO-APPLICATION instruction. Subsequent outbound messages will cause the scenario to resume execution again at the instruction after the latest ACTION$ TO-APPLICATION instruction until a SCENARIO END instruction is executed. After a SCENARIO END instruction is executed, subsequent outbound messages will once again cause the output scenario to resume at the beginning.</p>
<p>When the ACTION$ TO-APPLICATION instruction is executed in an input scenario driven by an inbound message, the data in the inbound message is sent to the application together with the 3270 AID key specified in the KEY parameter. Subsequent inbound messages will cause the input scenario to resume execution again at the instruction after the ACTION$ TO-APPLICATION instruction until a SCENARIO END instruction is executed. After a SCENARIO END instruction is executed, subsequent inbound messages will once again cause the input scenario to resume at the beginning.</p>
<p class="last">To allow an input scenario to see the responses from the host application in addition to the input messages from the terminal, the ACTION$ TO-APPLICATION instruction contains an AND= parameter which allows the scenario to explicitly request whether or not it expects to process the application response message following the ACTION$ instruction.</p>
</dd>
</dl>
<p id="index-231"><strong>ACTION$ TO-TERMINAL</strong></p>
<p>Send the current contents of the screen image buffer to the terminal.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ TO-TERMINAL
</pre></div>
</div>
<p>When the ACTION$ TO-TERMINAL instruction is executed in an input scenario, the contents of the screen image buffer
are sent to the terminal. The scenario may use instructions such as COPY$ VARIABLE-TO-SCREEN to place data in the
screen image buffer before issuing the ACTION$ TO-TERMINAL instruction.</p>
<p id="index-232"><strong>ACTION$ Examples</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ TO-APPLICATION,KEY=F3
</pre></div>
</div>
<p>Send F3 (PF3) to the application and wait for the next outbound message. When the application responds, continue with the next instruction in the scenario.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ TO-APPLICATION,KEY=7D, *
AND=(WAIT,&#39;Password ===&gt;&#39;),MAXTIME=100
</pre></div>
</div>
<p>Send ENTER to the application and wait for the application to send a message containing the string “Password ===&gt;”. If the requested message does not arrive within 1 second, then set the APPLICATION-TIMEOUT flags and continue the scenario.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ TO-APPLICATION,KEY=7D, *
AND=(SCRIPT, *
&#39;Signon to CICS&amp;&amp;/W&amp;&amp;*F34BE9&amp;&amp;/A&amp;&amp;/T&#39;)
</pre></div>
</div>
<p>Send ENTER to the application before sending two tab key followed by a message containing the string “Test”.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ TO-APPLICATION,KEY=7D, *
AND=(SCRIPT,&#39;&amp;&amp;&gt;&amp;&amp;&gt;Test&amp;&amp;/T&#39;)
</pre></div>
</div>
<p>Send ENTER to the application, wait for the application to send a message containing the string “Signon to CICS”, then send F3 to the application, and send the screen image to the terminal. Note: the ampersands are doubled to conform with assembler syntax requirements.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ TO-APPLICATION,KEY=6D,LASTMSG=YES,ASYNCH=YES
</pre></div>
</div>
<p>Exit from the scenario (equivalent to IF$ … SUCCESS), display the screen as normal, send 6D (CLEAR) to the application, and when the application responds, disconnect.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ TO-APPLICATION,KEY=7D, *
AND=(PROCESS-RESPONSE)
</pre></div>
</div>
<p>The input scenario will resume at the next instruction when the next message is received from the host application.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ TO-APPLICATION,KEY=7D, *
AND=(DO-NOT-PROCESS-RESPONSE)
</pre></div>
</div>
<p>The input scenario will not be called again for messages received from the host application. It will only be called for
input messages.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ACTION$ TO-APPLICATION,KEY=7D, *
AND=(PROCESS-RESPONSE,&#39;&amp;&amp;*F34BE9&amp;&amp;/A&#39;)
</pre></div>
</div>
<p>This is the same as for PROCESS-RESPONSE but with execution of a script in addition. Note: the ampersands are
doubled to conform withinh assembler syntax requirements.</p>
</div>
<div class="section" id="case-instruction">
<span id="index-233"></span><h5>CASE$ instruction<a class="headerlink" href="#case-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction tests a value in a 3270 screen position, or a value in a VIRTEL variable, and directs the subsequent
processing flow according to the value.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>[CASE$ (row,col,len), | CASE$ &#39;varname&#39;, | CASE$ CURRENT-SCREEN-POSITION,]

   LTRIM=(&#39;string1&#39;,&#39;string2&#39;,...),
   RTRIM=(&#39;string1&#39;,&#39;string2&#39;,...),
   (EMPTY,process0),
   (condition,&#39;value&#39;,process1),
   (condition,&#39;*varname1&#39;,process2),
   (condition,STRING,&#39;value&#39;,process3),
   (condition,VARIABLE,&#39;varname1&#39;,process4),
 ...
 ELSE=processx
</pre></div>
</div>
<dl class="docutils">
<dt>(row,col,len)</dt>
<dd>Specifies the row, column, and length of the 3270 screen data (see Note 1).</dd>
<dt>varname</dt>
<dd>Specifies the name of a VIRTEL variable (must be placed in quotes)</dd>
<dt>CURRENT-SCREEN-POSITION</dt>
<dd>The tested variable is located at the current screen position as set or incremented by <a class="reference internal" href="#ug-set-screen-position"><span class="std std-ref">“SET$ SCREEN-POSITION”</span></a>.</dd>
<dt>LTRIM</dt>
<dd><p class="first">(optional) Removes a set of characters from the start of a list variable (see Note) before copying it).</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>‘string1’ [,’string2’, …]</dt>
<dd>one or more strings of text to be removed from the start of the variable.</dd>
</dl>
</div></blockquote>
</dd>
<dt>RTRIM</dt>
<dd><p class="first">(optional) Removes a set of characters from the end of a list variable (see Note) before copying it.</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>‘string1’ [,’string2’, …]</dt>
<dd>one or more strings of text to be removed from the end of the variable.</dd>
</dl>
</div></blockquote>
</dd>
<dt>EMPTY</dt>
<dd>Specifies whether the tested is empty (see Note 2).</dd>
<dt>condition</dt>
<dd>Specifies whether the data tested must be equal (EQ), not equal (NE), prefixed by (BEGIN), less than (LT), less than or equal (LE), greater than (GT), greater than or equal (GE), or must contain (CONTAINS) the specified value.</dd>
<dt>value</dt>
<dd>Specifies the value against which the data is tested (must be placed in quotes)</dd>
<dt>process1,2,…</dt>
<dd><p class="first">Specifies the address of the branch exit of the script if the condition is satisfied. Permitted values are:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>label</dt>
<dd>instruction label at which execution of the scenario is to continue.</dd>
<dt>FAIL</dt>
<dd>reserved word indicating that the scenario is to be terminated and the current message is to be discarded. The scenario will be called again on receipt of the next outbound message from the application.</dd>
<dt>SUCCESS</dt>
<dd>reserved word indicating that the scenario is to be terminated and the current message is to be presented to the user. This is equivalent to branching to a SCENARIO END instruction.</dd>
</dl>
</div></blockquote>
</dd>
<dt>processx</dt>
<dd>Specifies the address of the branch exit of the script if none of the conditions is satisfied. Permitted values are identical to process1.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Note 1: For row, col and len, a value of ‘=’ means the value of the current row col or len as set by <a class="reference internal" href="#ug-set-screen-position"><span class="std std-ref">“SET$ SCREEN-POSITION”</span></a>.</p>
<p>Note 2: If the variable being tested does not exist, it is not considered empty and the CASE$ branches at the ELSE=label.</p>
<p class="last">Note 3: Any number of (condition,’value’,process) parameters may be specified, within the limits set by the assembler. Use assembler conventions (non-blank in column 72 and continuation starting in column 16) to continue the statement over more than one line.</p>
</div>
<p id="index-234"><strong>CASE$ Examples</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>CASE$ &#39;VAR1&#39;,                             *
      (EQ,&#39;DIT000&#39;,MENU000),              *   : exactly equals &#39;DIT000&#39;
      (BEGIN,&#39;DIT&#39;,MENUOTH),              *   : starts with &#39;DIT&#39; ?
      ELSE=ERR999
</pre></div>
</div>
<p>Example of testing a variable with CASE$.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>* loop on a variable:

LOOP1    FOREACH$ VALUE-IN-VARIABLE,VAR=&#39;TOTO&#39;

        CASE$ CURRENT-FOREACH-VARIABLE-OF,LOOP1,(EQ,&#39;XXXX&#39;,ET1)

        COPY$ SYSTEM-TO-VARIABLE,VAR=&#39;I1&#39;,LENGTH=2,                   *
            FIELD=(VALUE-OF,CURRENT-FOREACH-INDEX),TYPE=REPLACE
        COPY$ SYSTEM-TO-VARIABLE,VAR=&#39;V1&#39;,                            *
            FIELD=(VALUE-OF,CURRENT-FOREACH-VARIABLE),TYPE=REPLACE
        ERROR$ 0,&#39;TOTO: &#39;,&#39;*I1&#39;,&#39;==&#39;,&#39;*V1&#39;
        ENDFOR$ LOOP1
</pre></div>
</div>
<p>Example of CASE$ with FOR loops.</p>
</div>
<div class="section" id="convert-instruction">
<span id="index-235"></span><h5>CONVERT$ instruction<a class="headerlink" href="#convert-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction allows a scenario to translate a VIRTEL variable to or from EBCDIC, or to convert a variable to upper or
lower case.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>CONVERT$ direction,VAR=&#39;varname&#39;,TABLE=&#39;tabname&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>direction</dt>
<dd><p class="first">specifies the translation requested. Possible values are:</p>
<ul class="last simple">
<li>ASCII-TO-EBCDIC</li>
<li>EBCDIC-TO-ASCII</li>
<li>UTF8-TO-EBCDIC</li>
<li>EBCDIC-TO-UTF8</li>
<li>EBCDIC-TO-UPPERCASE</li>
<li>EBCDIC-TO-LOWERCASE</li>
</ul>
</dd>
<dt>varname</dt>
<dd>is the name of a VIRTEL variable. The variable name must be placed in quotes.</dd>
<dt>tabname</dt>
<dd>is the name of the translate table to be used for UTF-8 conversion. The possible values are given under the description of the DEFUTF8 parameter of the VIRTCT. The table name must be placed in quotes. If the TABLE parameter is not specified, then the table specified by the DEFUTF8 parameter is used as a default. VIRTCT parameters are described in the VIRTEL Installation Guide.</dd>
</dl>
<p id="index-236"><strong>CONVERT$ Examples</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>GETGOOG  SCREENS APPL=GETGOOG
*
        SCENARIO INITIAL
*
        SET$  ENCODING,UTF-8,&#39;IBM1147&#39;
        COPY$ INPUT-TO-VARIABLE,FIELD=&#39;MYINPUT&#39;,VAR=&#39;QUESTION&#39;   * URL
        IF$      NOT-FOUND,THEN=NOSCENAR
        COPY$ OUTPUT-FILE-TO-VARIABLE,FILE=&#39;getreq.txt&#39;,         * Build req.
            VAR=&#39;QUERY&#39;
        CONVERT$ UTF8-TO-EBCDIC,VAR=&#39;QUERY&#39;,TABLE=&#39;IBM1147&#39;
*
        OPTION$ FOR-HTTP,                                        *
            (METHOD,&#39;GET&#39;),                                      *
            (TO,&#39;/search&#39;),                                      *
            (TEXT,&#39;*QUERY&#39;),                                     *  Req. variable
            (SITE,&#39;www.google.com&#39;),                             *
            (HEADER,&#39;Accept: text/html&#39;),                        *
            (FILE-IN,&#39;ANSWER&#39;),                                  *  GOOGLE Response
            (RET-CODE,&#39;HTTP-RC&#39;),                                *  Return Code
            TOVAR=&#39;MYPARMS&#39;
*
        SEND$ TO-LINE,LINE=&#39;G-GOOG&#39;,PARMS=&#39;MYPARMS&#39;,ERROR=ERRSCENAR  Call GOOGLE
*
        CONVERT$ UTF8-TO-EBCDIC,VAR=&#39;ANSWER&#39;,TABLE=&#39;IBM1147&#39;         Convert Response
        COPY$ VALUE-TO-VARIABLE,VAR=&#39;ERRORMESSAGE&#39;,              *
            VALUE=&#39;Your message was sent &#39;
        SCENARIO END
*
ERRSCENAR EQU   *
        COPY$ VALUE-TO-VARIABLE,VAR=&#39;ERRORMESSAGE&#39;,              *
            VALUE=&#39;Sorry, your message could NOT be sent &#39;
        ERROR$ 1
*
NOSCENAR  EQU   *
        SCENARIO END
*
        SCRNEND
        END    ,
</pre></div>
</div>
<p>Example of CONVERT$ in a scenario</p>
<span class="target" id="ug-copy"></span></div>
<div class="section" id="copy-instruction">
<span id="index-237"></span><h5>COPY$ instruction<a class="headerlink" href="#copy-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction allows various copy operations within the context of a scenario.</p>
<p id="index-238"><strong>COPY$ FIELD-NAME-TO-VARIABLE</strong></p>
<p>Copies the name of an HTTP input field into a VIRTEL variable.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ FIELD-NAME-TO-VARIABLE,SCREEN=(row,col),VAR=&#39;name2&#39;,TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>row,col</dt>
<dd>starting row and column of the field on the screen.</dd>
<dt>name2</dt>
<dd>the name of a VIRTEL table variable. If the variable does not exist, it will be created.</dd>
<dt>type</dt>
<dd><p class="first">(optional) may indicate one of the following values:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>TYPE=REPLACE</dt>
<dd>indicates that the new value will replace the existing value of the variable. If TYPE=REPLACE is not specified, and the variable already exists, the new value will be appended to any existing values.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p id="index-239"><strong>COPY$ INPUT-FILE-TO-VARIABLE</strong></p>
<p>Copies the contents of a file into a VIRTEL variable. This instruction can be used in an input scenario which processes an HTTP request or SMTP input message having one or more attached files.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ INPUT-FILE-TO-VARIABLE,VAR=&#39;varname&#39;,FILE=&#39;filename&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>varname</dt>
<dd>the name of a VIRTEL table variable. If the variable does not exist, it will be created. If the variable already exists, the new value will be appended to any existing values. If this parameter is omitted, the variable name $INFILE$ is used.</dd>
<dt>filename</dt>
<dd>the name of a file attached to the HTTP request or SMTP message. If this parameter is omitted, the first attached file will be read.</dd>
</dl>
<p>If the input request does not contain the requested file, the NOT-FOUND condition will be raised. This condition can be tested by means of the <a class="reference internal" href="#ug-if"><span class="std std-ref">“IF$ instruction”</span></a>.</p>
<p id="index-240"><strong>COPY$ INPUT-TO-SCREEN</strong></p>
<p>Copies the value of an HTTP query parameter to a given position on the 3270 screen.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ INPUT-TO-SCREEN,FIELD=&#39;name1&#39;,SCREEN=(row,col,len),TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>name1</dt>
<dd>the name of an HTTP query parameter (see <a class="reference internal" href="#ug-url-formats"><span class="std std-ref">“VIRTEL URL formats”</span></a>)</dd>
<dt>row,col,len</dt>
<dd>row, column, and length of the destination field on the screen.</dd>
<dt>type</dt>
<dd><p class="first">(optional) may indicate one of the following values:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>TYPE=ERASE-FIELD</dt>
<dd>indicates that the destination field is cleared to nulls before copying the data.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>If the parameter name1 is not present in the input request, the NOT-FOUND condition will be raised. This condition can be tested by means of the <a class="reference internal" href="#ug-if"><span class="std std-ref">“IF$ instruction”</span></a>.</p>
<p>If the destination row and column specify a protected field of the 3270 screen, the scenario terminates abnormally and message VIRS129E is issued to the system console. If the destination field is unprotected but the input value is too long for the field, the data will be silently truncated.</p>
<p id="index-241"><strong>COPY$ INPUT-TO-VARIABLE</strong></p>
<p>Copies the value of an HTTP query parameter into a VIRTEL variable.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ INPUT-TO-VARIABLE,FIELD=&#39;name1&#39;,VAR=&#39;name2&#39;,TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>name1</dt>
<dd>the name of an HTTP query parameter (see <a class="reference internal" href="#ug-url-formats"><span class="std std-ref">“VIRTEL URL formats”</span></a>)</dd>
<dt>name2</dt>
<dd>the name of a VIRTEL table variable. If the variable does not exist, it will be created.</dd>
<dt>type</dt>
<dd><p class="first">(optional) may indicate one of the following values:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>TYPE-OFFSET-LENGTH</dt>
<dd>indicates that the input parameter consists of two numeric values separated by a comma. The first numeric value is converted to binary and stored in the first 8 bytes of the result variable, and the second numeric value is converted to binary and stored in the next 4 bytes of the result variable. The 12-byte value thus produced is in the format required by the OFFAREA parameter for the read-partial and write-append functions of the VIRSVFIO service program.</dd>
<dt>TYPE=REPLACE</dt>
<dd>indicates that the new value will replace the existing value of the variable. If TYPE=REPLACE is not specified, and the variable already exists, the new value will be appended to any existing values. If the parameter name1 is not present in the input request, the NOT-FOUND condition will be raised. This condition can be tested by means of the <a class="reference internal" href="#ug-if"><span class="std std-ref">“IF$ instruction”</span></a>.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p id="index-242"><strong>COPY$ LIST-TO-VARIABLE</strong></p>
<p>Copies a a list of values (either constants or variables) to a variable.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ LIST-TO-VARIABLE,VAR=&#39;varname&#39;,
    LIST=(STRING,&#39;string&#39;,VARIABLE,&#39;fromvar&#39;,&#39;string&#39;,&#39;*fromvar&#39;),
    LTRIM=(&#39;string1&#39;,&#39;string2&#39;,...),
    RTRIM=(&#39;string1&#39;,&#39;string2&#39;,...),
    TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>varname</dt>
<dd>the name of a VIRTEL table variable. If the variable does not exist, it will be created.</dd>
<dt>string</dt>
<dd>characters to be copied into the variable varname.</dd>
<dt>fromvar</dt>
<dd>the name of a variable whose value is to be copied into the variable varname.</dd>
<dt>LTRIM</dt>
<dd><p class="first">(optional) Removes a set of characters from the start of a list variable (see Note) before copying it).</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>‘string1’ [,’string2’, …]</dt>
<dd>one or more strings of text to be removed from the start of the variable.</dd>
</dl>
</div></blockquote>
</dd>
<dt>RTRIM</dt>
<dd><p class="first">(optional) Removes a set of characters from the end of a list variable (see Note) before copying it.</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>‘string1’ [,’string2’, …]</dt>
<dd>one or more strings of text to be removed from the end of the variable.</dd>
</dl>
</div></blockquote>
</dd>
<dt>type</dt>
<dd><p class="first">(optional) may indicate one of the following values:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>TYPE=REPLACE</dt>
<dd>indicates that the new value will replace the existing value of the variable. If TYPE=REPLACE is not specified, and the variable already exists, the new value will be appended to any existing values.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">LTRIM and RTRIM only apply to variables. In the following example</p>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ LIST-TO-VARIABLE,VAR=&#39;VAR1&#39;, *
RTRIM=(&#39;_&#39;,&#39; &#39;),LTRIM=(&#39;_&#39;,&#39; &#39;), *
LIST=(&#39;string1&#39;,&#39;*var1&#39;,VARIABLE,&#39;var2&#39;)
</pre></div>
</div>
<p>The variable VAR1 is created/modified, with ‘string1’ copied as is, var1 and var2 left and right trimmed.</p>
<p id="index-243"><strong>COPY$ OUTPUT-FILE-TO-VARIABLE</strong></p>
<p>Generates an output page from a page template, and copies the result into a VIRTEL variable. Any VIRTEL tags within the page template are processed as if the page were being generated as the response to an HTTP request, but the generated page is placed in a variable instead of being sent to the terminal.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ OUTPUT-FILE-TO-VARIABLE,FILE=&#39;filename&#39;,VAR=&#39;varname&#39;,
    TYPE=type
COPY$ OUTPUT-FILE-TO-VARIABLE,FILE=&#39;*filenameVar&#39;,VAR=&#39;varname&#39;,
    TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>filename</dt>
<dd>the name of the page template.</dd>
<dt>*filenameVar</dt>
<dd>the name of a VIRTEL variable holding the name of the page template.</dd>
<dt>varname</dt>
<dd>the name of a VIRTEL table variable which will receive the contents of the generated output page. If the variable does not exist, it will be created. If the variable already exists, the new value will be appended to any existing values.</dd>
<dt>type</dt>
<dd><p class="first">(optional) indicates that the result variable has a special format. The following values are possible:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>TYPE=ASCII</dt>
<dd>indicates that the result should be converted to ASCII (or UTF-8 if the SET-OUTPUT-ENCODING-UTF-8 tag is present in the page template). This is the default value if the HTTP request is in ASCII.</dd>
<dt>TYPE=EBCDIC</dt>
<dd>indicates that the result should be converted to EBCDIC. This is the default value if the HTTP request is in EBCDIC.</dd>
<dt>TYPE=LINEBUFFER</dt>
<dd><p class="first">indicates that the result should be converted to MakePDF “LINEBUF” format for input to the VIRSVPDF service program. The page template contains special tags (see <a class="reference internal" href="#ug-pdf-output"><span class="std std-ref">“Generating PDF output”</span></a>) which are converted to the format required by MakePDF.</p>
<p class="last">If the specified file does not exist in the current VIRTEL directory, the NOT-FOUND condition will be raised. This condition can be tested by means of the <a class="reference internal" href="#ug-if"><span class="std std-ref">“IF$ instruction”</span></a>.</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p id="index-244"><strong>COPY$ SCREEN-TO-VARIABLE</strong></p>
<p>Copies a portion of the screen into a table variable.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ SCREEN-TO-VARIABLE,SCREEN=(row,col,len,ht),VAR=&#39;name2&#39;,TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>row</dt>
<dd>starting row of the portion of the screen to copy (see Note 1).</dd>
<dt>col</dt>
<dd>starting column of the portion of the screen to copy (see Note 1).</dd>
<dt>len</dt>
<dd>width (in columns) of the portion of the screen to copy (see Note 1).</dd>
<dt>ht</dt>
<dd>height (in rows) of the portion of the screen to copy (see Note 2).</dd>
<dt>name2</dt>
<dd>the name of a VIRTEL table variable containing ht values, each of length len. If the variable does not exist, it will be created.</dd>
<dt>type</dt>
<dd><p class="first">(optional) may indicate one of the following values:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>TYPE=REPLACE</dt>
<dd>indicates that the new value will replace the existing value of the variable. If TYPE=REPLACE is not specified, and the variable already exists, the new value will be appended to any existing values.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Note 1: for row, col and len, a value of ‘=’ means the value of the current row, col or len as set by <a class="reference internal" href="#ug-set-screen-position"><span class="std std-ref">“SET$ SCREEN-POSITION”</span></a>.</p>
<p class="last">Note 2: the fourth sub-parameter (ht) of the SCREEN parameter is optional. If the fourth sub-parameter is specified, then attributes and binary zeroes will be replaced by blanks. To keep compatibility with existing scenarios, the instruction will ignore attributes and binary zeroes if the fourth SCREEN sub-parameter is NOT specified.</p>
</div>
<p id="index-245"><strong>COPY$ SYSTEM-TO-VARIABLE</strong></p>
<p>Copies a system information field into a table variable.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ SYSTEM-TO-VARIABLE,FIELD=(class,item),
VAR=&#39;varname&#39;,LENGTH=len,OFFSET=offset,
TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>varname</dt>
<dd>the name of a VIRTEL table variable into which the system information will be copied.</dd>
<dt>class</dt>
<dd>the type of system information to be copied. The following values may be specified for class:</dd>
<dt>HTTP-HEADER</dt>
<dd>Information extracted from an HTTP header in the incoming HTTP request is copied into the specified variable. When HTTP-HEADER is specified, item represents one of the HTTP headers listed below.</dd>
<dt>TCT-HTTP-HEADER</dt>
<dd>Information extracted from an HTTP header in the incoming HTTP request is copied into the specified variable. When TCT-HTTP-HEADER is specified, item represents one of the HTTP headers specified in the HTHEADR parameter in the VIRTCT (refer to “Parameters of the VIRTCT” in the VIRTEL Installation Guide for more information).</dd>
<dt>NAME-OF</dt>
<dd>Information about the VIRTEL environment is copied to the table variable. When NAME-OF is specified, item represents the name of a VIRTEL data item.</dd>
<dt>NUMBER-OF</dt>
<dd>A numeric value is copied to the table variable. When NUMBER-OF is specified, item represents the name of a VIRTEL numeric data item.</dd>
<dt>VALUE-OF</dt>
<dd>Information about the VIRTEL environment is copied to the table variable. When VALUE-OF is specified, item represents the name of a VIRTEL data item. VALUE-OF is synonymous with NAME-OF.</dd>
<dt>USER-SECURITY-PROFILE</dt>
<dd>Information from the user’s RACF profile is copied to the table variable. When USER-SECURITY-PROFILE is specified, item represents the name of a field in the RACF user profile. The supported fields are listed below.</dd>
<dt>NEW-PASSTICKET-FOR-TRANSACTION</dt>
<dd>Generate a PassTicket allowing the current USERID. If the generation fails, the NOT-FOUND condition will be raised. This condition can be tested by means of the <a class="reference internal" href="#ug-if"><span class="std std-ref">“IF$ instruction”</span></a>.</dd>
<dt>item</dt>
<dd>When class is HTTP-HEADER, the following standard HTTP headers, described in RFC2616, may be specified:</dd>
</dl>
<ul class="simple">
<li>ACCEPT</li>
<li>ACCEPT-LANGUAGE</li>
<li>CONNECTION</li>
<li>CONTENT-TYPE</li>
<li>IF-MODIFIED-SINCE</li>
<li>HOST</li>
<li>USER-AGENT</li>
</ul>
<p>In addition, the following non-standard HTTP headers, described in the IBM Tivoli Access Manager WebSEAL Administration Guide manual, may be specified:</p>
<ul class="simple">
<li>IV-USER</li>
<li>IV-USERL</li>
<li>IV-GROUPS</li>
<li>IV-CREDS</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">IV headers provide reliable user identification only when the request comes from a trusted proxy. The proxy IP address can be specified in the “Calling DTE” field of a rule attached to the HTTP line. See the “Rules” chapter of the VIRTEL Configuration Reference manual for further information.</p>
</div>
<dl class="docutils">
<dt><strong>NAME-OF or VALUE-OF Item list</strong></dt>
<dd><dl class="first last docutils">
<dt>The following VIRTEL data items may be specified:</dt>
<dd><dl class="first docutils">
<dt>CHARACTER-SET</dt>
<dd>The name of the current UTF-8 character set, or the country code if the page is not in UTF-8 mode (see <a class="reference internal" href="#ug-ebcdic-translation"><span class="std std-ref">“EBCDIC translation management”</span></a>)</dd>
<dt>CURRENT-FOREACH-INDEX</dt>
<dd>Value of the current index in a FOREACH loop.</dd>
<dt>CURRENT-FOREACH-VARIABLE</dt>
<dd>Value of the variable at current index in a FOREACH loop (see <a class="reference internal" href="#ug-foreach-variable"><span class="std std-ref">“FOREACH$ VALUE-IN-VARIABLE”</span></a>).</dd>
</dl>
<p>CURRENT-LINE</p>
<p>CURRENT-COLUMN</p>
<p>CURRENT-LENGTH</p>
<dl class="last docutils">
<dt>CURRENT-HEIGHT</dt>
<dd>The current values of the named field in the <a class="reference internal" href="#ug-set-screen-position"><span class="std std-ref">“SET$ SCREEN-POSITION”</span></a>.</dd>
<dt>DATE-TIME</dt>
<dd>The current date and time (14 characters in the format YYYYMMDDHHMMSS)</dd>
<dt>DIRECTORY</dt>
<dd>The current VIRTEL directory name</dd>
<dt>ENTRY-POINT</dt>
<dd>The VIRTEL entry point name</dd>
<dt>LINE-INTERNAL</dt>
<dd>The internal name of the VIRTEL line</dd>
<dt>LINE-EXTERNAL</dt>
<dd>The external name of the VIRTEL line</dd>
<dt>PAGE</dt>
<dd>The name of the original HTML page template specified in the URL</dd>
<dt>PASSWORD</dt>
<dd>The password entered during signon</dd>
<dt>PRINT-RELAY</dt>
<dd>The relay LU name of the associated printer</dd>
<dt>PSEUDO-TERMINAL</dt>
<dd>The VIRTEL terminal name</dd>
<dt>QUERY</dt>
<dd>The query string from the URL</dd>
<dt>RELAY</dt>
<dd>The relay LU name used to connect to the host application</dd>
<dt>ROUTING-PARAMETER</dt>
<dd>The value specified in the userdata field of the URL or call packet</dd>
<dt>SNA-STATUS</dt>
<dd><dl class="first last docutils">
<dt>The status of the host LU2 session:</dt>
<dd><dl class="first last docutils">
<dt>X</dt>
<dd>input is inhibited</dd>
<dt>blank</dt>
<dd>input is allowed</dd>
</dl>
</dd>
</dl>
</dd>
<dt>TRANSACTION-INTERNAL</dt>
<dd>The internal name of the VIRTEL transaction</dd>
<dt>TRANSACTION-EXTERNAL</dt>
<dd>The external name of the VIRTEL transaction</dd>
<dt>URL</dt>
<dd>The URL excluding the query string</dd>
<dt>USER</dt>
<dd>The user name, if signon has occurred</dd>
<dt>USER-IP-ADDRESS</dt>
<dd>The IP address of the client terminal</dd>
<dt>VIRTEL</dt>
<dd>The VIRTEL APPLID specified in the VIRTCT</dd>
<dt>VIRTEL-VERSION</dt>
<dd>The VIRTEL version number</dd>
<dt>xxx-SYMBOL</dt>
<dd>The value of the system symbol xxx (only if SYSPLUS=YES is specified in the VIRTCT). Example: SYSNAME-SYMBOL</dd>
</dl>
</dd>
</dl>
</dd>
<dt><strong>NUMBER-OF Item list</strong></dt>
<dd><dl class="first last docutils">
<dt>The following VIRTEL numeric data items may be specified:</dt>
<dd><dl class="first last docutils">
<dt>SCREEN-COLUMNS</dt>
<dd>The width of the current host 3270 screen</dd>
<dt>SCREEN-LINES</dt>
<dd>The depth of the current host 3270 screen</dd>
</dl>
</dd>
</dl>
</dd>
<dt><strong>USER-SECURITY-PROFILE Item list</strong></dt>
<dd><dl class="first last docutils">
<dt>The following RACF field names may be specified:</dt>
<dd><dl class="first last docutils">
<dt>USERID</dt>
<dd>The signed-on user id</dd>
<dt>GROUP</dt>
<dd>The group to which the user belongs</dd>
<dt>WANAME</dt>
<dd>User name for SYSOUT</dd>
<dt>WABLDG</dt>
<dd>Building name for delivery</dd>
<dt>WADEPT</dt>
<dd>Department name for delivery</dd>
<dt>WAROOM</dt>
<dd>Room for delivery</dd>
<dt>WAADDR1</dt>
<dd>Address line 1</dd>
<dt>WAADDR2</dt>
<dd>Address line 2</dd>
<dt>WAADDR3</dt>
<dd>Address line 3</dd>
<dt>WAADDR4</dt>
<dd>Address line 4</dd>
<dt>WAACCNT</dt>
<dd>Account number</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">USER-SECURITY-PROFILE information is available only if the user has signed on and SECUR=(RACROUTE,RACF) has been specified in the VIRTCT. Otherwise null values are returned for all fields.</p>
</div>
<dl class="docutils">
<dt>len</dt>
<dd>(optional) the variable will be padded or truncated to the specified length. Alphanumeric data items are right-padded with blanks or truncated on the right. Numeric items are left-padded with zeroes on the left. The maximum length for a numeric item is 8. If the LENGTH parameter is omitted, the length of the variable will be equal to the length of the requested value.</dd>
<dt>item</dt>
<dd>(optional) the variable will be padded or truncated to the specified length. Alphanumeric data items are right-padded with blanks or truncated on the right. Numeric items are left-padded with zeroes on the left. The maximum length for a numeric item is 8. If the LENGTH parameter is omitted, the length of the variable will be equal to the length of the requested value.</dd>
<dt>offset</dt>
<dd>(optional) the starting offset within the data item from which to extract the information to be placed in the variable. If omitted, extraction starts from offset 0. This parameter is valid only when class is USER-SECURITY-PROFILE.</dd>
<dt>type</dt>
<dd><p class="first">(optional) may indicate one of the following values:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>TYPE=REPLACE</dt>
<dd>indicates that the new value will replace the existing value of the variable. If TYPE=REPLACE is not specified, and the variable already exists, the new value will be appended to any existing values.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>Example of COPY$ SYSTEM-TO-VARIABLE:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ SYSTEM-TO-VARIABLE,FIELD=(HTTP-HEADER,HOST),             X
    VAR=&#39;HOST&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(HTTP-HEADER,USER-AGENT),       X
    VAR=&#39;BROWSER&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,VIRTEL),               X
    VAR=&#39;APPLID&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,LINE-INTERNAL),        X
    VAR=&#39;LINEINT&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,PSEUDO-TERMINAL),      X
    VAR=&#39;TERMID&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,RELAY),                X
    VAR=&#39;LUNAME&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,ENTRY-POINT),          X
    VAR=&#39;EPNAME&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,TRANSACTION-INTERNAL), X
    VAR=&#39;TRANINT&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,TRANSACTION-EXTERNAL), X
    VAR=&#39;TRANEXT&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,ROUTING-PARAMETER),    X
    VAR=&#39;ROUTPARM&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,URL),                  X
    VAR=&#39;URL&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,QUERY),                X
    VAR=&#39;QSTRING&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,PAGE),                 X
    VAR=&#39;pagename&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,DIRECTORY),            X
    VAR=&#39;DIRNAME&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,SNA-STATUS),           X
    VAR=&#39;SNASTAT&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,USER-IP-ADDRESS),      X
    VAR=&#39;CLIENT&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NAME-OF,CHARACTER-SET),        X
    VAR=&#39;CHARSET&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,DATE-TIME),           X
    VAR=&#39;DATETIME&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,VIRTEL-VERSION),      X
    VAR=&#39;VERSION&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,SYSNAME-SYMBOL),      X
    VAR=&#39;SYSNAME&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,SYSPLEX-SYMBOL),      X
    VAR=&#39;SYSPLEX&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NUMBER-OF,SCREEN-COLUMNS),     X
    VAR=&#39;COLS&#39;
COPY$ SYSTEM-TO-VARIABLE,FIELD=(NUMBER-OF,SCREEN-LINES),       X
    VAR=&#39;ROWS&#39;
COPY$ SYSTEM-TO-VARIABLE,                                      X
    FIELD=(USER-SECURITY-PROFILE,WADEPT),                      X
    VAR=&#39;DEPT’
</pre></div>
</div>
<p>The following table shows a possible result of this example scenario when used in conjunction with the URL:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://192.168.235.30:41001/w2h/WEB2AJAX.htm+Tso+model2?u=rxb&amp;g=sys1
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" rowspan="2">Variable</th>
<th class="head" rowspan="2">Value</th>
</tr>
<tr class="row-even"></tr>
</thead>
<tbody valign="top">
<tr class="row-odd"><td>HOST</td>
<td>“192.168.235.30:41001”</td>
</tr>
<tr class="row-even"><td>BROWSER</td>
<td>“Mozilla/5.0 (Windows) Gecko/20070219 Firefox/2.0.0.2”</td>
</tr>
<tr class="row-odd"><td>APPLID</td>
<td>“VIRTEL”</td>
</tr>
<tr class="row-even"><td>LINEINT</td>
<td>“W-HTTP”</td>
</tr>
<tr class="row-odd"><td>TERMID</td>
<td>“DEVTA003”</td>
</tr>
<tr class="row-even"><td>LUNAME</td>
<td>“RHTVT000”</td>
</tr>
<tr class="row-odd"><td>EPNAME</td>
<td>“WEB2HOST”</td>
</tr>
<tr class="row-even"><td>TRANINT</td>
<td>“W2H-13”</td>
</tr>
<tr class="row-odd"><td>TRANEXT</td>
<td>“Tso”</td>
</tr>
<tr class="row-even"><td>ROUTPARM</td>
<td>“model2”</td>
</tr>
<tr class="row-odd"><td>URL</td>
<td>“/w2h/WEB2AJAX.htm+Tso+model2”</td>
</tr>
<tr class="row-even"><td>QSTRING</td>
<td>“u=rxb&amp;g=sys1”</td>
</tr>
<tr class="row-odd"><td>pagename</td>
<td>“WEB2AJAX.htm”</td>
</tr>
<tr class="row-even"><td>DIRNAME</td>
<td>“W2H-DIR”</td>
</tr>
<tr class="row-odd"><td>SNASTAT</td>
<td>” “</td>
</tr>
<tr class="row-even"><td>CLIENT</td>
<td>“192.168.000.049”</td>
</tr>
<tr class="row-odd"><td>CHARSET</td>
<td>“IBM1140”</td>
</tr>
<tr class="row-even"><td>DATETIME</td>
<td>“20110731093522”</td>
</tr>
<tr class="row-odd"><td>VERSION</td>
<td>“4.57 “</td>
</tr>
<tr class="row-even"><td>SYSNAME</td>
<td>“MVSPROD1”</td>
</tr>
<tr class="row-odd"><td>SYSPLEX</td>
<td>“PRODPLEX”</td>
</tr>
<tr class="row-even"><td>COLS</td>
<td>“80”</td>
</tr>
<tr class="row-odd"><td>ROWS</td>
<td>“24”</td>
</tr>
<tr class="row-even"><td>DEPT</td>
<td>“SYSPROG”</td>
</tr>
</tbody>
</table>
<p id="index-246"><strong>COPY$ VALUE-TO-SCREEN</strong></p>
<p>Copies a constant value to a given position on the 3270 screen.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ VALUE-TO-SCREEN,VALUE=&#39;string&#39;,SCREEN=(row,col,len),TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>string</dt>
<dd>characters to be copied to the screen.</dd>
<dt>row,col,len</dt>
<dd>row, column, and length of the destination field on the screen.</dd>
<dt>type</dt>
<dd><dl class="first last docutils">
<dt>(optional) may indicate one of the following values:</dt>
<dd><dl class="first last docutils">
<dt>TYPE=ERASE-FIELD</dt>
<dd>indicates that the destination field is cleared to nulls before copying the data.</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p>If the destination row and column specify a protected field of the 3270 screen, the scenario terminates abnormally and message VIRS129E is issued to the system console. If the destination field is unprotected but the string is too long for the field, the string will be silently truncated.</p>
<p id="index-247"><strong>COPY$ VALUE-TO-VARIABLE</strong></p>
<p>Copies a constant value to a variable.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ VALUE-TO-VARIABLE,VALUE=&#39;string&#39;,VAR=&#39;name2&#39;,TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>string</dt>
<dd>characters to be copied into the variable name2.</dd>
<dt>name2</dt>
<dd>the name of a VIRTEL table variable. If the variable does not exist, it will be created.</dd>
<dt>type</dt>
<dd><p class="first">(optional) may indicate one of the following values:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>TYPE=REPLACE</dt>
<dd>indicates that the new value will replace the existing value of the variable. If TYPE=REPLACE is not specified, and the variable already exists, the new value will be appended to any existing values.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>The COPY$ VALUE-TO-VARIABLE instruction allows the DUP (X‘1C’) and FM (X‘1E’) characters to be included in the value of a variable which can subsequently be referenced by the COPY$ VARIABLE-TO-SCREEN instruction.</p>
<p>The following example shows the instructions required to place FIELD MARK (X‘1E’) followed by W (X’E6’) at the cursor position and press ENTER:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ VALUE-TO-VARIABLE,VAR=&#39;FIELDMARK-W&#39;,TYPE=REPLACE,                    *
        VALUE=X&#39;1EE6&#39;
COPY$ VARIABLE-TO-SCREEN,VAR=&#39;FIELDMARK-W’
ACTION$ TO-APPLICATION,KEY=7D
</pre></div>
</div>
<p id="index-248"><strong>COPY$ VARIABLE-TO-SCREEN</strong></p>
<p>Copies the value of a variable to a given position on the 3270 screen. In the case of a table variable, only the first value is copied.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ VARIABLE-TO-SCREEN,VAR=&#39;name2&#39;,SCREEN=(row,col,len),TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>name2</dt>
<dd>the name of a VIRTEL variable.</dd>
<dt>row,col,len</dt>
<dd>row, column, and length of the destination field on the screen. If the SCREEN parameter is not specified, the variable will be copied to the current cursor position. For row, col and len, a value of ‘=’ means the value of the current row, col or len as set by <a class="reference internal" href="#ug-set-screen-position"><span class="std std-ref">“SET$ SCREEN-POSITION”</span></a>.</dd>
<dt>type</dt>
<dd><p class="first">(optional) may indicate one of the following values:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>TYPE=ERASE-FIELD</dt>
<dd>indicates that the destination field is cleared to nulls before copying the data. If the variable name2 does not exist, the NOT-FOUND condition will be raised. This condition can be tested by means of the <a class="reference internal" href="#ug-if"><span class="std std-ref">“IF$ instruction”</span></a>. If the destination row and column specify a protected field of the 3270 screen, the scenario terminates abnormally and message VIRS129E is issued to the system console. If the destination field is unprotected but the variable value is too long for the field, the data will be silently truncated.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p id="index-249"><strong>COPY$ VARIABLE-TO-SYSTEM</strong></p>
<p>Copies the value of a variable to a VIRTEL system field. In the case of a table variable, only the first value is copied.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ VARIABLE-TO-SYSTEM,VAR=&#39;varname&#39;,FIELD=(class,item)
</pre></div>
</div>
<dl class="docutils">
<dt>varname</dt>
<dd>the name of a VIRTEL variable.</dd>
<dt>class</dt>
<dd><p class="first">identifies the type of VIRTEL system field to be updated. The following values may be specified:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>NAME-OF</dt>
<dd>A VIRTEL data item is to be updated. When NAME-OF is specified, item represents the name of a VIRTEL data item.</dd>
<dt>NUMBER-OF</dt>
<dd>A VIRTEL data item is to be updated. When NUMBER-OF is specified, item represents the name of a VIRTEL numeric data item.</dd>
<dt>VALUE-OF</dt>
<dd>A VIRTEL data item is to be updated. When VALUE-OF is specified, item represents the name of a VIRTEL data item. VALUE-OF is synonymous with NAME-OF.</dd>
<dt>OLD-PASSTICKET-FOR-TRANSACTION</dt>
<dd>Evaluates the Passticket currently in ‘varname’ for the transaction ‘item’. If the evaluation fails, the NOT-FOUND condition will be raised. This condition can be tested by means of the <a class="reference internal" href="#ug-if"><span class="std std-ref">“IF$ instruction”</span></a>.</dd>
</dl>
</div></blockquote>
</dd>
<dt>item</dt>
<dd><p class="first">When class is NAME-OF or VALUE-OF, the following VIRTEL data items may be specified:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>DIRECTORY</dt>
<dd>Allows a scenario to specify the name of the VIRTEL directory The user name which will appear in the VIRLOG entry for this transaction.</dd>
<dt>USER</dt>
<dd>Allows a scenario to specify the user name which will appear in the VIRLOG entry for this transaction and which will become the value of the system variable &amp;U (see “Connection/disconnection scripts” in the VIRTEL Connectivity Guide).</dd>
<dt>PASSWORD</dt>
<dd>Allows a scenario to specify the password which will become the value of the system variable &amp;P (see “Connection/disconnection scripts” in the VIRTEL Connectivity Guide).</dd>
<dt>LOGMODE</dt>
<dd>The name of the logmode to be used for the VTAM session with the host application. The logmode can be set in an Identification Scenario. It overrides the logmode specified in the terminal definition. It <strong>does not</strong> override any logmode specified in the transaction definition.</dd>
<dt>ROUTING-PARAMETER</dt>
<dd>Allows an Identification Scenario to override the value of the routing parameter specified in the userdata field of the URL (see <a class="reference internal" href="#ug-url-formats"><span class="std std-ref">“Virtel URL formats”</span></a>).</dd>
<dt>RELAY</dt>
<dd>Allows a identification Scenarion to override the value of the relay LU name used to connect to the host application.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>When class is NUMBER-OF, the following VIRTEL data items may be specified:</p>
<blockquote>
<div><dl class="docutils">
<dt>SCREEN-COLUMNS</dt>
<dd><p class="first">The alternate width (number of columns) of the 3270 screen SCREEN-LINES.</p>
<p class="last">The alternate depth (number of rows) of the 3270 screen SCREEN-COLUMNS and SCREEN-LINES can be set in an Identification Scenario. These parameters allow the scenario to specify the desired screen size when a dynamic logmode such as D4A32XX3 is used and the host application places the 3270 session in alternate mode using the Erase Write Alternate command. This command has no effect on the primary screen size which is always 24 rows by 80 columns.</p>
</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt>item</dt>
<dd><p class="first">When class is OLD-PASSTICKET-FOR-TRANSACTION, the following VIRTEL data item must be specified:</p>
<blockquote class="last">
<div>TSO
To validate the PassTicket for TSO</div></blockquote>
</dd>
</dl>
<p id="index-250"><strong>COPY$ VARIABLE-TO-VARIABLE</strong></p>
<p>Copies a source variable to a target variable.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ VARIABLE-TO-VARIABLE,VAR=(&#39;source&#39;,&#39;target&#39;),
      OFFSET=offset,LENGTH=lend,PAD=&#39;padChar &#39;,TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>source</dt>
<dd>characters to be copied into the target variable.</dd>
<dt>target</dt>
<dd>the name of a VIRTEL table variable. If the variable does not exist, it will be created.</dd>
<dt>offset</dt>
<dd>(optional) the beginning index (defaulting to 0), inclusive, of the text to copy in source.</dd>
<dt>len</dt>
<dd>(optional) the number of characters to copy.</dd>
<dt>padChar</dt>
<dd>(optional) the character (defaulting to space) to pad target var, if length is longer than the source..</dd>
<dt>type</dt>
<dd>(optional) indicates that the new value will replace the existing value of the variable. If TYPE=REPLACE is not specified, and the variable already exists, the new value will be appended to any existing values.</dd>
</dl>
<p>The following example will display ‘Target value is : Doe____’</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ VALUE-TO-VARIABLE,VAR=&#39;source&#39;,VALUE=&#39;John Doe&#39;
COPY$ VARIABLE-TO-VARIABLE,VAR=(&#39;source&#39;,&#39;target&#39;),OFFSET=5,                    X
        LENGTH=7,PAD=&#39;_&#39;
ERROR$ 0,&#39;Target value is : &#39;,&#39;*target&#39;
</pre></div>
</div>
<p><strong>COPY$ Example</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    SCENSITE SCREENS APPL=SCENSITE,EXEC=NO
*
* SCENARIO for SiteMinder
*
* The purpose of this scenario is to retrieve the contents of
* the identification headers inserted by the SiteMinder Proxy
*
    SCENARIO IDENTIFICATION
*
    COPY$ SYSTEM-TO-VARIABLE,VAR=&#39;USER&#39;, -
        FIELD=(TCT-HTTP-HEADER,SM_USER)
    IF$ NOT-FOUND,THEN=NOUSER1
    COPY$ VARIABLE-TO-SYSTEM,VAR=&#39;USER&#39;, -
        FIELD=(NAME-OF,USER)
*
EXIT1 DS 0H
    SCENARIO END
*
NOUSER1 DS 0H
    ERROR$ 0,&#39;SCENSITE ERROR: NO USER VARIABLE&#39;
GOTO$ EXIT1
    SCRNEND
    END
</pre></div>
</div>
<p>Example scenario with COPY$</p>
</div>
<div class="section" id="debug-instruction">
<span id="index-251"></span><h5>DEBUG$ instruction<a class="headerlink" href="#debug-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction allows a scenario to activate various debugging functions.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DEBUG$ [NO]TRACE,LINE|TERMINAL|SCENARIO,
        WHEN=(TRANSACTION-NAME-STARTS-WITH,&#39;prefix&#39;)|ALWAYS
DEBUG$ SNAP[,TERMINAL],
        WHEN=(TRANSACTION-NAME-STARTS-WITH,&#39;prefix&#39;)|ALWAYS
</pre></div>
</div>
<dl class="docutils">
<dt>TRACE,LINE or NOTRACE,LINE</dt>
<dd>Starts or stops a trace on the current line. The trace is written to the VIRTRACE file.</dd>
<dt>TRACE,TERMINAL or NOTRACE,TERMINAL</dt>
<dd>Starts or stops a trace on the current terminal. The trace is written to the VIRTRACE file.</dd>
<dt>TRACE,SCENARIO or NOTRACE,SCENARIO</dt>
<dd>Starts or stops a trace on the scenario. The trace is downloadable by means of the <a class="reference internal" href="#ug-create-variable-if"><span class="std std-ref">“CREATE-VARIABLE-IF”</span></a> tag intended for use by Virtel Studio.</dd>
<dt>SNAP</dt>
<dd><p class="first">Generates a snapshot of the VIRTEL internal trace table in the SYSPRINT file (same as the command F VIRTEL,SNAP).</p>
<p class="last">SNAP is described in the “Audit and Performance” chapter of the VIRTEL Messages and Operations Guide.</p>
</dd>
<dt>SNAP,TERMINAL</dt>
<dd>Generates a snapshot including terminal information (same as the command F VIRTEL,SNAP,T=termid where termid is the current terminal name).</dd>
<dt>WHEN=ALWAYS</dt>
<dd>The DEBUG$ instruction is executed unconditionally. This is the default.</dd>
<dt>WHEN=(TRANSACTION-NAME-STARTS-WITH,’prefix’)</dt>
<dd>The DEBUG$ instruction is executed only if the external name of the transaction being used begins with the characters specified by the string prefix.</dd>
</dl>
<p id="index-252"><strong>DEBUG$ Example</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    TSTSCLON SCREENS APPL=TSTSCLON    *
        SCENARIO INITIAL
        DEBUG$ TRACE,LINE,WHEN=ALWAYS
        DEBUG$ TRACE,TERMINAL
*
        DEBUG$ TRACE,SCENARIO,                                        *
            WHEN=(TRANSACTION-NAME-STARTS-WITH,&#39;DB&#39;)

        COPY$ SYSTEM-TO-VARIABLE,VAR=&#39;VAR1&#39;,                          *
            FIELD=(VALUE-OF,SYSCLONE-SYMBOL)
        ERROR$ 0,&#39;SYSCLONE: &#39;,&#39;*VAR1&#39;
        COPY$ SYSTEM-TO-VARIABLE,VAR=&#39;VAR1&#39;,                          *
            FIELD=(VALUE-OF,SYSPLEX-SYMBOL)
        ERROR$ 0,&#39;SYSPLEX: &#39;,&#39;*VAR1&#39;
*
        COPY$ SYSTEM-TO-VARIABLE,VAR=&#39;VAR1&#39;,                          *
            FIELD=(NAME-OF,CHARACTER-SET)
        ERROR$ 0,&#39;CHARACTER-SET: &#39;,&#39;*VAR1&#39;
        DEBUG$ NOTRACE,SCENARIO
        DEBUG$ SNAP,TERMINAL
        SCENARIO END
        SCRNEND
        END    ,
</pre></div>
</div>
<p>Example scenario with DEBUG$</p>
</div>
<div class="section" id="declare-instruction">
<span id="index-253"></span><h5>DECLARE$ instruction<a class="headerlink" href="#declare-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction defines a portion of the screen as a clickable hyperlink. The hyperlink can invoke either a 3270 key (ENTER or PFnn), a JavaScript procedure, or an external URL. The generation of the hyperlink can optionally be conditional on the presence or absence of a particular value at the 3270 screen position. In any case, the hyperlink is generated only if the specified screen position is non-blank.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DECLARE$ (row,col,len,&#39;value&#39;,Condition),P1,P2,P3,TO=P4
</pre></div>
</div>
<dl class="docutils">
<dt>row</dt>
<dd>Specifies the row position of the hyperlink</dd>
<dt>col</dt>
<dd>Specifies the column position of the hyperlink</dd>
<dt>len</dt>
<dd>Specifies the length of the hyperlink</dd>
<dt>value</dt>
<dd>Optional, this parameter specifies the value of the data tested at the specified screen position. Must be put in quotes</dd>
<dt>Condition</dt>
<dd><p class="first">Optional, this parameter determines the type of condition applicable to value</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>EQ</dt>
<dd>Equality (value by default).</dd>
<dt>NE</dt>
<dd>Inequality.</dd>
</dl>
</div></blockquote>
</dd>
<dt>P1</dt>
<dd>Specifies the type of processing applicable. The permissible values are:</dd>
<dt>AS-PFKEY</dt>
<dd>Indicates that the indicated portion of the screen is to be interpreted as a function key hyperlink. The value of the function key (ENTER, PF1, etc) can be specified by parameter P2. If P2 is not specified, then the data at the indicated screen position is interpreted as the name of the function key. The values allowable as function key names are the same as those for <a class="reference internal" href="#ug-pfkfield"><span class="std std-ref">“PfkField”</span></a>)</dd>
<dt>AS-PARAMETER</dt>
<dd>Indicates that the indicated portion of the screen is to be treated as a hyperlink which calls a JavaScript function. The data at the indicated screen position is passed as a parameter to the JavaScript function. The name of the JavaScript function is specified in the TO parameter of the $DECLARE instruction. See <a class="reference internal" href="#ug-javascript-functions"><span class="std std-ref">“JavaScript functions”</span></a> for further details.</dd>
<dt>AS-HREF</dt>
<dd>Indicates that the indicated portion of the screen is to be treated as a hyperlink which invokes the URL specified in the TO parameter of the $DECLARE instruction. The data at the indicated screen position is appended to the URL, followed by the contents of the P2 parameter of the $DECLARE instruction, if specified.</dd>
<dt>P2</dt>
<dd>(optional) Function parameter referenced by P1.</dd>
<dt>P3</dt>
<dd>(optional) Text to be displayed in the status bar of the browser when the mouse pointer is over the indicated screen position.</dd>
<dt>P4</dt>
<dd>Name of JavaScript function (for AS-PARAMETER) or URL (for AS-HREF).</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In conformance with assembler syntax, quotes and ampersands in the URL must be specified as double quotes and double ampersands.</p>
</div>
<span class="target" id="ug-javascript-functions"></span><p id="index-254"><strong>$DECLARE and JavaScript functions</strong></p>
<p>For the AS-PARAMETER form of the $DECLARE instruction, the TO parameter specifies the name of a JavaScript function which will be called when the user clicks on the field. The function name is case-sensitive. The following parameters are passed to the JavaScript function:</p>
<dl class="docutils">
<dt>Parameter 1</dt>
<dd>an internally generated field name</dd>
<dt>Parameter 2</dt>
<dd>the data at the indicated screen position</dd>
<dt>Parameter 3</dt>
<dd>the contents of the P2 parameter of the $DECLARE instruction</dd>
</dl>
<p>The JavaScript function itself must be defined in the HTML template page, or in an included page. The following standard functions are provided in the page js01.js delivered with VIRTEL in the W2H-DIR directory:</p>
<dl class="docutils">
<dt>VClick</dt>
<dd>Moves the cursor to the start of the clickable area and sends the indicated function key (P2 parameter) to the host application</dd>
<dt>VClick2</dt>
<dd>Copies the contents of the clickable area to the field containing the cursor and sends the indicated function key (P2 parameter) to the host application</dd>
<dt>VClick3</dt>
<dd>Copies the contents of the clickable area to the following input field and sends the indicated function key (P2 parameter) to the host application</dd>
</dl>
<p id="index-255"><strong>$DECLARE Examples</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DECLARE$ (23,19,04),AS-PFKEY
</pre></div>
</div>
<p>Row 23 column 19 length 4 becomes a clickable field. The contents of the field are treated as the name of a PF key. For example, if the field contains “PF12” then clicking on this field is equivalent to pressing the 3270 key PF12.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DECLARE$ (14,17,03),AS-PFKEY,&#39;PA2&#39;
</pre></div>
</div>
<p>Row 14 column 17 length 3 becomes a clickable field. When clicked it is the equivalent of pressing the 3270 key PA2.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DECLARE$ (24,02,04,&#39;****&#39;,NE),AS-PFKEY
</pre></div>
</div>
<p>Row 24 column 2 length 4 becomes a clickable field, unless it contains asterisks. The contents of the field are treated as the name of a PF key.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DECLARE$ (20,02,06),AS-PARAMETER,&#39;PF12&#39;,TO=VClick
</pre></div>
</div>
<p>Row 20 column 2 length 6 becomes a clickable field. It calls the JavaScript function VClick(‘Vxxxxxxx’,’cccccc’,’PF12’) where Vxxxxxxx is an internally generated field name, cccccc is the contents of the field, and PF12 is a constant specified in the DECLARE$ instruction.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DECLARE$ (04,09,17),AS-HREF,&#39;&amp;&amp;hl=fr&#39;,                              X
    TO=&#39;http://www.google.com/search?q=&#39;
</pre></div>
</div>
<p>Row 4 column 9 length 17 becomes a clickable field, hyperlinked to the URL:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http//www.google.com/search?=ccc...ccc&amp;hl=fr
</pre></div>
</div>
<p>(where ccc…ccc is replaced by the contents of the clickable field)</p>
</div>
<div class="section" id="endfor-instruction">
<span id="index-256"></span><h5>ENDFOR$ instruction<a class="headerlink" href="#endfor-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction marks the end of a FOREACH loop.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ENDFOR$ groupname
</pre></div>
</div>
<dl class="docutils">
<dt>groupname</dt>
<dd>The label is required. It must match the label on the corresponding FOREACH$ VALUE-IN-SCREEN or FOREACH$ VALUE-IN-VARIABLE instruction.</dd>
</dl>
<p><strong>ENDFOR$ Examples</strong></p>
<p>In the example below, the value of VAR1 which is copied is the current value in the FOREACH$ loop.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>LOOP1    FOREACH$ VALUE-IN-VARIABLE,VAR=&#39;VAR1&#39;

        COPY$ VARIABLE-TO-SCREEN,VAR=&#39;VAR1&#39;,FOREACH=LOOP1,            *
            SCREEN=(=,=,=)

        COPY$ VARIABLE-TO-VARIABLE,VAR=(&#39;VAR1&#39;,&#39;VAR2&#39;),FOREACH=LOOP1, *
            OFFSET=8,LENGTH=5,PAD=&#39; &#39;


        ENDFOR$ LOOP1
</pre></div>
</div>
</div>
<div class="section" id="error-instruction">
<span id="index-257"></span><h5>ERROR$ instruction<a class="headerlink" href="#error-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction returns an error code to the calling program. When this instruction is used, the return code in the
HTTP response will be “400 Bad Request” instead of “200 Ok”.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ERROR$ value [,&#39;string1&#39;,&#39;string2&#39;,...]
</pre></div>
</div>
<dl class="docutils">
<dt>value</dt>
<dd>Specifies the error code (decimal 0 to 255). If the error code is non-zero, a message is issued to the console and the scenario returns the error code to the calling program. If the error code is zero, a message is issued to the console and the scenario continues.</dd>
<dt>‘string1’ [,’string2’, …]</dt>
<dd>(optional) one or more strings of text to be concatenated together and displayed as a message on the console. If a string begins with an asterisk it represents the name of a VIRTEL variable whose contents is to be included in the message. The number of quoted strings is not limited, but the message itself cannot be larger than 252 characters.</dd>
</dl>
<p><strong>ERROR$ Examples</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>GOOD$ DS 0H
    ERROR$ 0,&#39;SCENSITE FINISHED: OK&#39;
    GOTO$ EXIT
BADG$ DS 0H
    ERROR$ 1,&#39;SCENSITE FAILED: RC = 1&#39;
    GOTO$ EXIT
</pre></div>
</div>
<p id="index-258">Scenarios</p>
</div>
<div class="section" id="field-instruction">
<h5>FIELD$ instruction<a class="headerlink" href="#field-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction defines the position and the length of the 3270 selection involved, as well as the set of presentation rules.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>FIELD$ (row,col,len),operation,param-1,param-2,...,param-N
</pre></div>
</div>
<dl class="docutils">
<dt>row</dt>
<dd>Specifies the row position of the field</dd>
<dt>col</dt>
<dd>Specifies the column position of the field</dd>
<dt>len</dt>
<dd>Specifies the length of the field</dd>
<dt>operation</dt>
<dd><p class="first">Defines the presentation rule. The permissible values are:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>DEFINE-CHOICE</dt>
<dd>Adds a value of type SELECT</dd>
<dt>DEFINE-VARIABLE-CHOICE</dt>
<dd>Adds multiple values of type SELECT</dd>
<dt>IS-BINARY-CHOICE</dt>
<dd>Defines a field as a checkbox</dd>
<dt>HIDE</dt>
<dd><p class="first">Defines a field as non-display param-N</p>
<p class="last">Depends on the contents of the operation.</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>The FIELD$ instruction only operates on input fields.</p>
<p id="index-259"><strong>FIELD$ DEFINE-CHOICE</strong></p>
<p>Generates a SELECT type entry field for the 3270 field concerned. This instruction requires a VAL parameter and
optionally a SHOW parameter.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>FIELD$ (row,col,len),DEFINE-CHOICE,VAL=&#39;value&#39;,SHOW=&#39;label&#39;
</pre></div>
</div>
<p>The VAL parameter generates an OPTION value for the SELECT field.
The optional SHOW parameter allows the specification of the text displayed in the SELECT field for the given value. If
the SHOW parameter is omitted, the text displayed is identical to the value.</p>
<p id="index-260"><strong>FIELD$ DEFINE-VARIABLE-CHOICE</strong></p>
<p>Generates a list of SELECT entries for the 3270 field concerned. This instruction requires a VAL parameter.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>FIELD$ (row,col,len),DEFINE-VARIABLE-CHOICE,VAL=varname
</pre></div>
</div>
<p>The VAL parameter of a DEFINE-VARIABLE-CHOICE operation specifies the name of a table variable which contains the
OPTION values for the SELECT statement generated for the 3270 field concerned. These values must be supplied by the
3270 application by means of a structured field type FAE5 or FAE6, or by means of the HOST4WEB command S
VARIABLE. Structured fields are described in the VIRTEL Programming Interface documentation 263 HOST4WEB
commands are described in the VIRTEL Programming Interface documentation 274</p>
<p id="index-261"><strong>FIELD$ IS-BINARY-CHOICE</strong></p>
<p>Generates an INPUT TYPE=CHECKBOX field for the 3270 field concerned. This is useful for 3270 fields which can take
two values: one value representing a “checked” box and the other value representing an “unchecked” box. This
instruction requires a VAL parameter and optionally a NOTVAL parameter.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>FIELD$ (row,col,len),IS-BINARY-CHOICE,VAL=&#39;value&#39;,NOTVAL=&#39;value&#39;
</pre></div>
</div>
<p>For output messages, the box will be displayed as checked if the value of the 3270 field matches the VAL parameter,
otherwise it will be displayed as unchecked. For input messages, the VAL parameter specifies the value which will be
transmitted to the application in the 3270 field when the box is checked, and the NOTVAL parameter specifies the
value to be transmitted to the application if the box is unchecked. If the NOTVAL parameter is omitted then an empty
field will be transmitted to the application if the box is unchecked.</p>
<p><strong>FIELD$ HIDE</strong></p>
<p>Generates an INPUT TYPE=HIDDEN field for the 3270 field concerned. This instruction takes no additional parameters.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>FIELD$ (row,col,len),HIDE
</pre></div>
</div>
</div>
<div class="section" id="filter-instruction">
<span id="index-262"></span><h5>FILTER$ instruction<a class="headerlink" href="#filter-instruction" title="Permalink to this headline">¶</a></h5>
<p><strong>FILTER$ VARIABLE-TO-VARIABLE</strong></p>
<p>The FILTER$ VARIABLE-TO-VARIABLE instruction creates or adds values to a variable from another variable according to
a list of conditions, similar to the conditions in a CASE$ instruction.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>FILTER$ VARIABLE-TO-VARIABLE,
FROM=&#39;varname1&#39;,TO=&#39;varname2&#39;,
(WHEN,&#39;YYYY&#39;,THEN,&#39;aaa&#39;),
(BEGIN,&#39;XXXX&#39;,THEN,&#39;bbb&#39;),
(CONTAINS,&#39;ZZZZ&#39;,THEN,IGNORE),
(OTHERWISE,KEEP)
</pre></div>
</div>
<dl class="docutils">
<dt>FROM,TO</dt>
<dd>varname1 is the name of the VIRTEL variable whose values are to be inspected, and varname2 is the name of the VIRTEL variable to which values are to be added. The variable varname2 will be created if it does not exist.</dd>
<dt>WHEN,THEN</dt>
<dd>when a value ‘YYYY’ is found in variable varname1, then the value ‘aaa’ will be added to varname2.</dd>
<dt>BEGIN,THEN</dt>
<dd>when a value beginning with ‘XXXX’ is found in varname1, then the value ‘bbb’ will be added to varname2.</dd>
<dt>CONTAINS,THEN,IGNORE</dt>
<dd>when a value containing ‘ZZZZ’ is found in varname1, then no value will be added to varname2.</dd>
<dt>OTHERWISE,KEEP</dt>
<dd>the default action, if none of the preceding conditions is met, is to copy the value from varname1 to a new value in varname2.</dd>
</dl>
</div>
<div class="section" id="foreach">
<span id="index-263"></span><h5>FOREACH$<a class="headerlink" href="#foreach" title="Permalink to this headline">¶</a></h5>
<p><strong>FOREACH$ VALUE-IN-SCREEN instruction</strong></p>
<p>The FOREACH$ VALUE-IN-SCREEN instruction marks the start of a loop on a screen. Nested pairs of FOREACH$ and ENDFOR$ instructions are permitted.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>groupname FOREACH$ VALUE-IN-SCREEN,SCREEN=(row,col,len,ht)
</pre></div>
</div>
<dl class="docutils">
<dt>groupname</dt>
<dd>The label is required. The FOREACH$ VALUE-IN-SCREEN instruction must be matched by a subsequent ENDFOR$ targeting the same label.</dd>
<dt>row</dt>
<dd>starting row of the portion of the screen to copy (see Note 1).</dd>
<dt>col</dt>
<dd>starting column of the portion of the screen to copy (see Note 1).</dd>
<dt>len</dt>
<dd>width (in columns) of the portion of the screen to copy (see Note 1).</dd>
<dt>ht</dt>
<dd>height (in rows) of the portion of the screen to copy (see Note 1).</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For row, col,len and ht, a value of ‘=’ means the value of the current row, col, len or height</p>
</div>
<p id="ug-foreach-variable"><strong>FOREACH$ VALUE-IN-VARIABLE instruction</strong></p>
<p>The FOREACH$ VALUE-IN-VARIABLE instruction marks the start of a loop on a table variable. Nested pairs of FOREACH$
VALUE-IN-VARIABLE and ENDFOR$ instructions are permitted.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>groupname FOREACH$ VALUE-IN-VARIABLE,VAR=&#39;varname&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>groupname</dt>
<dd>The label is required. The FOREACH$ VALUE-IN-VARIABLE instruction must be matched by a subsequent ENDFOR$ targeting the same label.</dd>
<dt>varname</dt>
<dd>The name of the table variable beeing looped on.</dd>
</dl>
</div>
<div class="section" id="goto-instruction">
<span id="index-264"></span><h5>GOTO$ instruction<a class="headerlink" href="#goto-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction directs the subsequent processing flow to a specified label.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>GOTO$ label
</pre></div>
</div>
<dl class="docutils">
<dt>label</dt>
<dd>Specifies the instruction label at which execution of the scenario is to continue.</dd>
</dl>
</div>
<div class="section" id="handle-instruction">
<span id="index-265"></span><h5>HANDLE$ instruction<a class="headerlink" href="#handle-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction manages various handle operations within the context of a scenario.</p>
<dl class="docutils">
<dt>. index::</dt>
<dd>pair: HANDLE$ ABEND ; Scenario Instructions
pair: HANDLE$ ABEND ; HANDLE$</dd>
</dl>
<p><strong>HANDLE$ ABEND instruction</strong></p>
<p>This instruction allows a scenario to continue after an ABEND, due for instance to trying to write on the screen at a
protected position, and directs the subsequent processing flow to a specified label.</p>
<p>HANDLE$ ABEND=label</p>
<dl class="docutils">
<dt>label</dt>
<dd>Specifies the instruction label at which execution of the scenario is to continue.</dd>
<dt>. index::</dt>
<dd>pair: HANDLE$ LOOP ; Scenario Instructions
pair: HANDLE$ LOOP ; HANDLE$</dd>
</dl>
<p><strong>HANDLE$ LOOP instruction</strong></p>
<p>This instruction allows to detect loops in a scenario. When the limit is reached, VIRTEL abends the scenario, and a
message VIRS12IE terminal LOOP WAS DETECTED IN SCENARIO scenname</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>HANDLE$ LOOP=(label,counter)
</pre></div>
</div>
<dl class="docutils">
<dt>label</dt>
<dd>Specifies the instruction label at which execution of the scenario is to continue if the counter limit is reached.</dd>
<dt>Counter</dt>
<dd>Specifies the number of instructions executed beyond which the program will be switched to the label previously specified.</dd>
</dl>
<p>This instruction can also be used with one of the following syntaxes.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>HANDLE$ LOOP=label
</pre></div>
</div>
<p>If no instruction counter is specified, VIRTEL will take 32 times the number of instructions in the scenario as a default
counter.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>HANDLE$ LOOP=label,ABEND=abendroutine
</pre></div>
</div>
<p>Both handle conditions may be spécified simultaneously.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>GOTO$ label,WHEN=(LOOP,counter)
</pre></div>
</div>
<p>The previous syntax wich is also valid is generated internaly by the HANDLE$ instruction.
After the loop is detected, and the specified handling routine is called, a new HANDLE$ LOOP= instruction may be
issued and processing may continue.</p>
<p>If no HANDLE$ is specified, VIRTEL will still set an instruction limit, equal to 32 times the number of instructions in the
scenario.</p>
<span class="target" id="ug-if"></span></div>
<div class="section" id="if-instruction">
<span id="index-266"></span><h5>IF$ instruction<a class="headerlink" href="#if-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction enables the testing of the presence of a value in a 3270 screen, or a value in a VIRTEL variable, or a
condition set by a previous instruction, and directs the subsequent processing flow.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>IF$ (row,col,len),EQ=&#39;value&#39;,THEN=process1,ELSE=process2
IF$ VARIABLE,&#39;varname&#39;,EQ=&#39;value&#39;,THEN=process1,ELSE=process2
IF$ EXISTS-VARIABLE,&#39;varname&#39;,THEN=process1,ELSE=process2
IF$ NOT-EXISTS-VARIABLE,&#39;varname&#39;,THEN=process1,ELSE=process2
IF$ APPLICATION-TIMEOUT,THEN=process1,ELSE=process2
IF$ CURSOR,THEN=process1,ELSE=process2
IF$ FIRST-PASS,THEN=process1,ELSE=process2
IF$ IND$FILE-TIMEOUT,THEN=process1,ELSE=process2
IF$ NOT-FOUND,THEN=process1,ELSE=process2
IF$ SCREEN-IS-BLANK,THEN=process1,ELSE=process2
IF$ SCREEN-IS-UNFORMATTED,THEN=process1,ELSE=process2
IF$ SESSION-SWITCH,THEN=process1,ELSE=process2
</pre></div>
</div>
<dl class="docutils">
<dt>row,col,len</dt>
<dd>Specifies the position (row, column) and length of the data tested.</dd>
<dt>value</dt>
<dd>Specifies the value of the data tested (must be placed in quotes). If the value to be tested is in hexadecimal format, use EQ=X’CXNN…’ syntax.</dd>
<dt>VARIABLE</dt>
<dd>Specifies that the value of a VIRTEL variable is to be tested.</dd>
<dt>EXISTS-VARIABLE</dt>
<dd>Tests if the specified variable exists.</dd>
<dt>NOT-EXISTS-VARIABLE</dt>
<dd>Tests if the specified variable does not exist.</dd>
<dt>varname</dt>
<dd>Specifies the name of the VIRTEL variable to be tested (must be placed in quotes)</dd>
<dt>EQ</dt>
<dd>Tests if the specified variable is equal to the value to test</dd>
<dt>APPLICATION-TIMEOUT</dt>
<dd>Tests whether a previous ACTION$ TO-APPLICATION instruction with a MAXTIME parameter ended in timeout.</dd>
<dt>CURSOR</dt>
<dd>Tests whether the application has turned on the cursor. This option is valid for both 3270 applications and videotex servers.</dd>
<dt>FIRST-PASS</dt>
<dd>Tests whether the scenario is entered for the first time after connecting to the VTAM application. This condition is no longer true after the scenario has exited for the first time, for example when waiting for the next message. If both an INPUT and an OUTPUT scenario are present, the FIRST-PASS condition is true the first time the INPUT scenario is run, and the first time the OUTPUT scenario is run as well. This condition is always true for other types of scenario.</dd>
<dt>IND$FILE-TIMEOUT</dt>
<dd>Tests whether, having received the 3270 messages which precede an IND$FILE transfer, the transfer itself has still not started after a delay of one second. This condition indicates an IND$FILE error and is usually accompanied by an error message on the TSO screen.</dd>
<dt>NOT-FOUND</dt>
<dd>Tests the condition code set by the previous COPY$ instruction.</dd>
<dt>SCREEN-IS-BLANK</dt>
<dd>Tests whether the 3270 screen is completely blank. This condition is true if the screen contains only blanks, nulls, and attribute characters.</dd>
<dt>SCREEN-IS-UNFORMATTED</dt>
<dd>Tests whether the 3270 screen is unformatted. This condition is true if the screen contains no attribute characters.</dd>
<dt>SESSION-SWITCH</dt>
<dd>Tests whether the scenario is entered for a VTAM application which was already connected to this terminal. This condition is useful in VIRTEL multisession scenarios which must re-establish the environment before starting the transaction requested by the user. This condition remains true until the end of this activation of the scenario (for example until the scenario is reused for another session).</dd>
<dt>process1</dt>
<dd><p class="first">Specifies the address of the branch exit of the script if the condition is satisfied. Permitted values are:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>label</dt>
<dd>instruction label at which execution of the scenario is to continue.</dd>
<dt>FAIL</dt>
<dd>reserved word indicating that the scenario is to be terminated and the current message is to be discarded. The scenario will be called again on receipt of the next outbound message from the application.</dd>
<dt>SUCCESS</dt>
<dd>reserved word indicating that the scenario is to be terminated and the current message is to be presented to the user. This is equivalent to branching to a SCENARIO END instruction.</dd>
</dl>
</div></blockquote>
</dd>
<dt>process2</dt>
<dd>Specifies the address of the branch exit of the script if the condition is not satisfied. Permitted values are identical to process1.</dd>
</dl>
</div>
<div class="section" id="indscen-instruction">
<span id="index-267"></span><h5>INDSCEN$ instruction<a class="headerlink" href="#indscen-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction allows a scenario to enable the IND$FILE file transfer function. The INDSCEN$ macro instruction must
be included in both the input scenario and the output scenario.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>INDSCEN$ HOST=type
</pre></div>
</div>
<dl class="docutils">
<dt>type</dt>
<dd>Specifies the type of host system running the IND$FILE program. TSO is the only allowed value. The default is TSO.</dd>
</dl>
</div>
<div class="section" id="label-instruction">
<span id="index-268"></span><h5>LABEL$ instruction<a class="headerlink" href="#label-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction allows to define a label in a scenario.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>mylabel LABEL$
</pre></div>
</div>
<p>It is equivalent to the classic assembler:</p>
<blockquote>
<div><p>mylabel EQU *</p>
<p>or</p>
<p>mylabel DS 0H</p>
</div></blockquote>
<p>It may be used in any scenario. If the scenario is not a subroutine, you can also simply generate :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mylabel</span> <span class="n">DS</span> <span class="mi">0</span><span class="n">C</span>
</pre></div>
</div>
<p>If the scenario is a subroutine, you must use LABEL$ instruction to define each labels inside the subroutine. Each label is suffixed with the name of the subroutine, in order to give some protection from conflicting labels and from branching over the limits of subroutines.</p>
<dl class="docutils">
<dt>mylabel</dt>
<dd>Specifies the instruction label at which execution of a scenario is to continue.</dd>
</dl>
<p>A sample of the usage of LABEL$ instruction is available in the PERFORM$ instruction description.</p>
<span class="target" id="ug-map"></span></div>
<div class="section" id="map-instruction">
<span id="index-269"></span><h5>MAP$ instruction<a class="headerlink" href="#map-instruction" title="Permalink to this headline">¶</a></h5>
<p>The MAP$ instruction defines the format of a flat-format data area known as a “commarea”, and describes how VIRTEL
converts XML or Query input data to commarea format. The MAP$ instruction may also be used in conjunction with
the TOVAR$ instruction to convert an output commarea to VIRTEL variables, which can be used with an appropriate
template to generate XML or other formats.
When the MAP$ instruction is used to convert input data to commarea format, the input data may be supplied either
as XML, or as named parameters in a format known as “Query” data. In both cases, the input data may be attached to
an inbound HTTP request (GET or POST request), or it may be supplied in a VIRTEL variable. The result of the parsing
process is a commarea which is suitable for processing by an application program (typically a COBOL program running
under CICS). The commarea is written into a VIRTEL variable so that it can be passed to the application program by
means of the VIRTEL transaction script language.
Conversion of input data to commarea format (“input-to-commarea” conversion) is performed by means of an INITIAL
scenario. The scenario begins with a group of MAP$ instructions (MAP$ BEGIN, MAP$ END, MAP$ AREA, and MAP$
AREA-ATTRIBUTE) which define the format of the commarea and its relationship to the XML tags or the Query
parameters. The scenario continues with a MAP$ FROM-FIELD, MAP$ FROM-INPUT, MAP$ FROM-VARIABLE instruction
which defines the source of the XML or Query data. Finally, the scenario ends with a MAP$ TO-VARIABLE instruction
which names the VIRTEL variable into which the commarea is to be stored.
Conversion from commarea format to VIRTEL variables (“commarea-to-output” conversion) may be performed by
means of an INITIAL scenario or an OUTPUT scenario. The scenario begins with a description of the commarea format
(MAP$ BEGIN, MAP$ END, MAP$ AREA, and MAP$ AREA-ATTRIBUTE), and continues with a TOVAR$ instruction which
defines the source of the commarea. See the description of the <a class="reference internal" href="#ug-tovar"><span class="std std-ref">“TOVAR$ instruction”</span></a> for further details of
commarea-to-output conversion.</p>
<p id="index-270"><strong>MAP$ ABEND</strong></p>
<p>The MAP$ ABEND instruction is intended for diagnostic purposes only. When VIRTEL encounters a MAP$ ABEND
instruction while processing a commarea with the MAP$ TO-VARIABLE or TOVAR$ instructions, the scenario ends and a
SNAP dump is produced. The VIRTEL SNAP is described in the “Audit and Performance” chapter of the VIRTEL
Messages and Operations Guide.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ ABEND,WITH=&#39;text&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>text</dt>
<dd>A free-format description which will be printed in the SNAP at the time of the abend.</dd>
</dl>
<p><strong>MAP$ ABEND-AT</strong></p>
<p>The MAP$ ABEND-AT instruction is similar to MAP$ ABEND except that it produces a SNAP only after it has been
executed the number of times indicated by the OCCURS parameter.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ ABEND-AT,OCCURS=n,WITH=&#39;text&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>text</dt>
<dd>A free-format description which will be printed in the SNAP at the time of the abend.</dd>
<dt>n</dt>
<dd>The SNAP will be produced after the MAP$ ABEND-AT instruction has been executed n times.</dd>
</dl>
<p id="index-271"><strong>MAP$ AREA</strong></p>
<p>The MAP$ AREA instruction defines a field within a commarea. The MAP$ AREA instruction must be enclosed by a pair
of MAP$ BEGIN and MAP$ END instructions which define the start and end of the commarea.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ AREA,WITH=&#39;name&#39;,LENGTH=nnn,TYPE=type,FORMAT=(&#39;pattern&#39;,char)
</pre></div>
</div>
<dl class="docutils">
<dt>name</dt>
<dd>For input-to-commarea conversion, this is the name of the XML tag or Query parameter which identifies the input data item. For XML input, the WITH parameter may be omitted, and the tag at the current location in the input data is used. For commarea-to-output conversion, this is the name of the VIRTEL variable which will be generated.</dd>
<dt>nnn</dt>
<dd>Specifies the fixed length of the field in the commarea.</dd>
<dt>type</dt>
<dd><dl class="first docutils">
<dt>X</dt>
<dd>indicates an alphanumeric field</dd>
<dt>9</dt>
<dd>indicates a numeric field</dd>
<dt>S9</dt>
<dd>indicates a numeric field with sign overpunch</dd>
<dt>ONLY9</dt>
<dd>indicates a numeric field; any non-numeric characters in the input data item are ignored when copied to the commarea</dd>
<dt>(ONLY9,LEFT-ALIGNED)</dt>
<dd>indicates that the numeric value is to be left-aligned in the field in the commarea</dd>
<dt>BASE64</dt>
<dd>indicates that the data is encoded in Base64 format in the XML data stream</dd>
</dl>
<p>OFFSET-LENGTH</p>
<p>OFFSET-LENGTH-TEXT</p>
<dl class="last docutils">
<dt>OFFSET-LENGTH-BINARY</dt>
<dd><p class="first">For input-to-commarea conversion, calculates the offset and length of the XML data element identified by the WITH parameter. The offset is calculated relative to the start of the XML data stream.</p>
<p>For OFFSET-LENGTH-TEXT the offset and length values are stored in the result commarea as two decimal numbers separated by a comma. OFFSET-LENGTH is a synonym for OFFSET-LENGTH-TEXT.</p>
<p class="last">For OFFSET-LENGTH-BINARY the offset and length are stored as binary values (8 bytes and 4 bytes respectively) in the result commarea. When used in conjunction with the TO-VARIABLE or TO-VARIABLE-ONLY
parameters described below, the 12-byte value thus produced can subsequently be passed to the VIRSVFIO service program as the OFFAREA parameter for the read-partial and write-append functions.</p>
</dd>
</dl>
</dd>
<dt>pattern,char</dt>
<dd>Specifies an editing pattern to be applied when the field is processed during commarea-to-output conversion. Character positions in pattern which contain char represent variable characters to be obtained from the field in the commarea, other characters in pattern represent constants. For example, if FORMAT=(‘9999-99-99’,9) is specified and the commarea field contains 20060621 then a result value of
2006-06-21 will be generated.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">XML tag names are case sensitive. WITH=’Title’ is not the same as WITH=’TITLE’ A variation of the MAP$ AREA instruction allows the value of the field to be copied into a VIRTEL variable, in addition to being placed in the commarea. The variable will be created, if necessary, and its value will be set when the commarea is created by a subsequent MAP$ FROM-FIELD, MAP$ FROM-INPUT, or MAP$ FROM-VARIABLE instruction. The value can then be tested by means of an IF$ VARIABLE instruction (see <a class="reference internal" href="#ug-virtel-scenarios"><span class="std std-ref">“Examples of VIRTEL Scenarios”</span></a>):</p>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ AREA,TO-VARIABLE,VAR=&#39;varname&#39;,
    WITH=&#39;name&#39;,LENGTH=nnn,TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>varname</dt>
<dd>The name of the VIRTEL variable to which the field value is to be copied. The variable name must be placed in quotes. If the variable already exists, then its current value will be replaced. The parameters WITH, LENGTH, and TYPE are as previously described.</dd>
</dl>
<p>Another form of the MAP$ AREA instruction defines a field in the commarea and fills the field with either a constant value, or the value of a VIRTEL variable:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ AREA,FROM-CONSTANT,&#39;value&#39;,LENGTH=nnn,TYPE=type
MAP$ AREA,FROM-VARIABLE,VAR=&#39;varname&#39;,LENGTH=nnn,
    TYPE=type,FORMAT=(&#39;pattern&#39;,char)
</pre></div>
</div>
<dl class="docutils">
<dt>value</dt>
<dd>The value to be copied to the field. The value must be placed in quotes.</dd>
<dt>varname</dt>
<dd>The name of the VIRTEL variable from which the field value is to be copied. The variable name must be placed in</dd>
<dt>quotes.</dt>
<dd>The parameters LENGTH, TYPE, and FORMAT are as previously described.</dd>
</dl>
<p>A further variation of the MAP$ AREA instruction places the value of a field into a VIRTEL variable, without copying it
into the commarea. The variable will be created or replaced during the processing of a subsequent MAP$ FROM-FIELD, MAP$ FROM-INPUT, or MAP$ FROM-VARIABLE instruction.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ AREA,TO-VARIABLE-ONLY,VAR=&#39;varname&#39;,
WITH=&#39;name&#39;,LENGTH=nnn,TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>varname</dt>
<dd>The name of the VIRTEL variable to which the field value is to be copied. The variable name must be placed in quotes. If the variable already exists, then its current value will be replaced.</dd>
</dl>
<p>The WITH parameter specifies the name of the XML tag or Query parameter, as previously described. If the LENGTH and TYPE parameters are specified, then the value of the field is edited, as previously described, to conform to the length and type specified. If the LENGTH and TYPE parameters are omitted, then the length and value of the variable
are copied exactly from the input data.</p>
<p>Another variation of the MAP$ AREA instruction, TO-TABLE-VARIABLE-ONLY, is similar to TO-VARIABLE-ONLY except that if the variable already exists, the new value will be appended to any existing values instead of erasing the previous value.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ AREA,TO-TABLE-VARIABLE-ONLY,VAR=&#39;varname&#39;,
   WITH=&#39;name&#39;,LENGTH=nnn,TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>varname</dt>
<dd>The name of the VIRTEL variable to which the field value is to be copied. The variable name must be placed in quotes.</dd>
</dl>
<p>If the variable already exists, the new value will be appended to any existing values. The WITH, LENGTH and TYPE parameters are as previously described. For convenience, if the variable name is the same as the value of the WITH parameter, the variable name may be specified as VAR=’=WITH’ or VAR==WITH.</p>
<p>The FROM-LAST-ELEMENT-FOUND-NAME keyword of the MAP$ AREA instruction copies into the output commarea the name of the last XML element found in the input stream. This may be used in conjunction with the NEXT-ELEMENT keyword of the MAP$ BEGIN instruction.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ AREA,FROM-LAST-FOUND-ELEMENT-NAME,
    LENGTH=nnn,TYPE=X
</pre></div>
</div>
<dl class="docutils">
<dt>nnn</dt>
<dd>The length of the field in the output commarea where the name is to be placed.</dd>
</dl>
<p>1.18.57. MAP$ AREA-ATTRIBUTE</p>
<p>The MAP$ AREA-ATTRIBUTE instruction defines a field within a commarea. It is similar to MAP$ AREA except that the
contents of the field are obtained from the value of an attribute parameter included within the specified XML start tag,
instead of from the data enclosed by the XML start and end tags.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ AREA-ATTRIBUTE,WITH=&#39;xmlname&#39;,VALUEOF=&#39;attrname&#39;,
    LENGTH=nnn,TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>xmlname</dt>
<dd>The name of the XML tag in the input data whose attribute is to be copied. If the WITH parameter is omitted, the tag at the current location in the input data is used.</dd>
<dt>attrname</dt>
<dd>The name of the XML attribute whose value is to be copied to the commarea.</dd>
<dt>nnn</dt>
<dd>Specifies the fixed length of the field in the commarea.</dd>
<dt>type</dt>
<dd>Same as type parameter of the MAP$ AREA instruction.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">XML tag and attribute names are case sensitive.</p>
</div>
<p>A variation of the MAP$ AREA-ATTRIBUTE instruction allows the value of the attribute to be copied into a VIRTEL variable, in addition to being placed in the commarea:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ AREA-ATTRIBUTE,TO-VARIABLE,VAR=&#39;varname&#39;,
    WITH=&#39;xmlname&#39;,VALUEOF=&#39;attrname&#39;,LENGTH=nnn,TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>varname</dt>
<dd>The name of the VIRTEL variable to which the attribute value is to be copied. The variable name must be placed in quotes. If the variable already exists, then its current value will be replaced. The parameters WITH, VALUEOF, LENGTH, and TYPE are as previously described</dd>
</dl>
<p>Another variation of the MAP$ AREA-ATTRIBUTE instruction places the value of an attribute into a VIRTEL variable, without copying it into the commarea:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ AREA-ATTRIBUTE,TO-VARIABLE-ONLY,VAR=&#39;varname&#39;,
    WITH=&#39;xmlname&#39;,VALUEOF=&#39;attrname&#39;,LENGTH=nnn,TYPE=type
</pre></div>
</div>
<dl class="docutils">
<dt>varname</dt>
<dd>The name of the VIRTEL variable to which the attribute value is to be copied. The variable name must be placed in quotes. If the variable already exists, then its current value will be replaced.</dd>
</dl>
<p>The parameters WITH and VALUEOF are as previously described. If the LENGTH and TYPE parameters are specified, then the attribute value is edited, as previously described, to conform to the length and type specified. If the LENGTH and TYPE parameters are omitted, then the length and value of the attribute are copied exactly.</p>
<p id="index-272"><strong>MAP$ BEGIN</strong></p>
<p>The MAP$ BEGIN instruction marks the start of a commarea, or the start of a group of fields within a commarea. The optional WITH parameter indicates a group of fields enclosed by a specific XML tag in the input data. The optional OCCURS parameter indicates a repeating group of fields. Nested pairs of MAP$ BEGIN and MAP$ END instructions are
permitted.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>groupname MAP$ BEGIN,WITH=&#39;xmlname&#39;,OCCURS=nnn,COUNT=&#39;countvar&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>groupname</dt>
<dd>The label is required. It specifies the name of the commarea or field group. The MAP$ BEGIN instruction must be matched by a subsequent MAP$ END instruction having the same label.</dd>
<dt>xmlname</dt>
<dd>The name of the XML tag which identifies the start of the group of fields in the input data. If the WITH parameter is omitted, processing for this group of fields starts at the current location in the input data. The special value NEXTELEMENT matches with the next XML tag in the input stream, regardless of its name.</dd>
<dt>nnn</dt>
<dd>Specifies the number of occurrences for a repeating group of fields. If the OCCURS parameter is omitted, one occurrence will be generated. The special value OCCURS=UNLIMITED indicates that the field repeats indefinitely until the end of the input data is reached.</dd>
<dt>countvar</dt>
<dd>Specifies the name of a VIRTEL variable which will be created when the MAP$ is processed for commarea-to-output conversion for a repeating group of fields. The value of the variable is the number of occurrences actually processed (which may be less than the value of the OCCURS parameter if the length of the input commarea is insufficient to contain nnn occurrences of the field group). If the COUNT parameter is omitted, the groupname specified in the statement label is used as the variable name.</dd>
</dl>
<p>A variation of the MAP$ BEGIN instruction can be used to force the scan of the XML input stream to be restarted:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>groupname MAP$ BEGIN,TOP,WITH=&#39;xmlname&#39;
</pre></div>
</div>
<p>The TOP parameter specifies that the scan for the tag named xmlname starts from the beginning of the XML stream.</p>
<p>Another variation of the MAP$ BEGIN instruction introduces a group of fields which are conditional on the current value of the $EVENT$ variable:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>groupname MAP$ BEGIN,EVENT=&#39;eventname&#39;
</pre></div>
</div>
<p>The group of fields enclosed by the MAP$ BEGIN and MAP$ END instructions are processed only if the “current event” set by a previous MAP$ EVENTUAL-AREA or MAP$ ELSETHEN-AREA instruction matches the eventname specified. For commarea-to-output conversion, the names of the variables generated for this group are prefixed by eventname/</p>
<p id="index-273"><strong>MAP$ END</strong></p>
<p>The MAP$ END instruction marks the end of a commarea or field group.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>groupname MAP$ END
</pre></div>
</div>
<dl class="docutils">
<dt>groupname</dt>
<dd>The label is required. It must match the label on the corresponding MAP$ BEGIN instruction.</dd>
</dl>
<span class="target" id="ug-map-eventual-elsethen"></span><p id="index-274"><strong>MAP$ EVENTUAL-AREA, MAP$ ELSETHEN-AREA</strong></p>
<p>The MAP$ EVENTUAL-AREA and MAP$ ELSETHEN-AREA instructions generate a field in a commarea whose value depends on the presence of a named tag in the XML stream, or whose value depends on the value of a specific XML tag.
The first form of these instructions tests for the presence of one of a set of named tags, and generates a value which corresponds to the tag which was found:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ EVENTUAL-AREA, or ELSETHEN-AREA,
FROM-CONSTANT,&#39;value&#39;,
WHEN=(ELEMENT,&#39;xmlname&#39;),
EVENT=&#39;varname&#39;
MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#39;value&#39;
</pre></div>
</div>
<p>These instructions are coded as a group consisting of one MAP$ EVENTUAL-AREA instruction followed by one or more
MAP$ ELSETHEN-AREA instructions. A final MAP$ ELSETHEN-AREA instruction with no WHEN parameter provides a
default value for the output field. The group is enclosed by a pair of MAP$ BEGIN and MAP$ END instructions which
specify the name of the enclosing XML tag.</p>
<p>The optional EVENT parameter specifies the name of the VIRTEL variable to be created when the MAP$ is processed
for commarea-to-output conversion. If the EVENT parameter is omitted, then the variable has the same name as the
XML tag xmlname. The value of the EVENT parameter is also added to the $EVENT$ variable, and becomes the
“current event” for any subsequent MAP$ BEGIN,EVENT instructions.</p>
<p>The following example illustrates the process. The XML stream in this example consists of an &lt;identity&gt; tag which may
enclose one of three different tags &lt;bic&gt; &lt;iban&gt; or &lt;rib&gt;:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">identity</span><span class="o">&gt;&lt;</span><span class="n">bic</span><span class="o">&gt;</span><span class="mi">12345778</span><span class="o">&lt;/</span><span class="n">bic</span><span class="o">&gt;&lt;/</span><span class="n">identity</span><span class="o">&gt;</span>
<span class="ow">or</span>
<span class="o">&lt;</span><span class="n">identity</span><span class="o">&gt;&lt;</span><span class="n">iban</span><span class="o">&gt;</span><span class="mi">12345778</span><span class="o">&lt;/</span><span class="n">iban</span><span class="o">&gt;&lt;/</span><span class="n">identity</span><span class="o">&gt;</span>
<span class="ow">or</span>
<span class="o">&lt;</span><span class="n">identity</span><span class="o">&gt;&lt;</span><span class="n">rib</span><span class="o">&gt;</span><span class="mi">12345778</span><span class="o">&lt;/</span><span class="n">rib</span><span class="o">&gt;&lt;/</span><span class="n">identity</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The objective is to generate an output area which consists of a one-byte code (1=bic, 2=iban, 3=rib) followed by an
8-byte area containing the value of the indicated tag. If none of the indicated tags is found, the code is generated with
a space as the default value. This is achieved by means of the following instructions in the scenario:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>IDENT MAP$ BEGIN,WITH=&#39;identity&#39;
MAP$ EVENTUAL-AREA,FROM-CONSTANT,&#39;1&#39;,WHEN=(ELEMENT,&#39;bic&#39;)
MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#39;2&#39;,WHEN=(ELEMENT,&#39;iban&#39;)
MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#39;3&#39;,WHEN=(ELEMENT,&#39;rib&#39;)
MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#39; &#39;
MAP$ AREA,LENGTH=8
IDENT MAP$ END
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">XML tag names are case sensitive.</p>
</div>
<p>The second form of the MAP$ EVENTUAL-AREA and MAP$ ELSETHEN-AREA instructions tests the data enclosed by a
named tag in the XML stream, and generates an output field with a corresponding value:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ EVENTUAL-AREA, or ELSETHEN-AREA,
    FROM-CONSTANT,&#39;value&#39;,
    WHEN=(VALUE,&#39;string&#39;)
MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#39;value&#39;
</pre></div>
</div>
<p>These instructions are coded as a group consisting of one MAP$ EVENTUAL-AREA instruction followed by one or more
MAP$ ELSETHEN-AREA instructions. A final MAP$ ELSETHEN-AREA instruction with no WHEN parameter provides a
default value for the output field. The group is enclosed by a pair of MAP$ BEGIN and MAP$ END instructions which
specify the name of the XML tag whose value is being tested.</p>
<p>The following example illustrates the process. The XML stream in this example consists of an &lt;indicator&gt; tag which can
take the value “true” or “false”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">indicator</span><span class="o">&gt;</span><span class="n">true</span><span class="o">&lt;/</span><span class="n">indicator</span><span class="o">&gt;</span>
<span class="ow">or</span>
<span class="o">&lt;</span><span class="n">indicator</span><span class="o">&gt;</span><span class="n">false</span><span class="o">&lt;/</span><span class="n">indicator</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The objective is to generate an output area which consists of a one-byte code (1=true, 0=false). A default value 0 is
generated if the tag data has any other value. This is achieved by means of the following instructions in the scenario:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>INDIC MAP$ BEGIN,WITH=&#39;indicator&#39;
MAP$ EVENTUAL-AREA,FROM-CONSTANT,&#39;0&#39;,WHEN=(VALUE,&#39;false&#39;)
MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#39;1&#39;,WHEN=(VALUE,&#39;true&#39;)
MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#39;0&#39;
INDIC MAP$ END
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">XML tag names are case sensitive.</p>
</div>
<span class="target" id="ug-map-execute"></span><p id="index-275"><strong>MAP$ EXECUTE</strong></p>
<p>The MAP$ EXECUTE instruction allows a sequence of MAP$ instructions to be interrupted in order to enter data on the
3270 screen before continuing the analysis. The MAP$ EXECUTE instruction branches to a subroutine defined
elsewhere in the scenario. The subroutine ends with a RETURN$ instruction.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ EXECUTE,mylabel
</pre></div>
</div>
<dl class="docutils">
<dt>mylabel</dt>
<dd>The label is required. It specifies the name of the subroutine to be called. The label mylabel must be defined elsewhere in the scenario. In the following example the two MAP$ EVENT paragraphs each call a subroutine later in the scenario. After the subroutine executes a RETURN$ instruction, the analysis continues:</dd>
</dl>
<div class="highlight-default"><div class="highlight"><pre><span></span>LIGNE0  MAP$ BEGIN,EVENT=&#39;LIGNE0&#39;
        MAP$ AREA,TO-VARIABLE,VAR=&#39;QTE&#39;,LENGTH=5,TYPE=X,WITH=&#39;QTE&#39;
        MAP$ AREA,TO-VARIABLE,VAR=&#39;CAI&#39;,LENGTH=36,TYPE=X,WITH=&#39;CAI&#39;
        MAP$ AREA,TO-VARIABLE,VAR=&#39;CCD&#39;,LENGTH=3,TYPE=X,WITH=&#39;CCD&#39;
        MAP$ AREA,FROM-CONSTANT,&#39; &#39;,LENGTH=1,TYPE=X
        MAP$ EXECUTE,LI0
LIGNE0  MAP$ END
CMDVALID MAP$ BEGIN,EVENT=&#39;CMDVALID&#39;
         MAP$ AREA,FROM-CONSTANT,&#39; &#39;,LENGTH=1,TYPE=X
         MAP$ EXECUTE,CMDV
CMDVALID MAP$ END
....
LI0 DS 0H
        COPY$ VARIABLE-TO-SCREEN,VAR=&#39;LIGNE0/QTE&#39;,SCREEN=(11,6,5), *
            TYPE=ERASE-FIELD
        COPY$ VARIABLE-TO-SCREEN,VAR=&#39;LIGNE0/CAI&#39;,SCREEN=(11,12,36), *
            TYPE=ERASE-FIELD
        COPY$ VARIABLE-TO-SCREEN,VAR=&#39;LIGNE0/QTE&#39;,SCREEN=(11,49,3), *
            TYPE=ERASE-FIELD
        RETURN$
CMDV DS 0H
* Send pf=ENTER
        ACTION$ TO-APPLICATION,KEY=7D
* Add an occurrence of the table variable VIRTEL
* = return code after validation request
        COPY$ SCREEN-TO-VARIABLE,SCREEN=(22,31,8),VAR=&#39;RETOUR&#39;
        RETURN$
</pre></div>
</div>
<span class="target" id="ug-map-from-field"></span><p id="index-276"><strong>MAP$ FROM-FIELD</strong></p>
<p>The MAP$ FROM-FIELD instruction requests VIRTEL to generate a commarea from XML input data (“XML input-tocommarea” conversion). The XML input data is obtained from an HTML form field in the incoming HTTP request.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>groupname MAP$ FROM-FIELD,FIELD=&#39;fieldname&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>groupname</dt>
<dd>The label is required. It specifies the name of the output area to be generated. It must match the label on a preceding MAP$ BEGIN instruction.</dd>
<dt>fieldname</dt>
<dd>The name of the HTML form field which contains the XML input data.</dd>
</dl>
<p>The MAP$ FROM-FIELD instruction expects XML input data to be presented as a character string fieldname=xmldata
where xmldata is XML data in URL-encoded format. In URL-encoded format, a “+” sign represents a space, and “%xx”
represents the hexadecimal encoding of an ASCII character. The string fieldname=xmldata may either be appended to
the URL (HTTP “GET” method) or it may be contained in the body of the HTTP request (HTTP “POST” method). See
<a class="reference internal" href="#ug-sending-xml"><span class="std std-ref">“Sending XML input as URL-encoded data”</span></a> for examples. To process requests containing XML data in plain
(unencoded) format, use instead the <a class="reference internal" href="#ug-map-from-input"><span class="std std-ref">“MAP$ FROM-INPUT”</span></a>.</p>
<span class="target" id="ug-map-from-input"></span><p id="index-277"><strong>MAP$ FROM-INPUT</strong></p>
<p>The MAP$ FROM-INPUT instruction requests VIRTEL to generate a commarea from XML, JSON or Query format input
data (“input-to-commarea” conversion). The input data is obtained from the incoming HTTP request.
groupname MAP$ FROM-INPUT,format</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>MAP$ FROM-INPUT,format,TO-VARIABLES
</pre></div>
</div>
<dl class="docutils">
<dt>groupname</dt>
<dd>The label is required. It specifies the name of the output area to be generated. It must match the label on a preceding MAP$ BEGIN instruction.</dd>
<dt>format</dt>
<dd><p class="first">XML: specifies that the input data is in XML format
JSON: specifies that the input data is in JSON format
QUERY: specifies that the input data is in Query format</p>
<p class="last">If no format is specified, the default is XML.</p>
</dd>
<dt>TO-VARIABLES</dt>
<dd>Convert XML or JSON input directly to variables, without intermediate usage of a commarea. It is equivalent to:</dd>
</dl>
<div class="highlight-default"><div class="highlight"><pre><span></span>MYMAP MAP$ FROM-INPUT,JSON generate commarea
MYMAP MAP$ TO-VARIABLE,VAR=&#39;MYCOMMAREA&#39; copy commarea to variable
MYMAP TOVAR$ FROM-VARIABLE,VAR=&#39;MYCOMMAREA&#39; generate variables
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">MAP$ FROM-INPUT with a FIELD parameter is accepted and treated as MAP$ FROM-FIELD.</p>
</div>
<p>The MAP$ FROM-INPUT instruction obtains its input data from an incoming HTTP request. The HTTP request may use either via the GET method (where the input data is appended to the URL) or the POST method (where the input data is contained in the request body). When the input format is XML, MAP$ FROM-INPUT treats the entire data area as XML data without any translation. See <a class="reference internal" href="#ug-xml-input-data"><span class="std std-ref">“HTTP request with XML input data”</span></a> for an example. MAP$ FROM-FIELD is preferred when using the GET method with XML input, because certain characters cannot be included in a URL without using URL-encoding.</p>
<p>When the input format is QUERY, MAP$ FROM-INPUT expects the input data to contain one or more strings in the form fieldname=data. When the HTTP request uses the GET method, the strings are appended to the URL. The first string is preceded by a “?” character which separates it from the URL, and the remaining strings are separated by “&amp;” characters. When the HTTP request uses the POST method, the strings are contained in the request body, either one per line, or separated by “&amp;” characters if multiple strings are coded on the same line. For both the GET and POST methods, Query strings are expressed in URL-encoded format, where “+” sign represents a space, and “%xx” represents the hexadecimal encoding of an ASCII character. See <a class="reference internal" href="#ug-parsing-query-input"><span class="std std-ref">“Parsing Query Input”</span></a> for examples.</p>
<span class="target" id="ug-map-from-variable"></span><p id="index-278"><strong>MAP$ FROM-VARIABLE</strong></p>
<p>The MAP$ FROM-VARIABLE instruction requests VIRTEL to generate a commarea from XML or Query format input data (“input-to-commarea” conversion). The input data is contained in a VIRTEL variable.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>groupname MAP$ FROM-VARIABLE,format,VAR=&#39;varname&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>groupname</dt>
<dd>The label is required. It specifies the name of the output area to be generated. It must match the label on a preceding MAP$ BEGIN instruction.</dd>
<dt>format</dt>
<dd><p class="first">XML: specifies that the input data is in XML format
JSON: specifies that the input data is in JSON format
QUERY: specifies that the input data is in Query format</p>
<p class="last">If no format is specified, the default is XML.</p>
</dd>
<dt>varname</dt>
<dd>The name of the VIRTEL variable which contains the input data.</dd>
</dl>
<p id="index-279"><strong>MAP$ TO-VARIABLE</strong></p>
<p>The MAP$ TO-VARIABLE instruction requests VIRTEL to copy a commarea into a VIRTEL variable. The commarea must have been already generated by a previous MAP$ FROM-FIELD, FROM-INPUT, or FROM-VARIABLE instruction.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>groupname MAP$ TO-VARIABLE,VAR=&#39;varname&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>groupname</dt>
<dd>The label is required. It specifies the name of the output area to be copied. It must match the label on a preceding MAP$ BEGIN instruction.</dd>
<dt>varname</dt>
<dd>The name of the VIRTEL variable into which the commarea is to be copied.</dd>
</dl>
<p>MAP$ COPY,VAR=’varname’ is equivalent to MAP$ TO-VARIABLE,VAR=’varname’</p>
<span class="target" id="ug-option"></span></div>
<div class="section" id="option-instruction">
<span id="index-280"></span><h5>OPTION$ instruction<a class="headerlink" href="#option-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction allows the scenario to set up parameters for a subsequent SEND$ TO-LINE instruction.</p>
<p id="index-281"><strong>OPTION$ FOR-HTTP</strong></p>
<p>The OPTION$ FOR-HTTP instruction, when used in conjunction with a SEND$ TO-LINE instruction referencing an outbound HTTP line, allows a scenario to make a request to an HTTP server and to receive the response. The OPTION$ FOR-HTTP instruction builds the parameter list for the subsequent SEND$ TO-LINE instruction.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>OPTION$ FOR-HTTP,              *
(METHOD,&#39;method&#39;),             *
(SITE,&#39;sitename&#39;),             *
(TO,&#39;topath&#39;),                 *
(TEXT,&#39;querytext&#39;),            *
(HEADER,&#39;header&#39;),             *
(FILE-OUT,&#39;varnameo&#39;),         *
(FILE-IN,&#39;varnamei&#39;),          *
(RET-CODE,&#39;varnamer&#39;),         *
TOVAR=&#39;varnamep&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>method</dt>
<dd>(required) the HTTP method: GET or POST (see note below).</dd>
<dt>site</dt>
<dd>the site portion of the URL (see notes below).</dd>
<dt>topath</dt>
<dd>the path portion of the URL (see note below).</dd>
<dt>querytext</dt>
<dd>optional text to be appended to the URL (see note below).</dd>
<dt>header</dt>
<dd>additional HTTP headers to be inserted in the message. Multiple headers may be inserted by specifying more than one HEADER parameter.</dd>
<dt>varnameo</dt>
<dd>the name of the VIRTEL variable which contains the HTTP POST data to be sent to the server. This parameter is required when the method is POST.</dd>
<dt>varnamei</dt>
<dd>(required) the name of the VIRTEL variable which will receive the HTTP response data returned by the server.</dd>
<dt>varnamer</dt>
<dd>the name of the VIRTEL variable which will receive the HTTP return code returned by the server.</dd>
<dt>varnamep</dt>
<dd>the name of the VIRTEL variable which will contain the parameter list.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the field begins with “*” then it is treated as the name of a variable.</p>
</div>
<p>You can use the SITE parameter to specify the name and port of the remote HTTP server, provided that the outbound HTTP line specified by the SEND$ TO-LINE instruction is defined with the special value $SITE$ in the “Remote Ident” field. The value of the SITE parameter is also used to build the Host: header of the outbound HTTP request.</p>
<p id="index-282"><strong>OPTION$ FOR-IND$FILE</strong></p>
<p>The OPTION$ FOR-IND$FILE instruction prepares a TSO session for a file transfer operation using the IND$FILE
protocol. This instruction does not itself perform a file transfer; instead it produces an IND$FILE command in a VIRTEL
variable. The scenario must send the command to the TSO session to initiate the file transfer.</p>
<p>The format of the OPTION$ FOR-IND$FILE command for a transfer from TSO to the workstation is shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>OPTION$ FOR-IND$FILE-DOWNLOAD,                     *
    (METHOD,&#39;options&#39;),                            *
    (FROM,&#39;dsname&#39;),                               *
    (FILE-OUT,&#39;outvar&#39;),                           *
    (RET-CODE,&#39;retvar&#39;),                           *
    TOVAR=&#39;cmdvar&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>options</dt>
<dd>optional parameters (for example, ‘ASCII CRLF’) to be appended to the IND$FILE command line (see note 1 below).</dd>
<dt>dsname</dt>
<dd>(required) the TSO dataset name to be downloaded (see notes 1 and 2 below).</dd>
<dt>outvar</dt>
<dd>(required) the name of the VIRTEL variable which is to receive the contents of the downloaded file.</dd>
<dt>retvar</dt>
<dd>the name of the VIRTEL variable which will receive the completion message sent by IND$FILE at the end of the transfer.</dd>
<dt>cmdvar</dt>
<dd>(required) the name of the VIRTEL variable which will contain the generated IND$FILE command.</dd>
</dl>
<p>The format of the OPTION$ FOR-IND$FILE command for a transfer from the workstation to TSO is shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>OPTION$ FOR-IND$FILE-UPLOAD,                      *
    (METHOD,&#39;options&#39;),                           *
    (TO,&#39;dsname&#39;),                                *
    (FILE-IN,&#39;invar&#39;),                            *
    (RET-CODE,&#39;retvar&#39;),                          *
    TOVAR=&#39;cmdvar&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>options</dt>
<dd>optional parameters (for example, ‘ASCII CRLF NEW’) to be appended to the IND$FILE command line (see note 1 below).</dd>
<dt>dsname</dt>
<dd>(required) the destination TSO dataset name (see notes 1 and 2 below).</dd>
<dt>invar</dt>
<dd>(required) the name of the VIRTEL variable which contains the data to be uploaded.</dd>
<dt>retvar</dt>
<dd>the name of the VIRTEL variable which will receive the completion message sent by IND$FILE at the end of the transfer.</dd>
<dt>cmdvar</dt>
<dd>(required) the name of the VIRTEL variable which will contain the generated IND$FILE command.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>1: If the field begins with “*” then it is treated as the name of a variable.</p>
<p class="last">2: TSO will prefix the dataset name by your prefix (usually your userid) unless the dataset name is enclosed in quotes. If you specify the dataset name as a literal in the instruction (as opposed to indirectly as the value of a variable) then triple quotes must be used, for example: (FROM,’‘’SYS1.PARMLIB(IEASYS00)’‘’)</p>
</div>
<p id="index-283"><strong>OPTION IND$FILE Examples</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>OPTION$ FOR-IND$FILE-DOWNLOAD,                            *
    (METHOD,&#39;*OPT&#39;),              &quot;ASCII CRLF&quot; or null    *
    (FROM,&#39;*DSN&#39;),                 TSO dataset name       *
    (FILE-OUT,&#39;DOWNLOAD&#39;),                                *
    (RET-CODE,&#39;RETURN-CODE&#39;),                             *
    TOVAR=&#39;FTCOMMAND&#39;
</pre></div>
</div>
<p>In this example, the VIRTEL variable OPT contains the IND$FILE optional parameters and DSN contains the dataset
name. On completion of the instruction, FTCOMMAND contains the IND$FILE command to be sent to TSO. When the
file transfer completes, the VIRTEL variable DOWNLOAD contains the contents of the downloaded file, and RETURNCODE
contains the IND$FILE completion message “TRANS03 File transfer complete” or an error message.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>OPTION$ FOR-IND$FILE-UPLOAD,                              *
(METHOD,&#39;*OPT&#39;),                    &quot;ASCII CRLF&quot; or null  *
(TO,&#39;*DSN&#39;),                             TSO dataset name *
(FILE-IN,&#39;UPLOAD&#39;),                                       *
(RET-CODE,&#39;RETURN-CODE&#39;),                                 *
TOVAR=&#39;FTCOMMAND&#39;
</pre></div>
</div>
<p>In this example, the VIRTEL variable OPT contains the IND$FILE optional parameters and DSN contains the dataset
name. On completion of the instruction, FTCOMMAND contains the IND$FILE command to be sent to TSO. When the
file transfer is initiated, VIRTEL sends the contents of the variable UPLOAD to IND$FILE. When the file transfer
completes, RETURN-CODE contains the IND$FILE completion message “TRANS03 File transfer complete” or an error
message.</p>
<p id="index-284"><strong>OPTION$ FOR-MQ</strong></p>
<p>Builds a parameter list for a subsequent SEND$ TO-LINE instruction when the line type is MQ.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>OPTION$ FOR-MQ,                   *
    (FILE-OUT,&#39;varname1&#39;),        *
    TOVAR=&#39;varnamep&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>varname1</dt>
<dd>the name of the VIRTEL variable which contains data to be written to the MQ line.</dd>
<dt>varnamep</dt>
<dd>the name of the VIRTEL variable which will contain the parameter list.</dd>
</dl>
<p id="index-285"><strong>OPTION$ FOR-QUICKLNK</strong></p>
<p>Builds a parameter list for a subsequent SEND$ TO-LINE instruction when the line type is QUICKLNK.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>OPTION$ FOR-QUICKLNK,
    (METHOD,&#39;CALL&#39;),
    (PROGRAM,&#39;program&#39;),
    (TERMINAL,&#39;terminal&#39;),
    (FILE-OUT,&#39;fileIn&#39;),
    (FILE-IN,&#39;fileOut&#39;),
    (RET-CODE,&#39;retCode&#39;),
    (RET-CICS1,&#39;retCics1&#39;),
    (RET-CICS2,&#39;retCics2&#39;),
    TOVAR=&#39;params&#39;

OPTION$ FOR-QUICKLNK,
    (METHOD,&#39;CALL-CONTAINER&#39;),
    (PROGRAM,&#39;program&#39;),
    (TERMINAL,&#39;terminal&#39;),
    (CHANNEL,&#39;*channel&#39;),
    (FILE-OUT,&#39;fileIn&#39;),
    (FILE-IN,&#39;fileOut&#39;),
    (RET-CODE,&#39;retCode&#39;),
    (RET-CICS1,&#39;retCics1&#39;),
    (RET-CICS2,&#39;retCics2&#39;),
    TOVAR=&#39;params&#39;

OPTION$ FOR-QUICKLNK,
    (METHOD,&#39;CALL-CONTAINER-LIST&#39;),
    (PROGRAM,&#39;*program&#39;),
    (TERMINAL,&#39;terminal&#39;),
    (CHANNEL,&#39;*channel&#39;),
    (CONTAINERS-FOR-QUESTION,&#39;contIn&#39;),
    (CONTAINERS-FOR-RESPONSE,&#39;contOut&#39;),
    (RET-CODE,&#39;retCode&#39;),
    (RET-CICS1,&#39;retCics1&#39;),
    (RET-CICS2,&#39;retCics2&#39;),
    TOVAR=&#39;params&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>METHOD</dt>
<dd>(mandatory) the service method Valid values are:</dd>
<dt>CALL</dt>
<dd>Call with a COMMAREA</dd>
<dt>CALL-CONTAINER</dt>
<dd>Call with a container</dd>
<dt>CALL-CONTAINER-LIST</dt>
<dd>Call with a list of containers</dd>
<dt>program</dt>
<dd>(mandatory) the name of the CICS program to call (see Note).</dd>
<dt>terminal</dt>
<dd>(optional) the name of a CICS terminal.</dd>
<dt>channel</dt>
<dd>name (1–16 characters) of the channel that owns the container (see Note). Mandatory if METHOD is ‘CALL-CONTAINER’ or ‘CALL-CONTAINER-LIST’.</dd>
<dt>contIn</dt>
<dd>the name of the VIRTEL variable which contains the input data as a containers list (see Note). Mandatory if METHOD is ‘CALL-CONTAINER-LIST’, invalid otherwise.</dd>
<dt>contOut</dt>
<dd>the name of the VIRTEL variable which will receive the output data as a containers list (see Note). Mandatory if METHOD is ‘CALL-CONTAINER-LIST’, invalid otherwise.</dd>
<dt>fileIn</dt>
<dd>the name of the VIRTEL variable which contains the input data (COMMAREA or container) (see Note). Mandatory if METHOD is ‘CALL’ or ‘CALL-CONTAINER’, invalid otherwise.</dd>
<dt>fileOut</dt>
<dd>the name of the VIRTEL variable which will receive the output data (COMMAREA or container) (see Note). Mandatory if METHOD is ‘CALL’ or ‘CALL-CONTAINER’, invalid otherwise.</dd>
<dt>retCode</dt>
<dd>(Mandatory) the name of the VIRTEL variable which will receive the service return code.</dd>
<dt>retCics1</dt>
<dd>(Mandatory) the name of the VIRTEL variable which will receive the CICS return code (EIBRESP).</dd>
<dt>retCics2</dt>
<dd>(Mandatory) the name of the VIRTEL variable which will receive a complementary CICS return code (EIBRESP2).</dd>
<dt>params</dt>
<dd>(Mandatory) the name of the VIRTEL variable which will contain the parameter list.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the field begins with “*” then it is treated as the name of a variable.</p>
</div>
<p id="index-286"><strong>OPTION$ FOR-SMTP</strong></p>
<p>Builds a parameter list for a subsequent SEND$ TO-LINE instruction when the line type is SMTP.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>OPTION$ FOR-SMTP,                                       *
    (TO,&#39;toaddr&#39;),                                      *
    (FROM,&#39;fromaddr&#39;),                                  *
    (CC,&#39;ccaddr&#39;),                                      *
    (BCC,&#39;bccaddr&#39;),                                    *
    (TEXT,&#39;bodytext&#39;),                                  *
    (SUBJECT,&#39;subjtext&#39;),                               *
    (CHARSET,&#39;charset&#39;),                                *
    (HEADER,&#39;header&#39;),                                  *
    (FILE-OUT,&#39;varname&#39;,&#39;filename&#39;,&#39;filetype&#39;,&#39;disp&#39;),  *
    (ALTERNATE-TEXT,&#39;altvar&#39;,&#39;altfn&#39;,&#39;altft&#39;,&#39;altdp&#39;),  *
    TOVAR=&#39;varnamep&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>toaddr</dt>
<dd>the email address of the recipient (see note below).</dd>
<dt>fromaddr</dt>
<dd>the email address of the sender (see note below).</dd>
<dt>ccaddr</dt>
<dd>the email address(es) of the carbon-copy recipient(s) (see note below).</dd>
<dt>bccaddr</dt>
<dd>the email address(es) of the blind carbon-copy recipient(s) (see note below).</dd>
<dt>bodytext</dt>
<dd>a character string to be placed in the message body (see note below).</dd>
<dt>subjtext</dt>
<dd>a character string to be placed in the message subject line (see note below).</dd>
<dt>charset</dt>
<dd>the character set name to be included in the SMTP Content-type header (see note below). For example, ISO-8859-15</dd>
<dt>header</dt>
<dd>additional SMTP headers to be inserted in the message. Multiple headers may be inserted by specifying more than one HEADER parameter.</dd>
<dt>varname</dt>
<dd>the name of the VIRTEL variable which contains data to be written as an attached file. Multiple files may be attached by specifying more than one FILE-OUT parameter.</dd>
<dt>filename</dt>
<dd>the name of the attached file.</dd>
<dt>filetype</dt>
<dd>the file type to be sent in the Content-type mime header of the attached file. For example text/plain, application/x-tar, etc.</dd>
<dt>disp</dt>
<dd>the Content-Disposition of the attached file. Possible values are inline and attachment. This is an optional subparameter and its default value is attachment.</dd>
<dt>altvar</dt>
<dd>the name of the VIRTEL variable which contains data to be written as an alternate text file. When the ALTERNATETEXT parameter is specified, the generated email will be structured as a multipart/alternative message, and the bodytext specified in the TEXT parameter will become a file with content type text/plain</dd>
<dt>altfn</dt>
<dd>the name of the alternate text file.</dd>
<dt>altft</dt>
<dd>the file type of the alternate text file, usually text/html</dd>
<dt>altdp</dt>
<dd>the Content-Disposition of the alternate text file, usually inline.</dd>
<dt>varnamep</dt>
<dd>the name of the VIRTEL variable which will contain the parameter list.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the field begins with “*” then it is treated as the name of a variable.</p>
</div>
<p id="index-287"><strong>1.18.25.7. OPTION$ Example:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>OPTION$ FOR-HTTP,                                  *
    (METHOD,&#39;POST&#39;),                               *
    (SITE,&#39;api.google.com:80&#39;),                    *
    (TO,&#39;/search/beta2&#39;),                          *
    (HEADER,&#39;Content-Type: application/soap+xml&#39;), *
    (HEADER,&#39;SOAPAction: urn:GoogleSearchAction&#39;), *
    (FILE-OUT,&#39;QUESTION&#39;),                         *
    (FILE-IN,&#39;ANSWER&#39;),                            *
    (RET-CODE,&#39;HTTP-RETURN-CODE&#39;),                 *
    TOVAR=&#39;MYPARMS&#39;
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>OPTION$ FOR-HTTP,                                  *
    (METHOD,&#39;GET&#39;),                                *
    (SITE,&#39;*SITENAME&#39;),                            *
    (TO,&#39;/search&#39;),                                *
    (TEXT,&#39;?ie=UTF-8&amp;q=test&#39;),                     *
    (HEADER,&#39;Accept: text/xml&#39;),                   *
    (FILE-IN,&#39;ANSWER&#39;),                            *
    TOVAR=&#39;MYPARMS&#39;
</pre></div>
</div>
<p>In the above example, the VIRTEL variable SITENAME contains the value of the SITE parameter.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>OPTION$ FOR-SMTP,                                      *
    (TO,&#39;*DESTADDR&#39;),                                  *
    (FROM,&#39;me@y.com&#39;),                                 *
    (CC,&#39;info@y.com&#39;),                                 *
    (BCC,&#39;archive@y.com&#39;),                             *
    (TEXT,&#39;your file is attached&#39;),                    *
    (SUBJECT,&#39;analysis result&#39;),                       *
    (CHARSET,&#39;ISO-8859-15&#39;),                           *
    (HEADER,&#39;X-Priority: 3&#39;),                          *
    (FILE-OUT,&#39;MYVAR1&#39;,&#39;out.tar&#39;,&#39;application/x-tar&#39;), *
    (FILE-OUT,&#39;MYVAR2&#39;,,&#39;application/x-tar&#39;),          *
    (ALTERNATE-TEXT,&#39;M01&#39;,&#39;Message.html&#39;,              *
    &#39;text/html&#39;,&#39;inline&#39;),                             *
    TOVAR=&#39;MYPARMS&#39;
</pre></div>
</div>
<p>In the above example, the variable DESTADDR contains the value of the TO parameter.</p>
</div>
<div class="section" id="perform-instruction">
<span id="index-288"></span><h5>PERFORM$ instruction<a class="headerlink" href="#perform-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction allows to execute a SUBROUTINE scenario before continuing in sequence.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>PERFORM$ mylabel
</pre></div>
</div>
<p>It may be used in any scenario. A subroutine may contains a PERFORM$ instruction to call another subroutine up to 3
levels. For example, main scenario may call level_1 subroutine scenario, which may call level_2 subroutine scenario,
which may call level_3 subroutine scenario, but level_3 cannot call level_4 subroutine scenario.</p>
<dl class="docutils">
<dt>mylabel</dt>
<dd>Specifies the subroutine scenario label to be performed.</dd>
<dt>. index::</dt>
<dd>pair: PERFORM$ Examples; Scenario Instructions</dd>
</dl>
<p><strong>PERFORM$ Example</strong></p>
<p>Here is a sample of the usage of PERFORM$ and LABEL$ instructions.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>PERFORM SCREENS APPL=PERFORM,EXEC=NO
* SCENARIO TO TEST PERFORM$ AND SCENARIO SUBROUTINE
*
        SCENARIO INITIAL
*
        ERROR$ 0,&#39;Level 0&#39;
        PERFORM$ LEVEL1
        ERROR$ 0,&#39;Level 0&#39;
        GOTO$ FIN
        FIN LABEL$
        SCENARIO END
*
LEVEL1  SCENARIO SUBROUTINE
        ERROR$ 0,&#39;Level 1&#39;
        PERFORM$ LEVEL2
        ERROR$ 0,&#39;Level 1&#39;
        IF$ EXISTS-VARIABLE,&#39;TOTO&#39;,THEN=FIN,ELSE=PASFIN
        PASFIN LABEL$
        GOTO$ FIN
FIN     LABEL$
SCENARIO END
*
LEVEL2  SCENARIO SUBROUTINE
        ERROR$ 0,&#39;Level 2&#39;
        PERFORM$ LEVEL3
        ERROR$ 0,&#39;Level 2&#39;
ETIQ    CASE$ (1,1,8),(EQ,&#39;TOTO&#39;,ET1),(EQ,&#39;TITI&#39;,ET2),                  *
            (GE,&#39;YYYY&#39;,ET4),(LE,&#39;ZZZ&#39;,ET5),                             *
            (EQ,VARIABLE,&#39;VVVV&#39;,ET6),                                   *
            (EQ,&#39;*VVVV&#39;,ET6),                                           *
            (EQ,STRING,&#39;SSSS&#39;,ET7),                                     *
            (BEGIN,&#39;XXXX&#39;,ET3),                                         *
            (CONTAINS,&#39;XXXX&#39;,ET3),                                      *
            ELSE=ET6
ET1     LABEL$
ET2     LABEL$
ET3     LABEL$
ET4     LABEL$
ET5     LABEL$
ET6     LABEL$
ET7     LABEL$
        SCENARIO END
*
LEVEL3  SCENARIO SUBROUTINE
        ERROR$ 0,&#39;Level 3&#39;
        SCENARIO END
*
       SCRNEND
END
</pre></div>
</div>
<dl class="docutils">
<dt>. index::</dt>
<dd>pair: POP$; Scenario Instructions</dd>
</dl>
</div>
<div class="section" id="pop-instruction">
<h5>POP$ instruction<a class="headerlink" href="#pop-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction allows a scenario to delete values from VIRTEL table variables.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>POP$ ALL-VALUES-OF,VAR=&#39;varname&#39;
POP$ FIRST-VALUE-OF,VAR=&#39;varname&#39;
POP$ VAR=&#39;varname&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>ALL-VALUES-OF</dt>
<dd>indicates that all values of the table variable are to be deleted.</dd>
<dt>FIRST-VALUE-OF</dt>
<dd>indicates that the first value of a table variable is to be deleted. If the variable contains only one value, then the variable is deleted entirely.</dd>
<dt>varname</dt>
<dd>the name of the VIRTEL variable.</dd>
</dl>
<p>POP$ VAR=’varname’ is equivalent to POP$ FIRST-VALUE-OF,VAR=’varname’</p>
<dl class="docutils">
<dt>. index::</dt>
<dd>pair: RETURN$; Scenario Instructions</dd>
</dl>
</div>
<div class="section" id="return-instruction">
<h5>RETURN$ instruction<a class="headerlink" href="#return-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction terminates a subroutine called by a <a class="reference internal" href="#ug-map-execute"><span class="std std-ref">“MAP$ EXECUTE”</span></a> instruction.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>RETURN$
</pre></div>
</div>
<dl class="docutils">
<dt>. index::</dt>
<dd>pair: SEND$; Scenario Instructions</dd>
</dl>
</div>
<div class="section" id="send-instruction">
<h5>SEND$ instruction<a class="headerlink" href="#send-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction allows a scenario to construct the response to an input request.</p>
<p id="index-289"><strong>SEND$ AS-ANSWER</strong></p>
<p>Sends the contents of a VIRTEL variable as the response to an HTTP request.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SEND$ AS-ANSWER,VAR=&#39;varname&#39;,TYPE=&#39;filetype&#39;,EXPIRES=exphdr
</pre></div>
</div>
<dl class="docutils">
<dt>varname</dt>
<dd>the name of the VIRTEL variable which contains the response data.</dd>
<dt>filetype</dt>
<dd>the file type to be sent in the Content-Type HTTP header. Typical values are text/plain, text/html, and text/xml</dd>
<dt>exphdr</dt>
<dd><dl class="first last docutils">
<dt>EXPIRES=IMMEDIATELY</dt>
<dd>specifies that the response should not be kept in a cache (this is the default value)</dd>
<dt>EXPIRES=ENDOFDAY</dt>
<dd>specifies that the request result can be kept in cache until end of day</dd>
</dl>
</dd>
</dl>
<p>The SEND$ AS-ANSWER instruction is intended for use with files which can be displayed directly by the browser (text,
html, xml). For other types of file, which are intended to be saved on the user’s hard drive, use the SEND$ AS-FILE
instruction instead.
If the line type is not HTTP, the SEND$ AS-ANSWER and SEND$ AS-FILE instructions are processed as “SEND$ VARIABLETO-
LINE” &lt;#UG_capability_types9 with the LINE parameter set to the line on which the scenario is running.</p>
<p id="index-290"><strong>SEND$ AS-FILE</strong></p>
<p>Sends the contents of a VIRTEL variable as an attached file in response to an HTTP request. Unlike the SEND$ ASANSWER
instruction, the response includes a Content-Disposition: Attachment header, which means that the browser
displays a “Save As” dialog box instead of attempting to display the file in the browser window.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SEND$ AS-FILE,VAR=&#39;varname&#39;,TYPE=&#39;filetype&#39;,NAME=&#39;filename&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>varname</dt>
<dd>the name of the VIRTEL variable which contains the file.</dd>
<dt>filetype</dt>
<dd>the file type to be sent in the Content-Type HTTP header. This parameter may be specified as a literal, or as ‘*varname’ where varname is the name of a VIRTEL variable whose value is the filetype. Examples of typical file types are application/pdf, application/x-tar</dd>
<dt>filename</dt>
<dd>the file name to be included in the Content-Disposition HTTP header. This parameter may be specified as a literal, or as ‘*varname’ where varname is the name of a VIRTEL variable whose value is the filename.</dd>
</dl>
<p id="index-291"><strong>SEND$ TO</strong></p>
<p>Sends an outbound message to a VIRTEL line. The name of the destination line is specified indirectly through a VIRTEL transaction. The SEND$ TO instruction must be preceded by an <a class="reference internal" href="#ug-option"><span class="std std-ref">“OPTION$”</span></a> instruction which sets up the parameters for the outbound message according to the line type.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SEND$ TO,&#39;tranname&#39;,PARMS=&#39;varnamep&#39;,ERROR=label
</pre></div>
</div>
<dl class="docutils">
<dt>tranname</dt>
<dd>the external name of a VIRTEL transaction defined under the entry point applicable to this scenario. In the transaction definition, the “Application type” field must be 5 and the “Application” field must be the internal or external name of a VIRTEL line.</dd>
<dt>varnamep</dt>
<dd>the name of the VIRTEL variable which contains the parameter list. This variable must have been created by a previous OPTION$ instruction.</dd>
<dt>errlabel</dt>
<dd>A branch will be made to this label if the message cannot be sent to the requested line.</dd>
</dl>
<p id="index-292"><strong>SEND$ TO-LINE</strong></p>
<p>Sends an outbound message on the specified line. SEND$ TO-LINE is identical to SEND$ TO except that the name of the line is specified directly in the scenario instead of via a transaction. The SEND$ TO-LINE instruction must be preceded by an <a class="reference internal" href="#ug-option"><span class="std std-ref">“OPTION$”</span></a> instruction which sets up the parameters for the outbound message according to the line type.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SEND$ TO-LINE,LINE=&#39;linename&#39;,MAXTIME=maxtime,PARMS=&#39;varnamep&#39;,ERROR=label
</pre></div>
</div>
<dl class="docutils">
<dt>linename</dt>
<dd>the name of the VIRTEL line on which the message is to be sent. This may be the internal or external name of a line defined in the VIRTEL configuration.</dd>
<dt>varnamep</dt>
<dd>the name of the VIRTEL variable which contains the parameter list. This variable must have been created by a previous OPTION$ instruction.</dd>
<dt>errlabel</dt>
<dd>A branch will be made to this label if the message cannot be sent to the requested line.</dd>
<dt>maxtime</dt>
<dd><p class="first">(optional) specifies the maximum time, in hundredths of a second, that the scenario will wait for an answer from the partner to which a request is sent. When this time expires, the scenario continues by going to the ERROR= lable. If the MAXTIME parameter is not specified, the scenario will wait indefinitely, or until VIRTEL disconnects the session when the timeout value of the entry point is exceeded.</p>
<p class="last">This only apply to SEND$ requests which imply a response, like sending a SOAP request to an HTTP server which would wait for a SOAP response.</p>
</dd>
</dl>
<p id="index-293"><strong>SEND$ VARIABLE-TO</strong></p>
<p>Sends the contents of the specified variable as an outbound message on a VIRTEL line. The name of the destination line is specified indirectly through a VIRTEL transaction. A SEND$ VARIABLE-TO instruction is equivalent to an <a class="reference internal" href="#ug-option"><span class="std std-ref">“OPTION$ instructions”</span></a>  instruction followed by a SEND$ TO instruction in the case where OPTION$ specifies only a variable name.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SEND$ VARIABLE-TO,tranname,VAR=&#39;varname&#39;,ERROR=label
</pre></div>
</div>
<dl class="docutils">
<dt>tranname</dt>
<dd>the external name of a VIRTEL transaction defined under the entry point applicable to this scenario. In the transaction definition, the “Application type” field must be 5 and the “Application” field must be the internal or external name of a VIRTEL line.</dd>
<dt>varname</dt>
<dd>the name of the VIRTEL variable which contains data to be written to the line.</dd>
<dt>errlabel</dt>
<dd>A branch will be made to this label if the message cannot be sent to the requested line.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When an input scenario sends a variable to a VIRPASS line, the response from the VIRPASS line is passed to the output scenario in the $VIRPASS$ variable.</p>
</div>
<p id="index-294"><strong>SEND$ VARIABLE-TO-LINE</strong></p>
<p>Sends the contents of the specified variable as an outbound message on the specified VIRTEL line. SEND$ VARIABLETO-
LINE is identical to SEND$ VARIABLE-TO except that the name of the line is specified directly in the scenario instead
of via a transaction. A SEND$ VARIABLE-TO-LINE instruction is equivalent to an <a class="reference internal" href="#ug-option"><span class="std std-ref">“OPTION$”</span></a> instruction
followed by a SEND$ TO-LINE instruction in the case where OPTION$ specifies only a variable name.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SEND$ VARIABLE-TO-LINE,VAR=&#39;varname&#39;,LINE=&#39;linename&#39;,ERROR=label
</pre></div>
</div>
<dl class="docutils">
<dt>varname</dt>
<dd>the name of the VIRTEL variable which contains data to be written to the line.</dd>
<dt>linename</dt>
<dd>the name of the VIRTEL line on which the message is to be sent. This may be the internal or external name of a line defined in the VIRTEL configuration.</dd>
<dt>errlabel</dt>
<dd>A branch will be made to this label if the message cannot be sent to the requested line.</dd>
<dt>. index::</dt>
<dd>pair: SET$; Scenario Instruction</dd>
</dl>
</div>
<div class="section" id="set-instruction">
<h5>SET$ instruction<a class="headerlink" href="#set-instruction" title="Permalink to this headline">¶</a></h5>
<p>This instruction allows various parameters to be set.</p>
<span class="target" id="ug-set-encoding"></span><p id="index-295"><strong>SET$ ENCODING</strong></p>
<p>The SET$ ENCODING instruction allows a scenario specify the default encoding for subsequent pages sent to the terminal, and the encoding of subsequent URLs for this session.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SET$ ENCODING,UTF-8,&#39;charset&#39;
SET$ ENCODING,UTF-8
SET$ ENCODING,ISO-FOR-COUNTRY,&#39;country&#39;
SET$ ENCODING,ISO-FOR-COUNTRY
</pre></div>
</div>
<dl class="docutils">
<dt>UTF-8</dt>
<dd>specifies that the terminal will be placed in UTF-8 mode.</dd>
<dt>charset</dt>
<dd>specifies the name of the UTF-8 translation table to be used. Refer to the DEFUTF8 parameter in the section “Parameters of the VIRTCT” in the VIRTEL Installation Guide for a list of valid translation table names. If charset is not specified, the value of the DEFUTF8 parameter in the VIRTCT is used.</dd>
<dt>ISO-FOR-COUNTRY</dt>
<dd>specifies that the terminal will be placed in ISO mode.</dd>
<dt>country</dt>
<dd>specifies the name of the ISO translation table to be used. Refer to the <a class="reference internal" href="#ug-set-country-code"><span class="std std-ref">“SET-COUNTRY-CODE”</span></a> for a list of valid country names. If country is not specified, the value of the COUNTRY parameter in the VIRTCT is used.</dd>
</dl>
<p>By default, VIRTEL expects query parameters in the URL to be encoded in the same character set as the last page sent to the user. For the first URL of a session, where no page has yet been sent to the user, VIRTEL assumes the ISO encoding for the default country. The SET$ ENCODING instruction allows a scenario to override this default.</p>
<p>The following example shows part of an input scenario. The scenario allows the user to override the default input encoding for query parameters by specifying either IE=UTF-8 or IE=ISO as an additional parameter of the URL.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>        COPY$ INPUT-TO-VARIABLE,FIELD=&#39;IE&#39;,VAR=&#39;IE&#39;
        IF$ NOT-FOUND,THEN=SUITE
        CASE$ &#39;IE&#39;, *
            (EQ,&#39;UTF-8&#39;,SETUTF8),                      *
            (EQ,&#39;ISO&#39;,SETISO), *
            ELSE=SUITE
SETUTF8 SET$ ENCODING,UTF-8,&#39;IBM1147&#39;
        GOTO$ SUITE
SETISO  SET$ ENCODING,ISO-FOR-COUNTRY,&#39;US&#39;
SUITE   EQU *
</pre></div>
</div>
<p>See also the <a class="reference internal" href="#ug-set-url-encoding"><span class="std std-ref">“SET$ URL-ENCODING”</span></a>.</p>
<p id="index-296"><strong>SET$ PAGE</strong></p>
<p>Indicates the name of the page template to be used for the current 3270 screen and all subsequent screens. This instruction has the same effect as the HOST4WEB command S GLOBAL PAGE.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SET$ PAGE,&#39;pagename&#39;
</pre></div>
</div>
<p id="index-297"><strong>SET$ PAGE-FROM-VARIABLE</strong></p>
<p>This instruction is similar to SET$ PAGE except that the name of the page template is contained in a VIRTEL variable.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SET$ PAGE-FROM-VARIABLE,&#39;varname&#39;,&#39;suffix&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>varname</dt>
<dd>the name of the VIRTEL variable which contains the page name. Trailing blanks are removed.</dd>
<dt>suffix</dt>
<dd>a character string to be appended to the page name.</dd>
</dl>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>COPY$ SCREEN-TO-VARIABLE,SCREEN=(02,12,05),VAR=&#39;MYSCREEN&#39;
SET$ PAGE-FROM-VARIABLE,&#39;MYSCREEN&#39;,&#39;.html&#39;
</pre></div>
</div>
<p>In this example, if row 2 column 12 of the 3270 screen contains the characters “MAPъъ” (where ъ represents a blank) then the page name will be set to “MAP.html”</p>
<p id="index-298"><strong>SET$ PRIORITY</strong></p>
<p>Allows a running scenario to reduce its priority in order to limit its CPU consumption.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SET$ PRIORITY,level
</pre></div>
</div>
<dl class="docutils">
<dt>level</dt>
<dd><p class="first">specifies the priority to be assigned to the scenario. The following values may be specified:</p>
<dl class="last docutils">
<dt>LOW</dt>
<dd>the scenario runs at low priority</dd>
<dt>MEDIUM</dt>
<dd>the scenario runs at medium priority</dd>
<dt>HIGH</dt>
<dd>the scenario runs at high priority. This is the default priority assigned to a scenario if no SET$ PRIORITY instruction is executed.</dd>
</dl>
</dd>
</dl>
<span class="target" id="ug-set-screen-position"></span><p id="index-299"><strong>SET$ SCREEN-POSITION</strong></p>
<p>The SET$ SCREEN-POSITION instruction allows a scenario to specify a rectangular screen area and loop on it letting VIRTEL handle the current line (column, length) value, referenced by the equal sign (‘=’).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SET$ SCREEN-POSITION,(row,col,len,ht),
SET$ SCREEN-POSITION,TO-NEXT-LINE
</pre></div>
</div>
<dl class="docutils">
<dt>row</dt>
<dd>starting row of the portion of the screen to select</dd>
<dt>col</dt>
<dd>starting column of the portion of the screen to select</dd>
<dt>len</dt>
<dd>width (in columns) of the portion of the screen to select</dd>
<dt>ht</dt>
<dd>height (in rows) of the portion of the screen to select</dd>
<dt>TO-NEXT-LINE</dt>
<dd>sets the current position to the next line. If the next line is after the end of the current screen rectangle,the NOTFOUND condition will be raised. This condition can be tested by means of the <a class="reference internal" href="#ug-if"><span class="std std-ref">“IF$ instruction”</span></a>.</dd>
</dl>
<p id="index-300"><strong>SET$ SIGNON</strong></p>
<p>Allows an IDENTIFICATION scenario to sign on to the security manager.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SET$ SIGNON,&#39;userid&#39;,&#39;password&#39;,[&#39;newpassword&#39;],&#39;retvar&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>userid</dt>
<dd>The user name.</dd>
<dt>password</dt>
<dd>The user’s current password.</dd>
<dt>newpassword</dt>
<dd>The new password, if the user’s current password is to be changed.</dd>
<dt>retvar</dt>
<dd>The name of a VIRTEL variable into which the security manager return code will be stored. The return code is stored as a decimal string (for example, ‘0’).</dd>
</dl>
<p>The user name and password fields may be specified as a string constant (not recommended), or as the name of a VIRTEL variable preceded by an asterisk. The retvar variable name is not preceded by an asterisk.</p>
<p id="index-301"><strong>SET$ TEMPORARY-PAGE</strong></p>
<p>Indicates the name of the page template to be used for the current 3270 screen (but not for subsequent screens). This instruction has the same effect as the HOST4WEB command S PAGE.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SET$ TEMPORARY-PAGE,&#39;pagename&#39;
</pre></div>
</div>
<p id="index-302"><strong>SET$ TRANSACTION</strong></p>
<p>Allows an IDENTIFICATION scenario to select the transaction which will be executed.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SET$ TRANSACTION,&#39;tranname&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>tranname</dt>
<dd>The external name of the transaction to be executed.</dd>
</dl>
<span class="target" id="ug-set-url-encoding"></span><p id="index-303"><strong>SET$ URL-ENCODING</strong></p>
<p>The SET$ URL-ENCODING instruction is similar to the SET$ ENCODING instruction, except that SET$ URL-ENCODING
applies only to URLs received from the terminal, without affecting the default encoding for pages sent to the terminal.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SET$ URL-ENCODING,UTF-8,&#39;charset&#39;
SET$ URL-ENCODING,UTF-8
SET$ URL-ENCODING,ISO-FOR-COUNTRY,&#39;country&#39;
SET$ URL-ENCODING,ISO-FOR-COUNTRY
</pre></div>
</div>
<p>Refer to <a class="reference internal" href="#ug-set-encoding"><span class="std std-ref">“SET$ ENCODING”</span></a> for a description of the parameters.</p>
<p>The SET$ URL-ENCODING instruction can be used in an identification scenario to specify the encoding for the first URL
of a session, where no page has yet been sent to the user. If the encoding is not set by a scenario, VIRTEL assumes that
the first URL of a session is encoded using the ISO encoding for the default country.</p>
<p id="index-304"><strong>SET$ Example</strong></p>
<p>Loop on the screen from line 11 to 20, looking for a given reference. When found, enter ‘X’ on colum 4 and key Enter</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>            SET$ SCREEN-POSITION,(11,01,80,10)
*
LOOP_FORM   EQU *
            CASE$ (=,19,8),(NE,VARIABLE,&#39;searchedRef&#39;,FORM_NEXT)         X
            COPY$ VALUE-TO-SCREEN,VALUE=&#39;X&#39;,SCREEN=(=,04,01),            X
                TYPE=ERASE-FIELD
            ACTION$ TO-APPLICATION,KEY=7D
            GOTO$ THEEND
*
FORM_NEXT EQU *
            SET$ SCREEN-POSITION,TO-NEXT-LINE
            IF$ NOT-FOUND,THEN=FORM_COMPLETED,ELSE=LOOP_FORM
*
FORM_COMPLETED EQU *
            ERROR$ 0,&#39;Reference not found&#39;
            GOTO$ THEEND
</pre></div>
</div>
<span class="target" id="ug-tovar"></span></div>
<div class="section" id="tovar-instruction">
<span id="index-305"></span><h5>TOVAR$ instruction<a class="headerlink" href="#tovar-instruction" title="Permalink to this headline">¶</a></h5>
<p>The TOVAR$ instruction assists in the generation of XML from a fixed-format data area known as a commarea. The
TOVAR$ instruction works in conjunction with the MAP$ instruction, which describes the format of the commarea and
its relation to the XML data stream.</p>
<p>Whereas the MAP$ instruction allows the XML stream to be converted into commarea format, the TOVAR$ instruction
uses the MAP$ instructions to perform the reverse operation (“commarea-to-output” conversion). In other words, it
takes a commarea as input and generates a series of VIRTEL variables, which, with the aid of a suitable page template,
can be used to generate XML. See <a class="reference internal" href="#ug-xml-parser"><span class="std std-ref">“VIRTEL as an XML parser/generator”</span></a>.</p>
<p>The input commarea is specified according to one of the several formats of the TOVAR$ instruction, as shown in the
following paragraphs.</p>
<p id="index-306"><strong>TOVAR$ FROM-FIELD</strong></p>
<p>The TOVAR$ FROM-FIELD instruction requests VIRTEL to generate a set of VIRTEL variables from an input commarea.
The input commarea is obtained from an HTML form field in the incoming HTTP request. The TOVAR$ FROM-FIELD
instruction is normally contained in an INITIAL scenario.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>groupname TOVAR$ FROM-FIELD,FIELD=&#39;fieldname&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>groupname</dt>
<dd>The label is required. It specifies the name of the input commarea. It must match the label on a preceding MAP$ BEGIN instruction.</dd>
<dt>fieldname</dt>
<dd>The name of the HTML form field which contains the input commarea data.</dd>
</dl>
<span class="target" id="ug-tovar-from-input"></span><p id="index-307"><strong>TOVAR$ FROM-INPUT</strong></p>
<p>The TOVAR$ FROM-INPUT instruction requests VIRTEL to generate a set of VIRTEL variables from an input commarea.
The input commarea is obtained from the data area of the incoming HTTP request. The TOVAR$ FROM-INPUT
instruction is normally contained in an INITIAL scenario.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>groupname TOVAR$ FROM-INPUT
</pre></div>
</div>
<dl class="docutils">
<dt>groupname</dt>
<dd>The label is required. It specifies the name of the input commarea. It must match the label on a preceding MAP$ BEGIN instruction.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">TOVAR$ FROM-INPUT with a FIELD parameter is accepted and treated as TOVAR$ FROM-FIELD</p>
</div>
<p>The TOVAR$ FROM-FIELD and TOVAR$ FROM-INPUT instructions both obtain their data from an incoming HTTP
request. The HTTP request may use either via the GET method (where the input data is appended to the URL) or the
POST method (where the input data is contained in the request body). The difference between the two instructions is
that TOVAR$ FROM-INPUT treats the entire data area as commarea data without any translation, whereas TOVAR$
FROM-FIELD expects the data to be in the format fieldname=commareadata where commareadata is interpreted as
URL-encoded data (a “+” sign represents a space, and “%xx” represents the hexadecimal encoding of an ASCII
character). TOVAR$ FROM-FIELD is preferred when using the GET method, because certain characters cannot be
included in a URL without using URL-encoding.</p>
<p id="index-308"><strong>TOVAR$ FROM-VARIABLE</strong></p>
<p>The TOVAR$ FROM-VARIABLE instruction requests VIRTEL to generate a set of VIRTEL variables from an input
commarea. The input commarea is contained in a VIRTEL variable. The TOVAR$ FROM-VARIABLE instruction is normally
contained in an OUTPUT scenario.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>groupname TOVAR$ FROM-VARIABLE,VAR=&#39;varname&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>groupname</dt>
<dd>The label is required. It specifies the name of the input commarea. It must match the label on a preceding MAP$ BEGIN instruction.</dd>
<dt>varname</dt>
<dd>The name of the VIRTEL variable which contains the input commarea data.</dd>
<dt>. index::</dt>
<dd>pair: VIRSV$; Scenario Instructions</dd>
</dl>
</div>
<div class="section" id="virsv-instruction">
<h5>VIRSV$ instruction<a class="headerlink" href="#virsv-instruction" title="Permalink to this headline">¶</a></h5>
<p>The VIRSV$ instruction allows a service program to be called from a scenario. A service program is an external program
which is not part of VIRTEL but which executes in the VIRTEL address space. The VIRSV service request manager
dispatches work to service programs. Refer to the document Using VIRSV for details of writing service programs which
execute under the control of VIRSV.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>VIRSV$ CALL or CALL-REUSE or TRANSACTION,
        (&#39;servname&#39;,&#39;progname&#39;),
        (NUMBER,&#39;n&#39;),
        (STRINGZ,&#39;cc..cc&#39;),
        (IN-VARIABLE,&#39;varname&#39;,len),
        (OUT-VARIABLE,&#39;varname&#39;,len),
        OPTION=(option,option,...),
        TRACE=(traceopt,traceopt,...),
        ERROR=errlabel,TASKS=count
</pre></div>
</div>
<dl class="docutils">
<dt>CALL</dt>
<dd>Indicates that a new instance of the service program will be created for each request.</dd>
<dt>CALL-REUSE</dt>
<dd>Indicates that the request will be routed to an existing instance of the service program, if one is available. Otherwise a new instance of the service program will be started to process this request, after which the service program will remain active and available to process further requests.</dd>
<dt>TRANSACTION</dt>
<dd>Indicates a call to the service program which is part of a VIRSV transaction.</dd>
<dt>servname</dt>
<dd>The name assigned to this service. The VIRSV service request manager uses this name to identify the request queue which will process this service request. Choose a unique service name for each service program. If more than one scenario calls the same service program, the same service name can be used by each scenario, and in this case the scenarios will all share the same request queue. Alternatively, each scenario can specify a different service name, in which case there will be an independent request queue for each scenario. The service name must consist of at least 6 alphanumeric characters and must be in quotes.</dd>
<dt>progname</dt>
<dd>The name of the service program to be called. The program name must be in quotes.</dd>
<dt>option</dt>
<dd>One or more of the following options may be specified:</dd>
<dt>CLOSE</dt>
<dd>for a transaction call, specifies that the transaction is to be closed after processing this VIRSV$ instruction.</dd>
<dt>traceopt</dt>
<dd><p class="first">Specifies activation or deactivation of the VIRSV trace facility. One or more of the following options may be specified:</p>
<dl class="docutils">
<dt>APPLICATION-TRACE or NO-APPLICATION-TRACE</dt>
<dd>activates or deactivates tracing by the service program (if the service program supports this type of trace).</dd>
<dt>CALLS-TRACE or NO-CALLS-TRACE</dt>
<dd>activates or deactivates tracing of the requests and responses passed between VIRTEL and VIRSV.</dd>
<dt>DISPATCH-TRACE or NO-DISPATCH-TRACE</dt>
<dd>activates or deactivates tracing of the VIRSV request queue and task dispatcher.</dd>
<dt>MEMORY-TRACE or NO-MEMORY-TRACE</dt>
<dd>activates or deactivates tracing of the memory blocks used by VIRSV and the service program.</dd>
</dl>
<p class="last">The default value of each trace option is determined by VIRSV. The trace is written to the VSVTRACE file of the VIRTEL started task.</p>
</dd>
<dt>errlabel</dt>
<dd>A branch will be made to this label if the service cannot be called, or if VIRSV or the service program returned a nonzero return code.</dd>
<dt>count</dt>
<dd>The maximum number of concurrent instances of the service program which can be started for this service name. If there are already count instances of the requested service program active and in-use under this service name, the scenario will wait until an instance becomes available. The default value is 1. This parameter applies only if the call type is CALL-REUSE.</dd>
</dl>
<p>The remaining fields indicate parameters passed to the service program. Any number of parameters may be specified
in any order. For each parameter, VIRTEL places either one or two fullwords into the request input area. Depending on
the parameter type, these fullwords may contain a binary value, an address, or a pair of addresses, as described below.
The address of the request input area is passed to the service program in the LIST-ADR-REQU field of the LIST-POINTER
structure built by the CALL VSVPSYNC routine.</p>
<dl class="docutils">
<dt>(NUMBER,’n’)</dt>
<dd>Indicates a parameter passed to the service program. n is a decimal number whose value is converted to a 32-bit binary integer and stored in the request input area. The number n must be placed in quotes.</dd>
<dt>(POINTER-TO-NUMBER,’n’)</dt>
<dd>Indicates a parameter passed to the service program. n is a decimal number whose value is converted to a 32-bit binary integer. A fullword containing the address of this 32-bit value is stored in the request input area. The number n must be placed in quotes.</dd>
<dt>(STRINGZ,’cc..cc’)</dt>
<dd>Indicates a parameter passed to the service program. A terminating character (X‘00’) is appended to the character string cc..cc, and a fullword containing the address of the string is stored in the request input area. The string must be placed in quotes.</dd>
<dt>(STRINGZ-FROM-VARIABLE,’varname’)</dt>
<dd>Indicates a parameter passed to the service program. The value of the VIRTEL variable varname is copied to a character string and a terminating character (X‘00’) is appended. A fullword containing the address of this nullterminated string is stored in the request input area. The variable name must be placed in quotes.</dd>
<dt>(IN-VARIABLE,’varname’,len)</dt>
<dd>Indicates a parameter passed to the service program. Two fullwords are stored in the request input area: the first contains the address of the value of the VIRTEL variable varname and the second contains the address of a fullword containing the length of this value. The len parameter is ignored unless it contains the special value *n (see below). The variable name must be placed in quotes. For a scenario which processes an inbound request on an MQ line, the special variable name ‘$INFILE$’ denotes the contents of the input request.</dd>
<dt>(OUT-VARIABLE,’varname’,len)</dt>
<dd>Indicates an output parameter returned by the service program. VIRTEL allocates a buffer of length len and stores two fullwords in the request input area: the first contains the address of the buffer and the second contains the address of a fullword which contains the buffer length. The service program places the output value in the buffer and updates the length fullword. VIRTEL copies the contents of the buffer into the VIRTEL variable varname after the service program returns. The len parameter contains the desired buffer length (nn, nnK, or nnM), or the special value *n (see below). The variable name must be placed in quotes.</dd>
</dl>
<p id="index-309"><strong>VIRSV$ - Allocating variable length output buffers</strong></p>
<p>A special form of the len parameter may be used to allocate output buffers whose length varies depending on the
length of an input variable. This is done by specifying the len parameter in the form *n where n is a decimal number.
When the len parameter of an input variable is specified as *n this means that the actual length of the variable is
divided by n to obtain the unit of measurement. Subsequent output variables may then specify length *m where m is a
number. This means that the buffer length for that output variable will be m times the unit of measurement.</p>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>VIRSV$ CALL-REUSE,(&#39;SERVTAR&#39;,&#39;VENTAR&#39;),               *
        (NUMBER,&#39;2&#39;),                                 *
        (IN-VARIABLE,&#39;$INFILE$&#39;,*3),                  *
        (OUT-VARIABLE,&#39;HEADER&#39;,*1),                   *
        (OUT-VARIABLE,&#39;BODY&#39;,*3),                     *
        (OUT-VARIABLE,&#39;SIGNATURE&#39;,4),                 *
        ERROR=REJECTQ,TASKS=5
</pre></div>
</div>
<p>In this example, assume that the variable $INFILE$ has length 4500 bytes. Because its len parameter is specified as *3,
VIRTEL calculates the unit of measurement as 1500. The output variable HEADER has len set to *1 which means that
the buffer length allocated is one unit, or 1500 bytes. The output variable BODY has len *3 which means that its buffer
length is 3 units, or 4500 bytes. By contrast, the output variable SIGNATURE has a fixed buffer length of 4 bytes.
If more than one input variable specifies a len parameter in the format *n then the largest value is taken as the unit of
measurement.</p>
</div>
<div class="section" id="subroutine-scenario">
<span id="index-310"></span><h5>Subroutine scenario<a class="headerlink" href="#subroutine-scenario" title="Permalink to this headline">¶</a></h5>
<p>Subroutine scenario represent a certain part of code that can be invoked from within a scenario. Subroutine scenario starts with a SCENARIO SUBROUTINE instruction and ends with a SCENARIO END instruction.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mysub</span> <span class="n">SCENARIO</span> <span class="n">SUBROUTINE</span>
<span class="o">...</span> <span class="o">/</span> <span class="o">...</span>
<span class="n">SCENARIO</span> <span class="n">END</span>
</pre></div>
</div>
<p>The following restrictions apply to a SCENARIO SUBROUTINE :-</p>
<ul class="simple">
<li>It must not contain any other scenario.</li>
<li>It must not be included in a scenario.</li>
<li>All its labels must use the LABEL$ instruction</li>
<li>It must end with a SCENARIO END instruction which acts as a RETURN$ instruction.</li>
<li>It must not try to branch outside of its limits.</li>
</ul>
<p>The subroutine scenario can be invoked from a main scenario using :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>PERFORM$ mysub
</pre></div>
</div>
<p>This will call the subroutine and the calling scenario will continue in sequence when the subroutine SCENARIO END
instruction will be reached.</p>
<p>A subroutine may contains a PERFORM$ instruction to call another subroutine up to 3 levels. For example, main
scenario may call level_1 subroutine scenario, which may call level_2 subroutine scenario, which may call level_3
subroutine scenario, but level_3 cannot call level_4 subroutine scenario.</p>
</div>
<div class="section" id="multi-session-scenarios">
<span id="index-311"></span><h5>Multi-Session scenarios<a class="headerlink" href="#multi-session-scenarios" title="Permalink to this headline">¶</a></h5>
<p>A scenario may also be specified in the “Output Scenario” field of a transaction invoked by VIRTEL Multi-Session. By
executing an OUTPUT scenario on a 3270 terminal, VIRTEL allows automated 3270 navigation (for example, logon to
VTAM application) from the Multi-Session screen.</p>
<p>When the same VTAM application is re-invoked from a VIRTEL Multi-Session screen using a different transaction from
the one which was previously active, VIRTEL will call the OUTPUT scenario of the new transaction so that the scenario
can terminate the previous transaction and start the new one. In this case the IF$ SESSION-SWITCH instruction is
useful (refer to <a class="reference internal" href="#ug-if"><span class="std std-ref">“IF$ instructions”</span></a> for further details).</p>
</div>
</div>
<div class="section" id="examples-of-virtel-web-modernisation-scenarios">
<span id="index-312"></span><h4>Examples of VIRTEL Web Modernisation Scenarios<a class="headerlink" href="#examples-of-virtel-web-modernisation-scenarios" title="Permalink to this headline">¶</a></h4>
<div class="section" id="creation-of-a-list-of-values-for-a-selected-field">
<span id="index-313"></span><h5>Creation of a list of values for a selected field<a class="headerlink" href="#creation-of-a-list-of-values-for-a-selected-field" title="Permalink to this headline">¶</a></h5>
<p>Many 3270 applications consist of fields which can take only one of a restricted set of values. In this case, it is possible
to offer the end user a list of allowable values by requesting VIRTEL to generate the field in the form of a SELECT rather
than in the form of a normal field. This type of modification is performed by the FIELD$ instruction.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>* ---------------------------------------------------------------- *
* Example of SELECT, CHECKBOX, and HIDDEN fields *
* ---------------------------------------------------------------- *
*
VIRMM01     SCREENS APPL=SYNAPSE,EXEC=NO
*
SCENARIO    OUTPUT
*
TMG         IF$ (01,12,12),EQ=&#39;General Menu&#39;,THEN=MENUG,ELSE=ERRSCRN
*
MENUG       FIELD$ (03,20,1),DEFINE-CHOICE,VAL=9
            FIELD$ (03,20,1),DEFINE-CHOICE,VAL=8
            FIELD$ (03,20,1),DEFINE-CHOICE,VAL=4
            FIELD$ (03,20,1),DEFINE-CHOICE,VAL=3
            FIELD$ (03,20,1),DEFINE-CHOICE,VAL=2
            FIELD$ (03,20,1),DEFINE-CHOICE,VAL=1
*
            FIELD$ (05,20,1),IS-BINARY-CHOICE,VAL=&#39;X&#39;
*
            FIELD$ (07,20,8),HIDE
*
            SCENARIO END
*
ERRSCRN     ERROR$ 0099
            SCRNEND
END
</pre></div>
</div>
<p><em>HTTP presentation module: List of values for input field</em></p>
</div>
<div class="section" id="making-clickable-fields">
<span id="index-314"></span><h5>Making clickable fields<a class="headerlink" href="#making-clickable-fields" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span>TESTCT1 SCREENS APPL=Demopfks,EXEC=NO
*
        SCENARIO OUTPUT
*
        IF$ (02,27,27),EQ=&#39;C O N T A C T C L I E N T&#39;,THEN=CONTACT
        IF$ (02,27,09),EQ=&#39;STATEMENT&#39;,THEN=STATMNT,ELSE=ERRSCRN
*
CONTACT DECLARE$ (23,03,02,&#39;06&#39;),AS-PFKEY,&#39;PF6&#39;
        DECLARE$ (23,08,02,&#39;EF&#39;),AS-PFKEY,&#39;CLEAR&#39;
        DECLARE$ (23,18,02,&#39;02&#39;),AS-PFKEY,&#39;PF2&#39;
        DECLARE$ (23,28,02,&#39;09&#39;),AS-PFKEY,&#39;PF9&#39;
        DECLARE$ (23,38,02,&#39;13&#39;),AS-PFKEY,&#39;PF13&#39;
        DECLARE$ (23,48,02,&#39;14&#39;),AS-PFKEY,&#39;PF14&#39;
        DECLARE$ (23,58,02,&#39;15&#39;),AS-PFKEY,&#39;PF15&#39;
        DECLARE$ (23,68,02,&#39;16&#39;),AS-PFKEY,&#39;PF16&#39;
        SCENARIO END
*
STATMNT DECLARE$ (23,03,02,&#39;06&#39;),AS-PFKEY,&#39;PF6&#39;
        DECLARE$ (23,08,02),AS-PFKEY,&#39;CLEAR&#39;
        DECLARE$ (23,18,02),AS-PFKEY,&#39;PF7&#39;
        DECLARE$ (23,28,02),AS-PFKEY,&#39;PF9&#39;
        DECLARE$ (23,38,02),AS-PFKEY,&#39;PF13&#39;
        DECLARE$ (23,48,02),AS-PFKEY,&#39;PF14&#39;
        DECLARE$ (23,58,02),AS-PFKEY,&#39;PF15&#39;
        DECLARE$ (23,68,02),AS-PFKEY,&#39;PF17&#39;
*
* One click, sends PF9 with the cursor position.
        DECLARE$ (09,23,08,&#39;Echéance&#39;),                           C
                AS-PARAMETER,&#39;P9&#39;,&#39;ZOOM&#39;,TO=VClick
* A click in position 11,23 sends PF9 with the cursor position.
        DECLARE$ (11,23,08),AS-PARAMETER,&#39;PF9&#39;,&#39;ZOOM&#39;,TO=VClick
*
* A click on the client name invokes an internet google search.
        DECLARE$ (04,09,17),AS-HREF,&#39;&amp;&amp;hl=en&amp;&amp;csr=&#39;,              C
                TO=&#39;http://www.google.com/search?q=&#39;
*
        SCENARIO END
*
        ERRSCRN ERROR$ 0099
        SCRNEND
END
</pre></div>
</div>
<p><em>HTTP presentation module: Clickable fields using DECLARE$</em></p>
</div>
<div class="section" id="adding-calendars-to-date-fields">
<span id="index-315"></span><h5>Adding calendars to date fields<a class="headerlink" href="#adding-calendars-to-date-fields" title="Permalink to this headline">¶</a></h5>
<p>By using a combination of an output scenario and a JavaScript application, date fields on the 3270 screen can be
transformed into HTML fields on which a small calendar window appears when the user clicks on the field. The user
chooses the desired date from the calendar, and VIRTEL inserts the date in the correct format into the 3270 input field.</p>
<p>An example scenario for declaring date fields is shown below. As usual, the name of this scenario must be specified in
the “Output Scenario” field of the VIRTEL transaction which calls the host application.</p>
<p>In this example, the correct screen is first identified by using its screen identifier “DEM275” in row 1 column 2, then
three calendar fields are declared at row 8 column 28, row 8 column 64, and row 9 column 28. For the purposes of
illustration, a different date format is declared for each field:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SCENCALR    SCREENS EXEC=NO
            SCENARIO OUTPUT
*
* Identify the correct screen
*
            IF$ (01,02,06),EQ=&#39;DEM275&#39;,THEN=MENU275
            SCENARIO END
*
* Declare the calendar fields
*
MENU275 EQU *
        CALENDR$ SCREEN=(8,28),DATEFMT=&#39;%Y%m%d&#39;
        CALENDR$ SCREEN=(8,64),DATEFMT=&#39;%m/%d/%y&#39;
        CALENDR$ SCREEN=(9,28),DATEFMT=&#39;%e-%b-%Y&#39;
SCENARIO END
SCRNEND
END
</pre></div>
</div>
<p><em>HTTP presentation module: Defining calendar fields</em></p>
<p>In the DATEFMT parameter:</p>
<dl class="docutils">
<dt>%Y</dt>
<dd>represents the year (4 digits)</dd>
<dt>%y</dt>
<dd>represents the year (2 digits)</dd>
<dt>%d</dt>
<dd>represents the day of the month (01-31)</dd>
<dt>%e</dt>
<dd>represents the day of the month (1-31)</dd>
<dt>%m</dt>
<dd>represents the month (01-12)</dd>
<dt>%b</dt>
<dd>represents the abbreviated month name (Jan, Feb, etc)</dd>
</dl>
<p>Refer to the Date.prototype.print function in the calendar.js file for details of all of the allowable date formats.</p>
<p>The CALENDR$ macro generates two VIRTEL table variables: CALENDAR and DATEFMT. The CALENDAR variable
contains the VIRTEL-generated names of the 3270 fields which are to be processed as calendar fields. The DATEFMT
variable contains the corresponding date formats for each field.</p>
<p>The page template must include logic to call the calendar application whenever the output screen has declared
calendar fields. The extract below shows the necessary statements which are included in the VIRTEL sample page
WEB2VIRT.htm:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="n">the</span> <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span> <span class="n">section</span><span class="p">:</span>

<span class="p">{{{</span> <span class="n">WHEN</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;CALENDAR&quot;</span> <span class="p">}}}</span>
    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span> <span class="n">media</span><span class="o">=</span><span class="s2">&quot;all&quot;</span>
            <span class="n">href</span><span class="o">=</span><span class="s2">&quot;dynarch/cal-w2k-c1.css&quot;</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;win2k-cold-1&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/Javascript&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;dynarch/calendar.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/Javascript&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;dynarch/cal-en.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/Javascript&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;dynarch/cal-setup.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
    <span class="p">{{{</span> <span class="n">SET</span><span class="o">-</span><span class="n">LOCAL</span><span class="o">-</span><span class="n">OPTIONS</span> <span class="p">(</span><span class="n">ID</span><span class="p">)</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">END</span><span class="o">-</span><span class="n">WHEN</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;CALENDAR&quot;</span> <span class="p">}}}</span>

<span class="n">After</span> <span class="n">the</span> <span class="o">&lt;</span><span class="n">form</span><span class="o">&gt;</span> <span class="n">section</span><span class="p">:</span>

<span class="p">{{{</span> <span class="n">WHEN</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;CALENDAR&quot;</span> <span class="p">}}}</span>
    <span class="o">&lt;</span><span class="n">script</span> <span class="n">language</span><span class="o">=</span><span class="s2">&quot;Javascript&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/Javascript&quot;</span><span class="o">&gt;</span>
        <span class="p">{{{</span> <span class="n">FOR</span><span class="o">-</span><span class="n">EACH</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">IN</span> <span class="s2">&quot;CALENDAR&quot;</span> <span class="p">}}}</span>
            <span class="n">Calendar</span><span class="o">.</span><span class="n">setup</span><span class="p">({</span><span class="n">inputField</span><span class="p">:</span><span class="s2">&quot;{{{CURRENT-VALUE-OF &quot;</span><span class="n">CALENDAR</span><span class="s2">&quot;}}}&quot;</span><span class="p">,</span>
                    <span class="n">ifFormat</span><span class="p">:</span><span class="s2">&quot;{{{CURRENT-VALUE-OF &quot;</span><span class="n">DATEFMT</span><span class="s2">&quot;}}}&quot;</span><span class="p">});</span>
        <span class="p">{{{</span> <span class="n">END</span><span class="o">-</span><span class="n">FOR</span> <span class="s2">&quot;CALENDAR&quot;</span> <span class="p">}}}</span>
    <span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="p">{{{</span> <span class="n">END</span><span class="o">-</span><span class="n">WHEN</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;CALENDAR&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p><em>HTML page template for calendar fields</em></p>
</div>
<div class="section" id="virtel-sugguest">
<span id="index-316"></span><h5>VIRTEL SUGGUEST<a class="headerlink" href="#virtel-sugguest" title="Permalink to this headline">¶</a></h5>
<p>VIRTEL Suggest is a facility which presents lists of suggested values for specific 3270 fields. The suggested values are
presented in a drop-down list which appears automatically when the user starts typing into a field. The list modifies
itself dynamically as the user types. At any time the user can select one of the suggested values by clicking or moving
the cursor to the desired value.</p>
<p>Fields eligible for processing by VIRTEL Suggest are identified by means of an output scenario containing SUGGEST$
macros. Each SUGGEST$ macro identifies a “suggest” field and indicates the data source for the list of suggested
values. The data source may be a DB2 table, a FLECS application1, or a user-written CICS transaction.</p>
<p>An example scenario for declaring a “suggest” field is shown below. As usual, the name of this scenario must be
specified in the “Output Scenario” field of the VIRTEL transaction which calls the host application.</p>
<p>In this example, the correct screen is first identified by using its screen identifier “VIR0091” in row 1 column 2, then a
VIRTEL Suggest field is declared at row 8 column 21. The data source for this field is column “LASTNAME” in the DB2
table named “DSN8810.EMP”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SCENAJAX SCREENS EXEC=NO
*
* DEMONSTRATION SCENARIO FOR VIRTEL-SUGGEST FUNCTIONS
*
* The purpose of this scenario is to activate
* a VIRTEL-Suggest field in the demo application VIR0091.
*
        SCENARIO OUTPUT
        IF$ (1,2,7),EQ=&#39;VIR0091&#39;,THEN=DEMOAPPL
        SCENARIO END
*
* The test panel identifier is VIR0091
*
DEMOAPPL EQU *
*
* Activate VIRTEL-Suggest in the NAME field
*
        SUGGEST$ TRAN=&#39;suggestD&#39;
        SUGGEST$ TABLE=&#39;DSN8810.EMP&#39;
        SUGGEST$ SCREEN=(8,21),FIELD=&#39;LASTNAME&#39;
*
SCENARIO END
SCRNEND
END
</pre></div>
</div>
<p><em>HTTP presentation module: Defining VIRTEL Suggest fields</em></p>
<p id="index-317"><strong>SUGGEST$ instruction</strong></p>
<p>The parameters of the SUGGEST$ macro instruction are as follows:</p>
<dl class="docutils">
<dt>TRAN=’name’</dt>
<dd><p class="first">the name of the VIRTEL transaction which provides the link to the data source for the field. The following transactions are supplied as standard in the VIRTEL entry point WEB2HOST:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>suggestD</dt>
<dd>Data source is a column in a DB2 table</dd>
<dt>suggestF</dt>
<dd>Data source is a field in a FLECS application (via CICS)</dd>
<dt>suggestV</dt>
<dd>Data source is a field in a FLECS application (via VIRTEL)</dd>
</dl>
</div></blockquote>
</dd>
<dt>TABLE=’name’</dt>
<dd>the name of the DB2 table, or the name of the FLECS application</dd>
<dt>FIELD=’name’</dt>
<dd>the name of the DB2 column, or the name of the FLECS field</dd>
<dt>SCREEN=(row,col)</dt>
<dd>the screen position (row, column) of the field on the 3270 screen</dd>
</dl>
<p>A SUGGEST$ instruction containing only TRAN and/or TABLE parameters may be used to set the values for subsequent
SUGGEST$ instructions. Each SUGGEST$ instruction which contains a SCREEN parameter and a FIELD parameter
generates a VIRTEL Suggest field. If the TRAN and TABLE parameters are not specified then the values from the
previous SUGGEST$ instruction are used.</p>
<p id="index-318"><strong>Suggest$ - Installation pre-requisites</strong></p>
<p>Before you can use the suggestD transaction, you must install the program VDBSUGST in your CICS system with
transaction code VDBS. The JCL to compile, link, and bind this program is in member DB2COBC of VIRTEL.SAMPLIB. You
must also update the definition of the suggestD transaction (W2H-53 in the WEB2HOST entry point) to specify the
VTAM applid of the appropriate CICS region.</p>
<p>The suggestF transaction requires the FLECS product to be installed in your CICS system. You must also update the
definition of the suggestF transaction (W2H-51 in the WEB2HOST entry point) to specify the VTAM applid of the CICS
region in which FLECS is installed.</p>
<p>If you plan to use the suggestV transaction, you must add DD statements to the VIRTEL started task JCL specifying the
FLECS catalog file (F20CAT) and the pointer files it references. You must also update the VIRTCT by adding UFILEn
parameters for the FLECS catalog file and each pointer file, together with the corresponding ACB definitions.</p>
<p id="index-319"><strong>Page template for VIRTEL Suggest</strong></p>
<p>The page template must include logic to call the data source transaction whenever the output screen has declared
VIRTEL Suggest fields. The extract below shows the necessary statements which are included in the VIRTEL sample
page WEB2VIRT.htm:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="n">the</span> <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span> <span class="n">section</span><span class="p">:</span>

<span class="p">{{{</span> <span class="n">WHEN</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;SUGGEST-ELEMENT&quot;</span> <span class="p">}}}</span>
    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;suggest.css&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/Javascript&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;suggest.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="p">{{{</span> <span class="n">END</span><span class="o">-</span><span class="n">WHEN</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;SUGGEST-ELEMENT&quot;</span> <span class="p">}}}</span>

<span class="n">After</span> <span class="n">the</span> <span class="o">&lt;</span><span class="n">form</span><span class="o">&gt;</span> <span class="n">section</span><span class="p">:</span>

<span class="p">{{{</span> <span class="n">WHEN</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;SUGGEST-ELEMENT&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">FOR</span><span class="o">-</span><span class="n">EACH</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">IN</span> <span class="s2">&quot;SUGGEST-ELEMENT&quot;</span> <span class="p">}}}</span>
<span class="n">var</span> <span class="n">o</span><span class="p">{{{</span><span class="n">CURRENT</span><span class="o">-</span><span class="n">VALUE</span><span class="o">-</span><span class="n">OF</span> <span class="s2">&quot;SUGGEST-ELEMENT&quot;</span><span class="p">}}}</span><span class="n">box</span> <span class="o">=</span> <span class="n">new</span> <span class="n">AutoSuggestControl</span><span class="p">(</span>
<span class="s2">&quot;{{{CURRENT-VALUE-OF &quot;</span><span class="n">SUGGEST</span><span class="o">-</span><span class="n">ELEMENT</span><span class="s2">&quot;}}}&quot;</span><span class="p">,</span>
<span class="n">new</span> <span class="n">VirtelSuggestions</span><span class="p">(),</span>
<span class="s2">&quot;{{{CURRENT-VALUE-OF &quot;</span><span class="n">SUGGEST</span><span class="o">-</span><span class="n">TRANSNAME</span><span class="s2">&quot;}}}&quot;</span><span class="p">,</span>
<span class="s2">&quot;{{{CURRENT-VALUE-OF &quot;</span><span class="n">SUGGEST</span><span class="o">-</span><span class="n">TABLENAME</span><span class="s2">&quot;}}}&quot;</span><span class="p">,</span>
<span class="s2">&quot;{{{CURRENT-VALUE-OF &quot;</span><span class="n">SUGGEST</span><span class="o">-</span><span class="n">FIELDNAME</span><span class="s2">&quot;}}}&quot;</span><span class="p">);</span>
<span class="p">{{{</span> <span class="n">END</span><span class="o">-</span><span class="n">FOR</span> <span class="s2">&quot;SUGGEST-ELEMENT&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">END</span><span class="o">-</span><span class="n">WHEN</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;SUGGEST-ELEMENT&quot;</span> <span class="p">}}}</span>
</pre></div>
</div>
<p><em>HTML page template for VIRTEL Suggest fields</em></p>
<p>The SUGGEST$ macro instruction generates four VIRTEL table variables: SUGGEST-ELEMENT, SUGGEST-TRANSNAME,
SUGGEST-TABLENAME, SUGGEST-FIELDNAME. The first entry in each table corresponds to the first VIRTEL Suggest field
on the page, the second entry corresponds to the second VIRTEL Suggest field on the page, and so on.</p>
</div>
</div>
<div class="section" id="scenario-autorefresh">
<span id="index-320"></span><h4>Scenario AUTOREFRESH<a class="headerlink" href="#scenario-autorefresh" title="Permalink to this headline">¶</a></h4>
<p>The majority of host applications use the 3270 protocol in a synchronous manner, meaning that each user input
(ENTER or PF key) generates one response consisting of a 3270 screen built by a single VTAM message. Certain host
applications, however, may build a 3270 screen in two or more segments, by sending more than one VTAM message to
the terminal. Other applications may send asynchronous updates to a 3270 screen which are not a direct result of user
input. Such applications need special handling to ensure that VIRTEL can present the updated 3270 screen image to
the user without requiring the user to press ENTER to refresh the screen. VIRTEL handles this situation by means of an
AJAX request containing the VerifyVirtelSession keyword (see <a class="reference internal" href="#ug-session-management"><span class="std std-ref">“3270 Session Management”</span></a>). By using an
output scenario with a suitable page template, the HTML page can determine whether the 3270 screen image has
been updated, and if so can dynamically refresh the data displayed in the browser.</p>
<p>An example scenario is shown below. As usual, the name of this scenario must be specified in the “Output Scenario”
field of the VIRTEL transaction which calls the host application. This scenario is supplied as member SCENREFR in the VIRTEL SAMPLIB.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SCENREFR    SCREENS EXEC=NO
*
* SCENARIO FOR MVS CONSOLE APPLICATION
*
            SCENARIO OUTPUT
            IF$ (1,11,7),EQ=&#39;SNACONS&#39;,THEN=REFR1
            IF$ (21,3,7),EQ=&#39;IEE612I&#39;,THEN=REFR2
            SCENARIO END
*
* SET AUTOREFRESH ONCE FOR SIGNON SCREEN
*
REFR1       EQU *
            COPY$ VALUE-TO-VARIABLE,VAR=&#39;AUTOREFRESH&#39;,VALUE=&#39;ONCE&#39;
            SCENARIO END
*
* SET AUTOREFRESH EVERY 2 SECONDS FOR CONSOLE SCREEN
*
REFR2       EQU *
            COPY$ VALUE-TO-VARIABLE,VAR=&#39;AUTOREFRESH&#39;,VALUE=&#39;2&#39;
            SCENARIO END
*
            SCRNEND
            END
</pre></div>
</div>
<p><em>HTTP presentation module: 3270 auto-refresh</em></p>
<p>This example activates auto-refresh for two specific application screens. The first screen, identified by the word
“SNACONS” in row 1 column 11, is built by the application in two parts. For this screen, the AUTOREFRESH variable is
set to “ONCE” which causes the page template to return to VIRTEL one time only to request the second part of the
screen. The second screen, identified by “IEE612I” in row 21 column 3, is updated continuously by the application. For
this screen, the AUTOREFRESH variable is set to “2” which causes the browser to issue an AJAX request every two
seconds to ask VIRTEL if the screen has been updated. A positive response from VIRTEL triggers a request to refresh
the screen.</p>
<p>The following table shows the permissible values for the AUTOREFRESH variable:</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>nnn</td>
<td>refresh once, then every nnn seconds</td>
</tr>
<tr class="row-odd"><td>nnn,max</td>
<td>refresh once, then after nnn seconds, then double the
interval after each refresh, with a maximum interval of
max seconds.</td>
</tr>
<tr class="row-even"><td>ONCE</td>
<td>refresh once only</td>
</tr>
<tr class="row-odd"><td>NO or NONE</td>
<td>do not refresh</td>
</tr>
</tbody>
</table>
<p><em>Settings for 3270 auto-refresh</em></p>
<p>The page template must include logic to process the AUTOREFRESH variable and issue the necessary AJAX functions.
The extract below shows the necessary statements which are included in the VIRTEL sample page WEB2VIRT.htm:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="n">the</span> <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span> <span class="n">section</span><span class="p">:</span>

<span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;js01.js&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/Javascript&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>

<span class="n">After</span> <span class="n">the</span> <span class="o">&lt;</span><span class="n">form</span><span class="o">&gt;</span> <span class="n">section</span><span class="p">:</span>

<span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
<span class="p">{{{</span> <span class="n">WHEN</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;AUTOREFRESH&quot;</span> <span class="p">}}}</span>
<span class="n">AutoRefresh</span><span class="p">(</span><span class="s2">&quot;{{{CURRENT-VALUE-OF &quot;</span><span class="n">AUTOREFRESH</span><span class="s2">&quot;}}}&quot;</span><span class="p">,</span><span class="n">sesscode</span><span class="p">);</span>
<span class="p">{{{</span> <span class="n">END</span><span class="o">-</span><span class="n">WHEN</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;AUTOREFRESH&quot;</span> <span class="p">}}}</span>
<span class="p">{{{</span> <span class="n">WHEN</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;AUTOREFRESH&quot;</span> <span class="p">}}}</span>
<span class="n">AutoRefresh</span><span class="p">(</span><span class="s2">&quot;1.2,10&quot;</span><span class="p">,</span><span class="n">sesscode</span><span class="p">);</span>
<span class="p">{{{</span> <span class="n">END</span><span class="o">-</span><span class="n">WHEN</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">EXISTS</span> <span class="s2">&quot;AUTOREFRESH&quot;</span> <span class="p">}}}</span>
<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><em>HTML page template for 3270 auto-refresh</em></p>
<p>This page supplies a default value which takes effect if no AUTOREFRESH variable is specified by the scenario. The
default value is set to ‘1.2,10’ which means that a refresh will occur immediately after each screen is loaded, another
refresh will occur 1.2 seconds later, then at intervals of 2.4 seconds, 4.8 seconds, and 9.6 seconds, and finally a refresh
will occur every 10 seconds thereafter.</p>
<p>The autorefresh function may be disabled by specifying SCENAUTN in the “Output scenario” field of the VIRTEL
transaction definition. The source code for the SCENAUTN scenario is supplied in the VIRTEL SAMPLIB.</p>
<span class="target" id="ug-pdf"></span></div>
<div class="section" id="pdf-output-generation">
<span id="index-321"></span><h4>PDF output generation<a class="headerlink" href="#pdf-output-generation" title="Permalink to this headline">¶</a></h4>
<p>This example shows a scenario which generates a PDF output file using the MakePDF program product via the service
program VIRSVPDF.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SCENPDF SCREENS EXEC=NO
*
* Scenario for generating PDF output using MakePDF
*
        SCENARIO IDENTIFICATION
*
* Create INPUT file for MakePDF
        COPY$ OUTPUT-FILE-TO-VARIABLE,TYPE=LINEBUFFER,         -
            FILE=&#39;INPUT.TXT&#39;,VAR=&#39;INPUT&#39;
* Create DOCOPT file for MakePDF
        COPY$ OUTPUT-FILE-TO-VARIABLE,TYPE=LINEBUFFER,         -
            FILE=&#39;DOCOPT.TXT&#39;,VAR=&#39;DOCOPT&#39;
* Create LAYOUT file for MakePDF
        COPY$ OUTPUT-FILE-TO-VARIABLE,TYPE=LINEBUFFER,         -
            FILE=&#39;LAYOUT.TXT&#39;,VAR=&#39;LAYOUT&#39;
* Call service program VIRSVPDF which calls MakePDF
        VIRSV$ CALL-REUSE,(&#39;SERVPDF&#39;,&#39;VIRSVPDF&#39;),              -
            (IN-VARIABLE,&#39;INPUT&#39;,*3),                          -
            (IN-VARIABLE,&#39;DOCOPT&#39;,*1),                         -
            (IN-VARIABLE,&#39;LAYOUT&#39;,*1),                         -
            (OUT-VARIABLE,&#39;OUTPUT&#39;,500K),                      -
            (OUT-VARIABLE,&#39;MAKEPDFMESSAGE&#39;,160),               -
            (NUMBER,&#39;3&#39;), MakePDF trace level                  -
            TRACE=(APPLICATION-TRACE, Virsv trace level        -
            NO-CALLS-TRACE,NO-DISPATCH-TRACE,NO-MEMORY-TRACE), -
            ERROR=REJECT,TASKS=1
* Send result to browser
       SEND$ AS-FILE,VAR=&#39;OUTPUT&#39;, -
            TYPE=&#39;application/pdf&#39;,NAME=&#39;my.pdf&#39;
REJECT EQU *
        SCENARIO END
        SCRNEND
END
</pre></div>
</div>
<p><em>HTTP presentation module: PDF output generation</em></p>
<p>For the purpose of this scenario, INPUT.TXT, DOCOPT.TXT and LAYOUT.TXT are files created on a PC, then uploaded to
VIRTEL as page templates (see <a class="reference internal" href="#ug-uploading-html-pages"><span class="std std-ref">“Uploading HTML Pages”</span></a>). The TYPE=LINEBUFFER parameters on the COPY$
statements tell VIRTEL that these files should be converted to MakePDF “LINEBUF” format. The VIRSV$ statement calls
an intermediary service program VIRSVPDF which sets up the commarea and calls MakePDF. Then the SEND$
statement sends back the result file to the browser, giving it the name my.pdf.</p>
<p>The files INPUT.TXT, DOCOPT.TXT, and LAYOUT.TXT for this example are shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;!--VIRTEL start=&quot;{{{&quot; end=&quot;}}}&quot; --&gt;
{{{PDF-NEW-INPUT }}}{{{PDF-USE-DOCOPT &quot;1&quot;}}}{{{PDF-USE-LAYOUT &quot;1&quot;}}}
1. Incoming calls
213
{{{PDF-LINES-PER-PAGE (5) }}}
PAGE 1 FIRST INPUT
{{{CURRENT-VALUE-OF &quot;I1&quot;}}}
{{{PDF-NEW-INPUT }}}{{{PDF-USE-DOCOPT &quot;1&quot;}}}{{{PDF-USE-LAYOUT &quot;2&quot;}}}
PAGE 2 SECOND INPUT
{{{CURRENT-VALUE-OF &quot;I2&quot;}}}
{{{PDF-NEW-INPUT }}}{{{PDF-USE-DOCOPT &quot;1&quot;}}}{{{PDF-USE-LAYOUT &quot;3&quot;}}}
PAGE 3 THIRD INPUT
{{{CURRENT-VALUE-OF &quot;I3&quot;}}}
</pre></div>
</div>
<p><em>MakePDF INPUT.TXT file for PDF generation</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;!--VIRTEL start=&quot;{{{&quot; end=&quot;}}}&quot; --&gt;
{{{PDF-NEW-DOCOPT &quot;1&quot;}}}
OPTIONS COMPRESS=YES
PAGE SIZE=A4 PORTRAIT
DEFINEFONT DEFAULT NATIVE=COURIER-BOLD
DEFAULTFONTSIZE 8 9
DefineFont Font1 Native={{{CURRENT-VALUE-OF &quot;IF1&quot;}}}
DefineFont Font2 Native={{{CURRENT-VALUE-OF &quot;IF2&quot;}}}
DefineFont Font3 Native={{{CURRENT-VALUE-OF &quot;IF3&quot;}}}
DOCINFO AUTHOR=&quot;SYSPERTEC&quot;
DEFINEOVERLAY FORM1 FILE=OVERLAY1
DEFINEOVERLAY FORM2 FILE=OVERLAY2
DEFINEOVERLAY FORM3 FILE=OVERLAY3
</pre></div>
</div>
<p><em>MakePDF DOCOPT.TXT file for PDF generation</em></p>
<blockquote>
<div>&lt;!–VIRTEL start=”{{{” end=”}}}” –&gt;
{{{PDF-NEW-LAYOUT “1”}}}
APPLYOVERLAY FORM1
AT (3.0’ 18.0’)
TEXTBEGIN
Font Font1 size(8 9)
PAGECONTENTS LINES(ALL)
TEXTEND
;
{{{PDF-NEW-LAYOUT “2”}}}
APPLYOVERLAY FORM2
AT (3.0’ 18.0’)
TEXTBEGIN
Font Font2 size(8 9)
PAGECONTENTS LINES(ALL)
TEXTEND
;
{{{PDF-NEW-LAYOUT “3”}}}
APPLYOVERLAY FORM3
AT (3.0’ 18.0’)
TEXTBEGIN
Font Font3 size(8 9)
PAGECONTENTS LINES(ALL)
TEXTEND
;</div></blockquote>
<p><em>MakePDF LAYOUT.TXT file for PDF generation</em></p>
</div>
</div>
<div class="section" id="virtel-web-integration">
<span id="ug-virtel-integration"></span><span id="index-322"></span><h3>VIRTEL Web Integration<a class="headerlink" href="#virtel-web-integration" title="Permalink to this headline">¶</a></h3>
<p>VIRTEL Web Integration allows XML or other web services requests to be interpreted and transformed into requests which can be processed by legacy applications such as CICS/COBOL, with the results being transformed back into XML format for transmission via HTTP or SMTP. By using the scenario language described in section <a class="reference internal" href="#ug-virtel-scenarios"><span class="std std-ref">“Web Modernisation VIRTEL Scenarios”</span></a>, legacy transactions can be converted into Web Services.</p>
<span class="target" id="ug-parsing-query-input"></span><div class="section" id="parsing-query-input">
<span id="index-323"></span><h4>Parsing Query input<a class="headerlink" href="#parsing-query-input" title="Permalink to this headline">¶</a></h4>
<p>By using a combination of an INITIAL scenario and a VIRTEL transaction script, VIRTEL can transform Query parameters
in an HTTP request into a fixed-format data area for processing by a COBOL legacy application program.</p>
<div class="section" id="http-request-with-query-data-get-method">
<h5>HTTP request with Query data (GET method)<a class="headerlink" href="#http-request-with-query-data-get-method" title="Permalink to this headline">¶</a></h5>
<p>The HTML page shown below generates an HTTP request with Query parameters:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;&lt;</span><span class="n">head</span><span class="o">&gt;&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Syspertec</span> <span class="o">-</span> <span class="n">Query</span> <span class="n">data</span> <span class="k">for</span> <span class="n">VIRTEL</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">FORM</span> <span class="n">METHOD</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;querydemo.htm+tranq&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">Ident</span> <span class="n">number</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;num&quot;</span><span class="o">&gt;&lt;/</span><span class="nb">input</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">Check</span> <span class="n">digits</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;key&quot;</span><span class="o">&gt;&lt;/</span><span class="nb">input</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">Request</span> <span class="n">date</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="o">&gt;&lt;/</span><span class="nb">input</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="o">&gt;</span><span class="n">Submit</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><em>HTML form for generating Query input data (GET method)</em></p>
<p>If the user enters, for example, the values “1531499136”, “05”, and “07/01/15” in the three fields and presses the Submit button, an HTTP request is presented to VIRTEL in the format shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>GET querydemo.htm+tranq?num=1531499136&amp;key=05&amp;date=07%2F01%2F15 HTTP/1.0
Host: 192.168.235.30:41000
Accept: */*
</pre></div>
</div>
<p><em>Example HTTP request with Query data (GET method)</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The “/” characters in the user’s input have been encoded by the browser as “%2F” because Query parameters are always transmitted in URL-encoded format in the HTTP request.</p>
</div>
</div>
<div class="section" id="http-request-with-query-data-post-method">
<span id="index-324"></span><h5>HTTP request with Query data (POST method)<a class="headerlink" href="#http-request-with-query-data-post-method" title="Permalink to this headline">¶</a></h5>
<p>By changing the FORM METHOD to POST (instead of GET) in the HTML form, the HTTP request can be presented to VIRTEL in the alternative format shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">demohttp</span><span class="o">/</span><span class="n">querydemo</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">tran4</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span>
<span class="n">Host</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">235.30</span><span class="p">:</span><span class="mi">41000</span>
<span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">31</span>
<span class="n">num</span><span class="o">=</span><span class="mi">1531499136</span><span class="o">&amp;</span><span class="n">key</span><span class="o">=</span><span class="mi">05</span><span class="o">&amp;</span><span class="n">date</span><span class="o">=</span><span class="mi">07</span><span class="o">%</span><span class="mi">2</span><span class="n">F01</span><span class="o">%</span><span class="mi">2</span><span class="n">F15</span>
</pre></div>
</div>
<p><em>Example HTTP request with Query data (POST method)</em></p>
<p>VIRTEL considers this POST request to be identical to the GET request presented in the previous paragraph.</p>
</div>
<div class="section" id="presentation-module-for-query-input-data">
<span id="index-325"></span><h5>Presentation module for Query input data<a class="headerlink" href="#presentation-module-for-query-input-data" title="Permalink to this headline">¶</a></h5>
<p>An example INITIAL scenario for converting this Query data to commarea format is coded in the presentation module SCENQRYI shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SCENQRYI SCREENS APPL=SCENQRYI
         SCENARIO INITIAL
COMMAREA MAP$ BEGIN
         MAP$ AREA,WITH=&#39;num&#39;,LENGTH=10,TYPE=9
         MAP$ AREA,WITH=&#39;key&#39;,LENGTH=2,TYPE=9
         MAP$ AREA,WITH=&#39;date&#39;,LENGTH=8,TYPE=X
COMMAREA MAP$ END
COMMAREA MAP$ FROM-INPUT,QUERY
COMMAREA MAP$ TO-VARIABLE,VAR=&#39;MYAREA&#39;
         SCENARIO END
         SCRNEND
         END
</pre></div>
</div>
<p><em>HTTP presentation module for Query input data.</em></p>
<p>The same presentation module may be used to process both GET and POST requests.</p>
</div>
<div class="section" id="contents-of-generated-commarea">
<span id="index-326"></span><h5>Contents of generated commarea<a class="headerlink" href="#contents-of-generated-commarea" title="Permalink to this headline">¶</a></h5>
<p>The figure below shows the 20-byte commarea generated in the VIRTEL variable MYAREA:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">----+----</span><span class="mi">1</span><span class="o">----+----</span><span class="mi">2</span>
<span class="mi">15314991360507</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">15</span>
</pre></div>
</div>
<p><em>Commarea generated from Query data</em></p>
</div>
<div class="section" id="transaction-definition-for-query-input-data">
<span id="index-327"></span><h5>Transaction definition for Query input data<a class="headerlink" href="#transaction-definition-for-query-input-data" title="Permalink to this headline">¶</a></h5>
<p>The HTTP requests shown in the GET and POST examples above use the URL querydemo.htm+tranq to invoke the
VIRTEL transaction shown below (tranq is the “external name” of the transaction). The “TIOA at logon” field contains a
connection script. After signing on to CICS, the connection script uses the &amp;/S order to process the INITIAL scenario in
the presentation module SCENQRYI. This scenario converts the Query parameter input data into a VIRTEL variable
named MYAREA. The script then invokes a CICS transaction VQRY, passing the contents of MYAREA as input data. The
CICS transaction performs an EXEC CICS RECEIVE to obtain the input data.</p>
<div class="highlight-default" id="virtug-transaction-detail"><div class="highlight"><pre><span></span>TRANSACTION DETAIL DEFINITION ---------------------- Applid: VIRTELD2 15:32:33
Internal name    ===&gt; CLI-17Q             To associate with an entry point name
External name    ===&gt; tranq               Name displayed on user menu
Description      ===&gt; Demonstration VIRTEL Query
Application      ===&gt; CICSPROD            Application to be called
PassTicket       ===&gt; 0 Name ===&gt;         0=no 1=yes 2=unsigned
Application type ===&gt; 1                   1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE
Pseudo-terminals ===&gt; CLVTA               Prefix of name of partner terminals
Logmode ===&gt;                              Specify when LOGMODE must be changed
How started ===&gt; 1                        1=menu 2=sub-menu 3=auto
Security ===&gt; 0                           0=none 1=basic 2=NTLM 3=TLS 4=HTML
H4W commands ? ===&gt; 024                   0=no 1=yes 2=if2VIRTEL 4=auto
Logon message ===&gt;

TIOA at logon ===&gt; Signon to CICS&amp;/W&amp;*F34BE9&amp;/A&amp;(&amp;/S VQRY&amp;=MYAREA=&amp;/A&amp;)

TIOA at logoff ===&gt;

Initial Scenario ===&gt; SCENQRYI            Final Scenario ===&gt;
Input Scenario ===&gt;                       Output Scenario ===&gt;

P1=Update                          P3=Return                        P12=Server
</pre></div>
</div>
<p><em>VIRTEL transaction definition for Query input data</em></p>
<span class="target" id="ug-xml-input-data"></span></div>
</div>
<div class="section" id="parsing-xml-input">
<span id="index-328"></span><h4>Parsing XML input<a class="headerlink" href="#parsing-xml-input" title="Permalink to this headline">¶</a></h4>
<p>By using a combination of an INITIAL scenario and a VIRTEL transaction script, VIRTEL can transform XML input data in
an HTTP request into a fixed-format data area for processing by a COBOL legacy application program.</p>
<div class="section" id="http-request-with-xml-input-data">
<h5>HTTP request with XML input data<a class="headerlink" href="#http-request-with-xml-input-data" title="Permalink to this headline">¶</a></h5>
<p>The simplest method of sending XML data to VIRTEL is to build an HTTP POST request containing the raw XML data in
the request body. This is the format expected by the MAP$ FROM-INPUT instruction described 189. The figure below
shows an example of an HTTP request containing XML input data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>POST /demohttp/xmldemo.xml+tran3 HTTP/1.0
Host: 192.168.235.30
Accept: */*
Content-Length: 197

&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;methodCall&gt;
&lt;screenname&gt;T000-GAL&lt;/screenname&gt;
&lt;screentype&gt;3270&lt;/screentype&gt;
&lt;params&gt;
    &lt;fieldname&gt;FIELD001&lt;/fieldname&gt;
    &lt;uinput&gt;A&lt;/uinput&gt;
&lt;/params&gt;
&lt;/methodCall&gt;&lt;
</pre></div>
</div>
<p><em>Example HTTP request with XML input data</em></p>
</div>
<div class="section" id="presentation-module-for-xml-input-data">
<span id="index-329"></span><h5>Presentation module for XML input data<a class="headerlink" href="#presentation-module-for-xml-input-data" title="Permalink to this headline">¶</a></h5>
<p>An example INITIAL scenario for processing this XML input data is coded in the presentation module SCENXMLI shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SCENXMLI    SCREENS APPL=SCENXMLI
*
            SCENARIO INITIAL
OUTAREA     MAP$ BEGIN
            MAP$ AREA,WITH=&#39;screenname&#39;,LENGTH=8,TYPE=X
PARAMS      MAP$ BEGIN,WITH=&#39;params&#39;
            MAP$ AREA,WITH=&#39;fieldname&#39;,LENGTH=8,TYPE=X
            MAP$ AREA,WITH=&#39;uinput&#39;,LENGTH=20,TYPE=X
PARAMS      MAP$ END
OUTAREA     MAP$ END
*
OUTAREA     MAP$ FROM-INPUT
OUTAREA     MAP$ TO-VARIABLE,VAR=&#39;MYAREA&#39;
            SCENARIO END
*
            SCRNEND
END ,
</pre></div>
</div>
<p><em>HTTP presentation module for XML input data</em></p>
</div>
<div class="section" id="id7">
<h5>Contents of generated commarea<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<p>The figure below shows the 36-byte commarea generated in the VIRTEL variable MYAREA:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">----+----</span><span class="mi">1</span><span class="o">----+----</span><span class="mi">2</span><span class="o">----+----</span><span class="mi">3</span><span class="o">----+-</span>
<span class="n">T000</span><span class="o">-</span><span class="n">GALFIELD001A</span>
</pre></div>
</div>
<p><em>Commarea generated from XML input data</em></p>
<span class="target" id="ug-sending-xml"></span></div>
<div class="section" id="sending-xml-input-as-url-encoded-data">
<span id="index-330"></span><h5>Sending XML input as URL-encoded data<a class="headerlink" href="#sending-xml-input-as-url-encoded-data" title="Permalink to this headline">¶</a></h5>
<p>For some applications it may be more convenient to send the XML data as part of the URL. To conform with URL syntax
rules, the XML data is embedded in an HTML text field, and blanks and other special characters in the XML data are
replaced by their corresponding URL-encoded values (“+” signs and “%xx” sequences). This format can be generated
by means of an HTML form, as shown in the example below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Syspertec - XML Application with VIRTEL&lt;/TITLE&gt;&lt;/HEAD&gt;
&lt;BODY&gt;&lt;CENTER&gt;
&lt;FORM method=GET name=&quot;VirtelForm&quot; action=&quot;/demohttp/xmldemo.xml+tran3&quot;&gt;
&lt;TEXTAREA cols=&quot;45&quot; rows=&quot;20&quot; name=&quot;MYINPUT&quot;&gt;
&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;methodCall&gt;
&lt;screenname&gt;T000-GAL&lt;/screenname&gt;
&lt;screentype&gt;3270&lt;/screentype&gt;
&lt;params&gt;
    &lt;fieldname&gt;FIELD001&lt;/fieldname&gt;
    &lt;uinput&gt;A&lt;/uinput&gt;
&lt;/params&gt;
&lt;/methodCall&gt;
&lt;/TEXTAREA&gt;
&lt;p&gt;&lt;BUTTON type=&quot;submit&quot;&gt;Submit&lt;/BUTTON&gt;
&lt;/FORM&gt;&lt;/CENTER&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;
</pre></div>
</div>
<p><em>HTML form with XML input data embedded in a text field</em></p>
<p>The HTTP request generated by the above HTML form is presented to VIRTEL in the format shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>GET /demohttp/xmldemo.xml+tran3?MYINPUT=%3C%3Fxml+version%3D%221.0%22%3F%
3E%0D%0A%3CmethodCall%3E%0D%0A%3Cscreenname%3ET000-GAL%3C%2Fscreenname%3E
%0D%0A%3Cscreentype%3E3270%3C%2Fscreentype%3E%0D%0A%3Cparams%3E%0D%0A++%3
Cfieldname%3EFIELD001%3C%2Ffieldname%3E%0D%0A++%3Cuinput%3EA%3C%2Fuinput%
3E%0D%0A%3C%2Fparams%3E%0D%0A%3C%2FmethodCall%3E%0D%0A HTTP/1.0
Host: 192.168.235.30
Accept: */*
</pre></div>
</div>
<p><em>XML input data in URL-encoded format (HTTP GET method)</em></p>
<p>By changing the FORM METHOD to POST (instead of GET), the HTTP request can be presented to VIRTEL in the alternative format shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">demohttp</span><span class="o">/</span><span class="n">xmldemo</span><span class="o">.</span><span class="n">xml</span><span class="o">+</span><span class="n">tran3</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span>
<span class="n">Host</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">235.30</span>
<span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">314</span>
<span class="n">MYINPUT</span><span class="o">=%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">3</span><span class="n">Fxml</span><span class="o">+</span><span class="n">version</span><span class="o">%</span><span class="mi">3</span><span class="n">D</span><span class="o">%</span><span class="mf">221.0</span><span class="o">%</span><span class="mi">22</span><span class="o">%</span><span class="mi">3</span><span class="n">F</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">D</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">3</span><span class="n">CmethodCall</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">D</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span>
<span class="n">screenname</span><span class="o">%</span><span class="mi">3</span><span class="n">ET000</span><span class="o">-</span><span class="n">GAL</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Fscreenname</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">D</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">3</span><span class="n">Cscreentype</span><span class="o">%</span><span class="mf">3E3270</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Fsc</span>
<span class="n">reentype</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">D</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">3</span><span class="n">Cparams</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">D</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">++%</span><span class="mi">3</span><span class="n">Cfieldname</span><span class="o">%</span><span class="mi">3</span><span class="n">EFIELD001</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Ffieldnam</span>
<span class="n">e</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">D</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">++%</span><span class="mi">3</span><span class="n">Cuinput</span><span class="o">%</span><span class="mi">3</span><span class="n">EA</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Fuinput</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">D</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Fparams</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">D</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span><span class="o">%</span><span class="mi">3</span><span class="n">C</span><span class="o">%</span><span class="mi">2</span><span class="n">Fm</span>
<span class="n">ethodCall</span><span class="o">%</span><span class="mi">3</span><span class="n">E</span><span class="o">%</span><span class="mi">0</span><span class="n">D</span><span class="o">%</span><span class="mi">0</span><span class="n">A</span>
</pre></div>
</div>
<p><em>XML input data in URL-encoded format (HTTP POST method)</em></p>
<p>Both of these request formats can be processed by a presentation module similar to the SCENXMLI module shown
previously. The only change necessary to process URL-encoded data is that the statement OUTAREA MAP$ FROMINPUT
must be replaced by the statement OUTAREA MAP$ FROM-FIELD,FIELD=’MYINPUT’</p>
</div>
<div class="section" id="transaction-definition-for-xml-input-data">
<span id="index-331"></span><h5>Transaction definition for XML input data<a class="headerlink" href="#transaction-definition-for-xml-input-data" title="Permalink to this headline">¶</a></h5>
<p>The HTTP requests shown above use the URL /demohttp/xmldemo.xml+tran3 to invoke the VIRTEL transaction shown
below (tran3 is the “external name” of the transaction). The “TIOA at logon” field contains a connection script. After
signing on to CICS, the connection script uses the &amp;/S order to process the INITIAL scenario in the presentation module
SCENXMLI. This scenario converts the XML data into a VIRTEL variable named MYAREA. The script then invokes a CICS
transaction VHLP, passing the contents of MYAREA as input data. The CICS transaction performs an EXEC CICS RECEIVE
to obtain the input data.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>TRANSACTION DETAIL DEFINITION ---------------------- Applid: VIRTELD2 15:32:33
Internal name ===&gt; CLI-16E                To associate with an entry point name
External name ===&gt; tran3                  Name displayed on user menu
Description   ===&gt; Demonstration VIRTEL XML
Application   ===&gt; CICSPROD               Application to be called
PassTicket    ===&gt; 0 Name ===&gt;            0=no 1=yes 2=unsigned
Application type ===&gt; 1                   1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE
Pseudo-terminals ===&gt; CLVTA               Prefix of name of partner terminals
Logmode          ===&gt;                     Specify when LOGMODE must be changed
How started      ===&gt; 1                   1=menu 2=sub-menu 3=auto
Security         ===&gt; 0                   0=none 1=basic 2=NTLM 3=TLS 4=HTML
H4W commands ?   ===&gt; 024                 0=no 1=yes 2=if2VIRTEL 4=auto
Logon message    ===&gt;

TIOA at logon    ===&gt; Signon to CICS&amp;/W&amp;*F34BE9&amp;/A&amp;(&amp;/S VHLP&amp;=MYAREA=&amp;/A&amp;)

TIOA at logoff   ===&gt;

Initial Scenario ===&gt; SCENXMLI            Final Scenario ===&gt;
Input Scenario   ===&gt;                     Output Scenario ===&gt; SCENXMLO

P1=Update                          P3=Return                        P12=Server
</pre></div>
</div>
<p><em>VIRTEL transaction definition for XML input data</em></p>
</div>
<div class="section" id="xml-input-with-attributes-and-repeating-groups">
<span id="index-332"></span><h5>XML input with attributes and repeating groups<a class="headerlink" href="#xml-input-with-attributes-and-repeating-groups" title="Permalink to this headline">¶</a></h5>
<p>The figure below shows an example of XML input data containing attributes and repeating groups of fields:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;request&gt;
&lt;id type=&quot;RP&quot; date=&quot;20.01.2006&quot; numreq=&quot;2&quot;&gt;8019A&lt;/id&gt;
&lt;part&gt;
    &lt;key suffix=&quot;01&quot;&gt;GROMMET&lt;/key&gt;
    &lt;stat&gt;3&lt;/stat&gt;
    &lt;type&gt;C&lt;/type&gt;
&lt;/part&gt;
&lt;part&gt;
    &lt;key suffix=&quot;02&quot;&gt;GREVILE&lt;/key&gt;
    &lt;type&gt;D&lt;/type&gt;
    &lt;stat&gt;3&lt;/stat&gt;
&lt;/part&gt;
&lt;/request&gt;
</pre></div>
</div>
<p><em>Example XML input data with attributes and repeating groups</em></p>
<p id="index-333">An INITIAL scenario for processing this XML input data is coded in the presentation module SCENXMLA shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SCENXMLA    SCREENS APPL=SCENXMLA
*
            SCENARIO INITIAL
*
COMMAREA    MAP$ BEGIN
            MAP$ AREA,WITH=&#39;id&#39;,LENGTH=5
            MAP$ AREA-ATTRIBUTE,VALUEOF=&#39;date&#39;,LENGTH=8,TYPE=ONLY9
            MAP$ AREA-ATTRIBUTE,VALUEOF=&#39;type&#39;,LENGTH=2
            MAP$ AREA-ATTRIBUTE,VALUEOF=&#39;numreq&#39;,LENGTH=2,TYPE=9
DETAIL      MAP$ BEGIN,WITH=&#39;part&#39;,OCCURS=5
            MAP$ AREA-ATTRIBUTE,WITH=&#39;key&#39;,VALUEOF=&#39;suffix&#39;,             *
                LENGTH=2,TYPE=9
            MAP$ AREA,LENGTH=8
            MAP$ AREA,WITH=&#39;type&#39;,LENGTH=1
            MAP$ AREA,WITH=&#39;stat&#39;,LENGTH=1
DETAIL      MAP$ END
COMMAREA    MAP$ END
*
COMMAREA    MAP$ FROM-INPUT
COMMAREA    MAP$ TO-VARIABLE,VAR=&#39;MYCOMMAREA&#39;
            SCENARIO END
*
            SCRNEND
END
</pre></div>
</div>
<p><em>Presentation module for XML input with attributes and repeating groups</em></p>
<p>The figure below shows the 77-byte commarea generated in the VIRTEL variable MYCOMMAREA:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">----+----</span><span class="mi">1</span><span class="o">----+----</span><span class="mi">2</span><span class="o">----+----</span><span class="mi">3</span><span class="o">----+----</span><span class="mi">4</span><span class="o">----+----</span><span class="mi">5</span><span class="o">----+----</span><span class="mi">6</span><span class="o">----+----</span><span class="mi">7</span><span class="o">----+--</span>
<span class="mi">8019</span><span class="n">A20012006RP0201GROMMET</span> <span class="n">C302GREVILE</span> <span class="n">D300</span> <span class="mi">00</span> <span class="mi">00</span>
</pre></div>
</div>
<p><em>Commarea generated from XML input with attributes and repeating groups</em></p>
</div>
<div class="section" id="xml-input-with-redefinition-of-fields">
<span id="index-334"></span><h5>XML input with redefinition of fields<a class="headerlink" href="#xml-input-with-redefinition-of-fields" title="Permalink to this headline">¶</a></h5>
<p>This example shows how the commarea can be redefined according to the value of a field in the XML input. In this
example, the input can be in one of two formats, depending on the value of the field whose name is “reqtype”:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Request type A

&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;request&gt;
    &lt;reqid&gt;1234&lt;/reqid&gt;
    &lt;reqtype&gt;A&lt;/reqtype&gt;
    &lt;itemcode&gt;12345&lt;/itemcode&gt;
    &lt;details&gt;
        &lt;color&gt;blue&lt;/color&gt;
        &lt;quantity&gt;5&lt;/quantity&gt;
    &lt;/details&gt;
&lt;/request&gt;

Request type B

&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;request&gt;
    &lt;reqid&gt;2345&lt;/reqid&gt;
    &lt;reqtype&gt;B&lt;/reqtype&gt;
    &lt;itemcode&gt;23457&lt;/itemcode&gt;
    &lt;details&gt;
        &lt;lang&gt;EN&lt;/lang&gt;
        &lt;format&gt;quarto&lt;/format&gt;
    &lt;/details&gt;
&lt;/request&gt;
</pre></div>
</div>
<p><em>Example XML input data with redefinition of fields</em></p>
<p>An INITIAL scenario for processing this XML input data is coded in the presentation module SCENXMLR shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SCENXMLR    SCREENS APPL=SCENXMLR
*
            SCENARIO INITIAL
*
HEADER      MAP$ BEGIN
            MAP$ AREA,WITH=&#39;reqid&#39;,LENGTH=4,TYPE=9
            MAP$ AREA,WITH=&#39;reqtype&#39;,LENGTH=1,TYPE=X,VAR=&#39;TRIGGER&#39;
            MAP$ AREA,WITH=&#39;itemcode&#39;,LENGTH=6,TYPE=9
HEADER      MAP$ END
*
HEADER      MAP$ FROM-INPUT,FIELD=&#39;MYINPUT&#39;
HEADER      MAP$ TO-VARIABLE,VAR=&#39;MYHEAD&#39;
*
            IF$ VARIABLE,&#39;TRIGGER&#39;,EQ=&#39;A&#39;,THEN=TYPEA
            IF$ VARIABLE,&#39;TRIGGER&#39;,EQ=&#39;B&#39;,THEN=TYPEB
            SCENARIO END
*
TYPEA       EQU *
DETAILA     MAP$ BEGIN,WITH=&#39;details&#39;
            MAP$ AREA,WITH=&#39;color&#39;,LENGTH=8,TYPE=X
            MAP$ AREA,WITH=&#39;quantity&#39;,LENGTH=5,TYPE=9
DETAILA     MAP$ END
*
DETAILA     MAP$ FROM-INPUT,FIELD=&#39;MYINPUT&#39;
DETAILA     MAP$ TO-VARIABLE,VAR=&#39;MYBODY&#39;
            SCENARIO END
*
TYPEB       EQU *
DETAILB     MAP$ BEGIN,WITH=&#39;details&#39;
            MAP$ AREA,WITH=&#39;lang&#39;,LENGTH=2,TYPE=X
            MAP$ AREA,WITH=&#39;format&#39;,LENGTH=8,TYPE=X
DETAILB     MAP$ END
*
DETAILB     MAP$ FROM-INPUT,FIELD=&#39;MYINPUT&#39;
DETAILB     MAP$ TO-VARIABLE,VAR=&#39;MYBODY&#39;
            SCENARIO END
*
            SCRNEND
END
</pre></div>
</div>
<p><em>Presentation module for XML input with redefinition of fields</em></p>
<p>This scenario generates two commareas, which are saved in VIRTEL variables MYHEAD and MYBODY, as shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Request</span> <span class="nb">type</span> <span class="n">A</span>
<span class="o">----+----</span><span class="mi">1</span><span class="o">----+----</span><span class="mi">2</span><span class="o">----+----</span><span class="mi">3</span>
<span class="n">MYHEAD</span><span class="p">:</span> <span class="mi">1234</span><span class="n">A012345</span>
<span class="n">MYBODY</span><span class="p">:</span> <span class="n">blue</span> <span class="mi">00005</span>

<span class="n">Request</span> <span class="nb">type</span> <span class="n">B</span>
<span class="o">----+----</span><span class="mi">1</span><span class="o">----+----</span><span class="mi">2</span><span class="o">----+----</span><span class="mi">3</span>
<span class="n">MYHEAD</span><span class="p">:</span> <span class="mi">2345</span><span class="n">B023457</span>
<span class="n">MYBODY</span><span class="p">:</span> <span class="n">ENquarto</span>
</pre></div>
</div>
<p><em>Commarea generated from XML input with redefinition of fields</em></p>
</div>
</div>
<div class="section" id="presentation-of-xml-output">
<span id="index-335"></span><h4>Presentation of XML output<a class="headerlink" href="#presentation-of-xml-output" title="Permalink to this headline">¶</a></h4>
<p>By using an output scenario and a suitable page template, VIRTEL can transform application program output into XML when the result is sent back in the HTTP response.</p>
<div class="section" id="presentation-module-for-xml-output">
<h5>Presentation module for XML output<a class="headerlink" href="#presentation-module-for-xml-output" title="Permalink to this headline">¶</a></h5>
<p>An output scenario is used to extract data from the output 3270 data stream of the transaction and place it into one or
more table variables. The example presentation module SCENXMLO shown below contains an OUTPUT scenario which
creates two variables, ACCTNUM and FULLNAME, from a table of values displayed on the 3270 screen:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>SCENXMLO    SCREENS EXEC=NO
SCENARIO    OUTPUT
            IF$ (04,2,6),EQ=&#39; &#39;,THEN=SKIP04
            COPY$ SCREEN-TO-VARIABLE,SCREEN=(04,2,6),VAR=&#39;ACCTNUM&#39;
            COPY$ SCREEN-TO-VARIABLE,SCREEN=(04,10,20),VAR=&#39;FULLNAME&#39;
SKIP04      EQU *
            IF$ (05,2,6),EQ=&#39; &#39;,THEN=SKIP05
            COPY$ SCREEN-TO-VARIABLE,SCREEN=(05,2,6),VAR=&#39;ACCTNUM&#39;
            COPY$ SCREEN-TO-VARIABLE,SCREEN=(05,10,20),VAR=&#39;FULLNAME&#39;
SKIP05      EQU *
            IF$ (06,2,6),EQ=&#39; &#39;,THEN=SKIP06
            COPY$ SCREEN-TO-VARIABLE,SCREEN=(06,2,6),VAR=&#39;ACCTNUM&#39;
            COPY$ SCREEN-TO-VARIABLE,SCREEN=(06,10,20),VAR=&#39;FULLNAME&#39;
SKIP06      EQU *
            IF$ (07,2,6),EQ=&#39; &#39;,THEN=SKIP07
            COPY$ SCREEN-TO-VARIABLE,SCREEN=(07,2,6),VAR=&#39;ACCTNUM&#39;
            COPY$ SCREEN-TO-VARIABLE,SCREEN=(07,10,20),VAR=&#39;FULLNAME&#39;
SKIP07      EQU *
            SCENARIO END
            SCRNEND
            END
</pre></div>
</div>
<p><em>HTTP presentation module for XML output</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is also possible for the application program to create VIRTEL table variables directly, either by means of an <a class="reference internal" href="#ug-fae5"><span class="std std-ref">“FAE5”</span></a> structured field, or via the HOST4WEB command <a class="reference internal" href="#ug-set-variable"><span class="std std-ref">“SET VARIABLE”</span></a>. The FAE5 structured field allows the application to pass large amounts of raw data to VIRTEL without being constrained by the limitations of the 3270 screen geometry. For such “VIRTEL-aware” applications, an output scenario is not necessary.</p>
</div>
</div>
<div class="section" id="page-template-for-xml-output">
<span id="index-336"></span><h5>Page template for XML output<a class="headerlink" href="#page-template-for-xml-output" title="Permalink to this headline">¶</a></h5>
<p>The URL in this example is /demohttp/xmldemo.xml+tran3 which requests VIRTEL to use the page template
xmldemo.xml to process the output of the tran3 transaction. The purpose of the page template is to convert the
transaction output into XML format.</p>
<p>In the page template xmldemo.xml shown below, the output data is obtained from the VIRTEL table variables
ACCTNUM and FULLNAME which were created either by the output scenario SCENXMLO, or directly by the application
program:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!--VIRTEL start=&quot;{{{&quot; end=&quot;}}}&quot; --&gt;
{{{SET-OUTPUT-ENCODING-UTF-8 &quot;&quot;}}}
&lt;accounts&gt;
{{{FOR-EACH-VALUE-IN &quot;ACCTNUM&quot;}}}
    &lt;account&gt;
        &lt;id&gt;{{{TRIMMED-VALUE-OF &quot;ACCTNUM&quot;}}}&lt;/id&gt;
        &lt;name&gt;{{{TRIMMED-VALUE-OF &quot;FULLNAME&quot;}}}&lt;/name&gt;
    &lt;account&gt;
{{{END-FOR &quot;ACCTNUM&quot;}}}
&lt;/accounts&gt;
</pre></div>
</div>
<p><em>Example page template for XML output data</em></p>
<span class="target" id="ug-xml-parser"></span></div>
</div>
<div class="section" id="virtel-as-an-xml-parser-generator">
<span id="index-337"></span><h4>VIRTEL as an XML parser/generator<a class="headerlink" href="#virtel-as-an-xml-parser-generator" title="Permalink to this headline">¶</a></h4>
<p>An application can use the VIRTEL HTTP server as an XML parser/generator engine. A client program establishes a TCP/
IP session with the VIRTEL HTTP server, and sends XML or commarea data to VIRTEL in an HTTP request. VIRTEL
performs conversion to or from XML, and returns the resulting commarea or XML data to the client program in the
HTTP response.</p>
<p>It is the INITIAL scenario associated with the VIRTEL transaction which determines whether the conversion is from XML
to commarea format, or vice versa. Conversion from XML to commarea format is performed by a transaction whose
INITIAL scenario contains a MAP$ FROM-FIELD or MAP$ FROM-INPUT instruction. Conversion from commarea to XML
format is performed by a transaction whose INITIAL scenario contains a TOVAR$ FROM-FIELD or TOVAR$ FROM-INPUT
instruction. Both scenarios can reference a common set of MAP$ statements which describe the relationship between
the XML stream and the commarea. In each case an appropriate page template must also be used, as shown in the
detailed examples which follow.</p>
<div class="section" id="communication-via-virkix">
<span id="index-338"></span><h5>Communication via VIRKIX<a class="headerlink" href="#communication-via-virkix" title="Permalink to this headline">¶</a></h5>
<p>A client program running under CICS on MVS can use VIRKIX to establish the HTTP connection, send the request, and
receive the response. The client program may send the request in either ASCII or EBCDIC; both formats are recognized
and supported by VIRTEL. Notice the use of the special header GIVE-LENGTH-PREFIX which requests VIRTEL to add a
4-byte length prefix to the HTTP response, to conform with the format expected by VIRKIX CALL type ‘M’.</p>
</div>
<div class="section" id="example-map-statements">
<span id="index-339"></span><h5>Example MAP$ statements<a class="headerlink" href="#example-map-statements" title="Permalink to this headline">¶</a></h5>
<p>The copy member SCONVMAP shown below contains the MAP$ statements common to both examples presented in
this section. This member is copied into each of the scenarios SCONVXML and SCONVPLA by means of an assembler
COPY statement.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Member name SCONVMAP

CAREA       MAP$ BEGIN
            MAP$ AREA,WITH=&#39;date&#39;,LENGTH=8,TYPE=(ONLY9,LEFT-ALIGNED),     *
                FORMAT=(&#39;9999-99-99&#39;,9)
IDENT       MAP$ BEGIN,WITH=&#39;identity&#39;
            MAP$ EVENTUAL-AREA,FROM-CONSTANT,&#39;1&#39;,WHEN=(ELEMENT,&#39;bic&#39;)
            MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#39;2&#39;,WHEN=(ELEMENT,&#39;iban&#39;)
            MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#39;3&#39;,WHEN=(ELEMENT,&#39;rib&#39;)
            MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#39; &#39;
            MAP$ AREA,LENGTH=8
IDENT       MAP$ END
VERIF       MAP$ BEGIN,WITH=&#39;verified&#39;
            MAP$ EVENTUAL-AREA,FROM-CONSTANT,&#39;1&#39;,WHEN=(VALUE,&#39;yes&#39;)
            MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#39;0&#39;,WHEN=(VALUE,&#39;no&#39;)
            MAP$ ELSETHEN-AREA,FROM-CONSTANT,&#39;0&#39;
VERIF       MAP$ END
            MAP$ AREA,WITH=&#39;amount&#39;,LENGTH=5,TYPE=ONLY9,                  *
                FORMAT=(&#39;$999.99&#39;,9)
CAREA MAP$ END
</pre></div>
</div>
<p><em>MAP$ statements for VIRTEL XML parser/generator</em></p>
</div>
<div class="section" id="xml-to-commarea-conversion-using-the-virtel-xml-parser">
<span id="index-340"></span><h5>XML-to-commarea conversion using the VIRTEL XML parser<a class="headerlink" href="#xml-to-commarea-conversion-using-the-virtel-xml-parser" title="Permalink to this headline">¶</a></h5>
<p>The figure below shows an example transaction definition to be used for XML-to-commarea conversion using the
VIRTEL XML parser. The external name “tranxml” is the name referenced in the URL of the HTTP request which calls
the transaction. The special application name $NONE$ indicates that no host application is to be called. The /&amp;S order
specified in the “TIOA at Logon” field causes the INITIAL scenario <a class="reference internal" href="#ug-sconvxml"><span class="std std-ref">“SCONVXML”</span></a> to be executed.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>TRANSACTION DETAIL DEFINITION ---------------------- Applid: VIRTELD2 16:39:25
Internal name ===&gt; HTTP-16X               To associate with an entry point name
External name ===&gt; tranxml                Name displayed on user menu
Description   ===&gt; VIRTEL XML parser
Application   ===&gt; $NONE$                 Application to be called
PassTicket    ===&gt; 0 Name ===&gt;            0=no 1=yes 2=unsigned
Application type ===&gt; 2                   1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE
Pseudo-terminals ===&gt; HTLOC               Prefix of name of partner terminals
Logmode ===&gt;                              Specify when LOGMODE must be changed
How started ===&gt; 1                        1=menu 2=sub-menu 3=auto
Security ===&gt; 0                           0=none 1=basic 2=NTLM 3=TLS 4=HTML
H4W commands ? ===&gt;                       0=no 1=yes 2=if2VIRTEL 4=auto
Logon message ===&gt;

TIOA at logon ===&gt; &amp;/S &amp;/T

TIOA at logoff ===&gt;

Initial Scenario ===&gt; SCONVXML            Final Scenario    ===&gt;
Input Scenario   ===&gt;                     Output Scenario   ===&gt;

P1=Update P3=Return P12=Server
</pre></div>
</div>
<p><em>VIRTEL transaction definition for XML-to-commarea conversion</em></p>
<p>The initial scenario for XML-to-commarea conversion is shown below:</p>
<div class="highlight-default" id="ug-sconvxml"><div class="highlight"><pre><span></span>Member name SCONVXML

SCONVXML    SCREENS APPL=SCONVXML
SCENARIO    INITIAL
            COPY SCONVMAP (copy member shown in Figure 1 -126)
CAREA       MAP$ FROM-INPUT
CAREA       MAP$ TO-VARIABLE,VAR=&#39;MYAREA&#39;
            SCENARIO END
            SCRNEND
END
</pre></div>
</div>
<p><em>Initial scenario for XML-to-commarea conversion</em></p>
<p>An example request for XML-to-commarea conversion using the VIRTEL XML parser is shown in the figure below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>POST /demohttp/myarea.txt+tranxml HTTP/1.1
Host: 192.168.235.30
Accept: */*
Content-Length: 172
Special: GIVE-LENGTH-PREFIX
&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;request&gt;
    &lt;date&gt;2006-06-21&lt;/date&gt;
    &lt;identity&gt;&lt;iban&gt;AB1234CD&lt;/iban&gt;&lt;/identity&gt;
    &lt;verified&gt;yes&lt;/verified&gt;
    &lt;amount&gt;$123.45&lt;/amount&gt;
&lt;/request&gt;
</pre></div>
</div>
<p><em>Input request for XML-to-commarea conversion</em></p>
<p>The HTTP request shown above specifies the use of a page template named myarea.txt which is stored in a VIRTEL
directory and is shown in the figure below. By use of this page template, the commarea MYAREA created by the
INITIAL scenario SCONVXML is inserted into the HTTP response data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Page template myarea.txt

&lt;!--VIRTEL start=&quot;{{{&quot; end=&quot;}}}&quot; --&gt;
{{{ SET-CONTENT-TYPE &quot;text/plain&quot;}}}
{{{ CURRENT-VALUE-OF &quot;MYAREA&quot; }}}
</pre></div>
</div>
<p><em>Page template for XML-to-commarea conversion</em></p>
<p>The figure below shows the HTTP response returned by VIRTEL. The body of the response contains the input data converted to commarea format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">Ok</span>
<span class="n">Server</span><span class="p">:</span> <span class="n">Virtel</span><span class="o">/</span><span class="mf">4.32</span>
<span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">21</span> <span class="n">Jun</span> <span class="mi">2006</span> <span class="mi">15</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">02</span> <span class="n">GMT</span>
<span class="n">Expires</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Content</span><span class="o">-</span><span class="n">length</span><span class="p">:</span> <span class="mi">00000029</span>
<span class="n">Content</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">plain</span>
<span class="mi">200606212</span><span class="n">AB1234CD112345</span>
</pre></div>
</div>
<p><em>Output response from XML-to-commarea conversion</em></p>
</div>
<div class="section" id="commarea-to-xml-conversion-using-the-virtel-xml-generator">
<span id="index-341"></span><h5>Commarea-to-XML conversion using the VIRTEL XML generator<a class="headerlink" href="#commarea-to-xml-conversion-using-the-virtel-xml-generator" title="Permalink to this headline">¶</a></h5>
<p>The figure below shows an example transaction definition to be used for commarea-to-XML conversion using the
VIRTEL XML generator. The external name “trancom” is the name referenced in the URL of the HTTP request which
calls the transaction. The special application name $NONE$ indicates that no host application is to be called. The /&amp;S
order specified in the “TIOA at Logon” field causes the INITIAL scenario <a class="reference internal" href="#ug-sconvpla"><span class="std std-ref">“SCONVPLA”</span></a> to be executed.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>TRANSACTION DETAIL DEFINITION ---------------------- Applid: VIRTELD2 16:39:58
Internal name ===&gt; HTTP-16Y               To associate with an entry point name
External name ===&gt; trancom                Name displayed on user menu
Description   ===&gt; VIRTEL XML generator
Application   ===&gt; $NONE$                 Application to be called
PassTicket   ===&gt; 0 Name ===&gt;             0=no 1=yes 2=unsigned
Application type ===&gt; 2                   1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE
Pseudo-terminals ===&gt; HTLOC               Prefix of name of partner terminals
Logmode          ===&gt;                     Specify when LOGMODE must be changed
How started      ===&gt; 1                   1=menu 2=sub-menu 3=auto
Security         ===&gt; 0                   0=none 1=basic 2=NTLM 3=TLS 4=HTML
H4W commands ?   ===&gt;                     0=no 1=yes 2=if2VIRTEL 4=auto
Logon message    ===&gt;
TIOA at logon    ===&gt; &amp;/S &amp;/T

TIOA at logoff   ===&gt;

Initial Scenario ===&gt; SCONVPLA         Final Scenario  ===&gt;
Input Scenario   ===&gt;                  Output Scenario ===&gt;

P1=Update                       P3=Return                           P12=Server
</pre></div>
</div>
<p><em>VIRTEL transaction definition for commarea-to-XML conversion</em></p>
<span class="target" id="ug-sconvpla"></span><p id="index-342">The initial scenario for commarea-to-XML conversion is shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Member name SCONVPLA

SCONVPLA SCREENS APPL=SCONVPLA
SCENARIO INITIAL
COPY SCONVMAP
CAREA TOVAR$ FROM-INPUT
SCENARIO END
SCRNEND
END
</pre></div>
</div>
<p><em>Initial scenario for commarea-to-XML conversion</em></p>
<p>An example request for commarea-to-XML conversion using the VIRTEL XML parser is shown in the figure below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">POST</span> <span class="o">/</span><span class="n">demohttp</span><span class="o">/</span><span class="n">mydata</span><span class="o">.</span><span class="n">xml</span><span class="o">+</span><span class="n">trancom</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Host</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">235.30</span>
<span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">27</span>
<span class="n">Special</span><span class="p">:</span> <span class="n">GIVE</span><span class="o">-</span><span class="n">LENGTH</span><span class="o">-</span><span class="n">PREFIX</span>
<span class="mi">200606212</span><span class="n">AB1234CD112345</span>
</pre></div>
</div>
<p><em>Input request for commarea-to-XML conversion</em></p>
<p>The HTTP request shown above specifies the use of a page template named mydata.xml which is stored in a VIRTEL
directory and is shown in the figure below. By use of this page template, the output variables created by the TOVAR$
instruction in the INITIAL scenario SCONVPLA are inserted into the HTTP response data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Page template mydata.xml

&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!--VIRTEL start=&quot;{{{&quot; end=&quot;}}}&quot; --&gt;
{{{ SET-CONTENT-TYPE &quot;text/xml&quot;}}}{{{SET-OUTPUT-ENCODING-UTF-8 &quot;&quot;}}}
&lt;request&gt;
 &lt;date&gt;{{{CURRENT-VALUE-OF &quot;date&quot;}}}&lt;/date&gt;
 &lt;identity&gt;
  {{{WHEN-EXISTS &quot;bic&quot;}}}&lt;bic&gt;{{{CURRENT-VALUE-OF &quot;bic&quot;}}}&lt;/bic&gt;{{{END
 -WHEN-EXISTS &quot;bic&quot;}}}
  {{{WHEN-EXISTS &quot;iban&quot;}}}&lt;iban&gt;{{{CURRENT-VALUE-OF
 &quot;iban&quot;}}}&lt;/iban&gt;{{{END-WHEN-EXISTS &quot;iban&quot;}}}
  {{{WHEN-EXISTS &quot;rib&quot;}}}&lt;rib&gt;{{{CURRENT-VALUE-OF &quot;rib&quot;}}}&lt;/rib&gt;{{{END
 -WHEN-EXISTS &quot;rib&quot;}}}
 &lt;/identity&gt;
 &lt;verified&gt;{{{CURRENT-VALUE-OF &quot;verified&quot;}}}&lt;/verified&gt;
 &lt;amount&gt;{{{CURRENT-VALUE-OF &quot;amount&quot;}}}&lt;/amount&gt;
&lt;/request&gt;
</pre></div>
</div>
<p><em>Page template for commarea-to-XML conversion</em></p>
<p>The figure below shows the HTTP response returned by VIRTEL. The body of the response contains the input
commarea data converted to XML format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>HTTP/1.1 200 Ok
Server: Virtel/4.32
Date: Wed, 21 Jun 2006 16:02:55 GMT
Expires: 0
Content-length: 00000207
Content-type: text/xml

&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;request&gt;
    &lt;date&gt;2006-06-21&lt;/date&gt;
    &lt;identity&gt;
        &lt;iban&gt;AB1234CD&lt;/iban&gt;
    &lt;/identity&gt;
    &lt;verified&gt;yes&lt;/verified&gt;
    &lt;amount&gt;$123.45&lt;/amount&gt;
&lt;/request&gt;
</pre></div>
</div>
<p><em>Output response from commarea-to-XML conversion</em></p>
</div>
</div>
<div class="section" id="automatic-scenario-generation">
<span id="index-343"></span><h4>Automatic scenario generation<a class="headerlink" href="#automatic-scenario-generation" title="Permalink to this headline">¶</a></h4>
<div class="section" id="mapgen-program">
<span id="index-344"></span><h5>MAPGEN program<a class="headerlink" href="#mapgen-program" title="Permalink to this headline">¶</a></h5>
<p>The MAPGEN program allows the automatic generation of scenarios from COBOL copybooks.
The input to the MAPGEN program is a COBOL copybook containing data division definitions of a commarea. The
output from the MAPGEN program may be:
• a scenario for “input-to-commarea” conversion
• a scenario for “commarea-to-output” conversion
• an optional page template to convert the generated output variables into XML format
The MAPGEN program (MAPGREX) and the JCL to execute it (MAPGJCL) are delivered as members of the VIRTEL
SAMPLIB. The start of the MAPGJCL job is shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">VIRMAPGN</span> <span class="n">JOB</span> <span class="mi">1</span><span class="p">,</span><span class="n">MAPGEN</span><span class="p">,</span><span class="n">CLASS</span><span class="o">=</span><span class="n">A</span><span class="p">,</span><span class="n">MSGCLASS</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">NOTIFY</span><span class="o">=&amp;</span><span class="n">SYSUID</span>
<span class="o">//*</span>
<span class="o">//*</span> <span class="n">MAPGEN</span> <span class="p">:</span> <span class="n">Generate</span> <span class="n">VIRTEL</span> <span class="n">SCENARIO</span> <span class="kn">from</span> <span class="nn">COBOL</span> <span class="n">copybook</span>
<span class="o">//*</span>
<span class="o">//</span> <span class="n">SET</span> <span class="n">QUAL</span><span class="o">=</span><span class="n">yourqual</span><span class="o">.</span><span class="n">VIRTnnn</span> <span class="n">Prefix</span> <span class="n">of</span> <span class="n">VIRTEL</span> <span class="n">dataset</span> <span class="n">names</span>
<span class="o">//</span> <span class="n">SET</span> <span class="n">COPYLIB</span><span class="o">=</span><span class="n">your</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">srcelib</span> <span class="n">Library</span> <span class="n">containing</span> <span class="n">copybook</span>
<span class="o">//</span> <span class="n">SET</span> <span class="n">MEMBER</span><span class="o">=</span><span class="n">copybook</span> <span class="n">Copybook</span> <span class="n">member</span> <span class="n">name</span>
<span class="o">//</span> <span class="n">SET</span> <span class="n">STYLE</span><span class="o">=</span><span class="n">APOST</span> <span class="n">APOST</span> <span class="ow">or</span> <span class="n">QUOTE</span>
<span class="o">//</span> <span class="n">SET</span> <span class="n">PREFIX</span><span class="o">=</span><span class="s1">&#39;TIOA-&#39;</span> <span class="n">Field</span> <span class="n">name</span> <span class="n">prefix</span> <span class="n">to</span> <span class="n">be</span> <span class="n">removed</span>
<span class="o">//</span> <span class="n">SET</span> <span class="n">CASE</span><span class="o">=</span><span class="n">LOWER</span> <span class="n">Field</span> <span class="n">names</span> <span class="n">UPPER</span> <span class="ow">or</span> <span class="n">LOWER</span> <span class="n">case</span>
<span class="o">//</span> <span class="n">SET</span> <span class="n">CODE</span><span class="o">=</span><span class="s1">&#39;ENC=IE&#39;</span> <span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> <span class="ow">or</span> <span class="n">ISO</span> <span class="ow">or</span> <span class="n">ENC</span><span class="o">=</span><span class="n">varname</span>
<span class="o">//</span> <span class="n">SET</span> <span class="n">FORMAT</span><span class="o">=</span><span class="n">QUERY</span> <span class="n">XML</span> <span class="n">QUERY</span> <span class="s1">&#39;XML=f&#39;</span> <span class="n">COM</span> <span class="s1">&#39;COM=x&#39;</span>
<span class="o">//</span> <span class="n">SET</span> <span class="n">VAR</span><span class="o">=</span><span class="n">MYCOMMAREA</span> <span class="n">Output</span> <span class="p">(</span><span class="n">XML</span><span class="o">/</span><span class="n">QUERY</span><span class="p">)</span> <span class="n">Input</span> <span class="p">(</span><span class="n">COM</span><span class="p">)</span>
<span class="o">//</span> <span class="n">SET</span> <span class="n">XMLGEN</span><span class="o">=</span><span class="n">NO</span> <span class="n">YES</span> <span class="ow">or</span> <span class="n">NO</span> <span class="n">to</span> <span class="n">run</span> <span class="n">XMLGEN</span> <span class="n">step</span>
<span class="o">//*</span>
</pre></div>
</div>
<p><em>Automatic scenario generation: MAPGJCL job</em></p>
<p>The parameters required to customize this job are coded as SET statements at the start of the job. The meaning of the parameters is as follows:</p>
<dl class="docutils">
<dt>QUAL=yourqual.VIRTnnn</dt>
<dd>Prefix of VIRTEL dataset names. This job requires access to the SAMPLIB, LOADLIB, and SCRNAPI.MACLIB datasets. The generated scenario is written as a load module in the LOADLIB dataset.</dd>
<dt>COPYLIB=your.cobol.srcelib</dt>
<dd>Name of library containing the input copybook</dd>
<dt>MEMBER=copybook</dt>
<dd>Member name of the input copybook in the COPYLIB library</dd>
<dt>STYLE=APOST|QUOTE</dt>
<dd>STYLE specifies whether the copybook uses single or double quotation marks to delimit strings. APOST (single quotation marks) is the default.</dd>
<dt>PREFIX=’prefix’</dt>
<dd>(optional) If specified, the prefix will be removed from the field names in the copybook</dd>
<dt>CASE=LOWER|UPPER</dt>
<dd>(optional) If specified, all field names in the copybook will be converted to LOWER or UPPER case. If not specified, the case will be preserved.</dd>
<dt>CODE=encoding</dt>
<dd><p class="first">(optional) Specifies the encoding of HTML form-field parameters in the input URL. The following encodings may be specified:-</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>UTF-8</dt>
<dd>Input form-fields are encoded in UTF-8 format</dd>
<dt>ISO</dt>
<dd>Input form-fields are encoded in non-UTF-8 format</dd>
<dt>‘ENC=fieldname’</dt>
<dd>The contents of the URL form-field named fieldname are queried to obtain the encoding value (UTF-8 or ISO). This allows the client to dynamically specify the encoding method by means of a URL parameter. If CODE is not specified, or if CODE=’ENC=fieldname’ is specified and the URL does not contain the parameter fieldname=UTF-8 or fieldname=ISO, then the VIRTEL default encoding (ISO) is assumed.</dd>
</dl>
</div></blockquote>
</dd>
<dt>FORMAT=format</dt>
<dd><p class="first">Specifies the type of scenario to be generated. The following formats may be specified:-</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>QUERY</dt>
<dd>Generates an INITIAL scenario which accepts input data encoded as HTML form-fields, and produces an output commarea. The generated scenario contains a <a class="reference internal" href="#ug-map-from-input"><span class="std std-ref">“MAP$ FROM-INPUT”</span></a>, QUERY instruction.</dd>
<dt>XML</dt>
<dd>Generates an INITIAL scenario which accepts XML input data in the body of an HTTP request, and produces an output commarea. The generated scenario contains a <a class="reference internal" href="#ug-map-from-input"><span class="std std-ref">“MAP$ FROM-INPUT”</span></a>, XML instruction.</dd>
<dt>‘XML=fieldname’</dt>
<dd>Generates an INITIAL scenario which accepts XML input encoded within an HTML form-field named fieldname, and produces an output commarea. The generated scenario contains a <a class="reference internal" href="#ug-map-from-field"><span class="std std-ref">“MAP$ FROM-FIELD”</span></a> instruction with the parameter FIELD=fieldname.</dd>
<dt>COM</dt>
<dd><p class="first">When VAR is not specified: Generates an INITIAL scenario which accepts an input commarea in the body of an HTTP request, and produces a set of VIRTEL variables whose names correspond to the fields in the copybook. The generated scenario contains a <a class="reference internal" href="#ug-tovar-from-input"><span class="std std-ref">“TOVAR$ FROM-INPUT”</span></a> instruction.</p>
<p class="last">When VAR is specified: Generates an OUTPUT scenario which accepts an input commarea contained in the VIRTEL variable named by the VAR parameter, and produces a set of VIRTEL variables whose names correspond to the fields in the copybook. The generated scenario contains a <a class="reference internal" href="#ug-map-from-variable"><span class="std std-ref">“MAP$ FROM-VARIABLE”</span></a> instruction.</p>
</dd>
<dt>‘COM=fieldname’</dt>
<dd>Generates an INITIAL scenario which accepts an input commarea encoded within an HTML form-field named fieldname, and produces a set of VIRTEL variables whose names correspond to the fields in the copybook. The generated scenario contains a <a class="reference internal" href="#ug-map-from-field"><span class="std std-ref">“MAP$ FROM-FIELD”</span></a> instruction with the parameter FIELD=fieldname.</dd>
</dl>
</div></blockquote>
</dd>
<dt>VAR=commareaname</dt>
<dd><dl class="first last docutils">
<dt>For FORMAT=QUERY, FORMAT=XML, FORMAT=’XML=fieldname’</dt>
<dd>Specifies the name of the VIRTEL variable into which the output commarea is written. If not specified, the default is VAR=AREA</dd>
<dt>For FORMAT=COM</dt>
<dd>Optionally specifies the name of the VIRTEL variable which contains the input commarea</dd>
</dl>
</dd>
<dt>XMLGEN=YES|NO</dt>
<dd>Specifies whether an additional XMLGEN step is to be run. This parameter is useful when FORMAT=COM or FORMAT=’COM=fieldname’ is specified. If XMLGEN=YES then the job also generates a VIRTEL page template suitable for converting the VIRTEL result variables into XML format. The generated page template is written to userid.XMLGEN.OUTPUT which must be preallocated as a sequential dataset. The contents of this dataset should then be transferred to your workstation where it can be uploaded into a VIRTEL directory (see <a class="reference internal" href="#ug-uploading-html-pages"><span class="std std-ref">“Uploading pages by HTTP”</span></a>).</dd>
</dl>
<span class="target" id="ug-email-incoming"></span></div>
</div>
</div>
<div class="section" id="incoming-e-mails">
<span id="index-345"></span><h3>Incoming E-mails<a class="headerlink" href="#incoming-e-mails" title="Permalink to this headline">¶</a></h3>
<p>The arrival of an e-mail on an SMTP line can trigger one of two types of action in VIRTEL, depending on the entry point chosen by the rules of the SMTP line:</p>
<ul class="simple">
<li>Transfer of attached files to a VIRTEL directory</li>
<li>Start a CICS transaction (or other VTAM application)</li>
</ul>
<div class="section" id="rules-of-the-smtp-line">
<span id="index-346"></span><h4>Rules of the SMTP line<a class="headerlink" href="#rules-of-the-smtp-line" title="Permalink to this headline">¶</a></h4>
<p>When an e-mail arrives on an SMTP line, VIRTEL examines the rules of the line to determine which entry point will be
used to process the incoming message. In the example below, the rule specifies that when the e-mail destination
address is <a class="reference external" href="mailto:cicsmail&#37;&#52;&#48;sample&#46;com">cicsmail<span>&#64;</span>sample<span>&#46;</span>com</a>, and the sender address is <a class="reference external" href="mailto:customer&#37;&#52;&#48;client&#46;com">customer<span>&#64;</span>client<span>&#46;</span>com</a>, then entry point SMTPCICS will be
used:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DETAIL</span> <span class="n">of</span> <span class="n">RULE</span> <span class="kn">from</span> <span class="nn">RULE</span> <span class="n">SET</span><span class="p">:</span> <span class="n">S</span><span class="o">-</span><span class="n">SMTP</span> <span class="o">-------------</span> <span class="n">Applid</span><span class="p">:</span> <span class="n">SPVIRE2</span> <span class="mi">15</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Name</span>          <span class="o">===&gt;</span> <span class="n">SM200EML</span>               <span class="n">Rule</span> <span class="n">priority</span> <span class="ow">is</span> <span class="n">per</span> <span class="n">name</span>
<span class="n">Status</span>        <span class="o">===&gt;</span> <span class="n">ACTIVE</span>                 <span class="mi">19</span> <span class="n">May</span> <span class="mi">2004</span> <span class="mi">15</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">00</span> <span class="n">VIRDBA</span>
<span class="n">Description</span>   <span class="o">===&gt;</span> <span class="n">Appels</span> <span class="n">entrants</span> <span class="n">SMTP</span>
<span class="n">Entry</span> <span class="n">point</span>   <span class="o">===&gt;</span> <span class="n">SMTPCICS</span>               <span class="n">Target</span> <span class="n">Entry</span> <span class="n">Point</span>
<span class="n">Parameter</span>     <span class="o">===&gt;</span> <span class="n">optional</span> <span class="o">&amp;</span><span class="mi">1</span> <span class="n">value</span>
<span class="n">Trace</span>         <span class="o">===&gt;</span>                        <span class="mi">1</span><span class="o">=</span><span class="n">commands</span> <span class="mi">2</span><span class="o">=</span><span class="n">data</span> <span class="mi">3</span><span class="o">=</span><span class="n">partner</span>

<span class="n">C</span> <span class="p">:</span> <span class="mi">0</span><span class="o">=</span><span class="n">IGNORE</span> <span class="mi">1</span><span class="o">=</span><span class="n">IS</span> <span class="mi">2</span><span class="o">=</span><span class="n">IS</span> <span class="n">NOT</span> <span class="mi">3</span><span class="o">=</span><span class="n">STARTS</span> <span class="n">WITH</span> <span class="mi">4</span><span class="o">=</span><span class="n">DOES</span> <span class="n">NOT</span> <span class="mi">5</span><span class="o">=</span><span class="n">ENDS</span> <span class="n">WITH</span> <span class="mi">6</span><span class="o">=</span><span class="n">DOES</span> <span class="n">NOT</span>
<span class="mi">0</span> <span class="n">IP</span> <span class="n">Subnet</span>   <span class="o">===&gt;</span> <span class="mf">000.000</span><span class="o">.</span><span class="mf">000.000</span>        <span class="n">Mask</span> <span class="o">===&gt;</span> <span class="mf">000.000</span><span class="o">.</span><span class="mf">000.000</span>
<span class="mi">1</span> <span class="n">Host</span>        <span class="o">===&gt;</span> <span class="n">cicsmail</span><span class="nd">@sample</span><span class="o">.</span><span class="n">com</span>
<span class="mi">1</span> <span class="n">eMail</span>       <span class="o">===&gt;</span> <span class="n">customer</span><span class="nd">@client</span><span class="o">.</span><span class="n">com</span>
<span class="mi">0</span> <span class="n">Calling</span> <span class="n">DTE</span> <span class="o">===&gt;</span>                        <span class="n">Calling</span> <span class="n">DTE</span> <span class="n">address</span>
<span class="mi">0</span> <span class="n">Called</span>      <span class="o">===&gt;</span>                        <span class="n">Called</span> <span class="n">DTE</span> <span class="n">address</span>
<span class="mi">0</span> <span class="n">CUD0</span> <span class="p">(</span><span class="n">Hex</span><span class="p">)</span>  <span class="o">===&gt;</span>                        <span class="n">First</span> <span class="mi">4</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">CUD</span> <span class="p">(</span><span class="n">X25</span> <span class="n">protocol</span><span class="p">)</span>
<span class="mi">0</span> <span class="n">User</span> <span class="n">Data</span>   <span class="o">===&gt;</span>

<span class="mi">0</span> <span class="n">Days</span>        <span class="o">===&gt;</span> <span class="n">M</span><span class="p">:</span>     <span class="n">T</span><span class="p">:</span>      <span class="n">W</span><span class="p">:</span>      <span class="n">T</span><span class="p">:</span>      <span class="n">F</span><span class="p">:</span>      <span class="n">S</span><span class="p">:</span>      <span class="n">S</span><span class="p">:</span>
<span class="mi">0</span> <span class="n">Start</span> <span class="n">time</span>  <span class="o">===&gt;</span> <span class="n">H</span><span class="p">:</span>     <span class="n">M</span><span class="p">:</span>      <span class="n">S</span><span class="p">:</span>     <span class="n">End</span> <span class="n">time</span> <span class="o">===&gt;</span> <span class="n">H</span><span class="p">:</span>      <span class="n">M</span><span class="p">:</span>      <span class="n">S</span><span class="p">:</span>

<span class="n">P1</span><span class="o">=</span><span class="n">Update</span>                        <span class="n">P3</span><span class="o">=</span><span class="n">Return</span>                        <span class="n">Enter</span><span class="o">=</span><span class="n">Add</span>
<span class="n">P4</span><span class="o">=</span><span class="n">Activate</span>                      <span class="n">P5</span><span class="o">=</span><span class="n">Inactivate</span>                    <span class="n">P12</span><span class="o">=</span><span class="n">Entry</span> <span class="n">P</span><span class="o">.</span>
<span class="n">CREATION</span> <span class="n">OK</span>
</pre></div>
</div>
<p><em>Rule for routing an incoming e-mail on an SMTP line</em></p>
</div>
<div class="section" id="file-transfer-by-e-mail">
<span id="index-347"></span><h4>File transfer by e-mail<a class="headerlink" href="#file-transfer-by-e-mail" title="Permalink to this headline">¶</a></h4>
<p>An entry point which is used for file file transfer (including the upload of HTML pages) has a single transaction which
calls VIRTEL module VIR0041B. This transaction is defined with application type 2 and integration mode 1. The menu
program specified in the entry point must be VIR0021B. Only authorized users can perform transfers. See <em>Correspondent Management</em> in the Virtel Administration Guide.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ENTRY POINT DETAIL DEFINITION ---------------------- Applid: SPVIRE2 15:52:26
Name          ===&gt; SMTP                Name this ENTRY POINT (LOGON DATA)
Description   ===&gt; Receive e-mail for file transfer
Transactions  ===&gt; SMTP                Prefix for associated transactions
Videotex key  ===&gt;                     If videotex, keyword or $NONE$
Transparency  ===&gt;                     Server types NOT to emulate
Time out      ===&gt; 0005   minutes      Maximum inactive time
Do if timeout ===&gt; 0                   0=logoff 1=bip+logoff 2=anti pad
Emulation     ===&gt; EMAIL               Type of terminal:
MINITEL : 40 or 80 columns             PC  : Emulation done by VirtelPC
HTML    : Web Browser                  VT  : VT 100
EBCDIC  : not translated               X25 : uses low level dialog
Signon program           ===&gt;          Controls user name and password
Menu program             ===&gt; VIR0021B  List of transactions
Identification scenario  ===&gt;          eg XML identification
Type 3 compression       ===&gt;          Discover typical screens (Virtel/PC)
Mandatory identification ===&gt;                               (PC or minitel)
3270 swap key            ===&gt;          eg P24
Extended colors          ===&gt;          E: extended X: extended + DBCS

P1=Update                       P3=Return                  P4=Transactions
Enter=Add
</pre></div>
</div>
<p><em>Entry point for file transfer by SMTP</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TRANSACTION</span> <span class="n">DETAIL</span> <span class="n">DEFINITION</span> <span class="o">----------------------</span> <span class="n">Applid</span><span class="p">:</span> <span class="n">SPVIRE2</span> <span class="mi">15</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Internal</span> <span class="n">name</span> <span class="o">===&gt;</span> <span class="n">SMTP</span><span class="o">-</span><span class="mi">05</span>               <span class="n">To</span> <span class="n">associate</span> <span class="k">with</span> <span class="n">an</span> <span class="n">entry</span> <span class="n">point</span> <span class="n">name</span>
<span class="n">External</span> <span class="n">name</span> <span class="o">===&gt;</span> <span class="n">E</span><span class="o">-</span><span class="n">Mail</span>                <span class="n">Name</span> <span class="n">displayed</span> <span class="n">on</span> <span class="n">user</span> <span class="n">menu</span>
<span class="n">Description</span>   <span class="o">===&gt;</span> <span class="n">File</span> <span class="n">transfer</span> <span class="n">by</span> <span class="n">SMTP</span>
<span class="n">Application</span>   <span class="o">===&gt;</span> <span class="n">VIR0041B</span>              <span class="n">Application</span> <span class="n">to</span> <span class="n">be</span> <span class="n">called</span>
<span class="n">PassTicket</span>    <span class="o">===&gt;</span> <span class="mi">0</span> <span class="n">Name</span> <span class="o">===&gt;</span>           <span class="mi">0</span><span class="o">=</span><span class="n">no</span> <span class="mi">1</span><span class="o">=</span><span class="n">yes</span> <span class="mi">2</span><span class="o">=</span><span class="n">unsigned</span>
<span class="n">Application</span> <span class="nb">type</span> <span class="o">===&gt;</span> <span class="mi">2</span>                  <span class="mi">1</span><span class="o">=</span><span class="n">VTAM</span> <span class="mi">2</span><span class="o">=</span><span class="n">VIRTEL</span> <span class="mi">3</span><span class="o">=</span><span class="n">SERV</span> <span class="mi">4</span><span class="o">=</span><span class="n">PAGE</span> <span class="mi">5</span><span class="o">=</span><span class="n">LINE</span>
<span class="n">Pseudo</span><span class="o">-</span><span class="n">terminals</span> <span class="o">===&gt;</span>                    <span class="n">Prefix</span> <span class="n">of</span> <span class="n">name</span> <span class="n">of</span> <span class="n">partner</span> <span class="n">terminals</span>
<span class="n">Logmode</span>          <span class="o">===&gt;</span>                    <span class="n">Specify</span> <span class="n">when</span> <span class="n">LOGMODE</span> <span class="n">must</span> <span class="n">be</span> <span class="n">changed</span>
<span class="n">How</span> <span class="n">started</span>      <span class="o">===&gt;</span> <span class="mi">1</span>                  <span class="mi">1</span><span class="o">=</span><span class="n">menu</span> <span class="mi">2</span><span class="o">=</span><span class="n">sub</span><span class="o">-</span><span class="n">menu</span> <span class="mi">3</span><span class="o">=</span><span class="n">auto</span>
<span class="n">Security</span>         <span class="o">===&gt;</span> <span class="mi">1</span>                  <span class="mi">0</span><span class="o">=</span><span class="n">none</span> <span class="mi">1</span><span class="o">=</span><span class="n">basic</span> <span class="mi">2</span><span class="o">=</span><span class="n">NTLM</span> <span class="mi">3</span><span class="o">=</span><span class="n">TLS</span> <span class="mi">4</span><span class="o">=</span><span class="n">HTML</span>
<span class="n">Translation</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>   <span class="o">===&gt;</span>                    <span class="mi">0</span><span class="o">=</span><span class="n">idem</span> <span class="mi">1</span><span class="o">=</span><span class="mi">8040</span> <span class="mi">2</span><span class="o">=</span><span class="mi">8080</span> <span class="mi">3</span><span class="o">=</span><span class="mi">4040</span> <span class="mi">4</span><span class="o">=</span><span class="n">auto</span>
<span class="n">Logon</span> <span class="n">message</span>    <span class="o">===&gt;</span>

<span class="n">TIOA</span> <span class="n">at</span> <span class="n">logon</span>    <span class="o">===&gt;</span>

<span class="n">TIOA</span> <span class="n">at</span> <span class="n">logoff</span>   <span class="o">===&gt;</span>

<span class="n">Initial</span> <span class="n">Scenario</span> <span class="o">===&gt;</span>                   <span class="n">Final</span> <span class="n">Scenario</span>    <span class="o">===&gt;</span>
<span class="n">Input</span> <span class="n">Scenario</span>   <span class="o">===&gt;</span>                   <span class="n">Output</span> <span class="n">Scenario</span>   <span class="o">===&gt;</span>

<span class="n">P1</span><span class="o">=</span><span class="n">Update</span>                        <span class="n">P3</span><span class="o">=</span><span class="n">Return</span>                     <span class="n">P12</span><span class="o">=</span><span class="n">Server</span>
</pre></div>
</div>
<p><em>Transaction for file transfer by SMTP</em></p>
</div>
<div class="section" id="starting-an-application-by-e-mail">
<span id="index-348"></span><h4>Starting an application by E-Mail<a class="headerlink" href="#starting-an-application-by-e-mail" title="Permalink to this headline">¶</a></h4>
<p>When an entry point is used for starting an application by e-mail, the application must be associated with a relay (or
pseudo-3270 terminal) through which the application can retrieve the contents of the e-mail. It is therefore necessary
to specify the name of a relay LU in the definition of the terminals attached to the SMTP line (refer to the VIRTEL
Connectivity Reference documentation for details of defining an SMTP line).</p>
<p>For this type of application, the entry point chosen by the rules of the SMTP line has a single VIRTEL transaction,
defined with application type 1 and integration mode 1, which calls the target VTAM application (such as CICS). The name
of the CICS transaction to be started can be specified in the “TIOA at logon” field of the VIRTEL transaction definition.</p>
<p>The menu program specified in the entry point must be VIR0021B.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ENTRY POINT DETAIL DEFINITION ---------------------- Applid: SPVIRE2 16:07:14
Name          ===&gt; SMTPCICS            Name this ENTRY POINT (LOGON DATA)
Description   ===&gt; CICS transaction started by email
Transactions  ===&gt; SMCICS              Prefix for associated transactions
Videotex key  ===&gt;                     If videotex, keyword or $NONE$
Transparency  ===&gt;                     Server types NOT to emulate
Time out      ===&gt; 0001   minutes      Maximum inactive time
Do if timeout ===&gt; 0                   0=logoff 1=bip+logoff 2=anti pad
Emulation     ===&gt; EMAIL               Type of terminal:
MINITEL : 40 or 80 columns             PC  : Emulation done by VirtelPC
HTML    : Web Browser                  VT  : VT 100
EBCDIC  : not translated               X25 : uses low level dialog
Signon program           ===&gt;          Controls user name and password
Menu program             ===&gt; VIR0021B  List of transactions
Identification scenario  ===&gt;          eg XML identification
Type 3 compression       ===&gt;          Discover typical screens (Virtel/PC)
Mandatory identification ===&gt;                               (PC or minitel)
3270 swap key            ===&gt;          eg P24
Extended colors          ===&gt;          E: extended X: extended + DBCS

P1=Update                       P3=Return                  P4=Transactions
Enter=Add
</pre></div>
</div>
<p><em>Entry point for application started by SMTP</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TRANSACTION</span> <span class="n">DETAIL</span> <span class="n">DEFINITION</span> <span class="o">----------------------</span> <span class="n">Applid</span><span class="p">:</span> <span class="n">SPVIRE2</span> <span class="mi">15</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Internal</span> <span class="n">name</span> <span class="o">===&gt;</span> <span class="n">SMCICS</span><span class="o">-</span><span class="mi">1</span>              <span class="n">To</span> <span class="n">associate</span> <span class="k">with</span> <span class="n">an</span> <span class="n">entry</span> <span class="n">point</span> <span class="n">name</span>
<span class="n">External</span> <span class="n">name</span> <span class="o">===&gt;</span> <span class="n">MAILIN</span>                <span class="n">Name</span> <span class="n">displayed</span> <span class="n">on</span> <span class="n">user</span> <span class="n">menu</span>
<span class="n">Description</span>   <span class="o">===&gt;</span> <span class="n">CICS</span> <span class="n">transaction</span> <span class="n">started</span> <span class="n">by</span> <span class="n">Email</span>
<span class="n">Application</span>   <span class="o">===&gt;</span> <span class="n">SPCICST</span>               <span class="n">Application</span> <span class="n">to</span> <span class="n">be</span> <span class="n">called</span>
<span class="n">PassTicket</span>    <span class="o">===&gt;</span> <span class="mi">0</span> <span class="n">Name</span> <span class="o">===&gt;</span>           <span class="mi">0</span><span class="o">=</span><span class="n">no</span> <span class="mi">1</span><span class="o">=</span><span class="n">yes</span> <span class="mi">2</span><span class="o">=</span><span class="n">unsigned</span>
<span class="n">Application</span> <span class="nb">type</span> <span class="o">===&gt;</span> <span class="mi">1</span>                  <span class="mi">1</span><span class="o">=</span><span class="n">VTAM</span> <span class="mi">2</span><span class="o">=</span><span class="n">VIRTEL</span> <span class="mi">3</span><span class="o">=</span><span class="n">SERV</span> <span class="mi">4</span><span class="o">=</span><span class="n">PAGE</span> <span class="mi">5</span><span class="o">=</span><span class="n">LINE</span>
<span class="n">Pseudo</span><span class="o">-</span><span class="n">terminals</span> <span class="o">===&gt;</span>                    <span class="n">Prefix</span> <span class="n">of</span> <span class="n">name</span> <span class="n">of</span> <span class="n">partner</span> <span class="n">terminals</span>
<span class="n">Logmode</span>          <span class="o">===&gt;</span>                    <span class="n">Specify</span> <span class="n">when</span> <span class="n">LOGMODE</span> <span class="n">must</span> <span class="n">be</span> <span class="n">changed</span>
<span class="n">How</span> <span class="n">started</span>      <span class="o">===&gt;</span> <span class="mi">1</span>                  <span class="mi">1</span><span class="o">=</span><span class="n">menu</span> <span class="mi">2</span><span class="o">=</span><span class="n">sub</span><span class="o">-</span><span class="n">menu</span> <span class="mi">3</span><span class="o">=</span><span class="n">auto</span>
<span class="n">Security</span>         <span class="o">===&gt;</span> <span class="mi">1</span>                  <span class="mi">0</span><span class="o">=</span><span class="n">none</span> <span class="mi">1</span><span class="o">=</span><span class="n">basic</span> <span class="mi">2</span><span class="o">=</span><span class="n">NTLM</span> <span class="mi">3</span><span class="o">=</span><span class="n">TLS</span> <span class="mi">4</span><span class="o">=</span><span class="n">HTML</span>
<span class="n">Translation</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>   <span class="o">===&gt;</span>                    <span class="mi">0</span><span class="o">=</span><span class="n">idem</span> <span class="mi">1</span><span class="o">=</span><span class="mi">8040</span> <span class="mi">2</span><span class="o">=</span><span class="mi">8080</span> <span class="mi">3</span><span class="o">=</span><span class="mi">4040</span> <span class="mi">4</span><span class="o">=</span><span class="n">auto</span>
<span class="n">Logon</span> <span class="n">message</span>    <span class="o">===&gt;</span>

<span class="n">TIOA</span> <span class="n">at</span> <span class="n">logon</span>    <span class="o">===&gt;</span> <span class="n">MELI</span>

<span class="n">TIOA</span> <span class="n">at</span> <span class="n">logoff</span>   <span class="o">===&gt;</span>

<span class="n">Initial</span> <span class="n">Scenario</span> <span class="o">===&gt;</span>                   <span class="n">Final</span> <span class="n">Scenario</span>    <span class="o">===&gt;</span>
<span class="n">Input</span> <span class="n">Scenario</span>   <span class="o">===&gt;</span>                   <span class="n">Output</span> <span class="n">Scenario</span>   <span class="o">===&gt;</span>

<span class="n">P1</span><span class="o">=</span><span class="n">Update</span>                        <span class="n">P3</span><span class="o">=</span><span class="n">Return</span>                     <span class="n">P12</span><span class="o">=</span><span class="n">Server</span>
</pre></div>
</div>
<p><em>Transaction for application started by SMTP</em></p>
<p>The corresponding CICS definition is shown in the example below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DEFINE</span> <span class="n">PROFILE</span><span class="p">(</span><span class="n">MELPROF</span><span class="p">)</span> <span class="n">GROUP</span><span class="p">(</span><span class="n">VIRTSMTP</span><span class="p">)</span>
       <span class="n">DESCRIPTION</span><span class="p">(</span><span class="n">TRANSACTION</span> <span class="n">TO</span> <span class="n">PROCESS</span> <span class="n">INCOMING</span> <span class="n">EMAILS</span><span class="p">)</span>
       <span class="n">UCTRAN</span><span class="p">(</span><span class="n">NO</span><span class="p">)</span>
<span class="n">DEFINE</span> <span class="n">TRANSACTION</span><span class="p">(</span><span class="n">MELI</span><span class="p">)</span> <span class="n">GROUP</span><span class="p">(</span><span class="n">VIRTSMTP</span><span class="p">)</span>
       <span class="n">DESCRIPTION</span><span class="p">(</span><span class="n">TRANSACTION</span> <span class="n">TO</span> <span class="n">PROCESS</span> <span class="n">INCOMING</span> <span class="n">EMAILS</span><span class="p">)</span>
       <span class="n">PROGRAM</span><span class="p">(</span><span class="n">SMTPMELI</span><span class="p">)</span> <span class="n">PROFILE</span><span class="p">(</span><span class="n">MELPROF</span><span class="p">)</span>
<span class="n">DEFINE</span> <span class="n">PROGRAM</span><span class="p">(</span><span class="n">SMTPMELI</span><span class="p">)</span> <span class="n">GROUP</span><span class="p">(</span><span class="n">VIRTSMTP</span><span class="p">)</span>
       <span class="n">DESCRIPTION</span><span class="p">(</span><span class="n">PROGRAM</span> <span class="n">TO</span> <span class="n">PROCESS</span> <span class="n">INCOMING</span> <span class="n">EMAILS</span><span class="p">)</span>
</pre></div>
</div>
<p><em>CICS definitions for application started by e-mail</em></p>
<p>Note that the UCTRAN(NO) parameter must be specified both in the PROFILE and in the TYPETERM, and that the
RECEIVESIZE specified in the TYPETERM must be sufficient to contain the e-mail response data structured field.
One the application has been launched, it can retrieve data from the e-mail by sending an FAC8 code 12 structured
field to VIRTEL via the relay LU and reading the response (see <a class="reference internal" href="#ug-email-retrieve-data"><span class="std std-ref">“Retrieve Data From An E-Mail”</span></a>).</p>
<span class="target" id="ug-virtel-batch"></span></div>
</div>
<div class="section" id="virtel-batch">
<span id="index-349"></span><h3>VIRTEL Batch<a class="headerlink" href="#virtel-batch" title="Permalink to this headline">¶</a></h3>
<p>The VIRTEL Batch facility allows you to run VIRTEL as a batch job to execute HTTP-like requests. VIRTEL reads HTTP-like
requests from a SYSIN dataset, executes the desired transaction, and writes an HTTP-like response to a SYSOUT
dataset. When all of the HTTP-like requests have been processed, VIRTEL terminates if requested.
VIRTEL runs as a batch job when both of the following conditions are true:</p>
<ol class="arabic simple">
<li>The VIRTCT contains a BATCH1 parameter. For details, refer to “Parameters of the VIRTCT” in the VIRTEL Installation Guide manual.</li>
<li>A BATCH line is defined in the VIRTEL configuration in the VIRARBO file. For details, refer to “Definition of a BATCH line” in the VIRTEL Connectivity Reference manual.</li>
</ol>
<p>Before running a VIRTEL Batch job for the first time, several preparatory steps must be performed:-</p>
<ul class="simple">
<li>A VIRTCT for VIRTEL Batch must be assembled and link-edited into the VIRTEL load library</li>
<li>A configuration file (VIRARBO) for VIRTEL Batch must be built</li>
<li>A page template file (HTMLTRSF) for the VIRTEL Batch job must be allocated and loaded</li>
<li>Work files (VIRSWAP, VIRHTML) for the VIRTEL Batch job must be allocated and initialized</li>
</ul>
<p>These preparatory steps, which in general only need to be performed once, are described in the following sections.</p>
<div class="section" id="assembling-the-virtct-for-virtel-batch">
<span id="index-350"></span><h4>Assembling the VIRTCT for VIRTEL Batch<a class="headerlink" href="#assembling-the-virtct-for-virtel-batch" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL Batch requires a special VIRTCT which must be assembled and link-edited into the VIRTEL load library. The
figure below shows SAMPLIB member VIRTCTBA, which is an example VIRTCT suitable for running VIRTEL Batch. The
job ASMTCT in the VIRTEL SAMPLIB should be run once to assemble and link-edit this module as VIRTCTBA in the
VIRTEL load library:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>     <span class="n">VIRTCTBA</span> <span class="n">TITLE</span> <span class="s1">&#39;VIRTCT FOR VIRTEL BATCH&#39;</span>
     <span class="n">PRINT</span> <span class="n">GEN</span>
     <span class="n">VIRTERM</span> <span class="n">TYPE</span><span class="o">=</span><span class="n">INITIAL</span><span class="p">,</span><span class="n">APPLID</span><span class="o">=*</span><span class="n">NOAPPL</span><span class="o">*</span><span class="p">,</span>                             <span class="o">*</span>
         <span class="n">BATCH1</span><span class="o">=</span><span class="p">(</span><span class="n">SYSIN</span><span class="p">,</span><span class="n">DCBI1</span><span class="p">,</span><span class="n">SYSPRINT</span><span class="p">,</span><span class="n">DCBO1</span><span class="p">),</span>                          <span class="o">*</span>
         <span class="n">VIRSV1</span><span class="o">=</span><span class="p">(</span><span class="n">VIRSV</span><span class="p">),</span>                                               <span class="o">*</span>
         <span class="n">HTVSAM</span><span class="o">=</span><span class="n">VIRHTML</span><span class="p">,</span>                                               <span class="o">*</span>
         <span class="n">BUFSIZE</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span>                                                <span class="o">*</span>
         <span class="n">STATS</span><span class="o">=</span><span class="n">NO</span><span class="p">,</span>                                                     <span class="o">*</span>
         <span class="n">UFILE1</span><span class="o">=</span><span class="p">(</span><span class="n">HTMLTRSF</span><span class="p">,</span><span class="n">ACBH1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">01</span><span class="p">),</span>                              <span class="o">*</span>
         <span class="n">MEMORY</span><span class="o">=</span><span class="n">ABOVE</span><span class="p">,</span>                                                 <span class="o">*</span>
         <span class="n">COMPANY</span><span class="o">=</span><span class="s1">&#39;YOUR COMPANY NAME&#39;</span><span class="p">,</span>                                  <span class="o">*</span>
         <span class="n">ADDR1</span><span class="o">=</span><span class="s1">&#39;YOUR COMPANY ADDRESS&#39;</span><span class="p">,</span>                                 <span class="o">*</span>
         <span class="n">ADDR2</span><span class="o">=</span><span class="s1">&#39;YOUR COMPANY ADDRESS&#39;</span><span class="p">,</span>                                 <span class="o">*</span>
         <span class="n">LICENCE</span><span class="o">=</span><span class="s1">&#39;YOUR LICENCE ID&#39;</span><span class="p">,</span>                                    <span class="o">*</span>
         <span class="n">EXPIRE</span><span class="o">=</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">31</span><span class="p">),</span>                                          <span class="o">*</span>
         <span class="n">CODE</span><span class="o">=</span><span class="s1">&#39;00000000&#39;</span>
         <span class="n">TITRE1</span><span class="o">=</span><span class="s1">&#39;VIRTEL BATCH&#39;</span>
<span class="o">*---------------------------------------------------------------------*</span>
<span class="n">ACBH1</span>    <span class="n">ACB</span> <span class="n">AM</span><span class="o">=</span><span class="n">VSAM</span><span class="p">,</span><span class="n">DDNAME</span><span class="o">=</span><span class="n">HTMLTRSF</span><span class="p">,</span><span class="n">MACRF</span><span class="o">=</span><span class="p">(</span><span class="n">SEQ</span><span class="p">,</span><span class="n">DIR</span><span class="p">,</span><span class="n">OUT</span><span class="p">,</span><span class="n">LSR</span><span class="p">),</span>          <span class="o">*</span>
         <span class="n">STRNO</span><span class="o">=</span><span class="mi">3</span>
<span class="o">*---------------------------------------------------------------------*</span>
<span class="n">DCBI1</span>    <span class="n">DCB</span> <span class="n">DDNAME</span><span class="o">=</span><span class="n">SYSIN</span><span class="p">,</span>             <span class="n">SYSIN</span> <span class="n">DD</span>                        <span class="o">*</span>
         <span class="n">DCBE</span><span class="o">=</span><span class="n">DCBI1X</span><span class="p">,</span>                                                  <span class="o">*</span>
         <span class="n">LRECL</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>                                                     <span class="o">*</span>
         <span class="n">DSORG</span><span class="o">=</span><span class="n">PS</span><span class="p">,</span>                                                     <span class="o">*</span>
         <span class="n">RECFM</span><span class="o">=</span><span class="n">FB</span><span class="p">,</span>                                                     <span class="o">*</span>
         <span class="n">MACRF</span><span class="o">=</span><span class="p">(</span><span class="n">GL</span><span class="p">)</span>
 <span class="n">DCBI1X</span>  <span class="n">DCBE</span> <span class="n">EODAD</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">RMODE31</span><span class="o">=</span><span class="n">BUFF</span>
 <span class="o">*---------------------------------------------------------------------*</span>
 <span class="n">DCBO1</span>   <span class="n">DCB</span> <span class="n">DDNAME</span><span class="o">=</span><span class="n">SYSPRINT</span><span class="p">,</span> <span class="n">SYSPRINT</span> <span class="n">DD</span>                               <span class="o">*</span>
         <span class="n">DCBE</span><span class="o">=</span><span class="n">DCBO1X</span><span class="p">,</span>                                                   <span class="o">*</span>
         <span class="n">LRECL</span><span class="o">=</span><span class="mi">133</span><span class="p">,</span>                                                     <span class="o">*</span>
         <span class="n">DSORG</span><span class="o">=</span><span class="n">PS</span><span class="p">,</span>                                                      <span class="o">*</span>
         <span class="n">RECFM</span><span class="o">=</span><span class="n">FBA</span><span class="p">,</span>                                                     <span class="o">*</span>
         <span class="n">MACRF</span><span class="o">=</span><span class="p">(</span><span class="n">PM</span><span class="p">)</span>
 <span class="n">DCBO1X</span>  <span class="n">DCBE</span> <span class="n">RMODE31</span><span class="o">=</span><span class="n">BUFF</span>
 <span class="o">*---------------------------------------------------------------------*</span>
         <span class="n">END</span>
</pre></div>
</div>
<p><em>Example VIRTCT for VIRTEL Batch</em></p>
<p><em>1.22.1.2. Building the configuration file for VIRTEL Batch</em></p>
<p>VIRTEL Batch requires its own configuration file (VIRARBO) which defines a Batch Line, the page template dataset, a
Batch Entry Point, and the Transactions which will be executed by the VIRTEL Batch job. The figure below shows SAMPLIB member VIRBATAR, which is an example of a job to create the VIRARBO file for use by VIRTEL Batch. This job should be run once before the first execution of a VIRTEL Batch job:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>//VIRBATAR JOB 1,VIRBATAR,CLASS=A,MSGCLASS=X,NOTIFY=&amp;SYSUID
// SET LOADLIB=yourqual.VIRTnnn.LOADLIB
//DEFINE EXEC PGM=IDCAMS
//SYSPRINT DD SYSOUT=*
    DELETE (yourqual.VIRBATCH.ARBO) CLUSTER PURGE
    SET MAXCC = 0
    DEFINE CLUSTER(NAME(yourqual.VIRBATCH.ARBO) -
        KEYS(9 0) RECSZ(100 4089) FSPC(10 10) -
        VOL(XXXXXX) REC(250,50) SHR(4) SPEED) -
    DATA(NAME(yourqual.VIRBATCH.ARBO.DATA) CISZ(4096)) -
    INDEX(NAME(yourqual.VIRBATCH.ARBO.INDEX))
//CONFIG EXEC PGM=VIRCONF,COND=(0,NE),PARM=&#39;LOAD,LANG=&amp;LANG&#39;
//STEPLIB DD DSN=&amp;LOADLIB,DISP=SHR
//SYSPRINT DD SYSOUT=*
//VIRARBO DD DSN=yourqual.VIRBATCH.ARBO,DISP=SHR
    LINE ID=B-BT1,NAME=BATCH-L1,
        DESC=&#39;VIRTEL Batch line&#39;,
        TYPE=BATCH1,ENTRY=EPBATCH,TERMINAL=BT,
        INOUT=1,PROTOCOL=VIRHTTP,RULESET=B-BT1
    TERMINAL ID=BTLOC000,
        DESC=&#39;VIRTEL Batch terminals (no relay)&#39;,
        TYPE=3,COMPRESS=2,INOUT=3,STATS=12,REPEAT=4
    TERMINAL ID=BTVTA000,RELAY=*HTTPOOL,
        DESC=&#39;VIRTEL Batch terminals (with relay)&#39;,
        TYPE=3,COMPRESS=2,INOUT=3,STATS=12,REPEAT=4
    TERMINAL ID=BTVTP000,RELAY=RVIRBT00,POOL=*HTTPOOL,
        DESC=&#39;Relay pool for HTTP&#39;,
        TYPE=3,COMPRESS=2,INOUT=3,STATS=12,REPEAT=4
    SUBDIR ID=W2H-DIR,
        DESC=&#39;Pages for WEB2HOST&#39;,
        FSTYPE=V,DDNAME=HTMLTRSF,KEY=W2H-KEY,
        NAMELEN=64,AUTHUP=X,AUTHDOWN=X,AUTHDEL=X
    ENTRY ID=EPBATCH,
        DESC=&#39;VIRTEL Batch entry point&#39;,
        TRANSACT=BAT,TIMEOUT=1,ACTION=0,EXTCOLOR=X,
        EMUL=HTML,SIGNON=VIR0020H,MENU=VIR0021A
    TRANSACT ID=BAT-00,NAME=EPBATCH,
         DESC=&#39;Default directory = entry point name&#39;,
        APPL=W2H-DIR,TYPE=4,
        TERMINAL=BTLOC,integration=2,SECURITY=0
    TRANSACT ID=BAT-14,NAME=&#39;Protide&#39;,
        DESC=&#39;XML conversion&#39;,
        APPL=$NONE$,TYPE=2,
        TERMINAL=BTLOC,integration=1,SECURITY=0,
        TIOASTA=&#39;&amp;/S OK &amp;/T&#39;,
        EXITSTA=SCENSVIO
* END OF CONFIGURATION
</pre></div>
</div>
<p><em>Job to build configuration file for VIRTEL Batch</em></p>
</div>
<div class="section" id="allocating-the-page-template-file-for-virtel-batch">
<span id="index-351"></span><h4>Allocating the page template file for VIRTEL Batch<a class="headerlink" href="#allocating-the-page-template-file-for-virtel-batch" title="Permalink to this headline">¶</a></h4>
<p>Each VIRTEL Batch job requires an HTMLTRSF file which contains the page templates used by the transactions which
will be executed by the VIRTEL Batch job. The figure below shows SAMPLIB member VIRBATAT, which is an example job
to allocate the HTMLTRSF file and to copy the page templates from the sample file (SAMPTRSF) distributed with
VIRTEL. This job should be run once before the first execution of a VIRTEL Batch job:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">VIRBATAT</span> <span class="n">JOB</span> <span class="mi">1</span><span class="p">,</span><span class="n">VIRBATAT</span><span class="p">,</span><span class="n">CLASS</span><span class="o">=</span><span class="n">A</span><span class="p">,</span><span class="n">MSGCLASS</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">NOTIFY</span><span class="o">=&amp;</span><span class="n">SYSUID</span>
<span class="o">//*-------------------------------------------------------------------*</span>
<span class="o">//*</span> <span class="n">DEFINITION</span> <span class="n">OF</span> <span class="n">FILE</span> <span class="n">HTMLTRSF</span> <span class="o">*</span>
<span class="o">//*-------------------------------------------------------------------*</span>
<span class="o">//</span><span class="n">SAMPTRF</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">IDCAMS</span>
<span class="o">//</span><span class="n">SYSPRINT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
    <span class="n">DELETE</span> <span class="p">(</span><span class="n">yourqual</span><span class="o">.</span><span class="n">VIRBATCH</span><span class="o">.</span><span class="n">HTMLTRSF</span><span class="p">)</span> <span class="n">CLUSTER</span> <span class="n">PURGE</span>
    <span class="n">SET</span> <span class="n">MAXCC</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">DEFINE</span> <span class="n">CLUSTER</span> <span class="p">(</span><span class="n">NAME</span><span class="p">(</span><span class="n">yourqual</span><span class="o">.</span><span class="n">VIRBATCH</span><span class="o">.</span><span class="n">HTMLTRSF</span><span class="p">)</span> <span class="o">-</span>
        <span class="n">VOL</span><span class="p">(</span><span class="n">XXXXXX</span><span class="p">)</span> <span class="n">SHR</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">KEYS</span><span class="p">(</span><span class="mi">16</span> <span class="mi">0</span><span class="p">)</span> <span class="n">RECSZ</span><span class="p">(</span><span class="mi">100</span> <span class="mi">32758</span><span class="p">)</span> <span class="n">REC</span><span class="p">(</span><span class="mi">250</span> <span class="mi">100</span><span class="p">))</span> <span class="o">-</span>
    <span class="n">DATA</span> <span class="p">(</span><span class="n">NAME</span><span class="p">(</span><span class="n">yourqual</span><span class="o">.</span><span class="n">VIRBATCH</span><span class="o">.</span><span class="n">HTMLTRSF</span><span class="o">.</span><span class="n">DATA</span><span class="p">)</span> <span class="n">SPANNED</span> <span class="n">CISZ</span><span class="p">(</span><span class="mi">4096</span><span class="p">))</span> <span class="o">-</span>
    <span class="n">INDEX</span> <span class="p">(</span><span class="n">NAME</span><span class="p">(</span><span class="n">yourqual</span><span class="o">.</span><span class="n">VIRBATCH</span><span class="o">.</span><span class="n">HTMLTRSF</span><span class="o">.</span><span class="n">INDEX</span><span class="p">)</span> <span class="n">CISZ</span><span class="p">(</span><span class="mi">512</span><span class="p">))</span>
<span class="o">//*-------------------------------------------------------------------*</span>
<span class="o">//*</span> <span class="n">INITIALISATION</span> <span class="n">OF</span> <span class="n">FILE</span> <span class="n">HTMLTRSF</span> <span class="o">*</span>
<span class="o">//*-------------------------------------------------------------------*</span>
<span class="o">//</span><span class="n">SAMPTRF</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">IDCAMS</span>
<span class="o">//</span><span class="n">SYSPRINT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
<span class="o">//</span><span class="n">SAMPTRSF</span> <span class="n">DD</span> <span class="n">DSN</span><span class="o">=</span><span class="n">yourqual</span><span class="o">.</span><span class="n">VIRTnnn</span><span class="o">.</span><span class="n">SAMP</span><span class="o">.</span><span class="n">TRSF</span><span class="p">,</span><span class="n">DISP</span><span class="o">=</span><span class="n">SHR</span>
<span class="o">//</span><span class="n">HTMLTRSF</span> <span class="n">DD</span> <span class="n">DSN</span><span class="o">=</span><span class="n">yourqual</span><span class="o">.</span><span class="n">VIRBATCH</span><span class="o">.</span><span class="n">HTMLTRSF</span><span class="p">,</span><span class="n">DISP</span><span class="o">=</span><span class="n">OLD</span>
<span class="o">//</span><span class="n">SYSIN</span> <span class="n">DD</span> <span class="o">*</span>
    <span class="n">REPRO</span> <span class="n">INFILE</span><span class="p">(</span><span class="n">SAMPTRSF</span><span class="p">)</span> <span class="n">OUTFILE</span><span class="p">(</span><span class="n">HTMLTRSF</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Job to allocate page template file for VIRTEL Batch</em></p>
</div>
<div class="section" id="allocating-work-files-for-virtel-batch">
<span id="index-352"></span><h4>Allocating work files for VIRTEL Batch<a class="headerlink" href="#allocating-work-files-for-virtel-batch" title="Permalink to this headline">¶</a></h4>
<p>Each VIRTEL Batch job requires its own VIRSWAP and VIRHTML files. The figure below shows SAMPLIB member
VIRBATAW, which is an example job to allocate these files:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>//VIRBATAW JOB 1,VIRBATAW,CLASS=A,MSGCLASS=X,NOTIFY=&amp;SYSUID
//*----------------------------------------------------------------*
//* DEFINITION OF FILES VIRSWAP AND VIRHTML *
//*----------------------------------------------------------------*
//VIRWORK EXEC PGM=IDCAMS
//SYSPRINT DD SYSOUT=*
    DELETE (yourqual.VIRBATCH.SWAP) CLUSTER PURGE
    DELETE (yourqual.VIRBATCH.HTML) CLUSTER PURGE
    SET MAXCC = 0
    DEFINE CLUSTER (NAME(yourqual.VIRBATCH.SWAP) -
        VOL(XXXXXX) KEYS(16 0) REC(10,5) RECSZ(100 8185) -
        REUSE FSPC(10 10) SHR(2) SPEED) -
    DATA (NAME(yourqual.VIRBATCH.SWAP.DATA) CISZ(8192)) -
    INDEX (NAME(yourqual.VIRBATCH.SWAP.INDEX))
    DEFINE CLUSTER (NAME(yourqual.VIRBATCH.HTML) -
        VOL(XXXXXX) KEYS(64 0) REC(5 5) RECSZ(1000 4089) -
        FSPC(10 10) SHR(4) SPEED) -
    DATA (NAME(yourqual.VIRBATCH.HTML.DATA) CISZ(4096)) -
    INDEX (NAME(yourqual.VIRBATCH.HTML.INDEX))
//*----------------------------------------------------------------*
//* INITIALISATION OF FILE VIRHTML *
//*----------------------------------------------------------------*
//INIHTML EXEC PGM=IDCAMS
//SYSPRINT DD SYSOUT=*
//INIT DD DATA,DLM=AA
    $$$$IWS.WORKREC.INW$TEMP
    AA
//VIRHTML DD DSN=yourqual.VIRBATCH.HTML,DISP=OLD
    REPRO INFILE(INIT) OUTFILE(VIRHTML)
</pre></div>
</div>
<p><em>Job to allocate work files for VIRTEL Batch</em></p>
</div>
<div class="section" id="running-the-virtel-batch-job">
<span id="index-353"></span><h4>Running the VIRTEL Batch job<a class="headerlink" href="#running-the-virtel-batch-job" title="Permalink to this headline">¶</a></h4>
<p>The figure below shows SAMPLIB member VIRBATCH, which contains an example of a VIRTEL Batch job:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">VIRBATCH</span> <span class="n">JOB</span> <span class="mi">1</span><span class="p">,</span><span class="n">VIRBATCH</span><span class="p">,</span><span class="n">CLASS</span><span class="o">=</span><span class="n">G</span><span class="p">,</span><span class="n">MSGCLASS</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">NOTIFY</span><span class="o">=&amp;</span><span class="n">SYSUID</span>
<span class="o">//</span> <span class="n">SET</span> <span class="n">TCT</span><span class="o">=</span><span class="n">BA</span>
<span class="o">//</span> <span class="n">SET</span> <span class="n">QUAL1</span><span class="o">=</span><span class="n">yourqual</span><span class="o">.</span><span class="n">VIRT</span>
<span class="o">//</span> <span class="n">SET</span> <span class="n">QUAL2</span><span class="o">=</span><span class="n">yourqual</span><span class="o">.</span><span class="n">VIRBATCH</span>
<span class="o">//</span><span class="n">VIRBAT</span>   <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">VIR0000</span><span class="p">,</span><span class="n">REGION</span><span class="o">=</span><span class="mi">64</span><span class="n">M</span><span class="p">,</span><span class="n">PARM</span><span class="o">=&amp;</span><span class="n">TCT</span>
<span class="o">//</span><span class="n">STEPLIB</span>  <span class="n">DD</span> <span class="n">DISP</span><span class="o">=</span><span class="n">SHR</span><span class="p">,</span><span class="n">DSN</span><span class="o">=&amp;</span><span class="n">QUAL1</span><span class="o">..</span><span class="n">LOADLIB</span>
<span class="o">//</span><span class="n">DFHRPL</span>   <span class="n">DD</span> <span class="n">DISP</span><span class="o">=</span><span class="n">SHR</span><span class="p">,</span><span class="n">DSN</span><span class="o">=&amp;</span><span class="n">QUAL1</span><span class="o">..</span><span class="n">LOADLIB</span>
<span class="o">//</span><span class="n">SERVLIB</span>  <span class="n">DD</span> <span class="n">DISP</span><span class="o">=</span><span class="n">SHR</span><span class="p">,</span><span class="n">DSN</span><span class="o">=&amp;</span><span class="n">QUAL1</span><span class="o">..</span><span class="n">LOADLIB</span>
<span class="o">//</span><span class="n">VIRARBO</span>  <span class="n">DD</span> <span class="n">DISP</span><span class="o">=</span><span class="n">OLD</span><span class="p">,</span><span class="n">DSN</span><span class="o">=&amp;</span><span class="n">QUAL2</span><span class="o">..</span><span class="n">ARBO</span>
<span class="o">//</span><span class="n">VIRSWAP</span>  <span class="n">DD</span> <span class="n">DISP</span><span class="o">=</span><span class="n">OLD</span><span class="p">,</span><span class="n">DSN</span><span class="o">=&amp;</span><span class="n">QUAL2</span><span class="o">..</span><span class="n">SWAP</span>
<span class="o">//</span><span class="n">VIRHTML</span>  <span class="n">DD</span> <span class="n">DISP</span><span class="o">=</span><span class="n">OLD</span><span class="p">,</span><span class="n">DSN</span><span class="o">=&amp;</span><span class="n">QUAL2</span><span class="o">..</span><span class="n">HTML</span>
<span class="o">//</span><span class="n">HTMLTRSF</span> <span class="n">DD</span> <span class="n">DISP</span><span class="o">=</span><span class="n">OLD</span><span class="p">,</span><span class="n">DSN</span><span class="o">=&amp;</span><span class="n">QUAL2</span><span class="o">..</span><span class="n">HTMLTRSF</span>
<span class="o">//</span><span class="n">SYSIN</span> <span class="n">DD</span> <span class="o">*</span>
    <span class="p">(</span><span class="n">commands</span> <span class="ow">and</span> <span class="n">data</span> <span class="n">statements</span><span class="p">,</span> <span class="n">see</span> <span class="n">below</span><span class="p">)</span>
<span class="o">//</span><span class="n">SYSPRINT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
<span class="o">//</span><span class="n">VIRLOG</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
</pre></div>
</div>
<p><em>Example JCL for VIRTEL Batch</em></p>
<p>The SYSIN file contains commands and data statements. The following commands are valid in the SYSIN file:</p>
<dl class="docutils">
<dt>.GET</dt>
<dd>indicates the start of an HTTP GET command</dd>
<dt>.POST</dt>
<dd>indicates the start of an HTTP POST command</dd>
<dt>.RAW</dt>
<dd>indicates the start of a raw HTTP request command</dd>
<dt>.END</dt>
<dd>indicates the end of a GET, POST, or RAW command</dd>
<dt>.EOJ</dt>
<dd>causes VIRTEL to terminate</dd>
</dl>
<p id="index-354">These commands are described in the following sections.</p>
</div>
<div class="section" id="virtel-batch-commands">
<span id="index-355"></span><h4>VIRTEL Batch commands<a class="headerlink" href="#virtel-batch-commands" title="Permalink to this headline">¶</a></h4>
<div class="section" id="virtel-batch-get-command">
<span id="index-356"></span><h5>VIRTEL Batch GET command<a class="headerlink" href="#virtel-batch-get-command" title="Permalink to this headline">¶</a></h5>
<p>The following figure shows an example SYSIN file containing two GET commands:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">GET</span>
<span class="o">/</span><span class="n">protide</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">protide</span> <span class="n">VIRTEL</span> <span class="n">transaction</span> <span class="n">name</span>
<span class="n">schema</span><span class="o">=</span><span class="n">TCC</span> <span class="n">Schema</span> <span class="n">name</span>
<span class="ow">in</span><span class="o">=</span><span class="s1">&#39;TCC.DATA&#39;</span> <span class="n">Input</span> <span class="n">dataset</span> <span class="n">name</span>
<span class="n">out</span><span class="o">=</span><span class="s1">&#39;TCC.XML&#39;</span> <span class="n">Output</span> <span class="n">dataset</span> <span class="n">name</span>
<span class="n">mode</span><span class="o">=</span><span class="n">wb</span><span class="p">,</span><span class="n">recfm</span><span class="o">=</span><span class="n">vb</span><span class="p">,</span><span class="n">lrecl</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span><span class="n">space</span><span class="o">=</span><span class="p">(</span><span class="n">cyl</span><span class="p">,(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span> <span class="n">Output</span> <span class="n">file</span> <span class="n">attributes</span>
<span class="n">output_encoding</span><span class="o">=</span><span class="n">U</span> <span class="n">Output</span> <span class="n">encoding</span> <span class="n">U</span> <span class="ow">or</span> <span class="n">E</span>
 <span class="o">.</span><span class="n">END</span>
 <span class="o">.</span><span class="n">GET</span>
<span class="o">/</span><span class="n">protide</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">protide</span> <span class="n">VIRTEL</span> <span class="n">transaction</span> <span class="n">name</span>
<span class="n">schema</span><span class="o">=</span><span class="n">CRPR</span> <span class="n">Schema</span> <span class="n">name</span>
<span class="ow">in</span><span class="o">=</span><span class="s1">&#39;CRPR.XML&#39;</span> <span class="n">Input</span> <span class="n">dataset</span> <span class="n">name</span>
<span class="n">out</span><span class="o">=</span><span class="s1">&#39;CRPR.DATA&#39;</span> <span class="n">Output</span> <span class="n">dataset</span> <span class="n">name</span>
<span class="n">mode</span><span class="o">=</span><span class="n">wb</span><span class="p">,</span><span class="n">recfm</span><span class="o">=</span><span class="n">fb</span><span class="p">,</span><span class="n">lrecl</span><span class="o">=</span><span class="mi">200</span> <span class="n">Output</span> <span class="n">file</span> <span class="n">attributes</span>
<span class="n">input_encoding</span><span class="o">=</span><span class="n">U</span> <span class="n">Input</span> <span class="n">encoding</span> <span class="n">U</span> <span class="ow">or</span> <span class="n">E</span>
 <span class="o">.</span><span class="n">END</span>
 <span class="o">.</span><span class="n">EOJ</span>
</pre></div>
</div>
<p><em>Example VIRTEL Batch GET commands</em></p>
<p>Each .GET command is followed by one or more data statements.</p>
<p>The first statement following the .GET command is the VIRTEL URL of the HTTP request (see <a class="reference internal" href="#ug-url-formats"><span class="std std-ref">“Virtel URL formats”</span></a>). Only the pathname, pagename, and tranname parts of the URL are required. The <a class="reference external" href="http://ipaddr:port">http://ipaddr:port</a> part of the URL must be omitted.</p>
<p>All subsequent statements (if any) following the .GET command are appended to the URL as query parameters. To
conform with standard HTTP query syntax, VIRTEL adds a “?” before the first parameter and a “&amp;” before each
subsequent parameter. Thus, in the above example, VIRTEL generates two HTTP requests:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>GET /protide.htm+protide?
schema=TCC&amp;in=&#39;TCC.DATA&#39;&amp;out=&#39;TCC.XML&#39;&amp;mode=wb,recfm=vb,lrecl=512,
space=(cyl,(10,5))&amp;output_encoding=U HTTP/1.1
GET /protide.htm+protide?schema=CRPR&amp;in=&#39;CRPR.XML&#39;&amp;out=&#39;CRPR.DATA&#39;&amp;mode=wb,
recfm=fb,lrecl=200&amp;input_encoding=U HTTP/1.1
</pre></div>
</div>
<p><em>Example VIRTEL Batch GET requests</em></p>
</div>
<div class="section" id="virtel-batch-post-command">
<span id="index-357"></span><h5>VIRTEL Batch POST command<a class="headerlink" href="#virtel-batch-post-command" title="Permalink to this headline">¶</a></h5>
<p>The following figure shows an example SYSIN file containing a POST command followed by XML data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>.POST text/xml
/xmldemo.xml+tran3
&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;methodCall&gt;
    &lt;screenname&gt;T000-GAL&lt;/screenname&gt;
    &lt;screentype&gt;3270&lt;/screentype&gt;
    &lt;params&gt;
        &lt;fieldname&gt;FIELD001&lt;/fieldname&gt;
        &lt;uinput&gt;A&lt;/uinput&gt;
    &lt;/params&gt;
&lt;/methodCall&gt;
.END
.EOJ
</pre></div>
</div>
<p><em>Example VIRTEL Batch POST command</em></p>
<p>Each .POST command is followed by two or more data statements containing the URL and the request body.</p>
<p>The first statement following the .POST command is the VIRTEL URL of the HTTP request (see <a class="reference internal" href="#ug-url-formats"><span class="std std-ref">“Virtel URL formats”</span></a>). Only the pathname, pagename, and tranname parts of the URL are required. The <a class="reference external" href="http://ipaddr:port">http://ipaddr:port</a> part of the URL must be omitted.</p>
<p>All subsequent statements following the .POST command are considered to be the request body. VIRTEL automatically
generates a Content-length: header corresponding to the size of the request body. VIRTEL also adds a Content-type:
header if the content type is specified as an operand of the .POST command as shown in the example. Thus, in the
above example, VIRTEL generates the following HTTP request:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>POST /xmldemo.xml+tran3 HTTP/1.1
Content-Length: 00000201
Content-Type: text/xml
Special: GIVE-LENGTH-PREFIX
&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;methodCall&gt;
&lt;screenname&gt;T000-GAL&lt;/screenname&gt;
&lt;screentype&gt;3270&lt;/screentype&gt;
&lt;params&gt;
&lt;fieldname&gt;FIELD001&lt;/fieldname&gt;
&lt;uinput&gt;A&lt;/uinput&gt;
&lt;/params&gt;
&lt;/methodCall&gt;
</pre></div>
</div>
<p><em>Example VIRTEL Batch POST request</em></p>
<span class="target" id="index-358"></span></div>
</div>
<div class="section" id="virtel-batch-raw-command">
<span id="index-359"></span><h4>VIRTEL Batch RAW command<a class="headerlink" href="#virtel-batch-raw-command" title="Permalink to this headline">¶</a></h4>
<p>The following figure shows an example SYSIN file containing a RAW command followed by HTTP request data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">RAW</span>
<span class="n">POST</span> <span class="o">/</span><span class="n">virmsg</span><span class="o">.</span><span class="n">txt</span><span class="o">+</span><span class="n">uplw2h</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">multipart</span><span class="o">/</span><span class="n">form</span><span class="o">-</span><span class="n">data</span><span class="p">;</span> <span class="n">boundary</span><span class="o">=-----------------</span><span class="mi">9503744825200</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">227</span>
<span class="o">-------------------</span><span class="mi">9503744825200</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Disposition</span><span class="p">:</span> <span class="n">form</span><span class="o">-</span><span class="n">data</span><span class="p">;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;file&quot;</span><span class="p">;</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;test.txt&quot;</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">plain</span>
<span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">test</span> <span class="n">data</span> <span class="n">file</span> <span class="k">for</span> <span class="n">upload</span>
<span class="n">More</span> <span class="n">test</span> <span class="n">data</span> <span class="n">here</span>
<span class="o">-------------------</span><span class="mi">9503744825200</span><span class="o">--</span>
<span class="o">.</span><span class="n">END</span>
<span class="o">.</span><span class="n">EOJ</span>
</pre></div>
</div>
<p><em>Example VIRTEL Batch RAW command</em></p>
<p>Each .RAW command is followed by one or more data statements containing the HTTP request line, the request
headers, and the request body. A blank line separates the request headers from the request body. VIRTEL generates an
HTTP request exactly as contained in the data statements.</p>
</div>
<div class="section" id="virtel-batch-return-codes">
<span id="index-360"></span><h4>VIRTEL Batch return codes<a class="headerlink" href="#virtel-batch-return-codes" title="Permalink to this headline">¶</a></h4>
<p>When a VIRTEL Batch job terminates, the condition code is set to the highest ERROR$ code set by the of the scenarios
executed (value 0 to 255).</p>
<p>The condition code may also be set to 4 or 5 (unless a scenario has indicated a higher value) if a request executed by
the batch job produced an HTTP response code in the range 4xx or 5xx.</p>
<p>In the case of a scenario abend, the completion code contains the offset of the abend within the scenario.</p>
<p>If the VIRTEL Batch job terminates because of an error condition (for example, an invalid batch command, missing DD
statement, or insufficient memory) then the condition code is set to 16.</p>
</div>
</div>
</div>
<div class="section" id="outgoing-calls">
<span id="index-361"></span><h2>Outgoing Calls<a class="headerlink" href="#outgoing-calls" title="Permalink to this headline">¶</a></h2>
<div class="section" id="outgoing-e-mails">
<span id="index-362"></span><h3>Outgoing E-mails<a class="headerlink" href="#outgoing-e-mails" title="Permalink to this headline">¶</a></h3>
<p id="index-363">The FAD4 structured field allows a host application to send an e-mail. This function is described in the VIRTEL
Programming Interface documentation 280.
The entry point used to invoke the host application must contain a type-3 transaction with external name $MAIL$. The
“Application” field must contain the name of the SMTP line to be used for sending the outgoing e-mail.
An example transaction is shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>TRANSACTION DETAIL DEFINITION ---------------------- Applid: SPVIRE2 13:43:23
Internal name ===&gt; W2H-75                To associate with an entry point name
External name ===&gt; $mail$                Name displayed on user menu
Description   ===&gt; Send messages via SMTP
Application   ===&gt; S-SMTP                Application to be called
PassTicket    ===&gt; 0 Name ===&gt;           0=no 1=yes 2=unsigned
Application type ===&gt; 3                  1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE
Pseudo-terminals ===&gt;                    Prefix of name of partner terminals
Logmode          ===&gt;                    Specify when LOGMODE must be changed
How started      ===&gt; 2                  1=menu 2=sub-menu 3=auto
Security         ===&gt; 1                  0=none 1=basic 2=NTLM 3=TLS 4=HTML
Translation(s)   ===&gt;                    0=idem 1=8040 2=8080 3=4040 4=auto
Logon message    ===&gt;

TIOA at logon    ===&gt;

TIOA at logoff   ===&gt;

Initial Scenario ===&gt;                   Final Scenario    ===&gt;
Input Scenario   ===&gt;                   Output Scenario   ===&gt;

P1=Update                        P3=Return                     P12=Server
</pre></div>
</div>
<p><em>Transaction definition for outgoing e-mails</em></p>
<p>Refer to the VIRTEL Connectivity Reference documentation for details of defining transactions, entry points, and SMTP lines.</p>
</div>
</div>
<div class="section" id="programming-interfaces">
<span id="ug-programming-interfaces"></span><span id="index-364"></span><h2>Programming Interfaces<a class="headerlink" href="#programming-interfaces" title="Permalink to this headline">¶</a></h2>
<p>Certain VIRTEL functions can be driven by application programs. These functions are generally requested by sending specially formatted commands to VIRTEL on the same 3270 session through which the application communicates with the end user. An application can request VIRTEL functions in the following ways:</p>
<ul class="simple">
<li>By sending a message containing structured fields recognized by VIRTEL</li>
<li>By embedding HOST4WEB commands in the 3270 screen (available from VIRTEL version 4.28 onwards)</li>
</ul>
<div class="section" id="structred-fields">
<span id="index-365"></span><h3>Structred Fields<a class="headerlink" href="#structred-fields" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>In addition to sending normal screen display data, a 3270
application may also send data in specially formatted fields known
as “structured fields”. Structured fields are sent using a special
3270 command “Write Structured Field” (code X’F3’). Each structured
field contains a 2-byte identification code. VIRTEL intercepts
structured fields whose code begins with X’FA’. By sending
structured fields to VIRTEL on the 3270 session, the VIRTEL Web
Integration application can direct VIRTEL to perform certain
functions.</p>
<p>The operations available to VIRTEL Web Integration applications via
structured fields are as follows:</p>
</div></blockquote>
<ul class="simple">
<li>Specify the HTML page template to be used to format 3270 screens for
the browser</li>
<li>Specify the directory from which HTML page templates are to be
retrieved</li>
<li>Send a list of values (a table variable) to an HTML page</li>
<li>Send an outgoing e-mail</li>
<li>Retrieve the contents of an incoming e-mail</li>
</ul>
<div class="section" id="general-format-of-a-3270-structured-field">
<span id="index-366"></span><h4>General format of a 3270 structured field<a class="headerlink" href="#general-format-of-a-3270-structured-field" title="Permalink to this headline">¶</a></h4>
<p>As a general rule, the format of a structured field is as shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">X</span><span class="s1">&#39;nnnnccccdd....dd&#39;</span>
</pre></div>
</div>
<dl class="docutils">
<dt>nnnn</dt>
<dd>The length. The length includes the length of the nnnn and cccc
fields, thus nnnn is always 4 more than the length of the data.</dd>
<dt>cccc</dt>
<dd>the identification code</dd>
<dt>dd….dd</dt>
<dd>the data.</dd>
</dl>
</div>
<div class="section" id="sending-structured-fields-via-the-write-structured-field-command">
<span id="index-367"></span><h4>Sending structured fields via the Write Structured Field command<a class="headerlink" href="#sending-structured-fields-via-the-write-structured-field-command" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL recognizes that a message contains structured fields whenever the application uses the 3270 command X’F3’
(Write Structured Field) to send the message to the terminal.
For CICS applications, the STRFIELD option of the EXEC CICS SEND command requests CICS to send the message using
command code X’F3’:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">EXEC</span> <span class="n">CICS</span> <span class="n">SEND</span> <span class="n">FROM</span><span class="p">(</span><span class="n">DATA1</span><span class="p">)</span>
    <span class="n">LENGTH</span><span class="p">(</span><span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">DATA1</span><span class="p">)</span>
    <span class="n">STRFIELD</span>
<span class="n">END</span><span class="o">-</span><span class="n">EXEC</span><span class="o">.</span>
</pre></div>
</div>
<p>For non-CICS applications, the appropriate method of generating a Write Structured Field command should be used. It
is also possible to convert a normal message into a structured field message by means of VIRTEL exit 4 (outbound
message exit).</p>
</div>
<div class="section" id="sending-structured-fields-using-the-srtvirtel-prefix">
<span id="index-368"></span><h4>Sending structured fields using the SRTVIRTEL prefix<a class="headerlink" href="#sending-structured-fields-using-the-srtvirtel-prefix" title="Permalink to this headline">¶</a></h4>
<p>If the application monitor does not support the X’F3’ (Write Structured Field) command for sending structured fields
(for example, IMS), VIRTEL provides an alternative method for processing structured field data. If the 3270 message
begins with the special header:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">X</span><span class="s1">&#39;1140401D40&#39;</span><span class="p">,</span><span class="n">C</span><span class="s1">&#39;SRTVIRTEL&#39;</span><span class="p">,</span><span class="n">X</span><span class="s1">&#39;11404B&#39;</span>
</pre></div>
</div>
<p>then VIRTEL treats the remainder of the message as structured fields.
The SRTVIRTEL header is built by the application, and the application monitor adds 3270 command byte X’F1’ (Write),
X’F5’ (Erase/Write), or X‘7E’ (Erase/Write Alternate), followed by an appropriate WCC (Write Control Character).
For example,</p>
<p>F1 C3 1140401D40 C’SRTVIRTEL’ 11404B 0016 FAE5 08 08 E3D9F0F0F0F0F0F1 818683A796A34040</p>
<p>is processed identically to:</p>
<p>F3 0016 FAE5 08 08 E3D9F0F0F0F0F0F1 818683A796A34040</p>
</div>
<div class="section" id="how-to-determine-if-running-under-virtel">
<span id="index-369"></span><h4>How To Determine If Running Under Virtel<a class="headerlink" href="#how-to-determine-if-running-under-virtel" title="Permalink to this headline">¶</a></h4>
<p>Because the structured fields described in this chapter are understood only by VIRTEL and not by regular 3270
terminals, your application will need to determine whether it is communicating with a VIRTEL pseudo-terminal before
writing a VIRTEL structured field. This section describes some techniques that your application can use to decide if it is
communicating with VIRTEL pseudo-terminal or with a regular 3270 terminal.</p>
</div>
<div class="section" id="use-a-different-transaction-code">
<h4>Use a different transaction code<a class="headerlink" href="#use-a-different-transaction-code" title="Permalink to this headline">¶</a></h4>
<p>By defining two different transaction codes which invoke the same CICS application program (for example, DEMO for
3270, and VEMO for VIRTEL), the application can test the field EIBTRNID to determine if it is running under VIRTEL.
The figure below shows sample DFHCSDUP statements to associate two transaction codes (DEMO and VEMO) with a
single application program DEMOPROG:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DEFINE</span> <span class="n">TRANSACTION</span><span class="p">(</span><span class="n">DEMO</span><span class="p">)</span> <span class="n">GROUP</span><span class="p">(</span><span class="n">DEMOGRP</span><span class="p">)</span>
    <span class="n">PROGRAM</span><span class="p">(</span><span class="n">DEMOPROG</span><span class="p">)</span> <span class="n">PROFILE</span><span class="p">(</span><span class="n">DFHCICST</span><span class="p">)</span> <span class="n">STATUS</span><span class="p">(</span><span class="n">ENABLED</span><span class="p">)</span>
<span class="n">DEFINE</span> <span class="n">TRANSACTION</span><span class="p">(</span><span class="n">VEMO</span><span class="p">)</span> <span class="n">GROUP</span><span class="p">(</span><span class="n">DEMOGRP</span><span class="p">)</span>
    <span class="n">PROGRAM</span><span class="p">(</span><span class="n">DEMOPROG</span><span class="p">)</span> <span class="n">PROFILE</span><span class="p">(</span><span class="n">DFHCICST</span><span class="p">)</span> <span class="n">STATUS</span><span class="p">(</span><span class="n">ENABLED</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Defining an alternate CICS transaction code for an application</em></p>
<p>The figure below shows sample VIRCONF statements to define a VIRTEL transaction which starts the application using
the CICS transaction code VEMO:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TRANSACT</span> <span class="n">ID</span><span class="o">=</span><span class="n">CLI</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">NAME</span><span class="o">=</span><span class="s1">&#39;CICS&#39;</span><span class="p">,</span>
        <span class="n">DESC</span><span class="o">=</span><span class="s1">&#39;Logon to DEMO application&#39;</span><span class="p">,</span>
        <span class="n">APPL</span><span class="o">=</span><span class="n">DBDCCICS</span><span class="p">,</span>
        <span class="n">TYPE</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">TERMINAL</span><span class="o">=</span><span class="n">CLVTA</span><span class="p">,</span>
        <span class="n">integration</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">SECURITY</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">TIOASTA</span><span class="o">=</span><span class="s2">&quot;Signon&amp;/W&amp;*7D4C7D&amp;&#39;114BE9&#39;&amp;U&amp;&#39;114CF9&#39;&amp;P&amp;/Acomplete&amp;/W VEMO&amp;/A&quot;</span>
</pre></div>
</div>
<p><em>Invoking the alternate transaction code from VIRTEL</em></p>
<p>The figure below shows sample COBOL statements which allow the DEMOPROG program to take different actions
based upon the CICS transaction code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="n">Working</span><span class="o">-</span><span class="n">Storage</span><span class="p">:</span>

<span class="mi">01</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span><span class="o">-</span><span class="n">SW</span>       <span class="n">PIC</span> <span class="n">X</span><span class="o">.</span>
    <span class="mi">88</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span>      <span class="n">VALUE</span> <span class="s1">&#39;Y&#39;</span><span class="o">.</span>
    <span class="mi">88</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span>  <span class="n">VALUE</span> <span class="s1">&#39;N&#39;</span><span class="o">.</span>

<span class="n">In</span> <span class="n">the</span> <span class="n">Procedure</span> <span class="n">Division</span><span class="p">:</span>

<span class="n">IF</span> <span class="n">EIBTRNID</span> <span class="p">(</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;V&#39;</span>
    <span class="n">MOVE</span> <span class="s1">&#39;Y&#39;</span> <span class="n">TO</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span><span class="o">-</span><span class="n">SW</span>
<span class="n">ELSE</span>
    <span class="n">MOVE</span> <span class="s1">&#39;N&#39;</span> <span class="n">TO</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span><span class="o">-</span><span class="n">SW</span>
<span class="n">END</span><span class="o">-</span><span class="n">IF</span>
</pre></div>
</div>
<p><em>Detecting VIRTEL by testing the transaction code</em></p>
</div>
<div class="section" id="include-parameters-after-the-transaction-code">
<span id="index-370"></span><h4>Include parameters after the transaction code<a class="headerlink" href="#include-parameters-after-the-transaction-code" title="Permalink to this headline">¶</a></h4>
<p>By adding additional data after the transaction code when the transaction is invoked by VIRTEL, the application can
receive the parameter data to verify whether it is running under VIRTEL. In the following example we add a V after the
transaction code when the application is called via VIRTEL.
The figure below shows sample VIRCONF statements to define a VIRTEL transaction which starts the CICS transaction
DEMO with an additional parameter (“V”):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TRANSACT</span> <span class="n">ID</span><span class="o">=</span><span class="n">CLI</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">NAME</span><span class="o">=</span><span class="s1">&#39;CICS&#39;</span><span class="p">,</span>
        <span class="n">DESC</span><span class="o">=</span><span class="s1">&#39;Logon to DEMO application&#39;</span><span class="p">,</span>
        <span class="n">APPL</span><span class="o">=</span><span class="n">DBDCCICS</span><span class="p">,</span>
        <span class="n">TYPE</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">TERMINAL</span><span class="o">=</span><span class="n">CLVTA</span><span class="p">,</span>
        <span class="n">integration</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">SECURITY</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">TIOASTA</span><span class="o">=</span><span class="s2">&quot;Signon&amp;/W&amp;*7D4C7D&amp;&#39;114BE9&#39;&amp;U&amp;&#39;114CF9&#39;&amp;P&amp;/Acomplete&amp;/W DEMOV&amp;/A&quot;</span>
</pre></div>
</div>
<p><em>Invoking a CICS transaction with additional parameters</em></p>
<p>The figure below shows sample COBOL statements which must be added to the DEMOPROG program to receive and
test the parameter data. When the transaction is started by VIRTEL, the parameter field contains “V”. When the
transaction is started from a terminal, using the transaction code DEMO with no additional parameters, the parameter
field contains spaces:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ow">in</span> <span class="n">Working</span><span class="o">-</span><span class="n">Storage</span><span class="p">:</span>

<span class="mi">01</span> <span class="n">CICS</span><span class="o">-</span><span class="n">TIOA</span><span class="o">.</span>
    <span class="mi">02</span> <span class="n">CICS</span><span class="o">-</span><span class="n">TIOA</span><span class="o">-</span><span class="n">TRANID</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">VALUE</span> <span class="n">SPACES</span><span class="o">.</span>
    <span class="mi">02</span> <span class="n">CICS</span><span class="o">-</span><span class="n">TIOA</span><span class="o">-</span><span class="n">PARAMV</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">VALUE</span> <span class="n">SPACES</span><span class="o">.</span>
    <span class="mi">02</span> <span class="n">FILLER</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">75</span><span class="p">)</span> <span class="n">VALUE</span> <span class="n">SPACES</span><span class="o">.</span>
<span class="mi">01</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span><span class="o">-</span><span class="n">SW</span> <span class="n">PIC</span> <span class="n">X</span><span class="o">.</span>
    <span class="mi">88</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span> <span class="n">VALUE</span> <span class="s1">&#39;Y&#39;</span><span class="o">.</span>
    <span class="mi">88</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span> <span class="n">VALUE</span> <span class="s1">&#39;N&#39;</span><span class="o">.</span>

<span class="ow">in</span> <span class="n">the</span> <span class="n">Procedure</span> <span class="n">Division</span><span class="p">:</span>

<span class="n">EXEC</span> <span class="n">CICS</span> <span class="n">RECEIVE</span>
        <span class="n">INTO</span><span class="p">(</span><span class="n">CICS</span><span class="o">-</span><span class="n">TIOA</span><span class="p">)</span>
<span class="n">END</span><span class="o">-</span><span class="n">EXEC</span>
<span class="n">IF</span> <span class="n">CICS</span><span class="o">-</span><span class="n">TIOA</span><span class="o">-</span><span class="n">PARAMV</span> <span class="o">=</span> <span class="s1">&#39;V&#39;</span>
    <span class="n">MOVE</span> <span class="s1">&#39;Y&#39;</span> <span class="n">TO</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span><span class="o">-</span><span class="n">SW</span>
<span class="n">ELSE</span>
    <span class="n">MOVE</span> <span class="s1">&#39;N&#39;</span> <span class="n">TO</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span><span class="o">-</span><span class="n">SW</span>
<span class="n">END</span><span class="o">-</span><span class="n">IF</span>
</pre></div>
</div>
<p><em>Detecting VIRTEL by inspecting the contents of the TIOA</em></p>
</div>
<div class="section" id="use-a-specific-range-of-terminal-names">
<span id="index-371"></span><h4>Use a specific range of terminal names<a class="headerlink" href="#use-a-specific-range-of-terminal-names" title="Permalink to this headline">¶</a></h4>
<p>Since all VIRTEL requests are made from the VIRTEL terminal pool, the application program can test the CICS terminal
id or the VTAM LU name to determine if it is running under VIRTEL, as shown in the following example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TERMINAL</span> <span class="n">ID</span><span class="o">=</span><span class="n">W2HTP000</span><span class="p">,</span>
        <span class="n">RELAY</span><span class="o">=</span><span class="n">VIRTVT00</span><span class="p">,</span>
        <span class="n">POOL</span><span class="o">=*</span><span class="n">W2HPOOL</span><span class="p">,</span>
        <span class="n">DESC</span><span class="o">=</span><span class="s1">&#39;Relay pool for HTTP&#39;</span><span class="p">,</span>
        <span class="n">RELAY2</span><span class="o">=</span><span class="n">VIRTPR00</span><span class="p">,</span>
        <span class="n">TYPE</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">COMPRESS</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">INOUT</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">STATS</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">REPEAT</span><span class="o">=</span><span class="mi">0080</span>
</pre></div>
</div>
<p><em>Defining the VIRTEL terminal pool</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>VIRTVT?? APPL AUTH=(ACQ,PASS),MODETAB=ISTINCLM,DLOGMOD=SNX32702,EAS=1
</pre></div>
</div>
<p><em>VTAM definition for the VIRTEL terminal pool</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="n">Working</span><span class="o">-</span><span class="n">Storage</span><span class="p">:</span>

<span class="mi">01</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span><span class="o">-</span><span class="n">SW</span> <span class="n">PIC</span> <span class="n">X</span><span class="o">.</span>
    <span class="mi">88</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span> <span class="n">VALUE</span> <span class="s1">&#39;Y&#39;</span><span class="o">.</span>
    <span class="mi">88</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span> <span class="n">VALUE</span> <span class="s1">&#39;N&#39;</span><span class="o">.</span>

<span class="n">In</span> <span class="n">the</span> <span class="n">Procedure</span> <span class="n">Division</span><span class="p">:</span>

<span class="n">IF</span> <span class="n">EIBTRMID</span> <span class="p">(</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;VT&#39;</span>
    <span class="n">MOVE</span> <span class="s1">&#39;Y&#39;</span> <span class="n">TO</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span><span class="o">-</span><span class="n">SW</span>
<span class="n">ELSE</span>
    <span class="n">MOVE</span> <span class="s1">&#39;N&#39;</span> <span class="n">TO</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span><span class="o">-</span><span class="n">SW</span>
<span class="n">END</span><span class="o">-</span><span class="n">IF</span>
</pre></div>
</div>
<p><em>Detecting VIRTEL by testing the CICS terminal id</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="n">Working</span><span class="o">-</span><span class="n">Storage</span><span class="p">:</span>

<span class="mi">01</span> <span class="n">MYLUNAME</span>                    <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span>
<span class="mi">01</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span><span class="o">-</span><span class="n">SW</span>      <span class="n">PIC</span> <span class="n">X</span><span class="o">.</span>
    <span class="mi">88</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span>     <span class="n">VALUE</span> <span class="s1">&#39;Y&#39;</span><span class="o">.</span>
    <span class="mi">88</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">NOT</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span> <span class="n">VALUE</span> <span class="s1">&#39;N&#39;</span><span class="o">.</span>

<span class="n">In</span> <span class="n">the</span> <span class="n">Procedure</span> <span class="n">Division</span><span class="p">:</span>

<span class="n">EXEC</span> <span class="n">CICS</span> <span class="n">ASSIGN</span>
        <span class="n">NETNAME</span><span class="p">(</span><span class="n">MYLUNAME</span><span class="p">)</span>
<span class="n">END</span><span class="o">-</span><span class="n">EXEC</span>
<span class="n">IF</span> <span class="n">MYLUNAME</span> <span class="p">(</span><span class="mi">1</span> <span class="p">:</span> <span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;VIRT&#39;</span>
    <span class="n">MOVE</span> <span class="s1">&#39;Y&#39;</span> <span class="n">TO</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span><span class="o">-</span><span class="n">SW</span>
<span class="n">ELSE</span>
    <span class="n">MOVE</span> <span class="s1">&#39;N&#39;</span> <span class="n">TO</span> <span class="n">THIS</span><span class="o">-</span><span class="n">IS</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">CALL</span><span class="o">-</span><span class="n">SW</span>
<span class="n">END</span><span class="o">-</span><span class="n">IF</span>
</pre></div>
</div>
<p><em>Detecting VIRTEL by testing the VTAM LU name</em></p>
</div>
<div class="section" id="fa88-transmit-large-data-message-to-application">
<span id="index-372"></span><h4>FA88: Transmit large data message to application<a class="headerlink" href="#fa88-transmit-large-data-message-to-application" title="Permalink to this headline">¶</a></h4>
<p>By using the FA88 structured field, an application can request data from an HTTP terminal without being limited to the
size of a 3270 screen.</p>
<p>The application sends an FA88 structured field containing the name of a URL parameter to be retrieved. The “send
message to terminal” flag causes VIRTEL to send an HTTP response to the terminal. When the terminal sends its next
URL, VIRTEL sends to the application an FA88 structured field response containing the value of the URL parameter. The
application may retrieve the value in multiple segments. If the value exceeds 32K in size then it must be retrieved in
multiple segments. Once the first segment has been received, the application requests subsequent segments by
sending another FA88 structured field containing the “immediate answer” flag and the offset of the segment
requested. VIRTEL responds with an FA88 structured field response containing the segment requested. In each
response VIRTEL sets the flag byte to indicate whether there is more data to be retrieved, and if so the number of
bytes remaining. The application continues the procedure until there is no more data to be retrieved.</p>
<p>The format of the FA88 structured field sent by the application is shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">structured</span> <span class="n">field</span> <span class="o">=</span> <span class="mi">14</span> <span class="o">+</span> <span class="n">n</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Structured</span> <span class="n">field</span> <span class="n">identification</span> <span class="n">code</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;FA88&#39;</span>
<span class="o">-</span> <span class="mi">1</span> <span class="nb">bytes</span> <span class="n">X</span><span class="s1">&#39;00&#39;</span>
<span class="o">-</span> <span class="mi">1</span> <span class="nb">bytes</span> <span class="n">Flags</span><span class="p">:</span>
        <span class="n">X</span><span class="s1">&#39;01&#39;</span> <span class="o">=</span> <span class="n">immediate</span> <span class="n">answer</span>
        <span class="n">X</span><span class="s1">&#39;04&#39;</span> <span class="o">=</span> <span class="n">send</span> <span class="n">message</span> <span class="n">to</span> <span class="n">terminal</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Maximum</span> <span class="n">segment</span> <span class="n">size</span> <span class="n">requested</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="o">-</span> <span class="mi">4</span> <span class="nb">bytes</span> <span class="n">Offset</span> <span class="n">of</span> <span class="n">requested</span> <span class="n">segment</span> <span class="p">(</span><span class="n">o</span><span class="p">)</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">name</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="o">-</span> <span class="n">n</span> <span class="nb">bytes</span> <span class="n">Name</span> <span class="n">of</span> <span class="n">URL</span> <span class="n">parameter</span>
</pre></div>
</div>
<p><em>Format of structured field FA88</em></p>
<p>The format of the FA88 structured field response returned by VIRTEL is shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">structured</span> <span class="n">field</span> <span class="o">=</span> <span class="mi">14</span> <span class="o">+</span> <span class="n">n</span> <span class="o">+</span> <span class="n">x</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Structured</span> <span class="n">field</span> <span class="n">identification</span> <span class="n">code</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;FA88&#39;</span>
<span class="o">-</span> <span class="mi">1</span> <span class="nb">bytes</span> <span class="n">X</span><span class="s1">&#39;00&#39;</span>
<span class="o">-</span> <span class="mi">1</span> <span class="nb">bytes</span> <span class="n">Flags</span><span class="p">:</span>
            <span class="n">X</span><span class="s1">&#39;02&#39;</span> <span class="o">=</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">data</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">segment</span> <span class="n">returned</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="o">-</span> <span class="mi">4</span> <span class="nb">bytes</span> <span class="n">Number</span> <span class="n">of</span> <span class="nb">bytes</span> <span class="n">remaining</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">name</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="o">-</span> <span class="n">n</span> <span class="nb">bytes</span> <span class="n">Name</span> <span class="n">of</span> <span class="n">variable</span>
<span class="o">-</span> <span class="n">x</span> <span class="nb">bytes</span> <span class="n">Requested</span> <span class="n">data</span> <span class="n">segment</span>
</pre></div>
</div>
<p><em>Format of structured field response FA88</em></p>
</div>
<div class="section" id="fac8-selection-of-page-template">
<span id="index-373"></span><h4>FAC8: Selection of page template<a class="headerlink" href="#fac8-selection-of-page-template" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL recognizes the FAC8 structured field for the following operations:
- Change of directory for HTML page templates
- Change of HTML page template</p>
<p>To perform more than one function at a time, multiple FAC8 structured fields can be sent in the same message.</p>
<div class="section" id="structured-field-fac8-code-06">
<span id="index-374"></span><h5>Structured field FAC8 code 06<a class="headerlink" href="#structured-field-fac8-code-06" title="Permalink to this headline">¶</a></h5>
<p>Structured field FAC8 code 06 allows the application to specify the name of the VIRTEL directory to be used to retrieve
the page template for the current 3270 screen and all subsequent screens.
The format of a structured field FAC8 code 06 is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">structured</span> <span class="n">field</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;000D&#39;</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Structured</span> <span class="n">field</span> <span class="n">identification</span> <span class="n">code</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;FAC8&#39;</span>
<span class="o">-</span> <span class="mi">1</span> <span class="nb">bytes</span> <span class="n">Code</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;06&#39;</span> <span class="p">(</span><span class="n">change</span> <span class="n">VIRTEL</span> <span class="n">directory</span><span class="p">)</span>
<span class="o">-</span> <span class="mi">8</span> <span class="nb">bytes</span> <span class="n">Directory</span> <span class="n">name</span>
</pre></div>
</div>
<p><em>Format of structured field FAC8 code 06</em></p>
</div>
<div class="section" id="structured-field-fac8-code-07">
<span id="index-375"></span><h5>Structured field FAC8 code 07<a class="headerlink" href="#structured-field-fac8-code-07" title="Permalink to this headline">¶</a></h5>
<p>Structured field FAC8 code 07 allows the application to specify the name of the page template for the current 3270
screen and all subsequent screens.</p>
<p>The format of a structured field FAC8 code 07 is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">structured</span> <span class="n">field</span> <span class="o">=</span> <span class="n">variable</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Structured</span> <span class="n">field</span> <span class="n">identification</span> <span class="n">code</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;FAC8&#39;</span>
<span class="o">-</span> <span class="mi">1</span> <span class="nb">bytes</span> <span class="n">Code</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;07&#39;</span> <span class="p">(</span><span class="n">change</span> <span class="n">HTML</span> <span class="n">page</span> <span class="n">template</span><span class="p">)</span>
<span class="o">-</span> <span class="n">n</span> <span class="nb">bytes</span> <span class="n">Page</span> <span class="n">template</span> <span class="n">name</span>
</pre></div>
</div>
<p><em>Format of structured field FAC8 code 07</em></p>
</div>
<div class="section" id="cobol-example-using-fac8">
<span id="index-376"></span><h5>COBOL example using FAC8<a class="headerlink" href="#cobol-example-using-fac8" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ow">in</span> <span class="n">Working</span><span class="o">-</span><span class="n">Storage</span><span class="p">:</span>
<span class="o">*////////////////////////////////////////////////////////////////*</span>
<span class="o">*///*</span> <span class="o">-</span> <span class="n">FAC8</span> <span class="n">request</span> <span class="n">to</span> <span class="n">VIRTEL</span> <span class="p">(</span><span class="n">HTML</span> <span class="n">page</span> <span class="n">management</span><span class="p">)</span> <span class="o">*///*</span>
<span class="o">*///*</span> <span class="o">-</span> <span class="n">send</span> <span class="n">structured</span> <span class="n">field</span><span class="p">:</span> <span class="o">*///*</span>
<span class="o">*///*</span> <span class="n">F3</span> <span class="n">LLLL</span> <span class="n">FAC8</span> <span class="n">F</span> <span class="n">PAGE</span> <span class="ow">or</span> <span class="n">DIRECTORY</span> <span class="o">*///*</span>
<span class="o">*///*</span> <span class="n">LLLL</span><span class="p">:</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">structured</span> <span class="n">field</span> <span class="p">(</span><span class="mi">2</span> <span class="n">BYTES</span><span class="p">)</span> <span class="o">*///*</span>
<span class="o">*///*</span> <span class="n">FAC8</span><span class="p">:</span> <span class="n">Structured</span> <span class="n">field</span> <span class="nb">id</span> <span class="n">code</span> <span class="p">(</span><span class="mi">2</span> <span class="n">BYTES</span><span class="p">)</span> <span class="o">*///*</span>
<span class="o">*///*</span> <span class="n">F</span> <span class="p">:</span> <span class="n">Requested</span> <span class="n">function</span> <span class="p">(</span><span class="mi">1</span> <span class="n">BYTE</span> <span class="n">BINARY</span><span class="p">)</span> <span class="o">*///*</span>
<span class="o">*///*</span> <span class="mi">06</span><span class="p">:</span> <span class="n">change</span> <span class="n">VIRTEL</span> <span class="n">directory</span> <span class="o">*///*</span>
<span class="o">*///*</span> <span class="mi">07</span><span class="p">:</span> <span class="n">change</span> <span class="n">HTML</span> <span class="n">page</span> <span class="n">template</span> <span class="o">*///*</span>
<span class="o">*///*</span> <span class="n">PAGE</span> <span class="ow">or</span> <span class="n">DIRECTORY</span><span class="p">:</span> <span class="n">name</span> <span class="p">(</span><span class="mi">8</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">*///*</span>
<span class="o">*////////////////////////////////////////////////////////////////*</span>

<span class="mi">01</span> <span class="n">FAC8</span><span class="o">-</span><span class="n">DEM</span><span class="o">.</span>

    <span class="mi">05</span> <span class="n">FAC8</span><span class="o">-</span><span class="n">LONG</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">5.</span>
    <span class="mi">05</span> <span class="n">FAC8</span><span class="o">-</span><span class="n">FILL1</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">02</span><span class="p">)</span> <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;FAC8&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC8</span><span class="o">-</span><span class="n">FONCTION</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">01</span><span class="p">)</span> <span class="n">VALUE</span> <span class="s1">&#39; &#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC8</span><span class="o">-</span><span class="n">ARGUMENT</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">08</span><span class="p">)</span> <span class="n">VALUE</span> <span class="n">SPACES</span><span class="o">.</span>

<span class="mi">01</span> <span class="n">FAC8</span><span class="o">-</span><span class="n">DEM</span><span class="o">-</span><span class="n">REPERTOIRE</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">01</span><span class="p">)</span> <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;06&#39;</span><span class="o">.</span>
<span class="mi">01</span> <span class="n">FAC8</span><span class="o">-</span><span class="n">DEM</span><span class="o">-</span><span class="n">PAGE</span><span class="o">-</span><span class="n">HTML</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">01</span><span class="p">)</span> <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;07&#39;</span><span class="o">.</span>

<span class="ow">in</span> <span class="n">the</span> <span class="n">Procedure</span> <span class="n">Division</span><span class="p">:</span>

    <span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAC8</span><span class="o">-</span><span class="n">DEM</span> <span class="n">TO</span> <span class="n">FAC8</span><span class="o">-</span><span class="n">LONG</span><span class="o">.</span>
    <span class="n">MOVE</span> <span class="n">FAC8</span><span class="o">-</span><span class="n">DEM</span><span class="o">-</span><span class="n">PAGE</span><span class="o">-</span><span class="n">HTML</span> <span class="n">TO</span> <span class="n">FAC8</span><span class="o">-</span><span class="n">FONCTION</span><span class="o">.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;TOUTNOIR&#39;</span> <span class="n">TO</span> <span class="n">FAC8</span><span class="o">-</span><span class="n">ARGUMENT</span><span class="o">.</span>
    <span class="n">PERFORM</span> <span class="mi">8150</span><span class="o">-</span><span class="n">ENVOI</span><span class="o">-</span><span class="n">FAC8</span> <span class="n">THRU</span> <span class="mi">8150</span><span class="o">-</span><span class="n">FIN</span>
    <span class="n">PERFORM</span> <span class="mi">8830</span><span class="o">-</span><span class="n">ENVOI</span><span class="o">-</span><span class="n">MAP</span> <span class="n">THRU</span> <span class="mi">8830</span><span class="o">-</span><span class="n">FIN</span><span class="o">.</span>

<span class="o">*//////////////////////</span> <span class="n">SEND</span> <span class="n">STRUCTURED</span> <span class="n">FIELD</span> <span class="o">///////////////////*</span>

<span class="mi">8150</span><span class="o">-</span><span class="n">ENVOI</span><span class="o">-</span><span class="n">FAC8</span><span class="o">.</span>

    <span class="n">EXEC</span> <span class="n">CICS</span> <span class="n">SEND</span>  <span class="n">FROM</span> <span class="p">(</span><span class="n">FAC8</span><span class="o">-</span><span class="n">DEM</span><span class="p">)</span>
                    <span class="n">FROMLENGTH</span> <span class="p">(</span><span class="n">FAC8</span><span class="o">-</span><span class="n">LONG</span><span class="p">)</span>
                    <span class="n">STRFIELD</span>
                    <span class="n">END</span><span class="o">-</span><span class="n">EXEC</span><span class="o">.</span>
<span class="mi">8150</span><span class="o">-</span><span class="n">FIN</span><span class="o">.</span>

<span class="o">*///////////////////////</span> <span class="n">SEND</span> <span class="n">MESSAGE</span> <span class="mi">3270</span> <span class="o">///////////////////////*</span>

<span class="mi">8830</span><span class="o">-</span><span class="n">ENVOI</span><span class="o">-</span><span class="n">MAP</span><span class="o">.</span>
    <span class="n">EXEC</span> <span class="n">CICS</span> <span class="n">SEND</span>  <span class="n">MAP</span> <span class="p">(</span><span class="s1">&#39;NOMMAP2&#39;</span><span class="p">)</span>
                    <span class="n">MAPSET</span> <span class="p">(</span><span class="s1">&#39;NONMAP2&#39;</span><span class="p">)</span>
                    <span class="n">ERASE</span>
                    <span class="n">CURSOR</span> <span class="p">(</span><span class="n">CICS</span><span class="o">-</span><span class="n">TS</span><span class="o">-</span><span class="n">POS</span><span class="o">-</span><span class="n">CURS</span><span class="p">)</span>
                    <span class="n">END</span><span class="o">-</span><span class="n">EXEC</span><span class="o">.</span>
<span class="mi">8830</span><span class="o">-</span><span class="n">FIN</span><span class="o">.</span>
</pre></div>
</div>
<p><em>Example of sending structured field FAC8</em></p>
<p>An example of this function is supplied in member FAC8SAMP of the VIRTEL SAMPLIB.</p>
</div>
</div>
<div class="section" id="fae5-fae6-sending-a-table-variable">
<span id="index-377"></span><h4>FAE5, FAE6: Sending a table variable<a class="headerlink" href="#fae5-fae6-sending-a-table-variable" title="Permalink to this headline">¶</a></h4>
<p>Structured field FAE5 allows the application to send a named data table (“table variable”) to VIRTEL. The data in the
table variable is made available for insertion in the current HTML page by means of VIRTEL tags coded in the page
template (see <a class="reference internal" href="#ug-table-variables"><span class="std std-ref">“Handling table variables”</span></a>), or by means of a scenario instruction (see “FIELD$ DEFINE-CHOICE”,
page 174) which allows the application to supply lists of drop-down values for selection fields.</p>
<span class="target" id="ug-fae5"></span><div class="section" id="structured-field-fae5">
<span id="index-378"></span><h5>Structured field FAE5<a class="headerlink" href="#structured-field-fae5" title="Permalink to this headline">¶</a></h5>
<p>The application can send one or more FAE5 structured fields. Each structured field contains the name of a variable
followed by a table of values. The format of structured field FAE5 is shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">structured</span> <span class="n">field</span> <span class="o">=</span> <span class="n">variable</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Structured</span> <span class="n">field</span> <span class="n">identification</span> <span class="n">code</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;FAE5&#39;</span>
<span class="o">-</span> <span class="mi">1</span> <span class="nb">bytes</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">each</span> <span class="n">value</span> <span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="o">-</span> <span class="mi">1</span> <span class="nb">bytes</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">name</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="o">-</span> <span class="n">n</span> <span class="nb">bytes</span> <span class="n">Name</span> <span class="n">of</span> <span class="n">variable</span>
<span class="o">-</span> <span class="n">p</span> <span class="nb">bytes</span> <span class="n">Value</span> <span class="mi">1</span>
<span class="o">-</span> <span class="n">p</span> <span class="nb">bytes</span> <span class="n">Value</span> <span class="mi">2</span>
<span class="o">-</span> <span class="n">etc</span>
</pre></div>
</div>
<p><em>Format of structured field FAE5 – format 1</em></p>
<p>The above format limits the length of each value to a maximum of 255 bytes. A second format of the FAE5 structured
field allows the application to set a single value whose length is equal to the remainder of the structured field:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>- 2 bytes Length of structured field = variable
- 2 bytes Structured field identification code = X&#39;FAE5&#39;
- 1 bytes X&#39;00&#39;
- 1 bytes Length of name (n)
- n bytes Name of variable
- x bytes Value (x=structured field length – 6 – n)
</pre></div>
</div>
<p><em>Format of structured field FAE5 – format 2</em></p>
<p>After the application has sent a message containing an FAE5 structured field, VIRTEL considers the current screen
complete and sends the response to the user.</p>
</div>
<div class="section" id="structured-field-fae6">
<span id="index-379"></span><h5>Structured field FAE6<a class="headerlink" href="#structured-field-fae6" title="Permalink to this headline">¶</a></h5>
<p>Structured field FAE6 is identical to FAE5, except that VIRTEL does not consider the current screen to be complete, and
waits for a further output message from the application before sending the response to the user.</p>
</div>
<div class="section" id="cobol-example-using-fae5">
<span id="index-380"></span><h5>COBOL example using FAE5<a class="headerlink" href="#cobol-example-using-fae5" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ow">in</span> <span class="n">Working</span><span class="o">-</span><span class="n">Storage</span><span class="p">:</span>

<span class="mi">01</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">LONG</span>                    <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>   <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
<span class="mi">01</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">AREA</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">VARIABLE</span><span class="o">-</span><span class="mf">1.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="mi">1</span>      <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>   <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>               <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;FAE5&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">LONG</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">1</span>    <span class="n">PIC</span> <span class="n">X</span>       <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;0A&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">LONG</span><span class="o">-</span><span class="n">NOM</span><span class="o">-</span><span class="mi">1</span>      <span class="n">PIC</span> <span class="n">X</span>       <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;08&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">NOM</span><span class="o">-</span><span class="mi">1</span>           <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="s1">&#39;VARNAME1&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span>       <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>   <span class="n">VALUE</span> <span class="s1">&#39;VALUE1&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span>       <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>   <span class="n">VALUE</span> <span class="s1">&#39;VALUE2&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">3</span>       <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>   <span class="n">VALUE</span> <span class="s1">&#39;VALUE3&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">VARIABLE</span><span class="o">-</span><span class="mf">2.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="mi">2</span>      <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>   <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>               <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;FAE5&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">LONG</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">2</span>    <span class="n">PIC</span> <span class="n">X</span>       <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;04&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">LONG</span><span class="o">-</span><span class="n">NOM</span><span class="o">-</span><span class="mi">2</span>      <span class="n">PIC</span> <span class="n">X</span>       <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;08&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">NOM</span><span class="o">-</span><span class="mi">2</span>           <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="s1">&#39;VARNAME2&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>       <span class="n">PIC</span> <span class="mi">9</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="mf">123.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span>       <span class="n">PIC</span> <span class="mi">9</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="mf">234.</span>
        <span class="mi">10</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mi">3</span>       <span class="n">PIC</span> <span class="mi">9</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="mf">457.</span>

<span class="ow">in</span> <span class="n">the</span> <span class="n">Procedure</span> <span class="n">Division</span><span class="p">:</span>

<span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">VARIABLE</span><span class="o">-</span><span class="mi">1</span> <span class="n">TO</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="mi">1</span>
<span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">VARIABLE</span><span class="o">-</span><span class="mi">2</span> <span class="n">TO</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="mi">2</span>
<span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">AREA</span> <span class="n">TO</span> <span class="n">FAE5</span><span class="o">-</span><span class="n">LONG</span>
<span class="n">EXEC</span> <span class="n">CICS</span> <span class="n">SEND</span>  <span class="n">FROM</span><span class="p">(</span><span class="n">FAE5</span><span class="o">-</span><span class="n">AREA</span><span class="p">)</span>
                <span class="n">LENGTH</span><span class="p">(</span><span class="n">FAE5</span><span class="o">-</span><span class="n">LONG</span><span class="p">)</span>
                <span class="n">STRFIELD</span>
<span class="n">END</span><span class="o">-</span><span class="n">EXEC</span>
</pre></div>
</div>
<p><em>Example of sending structured field FAE5</em></p>
</div>
</div>
<div class="section" id="call-interface">
<span id="index-381"></span><h4>Call Interface<a class="headerlink" href="#call-interface" title="Permalink to this headline">¶</a></h4>
<p>Application programs running in a CICS or IMS environment using Language Environment (LE) can request certain
VIRTEL Web Integration functions by means of callable modules. These modules construct the necessary structured
fields and send them to VIRTEL via CICS or IMS, thus simplifying the job of the application programmer. These modules
are primarily designed to be called by CICS or IMS-COBOL programs, however they can also be used by application
programs written in other languages. The modules, CALL VIRSETA, CALL VIRSETV (for CICS), CALL VIRSETAI, CALL
VIRSETVI (for IMS) and CALL VIRTEL, are described in the following sections.</p>
<div class="section" id="call-virseta">
<span id="index-382"></span><h5>CALL VIRSETA<a class="headerlink" href="#call-virseta" title="Permalink to this headline">¶</a></h5>
<p>This module allows a CICS application program to copy an array of values into a VIRTEL table variable. The calling
program supplies the name of the variable and an array containing the values. The VIRSETA module builds one or more
FAE6 structured fields containing the variable name and the values, and sends the structured field(s) to VIRTEL using
the EXEC CICS SEND STRFIELD command.
The total size of the structured fields sent by a single call to VIRSETA cannot exceed 32K, but additional data can be
added to the VIRTEL table variable by calling VIRSETA again with the same variable name.
When VIRSETA is used to copy values into a VIRTEL table variable, all of the values must have the same length. To
create a VIRTEL table variable containing values of varying lengths, use CALL VIRSETV described in the next section.</p>
</div>
<div class="section" id="call-virseta-parameters">
<span id="index-383"></span><h5>CALL VIRSETA parameters<a class="headerlink" href="#call-virseta-parameters" title="Permalink to this headline">¶</a></h5>
<p>Parameters passed by calling program:</p>
<ol class="arabic simple">
<li>DFHEIBLK</li>
<li>DFHCOMMAREA</li>
<li>Variable name (variable length EBCDIC string of 1-255 characters terminated by blank or X‘00’)</li>
<li>An array of elements each containing one data item</li>
<li>Element size (signed halfword) contains the length of each element of the array</li>
<li>Count (signed halfword) contains the number of elements in the array</li>
<li>Data length (signed halfword) contains the length of the data item contained in each element of the array. This may be less than or equal to the element size.</li>
</ol>
</div>
<div class="section" id="call-virseta-example">
<span id="index-384"></span><h5>CALL VIRSETA example<a class="headerlink" href="#call-virseta-example" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ow">in</span> <span class="n">Working</span><span class="o">-</span><span class="n">Storage</span><span class="p">:</span>
<span class="mi">01</span> <span class="n">WS</span><span class="o">-</span><span class="n">ARRAY</span><span class="o">.</span>
<span class="mi">05</span> <span class="n">WS</span><span class="o">-</span><span class="n">ELEMENT</span> <span class="n">OCCURS</span> <span class="mi">50</span> <span class="n">TIMES</span><span class="o">.</span>
<span class="mi">10</span> <span class="n">WS</span><span class="o">-</span><span class="n">DATA</span><span class="o">-</span><span class="n">ITEM</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span><span class="o">.</span>
<span class="mi">10</span> <span class="n">FILLER</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span>
<span class="mi">77</span> <span class="n">WS</span><span class="o">-</span><span class="n">ELEMENT</span><span class="o">-</span><span class="n">SIZE</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">SYNC</span><span class="o">.</span>
<span class="mi">77</span> <span class="n">WS</span><span class="o">-</span><span class="n">COUNT</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">SYNC</span><span class="o">.</span>
<span class="mi">77</span> <span class="n">WS</span><span class="o">-</span><span class="n">DATA</span><span class="o">-</span><span class="n">LENGTH</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">SYNC</span><span class="o">.</span>
<span class="ow">in</span> <span class="n">the</span> <span class="n">Procedure</span> <span class="n">Division</span><span class="p">:</span>
<span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">WS</span><span class="o">-</span><span class="n">ELEMENT</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">WS</span><span class="o">-</span><span class="n">ELEMENT</span><span class="o">-</span><span class="n">SIZE</span><span class="o">.</span>
<span class="n">MOVE</span> <span class="mi">50</span> <span class="n">TO</span> <span class="n">WS</span><span class="o">-</span><span class="n">COUNT</span><span class="o">.</span>
<span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">WS</span><span class="o">-</span><span class="n">DATA</span><span class="o">-</span><span class="n">ITEM</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">WS</span><span class="o">-</span><span class="n">DATA</span><span class="o">-</span><span class="n">LENGTH</span><span class="o">.</span>
<span class="n">CALL</span> <span class="s1">&#39;VIRSETA&#39;</span> <span class="n">USING</span> <span class="n">DFHEIBLK</span>
<span class="n">DFHCOMMAREA</span>
<span class="n">BY</span> <span class="n">CONTENT</span> <span class="s1">&#39;MYVAR &#39;</span>
<span class="n">BY</span> <span class="n">REFERENCE</span> <span class="n">WS</span><span class="o">-</span><span class="n">ARRAY</span>
<span class="n">WS</span><span class="o">-</span><span class="n">ELEMENT</span><span class="o">-</span><span class="n">SIZE</span>
<span class="n">WS</span><span class="o">-</span><span class="n">COUNT</span>
<span class="n">WS</span><span class="o">-</span><span class="n">DATA</span><span class="o">-</span><span class="n">LENGTH</span><span class="o">.</span>
</pre></div>
</div>
<p><em>Example of VIRTEL Web Integration application using CALL VIRSETA</em></p>
</div>
<div class="section" id="call-virseta-return-codes">
<span id="index-385"></span><h5>CALL VIRSETA return codes<a class="headerlink" href="#call-virseta-return-codes" title="Permalink to this headline">¶</a></h5>
<p>If the call was successful, VIRSETA returns to the calling program. Otherwise, VIRSETA terminates with an EXEC CICS ABEND.
The following abend codes may be issued by VIRSETA:</p>
<dl class="docutils">
<dt>VSA1</dt>
<dd>Length of variable name is outside the range 1-255, or the required terminator (blank or X‘00’) is missing</dd>
<dt>VSA2</dt>
<dd>Data length is less than 1, or exceeds the element length.</dd>
<dt>VSA3</dt>
<dd>Count is less than 1.</dd>
<dt>VSA4</dt>
<dd>Data exceeds the maximum allowed size. If the length of each data item is 255 or less, then the total size of the data (count x data length) must not exceed 32760 – N, where N is the number of characters in the variable name. If the length of each data item is 256 or more, then count x (data length + 6 + N) must not exceed 32767.</dd>
</dl>
<p>Additionally CICS may issue an abend if the EXEC CICS SEND STRFIELD command is unsuccessful.</p>
</div>
<div class="section" id="call-virsetv-cics">
<span id="index-386"></span><h5>CALL VIRSETV (CICS)<a class="headerlink" href="#call-virsetv-cics" title="Permalink to this headline">¶</a></h5>
<p>This module allows a CICS application program to set the value of a VIRTEL variable. The calling program supplies the
name of the variable and the value to be set. The VIRSETV module builds an FAE6 structured field containing the
variable name and value, and sends the structured field to VIRTEL using the EXEC CICS SEND STRFIELD command.</p>
<p>VIRTEL variables containing more than one value are known as table variables. The application program can create a
table variable by calling the VIRSETV module several times with the same variable name. The first call creates the
variable and adds the first value to it. Subsequent calls add additional values to the table variable.</p>
</div>
<div class="section" id="call-virsetv-parameters">
<span id="index-387"></span><h5>CALL VIRSETV parameters<a class="headerlink" href="#call-virsetv-parameters" title="Permalink to this headline">¶</a></h5>
<p>Parameters passed by calling program:</p>
<ol class="arabic simple">
<li>DFHEIBLK</li>
<li>DFHCOMMAREA</li>
<li>Variable name (variable length EBCDIC string of 1-255 characters terminated by blank or X‘00’)</li>
<li>Value (variable length)</li>
<li>Length (signed halfword field containing length of value)</li>
</ol>
</div>
<div class="section" id="call-virsetv-example">
<span id="index-388"></span><h5>CALL VIRSETV example<a class="headerlink" href="#call-virsetv-example" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ow">in</span> <span class="n">Working</span><span class="o">-</span><span class="n">Storage</span><span class="p">:</span>
<span class="mi">77</span> <span class="n">WS</span><span class="o">-</span><span class="n">BUFFER</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span> <span class="n">VALUE</span> <span class="s1">&#39;** MY VALUE **&#39;</span><span class="o">.</span>
<span class="mi">77</span> <span class="n">WS</span><span class="o">-</span><span class="n">LENGTH</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">SYNC</span><span class="o">.</span>
<span class="ow">in</span> <span class="n">the</span> <span class="n">Procedure</span> <span class="n">Division</span><span class="p">:</span>
<span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">WS</span><span class="o">-</span><span class="n">BUFFER</span> <span class="n">TO</span> <span class="n">WS</span><span class="o">-</span><span class="n">LENGTH</span><span class="o">.</span>
<span class="n">CALL</span> <span class="s1">&#39;VIRSETV&#39;</span> <span class="n">USING</span> <span class="n">DFHEIBLK</span>
<span class="n">DFHCOMMAREA</span>
<span class="n">BY</span> <span class="n">CONTENT</span> <span class="s1">&#39;MYVAR &#39;</span>
<span class="n">BY</span> <span class="n">REFERENCE</span> <span class="n">WS</span><span class="o">-</span><span class="n">BUFFER</span>
<span class="n">WS</span><span class="o">-</span><span class="n">LENGTH</span><span class="o">.</span>
</pre></div>
</div>
<p><em>Example of VIRTEL Web Integration application using CALL VIRSETV</em></p>
</div>
<div class="section" id="call-virsetv-return-codes">
<span id="index-389"></span><h5>CALL VIRSETV return codes<a class="headerlink" href="#call-virsetv-return-codes" title="Permalink to this headline">¶</a></h5>
<p>If the call was successful, VIRSETV returns to the calling program. Otherwise, VIRSETV terminates with an EXEC CICS ABEND.
The following abend codes may be issued by VIRSETV:</p>
<dl class="docutils">
<dt>VSV1</dt>
<dd>Length of variable name is outside the range 1-255, or the required terminator (blank or X‘00’) is missing</dd>
<dt>VSV2</dt>
<dd>Length of value is negative or exceeds the maximum allowed length (32760 minus the length of the variable name).</dd>
</dl>
<p>Additionally CICS may issue an abend if the EXEC CICS SEND STRFIELD command is unsuccessful.</p>
</div>
<div class="section" id="call-virsetai-ims">
<span id="index-390"></span><h5>CALL VIRSETAI (IMS)<a class="headerlink" href="#call-virsetai-ims" title="Permalink to this headline">¶</a></h5>
<p>This module allows an IMS application program to copy an array of values into a VIRTEL table variable. The calling
program supplies the name of the variable and an array containing the values. The VIRSETAI module builds one or
more FAE6 structured fields containing the variable name and the values, and sends the structured field(s) to VIRTEL
using the CALL ‘CBLTDLI’ USING ISRT, LS-IOPCB, OUTPUT-MESSAGE, MFS command.</p>
<p>The total size of the structured fields sent by a single call to VIRSETAI cannot exceed 32K, but additional data can be
added to the VIRTEL table variable by calling VIRSETAI again with the same variable name.</p>
<p>When VIRSETAI is used to copy values into a VIRTEL table variable, all of the values must have the same length. To
create a VIRTEL table variable containing values of varying lengths, use CALL VIRSETVI described in the next section.</p>
</div>
<div class="section" id="call-virsetai-parameters">
<span id="index-391"></span><h5>CALL VIRSETAI parameters<a class="headerlink" href="#call-virsetai-parameters" title="Permalink to this headline">¶</a></h5>
<p>Parameters passed by calling program:</p>
<ol class="arabic simple">
<li>Variable name (variable length EBCDIC string of 1-255 characters terminated by blank or X‘00’)</li>
<li>An array of elements each containing one data item</li>
<li>Element size (signed halfword) contains the length of each element of the array</li>
<li>Count (signed halfword) contains the number of elements in the array</li>
<li>Data length (signed halfword) contains the length of the data item contained in each element of the array. This may be less than or equal to the element size.</li>
<li>IMS I/O PCB</li>
</ol>
</div>
<div class="section" id="call-virsetai-example">
<span id="index-392"></span><h5>CALL VIRSETAI example<a class="headerlink" href="#call-virsetai-example" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ow">in</span> <span class="n">Working</span><span class="o">-</span><span class="n">Storage</span><span class="p">:</span>

<span class="mi">01</span> <span class="n">WS</span><span class="o">-</span><span class="n">TABLE</span><span class="o">.</span>
<span class="mi">05</span> <span class="n">WS</span><span class="o">-</span><span class="n">ELEMENT</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span> <span class="n">OCCURS</span> <span class="mi">100</span> <span class="n">TIMES</span><span class="o">.</span>
<span class="mi">77</span> <span class="n">WS</span><span class="o">-</span><span class="n">TESTDATA</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">VALUE</span> <span class="s1">&#39;TEST DATA&#39;</span><span class="o">.</span>
<span class="mi">77</span> <span class="n">WS</span><span class="o">-</span><span class="n">ELEMSIZE</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">SYNC</span><span class="o">.</span>
<span class="mi">77</span> <span class="n">WS</span><span class="o">-</span><span class="n">COUNT</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">SYNC</span><span class="o">.</span>
<span class="mi">77</span> <span class="n">WS</span><span class="o">-</span><span class="n">DATALEN</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">SYNC</span><span class="o">.</span>
<span class="mi">77</span> <span class="n">WS</span><span class="o">-</span><span class="n">RC1</span> <span class="n">PIC</span> <span class="n">X</span><span class="o">.</span>

<span class="ow">in</span> <span class="n">Procedure</span> <span class="n">Division</span><span class="p">:</span>

<span class="n">MOVE</span> <span class="n">WS</span><span class="o">-</span><span class="n">TESTDATA</span> <span class="n">TO</span> <span class="n">WS</span><span class="o">-</span><span class="n">ELEMENT</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span>
<span class="n">MOVE</span> <span class="n">WS</span><span class="o">-</span><span class="n">TESTDATA</span> <span class="n">TO</span> <span class="n">WS</span><span class="o">-</span><span class="n">ELEMENT</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span>
<span class="n">MOVE</span> <span class="n">WS</span><span class="o">-</span><span class="n">TESTDATA</span> <span class="n">TO</span> <span class="n">WS</span><span class="o">-</span><span class="n">ELEMENT</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span>
<span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">WS</span><span class="o">-</span><span class="n">ELEMENT</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">TO</span> <span class="n">WS</span><span class="o">-</span><span class="n">ELEMSIZE</span><span class="o">.</span>
<span class="n">MOVE</span> <span class="mi">3</span> <span class="n">TO</span> <span class="n">WS</span><span class="o">-</span><span class="n">COUNT</span><span class="o">.</span>
<span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">WS</span><span class="o">-</span><span class="n">TESTDATA</span> <span class="n">TO</span> <span class="n">WS</span><span class="o">-</span><span class="n">DATALEN</span><span class="o">.</span>
<span class="n">CALL</span> <span class="s1">&#39;VIRSETAI&#39;</span> <span class="n">USING</span> <span class="n">CONTENT</span> <span class="s1">&#39;MYVAR &#39;</span>
<span class="n">REFERENCE</span> <span class="n">WS</span><span class="o">-</span><span class="n">TABLE</span>
<span class="n">WS</span><span class="o">-</span><span class="n">ELEMSIZE</span>
<span class="n">WS</span><span class="o">-</span><span class="n">COUNT</span>
<span class="n">WS</span><span class="o">-</span><span class="n">DATALEN</span>
<span class="n">LS</span><span class="o">-</span><span class="n">IOPCB</span>
<span class="n">RETURNING</span> <span class="n">WS</span><span class="o">-</span><span class="n">RC1</span><span class="o">.</span>
<span class="n">IF</span> <span class="n">WS</span><span class="o">-</span><span class="n">RC1</span> <span class="n">NOT</span> <span class="n">EQUAL</span> <span class="mi">0</span> <span class="n">GO</span> <span class="n">TO</span> <span class="n">ERROR</span><span class="o">.</span>
</pre></div>
</div>
<p><em>Example of VIRTEL Web Integration application using CALL VIRSETAI</em></p>
</div>
<div class="section" id="call-virsetvi-ims">
<span id="index-393"></span><h5>CALL VIRSETVI (IMS)<a class="headerlink" href="#call-virsetvi-ims" title="Permalink to this headline">¶</a></h5>
<p>This module allows an IMS application program to set the value of a VIRTEL variable. The calling program supplies the
name of the variable and the value to be set. The VIRSETVI module builds an FAE6 structured field containing the
variable name and value, and sends the structured field to VIRTEL using the CALL ‘CBLTDLI’ USING ISRT, LS-IOPCB,
OUTPUT-MESSAGE, MFS command.
VIRTEL variables containing more than one value are known as table variables. The application program can create a
table variable by calling the VIRSETVI module several times with the same variable name. The first call creates the
variable and adds the first value to it. Subsequent calls add additional values to the table variable.</p>
</div>
<div class="section" id="call-virsetvi-parameters">
<h5>CALL VIRSETVI parameters<a class="headerlink" href="#call-virsetvi-parameters" title="Permalink to this headline">¶</a></h5>
<p>Parameters passed by calling program:</p>
<ol class="arabic simple">
<li>Variable name (variable length EBCDIC string of 1-255 characters terminated by blank or X‘00’)</li>
<li>Value (variable length)</li>
<li>Length (signed halfword field containing length of value)</li>
<li>IMS I/O PCB</li>
</ol>
</div>
<div class="section" id="call-virsetvi-example">
<h5>CALL VIRSETVI example<a class="headerlink" href="#call-virsetvi-example" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ow">in</span> <span class="n">Working</span><span class="o">-</span><span class="n">Storage</span><span class="p">:</span>

    <span class="mi">77</span> <span class="n">WS</span><span class="o">-</span><span class="n">BUFFER</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span> <span class="n">VALUE</span> <span class="s1">&#39;** MY VALUE **&#39;</span><span class="o">.</span>
    <span class="mi">77</span> <span class="n">WS</span><span class="o">-</span><span class="n">LENGTH</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">SYNC</span><span class="o">.</span>
    <span class="mi">77</span> <span class="n">WS</span><span class="o">-</span><span class="n">RC1</span> <span class="n">PIC</span> <span class="n">X</span><span class="o">.</span>

<span class="ow">in</span> <span class="n">Procedure</span> <span class="n">Division</span><span class="p">:</span>
    <span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">WS</span><span class="o">-</span><span class="n">BUFFER</span> <span class="n">TO</span> <span class="n">WS</span><span class="o">-</span><span class="n">LENGTH</span><span class="o">.</span>
    <span class="n">CALL</span> <span class="s1">&#39;VIRSETVI&#39;</span> <span class="n">USING</span> <span class="n">CONTENT</span> <span class="s1">&#39;MYVAR &#39;</span>
                    <span class="n">REFERENCE</span> <span class="n">WS</span><span class="o">-</span><span class="n">BUFFER</span>
                    <span class="n">WS</span><span class="o">-</span><span class="n">LENGTH</span>
                    <span class="n">LS</span><span class="o">-</span><span class="n">IOPCB</span>
        <span class="n">RETURNING</span> <span class="n">WS</span><span class="o">-</span><span class="n">RC1</span><span class="o">.</span>
<span class="n">IF</span> <span class="n">WS</span><span class="o">-</span><span class="n">RC1</span> <span class="n">NOT</span> <span class="n">EQUAL</span> <span class="mi">0</span> <span class="n">GO</span> <span class="n">TO</span> <span class="n">ERROR</span><span class="o">.</span>
</pre></div>
</div>
<p><em>Example of VIRTEL Web Integration application using CALL VIRSETVI</em></p>
</div>
<div class="section" id="call-virtel-cics">
<span id="index-394"></span><h5>CALL VIRTEL (CICS)<a class="headerlink" href="#call-virtel-cics" title="Permalink to this headline">¶</a></h5>
<p>Application programs running in a CICS environment with LE can also call a module named VIRTEL (see source
delivered in the VIRTEL SAMPLIB library at installation time) which builds and sends the structured fields necessary to
invoke the following functions:
- specify page template and directory (structured field FAC8)
- send data for table variables (structured field FAE6)</p>
</div>
<div class="section" id="call-virtel-example">
<span id="index-395"></span><h5>CALL VIRTEL example<a class="headerlink" href="#call-virtel-example" title="Permalink to this headline">¶</a></h5>
<p>The following COBOL example shows how to use CALL VIRTEL to send two table variables (CHP_NUM1 and
CPT_NUM1) and to request the use of a specific page template (page WEB2VIRT in directory DEMO):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ow">in</span> <span class="n">Working</span><span class="o">-</span><span class="n">Storage</span><span class="p">:</span>

<span class="o">*</span> <span class="n">CALL</span> <span class="s1">&#39;VIRTEL&#39;</span> <span class="n">takes</span> <span class="n">one</span> <span class="n">parameter</span> <span class="k">with</span> <span class="n">maximum</span> <span class="n">size</span> <span class="mi">2048</span> <span class="nb">bytes</span>
<span class="mi">01</span> <span class="n">PARAMETRES</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">FAC8</span><span class="o">.</span>
    <span class="mi">02</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FONCTION</span><span class="o">-</span><span class="n">FAC8</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">VALUE</span> <span class="s1">&#39;SENDPAGW&#39;</span><span class="o">.</span>
    <span class="mi">02</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">CODE</span><span class="o">-</span><span class="n">RETOUR</span><span class="o">-</span><span class="n">FAC8</span> <span class="n">PIC</span> <span class="mi">9</span><span class="p">(</span><span class="mi">02</span><span class="p">)</span> <span class="n">VALUE</span> <span class="mf">0.</span>
    <span class="mi">02</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">PAGE</span><span class="o">-</span><span class="n">HTML</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">VALUE</span> <span class="s1">&#39;WEB2VIRT&#39;</span><span class="o">.</span>
    <span class="mi">02</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">REPERTOIRE</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">VALUE</span> <span class="s1">&#39;DEMO &#39;</span><span class="o">.</span>
    <span class="mi">02</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FILLER</span><span class="o">-</span><span class="n">FAC8</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2016</span><span class="p">)</span><span class="o">.</span>
<span class="mi">01</span> <span class="n">PARAMETRES</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">FAE6</span><span class="o">.</span>
    <span class="mi">02</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FONCTION</span><span class="o">-</span><span class="n">FAE6</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">VALUE</span> <span class="s1">&#39;SENDTABW&#39;</span><span class="o">.</span>
    <span class="mi">02</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">CODE</span><span class="o">-</span><span class="n">RETOUR</span><span class="o">-</span><span class="n">FAE6</span> <span class="n">PIC</span> <span class="mi">9</span><span class="p">(</span><span class="mi">02</span><span class="p">)</span> <span class="n">VALUE</span> <span class="mf">0.</span>
    <span class="mi">02</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">LONG</span><span class="o">-</span><span class="n">NOM</span> <span class="n">PIC</span> <span class="mi">9</span><span class="p">(</span><span class="mi">02</span><span class="p">)</span><span class="o">.</span>
    <span class="mi">02</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">LONG</span><span class="o">-</span><span class="n">POSTE</span> <span class="n">PIC</span> <span class="mi">9</span><span class="p">(</span><span class="mi">02</span><span class="p">)</span><span class="o">.</span>
    <span class="mi">02</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">NBR</span><span class="o">-</span><span class="n">POSTE</span> <span class="n">PIC</span> <span class="mi">9</span><span class="p">(</span><span class="mi">03</span><span class="p">)</span><span class="o">.</span>
    <span class="mi">02</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FAE6</span><span class="o">-</span><span class="n">DATA</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">NOM</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">08</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">01</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">02</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">03</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">04</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">05</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">06</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">07</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">08</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">09</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FILLER</span><span class="o">-</span><span class="n">FAE6</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">1937</span><span class="p">)</span><span class="o">.</span>
    <span class="mi">02</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FAE6</span><span class="o">-</span><span class="n">DATA1</span> <span class="n">REDEFINES</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FAE6</span><span class="o">-</span><span class="n">DATA</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">NOM1</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">08</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mi">01</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mi">02</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mi">03</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mi">04</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mi">05</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mi">06</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mi">07</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mi">08</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mi">09</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span>
        <span class="mi">05</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FILLER1</span><span class="o">-</span><span class="n">FAE6</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">913</span><span class="p">)</span><span class="o">.</span>

<span class="ow">in</span> <span class="n">the</span> <span class="n">Procedure</span> <span class="n">Division</span><span class="p">:</span>

    <span class="n">MOVE</span> <span class="s1">&#39;SENDPAGW&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FONCTION</span><span class="o">-</span><span class="n">FAC8</span>
    <span class="n">MOVE</span> <span class="mi">0</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">CODE</span><span class="o">-</span><span class="n">RETOUR</span><span class="o">-</span><span class="n">FAC8</span>
    <span class="n">MOVE</span> <span class="s1">&#39;WEB2VIRT&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">PAGE</span><span class="o">-</span><span class="n">HTML</span>
    <span class="n">MOVE</span> <span class="s1">&#39;DEMO &#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">REPERTOIRE</span>
    <span class="n">MOVE</span> <span class="n">SPACES</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FILLER</span><span class="o">-</span><span class="n">FAC8</span>
    <span class="n">CALL</span> <span class="s1">&#39;VIRTEL&#39;</span> <span class="n">USING</span> <span class="n">DFHEIBLK</span>
                        <span class="n">PARAMETRES</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">FAC8</span>
    <span class="n">MOVE</span> <span class="s1">&#39;SENDTABW&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FONCTION</span><span class="o">-</span><span class="n">FAE6</span>
    <span class="n">MOVE</span> <span class="mi">0</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">CODE</span><span class="o">-</span><span class="n">RETOUR</span><span class="o">-</span><span class="n">FAE6</span>
    <span class="n">MOVE</span> <span class="mi">08</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">LONG</span><span class="o">-</span><span class="n">POSTE</span><span class="o">.</span>
    <span class="n">MOVE</span> <span class="mi">9</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">NBR</span><span class="o">-</span><span class="n">POSTE</span><span class="o">.</span>
    <span class="n">MOVE</span> <span class="mi">08</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">LONG</span><span class="o">-</span><span class="n">NOM</span><span class="o">.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;CHP_NUM1&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">NOM</span><span class="o">.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;VAL-001&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mi">01</span>
    <span class="n">MOVE</span> <span class="s1">&#39;VAL-002&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mf">02.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;VAL-003&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mf">03.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;VAL-004&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mf">04.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;VAL-005&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mf">05.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;VAL-006&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mf">06.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;VAL-007&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mf">07.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;VAL-008&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mf">08.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;VAL-009&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE</span><span class="o">-</span><span class="mf">09.</span>
    <span class="n">MOVE</span> <span class="n">SPACES</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FILLER</span><span class="o">-</span><span class="n">FAE6</span>
    <span class="n">CALL</span> <span class="s1">&#39;VIRTEL&#39;</span> <span class="n">USING</span> <span class="n">DFHEIBLK</span>
                        <span class="n">PARAMETRES</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">FAE6</span>
    <span class="n">MOVE</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">CODE</span><span class="o">-</span><span class="n">RETOUR</span><span class="o">-</span><span class="n">FAE6</span> <span class="n">TO</span> <span class="n">TD</span><span class="o">-</span><span class="n">MSG</span><span class="o">-</span><span class="n">RETCODE</span>
    <span class="n">MOVE</span> <span class="s1">&#39;SENDTABW&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FONCTION</span><span class="o">-</span><span class="n">FAE6</span>
    <span class="n">MOVE</span> <span class="mi">0</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">CODE</span><span class="o">-</span><span class="n">RETOUR</span><span class="o">-</span><span class="n">FAE6</span>
    <span class="n">MOVE</span> <span class="mi">08</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">LONG</span><span class="o">-</span><span class="n">POSTE</span><span class="o">.</span>
    <span class="n">MOVE</span> <span class="mi">9</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">NBR</span><span class="o">-</span><span class="n">POSTE</span><span class="o">.</span>
    <span class="n">MOVE</span> <span class="mi">08</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">LONG</span><span class="o">-</span><span class="n">NOM</span><span class="o">.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;CPT_NUM1&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">NOM1</span><span class="o">.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;CPT-0001&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mf">01.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;CPT-0002&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mf">02.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;CPT-0003&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mf">03.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;CPT-0004&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mf">04.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;CPT-0005&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mf">05.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;CPT-0006&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mf">06.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;CPT-0007&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mf">07.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;CPT-0008&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mf">08.</span>
    <span class="n">MOVE</span> <span class="s1">&#39;CPT-0009&#39;</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">POSTE1</span><span class="o">-</span><span class="mf">09.</span>
    <span class="n">MOVE</span> <span class="n">SPACES</span> <span class="n">TO</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">FILLER1</span><span class="o">-</span><span class="n">FAE6</span>
    <span class="n">CALL</span> <span class="s1">&#39;VIRTEL&#39;</span> <span class="n">USING</span> <span class="n">DFHEIBLK</span>
                        <span class="n">PARAMETRES</span><span class="o">-</span><span class="n">VIRTEL</span><span class="o">-</span><span class="n">FAE6</span>
<span class="n">MOVE</span> <span class="n">VIRTEL</span><span class="o">-</span><span class="n">CODE</span><span class="o">-</span><span class="n">RETOUR</span><span class="o">-</span><span class="n">FAE6</span> <span class="n">TO</span> <span class="n">TD</span><span class="o">-</span><span class="n">MSG</span><span class="o">-</span><span class="n">RETCODE</span>
</pre></div>
</div>
<p><em>Example of VIRTEL Web Integration application using CALL VIRTEL</em></p>
</div>
<div class="section" id="call-virtel-return-codes">
<span id="index-396"></span><h5>CALL VIRTEL return codes<a class="headerlink" href="#call-virtel-return-codes" title="Permalink to this headline">¶</a></h5>
<p>Return codes for the SENDPAGW function</p>
<blockquote>
<div><p>The VIRTEL-CODE-RETOUR field should be initialized to 0. The following values may be returned:</p>
<dl class="docutils">
<dt>0</dt>
<dd>OK, VIRTEL request accepted (does not guarantee that page has been displayed in browser)</dd>
<dt>1</dt>
<dd>Invalid function</dd>
<dt>2</dt>
<dd>HTML page name invalid (blank or low-value)</dd>
<dt>3</dt>
<dd>Directory name invalid (blank or low-value)</dd>
</dl>
</div></blockquote>
<p>Return codes for the SENDTABW function</p>
<blockquote>
<div><p>The VIRTEL-CODE-RETOUR field should be initialized to 0. The following values may be returned:</p>
<dl class="docutils">
<dt>0</dt>
<dd>OK, VIRTEL request accepted (does not guarantee that page has been displayed in browser)</dd>
<dt>1</dt>
<dd>Invalid function</dd>
<dt>11</dt>
<dd>Length of NAME non-numeric</dd>
<dt>12</dt>
<dd>Length of VALUE non-numeric</dd>
<dt>13</dt>
<dd>Number of values is non-numeric</dd>
</dl>
</div></blockquote>
<span class="target" id="ug-host4web"></span></div>
</div>
<div class="section" id="host4web-commands">
<span id="index-397"></span><h4>HOST4WEB commands<a class="headerlink" href="#host4web-commands" title="Permalink to this headline">¶</a></h4>
<p>When an application is invoked from a browser via an entry point defined with emulation type HOST4WEB, the
application can use a set of VIRTEL control commands known as “HOST4WEB” commands, which are coded in the 3270
screen.2</p>
<div class="section" id="processing-conditions">
<span id="index-398"></span><h5>Processing conditions<a class="headerlink" href="#processing-conditions" title="Permalink to this headline">¶</a></h5>
<p>HOST4WEB commands are recognized by VIRTEL when the entry point definition specifies emulation type HTML, HOST4WEB, or H4W, and any of the following conditions is true:</p>
<ul class="simple">
<li>the VIRTEL transaction definition contains value 1 in the “H4W Commands” field</li>
<li>the VIRTEL transaction definition contains value 2 in the “H4W Commands” field and the message has a ‘2VIRTEL’ prefix (see below)</li>
<li>the VIRTEL transaction definition contains value 4 in the “H4W Commands” field and the entry point definition specifies emulation type HOST4WEB or H4W</li>
<li>the VIRTEL transaction definition contains value 4 in the “H4W Commands” field and the entry point definition specifies emulation type HTML and the message has a ‘2VIRTEL’ prefix (see below)</li>
<li>the previous screen contained the HOST4WEB command C SCAN NEXT SCREEN</li>
<li>the application previously sent an FAD5 code 01 structured field</li>
</ul>
<p>All HOST4WEB commands must begin immediately after a 3270 attrbute byte, in other words each command must appear at the start of a 3270 field. The non-display attribute may be used, if desired, to prevent the command appearing on the screen. To define a non-display field in BMS, specify ATTRB=(ASKIP,DRK). To define a non-display field in ISPF, use an attribute character defined as INTENS(NON) in the )ATTR section of the panel.</p>
<p>ISPF applications must use the ISPEXEC CONTROL DISPLAY REFRESH command before the ISPEXEC DISPLAY PANEL
command to ensure that HOST4WEB commands are transmitted to VIRTEL in their entirety.</p>
</div>
<div class="section" id="virtel-prefix">
<span id="index-399"></span><h5>2VIRTEL prefix<a class="headerlink" href="#virtel-prefix" title="Permalink to this headline">¶</a></h5>
<p>An application can send a 3270 message with a special prefix to indicate to VIRTEL that the screen contains HOST4WEB commands. The prefix consists of a 3270 field starting with the characters ‘2VIRTEL’. This field must be the first field transmitted in the message. The field can be defined with the “non-display” attribute, if desired, to prevent the prefix appearing on the screen.</p>
</div>
<div class="section" id="list-of-commands">
<span id="index-400"></span><h5>List of commands<a class="headerlink" href="#list-of-commands" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="c-auto-variables-command-auto-variables">
<span id="index-401"></span><h5>C AUTO VARIABLES (Command Auto Variables)<a class="headerlink" href="#c-auto-variables-command-auto-variables" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="n">AUTO</span> <span class="n">VARIABLES</span>
</pre></div>
</div>
<p>Requests VIRTEL to automatically free all variables whenever a user response is sent to the application. This command
cancels the effect of the KEEP VARIABLES command.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Structured field FAD5 code 08 produces the same effect as this command.</p>
</div>
</div>
<div class="section" id="c-keep-variables-command-keep-variables">
<span id="index-402"></span><h5>C KEEP VARIABLES (Command Keep Variables)<a class="headerlink" href="#c-keep-variables-command-keep-variables" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt>::</dt>
<dd>C KEEP VARIABLES</dd>
</dl>
<p>Requests VIRTEL to keep all variables created by the application. Normally VIRTEL will free all variables whenever a
user response is sent to the application. This command allows the variables to be kept for use by a subsequent output
screen. The variables may be freed by a subsequent KILL VARIABLES command, otherwise they will be automatically
freed at the end of the transaction.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Structured field FAD5 code 02 produces the same effect as this command.</p>
</div>
</div>
<div class="section" id="c-kill-variables-command-kill-variables">
<span id="index-403"></span><h5>C KILL VARIABLES (Command Kill Variables)<a class="headerlink" href="#c-kill-variables-command-kill-variables" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="n">KILL</span> <span class="n">VARIABLES</span>
</pre></div>
</div>
<p>Requests VIRTEL to free all variables.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Structured field FAD5 code 04 produces the same effect as this command.</p>
</div>
</div>
<div class="section" id="c-return-command-return">
<span id="index-404"></span><h5>C RETURN (Command Return)<a class="headerlink" href="#c-return-command-return" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="n">RETURN</span>
</pre></div>
</div>
<p>Requests VIRTEL to immediately return a response to the application with a simulated “Enter”. The screen containing
this command is never displayed to the user.</p>
</div>
<div class="section" id="c-scan-next-screen-command-scan">
<span id="index-405"></span><h5>C SCAN NEXT SCREEN (Command Scan)<a class="headerlink" href="#c-scan-next-screen-command-scan" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="n">SCAN</span> <span class="n">NEXT</span> <span class="n">SCREEN</span>
</pre></div>
</div>
<p>Indicates that the following screen will contain HOST4WEB commands, which will be processed by VIRTEL without the
need for a ‘2VIRTEL’ prefix.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Structured field FAD5 code 01 produces the same effect as this command.</p>
</div>
</div>
<div class="section" id="c-wait-next-screen-command-wait">
<span id="index-406"></span><h5>C WAIT NEXT SCREEN (Command Wait)<a class="headerlink" href="#c-wait-next-screen-command-wait" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="n">WAIT</span> <span class="n">NEXT</span> <span class="n">SCREEN</span>
</pre></div>
</div>
<p>Indicates that the current screen should not be sent to the user yet.</p>
</div>
<div class="section" id="c-termsess-command-terminate-session">
<span id="index-407"></span><h5>C TERMSESS (Command Terminate Session)<a class="headerlink" href="#c-termsess-command-terminate-session" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="n">TERMSESS</span>
</pre></div>
</div>
<p>Allows a service transaction to request termination of the host application session after the current message has been
sent.</p>
</div>
<div class="section" id="g-emulation-type-get-emulation-type">
<span id="index-408"></span><h5>G EMULATION TYPE (Get Emulation Type)<a class="headerlink" href="#g-emulation-type-get-emulation-type" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="n">EMULATION</span> <span class="n">TYPE</span>
</pre></div>
</div>
<p>When VIRTEL returns the next input to the application, the contents of this field are replaced by the emulation type
defined in the entry point.</p>
</div>
<div class="section" id="g-page-name-get-current-template-name">
<span id="index-409"></span><h5>G PAGE NAME (Get Current Template Name)<a class="headerlink" href="#g-page-name-get-current-template-name" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="n">PAGE</span> <span class="n">NAME</span>
</pre></div>
</div>
<p>When VIRTEL returns the next input to the application, the contents of this field are replaced by the name of the
current page template.</p>
</div>
<div class="section" id="g-url-parameter-get-url-parameter">
<span id="index-410"></span><h5>G URL PARAMETER (Get URL Parameter)<a class="headerlink" href="#g-url-parameter-get-url-parameter" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="n">URL</span> <span class="n">PARAMETER</span> <span class="n">paramname</span>
</pre></div>
</div>
<p>When VIRTEL returns the next input to the application, the contents of this field are replaced by the value of the
parameter paramname in the URL.</p>
</div>
<div class="section" id="s-directory-set-temporary-directory-name">
<span id="index-411"></span><h5>S DIRECTORY (Set Temporary Directory Name)<a class="headerlink" href="#s-directory-set-temporary-directory-name" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="n">DIRECTORY</span> <span class="n">dirname</span>
</pre></div>
</div>
<p>Indicates the name of the directory from which VIRTEL is to retrieve the page template for the current 3270 screen
(but not for subsequent screens). dirname is the name of a VIRTEL directory defined in the Directory Management
sub-application (as described 23). This name must not contain any blanks.</p>
</div>
<div class="section" id="s-global-page-set-global-template-name">
<span id="index-412"></span><h5>S GLOBAL PAGE (Set Global Template Name)<a class="headerlink" href="#s-global-page-set-global-template-name" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="n">GLOBAL</span> <span class="n">PAGE</span> <span class="n">pagename</span>
</pre></div>
</div>
<p>Indicates the name of the page template to be used for the current 3270 screen and all subsequent screens. This name
must not contain any blanks.</p>
</div>
<div class="section" id="s-page-set-temporary-template-name">
<span id="index-413"></span><h5>S PAGE (Set Temporary Template Name)<a class="headerlink" href="#s-page-set-temporary-template-name" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="n">PAGE</span> <span class="n">pagename</span>
</pre></div>
</div>
<p>Indicates the name of the page template to be used for the current 3270 screen (but not for subsequent screens). This
name must not contain any blanks.</p>
<span class="target" id="ug-set-variable"></span></div>
<div class="section" id="s-variable-set-variable">
<span id="index-414"></span><h5>S VARIABLE (Set Variable)<a class="headerlink" href="#s-variable-set-variable" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="n">VARIABLE</span> <span class="n">varname</span><span class="o">+</span><span class="n">value</span><span class="o">+</span>
</pre></div>
</div>
<p>Adds a new value to a table variable named varname. The variable is automatically created if necessary. The value is
contained in the 3270 field immediately following the S VARIABLE varname command, and the value has the same
length as the 3270 field which contains it. The “+” characters in the figure above represent the 3270 attribute bytes
which act as field delimiters.</p>
</div>
</div>
</div>
</div>
<div class="section" id="incoming-calls">
<span id="index-415"></span><h2>Incoming Calls<a class="headerlink" href="#incoming-calls" title="Permalink to this headline">¶</a></h2>
<div class="section" id="index-416">
<span id="id8"></span><h3>Incoming E-mails<a class="headerlink" href="#index-416" title="Permalink to this headline">¶</a></h3>
<span class="target" id="ug-email-retrieve-data"></span><div class="section" id="fac8-retrieve-data-from-an-e-mail">
<span id="index-417"></span><h4>FAC8: Retrieve data from an e-mail<a class="headerlink" href="#fac8-retrieve-data-from-an-e-mail" title="Permalink to this headline">¶</a></h4>
<p>An application started by an incoming e-mail (see <a class="reference internal" href="#ug-email-incoming"><span class="std std-ref">“Incomming e-mails”</span></a>) can retrieve data from the content
of the e-mail. To request VIRTEL to extract the data from the e-mail, the application sends a structured field FAC8 code
12 or 13 to the associated relay (3270 pseudo-terminal). VIRTEL intercepts the structured field and sends a response to
the application in the form of a QUERY REPLY (x‘88’) structured field.</p>
<div class="section" id="fac8-structured-field-code-13">
<span id="index-418"></span><h5>FAC8 - Structured field code 13<a class="headerlink" href="#fac8-structured-field-code-13" title="Permalink to this headline">¶</a></h5>
<p>The format of a structured field FAC8 code 12 is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">structured</span> <span class="n">field</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;0007&#39;</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Structured</span> <span class="n">field</span> <span class="n">identification</span> <span class="n">code</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;FAC8&#39;</span>
<span class="o">-</span> <span class="mi">1</span> <span class="nb">bytes</span> <span class="n">Code</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;12&#39;</span> <span class="p">(</span><span class="n">extraction</span> <span class="n">of</span> <span class="n">e</span><span class="o">-</span><span class="n">mail</span> <span class="n">data</span><span class="p">)</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Option</span> <span class="n">indicating</span> <span class="n">the</span> <span class="n">category</span> <span class="n">of</span> <span class="n">data</span> <span class="n">requested</span><span class="p">:</span>
<span class="mi">0004</span> <span class="n">Received</span><span class="p">:</span>
<span class="mi">0008</span> <span class="n">Message</span><span class="o">-</span><span class="n">ID</span><span class="p">:</span>
<span class="mi">000</span><span class="n">C</span> <span class="n">Date</span><span class="p">:</span>
<span class="mi">0010</span> <span class="n">References</span><span class="p">:</span>
<span class="mi">0014</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span>
<span class="mi">0018</span> <span class="n">MIME</span><span class="o">-</span><span class="n">Version</span><span class="p">:</span>
<span class="mi">001</span><span class="n">C</span> <span class="n">Subject</span><span class="p">:</span>
<span class="mi">0020</span> <span class="p">(</span><span class="n">message</span> <span class="n">text</span><span class="p">)</span>
<span class="mi">003</span><span class="n">C</span> <span class="n">MAIL</span> <span class="n">FROM</span><span class="p">:</span> <span class="p">(</span><span class="n">see</span> <span class="n">note</span><span class="p">)</span>
<span class="mi">0040</span> <span class="n">RCPT</span> <span class="n">TO</span><span class="p">:</span> <span class="p">(</span><span class="n">see</span> <span class="n">note</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Format of structured field FAC8 code 12</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">MAIL FROM and RCPT TO are respectively the name of the sender and recipient as specified in the SMTP envelope.</p>
</div>
<p>The response consists of one or more structured fields, prefixed by an AID byte x‘88’ (QUERY REPLY). The format of the
query reply structured field is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>- 2 bytes Length of structured field = variable
- 2 bytes Type of response data.
Values are same as the ‘option’ field of the corresponding request.
- 4 bytes (type 0020 only) number of lines of text
- 4 bytes (type 0020 only) flags (reserved)
- n bytes Data (in EBCDIC)
</pre></div>
</div>
<p><em>Format of the response to structured field FAC8 code 12</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Response types other than 0020 do not contain the number of lines or flags.</li>
<li>Response types are returned in the same order as specified in the request.</li>
<li>All of the response types requested are present, even if they are zero length.</li>
<li>Lines of message text are delimited by X‘0D25’ (EBCDIC carriage-return / line-feed).</li>
</ul>
</div>
</div>
<div class="section" id="index-419">
<span id="id9"></span><h5>FAC8 - Structured field code 13<a class="headerlink" href="#index-419" title="Permalink to this headline">¶</a></h5>
<p>Structured field FAC8 code 13 searches the e-mail for a specific character string, then returns the string together with
the remainder of the line.</p>
<p>The format of a structured field FAC8 code 13 is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">structured</span> <span class="n">field</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">+</span> <span class="n">length</span> <span class="n">of</span> <span class="n">string</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Structured</span> <span class="n">field</span> <span class="n">identification</span> <span class="n">code</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;FAC8&#39;</span>
<span class="o">-</span> <span class="mi">1</span> <span class="nb">bytes</span> <span class="n">Code</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;13&#39;</span> <span class="p">(</span><span class="n">scan</span> <span class="n">e</span><span class="o">-</span><span class="n">mail</span> <span class="n">data</span><span class="p">)</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Option</span> <span class="n">indicating</span> <span class="n">the</span> <span class="n">category</span> <span class="n">of</span> <span class="n">data</span> <span class="n">to</span> <span class="n">be</span> <span class="n">searched</span><span class="p">:</span>
<span class="p">(</span><span class="n">see</span> <span class="n">structured</span> <span class="n">field</span> <span class="n">FAC8</span> <span class="n">code</span> <span class="mi">12</span><span class="p">)</span>
<span class="o">-</span> <span class="n">n</span> <span class="nb">bytes</span> <span class="n">Character</span> <span class="n">string</span> <span class="n">to</span> <span class="n">search</span> <span class="k">for</span>
</pre></div>
</div>
<p><em>Format of structured field FAC8 code 13</em></p>
<p>The response consists of one or more structured fields, prefixed by an AID byte x‘88’ (QUERY REPLY). The format of the
query reply structured field is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>- 2 bytes Length of structured field = variable
- 2 bytes Type of response data.
Values are same as the ‘option’ field of the corresponding request.
- n bytes Data (in EBCDIC)
</pre></div>
</div>
<p><em>Format of the response to structured field FAC8 code 13</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>The data returned includes the character string searched for, and all characters which follow, up to the end of the line. The characters X‘0D25’, indicating the end of line, are not included in the response.</li>
<li>Response types are returned in the same order as specified in the request.</li>
<li>All of the response types requested are present, even if they are zero length.</li>
<li>Structured fields FAC8 code 12 and code 13 can be combined in the same request / response.</li>
</ul>
</div>
</div>
<div class="section" id="cobol-fac8-example">
<span id="index-420"></span><h5>COBOL FAC8 example<a class="headerlink" href="#cobol-fac8-example" title="Permalink to this headline">¶</a></h5>
<p>Example (in Cobol format) of receiving an e-mail:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ow">in</span> <span class="n">Working</span><span class="o">-</span><span class="n">Storage</span><span class="p">:</span>

<span class="o">*</span> <span class="n">Request</span> <span class="n">FAC812</span> <span class="n">to</span> <span class="n">VIRTEL</span>
<span class="mi">01</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">DEM</span><span class="o">-</span><span class="n">LENG</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
<span class="mi">01</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">DEM</span><span class="o">-</span><span class="n">EMAIL</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FILLER</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">7.</span>
    <span class="mi">05</span> <span class="n">FILLER</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;FAC812&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">DEM</span><span class="o">-</span><span class="n">OPTION</span><span class="o">-</span><span class="n">SUBJ</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;001C&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FILLER</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">7.</span>
    <span class="mi">05</span> <span class="n">FILLER</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;FAC812&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">DEM</span><span class="o">-</span><span class="n">OPTION</span><span class="o">-</span><span class="n">TEXT</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;0020&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FILLER</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">17.</span>
    <span class="mi">05</span> <span class="n">FILLER</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;FAC813&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC813</span><span class="o">-</span><span class="n">DEM</span><span class="o">-</span><span class="n">OPTION</span><span class="o">-</span><span class="n">OREF</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;0020&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FILLER</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="n">VALUE</span> <span class="s1">&#39;Order ref:&#39;</span><span class="o">.</span>
<span class="o">*</span> <span class="n">Response</span> <span class="kn">from</span> <span class="nn">Virtel</span> <span class="n">following</span> <span class="n">FAC812</span>
<span class="mi">01</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">LENG</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
<span class="mi">01</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">AREA</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">SUBJ</span><span class="o">-</span><span class="n">LENG</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">SUBJ</span><span class="o">-</span><span class="n">CODE</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">SUBJ</span><span class="o">-</span><span class="n">DATA</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">SUBJ</span><span class="o">-</span><span class="n">CHAR</span> <span class="n">PIC</span> <span class="n">X</span>
                                <span class="n">OCCURS</span> <span class="mi">0</span> <span class="n">TO</span> <span class="mi">256</span> <span class="n">TIMES</span>
                                <span class="n">DEPENDING</span> <span class="n">ON</span> <span class="n">SUBJ</span><span class="o">-</span><span class="n">LENG</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">TEXT</span><span class="o">-</span><span class="n">LENG</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">TEXT</span><span class="o">-</span><span class="n">CODE</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">TEXT</span><span class="o">-</span><span class="n">NLIG</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="n">COMP</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">TEXT</span><span class="o">-</span><span class="n">FLAG</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">TEXT</span><span class="o">-</span><span class="n">DATA</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">TEXT</span><span class="o">-</span><span class="n">CHAR</span> <span class="n">PIC</span> <span class="n">X</span>
                                <span class="n">OCCURS</span> <span class="mi">0</span> <span class="n">TO</span> <span class="mi">1000</span> <span class="n">TIMES</span>
                                <span class="n">DEPENDING</span> <span class="n">ON</span> <span class="n">TEXT</span><span class="o">-</span><span class="n">LENG</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC813</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">OREF</span><span class="o">-</span><span class="n">LENG</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC813</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">OREF</span><span class="o">-</span><span class="n">CODE</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAC813</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">OREF</span><span class="o">-</span><span class="n">DATA</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAC813</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">OREF</span><span class="o">-</span><span class="n">CHAR</span> <span class="n">PIC</span> <span class="n">X</span>
                                <span class="n">OCCURS</span> <span class="mi">0</span> <span class="n">TO</span> <span class="mi">256</span> <span class="n">TIMES</span>
                                <span class="n">DEPENDING</span> <span class="n">ON</span> <span class="n">OREF</span><span class="o">-</span><span class="n">LENG</span><span class="o">.</span>
<span class="mi">01</span> <span class="n">SUBJ</span><span class="o">-</span><span class="n">LENG</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
<span class="mi">01</span> <span class="n">SUBJ</span><span class="o">-</span><span class="n">MESSAGE</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FILLER</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="n">VALUE</span> <span class="s1">&#39;SUBJ:&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">SUBJ</span><span class="o">-</span><span class="n">DATA</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span>
<span class="mi">01</span> <span class="n">TEXT</span><span class="o">-</span><span class="n">LENG</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
<span class="mi">01</span> <span class="n">TEXT</span><span class="o">-</span><span class="n">MESSAGE</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FILLER</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="n">VALUE</span> <span class="s1">&#39;TEXT:&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">TEXT</span><span class="o">-</span><span class="n">DATA</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span><span class="o">.</span>
<span class="mi">01</span> <span class="n">OREF</span><span class="o">-</span><span class="n">LENG</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
<span class="mi">01</span> <span class="n">OREF</span><span class="o">-</span><span class="n">MESSAGE</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FILLER</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="n">VALUE</span> <span class="s1">&#39;OREF:&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">OREF</span><span class="o">-</span><span class="n">DATA</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span>
<span class="mi">01</span> <span class="n">ERR</span><span class="o">-</span><span class="n">MESSAGE</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span> <span class="n">VALUE</span>
    <span class="s1">&#39;RBC8 UNEXPECTED RESPONSE FROM VIRTEL&#39;</span><span class="o">.</span>

<span class="ow">in</span> <span class="n">the</span> <span class="n">Procedure</span> <span class="n">Division</span><span class="p">:</span>

<span class="n">MOVE</span> <span class="o">+</span><span class="mi">256</span> <span class="n">TO</span> <span class="n">SUBJ</span><span class="o">-</span><span class="n">LENG</span>
<span class="n">MOVE</span> <span class="o">+</span><span class="mi">1000</span> <span class="n">TO</span> <span class="n">TEXT</span><span class="o">-</span><span class="n">LENG</span>
<span class="n">MOVE</span> <span class="o">+</span><span class="mi">256</span> <span class="n">TO</span> <span class="n">OREF</span><span class="o">-</span><span class="n">LENG</span>
<span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">DEM</span><span class="o">-</span><span class="n">EMAIL</span> <span class="n">TO</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">DEM</span><span class="o">-</span><span class="n">LENG</span>
<span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">AREA</span> <span class="n">TO</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">LENG</span>
<span class="n">EXEC</span> <span class="n">CICS</span> <span class="n">CONVERSE</span>  <span class="n">FROM</span><span class="p">(</span><span class="n">FAC812</span><span class="o">-</span><span class="n">DEM</span><span class="o">-</span><span class="n">EMAIL</span><span class="p">)</span>
                    <span class="n">FROMLENGTH</span><span class="p">(</span><span class="n">FAC812</span><span class="o">-</span><span class="n">DEM</span><span class="o">-</span><span class="n">LENG</span><span class="p">)</span>
                    <span class="n">INTO</span><span class="p">(</span><span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">AREA</span><span class="p">)</span>
                    <span class="n">TOLENGTH</span><span class="p">(</span><span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">LENG</span><span class="p">)</span>
                    <span class="n">STRFIELD</span>
<span class="n">END</span><span class="o">-</span><span class="n">EXEC</span>
<span class="n">IF</span> <span class="n">EIBAID</span> <span class="n">EQUAL</span> <span class="n">X</span><span class="s1">&#39;88&#39;</span>
    <span class="n">SUBTRACT</span> <span class="mi">4</span> <span class="n">FROM</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">SUBJ</span><span class="o">-</span><span class="n">LENG</span> <span class="n">GIVING</span> <span class="n">SUBJ</span><span class="o">-</span><span class="n">LENG</span>
    <span class="n">MOVE</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">SUBJ</span><span class="o">-</span><span class="n">DATA</span> <span class="n">TO</span> <span class="n">SUBJ</span><span class="o">-</span><span class="n">DATA</span>
    <span class="n">EXEC</span> <span class="n">CICS</span> <span class="n">WRITEQ</span> <span class="n">TD</span> <span class="n">QUEUE</span><span class="p">(</span><span class="s1">&#39;CSMT&#39;</span><span class="p">)</span>
                    <span class="n">FROM</span><span class="p">(</span><span class="n">SUBJ</span><span class="o">-</span><span class="n">MESSAGE</span><span class="p">)</span>
    <span class="n">END</span><span class="o">-</span><span class="n">EXEC</span>
    <span class="n">SUBTRACT</span> <span class="mi">12</span> <span class="n">FROM</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">TEXT</span><span class="o">-</span><span class="n">LENG</span>
        <span class="n">GIVING</span> <span class="n">TEXT</span><span class="o">-</span><span class="n">LENG</span>
    <span class="n">MOVE</span> <span class="n">FAC812</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">TEXT</span><span class="o">-</span><span class="n">DATA</span> <span class="n">TO</span> <span class="n">TEXT</span><span class="o">-</span><span class="n">DATA</span>
    <span class="n">EXEC</span> <span class="n">CICS</span> <span class="n">WRITEQ</span> <span class="n">TD</span> <span class="n">QUEUE</span><span class="p">(</span><span class="s1">&#39;CSMT&#39;</span><span class="p">)</span>
                    <span class="n">FROM</span><span class="p">(</span><span class="n">TEXT</span><span class="o">-</span><span class="n">MESSAGE</span><span class="p">)</span>
    <span class="n">END</span><span class="o">-</span><span class="n">EXEC</span>
    <span class="n">SUBTRACT</span> <span class="mi">4</span> <span class="n">FROM</span> <span class="n">FAC813</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">OREF</span><span class="o">-</span><span class="n">LENG</span> <span class="n">GIVING</span> <span class="n">OREF</span><span class="o">-</span><span class="n">LENG</span>
    <span class="n">MOVE</span> <span class="n">FAC813</span><span class="o">-</span><span class="n">REP</span><span class="o">-</span><span class="n">OREF</span><span class="o">-</span><span class="n">DATA</span> <span class="n">TO</span> <span class="n">OREF</span><span class="o">-</span><span class="n">DATA</span>
    <span class="n">EXEC</span> <span class="n">CICS</span> <span class="n">WRITEQ</span> <span class="n">TD</span> <span class="n">QUEUE</span><span class="p">(</span><span class="s1">&#39;CSMT&#39;</span><span class="p">)</span>
                <span class="n">FROM</span><span class="p">(</span><span class="n">OREF</span><span class="o">-</span><span class="n">MESSAGE</span><span class="p">)</span>
    <span class="n">END</span><span class="o">-</span><span class="n">EXEC</span>
<span class="n">ELSE</span>
    <span class="n">EXEC</span> <span class="n">CICS</span> <span class="n">WRITEQ</span> <span class="n">TD</span> <span class="n">QUEUE</span><span class="p">(</span><span class="s1">&#39;CSMT&#39;</span><span class="p">)</span>
            <span class="n">FROM</span><span class="p">(</span><span class="n">ERR</span><span class="o">-</span><span class="n">MESSAGE</span><span class="p">)</span>
    <span class="n">END</span><span class="o">-</span><span class="n">EXEC</span>
<span class="n">END</span><span class="o">-</span><span class="n">IF</span>
<span class="n">EXEC</span> <span class="n">CICS</span> <span class="n">ISSUE</span> <span class="n">DISCONNECT</span>
<span class="n">END</span><span class="o">-</span><span class="n">EXEC</span><span class="o">.</span>
</pre></div>
</div>
<p><em>Example of sending structured field FAC8 code 12 and 13</em></p>
</div>
</div>
<div class="section" id="fad4-sending-an-e-mail-from-a-host-application">
<span id="index-421"></span><h4>FAD4: Sending an e-mail from a host application<a class="headerlink" href="#fad4-sending-an-e-mail-from-a-host-application" title="Permalink to this headline">¶</a></h4>
<p>It is possible at any time to send an e-mail from a host application under VIRTEL control. This operation is performed
by sending a WRITE STRUCTURED FIELD to the 3270 session which is intercepted by VIRTEL. The structured field data
consists of a sequence of FAD4 structured fields as described below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Length</span> <span class="n">of</span> <span class="n">structured</span> <span class="n">field</span> <span class="o">=</span> <span class="n">variable</span>
<span class="o">-</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="n">Structured</span> <span class="n">field</span> <span class="n">identification</span> <span class="n">code</span> <span class="o">=</span> <span class="n">X</span><span class="s1">&#39;FAD4&#39;</span>
<span class="o">-</span> <span class="n">n</span> <span class="nb">bytes</span> <span class="n">Command</span> <span class="n">code</span>
<span class="o">-</span> <span class="n">n</span> <span class="nb">bytes</span> <span class="n">Value</span> <span class="n">associated</span> <span class="k">with</span> <span class="n">command</span> <span class="n">code</span>
</pre></div>
</div>
<p><em>Format of structured field FAD4</em></p>
<p>The possible command codes are:</p>
<dl class="docutils">
<dt>N</dt>
<dd>(Name) e-mail address of recipient.</dd>
<dt>F</dt>
<dd>(From) e-mail address of sender. If this code is not supplied, the default sender address specified on the SMTP line will be used.</dd>
<dt>X’CD’</dt>
<dd>(Code) Message identification.</dd>
<dt>S</dt>
<dd>(Subject) Message subject line.</dd>
<dt>T</dt>
<dd>(Text) Message text. The sequence X‘0D25’ (EBCDIC carriage-return / line-feed) can be used to separate lines of text.</dd>
<dt>C</dt>
<dd>(Charset) Add a message header indicating the character set used; ISO-8859-15 for European character set with Euro currency sign.</dd>
<dt>H</dt>
<dd>(Header) Add one or more headers. The sequence X‘0D25’ (EBCDIC carriage-return / line-feed) indicates the end of each of the headers in this structured field.</dd>
</dl>
<p>The entry point used to invoke the host application must contain a type-3 transaction whose external name is $MAIL$
and whose “Application” field contains the name of the SMTP line to be used for sending the outgoing e-mail.</p>
<div class="section" id="cobol-fad4-example">
<span id="index-422"></span><h5>COBOL FAD4 example<a class="headerlink" href="#cobol-fad4-example" title="Permalink to this headline">¶</a></h5>
<p>Example (in Cobol format) of sending an e-mail :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ow">in</span> <span class="n">Working</span><span class="o">-</span><span class="n">Storage</span><span class="p">:</span>

<span class="mi">01</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">LONG</span>                <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>   <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
<span class="mi">01</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">AREA</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">N</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">N</span>  <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>   <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;FAD4&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span>       <span class="n">VALUE</span> <span class="s1">&#39;N&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">DESTINATION</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
            <span class="n">VALUE</span> <span class="s1">&#39;bowler@saint.cloud.com&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">F</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">F</span>  <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>   <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;FAD4&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span>       <span class="n">VALUE</span> <span class="s1">&#39;F&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SENDER</span>      <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
            <span class="n">VALUE</span> <span class="s1">&#39;virtel@saint.cloud.com&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">CD</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">CD</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>   <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;FAD4&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span>       <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;CD&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">MESSAGE</span><span class="o">-</span><span class="n">ID</span>  <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
                <span class="n">VALUE</span> <span class="s1">&#39;20010321174652K07F44354K608EAF00&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">S</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">S</span>  <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>   <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;FAD4&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span>       <span class="n">VALUE</span> <span class="s1">&#39;S&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SUBJECT</span>     <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
                <span class="n">VALUE</span> <span class="s1">&#39;email from virtel&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">T</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">T</span>  <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>   <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;FAD4&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span>       <span class="n">VALUE</span> <span class="s1">&#39;T&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">TEXT</span><span class="o">-</span><span class="n">LINE</span><span class="o">-</span><span class="mi">1</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>   <span class="n">VALUE</span> <span class="s1">&#39;Balance report&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;0D25&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">TEXT</span><span class="o">-</span><span class="n">LINE</span><span class="o">-</span><span class="mi">2</span> <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="s1">&#39;Total is &#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">CURRENCY</span>    <span class="n">PIC</span> <span class="n">X</span>       <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;9F&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">AMOUNT</span>      <span class="n">PIC</span> <span class="mi">9999</span>    <span class="n">VALUE</span> <span class="mf">2345.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;0D25&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">H</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">H</span>  <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>   <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;FAD4&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span>       <span class="n">VALUE</span> <span class="s1">&#39;H&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">HEADER</span><span class="o">-</span><span class="mi">1</span>    <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span>
                <span class="n">VALUE</span> <span class="s1">&#39;X-Transaction-Server: CICS-TS 2.2&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;0D25&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">HEADER</span><span class="o">-</span><span class="mi">2</span>    <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span>
                <span class="n">VALUE</span> <span class="s1">&#39;X-Operating-System: z/OS 1.4&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;0D25&#39;</span><span class="o">.</span>
    <span class="mi">05</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">C</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">C</span> <span class="n">PIC</span> <span class="n">S9</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>    <span class="n">COMP</span> <span class="n">VALUE</span> <span class="o">+</span><span class="mf">0.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>    <span class="n">VALUE</span> <span class="n">X</span><span class="s1">&#39;FAD4&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FILLER</span>           <span class="n">PIC</span> <span class="n">X</span>       <span class="n">VALUE</span> <span class="s1">&#39;C&#39;</span><span class="o">.</span>
        <span class="mi">10</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">CHARSET</span>     <span class="n">PIC</span> <span class="n">X</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span>   <span class="n">VALUE</span> <span class="s1">&#39;ISO-8859-15&#39;</span><span class="o">.</span>

<span class="ow">in</span> <span class="n">the</span> <span class="n">Procedure</span> <span class="n">Division</span><span class="p">:</span>

    <span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">N</span> <span class="n">TO</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">N</span>
    <span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">F</span> <span class="n">TO</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">F</span>
    <span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">CD</span> <span class="n">TO</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">CD</span>
    <span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">S</span> <span class="n">TO</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">S</span>
    <span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">T</span> <span class="n">TO</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">T</span>
    <span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">H</span> <span class="n">TO</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">H</span>
    <span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">COMMANDE</span><span class="o">-</span><span class="n">C</span> <span class="n">TO</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">SFLENGTH</span><span class="o">-</span><span class="n">C</span>
    <span class="n">MOVE</span> <span class="n">LENGTH</span> <span class="n">OF</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">AREA</span> <span class="n">TO</span> <span class="n">FAD4</span><span class="o">-</span><span class="n">LONG</span>
    <span class="n">EXEC</span> <span class="n">CICS</span> <span class="n">SEND</span>  <span class="n">FROM</span><span class="p">(</span><span class="n">FAD4</span><span class="o">-</span><span class="n">AREA</span><span class="p">)</span>
                    <span class="n">LENGTH</span><span class="p">(</span><span class="n">FAD4</span><span class="o">-</span><span class="n">LONG</span><span class="p">)</span>
                    <span class="n">STRFIELD</span>
    <span class="n">END</span><span class="o">-</span><span class="n">EXEC</span><span class="o">.</span>
</pre></div>
</div>
<p><em>Example of sending structured field FAD4</em></p>
<p>Example of the e-mail generated by the above program:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Date: Fri, 30 Apr 2004 15:14:05 +0100
From: virtel@saint.cloud.com
Organization: SYSPERTEC COMMUNICATION
To: bowler@saint.cloud.com
Message-id: &lt;20010321174652K07F44354K608EAF00-bowler@saint.cloud.com&gt;
Content-Type: text/plain; charset=ISO-8859-15
Content-Transfer-Encoding: 8bit
X-Transaction-Server: CICS-TS 2.2
X-Operating-System: z/OS 1.4
Subject: email from virtel

Balance report
Total is €2345
</pre></div>
</div>
<p><em>Example of e-mail generated by structured field FAD4</em></p>
</div>
</div>
</div>
</div>
<div class="section" id="ug-security">
<span id="index-423"></span><span id="id10"></span><h2>Security<a class="headerlink" href="#ug-security" title="Permalink to this headline">¶</a></h2>
<div class="section" id="virtel-web-access-security">
<span id="index-424"></span><h3>VIRTEL Web Access Security<a class="headerlink" href="#virtel-web-access-security" title="Permalink to this headline">¶</a></h3>
<p>VIRTEL examines the URL of every VIRTEL Web Access request which arrives from a browser. Since there is no
permanent IP session between the browser and VIRTEL, there is less risk of a session being “hijacked”. In addition to
standard network security features (firewall, network sign on, SSO, etc.), each URL sent to VIRTEL has a structure which
allows VIRTEL to enforce authorization rules based on Entry Point, Rules, and Transactions, which are VIRTEL entities
described in the “VIRTEL Connectivity Reference” manual.</p>
<div class="section" id="specifying-security-in-the-entry-point">
<span id="index-425"></span><h4>Specifying security in the entry point<a class="headerlink" href="#specifying-security-in-the-entry-point" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL supplies a signon program for HTTP lines called VIR0020H (refer to the “VIRTEL Connectivity Reference” manual
for more details about how to specify a signon program in an entry point).</p>
<p>When the first call is made to a secure transaction under an entry point which specifies VIR0020H as its signon
program, VIRTEL requests the browser (via a 401 response) to display a dialog box inviting the user to enter a userid
and password. VIRTEL passes the userid and password to the security manager (RACF, etc.) for validation. VIRTEL can
also propagate the userid and password to other applications (for example, CICS) by means of connection /
disconnection scripts defined in the transaction (see the “VIRTEL Connectivity Reference” manual for details).
Depending on the userid, the security manager may authorize or deny access to the requested transaction.</p>
<p><img alt="image65" src="../../../_images/image656.png" /></p>
<p><em>Example of signon dialog box displayed by browser</em></p>
</div>
<div class="section" id="specifying-security-in-the-transaction">
<span id="index-426"></span><h4>Specifying security in the transaction<a class="headerlink" href="#specifying-security-in-the-transaction" title="Permalink to this headline">¶</a></h4>
<p>To display the signon dialog box shown above, the transaction under the entry point must specify SECURITY 1
(standard). Refer to the “Transactions” section of the “VIRTEL Connectivity Reference” manual for details of the
security field in the VIRTEL transaction definition.</p>
<p>Security can be specified either on the application transaction (transaction type 1, 2, 3), or on the directory transaction
(transaction type 4). In the above example, “SECURE” is the directory transaction, and “Cics” is the application
transaction. Specifying security at the directory level can be useful in that it forces the user to sign on even when
displaying a static page which has no associated application transaction.</p>
</div>
<div class="section" id="mixed-case-password-support">
<span id="index-427"></span><h4>Mixed-case password support<a class="headerlink" href="#mixed-case-password-support" title="Permalink to this headline">¶</a></h4>
<p>If SECUR=RACROUTE or SECUR=(RACROUTE,RACF) is specified in the VIRTCT, and if the security manager reports that it
supports lower-case characters in passwords, then VIRTEL will pass all passwords to the security manager in mixed
case as entered by the user. Otherwise VIRTEL will translate all passwords to upper case before passing them to the
security manager. Message VIR0861I at integration indicates that VIRTEL will use mixed-case passwords.</p>
</div>
<div class="section" id="automatic-retrieval-of-username">
<span id="index-428"></span><h4>Automatic retrieval of username<a class="headerlink" href="#automatic-retrieval-of-username" title="Permalink to this headline">¶</a></h4>
<p>NTLM security allows VIRTEL to retrieve the username under which the user has already signed on to Windows. This
allows VIRTEL Web Access to sign on the user without requiring him or her to enter a username and password.</p>
<p>When SECURITY 2 (NTLM) is specified in the VIRTEL transaction definition (either the application transaction or the
directory transaction) VIRTEL requests the browser to supply the Windows username.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When the user is identified by NTLM, VIRTEL does not have access to the user’s password, and therefore VIRTEL
cannot verify the validity of the username, and cannot propagate the signon to other applications such as CICS.</p>
</div>
<p>Before NTML can be used with the Firefox browser, the server name must be configured into the browser. Type
<a class="reference external" href="about:config">about:config</a> in the address bar, and enter the VIRTEL Web Access server address (for example, 192.168.235.61:41000)
as the value of the network.automatic-ntlm-auth.trusted-uris parameter.</p>
<span class="target" id="ug-data-encryption-ssl"></span></div>
<div class="section" id="data-encryption-by-at-tls-ssl">
<span id="index-429"></span><h4>Data encryption by AT-TLS/SSL<a class="headerlink" href="#data-encryption-by-at-tls-ssl" title="Permalink to this headline">¶</a></h4>
<p>The AT-TLS feature (“Application Transparent Transport Layer Security”), available with z/OS Communication Server
V1R7 and later releases, allows direct access to the VIRTEL Web Access server in SSL mode (HTTPS), without using an
intermediate server. The SSLSETUP job in the VIRTEL SAMPLIB contains an example of the definitions required to place
VIRTEL Web Access sessions under AT-TLS control.</p>
<p>For VSE sites, or earlier versions of MVS where AT-TLS is not available, access to VIRTEL in HTTPS mode can be achieved
by means of an intermediate server (such as Apache) operating in Reverse-Proxy mode. The function of the reverse
proxy is to transform the dataflow into HTTP mode before sending it on to VIRTEL.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Higher CPU usgage will result in the TCP/IP address space if this feature is used without the services of a hardware Crypto Card.</p>
</div>
</div>
<div class="section" id="index-430">
<span id="identification-by-certificate"></span><h4>Identification by certificate<a class="headerlink" href="#index-430" title="Permalink to this headline">¶</a></h4>
<p>The definition of a transaction with SECURITY 3 (TLS) allows VIRTEL to recognize a VIRTEL Web Access user by means of
a digital certificate installed in the user’s web browser. VIRTEL will use the RACF userid associated with the certificate
to determine the user’s authority to execute the transaction.</p>
<p>VIRTEL is able to obtain the client’s userid, without requiring the user to sign on, when all of the following conditions
are true:
- The user enters VIRTEL via a secure https session using the AT-TLS function of z/OS V1R7 or later
- The TTLSConnectionAction or TTLSEnvironmentAction statement in the policy agent configuration file contains the parameter HandshakeRole ServerWithClientAuth
- The client’s browser presents a valid certificate during SSL handshake
- The z/OS Security Server (RACF) recognizes the certificate as belonging to the user (Refer to “Chapter 21 RACF and Digital Certificates” in “SA22-7683-05 z/OS Security Server RACF Security Administrator’s Guide” for more information on associating user IDs with certificates)</p>
<p>The sample job SSLUCERT in the VIRTEL SAMPLIB illustrates how to generate a user client certificate using RACF. The
certificate is registered in the RACF database and is exported to a PKCS12 (.P12) file which contains both the user
certificate and the user’s private key encrypted under a passphrase. The .P12 file must be downloaded in binary to the
user’s workstation and installed in the user’s browser.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When a user is identified by certificate, VIRTEL does not have access to the user’s password, and therefore cannot propagate the signon to other applications such as CICS.</p>
</div>
<span class="target" id="ug-password-encryption"></span></div>
<div class="section" id="password-encryption">
<span id="index-431"></span><h4>Password encryption<a class="headerlink" href="#password-encryption" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL Web Access offers the possibility of encrypting passwords (3270 non-display fields) transmitted in HTML pages.
VIRTEL uses the encryption facilities provided by the System z hardware through the z/OS Integrated Cryptographic
Service Facility (ICSF). Password encryption is available only when using VIRTEL Web Access in Ajax mode using the
WEB2AJAX.htm page template (see <a class="reference internal" href="#ug-presentation-modes"><span class="std std-ref">“Presentation modes”</span></a>).</p>
<p>To activate the password encryption option for WEB2AJAX.htm you must specify a CRYPTn parameter in the VIRTCT
(see “Parameters of the VIRTCT” in the VIRTEL Installation Guide). The CRYPTn parameter must specify CRYPT3270 as
the name and ICSF as the encryption engine, as in example shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CRYPT1</span><span class="o">=</span><span class="p">(</span><span class="n">CRYPT3270</span><span class="p">,</span><span class="mi">3</span><span class="n">TDEA</span><span class="p">,</span><span class="n">RSA</span><span class="o">-</span><span class="mi">1024</span><span class="p">,</span><span class="n">ICSF</span><span class="p">,</span><span class="n">HEX</span><span class="p">),</span> <span class="o">*</span>
</pre></div>
</div>
<p><em>CRYPTn parameter for password encryption using WEB2AJAX.htm</em></p>
<span class="target" id="ug-signon-using-html"></span></div>
<div class="section" id="signon-using-html-fields">
<span id="index-432"></span><h4>Signon using HTML fields<a class="headerlink" href="#signon-using-html-fields" title="Permalink to this headline">¶</a></h4>
<p>The definition of a transaction with SECURITY 4 (HTML) allows VIRTEL to obtain the userid and password from fields
embedded in the HTML page.</p>
<p>When a security type 4 transaction is requested, and the user is not already signed on, VIRTEL will send the requested
page to the browser without connecting to the application. The page template must use the CREATE-VARIABLE-IF tag
(described 62) to determine whether signon is required, and the DECLARE-FIELD-AS tag (described 62) to declare the
username and password fields.</p>
<p>Following an unsuccessful signon attempt, the special variable $ERRMSG$ contains one or more error messages which
may be included in the page template.</p>
<p>The figure below shows an example of a transaction with security type 4:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>TRANSACTION DETAIL DEFINITION ---------------------- Applid: SP3VIR5 11:35:36
Internal name ===&gt; HTTP-16               To associate with an entry point name
External name ===&gt; cicsHtml              Name displayed on user menu
Description   ===&gt; Access CICSD with HTML security
Application   ===&gt; SPCICSD               Application to be called
PassTicket    ===&gt; 0 Name ===&gt;           0=no 1=yes 2=unsigned
Application type ===&gt; 1                  1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE
Pseudo-terminals ===&gt; HTVT               Prefix of name of partner terminals
Logmode          ===&gt;                    Specify when LOGMODE must be changed
How started      ===&gt; 2                  1=menu 2=sub-menu 3=auto
Security         ===&gt; 4                  0=none 1=basic 2=NTLM 3=TLS 4=HTML
H4W commands ?   ===&gt;                    0=no 1=yes 2=if2VIRTEL 4=auto
Logon message    ===&gt;

TIOA at logon    ===&gt; Signon to CICS&amp;/W&amp;&#39;114BE9&#39;&amp;U&amp;&#39;114CF9&#39;&amp;P&amp;/A

TIOA at logoff   ===&gt; &amp;£6D

Initial Scenario ===&gt;                     Final Scenario  ===&gt;
Input Scenario   ===&gt;                     Output Scenario ===&gt;
P1=Update                          P3=Return                        P12=Server
</pre></div>
</div>
<p><em>HTML security: Example transaction with security type 4</em></p>
<p id="index-433">The figure below shows an example of a page template containing userid and password fields which can be used with
the security type 4 transaction as shown above.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;!--VIRTEL start=&quot;{{{&quot; end=&quot;}}}&quot; --&gt;
&lt;!doctype html public &quot;-//w3c//dtd html 4.0//en&quot;&gt;
&lt;html&gt;&lt;head&gt;{{{ SET-OUTPUT-ENCODING-UTF-8 &quot;&quot; }}}
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
{{{CREATE-VARIABLE-IF (SIGNON-IS-NEEDED) &quot;$$SIGTYPE&quot;}}}
{{{CREATE-VARIABLE-IF (APPLICATION-IS-CONNECTED) &quot;$$APP&quot;}}}
    &lt;script language=&quot;Javascript&quot; src=&quot;../w2h/js01.js&quot;
type=&quot;text/Javascript&quot;&gt;&lt;/script&gt;
    &lt;script&gt;document.write(&quot;&lt;link rel=&#39;stylesheet&#39; type=&#39;text/css&#39;
href=&#39;../w2h/STYL&quot;+w2hparm.style+&quot;.css&#39; /&gt;&quot;)&lt;/script&gt;
    {{{WHEN-EXISTS &quot;$$SIGTYPE&quot;}}}
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;../w2h/login.css&quot; /&gt;
    &lt;title&gt;{{{NAME-OF (VIRTEL)}}} signon&lt;/title&gt;
    &lt;script src=&quot;../w2h/md5.js&quot; type=&quot;text/Javascript&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
{{{DECLARE-FIELD-AS (USERNAME) &quot;USERNAME&quot;}}}
{{{DECLARE-FIELD-AS (PASSWORD,HEX) &quot;PASSWORD&quot;}}}
{{{DECLARE-FIELD-AS (NEW-PASSWORD,HEX) &quot;NEWPASSWORD&quot;}}}
{{{DEFINE-HTML-PFKEY &quot;pf&quot;}}}
&lt;script&gt;
genloginform(&quot;{{{NAME-OF (PAGE)}}}++{{{AJAX-SESSION-CODE}}}&quot;,
&quot;{{{NAME-OF (VIRTEL)}}}&quot;,&quot;{{{NAME-OF (TRANSACTION-EXTERNAL)}}}&quot;,
&quot;{{{NAME-OF (USER)}}}&quot;,&quot;{{{NAME-OF (PASSWORD)}}}&quot;,
&quot;{{{TRIMMED-VALUE-OF &quot;$ERRMSG$&quot;}}}&quot;);
&lt;/script&gt;
&lt;/body&gt;
{{{END-WHEN-EXISTS &quot;$$SIGTYPE&quot;}}}
{{{WHEN-NOT-EXISTS &quot;$$SIGTYPE&quot;}}}
&lt;body onLoad=&quot; VirtelFormload()&quot;&gt;
&lt;p&gt;Logged in as &lt;strong&gt;{{{TRIMMED-VALUE-OF &quot;$$SIG&quot;}}}&lt;/strong&gt;&lt;/p&gt;
{{{FOR-EACH-VALUE-IN &quot;$ERRMSG$&quot;}}}
&lt;p&gt;{{{CURRENT-VALUE-OF &quot;$ERRMSG$&quot;}}}&lt;/p&gt;
{{{END-FOR &quot;$ERRMSG$&quot;}}}
&lt;form name=virtelForm
    action=&quot;classics.htm++{{{ SESSION-CODE }}}&quot; method=&quot;POST&quot;&gt;
&lt;pre&gt;&lt;div id=&quot;printReady&quot;&gt;{{{ GENERATE-HTML (1,1,5000) }}}&lt;/div&gt;&lt;/pre&gt;
&lt;input type=&quot;submit&quot; name=&quot;disco&quot; value=&quot;Disconnect&quot;
    onclick=&quot;submitForm(&#39;DISCONNECT&#39;)&quot; &gt;
{{{ DEFINE-HTML-PFKEY &quot;pf&quot; }}}&lt;input name=&quot;pf&quot; type=&quot;HIDDEN&quot; value=&quot;ENTER&quot;&gt;
{{{ DEFINE-HTML-FOCUS-FIELD &quot;focusField&quot; }}}
&lt;input name=&quot;focusField&quot; type=&quot;hidden&quot; value=&quot;{{{FIELD-WITH-CURSOR}}}&quot;&gt;
&lt;/form&gt;
{{{END-WHEN-NOT-EXISTS &quot;$$SIGTYPE&quot;}}}
&lt;/body&gt;&lt;/html&gt;
</pre></div>
</div>
<p><em>HTML security: Example page template</em></p>
</div>
<div class="section" id="virtel-rules">
<span id="index-434"></span><h4>Virtel Rules<a class="headerlink" href="#virtel-rules" title="Permalink to this headline">¶</a></h4>
<p>The rules attached to an HTTP line allow security to be implemented at the entry point level. The following example shows a set of three rules which are used to filter incoming HTTP calls. The first rule, 1HT00100, assigns an entry point specifically for users known to VIRTEL and identified by means of a “cookie” included in their HTTP request. In this
case, the entry point will be chosen according to the set of rules associated with that particular user. See <em>Correspondent Management</em> in the Virtel Administration Guide. The second rule, 1HT00200, assigns the entry point EPINTERN to clients whose IP address is 192.168.n.n, and only during the period Monday to Friday during the hours 08:30 to 17:30. The
third rule, 1HT00900, assigns the entry point EPPUBLIC to all other requests (this entry point could, for example, display a page containing the message “Access not authorised”).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>LIST of RULES in RULE SET: H-HTTP ---------------- Applid: SPVIRD2 13:57:53

Name     Status   Description                                    Entry Point
1HT00100 ACTIVE   HTTP access (users authorised by cookie)       $COOKIE$
1HT00200 ACTIVE   HTTP access (internal network, working hours)  EPINTERN
1HT00900 ACTIVE   HTTP access (other users)                      EPPUBLIC











P1=Update          P2=Suppress                 P3=Return
P6=1st page        P7=Page-1                   P8=Page+1             P12=Edit
</pre></div>
</div>
<p><em>HTTP security by rule: List of rules</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DETAIL of RULE from RULE SET: S-SMTP ------------- Applid: SPVIRE2 15:46:00
Name          ===&gt; 1HT00100               Rule priority is per name
Status        ===&gt; ACTIVE                 19 May 2004 15:46:00 VIRDBA
Description   ===&gt; HTTP access (Users authorised by cookie)
Entry point   ===&gt; $COOKIE$               Target Entry Point
Parameter     ===&gt;
Trace         ===&gt;                        1=commands 2=data 3=partner

C : 0=IGNORE 1=IS 2=IS NOT 3=STARTS WITH 4=DOES NOT 5=ENDS WITH 6=DOES NOT
0 IP Subnet   ===&gt;                        Mask ===&gt;
0 Host        ===&gt;
0 eMail       ===&gt;
0 Calling DTE ===&gt;                        Calling DTE address
0 Called      ===&gt;                        Called DTE address
0 CUD0 (Hex)  ===&gt;                        First 4 bytes of CUD (X25 protocol)
0 User Data   ===&gt;

0 Days        ===&gt; M:     T:      W:      T:      F:      S:      S:
0 Start time  ===&gt; H:     M:      S:     End time ===&gt; H:      M:      S:

P1=Update                        P3=Return                        Enter=Add
P4=Activate                      P5=Inactivate                    P12=Entry P.
CREATION OK
</pre></div>
</div>
<p><em>HTTP security by rule: Users authorized by cookie</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DETAIL</span> <span class="n">of</span> <span class="n">RULE</span> <span class="kn">from</span> <span class="nn">RULE</span> <span class="n">SET</span><span class="p">:</span> <span class="n">S</span><span class="o">-</span><span class="n">SMTP</span> <span class="o">-------------</span> <span class="n">Applid</span><span class="p">:</span> <span class="n">SPVIRE2</span> <span class="mi">15</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Name</span>          <span class="o">===&gt;</span> <span class="mi">1</span><span class="n">HT00200</span>               <span class="n">Rule</span> <span class="n">priority</span> <span class="ow">is</span> <span class="n">per</span> <span class="n">name</span>
<span class="n">Status</span>        <span class="o">===&gt;</span> <span class="n">ACTIVE</span>                 <span class="mi">19</span> <span class="n">May</span> <span class="mi">2004</span> <span class="mi">15</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">00</span> <span class="n">VIRDBA</span>
<span class="n">Description</span>   <span class="o">===&gt;</span> <span class="n">HTTP</span> <span class="n">access</span> <span class="p">(</span><span class="n">Internal</span> <span class="n">network</span><span class="p">,</span> <span class="n">working</span> <span class="n">hours</span><span class="p">)</span>
<span class="n">Entry</span> <span class="n">point</span>   <span class="o">===&gt;</span> <span class="n">EPINTERN</span>               <span class="n">Target</span> <span class="n">Entry</span> <span class="n">Point</span>
<span class="n">Parameter</span>     <span class="o">===&gt;</span>
<span class="n">Trace</span>         <span class="o">===&gt;</span>                        <span class="mi">1</span><span class="o">=</span><span class="n">commands</span> <span class="mi">2</span><span class="o">=</span><span class="n">data</span> <span class="mi">3</span><span class="o">=</span><span class="n">partner</span>

<span class="n">C</span> <span class="p">:</span> <span class="mi">0</span><span class="o">=</span><span class="n">IGNORE</span> <span class="mi">1</span><span class="o">=</span><span class="n">IS</span> <span class="mi">2</span><span class="o">=</span><span class="n">IS</span> <span class="n">NOT</span> <span class="mi">3</span><span class="o">=</span><span class="n">STARTS</span> <span class="n">WITH</span> <span class="mi">4</span><span class="o">=</span><span class="n">DOES</span> <span class="n">NOT</span> <span class="mi">5</span><span class="o">=</span><span class="n">ENDS</span> <span class="n">WITH</span> <span class="mi">6</span><span class="o">=</span><span class="n">DOES</span> <span class="n">NOT</span>
<span class="mi">1</span> <span class="n">IP</span> <span class="n">Subnet</span>   <span class="o">===&gt;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">000.000</span>        <span class="n">Mask</span> <span class="o">===&gt;</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">000.000</span>
<span class="mi">0</span> <span class="n">Host</span>        <span class="o">===&gt;</span>
<span class="mi">0</span> <span class="n">eMail</span>       <span class="o">===&gt;</span>
<span class="mi">0</span> <span class="n">Calling</span> <span class="n">DTE</span> <span class="o">===&gt;</span>                        <span class="n">Calling</span> <span class="n">DTE</span> <span class="n">address</span>
<span class="mi">0</span> <span class="n">Called</span>      <span class="o">===&gt;</span>                        <span class="n">Called</span> <span class="n">DTE</span> <span class="n">address</span>
<span class="mi">0</span> <span class="n">CUD0</span> <span class="p">(</span><span class="n">Hex</span><span class="p">)</span>  <span class="o">===&gt;</span>                        <span class="n">First</span> <span class="mi">4</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">CUD</span> <span class="p">(</span><span class="n">X25</span> <span class="n">protocol</span><span class="p">)</span>
<span class="mi">0</span> <span class="n">User</span> <span class="n">Data</span>   <span class="o">===&gt;</span>

<span class="mi">1</span> <span class="n">Days</span>        <span class="o">===&gt;</span> <span class="n">M</span><span class="p">:</span> <span class="n">X</span>   <span class="n">T</span><span class="p">:</span> <span class="n">X</span>    <span class="n">W</span><span class="p">:</span> <span class="n">X</span>    <span class="n">T</span><span class="p">:</span> <span class="n">X</span>    <span class="n">F</span><span class="p">:</span> <span class="n">X</span>    <span class="n">S</span><span class="p">:</span>      <span class="n">S</span><span class="p">:</span>
<span class="mi">1</span> <span class="n">Start</span> <span class="n">time</span>  <span class="o">===&gt;</span> <span class="n">H</span><span class="p">:</span> <span class="mi">08</span>  <span class="n">M</span><span class="p">:</span> <span class="mi">30</span>   <span class="n">S</span><span class="p">:</span> <span class="mi">00</span>  <span class="n">End</span> <span class="n">time</span> <span class="o">===&gt;</span> <span class="n">H</span><span class="p">:</span> <span class="mi">17</span>   <span class="n">M</span><span class="p">:</span> <span class="mi">30</span>   <span class="n">S</span><span class="p">:</span> <span class="mi">00</span>

<span class="n">P1</span><span class="o">=</span><span class="n">Update</span>                        <span class="n">P3</span><span class="o">=</span><span class="n">Return</span>                        <span class="n">Enter</span><span class="o">=</span><span class="n">Add</span>
<span class="n">P4</span><span class="o">=</span><span class="n">Activate</span>                      <span class="n">P5</span><span class="o">=</span><span class="n">Inactivate</span>                    <span class="n">P12</span><span class="o">=</span><span class="n">Entry</span> <span class="n">P</span><span class="o">.</span>
</pre></div>
</div>
<p><em>HTTP security by rule: Internal network, working hours</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DETAIL</span> <span class="n">of</span> <span class="n">RULE</span> <span class="kn">from</span> <span class="nn">RULE</span> <span class="n">SET</span><span class="p">:</span> <span class="n">S</span><span class="o">-</span><span class="n">SMTP</span> <span class="o">-------------</span> <span class="n">Applid</span><span class="p">:</span> <span class="n">SPVIRE2</span> <span class="mi">15</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Name</span>          <span class="o">===&gt;</span> <span class="mi">1</span><span class="n">HT00900</span>               <span class="n">Rule</span> <span class="n">priority</span> <span class="ow">is</span> <span class="n">per</span> <span class="n">name</span>
<span class="n">Status</span>        <span class="o">===&gt;</span> <span class="n">ACTIVE</span>                 <span class="mi">19</span> <span class="n">May</span> <span class="mi">2004</span> <span class="mi">15</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">00</span> <span class="n">VIRDBA</span>
<span class="n">Description</span>   <span class="o">===&gt;</span> <span class="n">HTTP</span> <span class="n">access</span> <span class="p">(</span><span class="n">Other</span> <span class="n">users</span><span class="p">)</span>
<span class="n">Entry</span> <span class="n">point</span>   <span class="o">===&gt;</span> <span class="n">EPPUBLIC</span>               <span class="n">Target</span> <span class="n">Entry</span> <span class="n">Point</span>
<span class="n">Parameter</span>     <span class="o">===&gt;</span>
<span class="n">Trace</span>         <span class="o">===&gt;</span>                        <span class="mi">1</span><span class="o">=</span><span class="n">commands</span> <span class="mi">2</span><span class="o">=</span><span class="n">data</span> <span class="mi">3</span><span class="o">=</span><span class="n">partner</span>

<span class="n">C</span> <span class="p">:</span> <span class="mi">0</span><span class="o">=</span><span class="n">IGNORE</span> <span class="mi">1</span><span class="o">=</span><span class="n">IS</span> <span class="mi">2</span><span class="o">=</span><span class="n">IS</span> <span class="n">NOT</span> <span class="mi">3</span><span class="o">=</span><span class="n">STARTS</span> <span class="n">WITH</span> <span class="mi">4</span><span class="o">=</span><span class="n">DOES</span> <span class="n">NOT</span> <span class="mi">5</span><span class="o">=</span><span class="n">ENDS</span> <span class="n">WITH</span> <span class="mi">6</span><span class="o">=</span><span class="n">DOES</span> <span class="n">NOT</span>
<span class="mi">0</span> <span class="n">IP</span> <span class="n">Subnet</span>   <span class="o">===&gt;</span> <span class="mf">000.000</span><span class="o">.</span><span class="mf">000.000</span>        <span class="n">Mask</span> <span class="o">===&gt;</span> <span class="mf">000.000</span><span class="o">.</span><span class="mf">000.000</span>
<span class="mi">0</span> <span class="n">Host</span>        <span class="o">===&gt;</span>
<span class="mi">0</span> <span class="n">eMail</span>       <span class="o">===&gt;</span>
<span class="mi">0</span> <span class="n">Calling</span> <span class="n">DTE</span> <span class="o">===&gt;</span>                        <span class="n">Calling</span> <span class="n">DTE</span> <span class="n">address</span>
<span class="mi">0</span> <span class="n">Called</span>      <span class="o">===&gt;</span>                        <span class="n">Called</span> <span class="n">DTE</span> <span class="n">address</span>
<span class="mi">0</span> <span class="n">CUD0</span> <span class="p">(</span><span class="n">Hex</span><span class="p">)</span>  <span class="o">===&gt;</span>                        <span class="n">First</span> <span class="mi">4</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">CUD</span> <span class="p">(</span><span class="n">X25</span> <span class="n">protocol</span><span class="p">)</span>
<span class="mi">0</span> <span class="n">User</span> <span class="n">Data</span>   <span class="o">===&gt;</span>

<span class="mi">0</span> <span class="n">Days</span>        <span class="o">===&gt;</span> <span class="n">M</span><span class="p">:</span>     <span class="n">T</span><span class="p">:</span>      <span class="n">W</span><span class="p">:</span>      <span class="n">T</span><span class="p">:</span>      <span class="n">F</span><span class="p">:</span>      <span class="n">S</span><span class="p">:</span>      <span class="n">S</span><span class="p">:</span>
<span class="mi">0</span> <span class="n">Start</span> <span class="n">time</span>  <span class="o">===&gt;</span> <span class="n">H</span><span class="p">:</span>     <span class="n">M</span><span class="p">:</span>      <span class="n">S</span><span class="p">:</span>     <span class="n">End</span> <span class="n">time</span> <span class="o">===&gt;</span> <span class="n">H</span><span class="p">:</span>      <span class="n">M</span><span class="p">:</span>      <span class="n">S</span><span class="p">:</span>

<span class="n">P1</span><span class="o">=</span><span class="n">Update</span>                        <span class="n">P3</span><span class="o">=</span><span class="n">Return</span>                        <span class="n">Enter</span><span class="o">=</span><span class="n">Add</span>
<span class="n">P4</span><span class="o">=</span><span class="n">Activate</span>                      <span class="n">P5</span><span class="o">=</span><span class="n">Inactivate</span>                    <span class="n">P12</span><span class="o">=</span><span class="n">Entry</span> <span class="n">P</span><span class="o">.</span>
</pre></div>
</div>
<p><em>HTTP security by rule: Other users</em></p>
</div>
</div>
</div>
<div class="section" id="howtos">
<span id="index-435"></span><h2>HOWTOs<a class="headerlink" href="#howtos" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-to-use-different-screen-sizes">
<span id="index-436"></span><h3>How To Use Different Screen Sizes<a class="headerlink" href="#how-to-use-different-screen-sizes" title="Permalink to this headline">¶</a></h3>
<p>Although the standard 3270 screen size is 24 rows by 80 columns, certain applications benefit from the use of
terminals with larger screen sizes. The screen size is determined by the LOGMODE used for the session between
VIRTEL and the host application. VTAM offers logmodes for the following standard screen sizes:</p>
<ul class="simple">
<li>model 2 : 24x80 (logmode SNX32702)</li>
<li>model 3 : 32x80 (logmode SNX32703)</li>
<li>model 4 : 43x80 (logmode SNX32704)</li>
<li>model 5 : 27x132 (logmode SNX32705)</li>
</ul>
<p>There are two different ways that the VIRTEL administrator can set up the configuration to allow the VIRTEL Web
Access user to select the desired logmode:</p>
<ul class="simple">
<li>define a separate VIRTEL transaction for each screen size, and allow the user to select the appropriate transaction</li>
<li>group the VTAM relay LUs into pools, each pool having a different logmode, and allow the user to select the pool by coding an appropriate parameter on the URL</li>
</ul>
<div class="section" id="logmode-defined-by-the-transaction">
<h4>LOGMODE defined by the transaction<a class="headerlink" href="#logmode-defined-by-the-transaction" title="Permalink to this headline">¶</a></h4>
<p>With this method, the administrator defines multiple VIRTEL transactions for a single application, each transaction
specifying a different logmode. For example, transactions Tso2 and Tso5 delivered in the sample configuration both
define TSO as the target application, but specify different logmodes SNX32702 and SNX32705 respectively. The user
selects the desired transaction from the applist menu displayed by the “Other applications” link in the VIRTEL Web
Access menu.</p>
<p>The figure below shows the definition of the Tso5 transaction defined under the WEB2HOST entry point:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>TRANSACTION DETAIL DEFINITION ---------------------- Applid: VIRTEL 17:12:54
Internal name ===&gt; W2H-13M5             To associate with an entry point name
External name ===&gt; Tso5                 Name displayed on user menu
Description   ===&gt; Logon to Tso (3270 model 5)
Application   ===&gt; TSO                  Application to be called
PassTicket    ===&gt; 0 Name ===&gt;          0=no 1=yes 2=unsigned
Application type ===&gt; 1                 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE
Pseudo-terminals ===&gt; DEVT              Prefix of name of partner terminals
Logmode          ===&gt; SNX32705          Specify when LOGMODE must be changed
How started      ===&gt; 1                 1=menu 2=sub-menu 3=auto
Security         ===&gt; 0                 0=none 1=basic 2=NTLM 3=TLS 4=HTML
H4W commands ?   ===&gt;                   0=no 1=yes 2=if2VIRTEL 4=auto
Logon message    ===&gt;

TIOA at logon    ===&gt;

TIOA at logoff   ===&gt;

Initial Scenario ===&gt;                   Final Scenario  ===&gt;
Input Scenario   ===&gt;                   Output Scenario ===&gt;

P1=Update                         P3=Return                          P12=Server
</pre></div>
</div>
<p><em>Example of TSO transaction TSO specifying logmode SNX32705</em></p>
<p>The URL to access this transaction could be of the format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="p">:</span><span class="mi">41001</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">WEB3270</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">Tso5</span>
</pre></div>
</div>
</div>
<div class="section" id="assigning-a-logmode-by-url-parameter">
<h4>Assigning a LOGMODE by URL parameter<a class="headerlink" href="#assigning-a-logmode-by-url-parameter" title="Permalink to this headline">¶</a></h4>
<p>The URL which allows the browser to connect to a host application via VIRTEL may contain a parameter, such as “model5” as shown in this example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="p">:</span><span class="mi">41001</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">WEB3270</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">Tso</span><span class="o">+</span><span class="n">model5</span>
</pre></div>
</div>
<p>This form of a VIRTEL URL is described in the section <a class="reference internal" href="#ug-dynamic-url"><span class="std std-ref">“Dynamic URL with user data”</span></a>.</p>
<p>This form of URL is processed by VIRTEL with reference to the “rule set” associated with the HTTP line. VIRTEL looks for
a rule whose “User Data” field matches the value of the parameter (model5). The “Parameter” field of the selected
rule assigns a relay LU name from the pool defined with logmode SNX32705.</p>
<p>The VTAM definition of the relay pool is shown in the example below. In this example, LU names in the range
RHTVT5nn are defined to have the model5 logmode SNX32705:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>VIRTAPPL VBUILD TYPE=APPL
* ------------------------------------------------------------------ *
* RHTVTxxx : Relay for VTAM applications acceded by WEB to HOST *
* ------------------------------------------------------------------ *
* 3270 model 2 terminals
RHTVT0?? APPL AUTH=(ACQ,PASS),MODETAB=ISTINCLM,DLOGMOD=SNX32702,EAS=1
* 3270 model 5 terminals
RHTVT5?? APPL AUTH=(ACQ,PASS),MODETAB=ISTINCLM,DLOGMOD=SNX32705,EAS=1
</pre></div>
</div>
<p><em>VTAM definition of terminal groups</em></p>
<p>The screen below shows an example rule which assigns a relay LU from the range RHTVT5nn when the URL contains
the parameter model5:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DETAIL</span> <span class="n">of</span> <span class="n">RULE</span> <span class="kn">from</span> <span class="nn">RULE</span> <span class="n">SET</span><span class="p">:</span> <span class="n">S</span><span class="o">-</span><span class="n">SMTP</span> <span class="o">-------------</span> <span class="n">Applid</span><span class="p">:</span> <span class="n">SPVIRE2</span> <span class="mi">17</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">15</span>
<span class="n">Name</span>          <span class="o">===&gt;</span> <span class="n">WHT00150</span>               <span class="n">Rule</span> <span class="n">priority</span> <span class="ow">is</span> <span class="n">per</span> <span class="n">name</span>
<span class="n">Status</span>        <span class="o">===&gt;</span> <span class="n">ACTIVE</span>                 <span class="mi">19</span> <span class="n">May</span> <span class="mi">2004</span> <span class="mi">15</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mi">00</span> <span class="n">VIRDBA</span>
<span class="n">Description</span>   <span class="o">===&gt;</span> <span class="n">HTTP</span> <span class="n">access</span> <span class="p">(</span><span class="n">With</span> <span class="n">model5</span> <span class="n">URL</span> <span class="n">parameter</span><span class="p">)</span>
<span class="n">Entry</span> <span class="n">point</span>   <span class="o">===&gt;</span> <span class="n">WEB2HOST</span>               <span class="n">Target</span> <span class="n">Entry</span> <span class="n">Point</span>
<span class="n">Parameter</span>     <span class="o">===&gt;</span> <span class="n">RHTVT5</span><span class="o">*</span>                       <span class="o">&amp;</span><span class="mi">1</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">LUNAME</span>
<span class="n">Trace</span>         <span class="o">===&gt;</span>                        <span class="mi">1</span><span class="o">=</span><span class="n">commands</span> <span class="mi">2</span><span class="o">=</span><span class="n">data</span> <span class="mi">3</span><span class="o">=</span><span class="n">partner</span>

<span class="n">C</span> <span class="p">:</span> <span class="mi">0</span><span class="o">=</span><span class="n">IGNORE</span> <span class="mi">1</span><span class="o">=</span><span class="n">IS</span> <span class="mi">2</span><span class="o">=</span><span class="n">IS</span> <span class="n">NOT</span> <span class="mi">3</span><span class="o">=</span><span class="n">STARTS</span> <span class="n">WITH</span> <span class="mi">4</span><span class="o">=</span><span class="n">DOES</span> <span class="n">NOT</span> <span class="mi">5</span><span class="o">=</span><span class="n">ENDS</span> <span class="n">WITH</span> <span class="mi">6</span><span class="o">=</span><span class="n">DOES</span> <span class="n">NOT</span>
<span class="mi">0</span> <span class="n">IP</span> <span class="n">Subnet</span>   <span class="o">===&gt;</span>                        <span class="n">Mask</span> <span class="o">===&gt;</span>
<span class="mi">0</span> <span class="n">Host</span>        <span class="o">===&gt;</span>
<span class="mi">0</span> <span class="n">eMail</span>       <span class="o">===&gt;</span>
<span class="mi">0</span> <span class="n">Calling</span> <span class="n">DTE</span> <span class="o">===&gt;</span>                        <span class="n">Calling</span> <span class="n">DTE</span> <span class="n">address</span>
<span class="mi">0</span> <span class="n">Called</span>      <span class="o">===&gt;</span>                        <span class="n">Called</span> <span class="n">DTE</span> <span class="n">address</span>
<span class="mi">0</span> <span class="n">CUD0</span> <span class="p">(</span><span class="n">Hex</span><span class="p">)</span>  <span class="o">===&gt;</span>                        <span class="n">First</span> <span class="mi">4</span> <span class="nb">bytes</span> <span class="n">of</span> <span class="n">CUD</span> <span class="p">(</span><span class="n">X25</span> <span class="n">protocol</span><span class="p">)</span>
<span class="mi">0</span> <span class="n">User</span> <span class="n">Data</span>   <span class="o">===&gt;</span> <span class="n">model5</span>

<span class="mi">0</span> <span class="n">Days</span>        <span class="o">===&gt;</span> <span class="n">M</span><span class="p">:</span>     <span class="n">T</span><span class="p">:</span>      <span class="n">W</span><span class="p">:</span>      <span class="n">T</span><span class="p">:</span>      <span class="n">F</span><span class="p">:</span>      <span class="n">S</span><span class="p">:</span>      <span class="n">S</span><span class="p">:</span>
<span class="mi">0</span> <span class="n">Start</span> <span class="n">time</span>  <span class="o">===&gt;</span> <span class="n">H</span><span class="p">:</span>     <span class="n">M</span><span class="p">:</span>      <span class="n">S</span><span class="p">:</span>     <span class="n">End</span> <span class="n">time</span> <span class="o">===&gt;</span> <span class="n">H</span><span class="p">:</span>      <span class="n">M</span><span class="p">:</span>      <span class="n">S</span><span class="p">:</span>

<span class="n">P1</span><span class="o">=</span><span class="n">Update</span>                        <span class="n">P3</span><span class="o">=</span><span class="n">Return</span>                        <span class="n">Enter</span><span class="o">=</span><span class="n">Add</span>
<span class="n">P4</span><span class="o">=</span><span class="n">Activate</span>                      <span class="n">P5</span><span class="o">=</span><span class="n">Inactivate</span>                    <span class="n">P12</span><span class="o">=</span><span class="n">Entry</span> <span class="n">P</span><span class="o">.</span>
</pre></div>
</div>
<p><em>Example rule for selection of logmode by URL</em></p>
<p>The LU name (RHTVT5nn) assigned by the rule must belong to the LU pool shared assigned to the HTTP line, as shown in the example below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>TERMINAL DETAIL DEFINITION ------------------------- Applid: VIRTEL 13:32:28
Terminal          ===&gt; W2HTP500       ?wxyZZZZ for dynamic allocation
                                      w : Sna or Non-sna or * (category)
                                      x : 1, 2, 3, 4, 5 or * (model)
                                      y : Colour, Monochrome or *
                                      Z : any characters
Relay             ===&gt; RHTVT500 Name seen by VTAM applications
                                      = : copied from the terminal name
*Pool name        ===&gt; *W2HPOOL       Pool where to put this terminal
Description       ===&gt; Relay pool for HTTP (3270 model 5)

Entry Point       ===&gt;                Enforced Entry Point
2nd relay         ===&gt; RHTIM500       Possible 2nd relay (Printer)
Terminal type     ===&gt; 3              1=LU1 2=3270 3=FC P=Printer S=Scs
Compression       ===&gt; 2              0, 1, 2 or 3 : compression type
Possible Calls    ===&gt; 3              0=None 1=Inbound 2=Outbound 3=Both
Write Stats to ===&gt; 12                1,4=VIRSTAT 2=VIRLOG

Repeat ===&gt; 0020 Number of generated terminals

P1=Update                         P3=Return                         Enter=Add
                                                                    P12=Server
</pre></div>
</div>
<p><em>Definition of model 5 terminals in the W2HPOOL pool</em></p>
</div>
<div class="section" id="user-specified-logmode">
<h4>User-specified LOGMODE<a class="headerlink" href="#user-specified-logmode" title="Permalink to this headline">¶</a></h4>
<p>When the entry point definition specifies SCENLOGM in the “Identification scenario” field, the user may override the
default logmode by appending an additional parameter LOGMODE=modename to the URL, as shown in this example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://n.n.n.n:41001/w2h/WEB3270.htm+Tso?logmode=SNX32705
</pre></div>
</div>
<p>The source code for the SCENLOGM scenario is supplied in the VIRTEL SAMPLIB.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To activate this functionality, SCENLOGM must be specified in the “Identification scenario” field of the ENTRY POINT (not the transaction definition)</p>
</div>
</div>
<div class="section" id="dynamic-logmode-with-user-specified-screen-size">
<h4>Dynamic logmode with user-specified screen size<a class="headerlink" href="#dynamic-logmode-with-user-specified-screen-size" title="Permalink to this headline">¶</a></h4>
<p>VIRTEL Web Access also supports the use of “dynamic” logmodes, such as D4A32XX3, which allow the user to specify a
non-standard alternate screen size. When the entry point definition specifies SCENLOGM in the “Identification
scenario” field, the user may also append ROWS and COLS parameters to the URL, as shown in this example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://n.n.n.n:41001/w2h/WEB3270.htm+Tso?logmode=D4A32XX3&amp;rows=54&amp;cols=132
</pre></div>
</div>
<p>VIRTEL allows a maximum screen size of 62 rows by 160 columns. The host application must also support the use of
non-standard screen sizes.</p>
</div>
</div>
<div class="section" id="how-to-support-multiple-codes-pages">
<span id="index-437"></span><h3>How To Support Multiple Codes Pages<a class="headerlink" href="#how-to-support-multiple-codes-pages" title="Permalink to this headline">¶</a></h3>
<p>VIRTEL can use two methods of EBCDIC translation and this is governed by the template or web page being displayed. If the page contains the embedded VIRTEL tag {{{SET-OUTPUT-ENCODING-UTF-8}}} than the TCT DEFUTF8 parameter is used. If the page doesn’t contain the tag then the code pages identified by the COUNTRY parameter are used. (See
“COUNTRY” and “DEFUTF8” parameters in the VIRTEL Installation Guide for further details). Code Page Support can be provided at the following levels:</p>
<ul class="simple">
<li>TCT Level - This would provide Code Page translation defaults for all lines and transaction. Effectively a Global option for an instance of VIRTEL.</li>
<li>URL Level – This overrides the TCT default.</li>
<li>Transaction level - Code pages can be determined through the VIRTEL Scenario language using the SET$ ENCODING and SET$ URL-ENCODING instructions.</li>
</ul>
<div class="section" id="defining-code-pages-translation-defaults">
<h4>Defining Code Pages translation defaults<a class="headerlink" href="#defining-code-pages-translation-defaults" title="Permalink to this headline">¶</a></h4>
<p>This is done by defining a default value for “COUNTRY” and “DEFUTF8” parameters in the VIRTEL TCT (see “Parameters of the VIRTCT” in the VIRTEL Installation Guide).</p>
<div class="section" id="override-the-tct-defaults-at-url-level">
<h5>Override the TCT defaults at URL level<a class="headerlink" href="#override-the-tct-defaults-at-url-level" title="Permalink to this headline">¶</a></h5>
<p>Users who require a codepage different from the TCT definition can specify the code page as a parameter of the URL.
For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>http://n.n.n.n:41001/w2h/WEB2AJAX.htm+Tso?codepage=IBM1047
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To activate this functionality, SCENLOGM must be specified in the “Identification scenario” field of the ENTRY POINT (not the transaction definition).</p>
</div>
<p>The value of the CODEPAGE parameter may be either:</p>
<ul class="simple">
<li>one of the values listed for the DEFUTF8 parameter of the VIRTCT (see “Parameters of the VIRTCT” in the VIRTEL Installation Guide); or</li>
<li>one of the additional codepages you have specified in the CHARSET parameter in your VIRTCT at VIRTEL installation time</li>
</ul>
</div>
<div class="section" id="override-the-tct-defaults-at-business-logic-level">
<h5>Override the TCT defaults at business logic level<a class="headerlink" href="#override-the-tct-defaults-at-business-logic-level" title="Permalink to this headline">¶</a></h5>
<p>At a transaction level code pages can be determined through the VIRTEL Scenario language using the SET$ ENCODING
and SET$ URL-ENCODING instructions. These are described in the VWA Users Guide.</p>
</div>
</div>
<div class="section" id="supporting-multiple-countries">
<h4>Supporting multiple countries.<a class="headerlink" href="#supporting-multiple-countries" title="Permalink to this headline">¶</a></h4>
<p>If we take the scenario that applications can be accessible globally than VIRTEL can incorporate the country differences through one of the following methods. In most case the TCT or URL override will accommodate such a set up.</p>
<ul class="simple">
<li>For each country supported, have a different instance of VIRTEL specifying the relevant country code pages at the TCT level.</li>
<li>For each country supported, have a separate line/port and use the URL overrides.</li>
<li>For each country supported, have a common line/port and use the URL overrides.</li>
</ul>
</div>
</div>
<div class="section" id="how-to-handle-host-session-termination">
<span id="index-438"></span><h3>How To Handle Host Session Termination<a class="headerlink" href="#how-to-handle-host-session-termination" title="Permalink to this headline">¶</a></h3>
<p>When the user terminates the application session by pressing the “Disconnect” button in the browser, various options are available:
- Return to the application selection menu
- Display a specific HTML page
- Close the browser window and return to the desktop</p>
<p>Remember that it is always best to exit cleanly from the host application by pressing the “Disconnect” button, rather than closing the browser window. If the browser window is closed abruptly, the host session resources may not be freed until the expiry of the timeout period specified in the entry point definition.</p>
<div class="section" id="return-to-the-application-selection-menu">
<h4>Return to the application selection menu<a class="headerlink" href="#return-to-the-application-selection-menu" title="Permalink to this headline">¶</a></h4>
<p>When a “Disconnect” request is received, VIRTEL returns to the root URL and displays the default page for the line, which will normally be an application selection menu. For detailed information, see <a class="reference internal" href="#ug-url-formats"><span class="std std-ref">“Virtel URL formats”</span></a>. The user can then choose to connect to the same or a different application by clicking on the appropriate link in the
application selection menu.</p>
</div>
<div class="section" id="displaying-a-specific-page-on-disconnection">
<h4>Displaying a specific page on disconnection<a class="headerlink" href="#displaying-a-specific-page-on-disconnection" title="Permalink to this headline">¶</a></h4>
<p>Those sites wishing to display a specific page at the end of a session may use the “Last page” field in the definition of the entry point associated with the HTTP line or the entry point selected by the rules of the line. The “Last page” field indicates the name of the page to be displayed following disconnection from the host application. The indicated file must be uploaded to the same directory as specified in the URL for the host application (for example W2H-DIR if the URL specifies /w2h/WEB3270.htm).</p>
<p>The “Last page” may contain instructions to the user and may include system information provided by VIRTEL (such as the application and terminal name, date and time, etc.)</p>
</div>
<div class="section" id="closing-the-browser-window-automatically">
<h4>Closing the browser window automatically<a class="headerlink" href="#closing-the-browser-window-automatically" title="Permalink to this headline">¶</a></h4>
<p>Sites who wish to close the browser window and return to the desktop when the user disconnects from the host application may specify close.htm in the “Last page” field of the entry point definition. This page contains JavaScript code which will attempt to close the current browser window. Depending on the browser version and security settings, the window may close, a prompt may be issued, or the window may remain open. The close.htm page is delivered as standard in the W2H-DIR directory but may be copied to another directory if required.</p>
<p>The figure below shows an example of an entry point definition with close.htm specified as the “Last page”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ENTRY</span> <span class="n">POINT</span> <span class="n">DETAIL</span> <span class="n">DEFINITION</span> <span class="o">----------------------</span> <span class="n">Applid</span><span class="p">:</span> <span class="n">SPVIRE2</span> <span class="mi">15</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">26</span>
       <span class="n">Name</span>          <span class="o">===&gt;</span> <span class="n">WEB2HOST</span>            <span class="n">Name</span> <span class="n">this</span> <span class="n">ENTRY</span> <span class="n">POINT</span> <span class="p">(</span><span class="n">LOGON</span> <span class="n">DATA</span><span class="p">)</span>
       <span class="n">Description</span>   <span class="o">===&gt;</span> <span class="n">HTTP</span> <span class="n">entry</span> <span class="n">point</span> <span class="p">(</span><span class="n">SysperTec</span> <span class="n">menu</span><span class="p">)</span>
       <span class="n">Transactions</span>  <span class="o">===&gt;</span> <span class="n">W2H</span>                 <span class="n">Prefix</span> <span class="k">for</span> <span class="n">associated</span> <span class="n">transactions</span>
       <span class="n">Last</span> <span class="n">page</span> <span class="o">===&gt;</span> <span class="n">CLOSE</span><span class="o">.</span><span class="n">HTM</span>               <span class="n">Displayed</span> <span class="n">at</span> <span class="n">end</span> <span class="n">of</span> <span class="n">session</span>
       <span class="n">Transparency</span>  <span class="o">===&gt;</span>                     <span class="n">Server</span> <span class="n">types</span> <span class="n">NOT</span> <span class="n">to</span> <span class="n">emulate</span>
       <span class="n">Time</span> <span class="n">out</span>      <span class="o">===&gt;</span> <span class="mi">0005</span>   <span class="n">minutes</span>      <span class="n">Maximum</span> <span class="n">inactive</span> <span class="n">time</span>
       <span class="n">Do</span> <span class="k">if</span> <span class="n">timeout</span> <span class="o">===&gt;</span> <span class="mi">0</span>                   <span class="mi">0</span><span class="o">=</span><span class="n">logoff</span> <span class="mi">1</span><span class="o">=</span><span class="n">bip</span><span class="o">+</span><span class="n">logoff</span> <span class="mi">2</span><span class="o">=</span><span class="n">anti</span> <span class="n">pad</span>
       <span class="n">Emulation</span>     <span class="o">===&gt;</span> <span class="n">HTML</span>                <span class="n">Type</span> <span class="n">of</span> <span class="n">terminal</span><span class="p">:</span>
       <span class="n">HOST4WEB</span>    <span class="p">:</span> <span class="n">program</span> <span class="n">driven</span>           <span class="n">HTML</span>  <span class="p">:</span> <span class="n">Web</span> <span class="n">Browser</span>
       <span class="n">SCENARIO</span>    <span class="p">:</span> <span class="n">script</span> <span class="n">driven</span>            <span class="n">EMAIL</span> <span class="p">:</span> <span class="n">SMTP</span> <span class="n">client</span>
       <span class="n">MINITEL</span>     <span class="p">:</span> <span class="mi">40</span> <span class="ow">or</span> <span class="mi">80</span> <span class="n">columns</span>         <span class="n">X25</span>   <span class="p">:</span> <span class="n">uses</span> <span class="n">low</span> <span class="n">level</span> <span class="n">dialog</span>
       <span class="n">Signon</span> <span class="n">program</span>           <span class="o">===&gt;</span> <span class="n">VIR0020H</span> <span class="n">Controls</span> <span class="n">user</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">password</span>
       <span class="n">Menu</span> <span class="n">program</span>             <span class="o">===&gt;</span> <span class="n">VIR0021A</span> <span class="n">List</span> <span class="n">of</span> <span class="n">transactions</span>
       <span class="n">Identification</span> <span class="n">scenario</span>  <span class="o">===&gt;</span>          <span class="n">eg</span> <span class="n">XML</span> <span class="n">identification</span>
       <span class="n">Type</span> <span class="mi">3</span> <span class="n">compression</span>       <span class="o">===&gt;</span>          <span class="n">Discover</span> <span class="n">typical</span> <span class="n">screens</span> <span class="p">(</span><span class="n">Virtel</span><span class="o">/</span><span class="n">PC</span><span class="p">)</span>
       <span class="n">Mandatory</span> <span class="n">identification</span> <span class="o">===&gt;</span>                               <span class="p">(</span><span class="n">PC</span> <span class="ow">or</span> <span class="n">minitel</span><span class="p">)</span>
       <span class="mi">3270</span> <span class="n">swap</span> <span class="n">key</span>            <span class="o">===&gt;</span>          <span class="n">eg</span> <span class="n">P24</span>
       <span class="n">Extended</span> <span class="n">colors</span>          <span class="o">===&gt;</span> <span class="n">X</span>        <span class="n">E</span><span class="p">:</span> <span class="n">extended</span> <span class="n">X</span><span class="p">:</span> <span class="n">extended</span> <span class="o">+</span> <span class="n">DBCS</span>

       <span class="n">P1</span><span class="o">=</span><span class="n">Update</span>                       <span class="n">P3</span><span class="o">=</span><span class="n">Return</span>                  <span class="n">P4</span><span class="o">=</span><span class="n">Transactions</span>
       <span class="n">Enter</span><span class="o">=</span><span class="n">Add</span>
</pre></div>
</div>
<p><em>Example of entry point with last page</em></p>
</div>
</div>
<div class="section" id="how-to-access-a-host-application-directly">
<span id="index-439"></span><h3>How To Access A Host Application Directly<a class="headerlink" href="#how-to-access-a-host-application-directly" title="Permalink to this headline">¶</a></h3>
<p>It is not always necessary to pass via an application selection menu to connect to a host application. A host application may be accessed directly by opening the URL containing the complete path to the application. This URL may result in the display of the host signon screen, the first application screen, or possibly (if a script or scenario is used), a subsequent screen sent by the application. For more information about how VIRTEL can be used to automate the process of connection to a host application, see <a class="reference internal" href="#ug-url-formats"><span class="std std-ref">“Virtel URL formats”</span></a> of this manual, and “Connection/Disconnection Scripts” in the VIRTEL Connectivity Reference manual.</p>
<div class="section" id="full-path-url">
<h4>Full path URL<a class="headerlink" href="#full-path-url" title="Permalink to this headline">¶</a></h4>
<p>For example, you can access the VIRTEL transaction whose external name is “CICS” by pointing the browser at a URL of the following format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="p">:</span><span class="mi">41001</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">WEB2AJAX</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">Cics</span>
</pre></div>
</div>
<p>At the end of the session with the host application, VIRTEL examines the “Last page” field (see previous section) to decide whether to return to the desktop or to redisplay the application selection menu.</p>
</div>
<div class="section" id="default-url-for-the-entry-point">
<h4>Default URL for the entry point<a class="headerlink" href="#default-url-for-the-entry-point" title="Permalink to this headline">¶</a></h4>
<p>An application URL may be coded in the “TIOA at logon” field of the default transaction for the entry point (the default transaction is the transaction whose external name is the same as the entry point name). This allows the user to go directly to the host application simply by entering a URL of the format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">n</span><span class="p">:</span><span class="mi">41001</span>
</pre></div>
</div>
<p>The example below shows the default transaction for the WEB2HOST entry point set up to go directly to the
transaction whose external name is “Cics”:</p>
<p>TRANSACTION DETAIL DEFINITION ———————- Applid: VIRTEL 15:01:02
Internal name    ===&gt; W2H-00            To associate with an entry point name
External name    ===&gt; WEB2HOST          Name displayed on user menu
Description      ===&gt; Default directory = entry point name
Application      ===&gt; W2H-DIR           Application to be called
PassTicket       ===&gt; 0 Name ===&gt;       0=no 1=yes 2=unsigned
Application type ===&gt; 4                 1=VTAM 2=VIRTEL 3=SERV 4=PAGE 5=LINE
Pseudo-terminals ===&gt; DELOC             Prefix of name of partner terminals
Logmode ===&gt;                            Specify when LOGMODE must be changed
How started      ===&gt; 2                 1=menu 2=sub-menu 3=auto
Security         ===&gt; 0                 0=none 1=basic 2=NTLM 3=TLS 4=HTML
H4W commands ?   ===&gt;                   0=no 1=yes 2=if2VIRTEL 4=auto
Check URL Prefix ===&gt;</p>
<p>TIOA at logon    ===&gt; /w2h/WEB2AJAX.htm+Cics</p>
<p>TIOA at logoff   ===&gt;</p>
<p>Initial Scenario ===&gt;                   Final Scenario ===&gt;
Input Scenario   ===&gt;                   Output Scenario ===&gt;</p>
<p>P1=Update                         P3=Return                           P12=Server</p>
<p><em>Example of default URL</em></p>
<p>For more information see <a class="reference internal" href="#ug-url-formats"><span class="std std-ref">“Virtel URL formats”</span></a>.</p>
</div>
</div>
<div class="section" id="how-to-change-the-font-for-web-access">
<span id="index-440"></span><h3>How To Change The Font For Web Access<a class="headerlink" href="#how-to-change-the-font-for-web-access" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#ug-settings-menu"><span class="std std-ref">“Web Access settings menu”</span></a> allows you to change the font family and font size. By default VIRTEL will calculate an appropriate font size to fit the browser window size, but you can choose a fixed font size if you prefer. VIRTEL Web Access uses a fixed-pitch font to display the 3270 screen. If you do not like the default font then you can choose any fixed-pitch font installed on the workstation. Typical fonts available on Windows workstations are Courier New, Fixedsys, Terminal, Consolas, and Lucida Console. You can use the Windows Control Panel – Fonts dialog to view the installed fonts.</p>
</div>
<div class="section" id="how-to-change-the-3270-display-style">
<span id="index-441"></span><h3>How To Change The 3270 Display Style<a class="headerlink" href="#how-to-change-the-3270-display-style" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#ug-settings-menu"><span class="std std-ref">“Web Access settings menu”</span></a> allows you to change the display style to suit your needs. By default VIRTEL
provides 3 defaults models named “3270”, “Gray” and “White”, If you need some more, you must request your
Administrators.</p>
<p>Selecting display pattern : The display model changes will take effect at the next connection to a 3270 application.</p>
</div>
<div class="section" id="how-to-customize-the-enter-key-settings">
<span id="index-442"></span><h3>How To Customize The Enter Key Settings<a class="headerlink" href="#how-to-customize-the-enter-key-settings" title="Permalink to this headline">¶</a></h3>
<p>Many 3270 users prefer to customize the keyboard mapping so that the “Enter” key on the main keyboard is handled as a 3270 newline, while the right “Ctrl” key and the “Enter” key on the numeric keypad are treated as 3270 Enter. The <a class="reference internal" href="#ug-settings-menu"><span class="std std-ref">“Web Access settings menu”</span></a> allows you to specify this configuration using the following settings:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;ctrl&quot;</span><span class="p">:</span><span class="s2">&quot;ENTER&quot;</span><span class="p">,</span>
<span class="s2">&quot;enter&quot;</span><span class="p">:</span><span class="s2">&quot;Newline&quot;</span><span class="p">,</span>
<span class="s2">&quot;kpenter&quot;</span><span class="p">:</span><span class="s2">&quot;ENTER&quot;</span>
</pre></div>
</div>
<p>Versions 6, 7, and 8 of Internet Explorer do not distinguish between the Enter key on the main keyboard and the Enter key on the numeric keypad. For users who want the two “Enter” keys to be handled differently, Syspertec supplies an additional DLL to be installed in Internet Explorer as a “Browser Helper Object”. This DLL can be installed by clicking on the “Install VirtKey BHO” link on the VIRTEL Web Access menu. After installing the DLL, go to “Tools” – “Internet Options” – “Advanced” and check that the option “Enable third-party browser extensions” is ticked, then stop and restart Internet Explorer. Administrator privilege is needed to install the Browser Helper Object, but once installed the BHO can be used by users without administrator privileges.</p>
<p>Although other browsers (including Internet Explorer 9) are capable of recognizing the keypad Enter key without the need for a BHO, older releases of Firefox, Chrome, and Safari do not distinguish between the left and right Ctrl keys. This means that when “ctrl” is set to “ENTER” then both Ctrl keys will be handled as 3270 Enter. In addition, the AltGr key will be treated as Ctrl under Firefox. The most recent versions of Firefox (from version 15 onwards for Windows 7 and from version 17 onwards for Windows XP) and Chrome (from version 23 onwards) are capable of distinguishing between the left and right Ctrl keys like Internet Explorer.</p>
<div class="section" id="managing-ctrl-keydown-being-lost">
<h4>Managing CTRL keydown being lost<a class="headerlink" href="#managing-ctrl-keydown-being-lost" title="Permalink to this headline">¶</a></h4>
<p>With some Windows Operating System, the CTRL keydown events may be lost half the time. In such case, you must turn on a special feature by introducing the following command into a “custom.js” file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>
<span class="o">*</span> <span class="n">The</span> <span class="n">workaround</span> <span class="k">for</span> <span class="n">missing</span> <span class="n">CTRL</span> <span class="n">key</span> <span class="n">events</span> <span class="p">(</span><span class="n">on</span> <span class="n">some</span> <span class="n">Windows</span> <span class="n">system</span><span class="p">)</span> <span class="ow">is</span>
<span class="o">*</span> <span class="n">activated</span> <span class="k">if</span> <span class="n">this</span> <span class="nb">property</span> <span class="ow">is</span> <span class="nb">set</span> <span class="n">to</span> <span class="n">true</span><span class="o">.</span>
<span class="o">*</span> <span class="n">Default</span> <span class="n">value</span> <span class="p">(</span><span class="k">if</span> <span class="n">unspecified</span><span class="p">)</span> <span class="p">:</span> <span class="n">false</span>
<span class="o">*/</span>
<span class="n">w2hparm</span><span class="o">.</span><span class="n">fixMissingCtrlKeydown</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
</pre></div>
</div>
<span class="target" id="ug-customize-display"></span></div>
</div>
<div class="section" id="how-to-customize-display-styles">
<span id="index-443"></span><h3>How To Customize Display Styles<a class="headerlink" href="#how-to-customize-display-styles" title="Permalink to this headline">¶</a></h3>
<p>VIRTEL users can customise the screen display to suit their needs. An exception to this is the model type which is an Administration function. Administrators will configure model types which can then be selected by a user.</p>
<div class="section" id="add-or-remove-a-display-style">
<h4>Add or remove a display style<a class="headerlink" href="#add-or-remove-a-display-style" title="Permalink to this headline">¶</a></h4>
<p>To add a new display style, you must :</p>
<ul>
<li><p class="first">Create a CSS file with a “.css” extension name,</p>
</li>
<li><p class="first">Load this file in any directory of your choice except in W2H-DIR,</p>
</li>
<li><p class="first">Make sure that this directory is referenced in the entry point by using a transaction that contains the string “/w2h/custom-css” (without the quotes) in the “URL prefix” field.</p>
</li>
<li><p class="first">Create (or modify) a custom.js file to reference the recently added CSS file (see below):</p>
<blockquote>
<div><ul class="simple">
<li>Load the custom.js file in any directory of your choice except in W2H-DIR,</li>
<li>Make sure that this directory is referenced in the entry point by using a transaction that contains the string “/w2h/custom-js” (without the quotes) in the “URL prefix” field.</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*=====================================================================</span>
<span class="o">*</span>
<span class="o">*</span> <span class="n">CUSTOM</span> <span class="n">CODE</span> <span class="n">SAMPLE</span> <span class="n">TO</span> <span class="n">ADD</span> <span class="n">A</span> <span class="n">CUSTOM</span> <span class="n">CSS</span> <span class="n">FILE</span>
<span class="o">*</span> <span class="n">OR</span> <span class="n">TO</span> <span class="n">REMOVE</span> <span class="n">A</span> <span class="n">DEFAULT</span> <span class="n">CSS</span> <span class="n">FILE</span>
<span class="o">*</span>
<span class="o">*====================================================================*/</span>
<span class="o">/*</span>
<span class="o">*</span> <span class="n">This</span> <span class="n">implementation</span> <span class="n">adds</span> <span class="mi">3</span> <span class="n">custom</span> <span class="n">CSS</span> <span class="n">to</span> <span class="n">the</span> <span class="n">settings</span> <span class="s2">&quot;Display Style&quot;</span> <span class="nb">list</span> <span class="n">choice</span><span class="p">,</span>
<span class="o">*</span> <span class="ow">and</span> <span class="n">removes</span> <span class="n">the</span> <span class="s2">&quot;white&quot;</span> <span class="n">default</span> <span class="n">choice</span> <span class="kn">from</span> <span class="nn">this</span> <span class="nb">list</span><span class="o">.</span>
<span class="o">*/</span>
<span class="n">function</span> <span class="n">modify_settingsValues</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="p">{</span>
<span class="o">//</span> <span class="n">The</span> <span class="n">target</span> <span class="ow">is</span> <span class="n">the</span> <span class="s2">&quot;style&quot;</span> <span class="nb">list</span> <span class="n">settings</span>
<span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;style&quot;</span><span class="p">)</span> <span class="p">{</span>
<span class="o">//</span> <span class="n">Remove</span> <span class="n">the</span> <span class="s2">&quot;white&quot;</span> <span class="n">default</span> <span class="n">entry</span> <span class="kn">from</span> <span class="nn">the</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">choices</span>
<span class="n">values</span><span class="o">.</span><span class="n">splice</span><span class="p">(</span> <span class="n">values</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
<span class="o">//</span> <span class="n">Append</span> <span class="mi">3</span> <span class="n">custom</span> <span class="n">styles</span> <span class="n">to</span> <span class="n">the</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">choices</span>
<span class="k">return</span> <span class="n">values</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span> <span class="s2">&quot;GREEN.CSS&quot;</span>
<span class="p">,</span> <span class="s2">&quot;BLUE.CSS&quot;</span>
<span class="p">,</span> <span class="s2">&quot;RED.CSS&quot;</span> <span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span>
<span class="o">/*</span>
<span class="o">*</span> <span class="n">This</span> <span class="n">block</span> <span class="n">of</span> <span class="n">code</span> <span class="n">sets</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">label</span> <span class="k">for</span> <span class="n">each</span> <span class="n">style</span> <span class="n">added</span><span class="o">.</span>
<span class="o">*</span> <span class="n">If</span> <span class="n">this</span> <span class="n">code</span> <span class="ow">is</span> <span class="n">omitted</span><span class="p">,</span> <span class="n">the</span> <span class="n">raw</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">entries</span> <span class="n">are</span> <span class="n">displayed</span> <span class="n">instead</span><span class="o">.</span>
<span class="o">*/</span>
<span class="n">oVWAmsg</span><span class="o">.</span><span class="n">custom</span><span class="p">(</span> <span class="p">{</span> <span class="s2">&quot;style:GREEN.CSS&quot;</span> <span class="p">:</span> <span class="s2">&quot;Custom&quot;</span> <span class="o">//</span> <span class="n">Use</span> <span class="n">this</span> <span class="n">label</span> <span class="n">instead</span> <span class="n">of</span> <span class="s1">&#39;GREEN.CSS&#39;</span>
<span class="p">,</span> <span class="s2">&quot;style:BLUE.CSS&quot;</span> <span class="p">:</span> <span class="s2">&quot;Test&quot;</span> <span class="o">//</span> <span class="n">Use</span> <span class="n">this</span> <span class="n">label</span> <span class="n">instead</span> <span class="n">of</span> <span class="s1">&#39;BLUE.CSS&#39;</span>
<span class="p">,</span> <span class="s2">&quot;style:RED.CSS&quot;</span> <span class="p">:</span> <span class="s2">&quot;Red !&quot;</span> <span class="o">//</span> <span class="n">Use</span> <span class="n">this</span> <span class="n">label</span> <span class="n">instead</span> <span class="n">of</span> <span class="s1">&#39;RED.CSS&#39;</span>
<span class="p">});</span>
</pre></div>
</div>
<p><em>Example of a custom.js file to add or remove a display style</em></p>
</div>
<div class="section" id="add-or-remove-a-print-style">
<span id="ug-customize-print"></span><h4>Add or remove a print style<a class="headerlink" href="#add-or-remove-a-print-style" title="Permalink to this headline">¶</a></h4>
<p>To add a new print style, proceed as for a display style, but in the VWAmsg.custom order, replace the word “style” by</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>“printstyle”.
/*=====================================================================
*
* CUSTOM CODE SAMPLE TO ADD A CUSTOM CSS FILE
* OR TO REMOVE A DEFAULT CSS FILE
*
*====================================================================*/
/*
* This implementation adds 3 custom CSS to the settings &quot;Display Style&quot; list choice,
* and removes the &quot;white&quot; default choice from this list.
*/
function modify_settingsValues(name, values) {
// The target is the &quot;printstyle&quot; list settings
if (name == &quot;printstyle&quot;) {
// Remove the &quot;white&quot; default entry from the list of choices
values.splice( values.indexOf(&#39;white&#39;), 1);
// Append 3 custom print styles to the list of choices
return values.concat( &quot;GREEN.CSS&quot;
, &quot;BLUE.CSS&quot;
, &quot;RED.CSS&quot; );
}
}
/*
* This block of code sets a specific label for each print style added.
* If this code is omitted, the raw value of the entries are displayed instead.
*/
oVWAmsg.custom( { &quot;printstyle:GREEN.CSS&quot; : &quot;Custom&quot; // Use this label instead of &#39;GREEN.CSS&#39;
, &quot;printstyle:BLUE.CSS&quot; : &quot;Test&quot; // Use this label instead of &#39;BLUE.CSS&#39;
, &quot;printstyle:RED.CSS&quot; : &quot;Red !&quot; // Use this label instead of &#39;RED.CSS&#39;
});
</pre></div>
</div>
<p><em>Example of a custom.js file to add or remove a print style</em></p>
</div>
<div class="section" id="support-blinking-fields">
<h4>3270 support blinking fields<a class="headerlink" href="#support-blinking-fields" title="Permalink to this headline">¶</a></h4>
<p>Becoming unpopular over time, and even stated as being the cause of adverse reactions in people with epilepsy, the “&lt;blink&gt;” tag was retired from the HTML API, although it still remains within the browsers code. The feature can be reactivated through the use of CSS code but by doing so Web Accessibility guidelines may be compromised. This may be a violation in certain jurisdictions, contravening laws and regulations with regard to web design and accessibility and what is permissible. It is up to each individual to determine the purpose and usefulness of reactivating this feature.</p>
<p>To reactivate blinking support, you can include the following code in your custom.css file :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">To</span> <span class="n">support</span> <span class="s2">&quot;BLINKING&quot;</span> <span class="ow">in</span> <span class="n">Virtel</span> <span class="n">Web</span> <span class="n">Access</span> <span class="mi">3270</span> <span class="n">emulation</span><span class="p">,</span> <span class="n">the</span> <span class="n">following</span> <span class="n">code</span> <span class="n">has</span> <span class="n">to</span> <span class="n">be</span> <span class="n">included</span> <span class="n">into</span> <span class="n">your</span> <span class="s2">&quot;.BBLUE, .BRED, .BPINK, .BGREEN, .BTURQUOISE, .BYELLOW, .BWHITE {</span>
<span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">animation</span><span class="p">:</span> <span class="n">blink</span> <span class="mi">1</span><span class="n">s</span> <span class="n">step</span><span class="o">-</span><span class="n">end</span> <span class="n">infinite</span><span class="p">;</span>
<span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="n">animation</span><span class="p">:</span> <span class="n">blink</span> <span class="mi">1</span><span class="n">s</span> <span class="n">step</span><span class="o">-</span><span class="n">end</span> <span class="n">infinite</span><span class="p">;</span>
<span class="o">-</span><span class="n">o</span><span class="o">-</span><span class="n">animation</span><span class="p">:</span> <span class="n">blink</span> <span class="mi">1</span><span class="n">s</span> <span class="n">step</span><span class="o">-</span><span class="n">end</span> <span class="n">infinite</span><span class="p">;</span>
<span class="n">animation</span><span class="p">:</span> <span class="n">blink</span> <span class="mi">1</span><span class="n">s</span> <span class="n">step</span><span class="o">-</span><span class="n">end</span> <span class="n">infinite</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">@-</span><span class="n">webkit</span><span class="o">-</span><span class="n">keyframes</span> <span class="n">blink</span> <span class="p">{</span>
<span class="mi">67</span><span class="o">%</span> <span class="p">{</span> <span class="n">opacity</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>
<span class="p">}</span>
<span class="o">@-</span><span class="n">moz</span><span class="o">-</span><span class="n">keyframes</span> <span class="n">blink</span> <span class="p">{</span>
<span class="mi">67</span><span class="o">%</span> <span class="p">{</span> <span class="n">opacity</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>
<span class="p">}</span>
<span class="o">@-</span><span class="n">o</span><span class="o">-</span><span class="n">keyframes</span> <span class="n">blink</span> <span class="p">{</span>
<span class="mi">67</span><span class="o">%</span> <span class="p">{</span> <span class="n">opacity</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nd">@keyframes</span> <span class="n">blink</span> <span class="p">{</span>
<span class="mi">67</span><span class="o">%</span> <span class="p">{</span> <span class="n">opacity</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This code can also be found into the “custom-blink.css” source file store into the “tools” subdirectory of any update delivered from number #5310 and over.</p>
</div>
</div>
<div class="section" id="how-to-change-the-default-user-settings">
<span id="index-444"></span><h3>How To Change The Default User Settings<a class="headerlink" href="#how-to-change-the-default-user-settings" title="Permalink to this headline">¶</a></h3>
<p>The site default settings for Web Access are stored in the file w2hparm.js (see <a class="reference internal" href="#ug-global-modifications"><span class="std std-ref">“Global modification of Web Access settings”</span></a>)</p>
</div>
<div class="section" id="how-to-support-a-reverse-proxy">
<span id="index-445"></span><h3>How To Support A Reverse Proxy<a class="headerlink" href="#how-to-support-a-reverse-proxy" title="Permalink to this headline">¶</a></h3>
<p>If your installation uses a reverse proxy (or bastion host) between the user’s browser and the VIRTEL Web Access server, then the VIRTEL log and statistics file will show the IP address of the proxy instead of the address of the end user. In order for VIRTEL to recognize and log the originating user’s IP address, you must declare the proxy in the HTFORWD parameter of the VIRTCT (see “Parameters of the VIRTCT” in the VIRTEL Installation Guide) or in a rule attached to the HTTP line (see “Rules” in the VIRTEL Connectivity Reference manual).</p>
</div>
<div class="section" id="how-to-support-virtual-hosting">
<span id="index-446"></span><h3>How To Support Virtual Hosting<a class="headerlink" href="#how-to-support-virtual-hosting" title="Permalink to this headline">¶</a></h3>
<p>Name-based virtual hosting is a method for supporting multiple sites (for example, site1.mycompany.com and site2.mycompany.com) using the same IP address and port number. By means of the “HTTP Host” field in the rules attached to the HTTP line, VIRTEL can recognize the site name and direct the request to a specific entry point. Refer to “Rules” in the VIRTEL Connectivity Reference manual for further details. You can install a set sample definitions for virtual hosting by running the ARBOLOAD job (delivered in the VIRTEL SAMPLIB) with the VHOST=YES parameter.</p>
</div>
<div class="section" id="how-to-control-applist-behaviour">
<span id="index-447"></span><h3>How To Control APPLIST behaviour<a class="headerlink" href="#how-to-control-applist-behaviour" title="Permalink to this headline">¶</a></h3>
<p>To open an application in a new TAB instead of the current window code the following in the customizable exit <em>before_launchApplink(href)</em>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">To</span> <span class="nb">open</span> <span class="n">an</span> <span class="n">application</span> <span class="p">(</span><span class="n">issued</span> <span class="kn">from</span> <span class="nn">applist</span> <span class="n">transaction</span><span class="p">)</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">new</span> <span class="n">TAB</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">the</span> <span class="n">same</span> <span class="n">window</span> <span class="o">*/</span>
<span class="n">function</span> <span class="n">before_launchApplink</span><span class="p">(</span><span class="n">href</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
            <span class="n">url</span><span class="p">:</span> <span class="n">href</span><span class="p">,</span>            <span class="o">//</span> <span class="n">Return</span> <span class="n">received</span> <span class="n">URL</span>
            <span class="n">target</span><span class="p">:</span> <span class="s1">&#39;_blank&#39;</span>    <span class="o">//</span> <span class="n">Target</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">new</span> <span class="n">TAB</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Create an options entry to support this modification against transaction applist (CLI-90). For example, using the Virtel HTML Admin. panel, select transaction applist and use the toolbox Icon to generate the options file. In the transaction set the options field to appmenu. Remember to save the changes to the transaction!  Place the above code into a file called custJS.appmenu.js and upload to the directory defined for the ‘options’ path.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must have setup the “options” mode customization before you can generate “option” files. The ARBOLOAD job must be run with OPTIONS=YES to add the options transactions. See <a class="reference internal" href="#ug-customizing-with-option"><span class="std std-ref">“Virtel Customization Modes”</span></a> on how to set up customising with the options mode.</p>
</div>
</div>
</div>
<div class="section" id="appendix">
<h2>Appendix<a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="appendix-a">
<h3>Appendix A<a class="headerlink" href="#appendix-a" title="Permalink to this headline">¶</a></h3>
<div class="section" id="default-values-for-w2h-parameters">
<span id="ug-w2hparm-defaults"></span><h4>Default values for W2H parameters<a class="headerlink" href="#default-values-for-w2h-parameters" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="25%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Keyword</th>
<th class="head">Caption</th>
<th class="head">Possible values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>“fontsize”</td>
<td>Font size</td>
<td>“window”, “screen”, “8”, “10”, “12”, “14”, “16”</td>
</tr>
<tr class="row-odd"><td>“font”</td>
<td>Font family</td>
<td>“font name”</td>
</tr>
<tr class="row-even"><td>“autocapture”</td>
<td>Auto-capture</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>“autoprint”</td>
<td>Auto-print</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>“cursor”</td>
<td>Cursor “Bar”,</td>
<td>“Blink”, “Block”</td>
</tr>
<tr class="row-odd"><td>“vline”</td>
<td>Vertical line</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>“hline”</td>
<td>Horiz line</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>“esc”</td>
<td>Esc key</td>
<td>“no”, “ATTN”, “CLEAR”, “Reset”</td>
</tr>
<tr class="row-even"><td>“ctrl”</td>
<td>Ctrl key</td>
<td>“no”, “ENTER”, “Newline”</td>
</tr>
<tr class="row-odd"><td>“cmdleft”</td>
<td>Left Cmd key</td>
<td>“no”, “Reset”</td>
</tr>
<tr class="row-even"><td>“cmdright”</td>
<td>Right Cmd key</td>
<td>“no”, “ENTER”</td>
</tr>
<tr class="row-odd"><td>“enter”</td>
<td>Enter key</td>
<td>“ENTER”, “Newline”</td>
</tr>
<tr class="row-even"><td>“home”</td>
<td>Home key</td>
<td>“no”, “Home”</td>
</tr>
<tr class="row-odd"><td>“end”</td>
<td>End key</td>
<td>“no”, “ErEof”, “End”</td>
</tr>
<tr class="row-even"><td>“pgup”</td>
<td>PageUp key</td>
<td>“PF7”, “PF19”, “PA1”, “no”</td>
</tr>
<tr class="row-odd"><td>“pgdn”</td>
<td>PageDown key</td>
<td>“PF8”, “PF20”, “PA2”, “no”</td>
</tr>
<tr class="row-even"><td>“pause”</td>
<td>Pause key</td>
<td>“CLEAR”, “ATTN”, “PA3”, “no”</td>
</tr>
<tr class="row-odd"><td>“kpenter”</td>
<td>Keypad Enter</td>
<td>“ENTER”, “Newline”</td>
</tr>
<tr class="row-even"><td>“shiftenter”</td>
<td>Shift+Enter</td>
<td>“no”,”ENTER”, “Newline”</td>
</tr>
<tr class="row-odd"><td>“shiftesc”</td>
<td>Shift+Esc</td>
<td>“no”, “ATTN”, “CLEAR”, “Reset”</td>
</tr>
<tr class="row-even"><td>“shiftins”</td>
<td>Shift+Insert</td>
<td>“no”, “Dup”</td>
</tr>
<tr class="row-odd"><td>“shiftdel”</td>
<td>Shift+Delete</td>
<td>“no”, “ErEof”</td>
</tr>
<tr class="row-even"><td>“shifthome”</td>
<td>Shift+Home</td>
<td>“no”, “FieldMark”, “Home”</td>
</tr>
<tr class="row-odd"><td>“shiftend”</td>
<td>Shift+End</td>
<td>“no”, “ErEof”, “End”</td>
</tr>
<tr class="row-even"><td>“shiftpgdn”</td>
<td>Shift+PageDown</td>
<td>“no”, “PA3”</td>
</tr>
<tr class="row-odd"><td>“ctrlenter”</td>
<td>Ctrl+Enter</td>
<td>“no”,”ENTER”, “Newline”</td>
</tr>
<tr class="row-even"><td>“ctrlins”</td>
<td>Ctrl+Insert</td>
<td>“no”, “PA1”</td>
</tr>
<tr class="row-odd"><td>“ctrldel”</td>
<td>Ctrl+Delete</td>
<td>“no”, “PA2”, “ErEof”</td>
</tr>
<tr class="row-even"><td>“ctrlhome”</td>
<td>Ctrl+Home</td>
<td>“no”, “PA3”, “Home”, “ChgCur”</td>
</tr>
<tr class="row-odd"><td>“ctrlend”</td>
<td>Ctrl+End</td>
<td>“no”, “ErEof”, “End”</td>
</tr>
<tr class="row-even"><td>“altins”</td>
<td>Alt+Ins</td>
<td>“no”, “PA1”</td>
</tr>
<tr class="row-odd"><td>“althome”</td>
<td>Alt+Home</td>
<td>“no”, “PA2”</td>
</tr>
<tr class="row-even"><td>“altpgup”</td>
<td>Alt+PageUp</td>
<td>“no”, “PA1”</td>
</tr>
<tr class="row-odd"><td rowspan="2">“altpgdn”</td>
<td rowspan="2">Alt+PageDown</td>
<td rowspan="2">“no”, “PA2”</td>
</tr>
<tr class="row-even"></tr>
<tr class="row-odd"><td>“altpause”</td>
<td>Alt+Pause</td>
<td>“no”, “ATTN”, “CLEAR”, “PA3”</td>
</tr>
<tr class="row-even"><td>“altf1”</td>
<td>Alt+F1</td>
<td>“no”, “PA1”, “ENTER”</td>
</tr>
<tr class="row-odd"><td>“altf2”</td>
<td>Alt+F2</td>
<td>“no”, “PA2”</td>
</tr>
<tr class="row-even"><td>“altf3”</td>
<td>Alt+F3</td>
<td>“no”, “PA3”, “ChgCur”</td>
</tr>
<tr class="row-odd"><td>“kpslash”</td>
<td>Keypad /</td>
<td>“/”, “PA1”</td>
</tr>
<tr class="row-even"><td>“kpaster”</td>
<td>Keypad *</td>
<td>“*”, “PA2”</td>
</tr>
<tr class="row-odd"><td>“kpminus”</td>
<td>Keypad -</td>
<td>“-“, “Backtab”</td>
</tr>
<tr class="row-even"><td>“kpplus”</td>
<td>Keypad +</td>
<td>“+”, “Tab”, “Newline”</td>
</tr>
<tr class="row-odd"><td>“kpdot”</td>
<td>Keypad .</td>
<td>“.”, “,”</td>
</tr>
<tr class="row-even"><td>“dblclick”</td>
<td>Double Click</td>
<td>“Word”, “ENTER”, “no”</td>
</tr>
<tr class="row-odd"><td>“urlhotspot”</td>
<td>URL hotspots</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>“pfkhotspot”</td>
<td>PF key hotspots</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>“pasteereof”</td>
<td>Paste erase EOF</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>“pastetyping”</td>
<td>Map Ctrl+V to Paste
by Typing</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>“movecursor”</td>
<td>Move cursor on activat</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>“style”</td>
<td>Style</td>
<td>“3270”, “gray”, “white”</td>
</tr>
<tr class="row-odd"><td>“printstyle”</td>
<td>Print style</td>
<td>“3270”, “color”, “white”</td>
</tr>
<tr class="row-even"><td>“rtm”</td>
<td>Response time monitor</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>“omitnulls”</td>
<td>Omit nulls from input</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>“keepmacpad”</td>
<td>Keep macro pad open</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>“keepkeypad”</td>
<td>Keep keypad open</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>“hiliteinput”</td>
<td>Highlight input fields</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>“caretnot”</td>
<td>Remap ^ to logical not</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>“adaptfontratio”</td>
<td>Adapt font size ratio</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>“charspace”</td>
<td>Character spacing</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>“linespace”</td>
<td>Line spacing</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>“settingsGUI”</td>
<td>Uuser interface type</td>
<td>v2</td>
</tr>
<tr class="row-even"><td>“preservein”</td>
<td>Preserve insert mode</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>“nolongpoll”</td>
<td>AsynchSupport</td>
<td>true, false</td>
</tr>
<tr class="row-even"><td>“MirrorMode”</td>
<td>BiDirectional mode</td>
<td>true, false</td>
</tr>
<tr class="row-odd"><td>“NOstretch”</td>
<td>Font Size Stretch</td>
<td>true, false</td>
</tr>
</tbody>
</table>
<p><em>Default W2H parameters: List of keywords and possible values</em></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some settings my be deprecated and therefore may no longer be in use. They remain for reasons of downward compatibility.</p>
</div>
</div>
</div>
<div class="section" id="trademarks">
<h3>Trademarks<a class="headerlink" href="#trademarks" title="Permalink to this headline">¶</a></h3>
<p>SysperTec, the SysperTec logo, syspertec.com and VIRTEL are trademarks or registered trademarks of SysperTec
Communication Group, registered in France and other countries.</p>
<p>IBM, VTAM, CICS, IMS, RACF, DB2, MVS, WebSphere, MQSeries, System z are trademarks or registered trademarks of
International Business Machines Corp., registered in United States and other countries.</p>
<p>Adobe, Acrobat, PostScript and all Adobe-based trademarks are either registered trademarks or trademarks of Adobe
Systems Incorporated in the United States and other countries.</p>
<p>Microsoft, Windows, Windows NT, and the Windows logo are trademarks of Microsoft Corporation in the United States
and other countries.</p>
<p>UNIX is a registered trademark of The Open Group in the United States and other countries.
Java and all Java-based trademarks and logos are trademarks or registered trademarks of Oracle and/or its affiliates.</p>
<p>Linux is a trademark of Linus Torvalds in the United States, other countries, or both.</p>
<p>Other company, product, or service names may be trademarks or service names of others.</p>
</div>
<div class="section" id="open-source-software">
<h3>Open Source Software<a class="headerlink" href="#open-source-software" title="Permalink to this headline">¶</a></h3>
<p>The current VIRTEL Web Access product uses the following open source software:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>jQuery</dt>
<dd>Under MIT license - <a class="reference external" href="https://jquery.org/license/">https://jquery.org/license/</a></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>StoreJson</dt>
<dd>Under MIT license - <a class="reference external" href="https://github.com/marcuswestin/store.js/commit/baf3d41b7092f0bacd441b768a77650199c25fa7">https://github.com/marcuswestin/store.js/commit/baf3d41b7092f0bacd441b768a77650199c25fa7</a></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>jQuery_UI</dt>
<dd>Under MIT license - <a class="reference external" href="http://en.wikipedia.org/wiki/JQuery_UI">http://en.wikipedia.org/wiki/JQuery_UI</a></dd>
</dl>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Virtel458CN/connectivity_guide.html" class="btn btn-neutral float-right" title="Connectivity Reference V4.58" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../Virtel457MI/Migration_Guide.html" class="btn btn-neutral float-left" title="Migration Guide V4.57" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Syspertec. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>