

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using the IBM System Logger with Virtel &mdash; Virtel 1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Virtel 1 documentation" href="../../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Virtel
          

          
            
            <img src="../../../_static/logo_virtel_web.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../newsletters.html">Technical Newsletters</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Virtel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
    <li>Using the IBM System Logger with Virtel</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/manuals/newsletters/TN201520/TN201520.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-the-ibm-system-logger-with-virtel">
<h1>Using the IBM System Logger with Virtel<a class="headerlink" href="#using-the-ibm-system-logger-with-virtel" title="Permalink to this headline">¶</a></h1>
<p>With the latest release of Virtel, currently Release 4.55, Virtel has
the ability to write all of its log records to IBM’s System Logger.</p>
<p>To use this feature code LOG=LOGGER in the TCT and compile using a
supporting maclib. Currently this MACLIB is
SPTHOLT.VIRTEL.BASE455.MACLIB. Ensure that a compatible VIR0000 in the
load library is used to avoid TCT mismatch message. The version in
SP000.SPTHOLT.DEV.LOADLIB is compatible with the
SPTHOLT.VIRTEL.BASE455.MACLIB(VIRTERM) member.</p>
<p>When you start Virtel it will attempt to connect to the predefined
Virtel logstream. If the logstream doesn’t exists one will be created
automatically. The following messages will appear in the log:-:</p>
<p>VIR0024I ATTACHING SUBTASKS
IXC582I STRUCTURE VIRTEL_LOG_1 ALLOCATED BY SIZE/RATIOS. 596
PHYSICAL STRUCTURE VERSION: CFF8ABE4 1865AA81
STRUCTURE TYPE: LIST
CFNAME: ZACF1
ALLOCATION SIZE: 9 M
POLICY SIZE: 9 M
POLICY INITSIZE: 9 M
POLICY MINSIZE: 0 K
IXLCONN STRSIZE: 0 K
ENTRY COUNT: 1274
ELEMENT COUNT: 1179
ENTRY:ELEMENT RATIO: 1 : 1
ALLOCATION SIZE IS WITHIN CFRM POLICY DEFINITIONS
IXL014I IXLCONN REQUEST FOR STRUCTURE VIRTEL_LOG_1 597
WAS SUCCESSFUL. JOBNAME: IXGLOGR ASID: 0016
CONNECTOR NAME: IXGLOGR_ZAMVS1 CFNAME: ZACF1
IXL015I STRUCTURE ALLOCATION INFORMATION FOR 598
STRUCTURE VIRTEL_LOG_1, CONNECTOR NAME IXGLOGR_ZAMVS1,
CONNECTIVITY=DEFAULT
CFNAME ALLOCATION STATUS/FAILURE REASON
&#8212;&#8212;&#8211; &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-
ZACF1 STRUCTURE ALLOCATED AC001800
ZACF2 PREFERRED CF ALREADY SELECTED AC001800
PREFERRED CF HIGHER IN PREFLIST
LOGGER CONNECTED</p>
<p>After this point all messages will be written to the logger, even
responses to commands. Each Virtel that has LOG=LOGGER will connect to
the structure. The last message you will see is:</p>
<p>VIR0000I SMTP Date: Wed, 09 Dec 2015 22:34:57 +0100</p>
<p>Fortunately there is a print program that can be used to format and
print off the log records. This is VIR00002B. When the logstream reaches
a particular threshold is spools off a dataset. The following messages
will appear in the log:-:</p>
<p>IEF196I IGD100I 0AA8 ALLOCATED TO DDNAME SYS00008 DATACLAS ( )
IXG283I OFFLOAD DATASET IXGLOGR.LOGGER.VIRTEL.A0000005 897
ALLOCATED NEW FOR LOGSTREAM LOGGER.VIRTEL
CISIZE=4K, SIZE=147456
IXG251I IDCAMS SYSTEM SERVICES
TIME: 22:49:21 12/09/15 PAGE 1
IXG251I ALTER IXGLOGR.LOGGER.VIRTEL.A0000005.DATA -
IXG251I SHR(3,3)
IXG251I IDC0531I ENTRY IXGLOGR.LOGGER.VIRTEL.A0000005.DATA ALTERED
IXG251I IDC0001I FUNCTION COMPLETED, HIGHEST CONDITION CODE WAS 0
IXG251I IDC0002I IDCAMS PROCESSING COMPLETE. MAXIMUM CONDITION CODE WAS 0
IXG282I OFFLOAD DATASET IXGLOGR.LOGGER.VIRTEL.A0000005 904
WAS ALTERED FOR LOGSTREAM LOGGER.VIRTEL
UPDATED ATTRIBUTE VSAM SHAREOPTIONS</p>
<p>To list the logstream, structure and its associated offload datasets,
use the following JCL:-:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">SPTHOLTL</span> <span class="n">JOB</span> <span class="n">CLASS</span><span class="o">=</span><span class="n">A</span><span class="p">,</span><span class="n">MSGCLASS</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">MSGLEVEL</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">NOTIFY</span><span class="o">=&amp;</span><span class="n">SYSUID</span>
<span class="o">//</span><span class="n">STEP1</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">IXCMIAPU</span><span class="p">,</span><span class="n">REGION</span><span class="o">=</span><span class="mi">4</span><span class="n">M</span>
<span class="o">//</span><span class="n">SYSPRINT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=</span>\<span class="o">*</span>
</pre></div>
</div>
<p>DATA TYPE(LOGR) REPORT(NO)
LIST STRUCTURE NAME(VIRTEL_LOG_1) DETAIL(YES)
LIST LOGSTREAM NAME(LOGGER.VIRTEL) DETAIL(YES)</p>
<p>The output will look something like this:-:</p>
<p>Ext. &lt;SEQ#&gt; Lowest Blockid / Highest GMT / Highest Local / Status
Highest Blockid Highest RBA System Name
&#8212;&#8211; &#8212;&#8212;&#8211; &#8212;&#8212;&#8212;&#8212;&#8212;- &#8212;&#8212;&#8212;&#8212;&#8212;&#8211; &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;
*00001 A0000001 0000000000023F64 12/03/14 19:32:35 12/03/14 20:32:35
0000000000047E76 00023F98 ZAMVS1
A0000002 0000000000047EFC 12/03/14 21:49:42 12/03/14 22:49:42
000000000006BE2C 00023FA1 ZAMVS1
A0000003 000000000006BE9D 12/03/14 22:15:12 12/03/14 23:15:12
000000000008FDEB 00023FB4 ZAMVS1
A0000004 000000000008FE51 12/09/15 20:55:39 12/09/15 21:55:39
00000000000B3D5B 00023F90 ZAMVS2
A0000005 00000000000B3DE1 12/09/15 21:49:20 12/09/15 22:49:20 CURRENT
00000000000CCBC7 00018E5F ZAMVS2
NUMBER OF DATA SETS IN LOG STREAM: 5</p>
<p>To delete the structure, run the following job:-:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">SPTHOLTC</span> <span class="n">JOB</span> <span class="n">CLASS</span><span class="o">=</span><span class="n">A</span><span class="p">,</span><span class="n">MSGCLASS</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">MSGLEVEL</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">NOTIFY</span><span class="o">=&amp;</span><span class="n">SYSUID</span>
<span class="o">//</span><span class="n">STEP1</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">IXCMIAPU</span><span class="p">,</span><span class="n">REGION</span><span class="o">=</span><span class="mi">4</span><span class="n">M</span>
<span class="o">//</span><span class="n">SYSPRINT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=</span>\<span class="o">*</span>
</pre></div>
</div>
<p>DATA TYPE(LOGR) REPORT(NO)
DELETE LOGSTREAM NAME(LOGGER.VIRTEL)
LIST LOGSTREAM NAME(LOGGER.VIRTEL) DETAIL(YES)</p>
<p><strong>Reverting back to the console</strong></p>
<p>To revert back to console logging, the normal logging behaviour for
Virtel, issue the following command:-:</p>
<p>F VIRTEL,LOG=CONSOLE</p>
<p>After this all Virtel messages will be written to the console.</p>
<p>Example:-:</p>
<p>F SPVIR1A,LOG=CONSOLE
VIR0238I VIRTEL LOG RECORDING TO CONSOLE
F SPVIR1A,LINES
VIR0200I LINES
VIR0201I VIRTEL 4.55 APPLID=VIRTEL1A LINES
VIR0202I INT.NAME EXT.NAME TYPE ACB OR IP
VIR0202I &#8212;&#8212;&#8211; &#8212;&#8212;&#8211; &#8212;&#8211; &#8212;&#8212;&#8212;
VIR0202I C-HTTP HTTP-CLI TCP1 192.168.170.15:41002
VIR0202I W-HTTP HTTP-W2H TCP1 :41015
VIR0202I &#8212;END OF LIST&#8212;</p>
<p><strong>The VIR0002B Logger print program.</strong></p>
<p>This program currently resides in SPTHOLT.VIRTEL.DEV.LOADLIB</p>
<p>Example JCL:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span>\<span class="o">*</span>
<span class="o">//</span>\<span class="o">*</span> <span class="n">DESCRIPTION</span>
<span class="o">//</span>\<span class="o">*</span>
<span class="o">//</span><span class="n">LOGGER</span> <span class="n">PROC</span> <span class="n">P</span><span class="o">=</span>
<span class="o">//</span><span class="n">S01</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">VIR0002B</span><span class="p">,</span><span class="n">PARM</span><span class="o">=</span><span class="s1">&#39;&amp;P&#39;</span>
<span class="o">//</span><span class="n">STEPLIB</span> <span class="n">DD</span> <span class="n">DSN</span><span class="o">=</span><span class="n">SP000</span><span class="o">.</span><span class="n">SPTHOLT</span><span class="o">.</span><span class="n">DEV</span><span class="o">.</span><span class="n">LOADLIB</span><span class="p">,</span><span class="n">DISP</span><span class="o">=</span><span class="n">SHR</span>
<span class="o">//</span><span class="n">SYSUDUMP</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=</span>\<span class="o">*</span>
<span class="o">//</span><span class="n">SYSOUT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=</span>\<span class="o">*</span>
<span class="o">//</span><span class="n">VIRLOG</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=</span>\<span class="o">*</span><span class="p">,</span><span class="n">DCB</span><span class="o">=</span><span class="n">BLKSIZE</span><span class="o">=</span><span class="mi">13200</span>
<span class="o">//</span> <span class="n">PEND</span>
<span class="o">//</span><span class="n">S01</span> <span class="n">EXEC</span> <span class="n">LOGGER</span><span class="p">,</span><span class="n">P</span><span class="o">=</span><span class="s1">&#39;COPY&#39;</span>
<span class="o">//</span>\<span class="o">*</span><span class="mi">02</span> <span class="n">EXEC</span> <span class="n">LOGGER</span><span class="p">,</span><span class="n">P</span><span class="o">=</span><span class="s1">&#39;COPY(&gt;000)&#39;</span>
<span class="o">//</span>\<span class="o">*</span><span class="mi">03</span> <span class="n">EXEC</span> <span class="n">LOGGER</span><span class="p">,</span><span class="n">P</span><span class="o">=</span><span class="s1">&#39;COPY(2014336,2014336)&#39;</span>
<span class="o">//</span>\<span class="o">*</span><span class="mi">04</span> <span class="n">EXEC</span> <span class="n">LOGGER</span><span class="p">,</span><span class="n">P</span><span class="o">=</span><span class="s1">&#39;DELETE(2014336)&#39;</span>
<span class="o">//</span>\<span class="o">*</span><span class="mi">05</span> <span class="n">EXEC</span> <span class="n">LOGGER</span><span class="p">,</span><span class="n">P</span><span class="o">=</span><span class="s1">&#39;DELETE(&gt;000)&#39;</span>
</pre></div>
</div>
<p>The parameters are as follows:-:</p>
<p>COPY([start_date][,end_date]), DELETE(date)
(&gt;nnn) (&gt;nnn)</p>
<p><strong>COPY</strong></p>
<p>Records are to be copied to the SYSLOG-format file. If COPY is not
specified, no records are copied.</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>start_date,end_date **</p>
<p>The starting and ending dates of the time span, both in the format
YYYYDDD. start_date must not be later than end_date. end_date must
not be later than today, the day the program runs. The default for
start_date is the date of the oldest record in the log stream, and for
end_date is yesterday, the day before the program runs. If both
start_date and end_date are allowed to default, the parentheses after
COPY may be omitted. If you specify a start date of today, you must also
specify the end date of today, otherwise the program will assume an end
date of yesterday and abend.</p>
<p><strong>&gt;nnn</strong></p>
<p>Indicates that records dated more than nnn days before today are to be
copied. The time span will</p>
<p>start with the date of the oldest record in the log stream and end nnn+1
days before today (that is,</p>
<p>records dated more than nnn days before today will be copied. nnn is a
number between zero and 999.</p>
<p>For example, if the program is run on May 25, specifying &#8220;COPY(&gt;3)&#8221; will
copy records dated up to and including May 21. Note that &gt;0 corresponds
to yesterday. To copy today&#8217;s records, you must use the
&#8220;[start_date][,end_date]&#8221; form and specify today as the end date.</p>
<p><strong>DELETE</strong></p>
<p>Records are to be deleted. If DELETE is not specified, no records are
deleted.</p>
<p><strong>date</strong></p>
<p>The date of the newest record to be deleted from the log stream. All
records dated on or before that date will be deleted. The date must not
be later than today. If the date specified is today, all records in the
log stream will be deleted.</p>
<p><strong>&gt;nnn</strong></p>
<p>Indicates that records dated more than nnn days before today are to be
deleted. nnn is a number</p>
<p>between zero and 999. For example, if the program is run on July 15,
specifying &#8220;DELETE(&gt;5)&#8221; will delete records dated up to and including
July 9. Note that &gt;0 corresponds to yesterday. To delete today&#8217;s
records, you must use the &#8220;date&#8221; form and specify today as the date. If
DELETE is specified, either the date or &#8220;&gt;nnn&#8221; must be given.</p>
<p>You may specify either COPY or DELETE or both. If you specify both they
must be separated by a comma and may appear in either order. However,
regardless of the order in which the parameters are specified, the copy
operation will always occur before the delete.</p>
<p><strong>Warning:</strong> When copying records, this program detects the end of a
day&#8217;s records when it either reads the first record for the next day or
attempts to read past the newest record in the log stream. This means
that, if end_date is today and the log stream is being written at the
time this program runs, the records that are copied may not be
predictable. In particular, if both COPY with an ending date of today
and DELETE with a date of today are specified, there may be more records
deleted than copied.</p>
<p><strong>Warning:</strong> When the &#8220;&gt;nnn&#8221; form of the COPY or DELETE parameter is
specified, program converts it to a date by subtracting nnn days from
the date the program is run. The calculation is done once, at the
beginning of the program. If the program is run shortly before midnight,
so that the calculation occurs before midnight and the actual copying or
deletion of records occurs after midnight, the records copied or deleted
will not reflect the number of days specified. To prevent this, you
should</p>
<p>avoid running the program close to midnight with the &#8220;&gt;nnn&#8221; form.</p>
<p>Note that if the program is run regularly after midnight with the
parameter &#8220;COPY(&gt;0),DELETE(&gt;1)&#8221;, it will copy records from the previous
day and earlier, and will delete from the records from two days ago,
leaving something over 24 hours&#8217; worth of records in the log each time.</p>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Syspertec. All rights reserved.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>