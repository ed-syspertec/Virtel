

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Pass tickets and supporting Proxy Servers &mdash; Virtel 1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Virtel 1 documentation" href="../../../index.html"/>
        <link rel="up" title="Technical Newsletters" href="../../../newsletters.html"/>
        <link rel="next" title="Mainframe printing with Virtel 4.56" href="../TN201409/TN201409.html"/>
        <link rel="prev" title="Taking a VIRTEL terminal trace" href="../TN201406/TN201406.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Virtel
          

          
            
            <img src="../../../_static/logo_virtel_web.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../newsletters.html">Technical Newsletters</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../newsletters.html#id1">2014</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../TN201401/TN201401.html">Automation and MVS backups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201402/TN201402.html">Formatting VIRTEL Line Trace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201403/TN201403.html">How to use TESTVTAM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201404/TN201404.html">VIRTEL SMF Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201405/TN201405.html">Multi Line WTO Support in VIRTEL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201406/TN201406.html">Taking a VIRTEL terminal trace</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Pass tickets and supporting Proxy Servers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201409/TN201409.html">Mainframe printing with Virtel 4.56</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201410/TN201410.html">Taking a VTAM trace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201411/TN201411.html">Building a customized USSTAB using Virtel’s Web Access facility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201412/TN201412.html">Sharing user macros across multiple instances of Virtel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201414/TN201414.html">CICS Printing problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201415/TN201415.html">Virtel JES Writer program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201416/TN201416.html">Virtel Security. Using server and client certificates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201417/TN201417.html">RACF Grouping Class and Virtel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201419/TN201419.html">Maintaining TRSF file sets</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Virtel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../newsletters.html">Technical Newsletters</a> &raquo;</li>
      
    <li>Pass tickets and supporting Proxy Servers</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/manuals/newsletters/TN201407/TN201407.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pass-tickets-and-supporting-proxy-servers">
<h1>Pass tickets and supporting Proxy Servers<a class="headerlink" href="#pass-tickets-and-supporting-proxy-servers" title="Permalink to this headline">¶</a></h1>
<p>These products provide an organization with a centralized
enterprise-class secure single sign-on (SSO) and authentication system.
The products tend to run on a server(s) and provides access to a
business’s assets like web enabled applications or portals. The basic
process is to trap the incoming HTTP call request and establish some
user credentials before allowing access to an asset. For example, the
user credentials can be extracted from the callers request or determined
by the callers IP address. The credentials will be validated against a
LDAP or similar active directory server. The result of the validation
will either allow or deny the caller access to the requested asset.
Security and asset control is managed by the SSO server which as a
central server can validate credentials to all business assets, be it on
the mainframe or other platforms. Userid and password administration for
all assets can be controlled through the functions of the SSO software
employed. Virtel will integrate within this SSO infrastructure and
process sign on request once they have passed validation. Virtel
provides its own validation of the SSO server through the use of rules.</p>
<p>In the example that follows we are using CA-Site Minder as an example
SSO Server and we will document how to define Virtel to interface with
the SSO Server and RACF. Our target asset is a CICS application called
SPCICSH. The caller will provide no userid or password data.</p>
<p><img alt="image0" src="../../../_images/image11.jpeg" /></p>
<p>The initial request is passed through the SSO server. The server will
trap and validate the caller. If the validation is successful a session
will be establish between the SSO server and Virtel. Two things to note
at this point. One, the IP address presented to Virtel will be that of
the SSO Proxy Server and two, that the server will modify the HTTP
headers to provide addition information, that being the source IP
address and the user id.</p>
<p>A Virtel line trace will reveal these additional headers.</p>
<p>GET
/w2h/WEB2SUB.HTML++VirtelSession=AFo0JQAAAAMeuCAo+disconnect=1?pf=DISCONNECT
HTTP/1.1</p>
<p>Host: 192.168.170.30:41002</p>
<p>User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:27.0) Gecko/20100101
Firefox/27.0</p>
<p>Accept:
text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</p>
<p>Accept-Language: en-gb,en;q=0.5</p>
<p>Accept-Encoding: gzip, deflate</p>
<p>Referer: <a class="reference external" href="http://192.168.170.30:41002/w2h/WEB2AJAX.htm+CICS">http://192.168.170.30:41002/w2h/WEB2AJAX.htm+CICS</a></p>
<p>Cookie: SYSLANG=en; SYSSTYL=BLUE; SYSPAGE=auto</p>
<p><strong>SM_User: sptholt &lt;&lt;</strong></p>
<p><strong>X-Forwarded-For: 192.168.100.100 &lt;&lt;</strong></p>
<p>Connection: keep-alive</p>
<p>HTTP/1.1 200 Ok</p>
<p>Server: Virtel/4.53</p>
<p>Date: Wed, 26 Mar 2014 15:31:12 GMT</p>
<p>Content-type: text/html</p>
<p>Content-length: 00000125</p>
<p>&lt;html&gt;&lt;head&gt;&lt;Meta HTTP-EQUIV=&#8221;refresh&#8221; CONTENT=&#8221;1;
URL=LASTPAGE.HTML&#8221;&gt;&lt;/head&gt;</p>
<p>&lt;body bgcolor=&#8221;black&#8221;&gt;&lt;br&gt;</p>
<p>&lt;br&gt;</p>
<p>&lt;/body&gt;&lt;/html&gt;</p>
<p>HTTP/1.0 205 Reset Content</p>
<p>Server: Virtel/4.53</p>
<p>In the above trace the CA-SiteMinder specific header “SM_User” can be
seen as identifying the userid and the X-Forwarded-For:, a standard HTTP
header, identifies the source IP address. For security reasons this
proxy IP address must be tested for in a VIRTEL rule before the session
can be established between the caller and the asset. There is no
password associated with this logon – this will be generated via a
PassTicket request on behalf of the userid identified in the “SM_User”
header. The PassTicket will be created as part of the session setup
between Virtel and the asset and on behalf of the caller.</p>
<p>**
Adding headers to the HTTP request.**</p>
<p>Access the CICS application using FireFox. Use the FireFox “AddIn”
Modify Headers to add the headers to the HTTP request. After adding the
headers you will need to “START” the addIn to get the headers added.</p>
<p><img alt="image1" src="../../../_images/image2.png" /></p>
<p>When access the CICS system make sure the “Modify Headers” icon is
started. It should be red.</p>
<p><img alt="image2" src="../../../_images/image3.png" /></p>
<p>The following definitions define what needs to be done to enable a user
to log on without specifying a userid/password to an asset supported by
the SSO server. In our example Virtel will logon to a CICS asset on
behalf of the caller using a userid passed by the SSO Proxy and a
generated PassTicket. The caller provides no userid/password
information. Once the SSO has validated the callers credential the
caller will be logged on to CICS and will be presented with the
following screen:-</p>
<p><img alt="image3" src="../../../_images/image4.jpeg" /></p>
<p><strong>RACF Passtickets</strong></p>
<p>Pass tickets are an alternative to passwords and can greatly improve the
security surrounding SSO and multiple applications access. Passtickets
are a dynamically generated password that lasts for approximately 10
minutes. Further information on RACF Passtickets can be found on the
web. For the purpose of this newsletter we will look at the Virtel
requirements needed to access our target CICS asset whose RACF APPL is
SPCICSH. Our Virtel task runs under the RACF userid of SPVIRSTC. Here
are the RACF definitions required to support the generation of
PassTickets for the target application APPL SPCICSH.</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>Sample RACF job to define the RACF profiles. **</p>
<p>This job will have to be modified to a customer’s RACF setup. Some
profiles may already be defined! If the PERMIT statements do not run
then that probably means that some of the RDEFINE entries already exist
in the RACF database - these need to be removed, or an RDELETE added to
delete the profile entry, in order for the job to complete successfully.
It should produce a RC=0. See the output in SDSF.</p>
<p>//STEP1 EXEC PGM=IKJEFT1A,DYNAMNBR=20</p>
<p>//SYSTSPRT DD SYSOUT=*</p>
<p>//SYSTSIN DD *</p>
<p>SETROPTS CLASSACT(APPL)</p>
<p>SETROPTS CLASSACT(PTKTDATA)</p>
<p>SETROPTS RACLIST(PTKTDATA)</p>
<p>SETROPTS GENERIC(PTKTDATA)</p>
<p>RDEFINE FACILITY IRR.RTICKETSERV</p>
<p>RDEFINE PTKTDATA IRRPTAUTH.SPCICSH.* UACC(NONE)</p>
<p>RDEFINE PTKTDATA SPCICSH SSIGNON(KEYMASKED(998A654FEBCDA123)) +</p>
<p>UACC(NONE)</p>
<p>PERMIT IRR.RTICKETSERV CL(FACILITY) ID(SPVIRSTC) ACC(READ)</p>
<p>PERMIT IRRPTAUTH.SPCICSH.* CL(PTKTDATA) ID(SPVIRSTC) ACC(UPDATE)</p>
<p>SETROPTS REFRESH RACLIST(PTKTDATA)</p>
<p>SETROPTS REFRESH RACLIST(FACILITY)</p>
<p>Three distinct RACF profiles are required to use RACF pass tickets:-</p>
<p>FACILITY IRR.RTICKETSERV Can use PassTickets</p>
<p>PTKTDATA IRRPTAUTH.passTicketName.* Let’s VIRETL generate PassTickets
on behalf of an application for all users. * or <em>userid</em></p>
<p>PTKTDATA profile_name APPLNAME used by RACROUTE REQUEST=VERIFY</p>
<p><strong>Virtel Name correlation</strong></p>
<ul class="simple">
<li>passTicketName must equal the PassTicket Name defined in the VIRTEL
transaction.</li>
<li>profile_name must equal the VTAM application name defined in the
VIRTEL transaction.</li>
</ul>
<p>These names are normally the same, but they do not have to be. See the
“<strong>RACF profiles related to Pass Tickets</strong>” section for further
information.</p>
<p><em>Note:</em></p>
<p><a href="#id3"><span class="problematic" id="id4">*</span></a>If you are running separate RACF databases across LPARS the KEYMASKED
must be the same in each RACF database or else the wrong password will
be generated and the logon will fail. *</p>
<p><strong>Virtel Requirements</strong></p>
<p>The Virtel Transaction, under Entry Point CLIWHOST, that we will use to
access the CICS asset has an external name of “Cics”. We modify our
transaction to use pass tickets and add a TIOA to logon to our CICS
transaction. The transaction details look like:-</p>
<p><img alt="image4" src="../../../_images/image5.jpeg" /></p>
<p>The PassTicket option is set to 2 and uses the APPL name associated with
CICS transaction. Using 2 means that we do not have to sign onto Virtel
first before generating a PassTicket. Virtel will expect the System
variable USER to be established. This will be accomplished in an
identification scenario where we have access to the SM_User header
value. See the section on Identification Scenario.</p>
<p>The TIOA sign on field waits for the initial CICS sign on screen to
appear and then plugs in the userid (&amp;U) and PassTicket generated
password (&amp;P) into their respective locations. The screen is then
“entered” and returned to the application.</p>
<p><strong>Identification Scenario</strong></p>
<p>To obtain the “SM_User” value and set the userid in the System USER
variable an identification scenario is used. The following is an
example:-</p>
<p>SCENSITE SCREENS APPL=SCENSITE,EXEC=NO</p>
<p>*</p>
<p>* SCENARIO for SiteMinder</p>
<p>*</p>
<p>* The purpose of this scenario is to retrieve the contents of</p>
<p>* the identification headers inserted by the SiteMinder Proxy</p>
<p>*</p>
<p>SCENARIO IDENTIFICATION</p>
<p>*</p>
<p>COPY$ SYSTEM-TO-VARIABLE,VAR=&#8217;USER&#8217;, -</p>
<p>FIELD=(TCT-HTTP-HEADER,SM_USER)</p>
<p>IF$ NOT-FOUND,THEN=NOUSER1</p>
<p>COPY$ VARIABLE-TO-SYSTEM,VAR=&#8217;USER&#8217;, -</p>
<p>FIELD=(NAME-OF,USER)</p>
<p>*</p>
<p>EXIT1 DS 0H</p>
<p>SCENARIO END</p>
<p>*</p>
<p>NOUSER1 DS 0H</p>
<p>ERROR$ 0,&#8217;SCENSITE ERROR: NO USER VARIABLE&#8217;</p>
<p>GOTO$ EXIT1</p>
<p>SCRNEND</p>
<p>END</p>
<p>This SCENARIO has to be set in the Entry Point definition for the line
being used. In our case this is the default Entry Point, CLIWHOST,
associated with the external line HTTP-CLI. The following is a snapshot
of the entry point definition:-</p>
<p><img alt="image5" src="../../../_images/image6.jpeg" /></p>
<p>The Identification Scenario field is filled in with the name of our
scenario SCENSITE. This scenario is called when the inbound call is
assigned to an entry point and before any transactions are invoked. The
scenario sets the system USER variable which will be used in the
PassTicket generation.</p>
<p><strong>TCT Considerations</strong></p>
<p>The TCT has to include the following parameters if HTTP User Headers and
PassTicket generation is required. The parameters are:-</p>
<p><strong>HTHEADR=(SM_USER),</strong> *</p>
<p>VIRSECU=YES,SECUR=(RACROUTE,RACF), *</p>
<p>RAPPL=FACILITY,RNODE=FACILITY,PRFSECU=SPVIREH, *</p>
<p><strong>PASSTCK=YES,</strong> *</p>
<p>The HTHEADR identifies the “SM_USER“ as a non standard header and one
that Virtel must process. The PASSTCK keyword enables Virtel to generate
PassTickets.</p>
<p><strong>Line Rules</strong></p>
<p>To ensure that the source proxy IP address is valid we can code some
rules and associate them with the line. In our example we have coded two
sets of rules. The first one will test the calling proxy IP address. If
that is successful the connection will continue and establish an
association with the named entry point. If the first rule fails because
the IP address doesn’t match what we expect, the second rule will be
called. This does no more than establish an entry point with a default
transaction. The default transaction will just returns an error page to
the browser. Here are the two rules that we have associated with our
Virtel line:-</p>
<p><img alt="image6" src="../../../_images/image7.jpeg" /></p>
<p>Rule 1 – C100PROX.</p>
<p><img alt="image7" src="../../../_images/image8.jpeg" /></p>
<p>If the IP address of the SSO Proxy matches the Caller DTE address we
have specified in the rule than the Entry Point CLIWHOST will be
associated with line and the transactions defined under that entry point
can be invoked. If the address match fails then the next rule will be
called. In our case this will be rule C999REJ.</p>
<p>Note. It is important that you use option 3 “STARTS WITH” when defining
the Calling DTE option.</p>
<p>Rule 2 – C999REJ.</p>
<p><img alt="image8" src="../../../_images/image9.jpeg" /></p>
<p>This rule does no more than to establish the entry point EPREJECT.
EPREJECT will have a default transaction which just returns an error
page to the caller.</p>
<p><strong>RACF Profiles related to Pass Tickets.</strong></p>
<p>As mentioned RACF needs to be set up to allow Virtel to use Pass
Tickets. The first profile is the FACILITY Class profile with the
IRR.RTICKETSERV name. The Virtel STC userid must have READ access to
this profile.</p>
<p><img alt="image9" src="../../../_images/image10.png" /></p>
<p>RDEFINE FACILITY IRR.RTICKETSERV</p>
<p>PERMIT IRR.RTICKETSERV CL(FACILITY) ID(SPVIRSTC) ACC(READ)</p>
<p>To allow Virtel to generate Pass Tickets for a particular application we
must define any entry in the PTKTDATA class. This entry has the name
IRRPTAUTH.passTicketName.* and is a Group Entry. The Virtel USERID
should have update authority to this profile.</p>
<p><img alt="image10" src="../../../_images/image11.png" /></p>
<p>RDEFINE PTKTDATA IRRPTAUTH.SPCICSH.* UACC(NONE)</p>
<p>PERMIT IRRPTAUTH.SPCICSH.* CL(PTKTDATA) ID(SPVIRSTC) ACC(UPDATE)</p>
<p>SSIGNON(KEYMASKED(998A654FEBCDA123)) UACC(NONE)</p>
<p>The name in IRRPTAUTH.passTicketName.* profile must match the name in
the Virtel Transaction definition. The PassTicket Name is the name of
the application as known to RACF for the generation of Passtickets.
<strong>This may be different to the VTAM application name.</strong></p>
<p>Finally, define a PTKTDATA profile entry that matches the Virtel
Transaction <strong>APPLICATION</strong> name. In this case it is SPCICSH. Virtel
passes this APPLNAME to RACF via a RACROUTE REQUEST=VERIFY.</p>
<p><img alt="image11" src="../../../_images/image12.png" /></p>
<p>RDEFINE PTKTDATA SPCICSH SSIGNON(KEYMASKED(998A654FEBCDA123)) +</p>
<p>UACC(NONE)</p>
<p>The key thing here is that the PassTicket name must tie up with the
generic IRRPTAUTH.SPCICSH.* entry and the VIRTEL application name must
match the descrete PTKTDATA.SPCICSH profile. They can be the same but
needn’t be!</p>
<p><strong>Common Errors</strong></p>
<p>Message VIR1502E</p>
<p><strong>Meaning</strong></p>
<p>VIRTEL does not have sufficient access rights to create or validate a
passticket allowing user userid at terminal termed to access application
applname. This message is usually preceded by message ICH408I which
shows the name of the resource to which VIRTEL must be granted access.</p>
<p><strong>Action</strong></p>
<p>Examine the SAF and RACF return codes and the RACF reason code to
determine the cause. Check that VIRTEL has access to resource
IRR.RTICKETSERV in the FACILITY class, and also to resource
IRRPTAUTH.applname.userid in the PTKTDATA class. The generic resource
IRRPTAUTH.** may be used to permit VIRTEL to generate passtickets for
all applications.</p>
<p>For an explanation of the return codes and reason codes, see z/OS
Security Server RACF Callable Services chapter 2 “R_ticketserv”. Some
common codes are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="6%" />
<col width="7%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">SAF RC</th>
<th class="head">RACF RETC</th>
<th class="head">RACF Reason</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>8</td>
<td>8</td>
<td>10</td>
<td>VIRTEL is not authorized to generate passtickets, or is not autohorized to generate passtickets for this application. See preceding ICH408I message in the log.</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>10</td>
<td>1C</td>
<td>There is no profile in the PTKTDATA class for this application or the PTKTDATA class is not active.</td>
</tr>
</tbody>
</table>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../TN201409/TN201409.html" class="btn btn-neutral float-right" title="Mainframe printing with Virtel 4.56" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../TN201406/TN201406.html" class="btn btn-neutral" title="Taking a VIRTEL terminal trace" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Syspertec. All rights reserved.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>