

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Maintaining TRSF file sets &mdash; Virtel 1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Virtel 1 documentation" href="../../../index.html"/>
        <link rel="up" title="Technical Newsletters" href="../../../newsletters.html"/>
        <link rel="prev" title="RACF Grouping Class and Virtel" href="../TN201417/TN201417.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Virtel
          

          
            
            <img src="../../../_static/logo_virtel_web.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../newsletters.html">Technical Newsletters</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../newsletters.html#id1">2014</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../TN201401/TN201401.html">Automation and MVS backups</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201402/TN201402.html">Formatting VIRTEL Line Trace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201403/TN201403.html">How to use TESTVTAM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201404/TN201404.html">VIRTEL SMF Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201405/TN201405.html">Multi Line WTO Support in VIRTEL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201406/TN201406.html">Taking a VIRTEL terminal trace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201407/TN201407.html">Pass tickets and supporting Proxy Servers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201409/TN201409.html">Mainframe printing with Virtel 4.56</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201410/TN201410.html">Taking a VTAM trace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201411/TN201411.html">Building a customized USSTAB using Virtel’s Web Access facility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201412/TN201412.html">Sharing user macros across multiple instances of Virtel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201414/TN201414.html">CICS Printing problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201415/TN201415.html">Virtel JES Writer program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201416/TN201416.html">Virtel Security. Using server and client certificates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201417/TN201417.html">RACF Grouping Class and Virtel</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Maintaining TRSF file sets</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Virtel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../newsletters.html">Technical Newsletters</a> &raquo;</li>
      
    <li>Maintaining TRSF file sets</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/manuals/newsletters/TN201419/TN201419.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="maintaining-trsf-file-sets">
<h1>Maintaining TRSF file sets<a class="headerlink" href="#maintaining-trsf-file-sets" title="Permalink to this headline">¶</a></h1>
<p>In this newsletter we discuss how to maintain TRSF file sets between
development, pre-production and production environments. A TRSF file set
consists of the TRSF files that Virtel uses. These are the distributed
SAMP and HTML VSAM files and any number of SCENARIO files that may have
been set up to support Virtel studio developers. For our scenario we
simulate a typical development / production IT infrastructure. The
development VIRTEL, SPVIR1A, is run and maintained at an IT centre
located in Paris (ZAMVS1) whilst the production VIRTEL, SPVIR2A, is
located in Zagreb (ZAMVS2). We look at how a developer can manage TRSF
directories and promotes files through to production with the use of the
Virtel ADMIN tool and the ADMINVWM scenario.</p>
<p><strong>Developers view</strong></p>
<p>Developers will be using tools like Virtel Studio and Virtel Screen
Redesigner to populate templates and scenarios into their development
TRSF file set. At some point some of these elements will to be moved
into a production environment. This can be achieved in a control and
secure way through the use of the administration and directory
management tools provide by the scenario ADMINVWM. In our example a
transitory set of TRSF files, known as the pre-production TRSF file set,
will be used between by the developers to move work from development to
production. A developer will move web elements from their developing
TRSF file set to the pre-production TRSF file set in preparation to
moving them into production. The final stage of promoting work to
production from the pre-production TRSF file set is controlled by
operations. See the section called “Operations View” for more
information on how this phase of the process is achieved.</p>
<p><strong>Defining the ADMINVWM transaction</strong></p>
<p>Before we can use the ADMINVWM administration tool we must define it to
VIRTEL within the SPVIR1A VIRTEL task. The Virtel transaction definition
to provide the ADMINVWM tool is defined as follows:-</p>
<p><a class="reference internal" href="../../../_images/image115.png"><img alt="image0" src="../../../_images/image115.png" style="width: 6.30000in; height: 4.24931in;" /></a></p>
<p>Once this has been defined to VIRTEL we can access the tool with the
following URL:-</p>
<p><a href="#id1"><span class="problematic" id="id2">*</span></a><a class="reference external" href="http://192.168.170.30:41001/ADMVWM.htm+ADMINVWM">http://192.168.170.30:41001/ADMVWM.htm+ADMINVWM</a> *</p>
<p>This will present the developer with the Administrations tool panel and
will provide administration functions from which directory management
functions can be performed.</p>
<p><a class="reference internal" href="../../../_images/image26.png"><img alt="image1" src="../../../_images/image26.png" style="width: 6.30000in; height: 4.77986in;" /></a></p>
<p>In this newsletter we are only concerned with the Directories management
function. We will not discuss any of the other administration tools.
Using the Directories management function we can copy web elements
(Scenarios, Templates, HTML files etc.) from one directory to another.
We can also delete members as well as define new directories. Note that
new directories require setting up before than can be used by this tool.
Developers can now selectively copy elements from their development TRSF
to the pre-production TRSF and give them new names. This may well be
pertinent to maintaining different releases of a web element with the
development and pre-production TRSF structure. For example the web
element #DOPSSO.MYTEST.V0.390 may become #DOPSSO.V1.S90 in production.</p>
<p>Setting up a pre-production TRSF file set means deciding on a group of
pre-production directions that will be used as intermediate files. These
files will only contain elements that are required to be promoted into
the production system. The intermediate files should be directory names
and VSAM cluster names that identify them as such. It is assumed that
the developer has already set up Virtel Studio and any relevant
development infrastructure.</p>
<p><strong>Allocating a pre-production VSAM file and allocating it to SPVIR1A</strong></p>
<p>Before using a directory in Virtel we have to allocate a VSAM TRSF file
and initialize it. The following JCL can be used:-</p>
<p>//*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-*</p>
<p>//* DEFINITION OF A VSAM TRSF FILE *</p>
<p>//*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-*</p>
<p>//* STEP 1 : DEFINITION DU FICHIER CUSTTRSF *</p>
<p>//*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-*</p>
<p>//STEP1 EXEC PGM=IDCAMS</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//SYSIN DD *</p>
<p>DELETE (SP000.SPVIR1A.SCENARIO.PROD.TRSF) CLUSTER PURGE</p>
<p>SET MAXCC = 0</p>
<p>DEFINE CLUSTER (-</p>
<p>NAME (SP000.SPVIR1A.SCENARIO.PROD.TRSF) -</p>
<p>VOL (SPT308) -</p>
<p>SHR (2) -</p>
<p>KEYS (16 0) -</p>
<p>RECSZ (100 32758) -</p>
<p>RECORDS (2500 1000)) -</p>
<p>DATA (NAME(SP000.SPVIR1A.SCENARIO.PROD.TRSF.DATA) -</p>
<p>SPANNED -</p>
<p>CISZ(4096)) -</p>
<p>INDEX (NAME(SP000.SPVIR1A.SCENARIO.PROD.TRSF.INDEX) -</p>
<p>CISZ(512))</p>
<p>//*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-*</p>
<p>//* STEP 2 : INITIALISATION DU FICHIER CUSTTRSF *</p>
<p>//*&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-*</p>
<p>//STEP2 EXEC PGM=IDCAMS</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//INIT DD DATA,DLM=AA</p>
<p>$$$$IWS.WORKREC.INW$TEMP</p>
<p>AA</p>
<p>/*</p>
<p>//BASE DD DSN=SP000.VIRT452.SAMP.TRSF,DISP=SHR</p>
<p>//TRSF DD DSN=SP000.SPVIR1A.SCENARIO.PROD.TRSF,DISP=SHR</p>
<p>//SYSIN DD *</p>
<p>REPRO INFILE(BASE) OUTFILE(TRSF)</p>
<p>/*</p>
<p>The DDNAME SCENPROD will be added to the VIRTEL started procedure to
point to this VSAM TRSF file. We also need to a VSAM definition to the
VIRTEL TCT and reassemble. Two definitions are required in the TCT. Once
this has been done VIRTEL can be restarted and the VSAM file can be
allocated to the pre-production directory.</p>
<p>……</p>
<p>PASSTCK=YES, *</p>
<p>UFILE1=(SAMPTRSF,ACBH1,0,10,01), *</p>
<p>UFILE2=(HTMLTRSF,ACBH2,0,10,01), *</p>
<p>UFILE3=(SCENTRSF,ACBH3,0,10,01), *</p>
<p><strong>UFILE4=(SCENPROD,ACBH4,0,10,01), *</strong></p>
<p>GATE=GENERAL, *</p>
<p>……</p>
<p>ACBH1 ACB AM=VSAM,DDNAME=SAMPTRSF,MACRF=(SEQ,DIR,OUT,LSR), *</p>
<p>STRNO=3</p>
<p>ACBH2 ACB AM=VSAM,DDNAME=HTMLTRSF,MACRF=(SEQ,DIR,OUT,LSR), *</p>
<p>STRNO=3</p>
<p>ACBH3 ACB AM=VSAM,DDNAME=SCENTRSF,MACRF=(SEQ,DIR,OUT,LSR), *</p>
<p>STRNO=3</p>
<p><strong>ACBH4 ACB AM=VSAM,DDNAME=SCENPROD,MACRF=(SEQ,DIR,OUT,LSR), *</strong></p>
<p><a href="#id3"><span class="problematic" id="id4">**</span></a>STRNO=3 **</p>
<p><strong>Defining the pre-production directory</strong></p>
<p>Once we have defined the VSAM file and have it allocated to VIRTEL we
can associate the VSAM file with a direct using the directory management
tool. In our example we are going to add this pre-production directory
to SPVIR1A as directory SCNP-DIR. It will have a related development
directory of SCN-DIR. When we add the directory name SCNP-DIR we
associated it with the VSAM file DDNAME SCENPROD which we have just
created and added to the VIRTEL started procedure.</p>
<p><a class="reference internal" href="../../../_images/image36.png"><img alt="image2" src="../../../_images/image36.png" style="width: 6.30000in; height: 4.02639in;" /></a></p>
<p>We have set the download attribute only as we do not want developers
inadvertently uploading to this TRSF pre-production file. We only want
to be able to copy elements from the related SCN-DIR to SCNP-DIR.</p>
<p>**
Copy members**</p>
<p>The next stage is to select members from our development directory and
to copy them to our pre-production TRSF file. Again we use the directory
management tool. In the example below we copy the .390 file #DOPSSO.390
from SCN-DIR to SCNP-DIR using the COPY sub command of the LIST
function. We provide the target directory, in this case SCNP-DIR and
give it a new name.</p>
<p><a class="reference internal" href="../../../_images/image45.png"><img alt="image3" src="../../../_images/image45.png" style="width: 6.30000in; height: 2.69722in;" /></a></p>
<p>We press the Copy tab to invoke the copy function and copy the selected
member.</p>
<p><a class="reference internal" href="../../../_images/image55.png"><img alt="image4" src="../../../_images/image55.png" style="width: 6.30000in; height: 3.08472in;" /></a></p>
<p>After the copy is complete we can list the direct to ensure that the
element has indeed been copied and with the correct name.</p>
<p><a class="reference internal" href="../../../_images/image65.png"><img alt="image5" src="../../../_images/image65.png" style="width: 6.30000in; height: 3.17222in;" /></a></p>
<p>Developers will continue to populate their pre-production TRSF files set
in preparation for migration to the production environment. The jobs
required to perform the migration to production are discussed in the
next section – Operations View.</p>
<p><strong>Batch Copies</strong></p>
<p>You can also copy a group of members using the batch copy facility of
the directory management tool. This I selected by pressing the batch
icon on the directory list page.</p>
<p><a class="reference internal" href="../../../_images/image73.png"><img alt="image6" src="../../../_images/image73.png" style="width: 6.30000in; height: 3.28264in;" /></a></p>
<p>With the Batch copy facility I can select a list of files and copy them
to another TRSF file. I select the files to be copied then click the
copy all selected icon. The first icon on the right hands</p>
<p><a class="reference internal" href="../../../_images/image83.png"><img alt="image7" src="../../../_images/image83.png" style="width: 6.30000in; height: 2.68542in;" /></a></p>
<p>After the copy has been completed I get a confirmation message.</p>
<p><a class="reference internal" href="../../../_images/image92.png"><img alt="image8" src="../../../_images/image92.png" style="width: 6.30000in; height: 2.71250in;" /></a></p>
<p>This bulk copy facility could allow developers to <em>copy-en-masse</em> the
pre-production TRSF file. Unlike the individual copy facility it
doesn’t’ provided any rename capability.</p>
<p>**
Exporting directory list**</p>
<p>The Directory list function also has an export facility whereby you can
export the list of members in the selected directory to an EXCEL
spreadsheet. This function is invoked by pressing the EXCEL export icon
in the top right corner of the list window.</p>
<p><a class="reference internal" href="../../../_images/image102.png"><img alt="image9" src="../../../_images/image102.png" style="width: 6.30000in; height: 3.64167in;" /></a></p>
<p><strong>Operations View</strong></p>
<p>The operations department have overall control in moving the developer’s
pre-production TRSF file sets and promoting them into the production
environment. The developers do not have direct access to any of the
production datasets. Another requirement is that both development and
production have an independent means of reverting back to previous TRSF
level sets.</p>
<p><a class="reference internal" href="../../../_images/image11.jpg"><img alt="image10" src="../../../_images/image11.jpg" style="width: 6.30000in; height: 3.54375in;" /></a></p>
<p>We use standard IBM JCL, software utilities and REXX to implement this
process which uses GDG file structures of unloaded TRSF files sets at
ZAMVS1 and ZAMVS2. The unloaded TRSF file sets at ZAMVS1 sets are ftp’d
to ZAMVS2 where they are restored and promoted to the production
environment under operation control. The development VIRTEL is known as
SPVIR1A in ZAMVS1 and a production VIRTEL is known as SPVIR2A in ZAMVS2.</p>
<p>**
Initial Setup**</p>
<p>The following jobs will set up the GDG structures required at both
ZAMVS1 and ZAMVS2. For ZAMVS1 we run the following JCL:-</p>
<p>//*******************************************************************/</p>
<p>//* */</p>
<p>//* DEFINE DEVELOPMENT TRSF FILESET GDG. USED BY DEVELOPERS TO SAVE */</p>
<p>//* TRSF UPDATES TO TRSF FILES - SCENARIO, HTML AND SAMP */</p>
<p>//* */</p>
<p>//* SPVIR1A IS THE DEVELOPMENT ENVIRONMENT. */</p>
<p>//* */</p>
<p>//*******************************************************************/</p>
<p>//DELETE EXEC PGM=IDCAMS</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>DELETE SP000.SPVIR1A.TRSF.GDG GDG</p>
<p>DELETE SP000.SPVIR1A.TRSF.GDG.DSCB NVSAM</p>
<p>SET MAXCC=0</p>
<p>//ALLOC1 EXEC PGM=IEFBR14</p>
<p>//FILE DD DSN=SP000.SPVIR1A.TRSF.GDG.DSCB,</p>
<p>// UNIT=3390,DISP=(NEW,CATLG),</p>
<p>// SPACE=(TRK,(0,0)),VOL=SER=SPT301,</p>
<p>// DCB=BLKSIZE=6144</p>
<p>//*</p>
<p>//ALLOC2 EXEC PGM=IDCAMS</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//SYSIN DD *</p>
<p>DEF GDG(NAME(SP000.SPVIR1A.TRSF.GDG) LIMIT(5) SCRATCH NOEMPTY)</p>
<p>/*</p>
<p>For ZAMVS2 we run the following JCL:-</p>
<p>//*******************************************************************/</p>
<p>//* */</p>
<p>//* DEFINE PRODUCTION TRSF FILESETS. USED BY OPERATIONS TO SAVE TRSF*/</p>
<p>//* UPDATES FROM DEVELOPMENT INFRASTRUCTURE. */</p>
<p>//* */</p>
<p>//* SPVIR2A IS THE PRODUCTION VIRTEL. */</p>
<p>//* */</p>
<p>//*******************************************************************/</p>
<p>//DELETE EXEC PGM=IDCAMS</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>DELETE SP000.SPVIR2A.TRSF.GDG GDG</p>
<p>DELETE SP000.SPVIR2A.TRSF.GDG.DSCB NVSAM</p>
<p>DELETE SP000.SPVIR2A.PEND.GDG NVSAM</p>
<p>SET MAXCC=0</p>
<p>//ALLOC1 EXEC PGM=IEFBR14</p>
<p>//FILE DD DSN=SP000.SPVIR2A.TRSF.GDG.DSCB,</p>
<p>// UNIT=3390,DISP=(NEW,CATLG),</p>
<p>// SPACE=(TRK,(0,0)),VOL=SER=SPT301,</p>
<p>// DCB=BLKSIZE=6144</p>
<p>//PEND DD DSN=SP000.SPVIR2A.PEND.GDG,</p>
<p>// UNIT=3390,DISP=(NEW,CATLG),</p>
<p>// SPACE=(CYL,(40,10)),VOL=SER=SPT301,</p>
<p>// DCB=BLKSIZE=6144</p>
<p>//*</p>
<p>//ALLOC2 EXEC PGM=IDCAMS</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//SYSIN DD *</p>
<p>DEF GDG(NAME(SP000.SPVIR2A.TRSF.GDG) LIMIT(5) SCRATCH NOEMPTY)</p>
<p>/*</p>
<p>These GDG files will hold the unloaded TRSF file sets. We have establish
a GDG cycle of 5 for recovery purposes. Also note that the setup job
that runs at the production centre ZAMVS2 includes a holding file. This
is used by the restore process to provide independence between
development and production centre GDGs.</p>
<p>Process overview</p>
<ol class="arabic simple">
<li>A daily job is run in ZAMVS1 to dump the current SPVIR1A TRSF files
to a GDG. This is run after the development VIRTEL SPVIR1A has been
shut down. This avoids shipping OPEN VSAM datasets.</li>
<li>After successfully dumping the relevant TRSF file set a job is
submitted, via FTP, to the production centre ZAMVS2. This job
initiates a batch FTP GET from ZAMVS2 to copy across the latest GDG
TRSF file set to a holding file – SP000.SPVIR2A.PEND.GDG. At any one
time this holding file always contains they latest TRSF file set
produced at the development centre - GDG 0. It may or may not be
promoted to production. We GET from ZAMVS2 rather than PUT from
ZAMVS1 as developers have no access to production datasets whereas
production can access development datasets.</li>
<li>As and when required, the holding file is promoted to the VIRTEL
production TRSF file set. Again a GDG structure is used to provide a
back out capability should it be required.</li>
<li>Before starting VIRTEL a control step is run. This prepares the TRSF
file set that the production VIRTEL will use. Depending on the
parameters passed to step control step in the VIRTEL JCL will dictate
which TRSF file set will be used and restore a file set if necessary.</li>
<li>In our example, the batch FTP job to get the latest development TRSF
file set is run every day but the production TRSF file set is only
promoted one a week, on a Friday. If that fails the previous
production GDG (-1) is used to restore the TRSF file set. Effectively
our production environment provides 5 weekly restore points and are
development GDG 5 daily restore points.</li>
</ol>
<p>**
The Development Process**</p>
<p><strong>TRSFMNT2</strong></p>
<p>Job TRSFMNT2 – Daily job to back up TRSF file sets at development site.
The job consists of three steps:-</p>
<p>TRSFDUMP Dump the relevant TRSF files.</p>
<p>TRSFTRS Terse the dump file and create a new GDG version.</p>
<p>FTP Send job TRSFMNT3, via FTP, to run at the production centre.</p>
<p>This is the only job that is run at the development centre. It provides
the production centre with the latest TRSF file set and also enables the
developers to keep a history TRSF development - in our example 5 days. A
restore from an older version is possible should it be required. This
GDG is independent of the production TRSF GDG file set.</p>
<p><a class="reference internal" href="../../../_images/image12.jpg"><img alt="image11" src="../../../_images/image12.jpg" style="width: 6.30000in; height: 3.54375in;" /></a></p>
<p>TRSFMNT2 Sample JCL</p>
<p>//*******************************************************************/</p>
<p>//* */</p>
<p>//* DUMP DEVELOPMENT TRSF FILESET AND INSTRUCT PRODUCTION TO PULL */</p>
<p>//* LATEST TRSF UPDATES OVER. SHOULD BE CONTROLLED THROUGH A */</p>
<p>//* BATCH SCHEDULER AND RUN WHEN DEVELOPMENT VIRTEL IS DOWN! */</p>
<p>//* */</p>
<p>//* RUN ON DEVELOPMENT TO INITIATE A GET FROM PRODUCTION. MOVE ONLY */</p>
<p>//* PRE-PRODUCTION FILES FROM DEVELOPERS ENVIRONMENT */</p>
<p>//* */</p>
<p>//*******************************************************************/</p>
<p>//TRSFDUMP EXEC PGM=ADRDSSU,REGION=0M</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//DUMPFILE DD DSN=SP000.TEMP,DISP=(,CATLG),</p>
<p>// UNIT=SYSDA,</p>
<p>// SPACE=(CYL,(40,10),RLSE)</p>
<p>DUMP DS(INCLUDE( -</p>
<p>SP000.SPVIR1A.**.PROD.TRSF -</p>
<p>) ) -</p>
<p>ADMIN TOL(ENQF) -</p>
<p>OUTDD(DUMPFILE) COMPRESS</p>
<p>//TRSFTRS EXEC PGM=TRSMAIN,PARM=PACK</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//INFILE DD DSN=SP000.TEMP,DISP=(OLD,DELETE)</p>
<p>//OUTFILE DD DSN=SP000.SPVIR1A.TRSF.GDG(+1),DISP=(,CATLG,DELETE),</p>
<p>// UNIT=SYSDA,</p>
<p>// SPACE=(CYL,(40,10),RLSE)</p>
<p>//FTP EXEC PGM=FTP,REGION=8M,PARM=&#8217;ZAMVS2 (EXIT&#8217;</p>
<p>//OUTPUT DD SYSOUT=*</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//NETRC DD *</p>
<p>MACHINE ZAMVS2 LOGIN USERID PASSWORD PASSWORD</p>
<p>//INPUT DD *</p>
<p>TYPE E</p>
<p>MODE B</p>
<p>SITE LRECL=80 BLOCKSIZE=3120 RECFM=FB</p>
<p>SITE FILETYPE=JES</p>
<p>PUT &#8216;SP000.VIRTEL1A.CNTL(TRSFMNT3)&#8217;</p>
<p>QUIT</p>
<p>/*</p>
<p><strong>TRSFMNT3</strong></p>
<p>Job TRSFMNT3 – Job submitted to production JES2 via FTP from development
centre.</p>
<p>This job consists of one step:-</p>
<p>FTP Get the latest pre-production TRSF file set GDG from ZAMVS1 and copy
to the pending file.</p>
<p>//*******************************************************************/</p>
<p>//* */</p>
<p>//* INVOKE BY DEVELOPMENT FTP JOB TRSFMNT2. THIS JOB RUNS ON THE */</p>
<p>//* PRODUCTION SYSTEM TO PULL OVER THE LATEST TRSF FILESET UPDATES. */</p>
<p>//* */</p>
<p>//* RUN ON PRODUCTION TO OBTAIN TRSF UPDATES FROM DEVELOPMENT */</p>
<p>//* */</p>
<p>//*******************************************************************/</p>
<p>//FTP EXEC PGM=FTP,REGION=8M,PARM=&#8217;ZAMVS1 (EXIT&#8217;</p>
<p>//OUTPUT DD SYSOUT=*</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//NETRC DD *</p>
<p>MACHINE ZAMVS1 LOGIN USERID PASSWORD PASSWORD</p>
<p>//INPUT DD *</p>
<p>TYPE E</p>
<p>MODE B</p>
<p>GET &#8216;SP000.SPVIR1A.TRSF.GDG(0)&#8217; &#8216;SP000.SPVIR2A.PEND.GDG&#8217; (REPLACE</p>
<p>QUIT</p>
<p>/*</p>
<p>**
TRSFREXX **</p>
<p>Step TRSFREXX – A control setup run before the startup of VIRTEL at the
production site. This job can be a part of the VIRTEL started task or
can be a separate job run prior to starting VIRTEL. It prepares the TRSF
file set that VIRTEL will use using conditional JCL.</p>
<p>The control step consists of a REXX EXEC which generates a return code
from a parameter passed. This return code controls whether a TRSF file
set is to be restored and if so which TRSF file set.</p>
<p>REXXCC REXX EXEC to set a return code based upon the symbolic GDG=</p>
<p>UPDATE Only executed if return code is 99. Calls TRSFUPDT procedure to
restore latest TRSF file set from production.</p>
<p>BACKOUT Only executed if return code is greater than 1. Calls TRSFBACK
procedure to restore a particular GDG historic TRSF file set. The GDG
number indicates which GDD level is to be restored.</p>
<p><a class="reference internal" href="../../../_images/image13.jpg"><img alt="image12" src="../../../_images/image13.jpg" style="width: 6.30000in; height: 3.54375in;" /></a></p>
<p>TRSFREXX Example JCL</p>
<p>//******************************************************************/</p>
<p>//* THIS CONTROL JOB PREPARES THE TRSF FILES FOR VIRTEL. IT IS */</p>
<p>//* CONTROLLED BY A RC SET VIA A JCL SYMBOLIC. */</p>
<p>//* */</p>
<p>//* THE SYMBOLIC GDG IS SET AS FOLLOWS:- */</p>
<p>//* */</p>
<p>//* GDG = 0. DO NOTHING. VIRTEL WILL USE THE CURRENT TRSF FILE SET */</p>
<p>//* THIS WOULD NORMALLY BE THE DEFAUL. */</p>
<p>//* */</p>
<p>//* GDG = 99 UPDATE THE TRSF FILE SET WITH THE LATEST PRE-PROD */</p>
<p>//* VERSION. THIS WOULD HAVE BEEN OBTAINED VIA AN FTP GET */</p>
<p>//* TO THE DEVELOPMENT INFRASTRUCTURE. */</p>
<p>//* */</p>
<p>//* GDG = N RESTORE THE TRSF FILE SET THE THE N&#8217;TH GDG VERSION. */</p>
<p>//* WHERE 1 = GDG(-1), 2 = (GDG(-2) ETC. */</p>
<p>//* */</p>
<p>//* */</p>
<p>//******************************************************************/</p>
<p>//LIBS JCLLIB ORDER=SP000.VIRTEL2A.CNTL</p>
<p>//TRSFREXX PROC GDG=0</p>
<p>//REXXCC EXEC PGM=IRXJCL,PARM=(&#8216;REXXCC &amp;GDG&#8217;)</p>
<p>//SYSEXEC DD DISP=SHR,DSN=SP000.VIRTEL2A.CNTL</p>
<p>//RC99 IF (RC = 99) THEN</p>
<p>//UPDATE EXEC TRSFUPDT /* UPDATE WITH LATEST */</p>
<p>//NOTRC99 ELSE</p>
<p>//RC1 IF (RC &gt; 0) THEN</p>
<p>//BACKOUT EXEC TRSFBACK,GDG=&amp;GDG /* BACK OUT TO LEVEL */</p>
<p>// ENDIF</p>
<p>// ENDIF</p>
<p>//VIRTEL EXEC VIRTEL</p>
<p>// PEND</p>
<p>//S01 EXEC TRSFREXX,GDG=0 /* NO TRSF CHANGE */</p>
<p><strong>Procedure TRSFUPDT</strong></p>
<p>This procedure consists of three steps. It promotes that latest
development TRSF file set into the production environment.</p>
<p>TRSCOPY Unterse the holding file and create a new production GDG TRSF
file set level. This contains the latest copy of the development TRSF
file set.</p>
<p>DELETE Delete the current VSAM TRSF files</p>
<p>TRSFDUMP Restore from the new GDG the TRSF file set renaming the VSAM
files to production dataset names.</p>
<p>//TRSFUPDT PROC</p>
<p>//********************************************************************/</p>
<p>//* */</p>
<p>//* PROCEDURE TO RESTORE THE LATEST PENDING GDG FILE AS OBTAINED BY */</p>
<p>//* FTP JOB. */</p>
<p>//* */</p>
<p>//********************************************************************/</p>
<p>//TRSFCOPY EXEC PGM=TRSMAIN,PARM=UNPACK</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//INFILE DD DSN=SP000.SPVIR2A.PEND.GDG,DISP=SHR</p>
<p>//OUTFILE DD DSN=SP000.SPVIR2A.TRSF.GDG(+1),DISP=(,CATLG,DELETE),</p>
<p>// UNIT=SYSDA,VOL=SER=SPT309,</p>
<p>// SPACE=(CYL,(40,10),RLSE)</p>
<p>//DELETE EXEC PGM=IDCAMS,COND=(0,NE,TRSFCOPY)</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//SYSIN DD DSN=SP000.VIRTEL2A.CNTL(TRSFDEL),DISP=SHR</p>
<p>//TRSFREST EXEC PGM=ADRDSSU,REGION=0M,</p>
<p>// COND=((0,NE,TRSFCOPY),(0,NE,DELETE))</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//TRSFFILE DD DSN=SP000.SPVIR2A.TRSF.GDG(+1),DISP=(SHR,KEEP,DELETE)</p>
<p>//DISK DD UNIT=SYSDA,VOL=SER=SPT309,DISP=SHR</p>
<p>//SYSIN DD DSN=SP000.VIRTEL2A.CNTL(TRSFREST),DISP=SHR</p>
<p>// PEND</p>
<p><strong>Procedure TRSFBACK</strong></p>
<p>This procedure restores the TRSF file set from an older production GDG
backup.</p>
<p>DELBACK Delete the current VSAM TRSF files</p>
<p>TRSFREST Restore from an older GDG the TRSF file set, renaming the VSAM
files to production dataset names.</p>
<p>//TRSFBACK PROC GDG=</p>
<p>//***************************************************************</p>
<p>//* *</p>
<p>//* PROCEDURE TO RESTORE TRSF FILES FROM A PREVIOUS GDG LEVEL *</p>
<p>//* *</p>
<p>//***************************************************************</p>
<p>//DELBACK EXEC PGM=IDCAMS</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//SYSIN DD DSN=SP000.VIRTEL2A.CNTL(TRSFDEL),DISP=SHR</p>
<p>//TRSFREST EXEC PGM=ADRDSSU,REGION=0M,</p>
<p>// COND=(0,NE,DELBACK)</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//TRSFFILE DD DSN=SP000.SPVIR2A.TRSF.GDG(-&amp;GDG),DISP=SHR</p>
<p>//DISK DD UNIT=SYSDA,VOL=SER=SPT309,DISP=SHR</p>
<p>//SYSIN DD DSN=SP000.VIRTEL2A.CNTL(TRSFREST),DISP=SHR</p>
<p>// PEND</p>
<p><strong>Rexx Procedure REXXCC</strong></p>
<p>/* REXX
********************************************************/</p>
<p>/* A little REXX EXEC to return a RC as set by a PARM value. */</p>
<p>/***************************************************************/</p>
<p>arg rc</p>
<p>if rc = &#8216;&#8217; then return 0</p>
<p>return rc</p>
<p><strong>Control Statements TRSFREST</strong></p>
<p>RESTORE DS(INCLUDE( -</p>
<p>SP000.SPVIR1A.**.PROD.TRSF -</p>
<p>) ) -</p>
<p>RENAMEU(SP000.SPVIR1A.**,SP000.SPVIR2A.**) -</p>
<p>ADMIN TOL(ENQF) -</p>
<p>OUTDD(DISK) INDD(TRSFFILE)</p>
<p><strong>Control Statements TRSFDEL</strong></p>
<p>DELETE SP000.SPVIR2A.SCENARIO.PROD.TRSF</p>
<p>SET MAXCC=0</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../TN201417/TN201417.html" class="btn btn-neutral" title="RACF Grouping Class and Virtel" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Syspertec. All rights reserved.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>