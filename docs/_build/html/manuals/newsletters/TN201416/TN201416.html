

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Virtel Security. Using server and client certificates &mdash; Virtel 7 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Virtel 7 documentation" href="../../../index.html"/>
        <link rel="up" title="Technical Newsletters" href="../../../newsletters.html"/>
        <link rel="next" title="RACF Grouping Class and Virtel" href="../TN201417/TN201417.html"/>
        <link rel="prev" title="Virtel JES Writer program" href="../TN201415/TN201415.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Virtel
          

          
            
            <img src="../../../_static/logo_virtel_web.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                4.57
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../virtel.html">Virtel Manuals</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../newsletters.html">Technical Newsletters</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../newsletters.html#id1">2014</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../TN201406/TN201406.html">Taking a VIRTEL terminal trace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201407/TN201407.html">Pass tickets and supporting Proxy Servers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201409/TN201409.html">Mainframe printing with Virtel 4.56</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201410/TN201410.html">Taking a VTAM trace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201411/TN201411.html">Building a customized USSTAB using Virtel’s Web Access facility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201412/TN201412.html">Sharing user macros across multiple instances of Virtel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201413/TN201413.html">Overview of a Virtel Session</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201414/TN201414.html">CICS Printing problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201415/TN201415.html">Virtel JES Writer program</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Virtel Security. Using server and client certificates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201417/TN201417.html">RACF Grouping Class and Virtel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201419/TN201419.html">Maintaining TRSF file sets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id2">2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id3">2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id4">2017</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../howto.html">Miscellaneous</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Virtel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../newsletters.html">Technical Newsletters</a> &raquo;</li>
        
      <li>Virtel Security. Using server and client certificates</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/manuals/newsletters/TN201416/TN201416.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="virtel-security-using-server-and-client-certificates">
<span id="tn201416"></span><h1>Virtel Security. Using server and client certificates<a class="headerlink" href="#virtel-security-using-server-and-client-certificates" title="Permalink to this headline">¶</a></h1>
<p>In this newsletter we look at setting up Virtel to work with client and
user certificates and to effectively remove the need for a user to
provide a user id and password. This is equivalent to the Express Logon
Feature (ELF) provided by Host on Demand and other telnet clients.</p>
<p>First, let’s review what is going on behind the scenes with certificate
authentication and X.509 certificate validation within TLS/SSL. The
guiding principle here is that Public Key Infrastructure (PKI) requires
that data encrypted with a public key can only be decrypted with a
private key and data encrypted with a private key can only be decrypted
with a public key. The secure session (https) that runs between the
browser and Virtel uses the Application Transparent Transport Layer
Security feature of z/OS Communications Server, also known as AT-TLS.
AT-TLS allows socket applications to access encrypted sessions by
invoking Secure Socket Layer (SSL) within the transport layer of the
TCP/IP stack. A policy agent (PAGENT) is used to configure AT-TLS using
parameter statements which will determine which sessions are to use
AT-TLS.</p>
<p>AT_TLS inserts itself in the connection between the application and
browser. This means that the application will send and receive clear
text over the socket interface, but data over the network is encrypted
by system SSL. System SSL has three supported protocol levels:</p>
<p>TLSv1</p>
<p>SSLv2</p>
<p>SSLv3</p>
<p>In this configuration we will be using SSLv3.</p>
<p>The server / client process, which in Virtel’s case is the Virtel started task (server) and the browser (client), implements the following SSL protocol or handshake during the “hello” phase of establishing a secure session:</p>
<ol class="arabic simple">
<li>The Client contacts the Server with “Hello” message:
<em>Incorporates a list of supported cipher suites and a random byte string.</em></li>
<li>The Server sends “Hello” message back:
<em>Incorporates selected cipher suite from client list, Session ID, random byte string, servers digital certificate and optional client certificate request.</em></li>
<li>Server authentication is performed by the Client.</li>
<li>Client responds to server:
<em>Incorporates a random byte string that is used to compute a secret key for subsequent messages. The random byte string is encrypted with the server’s public key. Optionally sends client’s digital certificate or “no digital certificate’ alert. This may be rejected by server if a client certificate is required.</em></li>
<li>Client authentication is performed by the Server.</li>
<li>Client sends “Finished” message encrypted with secret key.</li>
<li>Server sends “Finished” message encrypted with secret key.</li>
<li>An encryption algorithm and secret key is chosen to encrypt / decrypt data further data transmission.</li>
</ol>
<p>The purpose of the authentication is to ensure that the server/client are in fact who they say they are. This is to ensure that they server/client private and public keys haven’t been stolen and are purporting to be an entity that they aren’t and thereby compromising security. Authentication uses X.509 digital certificates. Further details of this handshake and the certificate exchange can be found in Appendix B. TLS/SSL Security z/OS Communications Server: IP
Configuration Guide.</p>
<p><strong>Certificate</strong></p>
<p>What’s in a X.509 certificate?</p>
<p>Amongst other things it includes the Distinguished Name of the Server
(DNS), the public key of the Server, Distinguished Name of the Server
organization issuing the certificate and the issuer’s signature. If we
look at a certificate held with RACF we can see this information.
Certificates are identified by a combination of LABEL, USERID or
Certification Authority (CA).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">READY</span>
<span class="n">RACDCERT</span> <span class="n">ID</span><span class="p">(</span><span class="n">SPVIRSTC</span><span class="p">)</span> <span class="n">LIST</span><span class="p">(</span><span class="n">LABEL</span><span class="p">(</span><span class="s1">&#39;VIRTEL SSL DEMO&#39;</span><span class="p">))</span>

<span class="n">Digital</span> <span class="n">certificate</span> <span class="n">information</span> <span class="k">for</span> <span class="n">user</span> <span class="n">SPVIRSTC</span><span class="p">:</span>

        <span class="n">Label</span><span class="p">:</span> <span class="n">VIRTEL</span> <span class="n">SSL</span> <span class="n">DEMO</span>
        <span class="n">Certificate</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">2</span><span class="n">Qji1</span><span class="o">+</span><span class="n">XJ2eLjw</span><span class="o">+</span><span class="n">XJ2ePF00Di4tNAxMXU1kBA</span>
        <span class="n">Status</span><span class="p">:</span> <span class="n">TRUST</span>
        <span class="n">Start</span> <span class="n">Date</span><span class="p">:</span> <span class="mi">2014</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">08</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
        <span class="n">End</span> <span class="n">Date</span><span class="p">:</span> <span class="mi">2015</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">08</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">59</span>
        <span class="n">Serial</span> <span class="n">Number</span><span class="p">:</span>
                <span class="o">&gt;</span><span class="mi">05</span><span class="o">&lt;</span>
        <span class="n">Issuer</span><span class="s1">&#39;s Name:</span>
                <span class="o">&gt;</span><span class="n">CN</span><span class="o">=</span><span class="n">z</span><span class="o">/</span><span class="n">OS</span> <span class="n">Security</span> <span class="n">Server</span><span class="o">.</span><span class="n">O</span><span class="o">=</span><span class="n">SYSPERTEC</span><span class="o">.</span><span class="n">C</span><span class="o">=</span><span class="n">FR</span><span class="o">&lt;</span>
        <span class="n">Subject</span><span class="s1">&#39;s Name:</span>
                <span class="o">&gt;</span><span class="n">CN</span><span class="o">=</span><span class="n">RECETTE</span> <span class="n">VIRTEL</span><span class="o">.</span><span class="n">T</span><span class="o">=</span><span class="n">VIRTEL</span> <span class="n">Web</span> <span class="n">Access</span><span class="o">.</span><span class="n">O</span><span class="o">=</span><span class="n">SYSPERTEC</span><span class="o">.</span><span class="n">C</span><span class="o">=</span><span class="n">FR</span><span class="o">&lt;</span>

        <span class="n">Key</span> <span class="n">Usage</span><span class="p">:</span> <span class="n">HANDSHAKE</span><span class="p">,</span> <span class="n">DATAENCRYPT</span>
        <span class="n">Key</span> <span class="n">Type</span><span class="p">:</span> <span class="n">RSA</span>
        <span class="n">Key</span> <span class="n">Size</span><span class="p">:</span> <span class="mi">1024</span>
        <span class="n">Private</span> <span class="n">Key</span><span class="p">:</span> <span class="n">YES</span>
        <span class="n">Ring</span> <span class="n">Associations</span><span class="p">:</span>
                <span class="n">Ring</span> <span class="n">Owner</span><span class="p">:</span> <span class="n">SPVIRSTC</span>
                <span class="n">Ring</span><span class="p">:</span>
                        <span class="o">&gt;</span><span class="n">VIRTRING</span><span class="o">&lt;</span>
</pre></div>
</div>
<p>Similar details can be found in the browser settings. For example here
is what Chrome displays in the HTTPS/SSL certificate database.</p>
<p><img alt="image0" src="../../../_images/image113.png" /></p>
<p><strong>Types of certificates.</strong></p>
<p>Client certificate</p>
<p>Server certificate</p>
<p>Well-known Certificate Authority (CA) Signing certificate</p>
<p>RACF signing certificate</p>
<p>In this configuration we will be using self-signed server and client
certificates. In most installation you would use server and client
certificates signed by a well-known CA. These well-known CA certificates
are normally available in the RACF and browser key data bases.</p>
<p><strong>Configuring the certificates</strong></p>
<p>The first step is to create the necessary certificates. We require a
server certificate, a RACF signing certificate and a user certificate.</p>
<p>In the Virtel SAMPLIB there is a member called SSLSETUP. This will
initialize the SSL environment and create the RACF signing certificate.
Some of the steps may or may not be relevant so you will need to
customize SSLSETUP accordingly. For example, you might already be
running the PAGENT started task and have RACF definitions in place to
support the required SSL access.</p>
<p>The following is the certificate generation statement for the RACF
signing certificate.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">DCERTCA</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">IKJEFT01</span>
<span class="o">//</span><span class="n">SYSTSPRT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
<span class="o">//</span><span class="n">SYSTSIN</span> <span class="n">DD</span> <span class="o">*</span>
<span class="o">/*-----------------------------------------------------------------*/</span>
<span class="o">/*</span> <span class="n">Delete</span> <span class="n">previous</span> <span class="n">signing</span> <span class="n">certificate</span> <span class="o">*/</span>
<span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="n">RACDCERT</span> <span class="n">CERTAUTH</span> <span class="o">+</span>
 <span class="n">DELETE</span><span class="p">(</span><span class="n">LABEL</span><span class="p">(</span><span class="s1">&#39;z/OS signing certificate&#39;</span><span class="p">))</span>
<span class="o">//*-------------------------------------------------------------------*</span>
<span class="o">//*</span> <span class="n">CCERTCA</span> <span class="p">:</span> <span class="n">CREATE</span> <span class="n">SIGNING</span> <span class="n">CERTIFICATE</span> <span class="o">*</span>
<span class="o">//*-------------------------------------------------------------------*</span>
<span class="o">//</span><span class="n">CCERTCA</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">IKJEFT1A</span>
<span class="o">//</span><span class="n">SYSTSPRT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
<span class="o">//</span><span class="n">SYSTSIN</span> <span class="n">DD</span> <span class="o">*</span>
<span class="o">/*-----------------------------------------------------------------*/</span>
<span class="o">/*</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">signing</span> <span class="n">certificate</span> <span class="o">*/</span>
<span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="n">RACDCERT</span> <span class="n">CERTAUTH</span> <span class="o">+</span>
         <span class="n">GENCERT</span> <span class="o">+</span>
         <span class="n">WITHLABEL</span><span class="p">(</span><span class="s1">&#39;z/OS signing certificate&#39;</span><span class="p">)</span> <span class="o">+</span>
         <span class="n">SUBJECTSDN</span><span class="p">(</span> <span class="o">+</span>
                 <span class="n">CN</span><span class="p">(</span><span class="s1">&#39;z/OS Security Server&#39;</span><span class="p">)</span> <span class="o">+</span>
                 <span class="n">O</span><span class="p">(</span><span class="s1">&#39;SYSPERTEC&#39;</span><span class="p">)</span> <span class="o">+</span>
                 <span class="n">C</span><span class="p">(</span><span class="s1">&#39;FR&#39;</span><span class="p">))</span> <span class="o">+</span>
         <span class="n">KEYUSAGE</span><span class="p">(</span><span class="n">CERTSIGN</span><span class="p">)</span> <span class="n">SIZE</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span> <span class="o">+</span>
         <span class="n">NOTAFTER</span><span class="p">(</span><span class="n">DATE</span><span class="p">(</span><span class="mi">2026</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span><span class="p">))</span>
</pre></div>
</div>
<p>If we list the certificate after we have created it will get the
following:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">READY</span>

<span class="n">RACDCERT</span> <span class="n">CERTAUTH</span> <span class="n">LIST</span><span class="p">(</span><span class="n">LABEL</span><span class="p">(</span><span class="s1">&#39;z/OS signing certificate&#39;</span><span class="p">))</span>

<span class="n">Digital</span> <span class="n">certificate</span> <span class="n">information</span> <span class="k">for</span> <span class="n">CERTAUTH</span><span class="p">:</span>

        <span class="n">Label</span><span class="p">:</span> <span class="n">z</span><span class="o">/</span><span class="n">OS</span> <span class="n">signing</span> <span class="n">certificate</span>
        <span class="n">Certificate</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">2</span><span class="n">QiJmZmDhZmjgalh1uJAoomHlYmVh0CDhZmjiYaJg4GjhUBA</span>
        <span class="n">Status</span><span class="p">:</span> <span class="n">TRUST</span>
        <span class="n">Start</span> <span class="n">Date</span><span class="p">:</span> <span class="mi">2013</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
        <span class="n">End</span> <span class="n">Date</span><span class="p">:</span> <span class="mi">2026</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="mi">30</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">59</span>
        <span class="n">Serial</span> <span class="n">Number</span><span class="p">:</span>
                <span class="o">&gt;</span><span class="mi">00</span><span class="o">&lt;</span>
        <span class="n">Issuer</span><span class="s1">&#39;s Name:</span>
                <span class="o">&gt;</span><span class="n">CN</span><span class="o">=</span><span class="n">z</span><span class="o">/</span><span class="n">OS</span> <span class="n">Security</span> <span class="n">Server</span><span class="o">.</span><span class="n">O</span><span class="o">=</span><span class="n">SYSPERTEC</span><span class="o">.</span><span class="n">C</span><span class="o">=</span><span class="n">FR</span><span class="o">&lt;</span>
        <span class="n">Subject</span><span class="s1">&#39;s Name:</span>
                <span class="o">&gt;</span><span class="n">CN</span><span class="o">=</span><span class="n">z</span><span class="o">/</span><span class="n">OS</span> <span class="n">Security</span> <span class="n">Server</span><span class="o">.</span><span class="n">O</span><span class="o">=</span><span class="n">SYSPERTEC</span><span class="o">.</span><span class="n">C</span><span class="o">=</span><span class="n">FR</span><span class="o">&lt;</span>
        <span class="n">Key</span> <span class="n">Usage</span><span class="p">:</span> <span class="o">**</span><span class="n">CERTSIGN</span><span class="o">**</span>
        <span class="n">Key</span> <span class="n">Type</span><span class="p">:</span> <span class="n">RSA</span>
        <span class="n">Key</span> <span class="n">Size</span><span class="p">:</span> <span class="mi">1024</span>
        <span class="n">Private</span> <span class="n">Key</span><span class="p">:</span> <span class="n">YES</span>
        <span class="n">Ring</span> <span class="n">Associations</span><span class="p">:</span>
                <span class="n">Ring</span> <span class="n">Owner</span><span class="p">:</span> <span class="n">SPVIRSTC</span>
                <span class="n">Ring</span><span class="p">:</span>
                        <span class="o">&gt;</span><span class="n">VIRTRING</span><span class="o">&lt;</span>
</pre></div>
</div>
<p>The key usage identifies this certificate as a signing certificate. This
certificate will be used to sign other certificates that we generate.</p>
<p>Next is the server certificate. Again we use RACF to generate the
certificate and use the RACF signing certificate to “sign” it. The
following extract is from the Virtel SAMPLIB member SSLUCERT.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">CCERTIF</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">IKJEFT1A</span>
<span class="o">//</span><span class="n">SYSTSPRT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
<span class="o">//</span><span class="n">SYSTSIN</span> <span class="n">DD</span> <span class="o">*</span>
<span class="o">/*-----------------------------------------------------------------*/</span>
<span class="o">/*</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">digital</span> <span class="n">certificate</span> <span class="o">*/</span>
<span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="n">RACDCERT</span> <span class="n">ID</span><span class="p">(</span><span class="n">SPVIRSTC</span><span class="p">)</span> <span class="o">/*</span> <span class="n">VIRTEL</span> <span class="n">userid</span> <span class="o">*/</span> <span class="o">+</span>
                <span class="n">GENCERT</span> <span class="o">+</span>
                <span class="n">WITHLABEL</span><span class="p">(</span><span class="s1">&#39;VIRTEL SSL DEMO&#39;</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">SIGNWITH</span><span class="p">(</span><span class="n">CERTAUTH</span> <span class="n">LABEL</span><span class="p">(</span><span class="s1">&#39;z/OS signing certificate&#39;</span><span class="p">))</span> <span class="o">+</span>
                <span class="n">SUBJECTSDN</span><span class="p">(</span> <span class="o">+</span>
                        <span class="n">CN</span><span class="p">(</span><span class="s1">&#39;RECETTE VIRTEL&#39;</span><span class="p">)</span> <span class="o">+</span>
                        <span class="n">T</span><span class="p">(</span><span class="s1">&#39;VIRTEL Web Access&#39;</span><span class="p">)</span> <span class="o">+</span>
                        <span class="n">O</span><span class="p">(</span><span class="s1">&#39;SYSPERTEC&#39;</span><span class="p">)</span> <span class="o">+</span>
                        <span class="n">C</span><span class="p">(</span><span class="s1">&#39;FR&#39;</span><span class="p">))</span> <span class="o">+</span>
                <span class="n">KEYUSAGE</span><span class="p">(</span><span class="n">HANDSHAKE</span> <span class="n">DATAENCRYPT</span><span class="p">)</span> <span class="n">SIZE</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</pre></div>
</div>
<p>Note how we identify the signing certificate with the SIGNWITH parameter
using the same label information that we used when defining the RACF
signing certificate.</p>
<p><strong>Key rings</strong></p>
<p>Having generated two of our certificates we now need a place to keep
them. We place the certificates on a key ring and associate the key ring
with the VIRTEL server RACF user id (in our case SPVIRSTC). The member
SSLSETUP has some RACF commands to perform the key ring generation. Here
is an extract:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/*-----------------------------------------------------------------*/</span>
<span class="o">/*</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">keyring</span> <span class="o">*/</span>
<span class="o">/*-----------------------------------------------------------------*/</span>
<span class="n">RACDCERT</span> <span class="n">ID</span><span class="p">(</span><span class="n">SPVIRSTC</span><span class="p">)</span> <span class="o">/*</span> <span class="n">VIRTEL</span> <span class="n">userid</span> <span class="o">*/</span> <span class="o">+</span>
                <span class="n">ADDRING</span><span class="p">(</span><span class="n">VIRTRING</span><span class="p">)</span>
<span class="o">/*-----------------------------------------------------------------*/</span>
<span class="o">/*</span> <span class="n">Add</span> <span class="n">the</span> <span class="n">certificate</span> <span class="n">to</span> <span class="n">the</span> <span class="n">keyring</span> <span class="o">*/</span>
<span class="o">/*-----------------------------------------------------------------*/</span>
<span class="n">RACDCERT</span> <span class="n">ID</span><span class="p">(</span><span class="n">SPVIRSTC</span><span class="p">)</span> <span class="o">/*</span> <span class="n">VIRTEL</span> <span class="n">userid</span> <span class="o">*/</span> <span class="o">+</span>
                <span class="n">CONNECT</span><span class="p">(</span> <span class="o">+</span>
                <span class="n">ID</span><span class="p">(</span><span class="n">SPVIRSTC</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">LABEL</span><span class="p">(</span><span class="s1">&#39;VIRTEL SSL DEMO&#39;</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">RING</span><span class="p">(</span><span class="n">VIRTRING</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">DEFAULT</span><span class="p">)</span>
</pre></div>
</div>
<p>Again it is the label that identifies the key(certificate) that we want
to add to the key ring owned by user SPVIRSTC.</p>
<p><strong>User Certificate</strong></p>
<p>The next step is to create a user certificate which we will export and
import into our browser’s key data base. In the Virtel SAMPLIB member
SSLUCERT performs the task of creating the user certificate and creating
an “exportable” file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">DCERTIF</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">IKJEFT01</span>
<span class="o">//</span><span class="n">SYSTSPRT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
<span class="o">//</span><span class="n">SYSTSIN</span> <span class="n">DD</span> <span class="o">*</span>
 <span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="o">/*</span> <span class="n">Delete</span> <span class="n">previous</span> <span class="n">digital</span> <span class="n">certificate</span> <span class="o">*/</span>
 <span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="n">RACDCERT</span> <span class="n">ID</span><span class="p">(</span><span class="n">SPTHOLT</span><span class="p">)</span> <span class="o">/*</span> <span class="n">client</span> <span class="n">userid</span> <span class="o">*/</span> <span class="o">+</span>
                <span class="n">DELETE</span><span class="p">(</span><span class="n">LABEL</span><span class="p">(</span><span class="s1">&#39;SSL client certificate&#39;</span><span class="p">))</span>
<span class="o">//*-------------------------------------------------------------------*</span>
<span class="o">//*</span> <span class="n">UCERTIF</span> <span class="p">:</span> <span class="n">CREATE</span> <span class="n">DIGITAL</span> <span class="n">CERTIFICATE</span> <span class="n">FOR</span> <span class="n">USER</span> <span class="o">*</span>
<span class="o">//*-------------------------------------------------------------------*</span>
<span class="o">//</span><span class="n">UCERTIF</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">IKJEFT1A</span>
<span class="o">//</span><span class="n">SYSTSPRT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
<span class="o">//</span><span class="n">SYSTSIN</span> <span class="n">DD</span> <span class="o">*</span>
 <span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="o">/*</span> <span class="n">Create</span> <span class="n">a</span> <span class="n">digital</span> <span class="n">certificate</span> <span class="o">*/</span>
 <span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="n">RACDCERT</span> <span class="n">ID</span><span class="p">(</span><span class="n">SPTHOLT</span><span class="p">)</span> <span class="o">/*</span> <span class="n">client</span> <span class="n">userid</span> <span class="o">*/</span> <span class="o">+</span>
                <span class="n">GENCERT</span> <span class="o">+</span>
                <span class="n">WITHLABEL</span><span class="p">(</span><span class="s1">&#39;SSL client certificate&#39;</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">SIGNWITH</span><span class="p">(</span><span class="n">CERTAUTH</span> <span class="n">LABEL</span><span class="p">(</span><span class="s1">&#39;z/OS signing certificate&#39;</span><span class="p">))</span> <span class="o">+</span>
                <span class="n">SUBJECTSDN</span><span class="p">(</span> <span class="o">+</span>
                        <span class="n">CN</span><span class="p">(</span><span class="s1">&#39;Ed Holt&#39;</span><span class="p">)</span> <span class="o">/*</span> <span class="n">client</span> <span class="n">name</span> <span class="o">*/</span> <span class="o">+</span>
                        <span class="n">O</span><span class="p">(</span><span class="s1">&#39;Syspertec Communication&#39;</span><span class="p">)</span> <span class="o">/*</span> <span class="n">company</span> <span class="n">name</span> <span class="o">*/</span> <span class="o">+</span>
                        <span class="n">C</span><span class="p">(</span><span class="s1">&#39;France&#39;</span><span class="p">))</span> <span class="o">/*</span> <span class="n">country</span> <span class="o">*/</span> <span class="o">+</span>
                <span class="n">KEYUSAGE</span><span class="p">(</span><span class="n">HANDSHAKE</span><span class="p">)</span> <span class="n">SIZE</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
 <span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="o">/*</span> <span class="n">Export</span> <span class="n">the</span> <span class="n">digital</span> <span class="n">certificate</span> <span class="ow">and</span> <span class="n">private</span> <span class="n">key</span> <span class="o">*/</span>
 <span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="n">RACDCERT</span> <span class="n">ID</span><span class="p">(</span><span class="n">SPTHOLT</span><span class="p">)</span> <span class="o">/*</span> <span class="n">client</span> <span class="n">userid</span> <span class="o">*/</span> <span class="o">+</span>
                <span class="n">EXPORT</span><span class="p">(</span><span class="n">LABEL</span><span class="p">(</span><span class="s1">&#39;SSL client certificate&#39;</span><span class="p">))</span> <span class="o">+</span>
                <span class="n">FORMAT</span><span class="p">(</span><span class="n">PKCS12DER</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">DSN</span><span class="p">(</span><span class="n">SPTHOLT</span><span class="o">.</span><span class="n">P12</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">PASSWORD</span><span class="p">(</span><span class="s1">&#39;azj77sdmlizczxerghgbiadbbdbxnbsnbxiazb&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Again we sign the certificate with our RACF signing certificate. The
user certificate is also exported to a flat file – SPTHOLT.P12 in our
example (you can use your own naming conventions). This file must be
downloaded to the client workstation in binary mode and imported into
the browser’s key data base.</p>
<p>Note that the exported certificate is associated with a password. This
password will be required when importing the certificate on the client
workstation.</p>
<p>The final thing to do is to add the user certificate and the signing
certificate to the key ring associated with the Virtel server task user
id.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//*-------------------------------------------------------------------*</span>
<span class="o">//*</span> <span class="n">Associate</span> <span class="n">certificate</span> <span class="k">with</span> <span class="n">user</span> <span class="nb">id</span> <span class="o">*</span>
<span class="o">//*-------------------------------------------------------------------*</span>
<span class="o">//</span><span class="n">UCERTIF</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">IKJEFT1A</span>
<span class="o">//</span><span class="n">SYSTSPRT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
<span class="o">//</span><span class="n">SYSTSIN</span> <span class="n">DD</span> <span class="o">*</span>
 <span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="o">/*</span> <span class="n">Add</span> <span class="n">certificate</span> <span class="n">to</span> <span class="n">Server</span> <span class="n">ring</span> <span class="o">*/</span>
 <span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="n">RACDCERT</span> <span class="n">ID</span><span class="p">(</span><span class="n">SPVIRSTC</span><span class="p">)</span> <span class="o">/*</span> <span class="n">client</span> <span class="n">userid</span> <span class="o">*/</span> <span class="o">+</span>
                <span class="n">CONNECT</span> <span class="p">(</span><span class="n">CERTAUTH</span> <span class="o">+</span>
                <span class="n">LABEL</span><span class="p">(</span><span class="s1">&#39;z/OS signing certificate&#39;</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">RING</span><span class="p">(</span><span class="n">VIRTRING</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">USAGE</span><span class="p">(</span><span class="n">CERTAUTH</span><span class="p">))</span>
 <span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="o">/*</span> <span class="n">Add</span> <span class="n">certificate</span> <span class="n">to</span> <span class="n">Server</span> <span class="n">ring</span> <span class="o">*/</span>
 <span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="n">RACDCERT</span> <span class="n">ID</span><span class="p">(</span><span class="n">SPVIRSTC</span><span class="p">)</span> <span class="o">/*</span> <span class="n">client</span> <span class="n">userid</span> <span class="o">*/</span> <span class="o">+</span>
                <span class="n">CONNECT</span> <span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">SPTHOLT</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">LABEL</span><span class="p">(</span><span class="s1">&#39;SSL client certificate&#39;</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">RING</span><span class="p">(</span><span class="n">VIRTRING</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">USAGE</span><span class="p">(</span><span class="n">CERTAUTH</span><span class="p">))</span>
 <span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="o">/*</span>     <span class="n">Refresh</span> <span class="n">the</span> <span class="n">RACF</span> <span class="n">profiles</span> <span class="o">*/</span>
 <span class="o">/*-----------------------------------------------------------------*/</span>
 <span class="n">SETROPTS</span> <span class="n">RACLIST</span><span class="p">(</span><span class="n">DIGTRING</span><span class="p">)</span> <span class="n">REFRESH</span>
 <span class="n">SETROPTS</span> <span class="n">RACLIST</span><span class="p">(</span><span class="n">DIGTCERT</span><span class="p">)</span> <span class="n">REFRESH</span>
</pre></div>
</div>
<p>The “CONNECT CERTAUTH” tells RACF that this is a signing CA certificate
and the “CONNECT ID(SPTHOLT) indicates that the certificate labelled
‘SSL client certificate’ is associated with USERID SPTHOLT. This is how
Virtel obtains the USERID. Also, note that we refresh the RACF profiles
related to certificates and key rings.</p>
<p>If we list our key ring for user SPVIRSTC we should have three
certificates.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">READY</span>

<span class="n">RACDCERT</span> <span class="n">ID</span><span class="p">(</span><span class="n">SPVIRSTC</span><span class="p">)</span> <span class="n">LISTRING</span><span class="p">(</span><span class="n">VIRTRING</span><span class="p">)</span>

<span class="n">Digital</span> <span class="n">ring</span> <span class="n">information</span> <span class="k">for</span> <span class="n">user</span> <span class="n">SPVIRSTC</span><span class="p">:</span>

        <span class="n">Ring</span><span class="p">:</span>
                <span class="o">&gt;</span><span class="n">VIRTRING</span><span class="o">&lt;</span>
        <span class="n">Certificate</span> <span class="n">Label</span> <span class="n">Name</span> <span class="n">Cert</span> <span class="n">Owner</span> <span class="n">USAGE</span> <span class="n">DEFAULT</span>
        <span class="o">--------------------------------</span> <span class="o">------------</span> <span class="o">--------</span> <span class="o">-------</span>
        <span class="n">VIRTEL</span> <span class="n">SSL</span> <span class="n">DEMO</span> <span class="n">ID</span><span class="p">(</span><span class="n">SPVIRSTC</span><span class="p">)</span> <span class="n">PERSONAL</span> <span class="n">YES</span>
        <span class="n">z</span><span class="o">/</span><span class="n">OS</span> <span class="n">signing</span> <span class="n">certificate</span> <span class="n">CERTAUTH</span> <span class="n">CERTAUTH</span> <span class="n">NO</span>
        <span class="n">SSL</span> <span class="n">client</span> <span class="n">certificate</span> <span class="n">ID</span><span class="p">(</span><span class="n">SPTHOLT</span><span class="p">)</span> <span class="n">CERTAUTH</span> <span class="n">NO</span>
</pre></div>
</div>
<p><strong>Importing the certificate on the client work station.</strong></p>
<p>To import the user certificate into the client workstation the P12 file
must be downloaded in binary and then the certificate import wizard is
run to import the certificate.</p>
<p><img alt="image1" src="../../../_images/image212.png" /></p>
<p>After importing the following panel is displayed:-</p>
<p><img alt="image2" src="../../../_images/image39.png" /></p>
<p>At this stage we have completed our certificate generation. Through the
use of the certificates we will be able to initiate a secure session
(https) with an application and obtain a user id.</p>
<p><strong>PassTicket support</strong></p>
<p>The next step is to obtain a pass ticket in place of a password so that
Virtel can log on to the target application and present a user id and
password combination on behalf of the user. The following job will
enable PassTicket support for our target application SPCICSH and using
user id SPVIRSTC, out Virtel server user id. This job will have to be
customized accordingly:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">STEP1</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">IKJEFT1A</span><span class="p">,</span><span class="n">DYNAMNBR</span><span class="o">=</span><span class="mi">20</span>
<span class="o">//*</span> <span class="n">RDEFINE</span> <span class="n">FACILITY</span> <span class="n">IRR</span><span class="o">.</span><span class="n">RTICKETSERV</span>
<span class="o">//</span><span class="n">SYSTSPRT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
<span class="o">//</span><span class="n">SYSTSIN</span> <span class="n">DD</span> <span class="o">*</span>
 <span class="n">SETROPTS</span> <span class="n">CLASSACT</span><span class="p">(</span><span class="n">APPL</span><span class="p">)</span>
 <span class="n">SETROPTS</span> <span class="n">CLASSACT</span><span class="p">(</span><span class="n">PTKTDATA</span><span class="p">)</span>
 <span class="n">SETROPTS</span> <span class="n">RACLIST</span><span class="p">(</span><span class="n">PTKTDATA</span><span class="p">)</span>
 <span class="n">SETROPTS</span> <span class="n">GENERIC</span><span class="p">(</span><span class="n">PTKTDATA</span><span class="p">)</span>
 <span class="n">RDEFINE</span> <span class="n">FACILITY</span> <span class="n">IRR</span><span class="o">.</span><span class="n">RTICKETSERV</span>
 <span class="n">RDELETE</span> <span class="n">PTKTDATA</span> <span class="n">SPCICSH</span>
 <span class="n">RDELETE</span> <span class="n">PTKTDATA</span> <span class="n">IRRPTAUTH</span><span class="o">.</span><span class="n">SPCICSH</span><span class="o">.*</span>
 <span class="n">RDEFINE</span> <span class="n">PTKTDATA</span> <span class="n">IRRPTAUTH</span><span class="o">.</span><span class="n">SPCICSH</span><span class="o">.*</span> <span class="n">UACC</span><span class="p">(</span><span class="n">NONE</span><span class="p">)</span>
 <span class="n">RDEFINE</span> <span class="n">PTKTDATA</span> <span class="o">**</span><span class="n">SPCICSH</span><span class="o">**</span> <span class="n">SSIGNON</span><span class="p">(</span><span class="n">KEYMASKED</span><span class="p">(</span><span class="mi">998</span><span class="n">A654FEBCDA123</span><span class="p">))</span> <span class="o">+</span>
        <span class="n">UACC</span><span class="p">(</span><span class="n">NONE</span><span class="p">)</span>
<span class="o">//</span><span class="n">STEP1</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">IKJEFT1A</span><span class="p">,</span><span class="n">DYNAMNBR</span><span class="o">=</span><span class="mi">20</span>
<span class="o">//</span><span class="n">SYSTSPRT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
<span class="o">//</span><span class="n">SYSTSIN</span> <span class="n">DD</span> <span class="o">*</span>
 <span class="n">PERMIT</span> <span class="n">IRR</span><span class="o">.</span><span class="n">RTICKETSERV</span> <span class="n">CL</span><span class="p">(</span><span class="n">FACILITY</span><span class="p">)</span> <span class="n">ID</span><span class="p">(</span>\ <span class="o">**</span><span class="n">SPVIRSTC</span><span class="o">**</span><span class="p">)</span> <span class="n">ACC</span><span class="p">(</span><span class="n">READ</span><span class="p">)</span>
 <span class="n">PERMIT</span> <span class="n">IRRPTAUTH</span><span class="o">.</span><span class="n">SPCICSH</span><span class="o">.*</span> <span class="n">CL</span><span class="p">(</span><span class="n">PTKTDATA</span><span class="p">)</span> <span class="n">ID</span><span class="p">(</span><span class="n">SPVIRSTC</span><span class="p">)</span> <span class="n">ACC</span><span class="p">(</span><span class="n">UPDATE</span><span class="p">)</span>
 <span class="n">SETROPTS</span> <span class="n">REFRESH</span> <span class="n">RACLIST</span><span class="p">(</span><span class="n">PTKTDATA</span><span class="p">)</span>
 <span class="n">SETROPTS</span> <span class="n">REFRESH</span> <span class="n">RACLIST</span><span class="p">(</span><span class="n">FACILITY</span><span class="p">)</span>
</pre></div>
</div>
<p>In order for Virtel to generate PassTickets, you must also modify your
VIRTCT to include the parameter PASSTCK=YES and then reassemble the
VIRTCT. See chapter 6 of the Virtel Installation Guide for more details
on the Virtel VIRTCT.</p>
<p><strong>PAGENT Configuration</strong></p>
<p>To enable system SSL sessions to take place between the browser and the
application we have to tell AT-TLS and SSL which sockets to intercept.
This is configured in the pagent configuration file which can be found
in /etc/pagent.conf. The two areas that we are interested in are the
TTLSEnvironmentAction section and the TTLSRule section.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TTLSEnvironmentAction</span> <span class="n">VIRTELenvir_inSec</span>
<span class="p">{</span>
                <span class="n">HandshakeRole</span> <span class="n">ServerWithClientAuth</span>
                <span class="n">Trace</span> <span class="mi">7</span>
                <span class="n">TTLSKeyringParms</span>
                <span class="p">{</span>
                        <span class="n">Keyring</span> <span class="n">VIRTRING</span>
                <span class="p">}</span>
                <span class="n">TTLSEnvironmentAdvancedParms</span>
                <span class="p">{</span>
                        <span class="n">SSLv2</span> <span class="n">On</span>
                        <span class="n">SSLv3</span> <span class="n">On</span>
                        <span class="n">TLSv1</span> <span class="n">On</span>
                        <span class="n">ClientAuthType</span> <span class="n">SAFCheck</span>
                <span class="p">}</span>
                <span class="n">TTLSCipherParmsRef</span> <span class="n">VIRTELcipher</span>
<span class="p">}</span>
<span class="o">...</span>
<span class="o">...</span>
<span class="o">...</span>
<span class="n">TTLSRule</span> <span class="n">VIRTELrule_in_eh</span>
<span class="p">{</span>
        <span class="n">Jobname</span>                     <span class="n">SPVIREH</span>
        <span class="n">LocalPortRange</span>              <span class="mi">41002</span>
        <span class="n">Direction</span>                   <span class="n">Inbound</span>
        <span class="n">TTLSGroupActionRef</span>          <span class="n">VIRTELgroup</span>
        <span class="n">TTLSEnvironmentActionRef</span>    <span class="n">VIRTELenvir_inSec</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The TTLS Rule identifies Virtel Started task name via the Jobname
parameter and also the port number that can support secured sessions _
https. In this case it is port 41002.</p>
<p>The rules section also identifies the environmental section. In this
case we have selected an environment section called VIRTELenvir_insec.</p>
<p>In VIRTELenvir_insec we identify that we want to use both server and
client certificates –</p>
<p><em>HandShakeRole ServerWithClientAuth</em></p>
<p>That the user certificate must be associated with a valid RACF userid –</p>
<p><em>ClientAuthType SAFCheck</em></p>
<p>The name of the keyring that holds the keys(certificates)</p>
<p><em>Keyring VIRTRING</em></p>
<p>A default pagent.conf is shipped with the SAMPLIB member SSLSETUP which
you can use to modify accordingly to define the above SSL sections.</p>
<p>To refresh a pagent.conf profile after you have made changes you can
issue the following z/OS command:-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">F</span> <span class="n">PAGENT</span><span class="p">,</span><span class="n">REFRESH</span>
</pre></div>
</div>
<p><strong>Virtel Configuration</strong></p>
<p>The final part in our configuration is to configure Virtel to use SSL to
obtain the user id and PassTicket support to create a password. We
configure Virtel in the transaction associated with our target
application, in this case the CICS application called SPCICSH.</p>
<p><img alt="image3" src="../../../_images/image44.png" /></p>
<p>Note that PassTicket is set to 2. This will enable Virtel to generate a
temporary password. Security is set to 3. This indicates that Virtel
will receive a USERID based upon the user certificate used in the
authentication process. The TIOA at logon is a string that will logon to
the CICS application using the user id and password values that Virtel
has obtained.</p>
<p>With this configuration we can logon to our CICS application without the
user presenting any user id or password. This is very much like the
Express Logon Facility implemented in our Telnet clients.</p>
<p><strong>Logon Example</strong></p>
<p>In the following screen shots we demonstrate logging into a CICS
application via a secure session (https) without specifying any user
id/password. Our initial URL is</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">170.30</span><span class="p">:</span><span class="mi">41002</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">WEB2AJAX</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">CICS</span>
</pre></div>
</div>
<p>You will replace the IP address with your own installation IP address or domain name.</p>
<p><img alt="image4" src="../../../_images/image58.png" /></p>
<p>We are presented with a «&nbsp;&nbsp;Select a certificate&nbsp;» window from the
browser requesting the certificate we wish to user for authenication
purposes. We select the certificate we downloaded.</p>
<p>The next panel is a warning panel which identifes that the certificate
we are using has not been authenticated by a well-known CA authority. We
are of course aware of this as we are using a RACF self signed
certifcate.</p>
<p><img alt="image5" src="../../../_images/image614.png" /></p>
<p>We select Advanced and are then presented with information about the
certifciate.</p>
<p><img alt="image6" src="../../../_images/image72.png" /></p>
<p>We select the “Proceed” link.</p>
<p><img alt="image7" src="../../../_images/image82.png" /></p>
<p>We are signed into CICS without having to specify any user id or
password.</p>
<p><strong>Problems</strong></p>
<p>It is easy to miss something when configuring user certificate sign on.
Here are some general guidelines that should help in debugging
configuration errors.</p>
<ol class="arabic simple">
<li>Is AT-TLS active.</li>
</ol>
<p>Issue the following z/OS command – D TCPIP,,N,TTLS</p>
<p>The response should be :-</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">EZD0101I</span> <span class="n">NETSTAT</span> <span class="n">CS</span> <span class="n">V1R13</span> <span class="n">TCPIP</span> <span class="mi">706</span>
<span class="n">TTLSGRPACTION</span>                       <span class="n">GROUP</span> <span class="n">ID</span>                <span class="n">CONNS</span>
<span class="n">VIRTELGROUP</span>                         <span class="mi">00000002</span>                    <span class="mi">3</span>
<span class="mi">1</span> <span class="n">OF</span> <span class="mi">1</span> <span class="n">RECORDS</span> <span class="n">DISPLAYED</span>
<span class="n">END</span> <span class="n">OF</span> <span class="n">THE</span> <span class="n">REPORT</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>PAGENT return codes</li>
</ol>
<p>Common session startup/handshake errors are reported through messqge
EZD1287I. In the example below we can see that the handshake has failed
with a return code of 5003. Return codes under 5000 are generated by
System SSL and are defined in the System SSL Programming manual. Return
codes over 5000 are generated by AT-TLS and are defined in the IP
Diagnosis Guide. In the following the 5013 suggests that the browser has
sent clear text; in other words, http was used instead of https in the
URL.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">BPXF024I</span> <span class="p">(</span><span class="n">TCPIP</span><span class="p">)</span> <span class="n">Oct</span> <span class="mi">7</span> <span class="mi">13</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">08</span> <span class="n">TTLS</span> <span class="mi">83951769</span> <span class="p">:</span> <span class="mi">15</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">08</span> <span class="n">TCPIP</span> <span class="mi">367</span> <span class="n">EZD1281I</span> <span class="n">TTLS</span> <span class="n">Map</span> <span class="n">CONNID</span><span class="p">:</span> <span class="mi">000006</span><span class="n">A2</span> <span class="n">LOCAL</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">170.30</span><span class="o">..</span><span class="mi">41002</span>
<span class="n">REMOTE</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">92.62</span><span class="o">..</span><span class="mi">57545</span> <span class="n">JOBNAME</span><span class="p">:</span> <span class="n">SPVIREH</span> <span class="n">USERID</span><span class="p">:</span> <span class="n">SPVIRSTC</span> <span class="n">TYPE</span><span class="p">:</span> <span class="n">InBound</span> <span class="n">STATUS</span><span class="p">:</span> <span class="n">Enabled</span> <span class="n">RULE</span><span class="p">:</span> <span class="n">VIRTELrule_in_eh</span> <span class="n">ACTIONS</span><span class="p">:</span> <span class="n">VIRTELgroup</span>
<span class="n">VIRTELenvir_inSec</span> <span class="o">**</span><span class="n">N</span><span class="o">/</span><span class="n">A</span><span class="o">**</span>
<span class="n">BPXF024I</span> <span class="p">(</span><span class="n">TCPIP</span><span class="p">)</span> <span class="n">Oct</span> <span class="mi">7</span> <span class="mi">13</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">08</span> <span class="n">TTLS</span> <span class="mi">83951769</span> <span class="p">:</span> <span class="mi">15</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">08</span> <span class="n">TCPIP</span> <span class="mi">368</span>
<span class="n">EZD1286I</span> <span class="n">TTLS</span> <span class="n">Error</span> <span class="n">GRPID</span><span class="p">:</span> <span class="mi">00000002</span> <span class="n">ENVID</span><span class="p">:</span> <span class="mi">00000000</span> <span class="n">CONNID</span><span class="p">:</span> <span class="mi">000006</span><span class="n">A2</span>
<span class="n">LOCAL</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">170.30</span><span class="o">..</span><span class="mi">41002</span> <span class="n">REMOTE</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">92.62</span><span class="o">..</span><span class="mi">57545</span> <span class="n">JOBNAME</span><span class="p">:</span>
<span class="n">SPVIREH</span> <span class="n">USERID</span><span class="p">:</span> <span class="n">SPVIRSTC</span> <span class="n">RULE</span><span class="p">:</span> <span class="n">VIRTELrule_in_eh</span> <span class="n">RC</span><span class="p">:</span> <span class="mi">5003</span> <span class="n">Data</span>
<span class="n">Decryption</span>
<span class="n">EZD1287I</span> <span class="n">TTLS</span> <span class="n">Error</span> <span class="n">RC</span><span class="p">:</span> <span class="mi">5003</span> <span class="n">Data</span> <span class="n">Decryption</span> <span class="mi">369</span>
<span class="n">LOCAL</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">170.30</span><span class="o">..</span><span class="mi">41002</span>
<span class="n">REMOTE</span><span class="p">:</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">92.62</span><span class="o">..</span><span class="mi">57545</span>
<span class="n">JOBNAME</span><span class="p">:</span> <span class="n">SPVIREH</span> <span class="n">RULE</span><span class="p">:</span> <span class="n">VIRTELrule_in_eh</span>
<span class="n">USERID</span><span class="p">:</span> <span class="n">SPVIRSTC</span> <span class="n">GRPID</span><span class="p">:</span> <span class="mi">00000002</span> <span class="n">ENVID</span><span class="p">:</span> <span class="mi">00000000</span> <span class="n">CONNID</span><span class="p">:</span> <span class="mi">000006</span><span class="n">A2</span>
</pre></div>
</div>
<p>Common PAGENT return codes:-</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Code</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>7</td>
<td>No certificate</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>Certificate not trusted</td>
</tr>
<tr class="row-even"><td>109</td>
<td>No CA certificates on ring</td>
</tr>
<tr class="row-odd"><td>202</td>
<td>Keyring does not exists</td>
</tr>
<tr class="row-even"><td>401</td>
<td>Certificate expired</td>
</tr>
<tr class="row-odd"><td>402/12</td>
<td>Client and server cannot agree cipher suite</td>
</tr>
<tr class="row-even"><td>403</td>
<td>Client Certificate not available or invalid.</td>
</tr>
<tr class="row-odd"><td>416</td>
<td>Virtel does not have permission to list keyring</td>
</tr>
<tr class="row-even"><td>431</td>
<td>Certificate is revoked</td>
</tr>
<tr class="row-odd"><td>434</td>
<td>Certificate key not compatible with cipher suite</td>
</tr>
<tr class="row-even"><td>435</td>
<td>Certificate authority unknown</td>
</tr>
<tr class="row-odd"><td>5003</td>
<td>Browser sent clear text.</td>
</tr>
<tr class="row-even"><td>5006</td>
<td>SSL failed to initialize. Check RACF SSLSETUP job.</td>
</tr>
</tbody>
</table>
<p>For code 403, check that your browser has access to a valid client certificate.</p>
<p>For 5006, list the Virtel key ring and ensure all the relevant keys are attached. There should be a client certificate (if using client certificates), a server certificate and an associated signing certificate.</p>
<p>For 5003, make sure your url is HTTPS and not HTTP.</p>
<p><strong>Virtel messages</strong></p>
<p>VIRHT57E LINE IS NOT SET UP FOR HTTPS</p>
<blockquote>
<div><p>This means that the browser has sent encypted text (https) but that AT-TLS has not decrypted it before sending it to VIRTEL. The PAGENT rules haven’t correctly identified this port as a SSL jobname/port.
Check the /etc/pagent.conf member. The message is a bit misleading as there is no line setup required by Virtel. Also check the /tmp/pagent.log for any error messages.</p>
<p>Check the PAGENT started task for any error messages that imply that TTLS has not been configured for the TCPIP stack. Message EZD1579I in the PAGENT log indicates that the TCP/IP profile may not have been setup for TTLS. Check the the TTLS parameter has been specified in the TCPCONFIG statement.  See the information about the TCPCONFIG statement in z/OS Communications Server: IP Configuration Reference for more information.</p>
<p>Normally AT-TLS is transparent to VIRTEL. AT-TLS performs the
decryption and transforms the https request into an http request
before passing it to VIRTEL. The only case where VIRTEL is AT-TLS
aware is when the VIRTEL transaction definition specifies SECURITY=3
(TLS) and in this case VIRTEL will check that the session has been
processed by AT-TLS and will issue an IOCTL to obtain the userid
associated with the certificate.</p>
<p>In the normal case, you should specify HandshakeRole Server,
ClientAuthType Full, and ApplicationControlled Off in the AT-TLS
rules, as in the example in VIRT447.SAMPLIB(SSLSETUP). VIRTEL does
not issue an IOCTL to turn decryption on and off, so if you
specified ApplicationControlled On then you would get VIRHT57E
because AT-TLS has not been instructed to start decryption.</p>
<p>If you still get an error when you have ApplicationControlled Off
then we will need to see the SYSLOG (for the EZD TTLS messages), the
JESMSGLG from the VIRTEL started task, and the SYSPRINT resulting
from a z/OS command F VIRTEL,SNAP immediately after the error
occurs. We would also like to see the exact URL which was entered at
the browser, as well as the AT-TLS pagent.conf file.</p>
</div></blockquote>
<p><strong>z/OS IBM References</strong></p>
<ul>
<li><p class="first">SA22-7683 Security Server: RACF Security Administrator’s Guide</p>
<blockquote>
<div><p>Chapter 21. RACF and Digital Certificates</p>
</div></blockquote>
</li>
<li><p class="first">SC24-5901 Cryptographic Services: System SSL Programming</p>
<blockquote>
<div><p>Chapter 12. Messages and Codes</p>
</div></blockquote>
</li>
<li><p class="first">SC31-8775 Communications Server: IP Configuration Guide</p>
<blockquote>
<div><p>Chapter 14. Policy-based networking</p>
<p>Chapter 18. Application Transparent Transport Layer Security (AT-TLS) data protection</p>
</div></blockquote>
</li>
<li><p class="first">SC31-8776 Communications Server: IP Configuration Reference</p>
<blockquote>
<div><p>Chapter 21. Policy Agent and policy applications</p>
</div></blockquote>
</li>
<li><p class="first">GC31-8782 Communications Server: IP Diagnosis Guide</p>
<blockquote>
<div><p>Chapter 28. Diagnosing Application Transparent Transport Layer Security (AT-TLS)</p>
</div></blockquote>
</li>
<li><p class="first">SC31-8784 Communications Server: IP Messages: Volume 2</p>
<blockquote>
<div><p>Chapter 10. EZD1xxxx messages</p>
</div></blockquote>
</li>
</ul>
<p><strong>Virtel References</strong></p>
<ul>
<li><p class="first">VIRTEL Installation Guide</p>
<blockquote>
<div><p><a class="reference internal" href="../../virtel/Virtel456IG/Installation_Guide.html#virt456ig-passtck"><span class="std std-ref">PASSTCK parameter</span></a></p>
</div></blockquote>
</li>
<li><p class="first">VIRTEL Connectivity Reference</p>
<blockquote>
<div><p>Transactions – PassTicket Parameter Page 93</p>
<p>Transactions – Security Parameter Page 94</p>
</div></blockquote>
</li>
<li><p class="first">VIRTEL Web Access Guide</p>
<blockquote>
<div><p><a class="reference internal" href="../../virtel/Virtel456UG/User_Guide.html#v456ug-data-encryption-ssl"><span class="std std-ref">Security – Data encryption by SSL</span></a></p>
</div></blockquote>
</li>
</ul>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../TN201417/TN201417.html" class="btn btn-neutral float-right" title="RACF Grouping Class and Virtel" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../TN201415/TN201415.html" class="btn btn-neutral" title="Virtel JES Writer program" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Syspertec. All rights reserved.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'7',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>