

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Overview of a Virtel Session &mdash; Virtel 7 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="CICS Printing problem" href="../TN201414/TN201414.html" />
    <link rel="prev" title="Sharing user macros across multiple instances of Virtel" href="../TN201412/TN201412.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Virtel
          

          
            
            <img src="../../../_static/logo_virtel_web.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                4.57
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../virtel.html">Virtel Manuals</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../newsletters.html">Technical Newsletters</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../newsletters.html#id1">2014</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../TN201406/TN201406.html">Taking a VIRTEL terminal trace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201407/TN201407.html">Pass tickets and supporting Proxy Servers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201409/TN201409.html">Mainframe printing with Virtel 4.56</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201410/TN201410.html">Taking a VTAM trace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201411/TN201411.html">Building a customized USSTAB using Virtel’s Web Access facility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201412/TN201412.html">Sharing user macros across multiple instances of Virtel</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Overview of a Virtel Session</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201414/TN201414.html">CICS Printing problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201415/TN201415.html">Virtel JES Writer program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201416/TN201416.html">Virtel Security. Using server and client certificates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201417/TN201417.html">RACF Grouping Class and Virtel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201419/TN201419.html">Maintaining TRSF file sets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id2">2015</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id3">2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id4">2017</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id5">2018</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../howto.html">Miscellaneous</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Virtel</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../newsletters.html">Technical Newsletters</a> &raquo;</li>
        
      <li>Overview of a Virtel Session</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/manuals/newsletters/TN201413/TN201413.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overview-of-a-virtel-session">
<span id="tn201413"></span><h1>Overview of a Virtel Session<a class="headerlink" href="#overview-of-a-virtel-session" title="Permalink to this headline">¶</a></h1>
<p>Virtel uses APIs provided by other protocols such as HTTP, TCP/IP,
SNA to support Virtel session endpoints between a Web Browser and
VTAM application. These underlying protocols are well documented in
IBM manuals and/or other manuals. From an end to end session
perspective Virtel acts like a conduit passing data between the HTTP
session through to the CICS application. However, there are two
faces that Virtel presents, one for each protocol. To the internet
it acts like a HTTP Web server and to CICS like a 3270 logical
unit:-</p>
<p><img alt="image00" src="../../../_images/image00.png" /></p>
<p>Within the Virtel logic, data is transformed between SNA and HTTP
presentation formats, depending on the data flow. With regard to
states, at higher levels, a session state can be either in a send
state or receive state. In effect though, at a lower level the HTTP
side is stateless (HTTP is a stateless protocol), whereas on the
VTAM side the SNA protocol demands a stateful protocol. Virtel
internally manages the overall session state between these protocols
for any one session. Virtel employs AJAX long polling and other web
technologies to maintain state on the Web side of the session and
confirms to SNA protocols as described in the VTAM programming
manual. <em>See IBM SNA Network Product Formats LY43_0081 for details
on SNA formats and Data Flow</em>.</p>
<p><strong>Session establishment</strong></p>
<p>A session is establish through a user opening a browser window to a
defined Virtel URL. For example http:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://192.168.170.15:41002/w2h/WEB2AJAX.htm+TSO1A?logmode=D4A32XX3&amp;rows=52&amp;cols=132
</pre></div>
</div>
<p>It is the URI which determines what Virtel is to do on behalf of the
user. In the above example the user is requesting that Virtel
establish a SNA session to TSO. Logical the session between the user
and TSO will now comprise of two half session elements. One half
session representing the Web Server to Web Browser, another
representing a SNA Logical unit to VTAM.</p>
<p><img alt="image01" src="../../../_images/image01.png" /></p>
<p>Session establish on the Web Server side is triggered through the
Z/OS TCP/IP stack receiving a packet from the web browser with the
SYN bit set to 1. This will cause Virtel to open a socket with the
web browser. In is not the intention of this document to detail TCP
connection logic and hand shaking. <em>See Web Protocols and Practices.
Balachander Krishnamurthy &amp; Jennifer Rexford.</em></p>
<p>After opening the socket, Virtel will inspect the URI passed and
determine an appropriate action. In this case it will establish a
SNA VTAM session to TSO through the use of the REQSESS VTAM macro.
This will open a logical unit session to the TSO application as
requested in the URI. Of course this can be any VTAM application,
for example CICS. The <em>Virtel Connectivity</em> manual documents the URI
formats. This new SNA relay session will now support the SNA session
between Virtel and the TSO application. Data flow will now commence
between the Web client (Users Browser window) and the TSO
application. Presentation data will be converted by Virtel between
HTTP and SNA formats and the independent half session states that
represent the each session half, web on one side, SNA on the other,
will be managed by Virtel internal logic.</p>
<p><strong>Session disconnection</strong></p>
<p>When Virtel determines that a session has been disconnected it will
close the supporting SNA relay session. Session disconnection can
present itself to Virtel in many forms. From the user closing a
window; triggered by the user pressing the “Disconnect” button in
the Virtel OIA, or simplying turning the PC off. Virtel employs
various mechanisms and timers as part of its internal state manager
to detect whether the web half session is still “alive”. As HTTP is
stateless it has no underlying “are you there” handshake mechanism
and as such it is up to Virtel to determine if the web session is
still active.</p>
<p><strong>Session affinity</strong></p>
<p>It is important that session affinity is maintained between a user’s
browser session and the VTAM application. Virtel maintains affinity
on the web side session id through the use of HTTP parameters. A
Virtel line trace will reveal the protocol flow between the web
browser and Virtel. Here can be seen the session ids that Virtel
maintains in order to identify a particular session. The session id
logic is handled and managed by Virtel’s internal session manager.
An example of a line trace is shown below:-</p>
<p><img alt="image02" src="../../../_images/image02.png" /></p>
<p>Loss of affinity will cause unpredictable results as Virtel will not be able to tie up the two half sessions. Loss of affinity can result from network configurations which do not employ affinity technologies.  For example IBMs Sysplex Distributor requires the <strong>TIMEDAFF</strong> parameter to be specified. If Proxy Servers are used than the “Sticky Session” feature must be set. See z/OS Communications Server: IP Configuration Reference SC27-3651-00.</p>
<p>For more information on setting up a Sysplex Distributor or visit
<a class="reference external" href="http://httpd.apache.org/docs/2.2/mod/mod_proxy_balancer.html">http://httpd.apache.org/docs/2.2/mod/mod_proxy_balancer.html</a> for
further information on “sticky sessions”. In the following
configuration an Apache Proxy Server is used to balance sessions
request across two Virtel instances running on separate z/OS LPARS:-</p>
<p><a class="reference internal" href="../../../_images/image1.jpg"><img alt="image0" src="../../../_images/image1.jpg" style="width: 6.30000in; height: 3.54375in;" /></a></p>
<p><strong>Cache storage considerations</strong></p>
<p>On the web side Virtel runs as a web server and therefore is
subjected to the protocols of the underlying browser support, be it
IE, Chrome or whatever browser support is utilized by the user. The
standard logic is such that when the user opens a Virtel session by
specifying a Virtel URI, Virtel will download the necessary HTML,
CSS and Javacript elements. The browser will maintain these elements
in storage, in this instance in the browsers cache storage. Most of
these elements are static in nature, once in the browser’s cache
they needn’t be served again. However, dynamic elements such as user
macros, which are also maintained in the browser’s cache need to be
reflected back to the Virtel TRSF file(s). The transfer of these
elements is performed by Virtel through various web technologies.
For example JSON array to reflect user macros. Virtel will enforce a
storage cache refresh for some elements in certain conditions. For
example, if a new copy of a JavaScript element is to be served as
part of a maintenance upgrade, Virtel will ensure that the new
JavaScript element is downloaded and updated in the browsers cache.</p>
<p><strong>Session example.</strong></p>
<p>In this scenario we look at a session between a browser and CICS with
Virtel providing the HTTP server and SNA conduit services. The
underlying network infrastructure is a Sysplex Distributor sharing load
between two TCP/IP target stacks running on separate LPARS.</p>
<p>Each LPAR runs an instance of Virtel. The CLI access port is defined as
170.15/24 in both the SPVIR1A and SPVIR2A ARBO definitions.</p>
<p>The TCPIP VIPA definitions in MVS1A look like:-</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">170.20</span> <span class="n">SPVIRMAN</span> <span class="k">for</span> <span class="n">VIPARANGE</span> <span class="n">test</span>
<span class="p">;</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">170.15</span> <span class="n">VIPA</span> <span class="k">for</span> <span class="n">SPVIR1A</span> <span class="ow">and</span> <span class="n">SPVIR2A</span> <span class="n">distribution</span> <span class="n">tests</span>

<span class="n">VIPADYNAMIC</span>
    <span class="n">VIPARANGE</span> <span class="n">DEFINE</span> <span class="n">MOVEABLE</span> <span class="n">NONDISRUPTIVE</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">170.20</span>
    <span class="n">VIPADEFINE</span> <span class="n">MOVE</span> <span class="n">IMMED</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">170.15</span>
    <span class="n">VIPADISTRIBUTE</span> <span class="n">DEFINE</span> <span class="n">TIMEDAFF</span> <span class="mi">300</span> <span class="n">DISTMETHOD</span> <span class="n">ROUNDROBIN</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">170.15</span>
<span class="n">DESTIP</span> <span class="n">ALL</span>
<span class="n">ENDVIPADYNAMIC</span>
</pre></div>
</div>
<p>The TCPIP VIPA definitions in MVS2A look like. It is a target for
170.15/24. Nothing special is defined.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VIPADYNAMIC</span>
    <span class="n">VIPARANGE</span> <span class="n">DEFINE</span> <span class="n">MOVEABLE</span> <span class="n">NONDISRUPT</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">170.20</span>
<span class="n">ENDVIPADYNAMIC</span>
</pre></div>
</div>
<p>The SYSPLEX distributor will distribute sessions between MVS1A and MVS2A
in a round robin fashion. Not that this based up a new IP address not a
new browser session.</p>
<p><strong>IP Schematic</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                           +------&gt; TCP/IP (92.161/24) MVS1A - &gt; VTAM – SPVIR1A
Terminal -&gt; SD (170.15/24) |
                           +------&gt; TCP/IP (92.162/24) MVS1B - &gt; VTAM – SPVIR2A
</pre></div>
</div>
<p><strong>zOS setup</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MVS1A</span> <span class="n">SPVIR1A</span><span class="p">(</span><span class="n">STC</span><span class="p">),</span> <span class="n">SPCICSH</span><span class="p">(</span><span class="n">STC</span><span class="p">)</span>
<span class="n">MVS1B</span> <span class="n">SPVIR2A</span><span class="p">(</span><span class="n">STC</span><span class="p">)</span>

<span class="n">SPVIR1A</span> <span class="n">ACB</span> <span class="o">=</span> <span class="n">VIRTEL1A</span> <span class="p">(</span><span class="n">Only</span> <span class="n">used</span> <span class="k">for</span> <span class="n">Admin</span><span class="o">.</span> <span class="n">Functions</span><span class="p">)</span>
<span class="n">SPVIR2A</span> <span class="n">ACB</span> <span class="o">=</span> <span class="n">VIRTEL2A</span> <span class="p">(</span><span class="n">Only</span> <span class="n">used</span> <span class="k">for</span> <span class="n">Admin</span><span class="o">.</span> <span class="n">Functions</span><span class="p">)</span>
<span class="n">Sysplex</span> <span class="n">Distributor</span> <span class="p">(</span><span class="n">SD</span><span class="p">)</span> <span class="n">running</span> <span class="n">on</span> <span class="n">MVSA</span>

<span class="n">Session</span> <span class="n">Status</span> <span class="n">before</span> <span class="n">terminal</span> <span class="n">establishes</span> <span class="n">a</span> <span class="n">session</span> <span class="k">with</span> <span class="n">Virtel</span> <span class="n">using</span>
<span class="n">the</span> <span class="n">following</span> <span class="n">URL</span><span class="p">:</span><span class="o">-</span>

<span class="mf">192.168</span><span class="o">.</span><span class="mf">170.15</span><span class="p">:</span><span class="mi">41002</span>
</pre></div>
</div>
<p>z/OS Command : D TCPIP,,N,CONN,MAX=*</p>
<p><a class="reference internal" href="../../../_images/image29.png"><img alt="image1" src="../../../_images/image29.png" style="width: 7.08333in; height: 1.80208in;" /></a></p>
<p>The SD setup shows the SD running on MVSA and target stacks on both
MVS1A and MVS1B. Note that port 41002 is associated with the SD and the
ADMIN port 41015 is associated with the specific instance of Virtel
running on MVS2A on IP address 192.168.92.162. On MVS1A we have a
similar display for SPVIR1A.</p>
<p><a class="reference internal" href="../../../_images/image36.png"><img alt="image2" src="../../../_images/image36.png" style="width: 7.08333in; height: 1.65625in;" /></a></p>
<p>z/OS Command : D TCPIP,,SYSPLEX,VIPAD</p>
<p><a class="reference internal" href="../../../_images/image41.png"><img alt="image3" src="../../../_images/image41.png" style="width: 7.06250in; height: 1.57292in;" /></a></p>
<p>After opening a HTTP session with Virtel we can see the Virtel server
will initialize the browser environment by sending the necessary HTML
elements to support Virtel running within the browser environment.</p>
<p><a class="reference internal" href="../../../_images/image55.png"><img alt="image4" src="../../../_images/image55.png" style="width: 7.08333in; height: 2.51042in;" /></a></p>
<p>If we take a look at the Virtel log we can see which element names have
been downloaded and there source directories.</p>
<p><a class="reference internal" href="../../../_images/image61.png"><img alt="image5" src="../../../_images/image61.png" style="width: 7.06250in; height: 1.61458in;" /></a></p>
<p>In the Virtel JESMSGLG log we can see that Virtel is using the CLI-DIR
(Customized elements) and the W2H-DIR (distributed elements)
directories; These directories have been accessed by Virtel to download
HTML elements to the users’s browser environment.</p>
<p>If we now look at the session setup now we should see some sockets
established with Virtel and the user’s terminal.</p>
<p><a class="reference internal" href="../../../_images/image7.png"><img alt="image6" src="../../../_images/image7.png" style="width: 7.04167in; height: 2.59375in;" /></a></p>
<p>On the user’s terminal their browser window will have the Virtel
Application Menu screen. This is the default for the URI
192.168.170.15:41002 that we used when establishing a session with
Virtel.</p>
<p><a class="reference internal" href="../../../_images/image8.png"><img alt="image7" src="../../../_images/image8.png" style="width: 7.05208in; height: 3.37500in;" /></a></p>
<p>We can see from this screen that the TSO and CICS applications are
active (Green). Login to CICS will drive Virtel to establish SNA relay
sessions with the target CICS application.</p>
<p>Logging on to CICS from the Virtel Application Menu screen we get the
CICS logon panel.</p>
<p><a class="reference internal" href="../../../_images/image9.png"><img alt="image8" src="../../../_images/image9.png" style="width: 7.08333in; height: 4.55208in;" /></a></p>
<p>We can see from the screen that the two VTAM relay LUs that Virtel has
provided to support this session is R2AVT000 (Terminal) and
R2AIM000(Printer). Session status for CICS in VTAM looks like this:</p>
<p><a class="reference internal" href="../../../_images/image101.png"><img alt="image9" src="../../../_images/image101.png" style="width: 6.30000in; height: 4.55486in;" /></a></p>
<p>…..and Virtel’s relay LU in VTAM looks like:-</p>
<p><a class="reference internal" href="../../../_images/image112.png"><img alt="image10" src="../../../_images/image112.png" style="width: 6.30000in; height: 4.22153in;" /></a></p>
<p>We can logon to CICS and have a look at the CICS view.</p>
<p><a class="reference internal" href="../../../_images/image122.png"><img alt="image11" src="../../../_images/image122.png" style="width: 7.19792in; height: 1.09375in;" /></a></p>
<p>Finally, to summarize; the end-to-end session for this particular Virtel
session looks like this :-</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Term. &lt;---&gt; VIRTEL/IP &lt;---&gt; VIRTEL/SNA &lt;–--&gt; R2AVT000 &lt;---&gt; SPCICSH

            &lt;----- VIRTEL STC ------&gt;        &lt;----- CICS STC -----&gt;

&lt;-------- HTTP --------&gt;&lt;------------- 3270 DataStreams ----------&gt;

&lt;------- TCP/IP -------&gt;&lt;-------------------- SNA ----------------&gt;
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../TN201414/TN201414.html" class="btn btn-neutral float-right" title="CICS Printing problem" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../TN201412/TN201412.html" class="btn btn-neutral float-left" title="Sharing user macros across multiple instances of Virtel" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Syspertec. All rights reserved

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>