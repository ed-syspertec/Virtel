

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Nailing LUS with an Identification scenario &mdash; Virtel 1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Virtel 1 documentation" href="../../../index.html"/>
        <link rel="up" title="Technical Newsletters" href="../../../newsletters.html"/>
        <link rel="next" title="Customising Virtel in V4.56" href="../TN201611/TN201611.html"/>
        <link rel="prev" title="Installing Virtel V4.56 from scratch" href="../TN201608/TN201608.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Virtel
          

          
            
            <img src="../../../_static/logo_virtel_web.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../newsletters.html">Technical Newsletters</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id1">2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id2">2015</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../newsletters.html#id3">2016</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../TN201601/TN201601.html">Customizing colours with CSS in Virtel 4.53</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201602/TN201602.html">Installing Virtel V4.53 from scratch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201603/TN201603.html">Field Level Encryption</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201604/TN201604.html">Controlling LU Names</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201605/TN201605.html">CICS Printing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201606/TN201606.html">Virtel Screen Redesigner in action</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201607/TN201607.html">What’s new in Virtel 4.56</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201608/TN201608.html">Installing Virtel V4.56 from scratch</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Nailing LUS with an Identification scenario</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201611/TN201611.html">Customising Virtel in V4.56</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id4">2017</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../howto.html">Miscellaneous</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Virtel</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../newsletters.html">Technical Newsletters</a> &raquo;</li>
      
    <li>Nailing LUS with an Identification scenario</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/manuals/newsletters/TN201609/TN201609.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="nailing-lus-with-an-identification-scenario">
<h1>Nailing LUS with an Identification scenario<a class="headerlink" href="#nailing-lus-with-an-identification-scenario" title="Permalink to this headline">¶</a></h1>
<p><strong>Note: The external programs used in this POC are not officially supported.</strong></p>
<p>The following newsletter explains how to force a LUNAME from within an
identification scenario. The criteria being that the LUNAME is derived
from a computer name passed in the URI as the user data or routing
parameter. Within the Identification Scenario Virtel validates the
computer name against a DNS lookup. If the DNS is successful the
scenario checks to see whether the computer name forms part of the DNS
name. If so it builds a LUNAME by replacing the first character of the
terminal name with the character ‘V’. A session is then established
using this LUNAME. If the DNS validation is unsuccessful the the session
uses a normal LUNAME from the default Virtel pool associated with the
transaction.</p>
<p>For example, given the following two examples:</p>
<p>Computer name TE202B77 DNS name te202b77.myCompany.com IP 192.168.1.127</p>
<p>Computer name TE202B78 DNS name temppc.myCompany.com IP 192.168.1.128</p>
<p>Assume the following:-</p>
<p>The transaction being accessed is a session monitor. Depending on the LU
name will determine the applications available to the user. A user using
computer TE202B77 will be authorised to user all applications. A user
using computer TE202B78 will be restricted to non-authorised
applications only.</p>
<p>User A accesses the 3270 session monitor application using a .bat file
the extracts the computer name and build a URL. The URL is sent to
Virtel.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">70.33</span><span class="p">:</span><span class="mi">41002</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">web2ajax</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">mytpx</span><span class="o">+</span><span class="n">TE202B77</span>
</pre></div>
</div>
<p>The Virtel identification scenario traps the inbound call and validates
the computer name against the IP address of the calling computer through
a DNS lookup. In the Virtel log we will see something like:-</p>
<p>VIRHT51I HTTP-CLI CONNECTING CLVTA009 TO 192.168.001.127:53411</p>
<p>Calling SERV3BNK WITH IP=192.168.001.127,LU=*W2HPOOL,TERMINAL=,</p>
<p>ROUTING=TE202B77</p>
<p>DNS=te202b77.mycompany.com,TERMINAL=TE202B77</p>
<p>LUNAME=VE202B77</p>
<p>VIR0919I CLVTA009 RELAY VE202B77(W2HTP077) ACTIVATED</p>
<p>LOGON</p>
<p>As the DNS validation is considered successful the LUNAME VE202B77 is
created and will be used to establish a session with the session manager
identified as transaction MYTPX.</p>
<p>User B accesses the 3270 session monitor with the following URI:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">70.33</span><span class="p">:</span><span class="mi">41002</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">web2ajax</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">mytpx</span><span class="o">+</span><span class="n">TE202B78</span>
</pre></div>
</div>
<p>The following messages appear in the log:-</p>
<p>VIRHT51I HTTP-CLI CONNECTING CLVTA009 TO 192.168.001.128:53622</p>
<p>Calling SERV3BNK WITH IP=192.168.001.128,LU=*W2HPOOL,TERMINAL=,</p>
<p>ROUTING=TE202B78</p>
<p>DNS=temppc.syspertec.com,TERMINAL=TE202B78</p>
<p>VIR0919I CLVTA009 RELAY REHVT000(W2HTP000) ACTIVATED</p>
<p>LOGON</p>
<p>The DNS validation is considered to have been unsuccessful as the
computer name does not form part of the DNS named return following a
lookup by the IP address of the terminal. The LU assigned to the session
will be the next free LU in the pool associated with the transaction.</p>
<p>Based upon the LUNAME passed to the session manager will determine the
applications listed.</p>
<p><strong>Installation</strong></p>
<ol class="arabic">
<li><p class="first">Install Virtel V4.56. This is required to support the Identification
scenario delivered in this package. See the Technical Newsletter -
<strong>*2016/08 Installing Virtel V4.56 from scratch*</strong> for further
information.</p>
</li>
<li><p class="first">Download TBANKEN.TRS from the Virtel FTP Server or save the TRS file
if sent via email.</p>
</li>
<li><p class="first">Upload to the mainframe into a dataset with the following DCB
attributes:-</p>
<blockquote>
<div><p>LRECL=1024,BLKSIZE=6144,RECFM=FB,</p>
<p>DSN=HLQ.TBANKEN.TRS</p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Run the following job. This will unterse the file and install the
package libraries that are associated with this newsletter. Here is
some sample JCL. Change accordingly.</p>
<blockquote>
<div><p>//jobcard JOB 9000,&#8217;ED...HOLT...&#8217;,CLASS=A,MSGCLASS=X,NOTIFY=&amp;SYSUID</p>
<p>//S01 EXEC PGM=IEFBR14</p>
<p>//DDA DD UNIT=SYSDA,</p>
<p>// DSN=HLQ.TBANKEN.TEMP,DISP=(MOD,DELETE),</p>
<p>// SPACE=(TRK,0)</p>
<p>//S02 EXEC PGM=TRSMAIN,PARM=UNPACK</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//INFILE DD DSN=HLQ.TBANKEN.TRS,DISP=SHR</p>
<p>//OUTFILE DD UNIT=SYSDA,</p>
<p>// DSN=HLQ.TBANKEN.TEMP,DISP=(,CATLG),</p>
<p>// SPACE=(CYL,(10,10),RLSE)</p>
<p>//S03 EXEC PGM=ADRDSSU,REGION=0M,COND=(0,NE)</p>
<p>//SYSPRINT DD SYSOUT=*</p>
<p>//IN DD DSN=HLQ.TBANKEN.TEMP,DISP=SHR</p>
<p>//OUT DD UNIT=SYSDA,VOL=SER=VVVVVV,DISP=SHR</p>
<p>RESTORE INDDNAME(IN) -</p>
<p>OUTDD(OUT) -</p>
<p>DATASET(INCLUDE(**)) -</p>
<p>RENAMEU( -</p>
<p>(SPTHOLT.**,HLQ.**) -</p>
<p>) -</p>
<p>CATALOG BYPASSACS(**) NMC NSC CANCELERROR</p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">The following two libraries should now exist:-</p>
<blockquote>
<div><p>userid.TBANKEN.LOADLIB</p>
<p>userid.TBANKEN.CNTL</p>
</div></blockquote>
</li>
</ol>
<ol class="arabic">
<li><p class="first">Copy the members in userid.TBANKEN.LOADLIB to your Virtel 4.56
library. There should be three members:-</p>
<blockquote>
<div><p>SCEN3BNK - Assembled Identification Scenario</p>
<p>SERV3BNK - Service program called with the Identification Scenario</p>
<p>VIRT3BNK - Virtel utility program that contains the following
functions:-</p>
<p>GETHOSTBA Lookup name by IP address.</p>
<p>GETHOSTBN Lookup IP address by DNS name.</p>
</div></blockquote>
</li>
</ol>
<ol class="arabic simple">
<li>The userid.TBANKEN.CNTL contains the Identification Scenario source
and some utility jobs. See the Scenario section for a listing of the
Identification Scenario. Copy the scenario source (SCEN3BNK) to your
userid .VIRTEL.CNTL library</li>
</ol>
<p>**
Virtel Configuration**</p>
<p><strong>Identification Scenario</strong></p>
<p>To use this package we have to associate the Identification Scenario
with the line:port that we will be calling in on. In our example we are
using the line C-HTTP which is associated with Entry Point CLIWHOST. I
have updated the Entry Point and added the Identification Scenario
SCEN3BNK.</p>
<p><a class="reference internal" href="../../../_images/image140.png"><img alt="image0" src="../../../_images/image140.png" style="width: 6.30000in; height: 4.00486in;" /></a></p>
<p><strong>Terminal definitions</strong></p>
<p>For each terminal that we are going to dedicate a LU to we need to add a
terminal definition and associate it with a pool. Here is an example of
the terminal definitions required to support terminals in the LU ranges
VE202B00-FF and VE202C00-FF.</p>
<p><a class="reference internal" href="../../../_images/image224.png"><img alt="image1" src="../../../_images/image224.png" style="width: 6.30000in; height: 3.99375in;" /></a></p>
<p><strong>Scenario</strong></p>
<p>The identification scenario is responsible for validating the computer
name passed in the URI as the userdata parameter. The following is an
extract from the SCEN3BNK scenario which handles the DNS validation:-</p>
<p>* &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</p>
<p>* Call GETHOSTBA function to retrieve DNS name given IP address -</p>
<p>* &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</p>
<p>1 COPY$ VALUE-TO-VARIABLE,VAR=&#8217;FUNCTION&#8217;,VALUE=&#8217;GETHOSTBA&#8217;</p>
<p>2 COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,USER-IP-ADDRESS), *</p>
<p>VAR=&#8217;PARM1&#8217;,TYPE=REPLACE</p>
<p>3 COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,RELAY), *</p>
<p>VAR=&#8217;PARM2&#8217;,TYPE=REPLACE</p>
<p>4 COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,QUERY), *</p>
<p>VAR=&#8217;PARM3&#8217;,TYPE=REPLACE</p>
<p>5 COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,ROUTING-PARAMETER), *</p>
<p>VAR=&#8217;PARM4&#8217;,TYPE=REPLACE</p>
<p>*</p>
<p>6 COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,TRANSACTION-EXTERNAL),*</p>
<p>VAR=&#8217;TRANSACTION&#8217;,TYPE=REPLACE</p>
<p>7 CASE$ &#8216;TRANSACTION&#8217;,(BEGIN,&#8217;TSO&#8217;,CALLIT),ELSE=FINISH</p>
<p>CALLIT EQU *</p>
<p>8 ERROR$ 0,&#8217;Calling SERV3BNK WITH IP=&#8217;, *</p>
<p>&#8216;*PARM1&#8217;,&#8217;,LU=&#8217;,&#8217;*PARM2&#8217;,&#8217;,QUERY=&#8217;,&#8217;*PARM3&#8217;, *</p>
<p>&#8216;,ROUTING=&#8217;,&#8217;*PARM4&#8217;</p>
<p>9 VIRSV$ CALL-REUSE,(&#8216;SCEN3BNK&#8217;,&#8217;SERV3BNK&#8217;), *</p>
<p>(IN-VARIABLE,&#8217;FUNCTION&#8217;), *</p>
<p>(IN-VARIABLE,&#8217;PARM1&#8217;), *</p>
<p>(OUT-VARIABLE,&#8217;RESULT&#8217;,256), *</p>
<p>TASKS=1, *</p>
<p>KEY=8, *</p>
<p>ERROR=KO</p>
<p>10 ERROR$ 0,&#8217;DNS=&#8217;,&#8217;*RESULT&#8217;,&#8217;,TERMINAL=&#8217;,&#8217;*PARM4&#8217;</p>
<p>11 CONVERT$ EBCDIC-TO-UPPERCASE,VAR=&#8217;RESULT&#8217;</p>
<p>12 CONVERT$ EBCDIC-TO-UPPERCASE,VAR=&#8217;PARM4&#8217;</p>
<p>13 CASE$ &#8216;RESULT&#8217;,(CONTAINS,&#8217;*PARM4&#8217;,OK),ELSE=KO</p>
<p>OK EQU *</p>
<p>*</p>
<p>14 COPY$ VARIABLE-TO-VARIABLE, *</p>
<p>VAR=(&#8216;PARM4&#8217;,&#8217;MYSUFFIX&#8217;), *</p>
<p>OFFSET=1,LENGTH=7,PAD=&#8217; &#8216;,TYPE=REPLACE</p>
<p>15 COPY$ LIST-TO-VARIABLE,LIST=(&#8216;V&#8217;,&#8217;*MYSUFFIX&#8217;), *</p>
<p>VAR=MYLUNAME</p>
<p>*</p>
<p>16 ERROR$ 0,&#8217;LUNAME=&#8217;,&#8217;*MYLUNAME&#8217;</p>
<p>17 COPY$ VARIABLE-TO-SYSTEM,FIELD=(VALUE-OF,ROUTING-PARAMETER), *</p>
<p>VAR=&#8217;MYLUNAME&#8217;</p>
<p>18 GOTO$ FINISH</p>
<p>KO EQU *</p>
<p>FINISH EQU *</p>
<p>**
Logic**</p>
<ol class="arabic simple">
<li>Create variable FUNCTION and set to GETHOSTBA. This is the
GetHostByAddress utility function that will called from within the
VIRTUTIL utility module.</li>
<li>Get the callers IP Address and place in variable PARM1.</li>
<li>Get the callers allocated LUNAME pool and place in variable PARM2.</li>
<li>Get the callers query parameters and place in variable PARM3.</li>
<li>Get the callers terminal name(userdata) and place in variable PARM4.</li>
<li>Get the callers transaction and place in variable TRANSACTION.</li>
<li><strong>If TRANSACTION begins with TSO continue, else exit scenario. Note
this will have to be changed to support the transaction you want to
nail LUs to.</strong></li>
<li>Debugging message.</li>
<li>Call VIRSV program and pass parameters. This will call program
SCEN3BNK which will interface with the VIRTEL Utility program
VIRT3BNK. The RESULT variable will contain the result of the
GETHOSTBA call. If a non-zero return code is returned then the
Identification Scenario is terminated.</li>
<li>Debugging message.</li>
<li>Convert RESULT to uppercase.</li>
<li>Convert PARM4 to uppercase.</li>
<li>Validate the terminal name against the returned DNS name. If
successful continue else exit Identification Scenario.</li>
<li>Copy characters 1-7 of terminal name to variable MYSUFFIX.</li>
<li>Prefix MYSUFFIX variable with character ‘V’ and create variable
MYLUNAME.</li>
<li>Debugging message.</li>
<li>Set System variable ROUTING-PARAMETER with the contents of variable
MYLUNAME.</li>
<li>Exit Identification Scenario.</li>
</ol>
<p><strong>Calling the browser</strong></p>
<p>The following *.bat file obtains the computer name and takes the first
8 characters and places them into the URI before calling the browsers.</p>
<p><strong>Important. Change the transaction to the transaction that you wish to
nail LUs to. In this example the transaction is mytpx.</strong></p>
<p>title 3Banken Sample bat file passing the terminal name</p>
<p>&#64;echo on</p>
<p>color 1f</p>
<p>cls</p>
<p>SET P1=%COMPUTERNAME:~0,8%</p>
<p>echo %P1%</p>
<p>start <a class="reference external" href="http://192.168.170.33:41002/w2h/web2ajax.htm+">http://192.168.170.33:41002/w2h/web2ajax.htm+</a><strong>mytpx</strong>+%P1%
&amp;goto:eof</p>
<p>:exit</p>
<p>rem if mozilla is installed</p>
<p>rem If exist &#8220;%PROGRAMFILES(X86)%\mozilla firefox\firefox.exe&#8221; start
firefox.exe <a class="reference external" href="http://192.168.170.33:41002/w2h/web2ajax">http://192.168.170.33:41002/w2h/web2ajax</a>.htm+mytpx+%P1%
&amp;goto:eof</p>
<p>rem if ie is installed</p>
<p>rem If exist &#8220;%PROGRAMFILES(X86)%\internet explorer\iexplore.exe&#8221;
start iexplore.exe
<a class="reference external" href="http://192.168.170.33:41002/w2h/web2ajax">http://192.168.170.33:41002/w2h/web2ajax</a>.htm+mytpx+%P1% &amp;goto:eof</p>
<p>rem :EXIT</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../TN201611/TN201611.html" class="btn btn-neutral float-right" title="Customising Virtel in V4.56" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../TN201608/TN201608.html" class="btn btn-neutral" title="Installing Virtel V4.56 from scratch" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Syspertec. All rights reserved.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>