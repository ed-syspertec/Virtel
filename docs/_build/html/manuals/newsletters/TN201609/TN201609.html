<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nailing LUS with an Identification scenario &mdash; Virtel 9 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Customizing Virtel in V4.56" href="../TN201611/TN201611.html" />
    <link rel="prev" title="Installing Virtel V4.56 from scratch" href="../TN201608/TN201608.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Virtel
              <img src="../../../_static/logo_virtel_web.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                4.61
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../virtel.html">Virtel Manuals</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../newsletters.html">Technical Newsletters</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id1">2014</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id2">2015</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../newsletters.html#id3">2016</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../TN201601/TN201601.html">Customizing colours with CSS in Virtel 4.53</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201602/TN201602.html">Installing Virtel V4.53 from scratch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201603/TN201603.html">Field Level Encryption</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201604/TN201604.html">Controlling LU Names</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201605/TN201605.html">CICS Printing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201606/TN201606.html">Virtel Screen Redesigner in action</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201607/TN201607.html">What’s new in Virtel 4.56 (September 2016)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201608/TN201608.html">Installing Virtel V4.56 from scratch</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Nailing LUS with an Identification scenario</a></li>
<li class="toctree-l3"><a class="reference internal" href="../TN201611/TN201611.html">Customizing Virtel in V4.56</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id4">2017</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id5">2018</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id6">2019</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id7">2020</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../newsletters.html#id8">2023</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Virtel</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../newsletters.html">Technical Newsletters</a></li>
      <li class="breadcrumb-item active">Nailing LUS with an Identification scenario</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/manuals/newsletters/TN201609/TN201609.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nailing-lus-with-an-identification-scenario">
<span id="tn201609"></span><h1>Nailing LUS with an Identification scenario<a class="headerlink" href="#nailing-lus-with-an-identification-scenario" title="Permalink to this heading">¶</a></h1>
<p><strong>Note: The external programs used in this POC are not officially supported.</strong></p>
<p>The following newsletter explains how to force a LUNAME from within an
identification scenario. The criteria being that the LUNAME is derived
from a computer name passed in the URI as the user data or routing
parameter. Within the Identification Scenario Virtel validates the
computer name against a DNS lookup. If the DNS is successful the
scenario checks to see whether the computer name forms part of the DNS
name. If so it builds a LUNAME by replacing the first character of the
terminal name with the character ‘V’. A session is then established
using this LUNAME. If the DNS validation is unsuccessful the the session
uses a normal LUNAME from the default Virtel pool associated with the
transaction.</p>
<p>For example, given the following two examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Computer</span> <span class="n">name</span><span class="o">=</span><span class="n">TE202B77</span> <span class="n">DNS</span> <span class="n">name</span><span class="o">=</span><span class="n">te202b77</span><span class="o">.</span><span class="n">myCompany</span><span class="o">.</span><span class="n">com</span> <span class="n">IP</span><span class="o">=</span><span class="mf">192.168.1.127</span>
<span class="n">Computer</span> <span class="n">name</span><span class="o">=</span><span class="n">TE202B78</span> <span class="n">DNS</span> <span class="n">name</span><span class="o">=</span><span class="n">temppc</span><span class="o">.</span><span class="n">myCompany</span><span class="o">.</span><span class="n">com</span>   <span class="n">IP</span><span class="o">=</span><span class="mf">192.168.1.128</span>
</pre></div>
</div>
<p>Assume the following:-</p>
<p>The transaction being accessed is a session monitor. Depending on the LU
name will determine the applications available to the user. A user using
computer TE202B77 will be authorised to user all applications. A user
using computer TE202B78 will be restricted to non-authorised
applications only.</p>
<p>User A accesses the 3270 session monitor application using a .bat file
the extracts the computer name and build a URL. The URL is sent to
Virtel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.70.33</span><span class="p">:</span><span class="mi">41002</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">web2ajax</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">mytpx</span><span class="o">+</span><span class="n">TE202B77</span>
</pre></div>
</div>
<p>The Virtel identification scenario traps the inbound call and validates
the computer name against the IP address of the calling computer through
a DNS lookup. In the Virtel log we will see something like:-</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VIRHT51I</span> <span class="n">HTTP</span><span class="o">-</span><span class="n">CLI</span> <span class="n">CONNECTING</span> <span class="n">CLVTA009</span> <span class="n">TO</span> <span class="mf">192.168.001.127</span><span class="p">:</span><span class="mi">53411</span>
<span class="n">Calling</span> <span class="n">SERV3BNK</span> <span class="n">WITH</span> <span class="n">IP</span><span class="o">=</span><span class="mf">192.168.001.127</span><span class="p">,</span><span class="n">LU</span><span class="o">=*</span><span class="n">W2HPOOL</span><span class="p">,</span><span class="n">TERMINAL</span><span class="o">=</span><span class="p">,</span><span class="n">ROUTING</span><span class="o">=</span><span class="n">TE202B77</span>
<span class="n">DNS</span><span class="o">=</span><span class="n">te202b77</span><span class="o">.</span><span class="n">mycompany</span><span class="o">.</span><span class="n">com</span><span class="p">,</span><span class="n">TERMINAL</span><span class="o">=</span><span class="n">TE202B77</span> <span class="n">LUNAME</span><span class="o">=</span><span class="n">VE202B77</span>
<span class="n">VIR0919I</span> <span class="n">CLVTA009</span> <span class="n">RELAY</span> <span class="n">VE202B77</span><span class="p">(</span><span class="n">W2HTP077</span><span class="p">)</span> <span class="n">ACTIVATED</span>
<span class="n">LOGON</span>
</pre></div>
</div>
<p>As the DNS validation is considered successful the LUNAME VE202B77 is
created and will be used to establish a session with the session manager
identified as transaction MYTPX.</p>
<p>User B accesses the 3270 session monitor with the following URI</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.70.33</span><span class="p">:</span><span class="mi">41002</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">web2ajax</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">mytpx</span><span class="o">+</span><span class="n">TE202B78</span>
</pre></div>
</div>
<p>The following messages appear in the log:-</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VIRHT51I</span> <span class="n">HTTP</span><span class="o">-</span><span class="n">CLI</span> <span class="n">CONNECTING</span> <span class="n">CLVTA009</span> <span class="n">TO</span> <span class="mf">192.168.001.128</span><span class="p">:</span><span class="mi">53622</span>
<span class="n">Calling</span> <span class="n">SERV3BNK</span> <span class="n">WITH</span> <span class="n">IP</span><span class="o">=</span><span class="mf">192.168.001.128</span><span class="p">,</span><span class="n">LU</span><span class="o">=*</span><span class="n">W2HPOOL</span><span class="p">,</span><span class="n">TERMINAL</span><span class="o">=</span><span class="p">,</span><span class="n">ROUTING</span><span class="o">=</span><span class="n">TE202B78</span>
<span class="n">DNS</span><span class="o">=</span><span class="n">temppc</span><span class="o">.</span><span class="n">syspertec</span><span class="o">.</span><span class="n">com</span><span class="p">,</span><span class="n">TERMINAL</span><span class="o">=</span><span class="n">TE202B78</span>
<span class="n">VIR0919I</span> <span class="n">CLVTA009</span> <span class="n">RELAY</span> <span class="n">REHVT000</span><span class="p">(</span><span class="n">W2HTP000</span><span class="p">)</span> <span class="n">ACTIVATED</span>
<span class="n">LOGON</span>
</pre></div>
</div>
<p>The DNS validation is considered to have been unsuccessful as the
computer name does not form part of the DNS named return following a
lookup by the IP address of the terminal. The LU assigned to the session
will be the next free LU in the pool associated with the transaction.</p>
<p>Based upon the LUNAME passed to the session manager will determine the
applications listed.</p>
<p><strong>Installation</strong></p>
<ol class="arabic">
<li><p>Install Virtel V4.56. This is required to support the Identification scenario delivered in this package. See the Technical Newsletter - <a class="reference internal" href="../TN201608/TN201608.html#tn201608"><span class="std std-ref">“Installing Virtel V4.56 from scratch”</span></a> for further information.</p></li>
<li><p>Download TBANKEN.TRS from the Virtel FTP Server or save the TRS file if sent via email.</p></li>
<li><p>Upload to the mainframe into a dataset with the following DCB attributes:-</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LRECL</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span><span class="n">BLKSIZE</span><span class="o">=</span><span class="mi">6144</span><span class="p">,</span><span class="n">RECFM</span><span class="o">=</span><span class="n">FB</span><span class="p">,</span><span class="n">DSN</span><span class="o">=</span><span class="n">HLQ</span><span class="o">.</span><span class="n">TBANKEN</span><span class="o">.</span><span class="n">TRS</span>
</pre></div>
</div>
</li>
<li><p>Run the following job. This will unterse the file and install the package libraries that are associated with this newsletter. Here is some sample JCL. Change accordingly.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">jobcard</span> <span class="n">JOB</span> <span class="mi">9000</span><span class="p">,</span><span class="s1">&#39;ED...HOLT...&#39;</span><span class="p">,</span><span class="n">CLASS</span><span class="o">=</span><span class="n">A</span><span class="p">,</span><span class="n">MSGCLASS</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">NOTIFY</span><span class="o">=&amp;</span><span class="n">SYSUID</span>
<span class="o">//</span><span class="n">S01</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">IEFBR14</span>
<span class="o">//</span><span class="n">DDA</span> <span class="n">DD</span> <span class="n">UNIT</span><span class="o">=</span><span class="n">SYSDA</span><span class="p">,</span>
<span class="o">//</span> <span class="n">DSN</span><span class="o">=</span><span class="n">HLQ</span><span class="o">.</span><span class="n">TBANKEN</span><span class="o">.</span><span class="n">TEMP</span><span class="p">,</span><span class="n">DISP</span><span class="o">=</span><span class="p">(</span><span class="n">MOD</span><span class="p">,</span><span class="n">DELETE</span><span class="p">),</span>
<span class="o">//</span> <span class="n">SPACE</span><span class="o">=</span><span class="p">(</span><span class="n">TRK</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="o">//</span><span class="n">S02</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">TRSMAIN</span><span class="p">,</span><span class="n">PARM</span><span class="o">=</span><span class="n">UNPACK</span>
<span class="o">//</span><span class="n">SYSPRINT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
<span class="o">//</span><span class="n">INFILE</span> <span class="n">DD</span> <span class="n">DSN</span><span class="o">=</span><span class="n">HLQ</span><span class="o">.</span><span class="n">TBANKEN</span><span class="o">.</span><span class="n">TRS</span><span class="p">,</span><span class="n">DISP</span><span class="o">=</span><span class="n">SHR</span>
<span class="o">//</span><span class="n">OUTFILE</span> <span class="n">DD</span> <span class="n">UNIT</span><span class="o">=</span><span class="n">SYSDA</span><span class="p">,</span>
<span class="o">//</span> <span class="n">DSN</span><span class="o">=</span><span class="n">HLQ</span><span class="o">.</span><span class="n">TBANKEN</span><span class="o">.</span><span class="n">TEMP</span><span class="p">,</span><span class="n">DISP</span><span class="o">=</span><span class="p">(,</span><span class="n">CATLG</span><span class="p">),</span>
<span class="o">//</span> <span class="n">SPACE</span><span class="o">=</span><span class="p">(</span><span class="n">CYL</span><span class="p">,(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">RLSE</span><span class="p">)</span>
<span class="o">//</span><span class="n">S03</span> <span class="n">EXEC</span> <span class="n">PGM</span><span class="o">=</span><span class="n">ADRDSSU</span><span class="p">,</span><span class="n">REGION</span><span class="o">=</span><span class="mi">0</span><span class="n">M</span><span class="p">,</span><span class="n">COND</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">NE</span><span class="p">)</span>
<span class="o">//</span><span class="n">SYSPRINT</span> <span class="n">DD</span> <span class="n">SYSOUT</span><span class="o">=*</span>
<span class="o">//</span><span class="n">IN</span> <span class="n">DD</span> <span class="n">DSN</span><span class="o">=</span><span class="n">HLQ</span><span class="o">.</span><span class="n">TBANKEN</span><span class="o">.</span><span class="n">TEMP</span><span class="p">,</span><span class="n">DISP</span><span class="o">=</span><span class="n">SHR</span>
<span class="o">//</span><span class="n">OUT</span> <span class="n">DD</span> <span class="n">UNIT</span><span class="o">=</span><span class="n">SYSDA</span><span class="p">,</span><span class="n">VOL</span><span class="o">=</span><span class="n">SER</span><span class="o">=</span><span class="n">VVVVVV</span><span class="p">,</span><span class="n">DISP</span><span class="o">=</span><span class="n">SHR</span>
<span class="n">RESTORE</span> <span class="n">INDDNAME</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span> <span class="o">-</span>
<span class="n">OUTDD</span><span class="p">(</span><span class="n">OUT</span><span class="p">)</span> <span class="o">-</span>
<span class="n">DATASET</span><span class="p">(</span><span class="n">INCLUDE</span><span class="p">(</span><span class="o">**</span><span class="p">))</span> <span class="o">-</span>
<span class="n">RENAMEU</span><span class="p">(</span> <span class="o">-</span>
<span class="p">(</span><span class="n">SPTHOLT</span><span class="o">.**</span><span class="p">,</span><span class="n">HLQ</span><span class="o">.**</span><span class="p">)</span> <span class="o">-</span>
<span class="p">)</span> <span class="o">-</span>
<span class="n">CATALOG</span> <span class="n">BYPASSACS</span><span class="p">(</span><span class="o">**</span><span class="p">)</span> <span class="n">NMC</span> <span class="n">NSC</span> <span class="n">CANCELERROR</span>
</pre></div>
</div>
<p>The following two libraries should now exist:-</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">userid</span><span class="o">.</span><span class="n">TBANKEN</span><span class="o">.</span><span class="n">LOADLIB</span>
<span class="n">userid</span><span class="o">.</span><span class="n">TBANKEN</span><span class="o">.</span><span class="n">CNTL</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Copy the members in userid.TBANKEN.LOADLIB to your Virtel 4.56
library. There should be three members:-</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SCEN3BNK</span> <span class="o">-</span> <span class="n">Assembled</span> <span class="n">Identification</span> <span class="n">Scenario</span>
<span class="n">SERV3BNK</span> <span class="o">-</span> <span class="n">Service</span> <span class="n">program</span> <span class="n">called</span> <span class="k">with</span> <span class="n">the</span> <span class="n">Identification</span> <span class="n">Scenario</span>
<span class="n">VIRT3BNK</span> <span class="o">-</span> <span class="n">Virtel</span> <span class="n">utility</span> <span class="n">program</span> <span class="n">that</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">following</span> <span class="n">functions</span><span class="p">:</span><span class="o">-</span>

  <span class="n">GETHOSTBA</span> <span class="n">Lookup</span> <span class="n">name</span> <span class="n">by</span> <span class="n">IP</span> <span class="n">address</span><span class="o">.</span>
  <span class="n">GETHOSTBN</span> <span class="n">Lookup</span> <span class="n">IP</span> <span class="n">address</span> <span class="n">by</span> <span class="n">DNS</span> <span class="n">name</span><span class="o">.</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>The userid.TBANKEN.CNTL contains the Identification Scenario source
and some utility jobs. See the Scenario section for a listing of the
Identification Scenario. Copy the scenario source (SCEN3BNK) to your
userid .VIRTEL.CNTL library</p></li>
</ol>
<p><strong>Virtel Configuration</strong></p>
<p><em>Identification Scenario</em></p>
<p>To use this package we have to associate the Identification Scenario
with the line:port that we will be calling in on. In our example we are
using the line C-HTTP which is associated with Entry Point CLIWHOST. I
have updated the Entry Point and added the Identification Scenario
SCEN3BNK.</p>
<p><a class="reference internal" href="../../../_images/image138.png"><img alt="image0" src="../../../_images/image138.png" style="width: 6.30000in; height: 4.00486in;" /></a></p>
<p><em>Terminal definitions</em></p>
<p>For each terminal that we are going to dedicate a LU to we need to add a
terminal definition and associate it with a pool. Here is an example of
the terminal definitions required to support terminals in the LU ranges
VE202B00-FF and VE202C00-FF.</p>
<p><a class="reference internal" href="../../../_images/image224.png"><img alt="image1" src="../../../_images/image224.png" style="width: 6.30000in; height: 3.99375in;" /></a></p>
<p><em>Scenario</em></p>
<p>The identification scenario is responsible for validating the computer
name passed in the URI as the userdata parameter. The following is an
extract from the SCEN3BNK scenario which handles the DNS validation:-</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>* ---------------------------------------------------------------------
* Call GETHOSTBA function to retrieve DNS name given IP address -
* ---------------------------------------------------------------------
        COPY$ VALUE-TO-VARIABLE,VAR=&#39;FUNCTION&#39;,VALUE=&#39;GETHOSTBA&#39;                 &lt; 1
        COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,USER-IP-ADDRESS),          *    &lt; 2
          VAR=&#39;PARM1&#39;,TYPE=REPLACE
        COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,RELAY),                    *    &lt; 3
          VAR=&#39;PARM2&#39;,TYPE=REPLACE
        COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,QUERY),                    *    &lt; 4
          VAR=&#39;PARM3&#39;,TYPE=REPLACE
        COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,ROUTING-PARAMETER),        *    &lt; 5
          VAR=&#39;PARM4&#39;,TYPE=REPLACE
*
        COPY$ SYSTEM-TO-VARIABLE,FIELD=(VALUE-OF,TRANSACTION-EXTERNAL),     *    &lt; 6
          VAR=&#39;TRANSACTION&#39;,TYPE=REPLACE
        CASE$ &#39;TRANSACTION&#39;,(BEGIN,&#39;TSO&#39;,CALLIT),ELSE=FINISH                     &lt; 7
CALLIT  EQU *
        ERROR$ 0,&#39;Calling SERV3BNK WITH IP=&#39;,                               *    &lt; 8
          &#39;*PARM1&#39;,&#39;,LU=&#39;,&#39;*PARM2&#39;,&#39;,QUERY=&#39;,&#39;*PARM3&#39;,                      *
          &#39;,ROUTING=&#39;,&#39;*PARM4&#39;

        VIRSV$ CALL-REUSE,(&#39;SCEN3BNK&#39;,&#39;SERV3BNK&#39;),                          *    &lt; 9
            (IN-VARIABLE,&#39;FUNCTION&#39;),                                       *
            (IN-VARIABLE,&#39;PARM1&#39;),                                          *
            (OUT-VARIABLE,&#39;RESULT&#39;,256),                                    *
            TASKS=1,                                                        *
            KEY=8,                                                          *
            ERROR=KO
            ERROR$ 0,&#39;DNS=&#39;,&#39;*RESULT&#39;,&#39;,TERMINAL=&#39;,&#39;*PARM4&#39;                      &lt; 10
            CONVERT$ EBCDIC-TO-UPPERCASE,VAR=&#39;RESULT&#39;                            &lt; 11
            CONVERT$ EBCDIC-TO-UPPERCASE,VAR=&#39;PARM4&#39;                             &lt; 12
            CASE$ &#39;RESULT&#39;,(CONTAINS,&#39;*PARM4&#39;,OK),ELSE=KO                        &lt; 13
OK      EQU *
*
        COPY$ VARIABLE-TO-VARIABLE,                                        *     &lt; 14
              VAR=(&#39;PARM4&#39;,&#39;MYSUFFIX&#39;),                                    *
              OFFSET=1,LENGTH=7,PAD=&#39; &#39;,TYPE=REPLACE
        COPY$ LIST-TO-VARIABLE,LIST=(&#39;V&#39;,&#39;*MYSUFFIX&#39;),                     *     &lt; 15
              VAR=MYLUNAME
*
        ERROR$ 0,&#39;LUNAME=&#39;,&#39;*MYLUNAME&#39;                                           &lt; 16
        COPY$ VARIABLE-TO-SYSTEM,FIELD=(VALUE-OF,ROUTING-PARAMETER),       *     &lt; 17
              VAR=&#39;MYLUNAME&#39;
        GOTO$ FINISH                                                       *     &lt; 18
KO      EQU *
FINISH  EQU *
</pre></div>
</div>
<p><strong>Logic</strong></p>
<ol class="arabic simple">
<li><p>Create variable FUNCTION and set to GETHOSTBA. This is the
GetHostByAddress utility function that will called from within the
VIRTUTIL utility module.</p></li>
<li><p>Get the callers IP Address and place in variable PARM1.</p></li>
<li><p>Get the callers allocated LUNAME pool and place in variable PARM2.</p></li>
<li><p>Get the callers query parameters and place in variable PARM3.</p></li>
<li><p>Get the callers terminal name(userdata) and place in variable PARM4.</p></li>
<li><p>Get the callers transaction and place in variable TRANSACTION.</p></li>
<li><p>If TRANSACTION begins with TSO continue, else exit scenario.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This will have to be changed to support the transaction you want to nail LUs to.</p>
</div>
<ol class="arabic simple" start="8">
<li><p>Debugging message.</p></li>
<li><p>Call VIRSV program and pass parameters. This will call program
SCEN3BNK which will interface with the VIRTEL Utility program
VIRT3BNK. The RESULT variable will contain the result of the
GETHOSTBA call. If a non-zero return code is returned then the
Identification Scenario is terminated.</p></li>
<li><p>Debugging message.</p></li>
<li><p>Convert RESULT to uppercase.</p></li>
<li><p>Convert PARM4 to uppercase.</p></li>
<li><p>Validate the terminal name against the returned DNS name. If successful continue else exit Identification Scenario.</p></li>
<li><p>Copy characters 1-7 of terminal name to variable MYSUFFIX.</p></li>
<li><p>Prefix MYSUFFIX variable with character ‘V’ and create variable MYLUNAME.</p></li>
<li><p>Debugging message.</p></li>
<li><p>Set System variable ROUTING-PARAMETER with the contents of variable MYLUNAME.</p></li>
<li><p>Exit Identification Scenario.</p></li>
</ol>
<p><strong>Calling the browser</strong></p>
<p>The following *.bat file obtains the computer name and takes the first 8 characters and places them into the URI before calling the browsers.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">title</span> <span class="mi">3</span><span class="n">Banken</span> <span class="n">Sample</span> <span class="n">bat</span> <span class="n">file</span> <span class="n">passing</span> <span class="n">the</span> <span class="n">terminal</span> <span class="n">name</span>
<span class="nd">@echo</span> <span class="n">on</span>
<span class="n">color</span> <span class="mi">1</span><span class="n">f</span>
<span class="bp">cls</span>
<span class="n">SET</span> <span class="n">P1</span><span class="o">=%</span><span class="n">COMPUTERNAME</span><span class="p">:</span><span class="o">~</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="o">%</span>
<span class="n">echo</span> <span class="o">%</span><span class="n">P1</span><span class="o">%</span>
<span class="n">start</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.170.33</span><span class="p">:</span><span class="mi">41002</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">web2ajax</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span>\ <span class="o">**</span><span class="n">mytpx</span><span class="o">**</span>\ <span class="o">+%</span><span class="n">P1</span><span class="o">%</span>
<span class="o">&amp;</span><span class="n">goto</span><span class="p">:</span><span class="n">eof</span>
<span class="p">:</span><span class="n">exit</span>
<span class="n">rem</span> <span class="k">if</span> <span class="n">mozilla</span> <span class="ow">is</span> <span class="n">installed</span>
<span class="n">rem</span> <span class="n">If</span> <span class="n">exist</span> <span class="s2">&quot;%PROGRAMFILES(X86)%</span><span class="se">\\</span><span class="s2">mozilla firefox</span><span class="se">\\</span><span class="s2">firefox.exe&quot;</span> <span class="n">start</span>
<span class="n">firefox</span><span class="o">.</span><span class="n">exe</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.170.33</span><span class="p">:</span><span class="mi">41002</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">web2ajax</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">mytpx</span><span class="o">+%</span><span class="n">P1</span><span class="o">%</span>
<span class="o">&amp;</span><span class="n">goto</span><span class="p">:</span><span class="n">eof</span>
<span class="n">rem</span> <span class="k">if</span> <span class="n">ie</span> <span class="ow">is</span> <span class="n">installed</span>
<span class="n">rem</span> <span class="n">If</span> <span class="n">exist</span> <span class="s2">&quot;%PROGRAMFILES(X86)%</span><span class="se">\\</span><span class="s2">internet explorer</span><span class="se">\\</span><span class="s2">iexplore.exe&quot;</span>
<span class="n">start</span> <span class="n">iexplore</span><span class="o">.</span><span class="n">exe</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.170.33</span><span class="p">:</span><span class="mi">41002</span><span class="o">/</span><span class="n">w2h</span><span class="o">/</span><span class="n">web2ajax</span><span class="o">.</span><span class="n">htm</span><span class="o">+</span><span class="n">mytpx</span><span class="o">+%</span><span class="n">P1</span><span class="o">%</span> <span class="o">&amp;</span><span class="n">goto</span><span class="p">:</span><span class="n">eof</span>
<span class="n">rem</span> <span class="p">:</span><span class="n">EXIT</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Change the transaction to the transaction that you wish to nail LUs to. In this example the transaction is mytpx.*</p>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../TN201608/TN201608.html" class="btn btn-neutral float-left" title="Installing Virtel V4.56 from scratch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../TN201611/TN201611.html" class="btn btn-neutral float-right" title="Customizing Virtel in V4.56" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Syspertec. All rights reserved.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>