2020/02
Customizing V4.59 from scratch

In this newsletter we discuss the various customization options and features that can be applied to Virtel following a clean installation.

Customized Parameters, JavaScript, CSS and Help templates
In this section we see how to customize Virtel to use customized parameters and introduce the ‘option’ mode. We show how to set up some “global” parameter settings which will override the Virtel internal defaults. 
With regard to customization Virtel supports three modes of operation: -
* Default mode:	Delivered mode of operation	
* Option mode:	Recommended mode of operation. V4.56 upwards.	
* Compatibility mode:  To provide “backward” compatibility for older versions of Virtel (V4.56 and less).

Compatibility Mode
From Virtel V.56 onwards, compatibility mode is enforced through the following statement in the TCT:-
HTSET1=(OPTION-DEFAULT-COMPATIBILITY),                  *  
Compatibility mode changes the search order Virtel uses when locating customized parameters, CSS, JavaScript and Help elements. Compatibility mode is used to support older versions of Virtel and also provides backward level support when migrating to new versions of Virtel. It is recommended that ‘compatibility’ users migrate to the ‘Option’ mode to take advantage of new Virtel features.

What can be customized
There are several HTML entities that can be customized to provide features and functions that are site specific. For example, company logos in some of the presentation templates, customized ICONS on the Virtel toolbar that can launched bespoke JavaScript procedure and user Fonts and display styles. These and many more options can be set through customized JavaScript, Virtel Parameters, Cascading Style Sheets (CSS) and Help templates. 
Delivered Ports
As delivered, Virtel defines two access ports, 41001 and 41002. It is important to note that 41001, by default, should only be used for the Administration of Virtel. It should not be used to support customer transactions. Port 41002, and any other port, can be used to support customer transactions. Port 41002 is delivered as a “customized” access point to support customers applications. For example, CICS, TSO and IMS based applications.   
 Virtel Parameters
Customisation of Virtel begins with understanding the defaults programmatically built into Virtel. These are listed in Appendix A of the user guide. All Virtel parameter defaults are set internally within a JavaScript object called w2hParm. Users can override these default options through the use of a JavaScript file called w2hparm.js. A sample w2hparm.js file can be found in both the delivered CLI-DIR and W2H-DIR directories. The following URLs can be used to show the contents of the member: -
For the W2H Administration port (41001) use the following URL  :-
http://192.168.170.48:41001/w2h/w2hparm-js/w2hparm.js
// w2hparm.js (W2H-DIR)
// w2h parameters to override or hide.
//
// NOTE: this file is a sample and will be replaced after a new install.
// please see the documentation on possible parameter values
// and on how to set this file up in CLI-DIR instead of W2H-DIR
//
var w2hparm = {};      // empty object: no overrides
//
// sample values:
//  "font":"Droid Sans Mono",
//  "ctrl":"ENTER",
//  "ctrl":"Newline",
//  "enter":"Newline",
//  "enter":"ENTER",
// sample:
// var w2hparm = {"ctrl":"no","enter":"ENTER"};
//
// w2hparm parameters to hide (e.g "home" and "shiftins")
// Remove the // and update the items
// var w2hparmHide = ["home","shiftins"];

Here you can see that an empty object is defined with no overriding defaults.  For the customer port, or the CLI User line (41002), use the following :-

http://192.168.170.48:41002/w2h/w2hparm-js/w2hparm.js
// w2hparm default values
// see w2hparmdefns in js01.js for parameters and allowable values
var w2hparm = {
  "settingsGUI":{"version":"v2"},
  "font":"Droid Sans Mono",
  "fontsize":"window",
  "ctrl":"ENTER",
  "enter":"Newline",
  "home":"Home",
  "end":"ErEof",
  "shiftins":"Dup",
  "shifthome":"FieldMark",
  "shiftend":"End",
  "ctrlins":"PA1",
  "ctrldel":"PA2",
  "ctrlend":"End",
  "pgup":"PF7",
  "pgdn":"PF8",
  "pause":"CLEAR",
  "style":"3270"};
// w2hparm parameters to hide (e.g "home" and "shiftins")
// Remove the // and update the items
// var w2hparmHide = ["home","shiftins"];

Here you can see that some of the defaults have been overridden with “customer” options and settings. At this point line 41001 and 41002 both have different w2hparm settings. For line 41001 we have no overrides, and for 41002, we have set some specific customer options. In the following sections we look at this can be altered so that common Virtel parameters can be set globally, or set at a line or port level, or even at a transaction level.  

Defining the Virtel parameter location 
For any Virtel Port, the location of w2hparm.js file is determined by the transaction XXX-03P where XXX defines the entry point transaction prefix. As delivered, there are two main entry points, WEB2HOST with a transaction prefix of W2H and CLIWHOST with a transaction prefix of CLI. Within these Entry Points we will find W2H-03P and CLI-03P transactions.

Figure 1 -  Example of CLI-03P transaction
CLI-03P locates w2hparm.js from the CLI-DIR, as defined in the Application setting. For the W2H-03P transaction, the w2hparm.js file will be found in the W2H-DIR directory. To use only one copy of the w2hparm.js member for both directories we can modify the Application setting in W2H-03P transaction and set it to CLI-DIR. 
Note: It is recommended that the Application parameter for the W2H-03P transaction be modified to point to the CLI-DIR after installation. This safeguards against potential loss of customized parameters following any future migration. The CLI-DIR is associated with the HTMLTRSF VSAM file which is not overwritten during a migration process, whereas the W2H-DIR is associated with the SAMPTRSF VSAM file which is updated during migration, so any changes here would be lost. To modify the W2H-03P transaction use either the online Administration Portal, found on port 41001, or run the following batch job. If you are running the batch job Virtel must be down :-
//*                                                               
// SET LOAD=SPTHOLT.VIRT459.LOADLIB                               
// SET ARBO=SPTHOLT.VIRT459.ARBO                                  
//*                                                               
//CONFIG  EXEC PGM=VIRCONF,PARM='LOAD,REPL',REGION=2M             
//STEPLIB  DD  DSN=&LOAD,DISP=SHR                                 
//SYSPRINT DD  SYSOUT=*                                           
//SYSUDUMP DD  SYSOUT=*                                           
//VIRARBO  DD  DSN=&ARBO,DISP=SHR                                 
//SYSIN      DD *                                                 
         TRANSACT ID=W2H-03P,                                     
         NAME='w2h',                                              
         DESC='Directory for w2hparm.js',                         
         APPL=CLI-DIR,                                            
         TYPE=4,                                                  
         TERMINAL=DELOC,                                          
         STARTUP=2,                                               
         SECURITY=0,                                              
         LOGMSG='/w2h/w2hparm-js'    

To run this job, stop Virtel first. Also, after making any changes, refresh the browser cache to pull in any new updates. 

After updating the W2H-03P transaction, all W2H transactions and CLI transactions will use the w2hparm settings of the w2hparm.js file located in CLI-DIR. This can be considered the default position with regard to customization. Any future Virtel upgrades or migrations will not affect the customised settings.  

At this point both Ports 41001 and 41002 will be using a common set of Virtel parameters. The default options and those overrides defined in the w2hparm.js file, maintained in the CLI-DIR directory. For some customers this is all that is required from the requirement to have a global set of Virtel Parameters, therefore no further customization is necessary. If a new line and Entry point are added, then the XXX-03P transaction within the new Entry point just needs to refer to CLI-DIR to pick up the global parameters. In the following sections we look how to further expand setting parameters at both the Entry point (“Global”) level and transaction level using the “option” mode. 


Defining “Option” mode

By using “option” mode we can target Virtel entities at an Entry Point level and Transaction level. The “option” mode provides greater flexibility and granularity on the entity values allows us to configuring parameters for specific needs. First, we will look at setting up a “Global” settings environment using Global “Option” mode definitions. 
Global Option Mode
The following “Global” entities can be defined within the “global-settings“ object through the use of  “pathToxxxxxx” attributes. Note that the name of the attributes is “case sensitive”: -
* pathToW2haprm	Parameters that override the default Virtel W2hparm settings.
* pathToCssCustom	Customized Cascade Style Sheets
* pathToJsCustom	Customized JavaScript code
* pathToHelp		Customized Help templates
* pathToPrintCss		Customized Print Style Sheets

The following is and example of setting the global-settings path for parameters, JavaScript, CSS and Help templates in the w2hparm.js file.
// My Global options . . .
var w2hparm = {
	"global-settings":{
		“pathToW2hparm”: “../option/w2hparm.global.js”,
		"pathToJsCustom":"../option/custJS.global.js",
		"pathToCssCustom": "../option/custCSS.global.css",
		"pathToHelp": "../option/myHelp.html"
	}
}

We modify our w2hparm.js file in the CLI_DIR directory to include a “global-settings” object and remove the other parameter overrides. This w2hparm.js file now only defines the path to our global w2hparm overrides. The w2hparm.js file now looks like this: -
//var w2hparm = {};
var w2hparm = {
     "global-settings":{
        "pathToW2hparm":"../option/w2hparm.global.js"        
     }
};                 


As you can see, it has a “global” array which directs us to the /option/ directory. The “option” directory is already predefined as part of the Virtel deliverable. It is defined as transaction CLI-03CO within the CLIWHOST entry point: -

Figure 2 - Option Directory Transaction
The ‘option’ directory stores related settings within the CLI-DIR which is associated with the HTMLTRSF VSAM file. We know this because if we list the directories, we can see that HTMLTRSF is the physical DDNAME associated with the Virtel directory CLI-DIR: -

Figure 3 - DDNames associated with Virtel Directories
We now need to create a global parameters file called w2hparm.global.js. This parameter file will be the equivalent to the our original w2hparm.js file, and will contain the same Virtel parameter overrides.
// w2hparm.global.js (CLI-DIR)
// w2h parameters to override defaults.
var w2hparm = {
  "ctrl":"Newline",  
  "font":"DejaVu Sans Mono",
};

The w2hparm.global.js and w2hparm.js files are both uploaded to the CLI-DIR, the directory associated with the ‘option’ transaction CLI-03CO. Stop and restart Virtel and refresh the cache (CTRL-R) and then then check that the correct w2hparm is being used. 
As before, use the URL that was used before to display the w2hparm.js file.
http://192.168.170.48:41001/w2h/w2hparm-js/w2hparm.js
// NOTE: this file is a sample and will be replaced after a new install.
// please see the documentation on possible parameter values
// and on how to set this file up in CLI-DIR instead of W2H-DIR
//
//var w2hparm = {};
var w2hparm = {
     "global-settings":{
        "pathToW2hparm":"../option/w2hparm.global.js"        
     }
};

Now our new “Global” path is in play, pointing to our wh2hparm.global parameter file. We can also check that the correct global parameter file is loaded by using the following url: -
http://192.168.170.48:41002/option/w2hparm.global.js
The output from this display should show the options defined in the w2hparm.global.js.

Figure 4: Display of global w2hparm options

                               


Appmenu option mode

A special case with Virtel is the customization of the application menu. Any bespoke changes to the appmenu presentation can be defined in an option.appmenu.js file. In the following example we demonstrate how to change appmenu presentation by modifying the associated appmenu CSS. 
First, create the option.appmenu.js file with the following CSS entry :-
// customization for option=appmenu
var oCustom={"pathToCssCustom":"../option/custCSS.appmenu.css"}   
 
Upload it to the OPT directory. Now create the following CSS file custCSS.appmenu.css and upload that to the OPT directory. In this customized CSS we have hidden the transaction application name. Our custCSS.appmenu.css should contain the following statements : -
/* Hide application name for Appmenu Display */
 tr.appmenuitem td:nth-child(4) {display:none}

Now, when displaying the appmenu, we have the following display. The application name has been removed and only the transaction description along with the external name is shown. 


   

Local parameter settings

By default, the majority of settings listed in “Appendix A” can be set by each user through the Virtel Access Settings control panel. The settings ICON, a geared wheel located on the Virtel Toolbar, is normally displayed on 3270 based application displays. Selecting this ICON will open the Access settings display.
 
Figure 5: Virtel Web Access Settings Panel
When a user changes a setting, the change is preserved in the browser “local Storage” so that the next time the browser is opened the changed setting can be loaded from “local Storage” and used to support the new Virtel sessions. Changes made “locally” by a user will override the “global settings”.
Although settings are persisted in the browser’s local storage, they aren’t necessarily protected from being destroyed. For example, if the browsers cache is cleared the settings will be lost. Also, each browser has its own local storage so settings could well be different if a user opens a browser in “Firefox” and another in “Chrome”.  
To get around the problems of user setting management two options are available: -
* Export/Import Settings
* Setup the USERPARM feature 

Export/Import settings
Settings can be exported to a “flat file” and then subsequently “imported”. 
Exporting to a local file 
When exporting settings, a file called VWA-settings.json will be written to the browser’s default download file directory. For security, this directory is the only directory that the browser has write access to.
Import from a local file  
To import the settings file, click the import button. A filesystem dialog will open allowing you to select the directory where settings JSON file to be imported resides. 
The contents of the JSON settings file will look very much like an object definition. Here is the contents of VWA-settings.json after changing the “Cursor” attribute to “”Bar”.

Figure 6: Example of an exported settings file
Note that only the settings that the user has modified are saved in local storage or an exported settings file.

USERPARM feature

The other option to persist user settings is through the use of the Virtel’s USERPARM feature. This has the advantage in that it is not browser or PC related. The user’s settings are held on the mainframe within a Virtel directory, backed by a physical VSAM file. The settings will be downloaded to the browser when a user connects. Equally, if a user updates their settings the changes will be uploaded to the mainframe for persistence. A timestamp compare is used to determine whether settings should be downloaded to the browser session, or uploaded to the mainframe should the user make local changes.
The only caveat to using the USERPARM feature is that the user must be known to the security subsystem and the Virtel transactions invoked must be secure – i.e. have at least basic security, security=1 defined. Virtel uses the user’s USERID as a key to locate the settings parameters. 
Setting up USERPARM
1. Run the following JCL: -
//        SET  LOAD=SPTHOLT.VIRT459.LOADLIB
//        SET  ARBO=SPTHOLT.VIRT459.ARBO
//*----------------------------------------------------------------*
//* JCL required to allocate a USERPARM TRSF file.                 *
//*----------------------------------------------------------------*
//*                                                                *
//* Before execution, change the following:-                       *
//*      'vvvvvv'   The name of the volume for the USERPARM TRSF   *
//*      'SPTHOLT'  Your high level qualifer                       *
//*      'nnn'    ' The Virtel release. For example 459            *
//*                                                                *
//*----------------------------------------------------------------*
//*                                                                *
//* Post tasks                                                     *
//*                                                                *
//* After running this job you must add the VSAM definitions for   *
//* USER.TRSF to the TCT.                                          *
//*                                                                *
//* Add:-                                                          *
//*            UFILE3=(USERTRSF,ACBH3,0,10,05),                    *
//*            ...                                                 *
//*   ACBH3    ACB   AM=VSAM,DDNAME=USERTRSF,MACRF=(SEQ,DIR),      *
//*            STRNO=3                                             *
//*                                                                *
//*----------------------------------------------------------------*
//* STEP 1 : Define the USERPARM TRSF                              *
//*----------------------------------------------------------------*
//STEP1   EXEC PGM=IDCAMS
//SYSPRINT DD  SYSOUT=*
//SYSIN    DD  *
 DELETE  (SPTHOLT.VIRT459.USER.TRSF) CLUSTER PURGE
 SET MAXCC = 0
 DEFINE CLUSTER (-
       NAME (SPTHOLT.VIRT459.USER.TRSF) -
       VOL (SPT30B) -
       SHR (2) -
       KEYS (16 0) -
       RECSZ (100 32758)) -
    DATA (NAME(SPTHOLT.VIRT459.USER.TRSF.DATA) -
          SPANNED -
          TRACKS(200 200) -
          CISZ(32768)) -
    INDEX (NAME(SPTHOLT.VIRT459.USER.TRSF.INDEX) -
           CISZ(512))
/*
//*----------------------------------------------------------------*
//* STEP 2 : INITIALIZE THE TRSF                                   *
//*----------------------------------------------------------------*
//STEP2   EXEC PGM=IDCAMS
//SYSPRINT DD  SYSOUT=*
//INIT     DD  DATA,DLM=AA
$$$$IWS.WORKREC.INW$TEMP
AA
/*
//TRSF     DD DSN=SPTHOLT.VIRT459.USER.TRSF,DISP=SHR
//SYSIN    DD *
 REPRO INFILE(INIT) OUTFILE(TRSF)
/*
//VIRLOAD EXEC PGM=VIRCONF,PARM='LOAD,REPL',REGION=2M
//STEPLIB  DD  DISP=SHR,DSN=&LOAD
//VIRARBO  DD  DISP=SHR,DSN=&ARBO
//SYSPRINT DD  SYSOUT=*
      SUBDIR   ID=USERPARM,
               DESC='USERPARM directory',
               DDNAME=USERTRSF,
               KEY=UPRMS,
               NAMELEN=0064,
               AUTHUP=X,
               AUTHDOWN=X,
               FSTYPE=V,
               AUTHDEL=X
      TRANSACT ID=W2H-00P,
               DESC='User Parameters directory',
               NAME=USERPARM,
               APPL=USERPARM,
               TYPE=4,
               TERMINAL=DELOC
      TRANSACT ID=W2H-74,
               DESC='Upload to USERPARM directory',
               NAME=uplparms,
               APPL=VIR0041C,
               TYPE=2,
               TERMINAL=DELOC,
               STARTUP=2,
               SECURITY=1,
               LOGMSG=USERPARM
      TRANSACT ID=CLI-00P,
               DESC='User Parameters directory',
               NAME=USERPARM,
               APPL=USERPARM,
               TYPE=4,
               TERMINAL=CLLOC
/*

This will add the centralized USERPARM settings required to save user definitions on the mainframe. This includes a new USERPARM directory, some transactions and a new TRSF VSAM  file.

2. Next, update and assemble the TCT to include the definitions to support the new VSAM TRSF file.

	*
		. . .
               VIRSECU=YES,SECUR=(RACROUTE,RACF),                      *
               UPARMS=(USERPARM),                                      *
               RAPPL=FACILITY,RNODE=FACILITY,PRFSECU=VIRTEL,           *
               UFILE1=(SAMPTRSF,ACBH1,0,10,01),                        *
               UFILE2=(HTMLTRSF,ACBH2,0,10,01),                        *
               UFILE3=(USERTRSF,ACBH3,0,10,01),                        *
               GATE=GENERAL,                                           *
		. . .	

* ============================================================          
ACBH1    ACB   AM=VSAM,DDNAME=SAMPTRSF,MACRF=(SEQ,DIR,OUT,LSR), *
               STRNO=3                                                  
ACBH2    ACB   AM=VSAM,DDNAME=HTMLTRSF,MACRF=(SEQ,DIR,OUT,LSR), *
               STRNO=3                                                  
ACBH3    ACB   AM=VSAM,DDNAME=USERTRSF,MACRF=(SEQ,DIR,OUT,LSR), *
               STRNO=3                                                  
         END                                                            

3. Stop Virtel and add the USERTRSF DD statement to the JCL, pointing to the newly allocated TRSF file.
4. Restart Virtel. Refresh the cache (CTRL+SHIFT+DEL).
5. Open a secure 3270 session, in our example we use TSO transaction in CLIWHOST. The security credentials are entered and we are logged into TSO.
6. A change is then made to the Virtel settings, we set the cursor display from BOX back to BLOCK. 
In the Virtel log we can see that the change has been uploaded and logged into the USERPARM TRSF: -
  VIRU122I CLVTA079 FILE UPLOAD : ENTRY POINT 'CLIWHOST' DIRECTORY 'USERP
750                                                                    
ARM' USER 'SPTHOLT             '                                       
       FILE : '8393DD4A16F0E1C9723F9D9CFA2C39F1'                       

7. We shut the browser, restart it, refresh the cache, and then load our TSO application from the APPSTAT menu on 41002, CLIWHOST entry point. On displaying the settings, it still shows “Cursor=BLOCK” which is what we want. This setting could only have come down from the mainframe when we established our TSO session. It is not the default setting for “Cursor” and local storage had been cleared through the refresh of the cache.
8. If we look at the local storage we can see it has been populated with our settings from the mainframe: -
 

Example of changing defaults	
Open a session browser and display the current settings. In the browser debugger (PF12 in the URL bar) we can see that we have a dummy w2hparm object – w2hparm  {}.









Administration has set the following defaults and created a new w2h.global.js file.

The w2h.global.js file looks like: -

// w2hparm.global.js (CLI-DIR)
// w2h parameters to override defaults and add DDI macro support.
var w2hparm = {"ctrl":"Newline",
"enter":"ENTER",
"pgup":"PF7",
"pgdn":"PF8",
"useVirtelMacros":{"macrosAutoRefresh":"session"}};
w2hparm.keymapping=true;
//w2hparm.synchronizeVirtelMacros=true;   


The new w2h.global.js file is uploaded to CLI-DIR. The following messages can be seen in the Virtel  console log: -

VIRHT51I HTTP-W2H CONNECTING DELOC049 TO 192.168.092.057:58301         
VIRU122I DELOC049 FILE UPLOAD : ENTRY POINT 'WEB2HOST' DIRECTORY 'CLI-D
916                                                                    
IR ' USER 'SPTHOLT             '                                       
       FILE : 'W2HPARM.GLOBAL.JS'                                      
VIR0052I DELOC049 DISCONNECTED AFTER   0 MINUTES                       
 
Open a new browser session (EDGE) we can see that the new default changes are reflected in the settings dialog. PF7/PF8 are the new defaults. The global settings have overridden the default settings.




It is important to refresh the cache after settings have been updated using the CTLR-R and CTRL-SHIFT-DEL key combinations. When a user changes their settings, the changes will be uploaded to the mainframe. The following messages will be seen in the Virtel console log.
VIRT906I HTTP-CLI SOCKET 00030000 CALL FROM 192.168.092.065:50426      
VIRHT51I HTTP-CLI CONNECTING CLLOC009 TO 192.168.092.065:50426         
VIR0052I CLLOC009 DISCONNECTED AFTER   0 MINUTES                       
VIRU122I CLVTA078 FILE UPLOAD : ENTRY POINT 'CLIWHOST' DIRECTORY 'USERP
285                                                                    
ARM' USER 'CTKHOLT             '                                       
       FILE : '8A4B86A3A108399F5866624546DA28C6'                       


Here the PF7/PF8 settings have been modified by the user. A display of settings panel now shows the user settings in force. The users settings will be saved in the USERPARM using a unique key. Here the key is 8A4B86A3A108399F5866624546DA28C6.




To restore to the administrator’s global settings, we just press the “Defaults” button. This will download the global settings from the mainframe. A redisplay of the settings shows the restore administrator settings and upload the changes to the USERPARM directory on the mainframe.




Removing a USER’s default settings 

A user’s settings can be removed from the USERPARM directory by deleting the key associated with the user from the USERPARM directory. For example, the key associated with CTKHOLT is 8A4B86A3A108399F5866624546DA28C6. If we look at USERPARM directory in the Admin portal (41001) we can see it listed.



We can remove the entry by using the delete option. This will remove any user settings. The user will then have to “restore defaults” to correctly pickup up the global default parameters as defined by the Administrator.

Message VIRU122I

This message can be silenced through the use of the F Virtel, SILENCE command.


USERPARM Problems

Problem
When I try to save my settings, I get the following dialog box.


In the Virtel log I also see the follow messages:
VIRU122I CLVTA079 FILE UPLOAD : ENTRY POINT 'CLIWHOST' DIRECTORY 'USERP
330                                                                    
ARM' USER 'SPTHOLT             '                                       
       FILE : '9346CCEF695D8FF2D7C1B2DA6C81CFC8'                       
VIRC121E PAGE NOT FOUND FOR CLVTA079 ENTRY POINT 'CLIWHOST' DIRECTORY '
331                                                                    
W2H     '(W2H-DIR  W2H-KEY )                                           
       PAGE : 'VPLEX=UNDEFINEDPARAMETERS-CODE.TXT' URL : '/w2h/VPLEX=un
definedPARAMETERS-CODE.txt++AjaxSession=ADvzWAAAAAAeu                  

Probable Cause
Maintenance level too low. Apply the latest maintenance. You must be at UPDT5708 or higher.

Problem
I save my user parameter changes but when I use a different PC or browser I am reverted back to my old or default settings.
Probable Cause
Insufficient RACF security. Check the Virtel log and look for any RACF violations that may be preventing a user from uploading their user parameters definitions to the mainframe repository. In the console log you may well see RACF error messages: -
ICH408I USER(CTKHOLT ) GROUP(CTKGROUP) NAME(ED HOLT             ) 451  
  SPVIREH.USERPARM CL(FACILITY)                                        
  INSUFFICIENT ACCESS AUTHORITY                                        
  ACCESS INTENT(READ   )  ACCESS ALLOWED(NONE   )                      
VIRU121E CLVTA079 FILE UPLOAD FAILED : ENTRY POINT 'CLIWHOST' DIRECTORY
452                                                                    
 'USERPARM' USER 'CTKHOLT             '                                
       FILE : 'C6D24022819C599803A86BB3C42298B6'           

Problem
Changed defaults not reflected in settings.

Probable cause
XXX-03P Transaction error. Make sure that all the xxx-03P transactions point to the same directory i.e. CLI-DIR, which should contain your default w2hparm.js transaction location.

To list you w2hparm.js file use the following URL

http://192.168.170.48:4100x/w2h/w2hparm-js/w2hparm.js
// NOTE: this file is a sample and will be replaced after a new install.
// please see the documentation on possible parameter values
// and on how to set this file up in CLI-DIR instead of W2H-DIR
//
//var w2hparm = {};
var w2hparm = {
     "global-settings":{
        "pathToW2hparm":"../option/w2hparm.global.js",
        "pathToCssCustom":"../option/custCSS.global.css",
        "pathToHelp": "../option/myHelp.html",
        "pathToJsCustom":"../option/custJS.global.js"
     }
};

This will list your “global” locations. You can use the following URL to list the global w2hparm.global.js file which should contain your global parameter overrides.

http://192.168.170.48:41002/option/w2hparm.global.js	

// w2hparm.global.js (CLI-DIR)
// w2h parameters to override defaults and add DDI macro support.
var w2hparm = {"ctrl":"Newline",
"enter":"ENTER",
"pgup":"PA1",
"pgdn":"PA2",
"useVirtelMacros":{"macrosAutoRefresh":"session"}};
w2hparm.keymapping=true;
//w2hparm.synchronizeVirtelMacros=true;

Setting up for Centralized macros and DDI

The following section provides details on how to implement centralized macros through Virtel’s DDI feature.
Getting ready for Centralized Macros.

1. Stop Virtel
2. Create and install additional RACF profiles to support DDI. The following is a sample RACF job to update RACF with the necessary profiles. It should be modified accordingly: -
       Change SPVIREH to the value specified in the TCT PRFSECU= option.
       Change SPGPTECH to the administration group for Virtel.
//STEP0   EXEC PGM=IKJEFT01,DYNAMNBR=20 COND=ONLY            
//SYSTSPRT DD  SYSOUT=*                                      
//SYSTSIN  DD  *                                             
  /*-------------------------------------------------------*/
  /* Directory Access                                      */
  /*-------------------------------------------------------*/
  RDEF FACILITY SPVIREH.GLB-DIR UACC(NONE) /* Global Dir. */ 
  PE SPVIREH.GLB-DIR CL(FACILITY) RESET                      
  PE SPVIREH.GLB-DIR CL(FACILITY) ACC(READ) ID(SPGPTECH)     
  RDEF FACILITY SPVIREH.GRP-DIR UACC(NONE) /* Group Dir.  */ 
  PE SPVIREH.GRP-DIR CL(FACILITY) RESET                      
  PE SPVIREH.GRP-DIR CL(FACILITY) ACC(READ) ID(SPGPTECH)     
  RDEF FACILITY SPVIREH.USR-DIR UACC(NONE) /* Global Dir. */ 
  PE SPVIREH.USR-DIR CL(FACILITY) RESET                      
  PE SPVIREH.USR-DIR CL(FACILITY) ACC(READ) ID(SPGPTECH)     
  /*-------------------------------------------------------*/
  /* DDI / Capability                                      */
  /*-------------------------------------------------------*/
  RDEF FACILITY SPVIREH.W2H-07  UACC(NONE)  /* DDI         */
  PE SPVIREH.W2H-07 CL(FACILITY) RESET                       
  PE SPVIREH.W2H-07 CL(FACILITY) ACC(READ) ID(SPGPTECH)      
  RDEF FACILITY SPVIREH.W2H-66  UACC(NONE)  /* DDI         */
  PE SPVIREH.W2H-66 CL(FACILITY) RESET                       
  PE SPVIREH.W2H-66 CL(FACILITY) ACC(READ) ID(SPGPTECH)      
  /*-------------------------------------------------------*/
  /* Administrators Upload                                 */
  /*-------------------------------------------------------*/
  RDEF FACILITY SPVIREH.W2H-80A UACC(NONE) /* Global Dir. */ 
  PE SPVIREH.W2H-80A CL(FACILITY) RESET                      
  PE SPVIREH.W2H-80A CL(FACILITY) ACC(READ) ID(SPGPTECH)     
  RDEF FACILITY SPVIREH.W2H-80G UACC(NONE) /* Global Dir. */ 
  PE SPVIREH.W2H-80G CL(FACILITY) RESET                      
  PE SPVIREH.W2H-80G CL(FACILITY) ACC(READ) ID(SPGPTECH)     
  RDEF FACILITY SPVIREH.W2H-80U UACC(NONE) /* Global Dir. */ 
  PE SPVIREH.W2H-80U CL(FACILITY) RESET                      
  PE SPVIREH.W2H-80U CL(FACILITY) ACC(READ) ID(SPGPTECH)     

3. Rerun the ARBOLOAD job and specify VMACROS=YES. This will install additional transactions and directories to support centralized macros.
SUBDIR   GLB-DIR  WAS SUCCESSFULLY ADDED              
SUBDIR   GRP-DIR  WAS SUCCESSFULLY ADDED
SUBDIR   USR-DIR  WAS SUCCESSFULLY ADDED
TRANSACT W2H-03A  WAS SUCCESSFULLY ADDED
TRANSACT W2H-03G  WAS SUCCESSFULLY ADDED
TRANSACT W2H-03U  WAS SUCCESSFULLY ADDED
TRANSACT W2H-07   WAS SUCCESSFULLY ADDED
TRANSACT W2H-66   WAS SUCCESSFULLY ADDED
TRANSACT W2H-80A  WAS SUCCESSFULLY ADDED
TRANSACT W2H-80G  WAS SUCCESSFULLY ADDED
TRANSACT W2H-80U  WAS SUCCESSFULLY ADDED
TRANSACT CLI-03A  WAS SUCCESSFULLY ADDED
TRANSACT CLI-03G  WAS SUCCESSFULLY ADDED
TRANSACT CLI-03U  WAS SUCCESSFULLY ADDED
TRANSACT CLI-80U  WAS SUCCESSFULLY ADDED



4. After updating the ARBO with the new transactions, restart Virtel. Check that the new directories are accessible. Go to the Administration panel and load up the Drag and Drop Interface. Three new directories should be visible – GLB-DIR, GRP-DIR and USR-DIR.

5. Update w2hparm.js
Next will need to add some w2hparm parameters to the w2hparm.js file. Make the changes and upload to the CLI-DIR Directory 
        "useVirtelMacros":{"macrosAutoRefresh":"session"},
        "keymapping":true,
        

This turns on the centralized macro support plus the additional keymapping option. Upload this file to the CLI-DIR and then refresh the cache (CTR-SHIFT-DEL). To check that you have the correct settings redisplay the w2hparm.js member using the following URL :
http://192.168.170.48:41002/option/w2hparm.global.js
// w2hparm.global.js (CLI-DIR)
// w2h parameters to override defaults.
var w2hparm = {
  "ctrl":"Newline",  
  "font":"DejaVu Sans Mono",
  "useVirtelMacros":{"macrosAutoRefresh":"session"},
  "keymapping":true
};

This shows that our updated w2hparm.global.js has been installed and can be located within the CLI-DIR. Also check that the same member is located through W2H by using the following URL:- http://192.168.170.48:41001/option/w2hparm.global.js

This means that both line 41001 and 41002 are locating the same w2hparm.global.js definitions. 
You can also look qt the console log in the developer’s tool kit (PF12 in the URL area) and should see the following messages in the console tab: -
Centralized settings date: 20200329194920
web2ajaxc.js:1402 No valid settings in local storage. Settings are being copied from centralized saving.
web2ajaxc.js:1501 19:54:22:776 - initSynchro(mainpageloaded)
web2ajaxc.js:1538 mainpageloaded: perform vwa_initAdminJS, index=2
web2ajaxc.js:1501 19:54:22:776 - initSynchro(customjsloaded)
web2ajaxc.js:1215 saving to local storage
web2ajaxc.js:4898 load css pour 3270
web2ajaxc.js:1501 19:54:22:821 - initSynchro(w2hparminitialized)
web2ajaxc.js:1538 w2hparminitialized: perform initDOM, index=2
web2ajaxc.js:4129 w2hparm.useVirtelMacros.macrosAutoRefresh=session
web2ajaxc.js:4154 First access in the browser session : retrieve the VIRTEL macros with 'session' option.
web2ajaxc.js:1538 w2hparminitialized: perform initWEB2AJAX, index=2
web2ajaxc.js:1501 19:54:22:869 - initSynchro(3270cssloaded)
web2ajaxc.js:1538 3270cssloaded: perform vwa_initAdminCSS, index=2
web2ajaxc.js:1501 19:54:22:870 - initSynchro(customcssloaded)
web2ajaxc.js:7335 3278T graphic characters escaping deactivated.
web2ajaxc.js:1501 19:54:22:915 - initSynchro(first3270data)

6. Check the DDI is active. You can do this by launching a TSO session in both W2H and CLI. In each case check that the Macro ICON in the tool bar is blue, indicating DDI is on, and not Green, which is DDI disabled/not implemented.

Create a test macro using the macro record button. When you go to save the macro, you will be given the option to associate the macro with a key sequence. Enter a macro name and press the save key. 

The macro will be saved to your local storage. The following panel will be displayed:-

With DDI/macro support you do not have the ability to export/import macros. For security reasons macros are only administered by the Virtel administrator(s). Getting macros into the DDI repository directories is performed through the DDI import feature. In the next section we will create a dummy macro, and import it into the global directory of the DDI repository.

Creating a Global macro.
To create a global macro, we will setup a Virtel line which is not running DDI. We can easily do this by setting the Administration line 41001 back to the original w2hparm.js defaults, thereby disabling the DDI/macro functionality. 
Open up the Admin portal on 41001 and change the W2H-03P transaction back to the W2H-DIR, refresh the cache. The Macro ICON should now be back to Green and if we look at the Macro panel we will see that we have the Import/Export feature back. We can use this environment to create and export macros. These macros can then be imported into the DDI/macro repository.

Figure 7: Import/Export Function of Local Macro support
1. We create a local macro called SDSF which, from the primary ISPF option menu, invokes SDSF, issues a LOG command, and then a TOP command.
2. We save the macro as SDSF
3. We select the EXPORT button to export the macro. All exported macros are called macros.json and will be written to the browser’s default download directory. 

The exported file will look like this: -
{"macros":[{"name":"SDSF","rev":1,"def":[61,115,"ENTER",108,111,103,"ENTER",116,111,112,"ENTER"]}],"fmt":2}  
Now we want to import this macro.json file into the Global directory of our DDI repository and make it available to everyone. To do that we have to open the DDI interface from the Administration Port and Drag & Drop the file into the Global Directory.
Open the DDI interface from the Administration Portal (41001) and select the Global Tab.

Figure 8: Global directory of the DDI interface
 Drag and drop the macros.json file into the D&D area (Area surrounded by dotted lines). Refresh the area by clicking the Refresh ICON button – button in the Top Left of the Global Tab. You should now be presented with the refreshed Global Directory which now contains the macros contained within the macros.json file – in our case just one macro called SDSF.

Figure 9: Global Directory with macros.json file.
If we open up a TSO or CICS session with DDI Macros active (blue ICON) under 41002 we should see that our Global Area has now been populated with the SDSF macro.

Figure 10: Global Macro
We also have some “user macros” that this user is maintaining – “logon” and “logoff”.

Creating a Group macro 
A Group macro is associated with a particular RACF group and will only be displayed in the Macro list is the user is a member or connected to that Group. Creating a Group macro follows along with the same process as creating a Global macro. We create the macros.json file, using the Export/Import functions of a non-DDI macro interface (Port 41001), which will contain the macro. We then export it and the import it into the Group directory of the DDI repository using the drag and drop area.
The difference with Group macros is that we have to specify the Group that the macros.json file will belong to. When selecting the Group Tab of the DDI area we specify the Group: -

Figure 11: Enter Group Name for Group macros
In our example we enter a group name, press the green tick,  and then drag and drop our macros.json file into the D&D area: -

Figure 12: Adding a group macro
Once we refresh the area, the macros.json file will be listed. When we now display the available macros in out 3270 session. If we refresh the macro display by hitting the refresh button, we should see all the macros listed in the group section: -

Figure 13: Group Macro display
Administration Functions
For the three macro directories, USER, GROUP and GLOBAL the file name must be called macros.json. There will be one such file for the GLOBAL directory, one for each GROUP and one for each USER. The macros.json file contains all the macros for that particular DDI entity – USER, GROUP or GLOBAL directory  
As a Virtel Administration you have various functions available to you that you can use to manage the contents of the macros.json files. If you right click on the macros.json file within the DDI list you will see a Pop-Up box providing various administration tools. These include: -


* Download – You can download a macros.json file and edit it to add additional macro entries manually. This can then be uploaded back into the DDI repository.
* Copy – Copy is not really applicable here as all macros.json files must reside in the USR-DIR. You can use this function to copy the macros.json files to a backup directory. The back-directory would have to be pre-allocated using the similar JCL that was used to create the USR-DIR VSAM file. 
* Delete – Delete the macros.json file.
* Edit – Edit the contents of the macros.json file.
 

Figure 14: Editing a macro within DDI

Problems

Message
Virtel is not configured for dynamic directories message

Probable cause
You have not run the ARBOLOAD with VMACROS=YES.



Solution
Make sure you are using a transaction with security set. 
Refresh the cache with the following commands. 
CTRL-SHIFT-DEL
CTRL R


Message
Cannot access the directory XXX-DIR
Probable cause
Out of Sync condition or no transaction security. 
If the Virtel cache is out of sync with the DDI/macro settings or you are trying to access DDI macros using a non-secure transaction i.e. TRANSACTION SECURITY=0 ,  then the following page can appear when pressing the macro ICON button :-


Solution
Make sure you are using a transaction with security set. 
Refresh the cache with the following commands. 
CTRL-SHIFT-DEL
CTRL R
Setting up a secure link
Defining a new line and transaction
In this section we look at setting up a secure HTTPS link to Virtel. We will be using a STC procedure SPVIREHV which has been assigned a RACF userid and group. We will need the STC userid when defining the RACF definitions for the KEYRING etc. We will define a new line, along with its related Virtel components such as Entry Points, transactions and terminals. This new line will be bound to port 41003 and will use the services of AT-TLS to secure the connection between the browser and the mainframe. The link will access only one CICS application.
Creating the Virtel line.
1. Run the sample template job as listed in Appendix B. Modify accordingly to your site standards. In the template example we define a line on Port 41003 with the following Virtel details.
Directory:		SEC-DIR
Entry Point:		SECHOST
Transaction Prefix:	SEC
Default terminal pool:	*W2HPOOL
VTAM Relay prefix:	SEVTA
Terminal prefix:		SELOC
 Transactions:		SEC-00, SEC-03W, SEC-03P, SEC-03X, SEC-04, SEC-90, W2H-80S

2. Add the following definition to the Virtel VTAM major node member in VTAMLST

SEVTA??? APPL  AUTH=(ACQ,PASS),MODETAB=ISTINCLM,DLOGMOD=SNX32703,EAS=1

3. Start up Virtel and display the lines. 

F Virtel,Lines 

We should see that the new lines are OPEN and connected to TCP/IP.

F SPTHOLTV,LINES                                         
VIR0200I LINES                                           
VIR0201I VIRTEL 4.59 APPLID=VIRTEL   LINES               
VIR0202I ALLOCATED IP ADDRESS = 192.168.170.048          
VIR0202I INT.NAME EXT.NAME TYPE  ACB OR IP               
VIR0202I -------- -------- ----- ---------               
VIR0202I C-HTTP   HTTP-CLI TCP1  :41002                  
VIR0202I E-HTTP   HTTP-SEC TCP1  :41003                  
VIR0202I W-HTTP   HTTP-W2H TCP1  :41001                  
VIR0202I ---END OF LIST---

4. 
Open a Virtel session on line 41003 with the following URL

The APPSTAT menu should appear with just one entry for SPCICST


Figure 15 : CICS application under 41003
At this point we have defined a CICS application which is supported by our new line definition. It is still accessed through a unsecured HTTP URL. In the next section we see how to install AT-TLS and secure our new line and any traffic that passes through.      

Configuring AT-TLS to secure a line   

To provide secure HTTP (https) sessions between the mainframe and client browsers, VIRTEL uses the services of the Application Transparent Transport Layer Security (AT-TLS) feature of z/OS Communication Server. AT-TLS is included with z/OS V1R7 and later releases.  AT-TLS allows socket applications to access encrypted sessions by invoking system SSL within the transport layer of the TCP/IP stack. The Policy Agent decides which connections are to use AT-TLS, and provides system SSL configuration for those connections. The application continues to send and receive clear text over the socket, but data sent over the network is protected by system SSL. The supported protocols are TLS, SSLv3, and SSLv2. 

TCP/IP Profile

You need to add the TTLS statement to your TCP/IP profile : -

TCPCONFIG                                                                    
    RESTRICTLOWPORTS                                                         
    TTLS ; Activate AT-TLS (Application Transparent Transport Layer Security)


The Policy Agent

The Policy Agent (PAGENT) is a started task the provides the configuration details required bt AT-TLS to support secure sessions. If you do not already have the Communications Server Policy Agent (PAGENT) active in your z/OS system, copy the catalogued procedure EZAPAGSP from TCPIP.SEZAINST into your PROCLIB, renaming it as PAGENT.    

Setting up to run AT-TLS and PAGENT 

If you do not already run the Policy Agent, you will need to create a configuration file /etc/pagent.conf using z/OS Unix System Services. See the SSLSETUP job in VIRTEL SAMPLIB library.

This job performs the following steps: -

STEP EZBAUTH :		RACF AUTHORIZATIONS FOR AT-TLS
STEP PROCLIB : 		COPY POLICY AGENT PROCEDURE
STEP IRRAUTH : 	RACF AUTHORIZATIONS FOR CERTIFICATE MANAGEMENT
STEP DCERTCA : 	RACF DELETE PREVIOUS SIGNING CERTIFICATE
STEP CCERTCA : 	RACF CREATE SIGNING CERTIFICATE
STEP DCERTIF : 		RACF DELETE PREVIOUS VIRTEL SERVER CERTIFICATE AND KEYRING
STEP CCERTIF :		RACF CREATE VIRTEL SERVER CERTIFICATE AND KEYRING
STEP LCERTIF :		RACF DISPLAY DIGITAL CERTIFICATES AND KEYRINGS	

 If you already run Policy Agent, you will need to find the existing configuration file and add the Virtel TTLS definitions to it. A sample configuration file can be found in the SAMPLIB library. See member SSLSETUP: -
  
Step PCONFIG in the SSLSETUP sample job contains a starter configuration.

In both case the following changes should be made:
• Replace %virtjob% by the name of your VIRTEL started task (SSLSETUP line 70)
• Replace 41000-41002 by 41002 in the LocalPortRange parameter (SSLSETUP line 71) to activate AT-TLS for VIRTEL line C-HTTP.
• Replace ‘ServerWithClientAuth’ by ‘Server’ in the HandshakeRole parameter (SSLSETUP line 82). We will not be using Client Certificates at this stage.

After changing the PAGENT configuration start the PAGENT task or refresh it with F PAGENT,REFRESH. You Should see the following messages in the SYSLOG: -

F PAGENT,REFRESH                                                    
EZZ8771I PAGENT CONFIG POLICY PROCESSING COMPLETE FOR TCPIP : TTLS  
EZZ8443I PAGENT MODIFY COMMAND ACCEPTED                             
            
When we access the port 41003 with the URL https://192.168.170.48:41003 we will be presented with some certificate warning errors because of the “Self-Signed” CA certificate. We proceed to the address identified in the browser certificate warning page. Eventually we are presented with the APPLIST for 41003 which includes are CICS transaction: -


Figure 16: Secure transaction with HTTPS
Note the “Not Secure” warning. This will not appear if you are not using an approved CA certificate.     

Problems
Is AT-TLS Service active in TCP/IP?
Issue the following z/OS command – D TCPIP,,N,TTLS
 
The response should be: - 

EZD0101I NETSTAT CS V1R13 TCPIP 706 
TTLSGRPACTION GROUP ID CONNS 
VIRTELGROUP 00000002 3 
1 OF 1 RECORDS DISPLAYED 
END OF THE REPORT

Pagent Error codes.
The following is a list of common Pagent Error codes that can be seen in the SYSLOG: - 

* 7	 No certificate 
* 8 	Certificate not trusted 
* 109 	No CA certificates on ring 
* 202 	Keyring does not exists 
* 401 	Certificate expired 
* 402/12 Client and server cannot agree cipher suite 
* 416 	Virtel does not have permission to list keyring 
* 431 	Certificate is revoked 
* 434 	Certificate key not compatible with cipher suite 
* 435 	Certificate authority unknown 
* 5003 	Browser sent clear text. HTTP instead of HTTPS used in URL.

Virtel Messages

VIRHT57E LINE IS NOT SET UP FOR HTTPS 

This means that the browser has sent encypted text (https) but that AT-TLS has not decrypted it before sending it to VIRTEL. The PAGENT rules haven’t correctly identified this port as a SSL jobname/port. Check the /etc/pagent.conf member. The message is a bit misleading as there is no line setup required by Virtel.  Normally AT-TLS is transparent to VIRTEL. AT-TLS performs the decryption and transforms the https request into an http request before passing it to through to VIRTEL. The only case where VIRTEL is AT-TLS aware is when the VIRTEL transaction definition specifies SECURITY=3 (TLS) and in this case VIRTEL will check that the session has been processed by AT-TLS and will issue an IOCTL to obtain the userid associated with the certificate.


Appendix A
Default parameter values

Keyword Caption Possible values“fontsize” Font size “window”, “screen”, “8”, “10”, “12”, “14”, “16”“font” Font family "Droid Sans Mono","Andale Mono"
,"Consolas","Courier","Courier New","DejaVu Sans Mono","Everson Mono","Fixed","Fixedsys",
"HyperFont","IBM Railroad","Letter Gothic",
"Liberation Mono","Lucida Console","Lucida Sans Typewriter","Lucida Sans Typewriter Regular","Miriam Fixed", "Monaco", "Monofur", "Monospace", "MS Gothic", "MS Mincho", "Nimbus Mono L","OCR A Extended", "Orator", "Prestige", "Prestige Elite", "Terminal"  
“autocapture” Auto-capture true, false“autoprint” Auto-print true, false“cursor” Cursor  “Smart”, “Bar”, “Blink”, “Block”“vline” Vertical Line true, false“hline” Horiz line true, false“esc” Esc key “no”, “ATTN”, “CLEAR”, “Reset”“ctrl” Ctrl key “no”, “ENTER”, “Newline”“cmdleft” Left Cmd key “no”, “Reset”“cmdright” Right Cmd key “no”, “ENTER”“enter” Enter key “ENTER”, “Newline”“home” Home key “no”, “Home”“end” End key “no”, “ErEof”, “End”“pgup” PageUp key “PF7”, “PF19”, “PA1”, “no”“pgdn”PageDown key“PF8”, “PF20”, “PA2”, “no”“pause”Pause key“CLEAR”, “ATTN”, “PA3”, “no”“kpenter”Keypad Enter“ENTER”, “Newline”“shiftenter”Shift+Enter“no”,”ENTER”, “Newline”“shiftesc”Shift+Esc“no”, “ATTN”, “CLEAR”, “Reset”“shiftins”Shift+Insert“no”, “Dup”“shiftdel”Shift+Delete“no”, “ErEof”“shifthome”Shift+Home“no”, “FieldMark”, “Home”“shiftend”Shift+End“no”, “ErEof”, “End”“shiftpgdn”Shift+PageDown“no”, “PA3”“ctrlenter”Ctrl+Enter“no”,”ENTER”, “Newline”“ctrlins”Ctrl+Insert“no”, “PA1”“ctrldel”Ctrl+Delete“no”, “PA2”, “ErEof”“ctrlhome”Ctrl+Home“no”, “PA3”, “Home”, “ChgCur”“ctrlend”Ctrl+End“no”, “ErEof”, “End”“altins”Alt+Ins“no”, “PA1”“althome”Alt+Home“no”, “PA2” “altpgup”Alt+PageUp“no”, “PA1”“altpgdn”Alt+PageDown“no”, “PA2”“altpause”Alt+Pause“no”, “ATTN”, “CLEAR”, “PA3”“altf1”Alt+F1“no”, “PA1”, “ENTER”“altf2”Alt+F2“no”, “PA2”“altf3”Alt+F3“no”, “PA3”, “ChgCur”“kpslash”Keypad /“/”, “PA1”“kpaster”Keypad *“*”, “PA2”“kpminus”Keypad - “-“, “Backtab”“kpplus”Keypad + “+”, “Tab”, “Newline”“kpdot”Keypad . “.”, “,”“dblclick”Double Click“Word”, “ENTER”, “no”“urlhotspot”URL hotspotstrue, false“pfkhotspot”PF key hotspotstrue, false“pasteereof”Paste erase EOFtrue, false“pastetyping”Map Ctrl+V to Paste by Typingtrue, false“movecursor”Move cursor on activatetrue, false“style”Style“3270”, “gray”, “white”“printstyle”Print style“3270”, “color”, “white”“rtm”Response time monitortrue, false“omitnulls”Omit nulls from inputtrue, false“keepmacpad”Keep macro pad opentrue, false“keepkeypad”Keep keypad opentrue, false“hiliteinput”Highlight input fieldstrue, false“caretnot”Remap ^ to logical nottrue, false“adaptfontratio”Adapt font size ratiotrue, false“charspace”Character spacingtrue, false“linespace”Line spacingtrue, false“settingsGUI”Uuser interface typev2“preservein”Preserve insert modetrue, false“nolongpoll”AsynchSupporttrue, false“MirrorMode”BiDirectional modetrue, false“NOstretch”Font Size Stretchtrue, false

Appendix B

Template job for adding a new line to Virtel.
// SET LOAD=SPTHOLT.VIRT459.LOADLIB                                     
// SET ARBO=SPTHOLT.VIRT459.ARBO                                        
//*                                                                     
//CONFIG  EXEC PGM=VIRCONF,PARM='LOAD,NOREPL',REGION=2M                   
//STEPLIB  DD  DSN=&LOAD,DISP=SHR                                       
//SYSPRINT DD  SYSOUT=*                                                 
//SYSUDUMP DD  SYSOUT=*                                                 
//VIRARBO  DD  DSN=&ARBO,DISP=SHR                                       
//SYSIN      DD *                                                       
      TERMINAL ID=SELOC000,                                            -
               DESC='Psuedo Terminals',                                -
               TYPE=3,                                                 -
               COMPRESS=2,                                             -
               INOUT=3,                                                -
               REPEAT=0016                                              
      TERMINAL ID=SEVTA000,                                            -
               RELAY=*W2HPOOL,                                         -
               DESC='HTTP terminals (with relay)',                     -
               TYPE=3,                                                 -
               COMPRESS=2,                                             -
               INOUT=3,                                                -
               STATS=26,                                               -
               REPEAT=0016                                              
      SUBDIR   ID=SEC-DIR,                                             -
               DESC='SEC directory',                                   -
               DDNAME=HTMLTRSF,                                        -
               KEY=SEC-KEY,                                            -
               NAMELEN=0064,                                           -
               AUTHUP=X,                                               -
               AUTHDOWN=X,                                             -
               AUTHDEL=X                                                
      ENTRY    ID=SECHOST,                                             -
               DESC='HTTPS entry point (Secure applications)',         -
               TRANSACT=SEC,                                           -
               TIMEOUT=0720,                                           -
               ACTION=0,                                               -
               EMUL=HTML,                                              -
               SIGNON=VIR0020H,                                        -
               MENU=VIR0021A,                                          -
               IDENT=SCENLOGM,                                         -
               SCENDIR=SCE-DIR,                                        -
               EXTCOLOR=E                                               
      TRANSACT ID=SEC-00,                                              -
               NAME=SECHOST,                                           -
               DESC='Default Directory',                               -
               APPL=SEC-DIR,                                           -              
               TYPE=4,                                                 -
               TERMINAL=SELOC,                                         -
               STARTUP=2,                                              -
               SECURITY=0,                                             -
               TIOASTA='/w2h/appmenu.htm+applist'
      TRANSACT ID=SEC-03CO,                                            -
               NAME=OPTION,                                            -
               DESC='Path to the OPT-DIR directory',                   -
               APPL=CLI-DIR,                                           -
               TYPE=4,                                                 -
                TERMINAL=SELOC,                                         -
                STARTUP=2,                                              -
                SECURITY=0                                               
        TRANSACT ID=SEC-03P,                                             -
         	  NAME='w2h',                                             -
          	  DESC='Directory for w2hparm',                           -
         	  APPL=CLI-DIR,                                           -
         	  PASSTCKT=0,                                             -
         	  TYPE=4,                                                 -
         	  TERMINAL=SELOC,                                         -
         	  STARTUP=2,                                              -
         	  SECURITY=0,                                             -
         	  LOGMSG='/w2h/w2hparm-js' 
      TRANSACT ID=SEC-03W,                                             -
               NAME='w2h',                                             -
               DESC='W2H toolkit directory (/w2h)',                    -
               APPL=W2H-DIR,                                           -
               TYPE=4,                                                 -
               STARTUP=2,                                              -
               SECURITY=0                                               
      TRANSACT ID=SEC-03X,                                             -
               NAME='SEC',                                             -
               DESC='SEC directory (/SEC)',                            -
               APPL=SEC-DIR,                                           -
               TYPE=4,                                                 -
               STARTUP=2,                                              -
               SECURITY=0                                               
      TRANSACT ID=SEC-04,                                              -
               NAME='CICS',                                            -
               DESC='CICS',                                            -
               APPL=SPCICST,                                           -
               TYPE=1,                                                 -
               TERMINAL=SEVTA,                                         -
               STARTUP=1,                                              -
               SECURITY=0                                               
      TRANSACT ID=SEC-90,                                              -
               NAME='applist',                                         -
               DESC='List of applications for appmenu.htm',            -
               APPL=VIR0021S,                                          -
               TYPE=2,                                                 -
               TERMINAL=SELOC,                                         -
               STARTUP=2,                                              -
               SECURITY=1                                               
      TRANSACT ID=W2H-80S,                                             -
               NAME='uplSEC',                                          -
               DESC='Upload macros (SEC-DIR directory)',               -
               APPL=VIR0041C,                                          -
               TYPE=2,                                                 -
               TERMINAL=DELOC,                                         -
               STARTUP=2,                                              -
               SECURITY=1,                                             -
               LOGMSG=SEC-DIR                                           
      LINE     ID=E-HTTP,                                              -
               NAME=HTTP-SEC,                                          -
               LOCADDR=:41003,                                         -
               DESC='HTTP line (entry point SECHOST)',                 -
               TERMINAL=SE,                                            -
               ENTRY=SECHOST,                                          -
               TYPE=TCP1,                                              -
               INOUT=1,                                                -
               PROTOCOL=VIRHTTP,                                       -
               TIMEOUT=0000,                                           -
               ACTION=0,                                               -
               WINSZ=0000,                                             -
               PKTSZ=0000,                                             -
               RETRY=0010                                               


Appendix C

Template job for deleting new Virtel line.
//*                                                       
// SET LOAD=SPTHOLT.VIRT459.LOADLIB                       
// SET ARBO=SPTHOLT.VIRT459.ARBO                          
//*                                                       
//CONFIG  EXEC PGM=VIRCONF,PARM='LOAD,REPL',REGION=2M     
//STEPLIB  DD  DSN=&LOAD,DISP=SHR                         
//SYSPRINT DD  SYSOUT=*                                   
//SYSUDUMP DD  SYSOUT=*                                   
//VIRARBO  DD  DSN=&ARBO,DISP=SHR                         
//SYSIN      DD *                                         
 DELETE TYPE=TRANSACT,ID=SEC-00                           
 DELETE TYPE=TRANSACT,ID=SEC-03P
 DELETE TYPE=TRANSACT,ID=SEC-03CO                                                    
 DELETE TYPE=TRANSACT,ID=SEC-03W                          
 DELETE TYPE=TRANSACT,ID=SEC-03X                          
 DELETE TYPE=TRANSACT,ID=SEC-04                           
 DELETE TYPE=TRANSACT,ID=SEC-90                           
 DELETE TYPE=TRANSACT,ID=W2H-80S                          
 DELETE TYPE=TERMINAL,ID=SELOC000                         
 DELETE TYPE=TERMINAL,ID=SEVTA000                         
 DELETE TYPE=ENTRY,ID=SECHOST                             
 DELETE TYPE=LINE,ID=E-HTTP                               
 DELETE TYPE=SUBDIR,ID=SEC-DIR                            

SYSPERTEC z/OS Technical Newsletter – Customizing Virtel V4.59 from scratch
 

4


